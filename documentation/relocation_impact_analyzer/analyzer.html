<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="pdoc 14.4.0"/>
    <title>relocation_impact_analyzer.analyzer API documentation</title>

    <style>/*! * Bootstrap Reboot v5.0.0 (https://getbootstrap.com/) * Copyright 2011-2021 The Bootstrap Authors * Copyright 2011-2021 Twitter, Inc. * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE) * Forked from Normalize.css, licensed MIT (https://github.com/necolas/normalize.css/blob/master/LICENSE.md) */*,::after,::before{box-sizing:border-box}@media (prefers-reduced-motion:no-preference){:root{scroll-behavior:smooth}}body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans","Liberation Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-size:1rem;font-weight:400;line-height:1.5;color:#212529;background-color:#fff;-webkit-text-size-adjust:100%;-webkit-tap-highlight-color:transparent}hr{margin:1rem 0;color:inherit;background-color:currentColor;border:0;opacity:.25}hr:not([size]){height:1px}h1,h2,h3,h4,h5,h6{margin-top:0;margin-bottom:.5rem;font-weight:500;line-height:1.2}h1{font-size:calc(1.375rem + 1.5vw)}@media (min-width:1200px){h1{font-size:2.5rem}}h2{font-size:calc(1.325rem + .9vw)}@media (min-width:1200px){h2{font-size:2rem}}h3{font-size:calc(1.3rem + .6vw)}@media (min-width:1200px){h3{font-size:1.75rem}}h4{font-size:calc(1.275rem + .3vw)}@media (min-width:1200px){h4{font-size:1.5rem}}h5{font-size:1.25rem}h6{font-size:1rem}p{margin-top:0;margin-bottom:1rem}abbr[data-bs-original-title],abbr[title]{-webkit-text-decoration:underline dotted;text-decoration:underline dotted;cursor:help;-webkit-text-decoration-skip-ink:none;text-decoration-skip-ink:none}address{margin-bottom:1rem;font-style:normal;line-height:inherit}ol,ul{padding-left:2rem}dl,ol,ul{margin-top:0;margin-bottom:1rem}ol ol,ol ul,ul ol,ul ul{margin-bottom:0}dt{font-weight:700}dd{margin-bottom:.5rem;margin-left:0}blockquote{margin:0 0 1rem}b,strong{font-weight:bolder}small{font-size:.875em}mark{padding:.2em;background-color:#fcf8e3}sub,sup{position:relative;font-size:.75em;line-height:0;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}a{color:#0d6efd;text-decoration:underline}a:hover{color:#0a58ca}a:not([href]):not([class]),a:not([href]):not([class]):hover{color:inherit;text-decoration:none}code,kbd,pre,samp{font-family:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:1em;direction:ltr;unicode-bidi:bidi-override}pre{display:block;margin-top:0;margin-bottom:1rem;overflow:auto;font-size:.875em}pre code{font-size:inherit;color:inherit;word-break:normal}code{font-size:.875em;color:#d63384;word-wrap:break-word}a>code{color:inherit}kbd{padding:.2rem .4rem;font-size:.875em;color:#fff;background-color:#212529;border-radius:.2rem}kbd kbd{padding:0;font-size:1em;font-weight:700}figure{margin:0 0 1rem}img,svg{vertical-align:middle}table{caption-side:bottom;border-collapse:collapse}caption{padding-top:.5rem;padding-bottom:.5rem;color:#6c757d;text-align:left}th{text-align:inherit;text-align:-webkit-match-parent}tbody,td,tfoot,th,thead,tr{border-color:inherit;border-style:solid;border-width:0}label{display:inline-block}button{border-radius:0}button:focus:not(:focus-visible){outline:0}button,input,optgroup,select,textarea{margin:0;font-family:inherit;font-size:inherit;line-height:inherit}button,select{text-transform:none}[role=button]{cursor:pointer}select{word-wrap:normal}select:disabled{opacity:1}[list]::-webkit-calendar-picker-indicator{display:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]:not(:disabled),[type=reset]:not(:disabled),[type=submit]:not(:disabled),button:not(:disabled){cursor:pointer}::-moz-focus-inner{padding:0;border-style:none}textarea{resize:vertical}fieldset{min-width:0;padding:0;margin:0;border:0}legend{float:left;width:100%;padding:0;margin-bottom:.5rem;font-size:calc(1.275rem + .3vw);line-height:inherit}@media (min-width:1200px){legend{font-size:1.5rem}}legend+*{clear:left}::-webkit-datetime-edit-day-field,::-webkit-datetime-edit-fields-wrapper,::-webkit-datetime-edit-hour-field,::-webkit-datetime-edit-minute,::-webkit-datetime-edit-month-field,::-webkit-datetime-edit-text,::-webkit-datetime-edit-year-field{padding:0}::-webkit-inner-spin-button{height:auto}[type=search]{outline-offset:-2px;-webkit-appearance:textfield}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-color-swatch-wrapper{padding:0}::file-selector-button{font:inherit}::-webkit-file-upload-button{font:inherit;-webkit-appearance:button}output{display:inline-block}iframe{border:0}summary{display:list-item;cursor:pointer}progress{vertical-align:baseline}[hidden]{display:none!important}</style>
    <style>/*! syntax-highlighting.css */pre{line-height:125%;}span.linenos{color:inherit; background-color:transparent; padding-left:5px; padding-right:20px;}.pdoc-code .hll{background-color:#ffffcc}.pdoc-code{background:#f8f8f8;}.pdoc-code .c{color:#3D7B7B; font-style:italic}.pdoc-code .err{border:1px solid #FF0000}.pdoc-code .k{color:#008000; font-weight:bold}.pdoc-code .o{color:#666666}.pdoc-code .ch{color:#3D7B7B; font-style:italic}.pdoc-code .cm{color:#3D7B7B; font-style:italic}.pdoc-code .cp{color:#9C6500}.pdoc-code .cpf{color:#3D7B7B; font-style:italic}.pdoc-code .c1{color:#3D7B7B; font-style:italic}.pdoc-code .cs{color:#3D7B7B; font-style:italic}.pdoc-code .gd{color:#A00000}.pdoc-code .ge{font-style:italic}.pdoc-code .gr{color:#E40000}.pdoc-code .gh{color:#000080; font-weight:bold}.pdoc-code .gi{color:#008400}.pdoc-code .go{color:#717171}.pdoc-code .gp{color:#000080; font-weight:bold}.pdoc-code .gs{font-weight:bold}.pdoc-code .gu{color:#800080; font-weight:bold}.pdoc-code .gt{color:#0044DD}.pdoc-code .kc{color:#008000; font-weight:bold}.pdoc-code .kd{color:#008000; font-weight:bold}.pdoc-code .kn{color:#008000; font-weight:bold}.pdoc-code .kp{color:#008000}.pdoc-code .kr{color:#008000; font-weight:bold}.pdoc-code .kt{color:#B00040}.pdoc-code .m{color:#666666}.pdoc-code .s{color:#BA2121}.pdoc-code .na{color:#687822}.pdoc-code .nb{color:#008000}.pdoc-code .nc{color:#0000FF; font-weight:bold}.pdoc-code .no{color:#880000}.pdoc-code .nd{color:#AA22FF}.pdoc-code .ni{color:#717171; font-weight:bold}.pdoc-code .ne{color:#CB3F38; font-weight:bold}.pdoc-code .nf{color:#0000FF}.pdoc-code .nl{color:#767600}.pdoc-code .nn{color:#0000FF; font-weight:bold}.pdoc-code .nt{color:#008000; font-weight:bold}.pdoc-code .nv{color:#19177C}.pdoc-code .ow{color:#AA22FF; font-weight:bold}.pdoc-code .w{color:#bbbbbb}.pdoc-code .mb{color:#666666}.pdoc-code .mf{color:#666666}.pdoc-code .mh{color:#666666}.pdoc-code .mi{color:#666666}.pdoc-code .mo{color:#666666}.pdoc-code .sa{color:#BA2121}.pdoc-code .sb{color:#BA2121}.pdoc-code .sc{color:#BA2121}.pdoc-code .dl{color:#BA2121}.pdoc-code .sd{color:#BA2121; font-style:italic}.pdoc-code .s2{color:#BA2121}.pdoc-code .se{color:#AA5D1F; font-weight:bold}.pdoc-code .sh{color:#BA2121}.pdoc-code .si{color:#A45A77; font-weight:bold}.pdoc-code .sx{color:#008000}.pdoc-code .sr{color:#A45A77}.pdoc-code .s1{color:#BA2121}.pdoc-code .ss{color:#19177C}.pdoc-code .bp{color:#008000}.pdoc-code .fm{color:#0000FF}.pdoc-code .vc{color:#19177C}.pdoc-code .vg{color:#19177C}.pdoc-code .vi{color:#19177C}.pdoc-code .vm{color:#19177C}.pdoc-code .il{color:#666666}</style>
    <style>/*! theme.css */:root{--pdoc-background:#fff;}.pdoc{--text:#212529;--muted:#6c757d;--link:#3660a5;--link-hover:#1659c5;--code:#f8f8f8;--active:#fff598;--accent:#eee;--accent2:#c1c1c1;--nav-hover:rgba(255, 255, 255, 0.5);--name:#0066BB;--def:#008800;--annotation:#007020;}</style>
    <style>/*! layout.css */html, body{width:100%;height:100%;}html, main{scroll-behavior:smooth;}body{background-color:var(--pdoc-background);}@media (max-width:769px){#navtoggle{cursor:pointer;position:absolute;width:50px;height:40px;top:1rem;right:1rem;border-color:var(--text);color:var(--text);display:flex;opacity:0.8;z-index:999;}#navtoggle:hover{opacity:1;}#togglestate + div{display:none;}#togglestate:checked + div{display:inherit;}main, header{padding:2rem 3vw;}header + main{margin-top:-3rem;}.git-button{display:none !important;}nav input[type="search"]{max-width:77%;}nav input[type="search"]:first-child{margin-top:-6px;}nav input[type="search"]:valid ~ *{display:none !important;}}@media (min-width:770px){:root{--sidebar-width:clamp(12.5rem, 28vw, 22rem);}nav{position:fixed;overflow:auto;height:100vh;width:var(--sidebar-width);}main, header{padding:3rem 2rem 3rem calc(var(--sidebar-width) + 3rem);width:calc(54rem + var(--sidebar-width));max-width:100%;}header + main{margin-top:-4rem;}#navtoggle{display:none;}}#togglestate{position:absolute;height:0;opacity:0;}nav.pdoc{--pad:clamp(0.5rem, 2vw, 1.75rem);--indent:1.5rem;background-color:var(--accent);border-right:1px solid var(--accent2);box-shadow:0 0 20px rgba(50, 50, 50, .2) inset;padding:0 0 0 var(--pad);overflow-wrap:anywhere;scrollbar-width:thin; scrollbar-color:var(--accent2) transparent; z-index:1}nav.pdoc::-webkit-scrollbar{width:.4rem; }nav.pdoc::-webkit-scrollbar-thumb{background-color:var(--accent2); }nav.pdoc > div{padding:var(--pad) 0;}nav.pdoc .module-list-button{display:inline-flex;align-items:center;color:var(--text);border-color:var(--muted);margin-bottom:1rem;}nav.pdoc .module-list-button:hover{border-color:var(--text);}nav.pdoc input[type=search]{display:block;outline-offset:0;width:calc(100% - var(--pad));}nav.pdoc .logo{max-width:calc(100% - var(--pad));max-height:35vh;display:block;margin:0 auto 1rem;transform:translate(calc(-.5 * var(--pad)), 0);}nav.pdoc ul{list-style:none;padding-left:0;}nav.pdoc > div > ul{margin-left:calc(0px - var(--pad));}nav.pdoc li a{padding:.2rem 0 .2rem calc(var(--pad) + var(--indent));}nav.pdoc > div > ul > li > a{padding-left:var(--pad);}nav.pdoc li{transition:all 100ms;}nav.pdoc li:hover{background-color:var(--nav-hover);}nav.pdoc a, nav.pdoc a:hover{color:var(--text);}nav.pdoc a{display:block;}nav.pdoc > h2:first-of-type{margin-top:1.5rem;}nav.pdoc .class:before{content:"class ";color:var(--muted);}nav.pdoc .function:after{content:"()";color:var(--muted);}nav.pdoc footer:before{content:"";display:block;width:calc(100% - var(--pad));border-top:solid var(--accent2) 1px;margin-top:1.5rem;padding-top:.5rem;}nav.pdoc footer{font-size:small;}</style>
    <style>/*! content.css */.pdoc{color:var(--text);box-sizing:border-box;line-height:1.5;background:none;}.pdoc .pdoc-button{cursor:pointer;display:inline-block;border:solid black 1px;border-radius:2px;font-size:.75rem;padding:calc(0.5em - 1px) 1em;transition:100ms all;}.pdoc .pdoc-alert{padding:1rem 1rem 1rem calc(1.5rem + 24px);border:1px solid transparent;border-radius:.25rem;background-repeat:no-repeat;background-position:1rem center;margin-bottom:1rem;}.pdoc .pdoc-alert > *:last-child{margin-bottom:0;}.pdoc .pdoc-alert-note {color:#084298;background-color:#cfe2ff;border-color:#b6d4fe;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23084298%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8%2016A8%208%200%201%200%208%200a8%208%200%200%200%200%2016zm.93-9.412-1%204.705c-.07.34.029.533.304.533.194%200%20.487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703%200-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381%202.29-.287zM8%205.5a1%201%200%201%201%200-2%201%201%200%200%201%200%202z%22/%3E%3C/svg%3E");}.pdoc .pdoc-alert-warning{color:#664d03;background-color:#fff3cd;border-color:#ffecb5;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23664d03%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8.982%201.566a1.13%201.13%200%200%200-1.96%200L.165%2013.233c-.457.778.091%201.767.98%201.767h13.713c.889%200%201.438-.99.98-1.767L8.982%201.566zM8%205c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%205.995A.905.905%200%200%201%208%205zm.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2z%22/%3E%3C/svg%3E");}.pdoc .pdoc-alert-danger{color:#842029;background-color:#f8d7da;border-color:#f5c2c7;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23842029%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M5.52.359A.5.5%200%200%201%206%200h4a.5.5%200%200%201%20.474.658L8.694%206H12.5a.5.5%200%200%201%20.395.807l-7%209a.5.5%200%200%201-.873-.454L6.823%209.5H3.5a.5.5%200%200%201-.48-.641l2.5-8.5z%22/%3E%3C/svg%3E");}.pdoc .visually-hidden{position:absolute !important;width:1px !important;height:1px !important;padding:0 !important;margin:-1px !important;overflow:hidden !important;clip:rect(0, 0, 0, 0) !important;white-space:nowrap !important;border:0 !important;}.pdoc h1, .pdoc h2, .pdoc h3{font-weight:300;margin:.3em 0;padding:.2em 0;}.pdoc > section:not(.module-info) h1{font-size:1.5rem;font-weight:500;}.pdoc > section:not(.module-info) h2{font-size:1.4rem;font-weight:500;}.pdoc > section:not(.module-info) h3{font-size:1.3rem;font-weight:500;}.pdoc > section:not(.module-info) h4{font-size:1.2rem;}.pdoc > section:not(.module-info) h5{font-size:1.1rem;}.pdoc a{text-decoration:none;color:var(--link);}.pdoc a:hover{color:var(--link-hover);}.pdoc blockquote{margin-left:2rem;}.pdoc pre{border-top:1px solid var(--accent2);border-bottom:1px solid var(--accent2);margin-top:0;margin-bottom:1em;padding:.5rem 0 .5rem .5rem;overflow-x:auto;background-color:var(--code);}.pdoc code{color:var(--text);padding:.2em .4em;margin:0;font-size:85%;background-color:var(--accent);border-radius:6px;}.pdoc a > code{color:inherit;}.pdoc pre > code{display:inline-block;font-size:inherit;background:none;border:none;padding:0;}.pdoc > section:not(.module-info){margin-bottom:1.5rem;}.pdoc .modulename{margin-top:0;font-weight:bold;}.pdoc .modulename a{color:var(--link);transition:100ms all;}.pdoc .git-button{float:right;border:solid var(--link) 1px;}.pdoc .git-button:hover{background-color:var(--link);color:var(--pdoc-background);}.view-source-toggle-state,.view-source-toggle-state ~ .pdoc-code{display:none;}.view-source-toggle-state:checked ~ .pdoc-code{display:block;}.view-source-button{display:inline-block;float:right;font-size:.75rem;line-height:1.5rem;color:var(--muted);padding:0 .4rem 0 1.3rem;cursor:pointer;text-indent:-2px;}.view-source-button > span{visibility:hidden;}.module-info .view-source-button{float:none;display:flex;justify-content:flex-end;margin:-1.2rem .4rem -.2rem 0;}.view-source-button::before{position:absolute;content:"View Source";display:list-item;list-style-type:disclosure-closed;}.view-source-toggle-state:checked ~ .attr .view-source-button::before,.view-source-toggle-state:checked ~ .view-source-button::before{list-style-type:disclosure-open;}.pdoc .docstring{margin-bottom:1.5rem;}.pdoc section:not(.module-info) .docstring{margin-left:clamp(0rem, 5vw - 2rem, 1rem);}.pdoc .docstring .pdoc-code{margin-left:1em;margin-right:1em;}.pdoc h1:target,.pdoc h2:target,.pdoc h3:target,.pdoc h4:target,.pdoc h5:target,.pdoc h6:target,.pdoc .pdoc-code > pre > span:target{background-color:var(--active);box-shadow:-1rem 0 0 0 var(--active);}.pdoc .pdoc-code > pre > span:target{display:block;}.pdoc div:target > .attr,.pdoc section:target > .attr,.pdoc dd:target > a{background-color:var(--active);}.pdoc *{scroll-margin:2rem;}.pdoc .pdoc-code .linenos{user-select:none;}.pdoc .attr:hover{filter:contrast(0.95);}.pdoc section, .pdoc .classattr{position:relative;}.pdoc .headerlink{--width:clamp(1rem, 3vw, 2rem);position:absolute;top:0;left:calc(0rem - var(--width));transition:all 100ms ease-in-out;opacity:0;}.pdoc .headerlink::before{content:"#";display:block;text-align:center;width:var(--width);height:2.3rem;line-height:2.3rem;font-size:1.5rem;}.pdoc .attr:hover ~ .headerlink,.pdoc *:target > .headerlink,.pdoc .headerlink:hover{opacity:1;}.pdoc .attr{display:block;margin:.5rem 0 .5rem;padding:.4rem .4rem .4rem 1rem;background-color:var(--accent);overflow-x:auto;}.pdoc .classattr{margin-left:2rem;}.pdoc .name{color:var(--name);font-weight:bold;}.pdoc .def{color:var(--def);font-weight:bold;}.pdoc .signature{background-color:transparent;}.pdoc .param, .pdoc .return-annotation{white-space:pre;}.pdoc .signature.multiline .param{display:block;}.pdoc .signature.condensed .param{display:inline-block;}.pdoc .annotation{color:var(--annotation);}.pdoc .view-value-toggle-state,.pdoc .view-value-toggle-state ~ .default_value{display:none;}.pdoc .view-value-toggle-state:checked ~ .default_value{display:inherit;}.pdoc .view-value-button{font-size:.5rem;vertical-align:middle;border-style:dashed;margin-top:-0.1rem;}.pdoc .view-value-button:hover{background:white;}.pdoc .view-value-button::before{content:"show";text-align:center;width:2.2em;display:inline-block;}.pdoc .view-value-toggle-state:checked ~ .view-value-button::before{content:"hide";}.pdoc .inherited{margin-left:2rem;}.pdoc .inherited dt{font-weight:700;}.pdoc .inherited dt, .pdoc .inherited dd{display:inline;margin-left:0;margin-bottom:.5rem;}.pdoc .inherited dd:not(:last-child):after{content:", ";}.pdoc .inherited .class:before{content:"class ";}.pdoc .inherited .function a:after{content:"()";}.pdoc .search-result .docstring{overflow:auto;max-height:25vh;}.pdoc .search-result.focused > .attr{background-color:var(--active);}.pdoc .attribution{margin-top:2rem;display:block;opacity:0.5;transition:all 200ms;filter:grayscale(100%);}.pdoc .attribution:hover{opacity:1;filter:grayscale(0%);}.pdoc .attribution img{margin-left:5px;height:35px;vertical-align:middle;width:70px;transition:all 200ms;}.pdoc table{display:block;width:max-content;max-width:100%;overflow:auto;margin-bottom:1rem;}.pdoc table th{font-weight:600;}.pdoc table th, .pdoc table td{padding:6px 13px;border:1px solid var(--accent2);}</style>
    <style>/*! custom.css */</style></head>
<body>
    <nav class="pdoc">
        <label id="navtoggle" for="togglestate" class="pdoc-button"><svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'><path stroke-linecap='round' stroke="currentColor" stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/></svg></label>
        <input id="togglestate" type="checkbox" aria-hidden="true" tabindex="-1">
        <div>            <a class="pdoc-button module-list-button" href="../relocation_impact_analyzer.html">
<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-box-arrow-in-left" viewBox="0 0 16 16">
  <path fill-rule="evenodd" d="M10 3.5a.5.5 0 0 0-.5-.5h-8a.5.5 0 0 0-.5.5v9a.5.5 0 0 0 .5.5h8a.5.5 0 0 0 .5-.5v-2a.5.5 0 0 1 1 0v2A1.5 1.5 0 0 1 9.5 14h-8A1.5 1.5 0 0 1 0 12.5v-9A1.5 1.5 0 0 1 1.5 2h8A1.5 1.5 0 0 1 11 3.5v2a.5.5 0 0 1-1 0v-2z"/>
  <path fill-rule="evenodd" d="M4.146 8.354a.5.5 0 0 1 0-.708l3-3a.5.5 0 1 1 .708.708L5.707 7.5H14.5a.5.5 0 0 1 0 1H5.707l2.147 2.146a.5.5 0 0 1-.708.708l-3-3z"/>
</svg>                &nbsp;relocation_impact_analyzer</a>


            <input type="search" placeholder="Search..." role="searchbox" aria-label="search"
                   pattern=".+" required>



            <h2>API Documentation</h2>
                <ul class="memberlist">
            <li>
                    <a class="class" href="#Analyzer">Analyzer</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#Analyzer.__init__">Analyzer</a>
                        </li>
                        <li>
                                <a class="variable" href="#Analyzer.api_rate_limit">api_rate_limit</a>
                        </li>
                        <li>
                                <a class="variable" href="#Analyzer.sleep_time">sleep_time</a>
                        </li>
                        <li>
                                <a class="variable" href="#Analyzer.last_call">last_call</a>
                        </li>
                        <li>
                                <a class="variable" href="#Analyzer.gAPI">gAPI</a>
                        </li>
                        <li>
                                <a class="variable" href="#Analyzer.gAPI_key">gAPI_key</a>
                        </li>
                        <li>
                                <a class="variable" href="#Analyzer.analysis_phase">analysis_phase</a>
                        </li>
                        <li>
                                <a class="variable" href="#Analyzer.env_file">env_file</a>
                        </li>
                        <li>
                                <a class="variable" href="#Analyzer.project_directory">project_directory</a>
                        </li>
                        <li>
                                <a class="variable" href="#Analyzer.project">project</a>
                        </li>
                        <li>
                                <a class="variable" href="#Analyzer.graphing">graphing</a>
                        </li>
                        <li>
                                <a class="function" href="#Analyzer.load_graphs">load_graphs</a>
                        </li>
                        <li>
                                <a class="function" href="#Analyzer.sleepif">sleepif</a>
                        </li>
                        <li>
                                <a class="function" href="#Analyzer.log_error">log_error</a>
                        </li>
                        <li>
                                <a class="function" href="#Analyzer.save_env">save_env</a>
                        </li>
                        <li>
                                <a class="function" href="#Analyzer.list_projects">list_projects</a>
                        </li>
                        <li>
                                <a class="function" href="#Analyzer.create_project">create_project</a>
                        </li>
                        <li>
                                <a class="function" href="#Analyzer.load_project">load_project</a>
                        </li>
                        <li>
                                <a class="function" href="#Analyzer.update_analysis_phase">update_analysis_phase</a>
                        </li>
                        <li>
                                <a class="function" href="#Analyzer.convert_addresses_to_gps">convert_addresses_to_gps</a>
                        </li>
                        <li>
                                <a class="function" href="#Analyzer.fuzz_employee_gps">fuzz_employee_gps</a>
                        </li>
                        <li>
                                <a class="function" href="#Analyzer.get_commute_data">get_commute_data</a>
                        </li>
                        <li>
                                <a class="function" href="#Analyzer.convert_stringtime_to_minutes">convert_stringtime_to_minutes</a>
                        </li>
                        <li>
                                <a class="function" href="#Analyzer.convert_stringdistance_to_d">convert_stringdistance_to_d</a>
                        </li>
                        <li>
                                <a class="function" href="#Analyzer.get_commute_cost">get_commute_cost</a>
                        </li>
                        <li>
                                <a class="function" href="#Analyzer.get_commute_emissions">get_commute_emissions</a>
                        </li>
                        <li>
                                <a class="function" href="#Analyzer.get_traffic_regime">get_traffic_regime</a>
                        </li>
                        <li>
                                <a class="function" href="#Analyzer.get_traffic_emissions_factor">get_traffic_emissions_factor</a>
                        </li>
                        <li>
                                <a class="function" href="#Analyzer.handle_GAPI_exception">handle_GAPI_exception</a>
                        </li>
                        <li>
                                <a class="function" href="#Analyzer.generate_graphs">generate_graphs</a>
                        </li>
                        <li>
                                <a class="function" href="#Analyzer.generate_tables">generate_tables</a>
                        </li>
                        <li>
                                <a class="function" href="#Analyzer.get_attrition_analysis">get_attrition_analysis</a>
                        </li>
                        <li>
                                <a class="function" href="#Analyzer.get_emissions_analysis">get_emissions_analysis</a>
                        </li>
                </ul>

            </li>
    </ul>



        <a class="attribution" title="pdoc: Python API documentation generator" href="https://pdoc.dev" target="_blank">
            built with <span class="visually-hidden">pdoc</span><img
                alt="pdoc logo"
                src="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20role%3D%22img%22%20aria-label%3D%22pdoc%20logo%22%20width%3D%22300%22%20height%3D%22150%22%20viewBox%3D%22-1%200%2060%2030%22%3E%3Ctitle%3Epdoc%3C/title%3E%3Cpath%20d%3D%22M29.621%2021.293c-.011-.273-.214-.475-.511-.481a.5.5%200%200%200-.489.503l-.044%201.393c-.097.551-.695%201.215-1.566%201.704-.577.428-1.306.486-2.193.182-1.426-.617-2.467-1.654-3.304-2.487l-.173-.172a3.43%203.43%200%200%200-.365-.306.49.49%200%200%200-.286-.196c-1.718-1.06-4.931-1.47-7.353.191l-.219.15c-1.707%201.187-3.413%202.131-4.328%201.03-.02-.027-.49-.685-.141-1.763.233-.721.546-2.408.772-4.076.042-.09.067-.187.046-.288.166-1.347.277-2.625.241-3.351%201.378-1.008%202.271-2.586%202.271-4.362%200-.976-.272-1.935-.788-2.774-.057-.094-.122-.18-.184-.268.033-.167.052-.339.052-.516%200-1.477-1.202-2.679-2.679-2.679-.791%200-1.496.352-1.987.9a6.3%206.3%200%200%200-1.001.029c-.492-.564-1.207-.929-2.012-.929-1.477%200-2.679%201.202-2.679%202.679A2.65%202.65%200%200%200%20.97%206.554c-.383.747-.595%201.572-.595%202.41%200%202.311%201.507%204.29%203.635%205.107-.037.699-.147%202.27-.423%203.294l-.137.461c-.622%202.042-2.515%208.257%201.727%2010.643%201.614.908%203.06%201.248%204.317%201.248%202.665%200%204.492-1.524%205.322-2.401%201.476-1.559%202.886-1.854%206.491.82%201.877%201.393%203.514%201.753%204.861%201.068%202.223-1.713%202.811-3.867%203.399-6.374.077-.846.056-1.469.054-1.537zm-4.835%204.313c-.054.305-.156.586-.242.629-.034-.007-.131-.022-.307-.157-.145-.111-.314-.478-.456-.908.221.121.432.25.675.355.115.039.219.051.33.081zm-2.251-1.238c-.05.33-.158.648-.252.694-.022.001-.125-.018-.307-.157-.217-.166-.488-.906-.639-1.573.358.344.754.693%201.198%201.036zm-3.887-2.337c-.006-.116-.018-.231-.041-.342.635.145%201.189.368%201.599.625.097.231.166.481.174.642-.03.049-.055.101-.067.158-.046.013-.128.026-.298.004-.278-.037-.901-.57-1.367-1.087zm-1.127-.497c.116.306.176.625.12.71-.019.014-.117.045-.345.016-.206-.027-.604-.332-.986-.695.41-.051.816-.056%201.211-.031zm-4.535%201.535c.209.22.379.47.358.598-.006.041-.088.138-.351.234-.144.055-.539-.063-.979-.259a11.66%2011.66%200%200%200%20.972-.573zm.983-.664c.359-.237.738-.418%201.126-.554.25.237.479.548.457.694-.006.042-.087.138-.351.235-.174.064-.694-.105-1.232-.375zm-3.381%201.794c-.022.145-.061.29-.149.401-.133.166-.358.248-.69.251h-.002c-.133%200-.306-.26-.45-.621.417.091.854.07%201.291-.031zm-2.066-8.077a4.78%204.78%200%200%201-.775-.584c.172-.115.505-.254.88-.378l-.105.962zm-.331%202.302a10.32%2010.32%200%200%201-.828-.502c.202-.143.576-.328.984-.49l-.156.992zm-.45%202.157l-.701-.403c.214-.115.536-.249.891-.376a11.57%2011.57%200%200%201-.19.779zm-.181%201.716c.064.398.194.702.298.893-.194-.051-.435-.162-.736-.398.061-.119.224-.3.438-.495zM8.87%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zm-.735-.389a1.15%201.15%200%200%200-.314.783%201.16%201.16%200%200%200%201.162%201.162c.457%200%20.842-.27%201.032-.653.026.117.042.238.042.362a1.68%201.68%200%200%201-1.679%201.679%201.68%201.68%200%200%201-1.679-1.679c0-.843.626-1.535%201.436-1.654zM5.059%205.406A1.68%201.68%200%200%201%203.38%207.085a1.68%201.68%200%200%201-1.679-1.679c0-.037.009-.072.011-.109.21.3.541.508.935.508a1.16%201.16%200%200%200%201.162-1.162%201.14%201.14%200%200%200-.474-.912c.015%200%20.03-.005.045-.005.926.001%201.679.754%201.679%201.68zM3.198%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zM1.375%208.964c0-.52.103-1.035.288-1.52.466.394%201.06.64%201.717.64%201.144%200%202.116-.725%202.499-1.738.383%201.012%201.355%201.738%202.499%201.738.867%200%201.631-.421%202.121-1.062.307.605.478%201.267.478%201.942%200%202.486-2.153%204.51-4.801%204.51s-4.801-2.023-4.801-4.51zm24.342%2019.349c-.985.498-2.267.168-3.813-.979-3.073-2.281-5.453-3.199-7.813-.705-1.315%201.391-4.163%203.365-8.423.97-3.174-1.786-2.239-6.266-1.261-9.479l.146-.492c.276-1.02.395-2.457.444-3.268a6.11%206.11%200%200%200%201.18.115%206.01%206.01%200%200%200%202.536-.562l-.006.175c-.802.215-1.848.612-2.021%201.25-.079.295.021.601.274.837.219.203.415.364.598.501-.667.304-1.243.698-1.311%201.179-.02.144-.022.507.393.787.213.144.395.26.564.365-1.285.521-1.361.96-1.381%201.126-.018.142-.011.496.427.746l.854.489c-.473.389-.971.914-.999%201.429-.018.278.095.532.316.713.675.556%201.231.721%201.653.721.059%200%20.104-.014.158-.02.207.707.641%201.64%201.513%201.64h.013c.8-.008%201.236-.345%201.462-.626.173-.216.268-.457.325-.692.424.195.93.374%201.372.374.151%200%20.294-.021.423-.068.732-.27.944-.704.993-1.021.009-.061.003-.119.002-.179.266.086.538.147.789.147.15%200%20.294-.021.423-.069.542-.2.797-.489.914-.754.237.147.478.258.704.288.106.014.205.021.296.021.356%200%20.595-.101.767-.229.438.435%201.094.992%201.656%201.067.106.014.205.021.296.021a1.56%201.56%200%200%200%20.323-.035c.17.575.453%201.289.866%201.605.358.273.665.362.914.362a.99.99%200%200%200%20.421-.093%201.03%201.03%200%200%200%20.245-.164c.168.428.39.846.68%201.068.358.273.665.362.913.362a.99.99%200%200%200%20.421-.093c.317-.148.512-.448.639-.762.251.157.495.257.726.257.127%200%20.25-.024.37-.071.427-.17.706-.617.841-1.314.022-.015.047-.022.068-.038.067-.051.133-.104.196-.159-.443%201.486-1.107%202.761-2.086%203.257zM8.66%209.925a.5.5%200%201%200-1%200c0%20.653-.818%201.205-1.787%201.205s-1.787-.552-1.787-1.205a.5.5%200%201%200-1%200c0%201.216%201.25%202.205%202.787%202.205s2.787-.989%202.787-2.205zm4.4%2015.965l-.208.097c-2.661%201.258-4.708%201.436-6.086.527-1.542-1.017-1.88-3.19-1.844-4.198a.4.4%200%200%200-.385-.414c-.242-.029-.406.164-.414.385-.046%201.249.367%203.686%202.202%204.896.708.467%201.547.7%202.51.7%201.248%200%202.706-.392%204.362-1.174l.185-.086a.4.4%200%200%200%20.205-.527c-.089-.204-.326-.291-.527-.206zM9.547%202.292c.093.077.205.114.317.114a.5.5%200%200%200%20.318-.886L8.817.397a.5.5%200%200%200-.703.068.5.5%200%200%200%20.069.703l1.364%201.124zm-7.661-.065c.086%200%20.173-.022.253-.068l1.523-.893a.5.5%200%200%200-.506-.863l-1.523.892a.5.5%200%200%200-.179.685c.094.158.261.247.432.247z%22%20transform%3D%22matrix%28-1%200%200%201%2058%200%29%22%20fill%3D%22%233bb300%22/%3E%3Cpath%20d%3D%22M.3%2021.86V10.18q0-.46.02-.68.04-.22.18-.5.28-.54%201.34-.54%201.06%200%201.42.28.38.26.44.78.76-1.04%202.38-1.04%201.64%200%203.1%201.54%201.46%201.54%201.46%203.58%200%202.04-1.46%203.58-1.44%201.54-3.08%201.54-1.64%200-2.38-.92v4.04q0%20.46-.04.68-.02.22-.18.5-.14.3-.5.42-.36.12-.98.12-.62%200-1-.12-.36-.12-.52-.4-.14-.28-.18-.5-.02-.22-.02-.68zm3.96-9.42q-.46.54-.46%201.18%200%20.64.46%201.18.48.52%201.2.52.74%200%201.24-.52.52-.52.52-1.18%200-.66-.48-1.18-.48-.54-1.26-.54-.76%200-1.22.54zm14.741-8.36q.16-.3.54-.42.38-.12%201-.12.64%200%201.02.12.38.12.52.42.16.3.18.54.04.22.04.68v11.94q0%20.46-.04.7-.02.22-.18.5-.3.54-1.7.54-1.38%200-1.54-.98-.84.96-2.34.96-1.8%200-3.28-1.56-1.48-1.58-1.48-3.66%200-2.1%201.48-3.68%201.5-1.58%203.28-1.58%201.48%200%202.3%201v-4.2q0-.46.02-.68.04-.24.18-.52zm-3.24%2010.86q.52.54%201.26.54.74%200%201.22-.54.5-.54.5-1.18%200-.66-.48-1.22-.46-.56-1.26-.56-.8%200-1.28.56-.48.54-.48%201.2%200%20.66.52%201.2zm7.833-1.2q0-2.4%201.68-3.96%201.68-1.56%203.84-1.56%202.16%200%203.82%201.56%201.66%201.54%201.66%203.94%200%201.66-.86%202.96-.86%201.28-2.1%201.9-1.22.6-2.54.6-1.32%200-2.56-.64-1.24-.66-2.1-1.92-.84-1.28-.84-2.88zm4.18%201.44q.64.48%201.3.48.66%200%201.32-.5.66-.5.66-1.48%200-.98-.62-1.46-.62-.48-1.34-.48-.72%200-1.34.5-.62.5-.62%201.48%200%20.96.64%201.46zm11.412-1.44q0%20.84.56%201.32.56.46%201.18.46.64%200%201.18-.36.56-.38.9-.38.6%200%201.46%201.06.46.58.46%201.04%200%20.76-1.1%201.42-1.14.8-2.8.8-1.86%200-3.58-1.34-.82-.64-1.34-1.7-.52-1.08-.52-2.36%200-1.3.52-2.34.52-1.06%201.34-1.7%201.66-1.32%203.54-1.32.76%200%201.48.22.72.2%201.06.4l.32.2q.36.24.56.38.52.4.52.92%200%20.5-.42%201.14-.72%201.1-1.38%201.1-.38%200-1.08-.44-.36-.34-1.04-.34-.66%200-1.24.48-.58.48-.58%201.34z%22%20fill%3D%22green%22/%3E%3C/svg%3E"/>
        </a>
</div>
    </nav>
    <main class="pdoc">
            <section class="module-info">
                    <h1 class="modulename">
<a href="./../relocation_impact_analyzer.html">relocation_impact_analyzer</a><wbr>.analyzer    </h1>

                        <div class="docstring"><p>Analyser Class</p>

<p>Author: Victor Foulk
License: MIT License
Date: 2024-03-15
Version: 0.0.1 Pre-Alpha</p>

<p>The Analyzer class is the central component of the Relocation Impact Analyzer tool. It orchestrates various analyses related to the impacts of office relocations, including geocoding addresses, analyzing commute patterns, and generating graphical representations of the data. This class leverages external APIs, custom data handling, and graphical libraries to perform a comprehensive analysis tailored to the needs of strategic decision-making regarding office locations.</p>

<p>Key functionalities include:</p>

<ul>
<li>Geocoding addresses to latitude and longitude.</li>
<li>Generating employee commute data and associated costs and emissions.</li>
<li>Fuzzing GPS data to anonymize employee locations.</li>
<li>Calculating commute costs and emissions based on commute data.</li>
<li>Generating visual representations of analyzed data for easier interpretation.</li>
</ul>

<p>This class is designed with modularity and reusability in mind, allowing for flexible adaptation and expansion to meet the evolving requirements of relocation impact analysis.</p>
</div>

                        <input id="mod-analyzer-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">

                        <label class="view-source-button" for="mod-analyzer-view-source"><span>View Source</span></label>

                        <div class="pdoc-code codehilite"><pre><span></span><span id="L-1"><a href="#L-1"><span class="linenos">   1</span></a><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-2"><a href="#L-2"><span class="linenos">   2</span></a><span class="sd">Analyser Class</span>
</span><span id="L-3"><a href="#L-3"><span class="linenos">   3</span></a>
</span><span id="L-4"><a href="#L-4"><span class="linenos">   4</span></a><span class="sd">Author: Victor Foulk</span>
</span><span id="L-5"><a href="#L-5"><span class="linenos">   5</span></a><span class="sd">License: MIT License</span>
</span><span id="L-6"><a href="#L-6"><span class="linenos">   6</span></a><span class="sd">Date: 2024-03-15</span>
</span><span id="L-7"><a href="#L-7"><span class="linenos">   7</span></a><span class="sd">Version: 0.0.1 Pre-Alpha</span>
</span><span id="L-8"><a href="#L-8"><span class="linenos">   8</span></a>
</span><span id="L-9"><a href="#L-9"><span class="linenos">   9</span></a><span class="sd">The Analyzer class is the central component of the Relocation Impact Analyzer tool. It orchestrates various analyses related to the impacts of office relocations, including geocoding addresses, analyzing commute patterns, and generating graphical representations of the data. This class leverages external APIs, custom data handling, and graphical libraries to perform a comprehensive analysis tailored to the needs of strategic decision-making regarding office locations.</span>
</span><span id="L-10"><a href="#L-10"><span class="linenos">  10</span></a>
</span><span id="L-11"><a href="#L-11"><span class="linenos">  11</span></a><span class="sd">Key functionalities include:</span>
</span><span id="L-12"><a href="#L-12"><span class="linenos">  12</span></a><span class="sd">- Geocoding addresses to latitude and longitude.</span>
</span><span id="L-13"><a href="#L-13"><span class="linenos">  13</span></a><span class="sd">- Generating employee commute data and associated costs and emissions.</span>
</span><span id="L-14"><a href="#L-14"><span class="linenos">  14</span></a><span class="sd">- Fuzzing GPS data to anonymize employee locations.</span>
</span><span id="L-15"><a href="#L-15"><span class="linenos">  15</span></a><span class="sd">- Calculating commute costs and emissions based on commute data.</span>
</span><span id="L-16"><a href="#L-16"><span class="linenos">  16</span></a><span class="sd">- Generating visual representations of analyzed data for easier interpretation.</span>
</span><span id="L-17"><a href="#L-17"><span class="linenos">  17</span></a>
</span><span id="L-18"><a href="#L-18"><span class="linenos">  18</span></a><span class="sd">This class is designed with modularity and reusability in mind, allowing for flexible adaptation and expansion to meet the evolving requirements of relocation impact analysis.</span>
</span><span id="L-19"><a href="#L-19"><span class="linenos">  19</span></a><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-20"><a href="#L-20"><span class="linenos">  20</span></a><span class="kn">import</span> <span class="nn">os</span>
</span><span id="L-21"><a href="#L-21"><span class="linenos">  21</span></a><span class="kn">from</span> <span class="nn">relocation_impact_analyzer.project</span> <span class="kn">import</span> <span class="n">Project</span>
</span><span id="L-22"><a href="#L-22"><span class="linenos">  22</span></a><span class="kn">from</span> <span class="nn">relocation_impact_analyzer.g_api</span> <span class="kn">import</span> <span class="n">GAPI</span>
</span><span id="L-23"><a href="#L-23"><span class="linenos">  23</span></a><span class="kn">from</span> <span class="nn">relocation_impact_analyzer.graphing</span> <span class="kn">import</span> <span class="n">Graphing</span>
</span><span id="L-24"><a href="#L-24"><span class="linenos">  24</span></a>
</span><span id="L-25"><a href="#L-25"><span class="linenos">  25</span></a><span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">timedelta</span>
</span><span id="L-26"><a href="#L-26"><span class="linenos">  26</span></a><span class="kn">import</span> <span class="nn">re</span>
</span><span id="L-27"><a href="#L-27"><span class="linenos">  27</span></a><span class="kn">from</span> <span class="nn">dotenv</span> <span class="kn">import</span> <span class="n">load_dotenv</span><span class="p">,</span> <span class="n">set_key</span>
</span><span id="L-28"><a href="#L-28"><span class="linenos">  28</span></a><span class="kn">from</span> <span class="nn">time</span> <span class="kn">import</span> <span class="n">sleep</span>
</span><span id="L-29"><a href="#L-29"><span class="linenos">  29</span></a><span class="kn">import</span> <span class="nn">json</span>
</span><span id="L-30"><a href="#L-30"><span class="linenos">  30</span></a><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
</span><span id="L-31"><a href="#L-31"><span class="linenos">  31</span></a><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</span><span id="L-32"><a href="#L-32"><span class="linenos">  32</span></a><span class="kn">import</span> <span class="nn">numpy_financial</span> <span class="k">as</span> <span class="nn">npf</span>
</span><span id="L-33"><a href="#L-33"><span class="linenos">  33</span></a><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">mplt</span>
</span><span id="L-34"><a href="#L-34"><span class="linenos">  34</span></a><span class="kn">from</span> <span class="nn">matplotlib.lines</span> <span class="kn">import</span> <span class="n">Line2D</span>                
</span><span id="L-35"><a href="#L-35"><span class="linenos">  35</span></a>
</span><span id="L-36"><a href="#L-36"><span class="linenos">  36</span></a><span class="k">class</span> <span class="nc">Analyzer</span><span class="p">:</span>
</span><span id="L-37"><a href="#L-37"><span class="linenos">  37</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">proj</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">project_directory</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">env_file</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
</span><span id="L-38"><a href="#L-38"><span class="linenos">  38</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-39"><a href="#L-39"><span class="linenos">  39</span></a><span class="sd">        Initializes the Analyzer with specified project details and configuration.</span>
</span><span id="L-40"><a href="#L-40"><span class="linenos">  40</span></a>
</span><span id="L-41"><a href="#L-41"><span class="linenos">  41</span></a><span class="sd">        Args:</span>
</span><span id="L-42"><a href="#L-42"><span class="linenos">  42</span></a><span class="sd">            proj (str, optional): The name of the project to load or create. Defaults to None.</span>
</span><span id="L-43"><a href="#L-43"><span class="linenos">  43</span></a><span class="sd">            project_directory (str, optional): The directory where project files are stored. Defaults to None.</span>
</span><span id="L-44"><a href="#L-44"><span class="linenos">  44</span></a><span class="sd">            env_file (str, optional): Path to a .env file for loading configuration variables. Defaults to an empty string.</span>
</span><span id="L-45"><a href="#L-45"><span class="linenos">  45</span></a>
</span><span id="L-46"><a href="#L-46"><span class="linenos">  46</span></a><span class="sd">        Raises:</span>
</span><span id="L-47"><a href="#L-47"><span class="linenos">  47</span></a><span class="sd">            ValueError: If the specified project directory does not exist or no .env file is provided when expected.</span>
</span><span id="L-48"><a href="#L-48"><span class="linenos">  48</span></a><span class="sd">        </span>
</span><span id="L-49"><a href="#L-49"><span class="linenos">  49</span></a><span class="sd">        This constructor sets up the API rate limiting, loads the .env configuration, initializes the Google API client,</span>
</span><span id="L-50"><a href="#L-50"><span class="linenos">  50</span></a><span class="sd">        and prepares the project directory and graphs subdirectory as needed.</span>
</span><span id="L-51"><a href="#L-51"><span class="linenos">  51</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-52"><a href="#L-52"><span class="linenos">  52</span></a>
</span><span id="L-53"><a href="#L-53"><span class="linenos">  53</span></a>        <span class="c1"># api rate limit is 3000 requests per minute, we see errors at 1000 requests per minute, so we limit to 300 per minute</span>
</span><span id="L-54"><a href="#L-54"><span class="linenos">  54</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">api_rate_limit</span> <span class="o">=</span> <span class="mi">300</span>
</span><span id="L-55"><a href="#L-55"><span class="linenos">  55</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">sleep_time</span> <span class="o">=</span> <span class="mi">60</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">api_rate_limit</span>
</span><span id="L-56"><a href="#L-56"><span class="linenos">  56</span></a>        <span class="c1"># create a last call variable, set it to a time in the past</span>
</span><span id="L-57"><a href="#L-57"><span class="linenos">  57</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">last_call</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span> <span class="o">-</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">seconds</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sleep_time</span><span class="p">)</span>
</span><span id="L-58"><a href="#L-58"><span class="linenos">  58</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gAPI</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-59"><a href="#L-59"><span class="linenos">  59</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gAPI_key</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="L-60"><a href="#L-60"><span class="linenos">  60</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">analysis_phase</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-61"><a href="#L-61"><span class="linenos">  61</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">env_file</span> <span class="o">=</span> <span class="n">env_file</span>
</span><span id="L-62"><a href="#L-62"><span class="linenos">  62</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">project_directory</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-63"><a href="#L-63"><span class="linenos">  63</span></a>        <span class="c1"># load the .env file if it exists</span>
</span><span id="L-64"><a href="#L-64"><span class="linenos">  64</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">env_file</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">env_file</span><span class="p">):</span>
</span><span id="L-65"><a href="#L-65"><span class="linenos">  65</span></a>            <span class="n">load_dotenv</span><span class="p">(</span><span class="n">env_file</span><span class="p">,</span><span class="n">override</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-66"><a href="#L-66"><span class="linenos">  66</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-67"><a href="#L-67"><span class="linenos">  67</span></a>            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">env_file</span><span class="p">):</span>
</span><span id="L-68"><a href="#L-68"><span class="linenos">  68</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;No .env file provided.&quot;</span><span class="p">)</span>
</span><span id="L-69"><a href="#L-69"><span class="linenos">  69</span></a>            <span class="c1"># attempt to load the .env file from the CWD</span>
</span><span id="L-70"><a href="#L-70"><span class="linenos">  70</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">env_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">(),</span> <span class="s2">&quot;.env&quot;</span><span class="p">)</span>
</span><span id="L-71"><a href="#L-71"><span class="linenos">  71</span></a>            <span class="n">load_dotenv</span><span class="p">(</span><span class="n">override</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-72"><a href="#L-72"><span class="linenos">  72</span></a>        <span class="c1"># if the .env has keys, use them, otherwise use the defaults</span>
</span><span id="L-73"><a href="#L-73"><span class="linenos">  73</span></a>        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;GMAPS_API_KEY&quot;</span><span class="p">):</span>
</span><span id="L-74"><a href="#L-74"><span class="linenos">  74</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">gAPI_key</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;GMAPS_API_KEY&quot;</span><span class="p">)</span>
</span><span id="L-75"><a href="#L-75"><span class="linenos">  75</span></a>        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;DEFAULT_PROJECT_DIRECTORY&quot;</span><span class="p">):</span>
</span><span id="L-76"><a href="#L-76"><span class="linenos">  76</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">project_directory</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;DEFAULT_PROJECT_DIRECTORY&quot;</span><span class="p">)</span>
</span><span id="L-77"><a href="#L-77"><span class="linenos">  77</span></a>        <span class="c1"># if a project directory is provided, override .env and use it, otherwise use the default</span>
</span><span id="L-78"><a href="#L-78"><span class="linenos">  78</span></a>        <span class="k">if</span> <span class="n">project_directory</span><span class="p">:</span>
</span><span id="L-79"><a href="#L-79"><span class="linenos">  79</span></a>            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">project_directory</span><span class="p">):</span>
</span><span id="L-80"><a href="#L-80"><span class="linenos">  80</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">project_directory</span> <span class="o">=</span> <span class="n">project_directory</span>
</span><span id="L-81"><a href="#L-81"><span class="linenos">  81</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-82"><a href="#L-82"><span class="linenos">  82</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Project directory does not exist.&quot;</span><span class="p">)</span>
</span><span id="L-83"><a href="#L-83"><span class="linenos">  83</span></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">project_directory</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-84"><a href="#L-84"><span class="linenos">  84</span></a>            <span class="c1"># use the CWD for now</span>
</span><span id="L-85"><a href="#L-85"><span class="linenos">  85</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">project_directory</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="vm">__file__</span><span class="p">),</span> <span class="s2">&quot;projects&quot;</span><span class="p">)</span>
</span><span id="L-86"><a href="#L-86"><span class="linenos">  86</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">project</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-87"><a href="#L-87"><span class="linenos">  87</span></a>        <span class="c1"># if a project called for, load or create it        </span>
</span><span id="L-88"><a href="#L-88"><span class="linenos">  88</span></a>        <span class="k">if</span> <span class="n">proj</span><span class="p">:</span>
</span><span id="L-89"><a href="#L-89"><span class="linenos">  89</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">project</span> <span class="o">=</span> <span class="n">Project</span><span class="p">(</span><span class="n">proj</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">project_directory</span><span class="p">)</span>
</span><span id="L-90"><a href="#L-90"><span class="linenos">  90</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-91"><a href="#L-91"><span class="linenos">  91</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">project</span> <span class="o">=</span> <span class="n">Project</span><span class="p">(</span> <span class="kc">None</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">project_directory</span><span class="p">)</span>
</span><span id="L-92"><a href="#L-92"><span class="linenos">  92</span></a>        <span class="c1"># if a project is loaded, check for a subdirectory called &quot;plots&quot; in the project folder, </span>
</span><span id="L-93"><a href="#L-93"><span class="linenos">  93</span></a>            <span class="c1"># create it if it doesn&#39;t exist, then list the plot .png filenames</span>
</span><span id="L-94"><a href="#L-94"><span class="linenos">  94</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">load_graphs</span><span class="p">()</span>
</span><span id="L-95"><a href="#L-95"><span class="linenos">  95</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">graphing</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-96"><a href="#L-96"><span class="linenos">  96</span></a>        <span class="c1"># update the analysis phase</span>
</span><span id="L-97"><a href="#L-97"><span class="linenos">  97</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">update_analysis_phase</span><span class="p">()</span>
</span><span id="L-98"><a href="#L-98"><span class="linenos">  98</span></a>        <span class="k">return</span> <span class="kc">None</span>
</span><span id="L-99"><a href="#L-99"><span class="linenos">  99</span></a>
</span><span id="L-100"><a href="#L-100"><span class="linenos"> 100</span></a>    <span class="k">def</span> <span class="nf">load_graphs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-101"><a href="#L-101"><span class="linenos"> 101</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-102"><a href="#L-102"><span class="linenos"> 102</span></a><span class="sd">        Loads the list of graph filenames from the project&#39;s &#39;plots&#39; directory.</span>
</span><span id="L-103"><a href="#L-103"><span class="linenos"> 103</span></a>
</span><span id="L-104"><a href="#L-104"><span class="linenos"> 104</span></a><span class="sd">        This method checks if the &#39;plots&#39; subdirectory exists within the current project directory. </span>
</span><span id="L-105"><a href="#L-105"><span class="linenos"> 105</span></a><span class="sd">        If it doesn&#39;t exist, it creates the directory. It then updates the instance variable with a list of .png filenames </span>
</span><span id="L-106"><a href="#L-106"><span class="linenos"> 106</span></a><span class="sd">        found in the &#39;plots&#39; directory.</span>
</span><span id="L-107"><a href="#L-107"><span class="linenos"> 107</span></a>
</span><span id="L-108"><a href="#L-108"><span class="linenos"> 108</span></a><span class="sd">        Returns:</span>
</span><span id="L-109"><a href="#L-109"><span class="linenos"> 109</span></a><span class="sd">            bool: True if the project has a &#39;plots&#39; directory, False otherwise.</span>
</span><span id="L-110"><a href="#L-110"><span class="linenos"> 110</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-111"><a href="#L-111"><span class="linenos"> 111</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">project_name</span> <span class="o">!=</span><span class="s2">&quot;&quot;</span><span class="p">:</span>
</span><span id="L-112"><a href="#L-112"><span class="linenos"> 112</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project_directory</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">project_name</span><span class="p">,</span> <span class="s2">&quot;plots&quot;</span><span class="p">)):</span>
</span><span id="L-113"><a href="#L-113"><span class="linenos"> 113</span></a>                <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project_directory</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">project_name</span><span class="p">,</span> <span class="s2">&quot;plots&quot;</span><span class="p">))</span>
</span><span id="L-114"><a href="#L-114"><span class="linenos"> 114</span></a>            <span class="c1"># load the list of .png filenames into a self.graphs attribute only if they are .png files</span>
</span><span id="L-115"><a href="#L-115"><span class="linenos"> 115</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">graphs</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project_directory</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">project_name</span><span class="p">,</span> <span class="s2">&quot;plots&quot;</span><span class="p">))</span> <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.png&#39;</span><span class="p">)]</span>
</span><span id="L-116"><a href="#L-116"><span class="linenos"> 116</span></a>            <span class="k">return</span> <span class="kc">True</span>
</span><span id="L-117"><a href="#L-117"><span class="linenos"> 117</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-118"><a href="#L-118"><span class="linenos"> 118</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">graphs</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-119"><a href="#L-119"><span class="linenos"> 119</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="L-120"><a href="#L-120"><span class="linenos"> 120</span></a>
</span><span id="L-121"><a href="#L-121"><span class="linenos"> 121</span></a>    <span class="k">def</span> <span class="nf">sleepif</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-122"><a href="#L-122"><span class="linenos"> 122</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-123"><a href="#L-123"><span class="linenos"> 123</span></a><span class="sd">        Ensures adherence to the API rate limit by sleeping if the time since the last API call is less than the required wait time.</span>
</span><span id="L-124"><a href="#L-124"><span class="linenos"> 124</span></a>
</span><span id="L-125"><a href="#L-125"><span class="linenos"> 125</span></a><span class="sd">        This method calculates the time elapsed since the last API call and pauses execution for the remainder of the time needed to </span>
</span><span id="L-126"><a href="#L-126"><span class="linenos"> 126</span></a><span class="sd">        comply with the set rate limit, ensuring that API requests do not exceed the prescribed rate.</span>
</span><span id="L-127"><a href="#L-127"><span class="linenos"> 127</span></a>
</span><span id="L-128"><a href="#L-128"><span class="linenos"> 128</span></a><span class="sd">        Returns:</span>
</span><span id="L-129"><a href="#L-129"><span class="linenos"> 129</span></a><span class="sd">            None</span>
</span><span id="L-130"><a href="#L-130"><span class="linenos"> 130</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-131"><a href="#L-131"><span class="linenos"> 131</span></a>        <span class="c1"># if the delta between the current time and the last call is less than the sleep time, sleep for the difference</span>
</span><span id="L-132"><a href="#L-132"><span class="linenos"> 132</span></a>        <span class="k">if</span> <span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_call</span><span class="p">)</span><span class="o">.</span><span class="n">seconds</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">sleep_time</span><span class="p">:</span>
</span><span id="L-133"><a href="#L-133"><span class="linenos"> 133</span></a>            <span class="n">sleep</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sleep_time</span> <span class="o">-</span> <span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_call</span><span class="p">)</span><span class="o">.</span><span class="n">seconds</span><span class="p">)</span>
</span><span id="L-134"><a href="#L-134"><span class="linenos"> 134</span></a>        <span class="k">return</span> <span class="kc">None</span>
</span><span id="L-135"><a href="#L-135"><span class="linenos"> 135</span></a>
</span><span id="L-136"><a href="#L-136"><span class="linenos"> 136</span></a>    <span class="k">def</span> <span class="nf">log_error</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">):</span>
</span><span id="L-137"><a href="#L-137"><span class="linenos"> 137</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-138"><a href="#L-138"><span class="linenos"> 138</span></a><span class="sd">        Logs an error message to the &#39;error_log.txt&#39; file.</span>
</span><span id="L-139"><a href="#L-139"><span class="linenos"> 139</span></a>
</span><span id="L-140"><a href="#L-140"><span class="linenos"> 140</span></a><span class="sd">        Appends the provided message to a log file dedicated to errors, facilitating debugging and error tracking over time.</span>
</span><span id="L-141"><a href="#L-141"><span class="linenos"> 141</span></a>
</span><span id="L-142"><a href="#L-142"><span class="linenos"> 142</span></a><span class="sd">        Args:</span>
</span><span id="L-143"><a href="#L-143"><span class="linenos"> 143</span></a><span class="sd">            message (str): The error message to log.</span>
</span><span id="L-144"><a href="#L-144"><span class="linenos"> 144</span></a>
</span><span id="L-145"><a href="#L-145"><span class="linenos"> 145</span></a><span class="sd">        Returns:</span>
</span><span id="L-146"><a href="#L-146"><span class="linenos"> 146</span></a><span class="sd">            None</span>
</span><span id="L-147"><a href="#L-147"><span class="linenos"> 147</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-148"><a href="#L-148"><span class="linenos"> 148</span></a>        <span class="c1"># append the message to the error.txt log</span>
</span><span id="L-149"><a href="#L-149"><span class="linenos"> 149</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;error_log.txt&quot;</span><span class="p">,</span> <span class="s2">&quot;a&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="L-150"><a href="#L-150"><span class="linenos"> 150</span></a>            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
</span><span id="L-151"><a href="#L-151"><span class="linenos"> 151</span></a>        <span class="k">return</span> <span class="kc">None</span>
</span><span id="L-152"><a href="#L-152"><span class="linenos"> 152</span></a>
</span><span id="L-153"><a href="#L-153"><span class="linenos"> 153</span></a>    <span class="k">def</span> <span class="nf">save_env</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">project_directory</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">gAPI_key</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">env_file</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="L-154"><a href="#L-154"><span class="linenos"> 154</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-155"><a href="#L-155"><span class="linenos"> 155</span></a><span class="sd">        Saves the specified environment variables to the .env file and updates the runtime environment.</span>
</span><span id="L-156"><a href="#L-156"><span class="linenos"> 156</span></a>
</span><span id="L-157"><a href="#L-157"><span class="linenos"> 157</span></a><span class="sd">        This method allows dynamic updating of critical environment variables, including the Google Maps API key and the default project directory. </span>
</span><span id="L-158"><a href="#L-158"><span class="linenos"> 158</span></a><span class="sd">        If any arguments are provided, they override the corresponding instance variables before saving.</span>
</span><span id="L-159"><a href="#L-159"><span class="linenos"> 159</span></a>
</span><span id="L-160"><a href="#L-160"><span class="linenos"> 160</span></a><span class="sd">        Args:</span>
</span><span id="L-161"><a href="#L-161"><span class="linenos"> 161</span></a><span class="sd">            project_directory (str, optional): The directory where project files are stored. If specified, overrides the existing value.</span>
</span><span id="L-162"><a href="#L-162"><span class="linenos"> 162</span></a><span class="sd">            gAPI_key (str, optional): The Google Maps API key. If specified, overrides the existing value.</span>
</span><span id="L-163"><a href="#L-163"><span class="linenos"> 163</span></a><span class="sd">            env_file (str, optional): Path to the .env file. If specified, overrides the existing value.</span>
</span><span id="L-164"><a href="#L-164"><span class="linenos"> 164</span></a>
</span><span id="L-165"><a href="#L-165"><span class="linenos"> 165</span></a><span class="sd">        Raises:</span>
</span><span id="L-166"><a href="#L-166"><span class="linenos"> 166</span></a><span class="sd">            ValueError: If no .env file path is provided.</span>
</span><span id="L-167"><a href="#L-167"><span class="linenos"> 167</span></a>
</span><span id="L-168"><a href="#L-168"><span class="linenos"> 168</span></a><span class="sd">        Returns:</span>
</span><span id="L-169"><a href="#L-169"><span class="linenos"> 169</span></a><span class="sd">            None</span>
</span><span id="L-170"><a href="#L-170"><span class="linenos"> 170</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-171"><a href="#L-171"><span class="linenos"> 171</span></a>        <span class="c1"># if variables specified, override self and then save to .env</span>
</span><span id="L-172"><a href="#L-172"><span class="linenos"> 172</span></a>        <span class="k">if</span> <span class="n">project_directory</span><span class="p">:</span>
</span><span id="L-173"><a href="#L-173"><span class="linenos"> 173</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">project_directory</span> <span class="o">=</span> <span class="n">project_directory</span>
</span><span id="L-174"><a href="#L-174"><span class="linenos"> 174</span></a>        <span class="k">if</span> <span class="n">gAPI_key</span><span class="p">:</span>
</span><span id="L-175"><a href="#L-175"><span class="linenos"> 175</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">gAPI_key</span> <span class="o">=</span> <span class="n">gAPI_key</span>
</span><span id="L-176"><a href="#L-176"><span class="linenos"> 176</span></a>        <span class="k">if</span> <span class="n">env_file</span><span class="p">:</span>
</span><span id="L-177"><a href="#L-177"><span class="linenos"> 177</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">env_file</span> <span class="o">=</span> <span class="n">env_file</span>
</span><span id="L-178"><a href="#L-178"><span class="linenos"> 178</span></a>        <span class="c1"># save the .env file</span>
</span><span id="L-179"><a href="#L-179"><span class="linenos"> 179</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">env_file</span><span class="p">:</span>
</span><span id="L-180"><a href="#L-180"><span class="linenos"> 180</span></a>            <span class="n">set_key</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">env_file</span><span class="p">,</span> <span class="s2">&quot;GMAPS_API_KEY&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gAPI_key</span><span class="p">)</span>
</span><span id="L-181"><a href="#L-181"><span class="linenos"> 181</span></a>            <span class="n">set_key</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">env_file</span><span class="p">,</span> <span class="s2">&quot;DEFAULT_PROJECT_DIRECTORY&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">project_directory</span><span class="p">)</span>
</span><span id="L-182"><a href="#L-182"><span class="linenos"> 182</span></a>
</span><span id="L-183"><a href="#L-183"><span class="linenos"> 183</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-184"><a href="#L-184"><span class="linenos"> 184</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;No .env file provided.&quot;</span><span class="p">)</span>
</span><span id="L-185"><a href="#L-185"><span class="linenos"> 185</span></a>
</span><span id="L-186"><a href="#L-186"><span class="linenos"> 186</span></a>        <span class="c1"># update the current runtime environment</span>
</span><span id="L-187"><a href="#L-187"><span class="linenos"> 187</span></a>        <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;GMAPS_API_KEY&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gAPI_key</span>
</span><span id="L-188"><a href="#L-188"><span class="linenos"> 188</span></a>        <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;DEFAULT_PROJECT_DIRECTORY&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">project_directory</span>
</span><span id="L-189"><a href="#L-189"><span class="linenos"> 189</span></a>
</span><span id="L-190"><a href="#L-190"><span class="linenos"> 190</span></a>    <span class="k">def</span> <span class="nf">list_projects</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-191"><a href="#L-191"><span class="linenos"> 191</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-192"><a href="#L-192"><span class="linenos"> 192</span></a><span class="sd">        Lists all projects within the project directory.</span>
</span><span id="L-193"><a href="#L-193"><span class="linenos"> 193</span></a>
</span><span id="L-194"><a href="#L-194"><span class="linenos"> 194</span></a><span class="sd">        Retrieves the names of all subdirectories within the project directory, treating each as a separate project. </span>
</span><span id="L-195"><a href="#L-195"><span class="linenos"> 195</span></a><span class="sd">        This method is useful for enumerating all available projects for selection or analysis.</span>
</span><span id="L-196"><a href="#L-196"><span class="linenos"> 196</span></a>
</span><span id="L-197"><a href="#L-197"><span class="linenos"> 197</span></a><span class="sd">        Returns:</span>
</span><span id="L-198"><a href="#L-198"><span class="linenos"> 198</span></a><span class="sd">            list: A list of project names (subdirectory names) within the project directory.</span>
</span><span id="L-199"><a href="#L-199"><span class="linenos"> 199</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-200"><a href="#L-200"><span class="linenos"> 200</span></a>        <span class="c1"># list all projects in the project directory</span>
</span><span id="L-201"><a href="#L-201"><span class="linenos"> 201</span></a>        <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project_directory</span><span class="p">)</span>
</span><span id="L-202"><a href="#L-202"><span class="linenos"> 202</span></a>    
</span><span id="L-203"><a href="#L-203"><span class="linenos"> 203</span></a>    <span class="k">def</span> <span class="nf">create_project</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">project_name</span><span class="p">):</span>
</span><span id="L-204"><a href="#L-204"><span class="linenos"> 204</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-205"><a href="#L-205"><span class="linenos"> 205</span></a><span class="sd">        Creates a new project with the specified name.</span>
</span><span id="L-206"><a href="#L-206"><span class="linenos"> 206</span></a>
</span><span id="L-207"><a href="#L-207"><span class="linenos"> 207</span></a><span class="sd">        This method initializes a new `Project` instance and sets it as the current project. It updates the analysis phase </span>
</span><span id="L-208"><a href="#L-208"><span class="linenos"> 208</span></a><span class="sd">        based on the new project&#39;s status.</span>
</span><span id="L-209"><a href="#L-209"><span class="linenos"> 209</span></a>
</span><span id="L-210"><a href="#L-210"><span class="linenos"> 210</span></a><span class="sd">        Args:</span>
</span><span id="L-211"><a href="#L-211"><span class="linenos"> 211</span></a><span class="sd">            project_name (str): The name of the new project to create.</span>
</span><span id="L-212"><a href="#L-212"><span class="linenos"> 212</span></a>
</span><span id="L-213"><a href="#L-213"><span class="linenos"> 213</span></a><span class="sd">        Returns:</span>
</span><span id="L-214"><a href="#L-214"><span class="linenos"> 214</span></a><span class="sd">            bool: True if the project is successfully created, False otherwise.</span>
</span><span id="L-215"><a href="#L-215"><span class="linenos"> 215</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-216"><a href="#L-216"><span class="linenos"> 216</span></a>        <span class="c1"># create a new project</span>
</span><span id="L-217"><a href="#L-217"><span class="linenos"> 217</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">project</span> <span class="o">=</span> <span class="n">Project</span><span class="p">(</span><span class="n">project_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">project_directory</span><span class="p">)</span>
</span><span id="L-218"><a href="#L-218"><span class="linenos"> 218</span></a>        <span class="c1"># update the analysis phase</span>
</span><span id="L-219"><a href="#L-219"><span class="linenos"> 219</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">update_analysis_phase</span><span class="p">()</span>
</span><span id="L-220"><a href="#L-220"><span class="linenos"> 220</span></a>        <span class="k">return</span> <span class="kc">True</span>
</span><span id="L-221"><a href="#L-221"><span class="linenos"> 221</span></a>    
</span><span id="L-222"><a href="#L-222"><span class="linenos"> 222</span></a>    <span class="k">def</span> <span class="nf">load_project</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">project_name</span><span class="p">):</span>
</span><span id="L-223"><a href="#L-223"><span class="linenos"> 223</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-224"><a href="#L-224"><span class="linenos"> 224</span></a><span class="sd">        Loads an existing project by name.</span>
</span><span id="L-225"><a href="#L-225"><span class="linenos"> 225</span></a>
</span><span id="L-226"><a href="#L-226"><span class="linenos"> 226</span></a><span class="sd">        Sets the specified project as the current project, loads any associated graphs, and updates the analysis phase </span>
</span><span id="L-227"><a href="#L-227"><span class="linenos"> 227</span></a><span class="sd">        based on the loaded project&#39;s status.</span>
</span><span id="L-228"><a href="#L-228"><span class="linenos"> 228</span></a>
</span><span id="L-229"><a href="#L-229"><span class="linenos"> 229</span></a><span class="sd">        Args:</span>
</span><span id="L-230"><a href="#L-230"><span class="linenos"> 230</span></a><span class="sd">            project_name (str): The name of the project to load.</span>
</span><span id="L-231"><a href="#L-231"><span class="linenos"> 231</span></a>
</span><span id="L-232"><a href="#L-232"><span class="linenos"> 232</span></a><span class="sd">        Returns:</span>
</span><span id="L-233"><a href="#L-233"><span class="linenos"> 233</span></a><span class="sd">            bool: True if the project is successfully loaded, False otherwise.</span>
</span><span id="L-234"><a href="#L-234"><span class="linenos"> 234</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-235"><a href="#L-235"><span class="linenos"> 235</span></a>     <span class="c1"># load an existing project</span>
</span><span id="L-236"><a href="#L-236"><span class="linenos"> 236</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">project</span> <span class="o">=</span> <span class="n">Project</span><span class="p">(</span><span class="n">project_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">project_directory</span><span class="p">)</span>
</span><span id="L-237"><a href="#L-237"><span class="linenos"> 237</span></a>        <span class="c1"># load the graphs if any</span>
</span><span id="L-238"><a href="#L-238"><span class="linenos"> 238</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">load_graphs</span><span class="p">()</span>
</span><span id="L-239"><a href="#L-239"><span class="linenos"> 239</span></a>        <span class="c1"># update the analysis phase</span>
</span><span id="L-240"><a href="#L-240"><span class="linenos"> 240</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">update_analysis_phase</span><span class="p">()</span>
</span><span id="L-241"><a href="#L-241"><span class="linenos"> 241</span></a>        <span class="k">return</span> <span class="kc">True</span>
</span><span id="L-242"><a href="#L-242"><span class="linenos"> 242</span></a>
</span><span id="L-243"><a href="#L-243"><span class="linenos"> 243</span></a>    <span class="k">def</span> <span class="nf">update_analysis_phase</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-244"><a href="#L-244"><span class="linenos"> 244</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-245"><a href="#L-245"><span class="linenos"> 245</span></a><span class="sd">        Updates the analysis phase based on the current state of the project data.</span>
</span><span id="L-246"><a href="#L-246"><span class="linenos"> 246</span></a>
</span><span id="L-247"><a href="#L-247"><span class="linenos"> 247</span></a><span class="sd">        This method determines the current phase of analysis by checking the availability of specific data files within the project. </span>
</span><span id="L-248"><a href="#L-248"><span class="linenos"> 248</span></a><span class="sd">        The analysis phase is a critical component that guides the workflow and available actions within the current project context.</span>
</span><span id="L-249"><a href="#L-249"><span class="linenos"> 249</span></a>
</span><span id="L-250"><a href="#L-250"><span class="linenos"> 250</span></a><span class="sd">        Returns:</span>
</span><span id="L-251"><a href="#L-251"><span class="linenos"> 251</span></a><span class="sd">            int: The updated analysis phase.</span>
</span><span id="L-252"><a href="#L-252"><span class="linenos"> 252</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-253"><a href="#L-253"><span class="linenos"> 253</span></a>
</span><span id="L-254"><a href="#L-254"><span class="linenos"> 254</span></a>        <span class="c1"># if project is none, phase is zero</span>
</span><span id="L-255"><a href="#L-255"><span class="linenos"> 255</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-256"><a href="#L-256"><span class="linenos"> 256</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">analysis_phase</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-257"><a href="#L-257"><span class="linenos"> 257</span></a>            <span class="k">return</span> <span class="mi">0</span>
</span><span id="L-258"><a href="#L-258"><span class="linenos"> 258</span></a>        <span class="c1"># if there is a project and there is no employee_addresses.csv in the project, phase is 1</span>
</span><span id="L-259"><a href="#L-259"><span class="linenos"> 259</span></a>        <span class="k">if</span> <span class="s2">&quot;employee_addresses.csv&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">list_data_files</span><span class="p">():</span>
</span><span id="L-260"><a href="#L-260"><span class="linenos"> 260</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">analysis_phase</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="L-261"><a href="#L-261"><span class="linenos"> 261</span></a>            <span class="k">return</span> <span class="mi">1</span>
</span><span id="L-262"><a href="#L-262"><span class="linenos"> 262</span></a>        <span class="c1"># if there is a project and there is a employee_addresses.csv in the project, phase is 2</span>
</span><span id="L-263"><a href="#L-263"><span class="linenos"> 263</span></a>        <span class="k">if</span> <span class="s2">&quot;employee_addresses.csv&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">list_data_files</span><span class="p">()</span> <span class="ow">and</span> <span class="s2">&quot;office_addresses.csv&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">list_data_files</span><span class="p">():</span>
</span><span id="L-264"><a href="#L-264"><span class="linenos"> 264</span></a>            <span class="c1"># if there is also a employee_gps.csv in the project, phase is 3</span>
</span><span id="L-265"><a href="#L-265"><span class="linenos"> 265</span></a>            <span class="k">if</span> <span class="s2">&quot;employee_gps.csv&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">list_data_files</span><span class="p">()</span> <span class="ow">and</span> <span class="s2">&quot;office_gps.csv&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">list_data_files</span><span class="p">():</span>
</span><span id="L-266"><a href="#L-266"><span class="linenos"> 266</span></a>                <span class="c1"># if there is also a gps_fuzz.csv in the project, or if using GPS fuzz is set to fals, we are at phase is 4</span>
</span><span id="L-267"><a href="#L-267"><span class="linenos"> 267</span></a>                <span class="k">if</span> <span class="s2">&quot;gps_fuzz.csv&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">list_data_files</span><span class="p">()</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">use_gps_fuzzing</span><span class="o">==</span><span class="kc">False</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">use_gps_fuzzing</span><span class="o">==</span><span class="s2">&quot;False&quot;</span><span class="p">:</span>
</span><span id="L-268"><a href="#L-268"><span class="linenos"> 268</span></a>                    <span class="c1"># if there is also a commute_data.csv in the project, phase is 5</span>
</span><span id="L-269"><a href="#L-269"><span class="linenos"> 269</span></a>                    <span class="k">if</span> <span class="s2">&quot;commute_data.csv&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">list_data_files</span><span class="p">():</span>
</span><span id="L-270"><a href="#L-270"><span class="linenos"> 270</span></a>                        <span class="c1"># if graphs.json is present in the plots dir, we&#39;ve graphed, phase is 6</span>
</span><span id="L-271"><a href="#L-271"><span class="linenos"> 271</span></a>                        <span class="k">if</span> <span class="s2">&quot;plots&quot;</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project_directory</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">project_name</span><span class="p">))</span> <span class="ow">and</span> <span class="s2">&quot;graphs.json&quot;</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project_directory</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">project_name</span><span class="p">,</span> <span class="s2">&quot;plots&quot;</span><span class="p">)):</span>
</span><span id="L-272"><a href="#L-272"><span class="linenos"> 272</span></a>                            <span class="c1"># if tables dir exists and tables.json is present, we&#39;ve tabled, phase is 7</span>
</span><span id="L-273"><a href="#L-273"><span class="linenos"> 273</span></a>                            <span class="k">if</span> <span class="s2">&quot;tables&quot;</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project_directory</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">project_name</span><span class="p">))</span> <span class="ow">and</span> <span class="s2">&quot;tables.json&quot;</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project_directory</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">project_name</span><span class="p">,</span> <span class="s2">&quot;tables&quot;</span><span class="p">)):</span>
</span><span id="L-274"><a href="#L-274"><span class="linenos"> 274</span></a>                                <span class="bp">self</span><span class="o">.</span><span class="n">analysis_phase</span> <span class="o">=</span> <span class="mi">7</span>
</span><span id="L-275"><a href="#L-275"><span class="linenos"> 275</span></a>                                <span class="k">return</span> <span class="mi">7</span>
</span><span id="L-276"><a href="#L-276"><span class="linenos"> 276</span></a>                            <span class="bp">self</span><span class="o">.</span><span class="n">analysis_phase</span> <span class="o">=</span> <span class="mi">7</span>
</span><span id="L-277"><a href="#L-277"><span class="linenos"> 277</span></a>                            <span class="k">return</span> <span class="mi">7</span>
</span><span id="L-278"><a href="#L-278"><span class="linenos"> 278</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">analysis_phase</span> <span class="o">=</span> <span class="mi">5</span>
</span><span id="L-279"><a href="#L-279"><span class="linenos"> 279</span></a>                        <span class="k">return</span> <span class="mi">5</span>
</span><span id="L-280"><a href="#L-280"><span class="linenos"> 280</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="L-281"><a href="#L-281"><span class="linenos"> 281</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">analysis_phase</span> <span class="o">=</span> <span class="mi">4</span>
</span><span id="L-282"><a href="#L-282"><span class="linenos"> 282</span></a>                        <span class="k">return</span> <span class="mi">4</span>
</span><span id="L-283"><a href="#L-283"><span class="linenos"> 283</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="L-284"><a href="#L-284"><span class="linenos"> 284</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">analysis_phase</span> <span class="o">=</span> <span class="mi">3</span>
</span><span id="L-285"><a href="#L-285"><span class="linenos"> 285</span></a>                    <span class="k">return</span> <span class="mi">3</span>
</span><span id="L-286"><a href="#L-286"><span class="linenos"> 286</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-287"><a href="#L-287"><span class="linenos"> 287</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">analysis_phase</span> <span class="o">=</span> <span class="mi">2</span>
</span><span id="L-288"><a href="#L-288"><span class="linenos"> 288</span></a>                <span class="k">return</span> <span class="mi">2</span>
</span><span id="L-289"><a href="#L-289"><span class="linenos"> 289</span></a>        
</span><span id="L-290"><a href="#L-290"><span class="linenos"> 290</span></a>    <span class="k">def</span> <span class="nf">convert_addresses_to_gps</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">log_csv</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="L-291"><a href="#L-291"><span class="linenos"> 291</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-292"><a href="#L-292"><span class="linenos"> 292</span></a><span class="sd">        Converts addresses from specified CSV files to GPS coordinates using the Google Maps API.</span>
</span><span id="L-293"><a href="#L-293"><span class="linenos"> 293</span></a>
</span><span id="L-294"><a href="#L-294"><span class="linenos"> 294</span></a><span class="sd">        This method processes both employee and office address data, converting each address to latitude and longitude coordinates. </span>
</span><span id="L-295"><a href="#L-295"><span class="linenos"> 295</span></a><span class="sd">        The results are saved to corresponding GPS data files. If logging is enabled, the process details are recorded in a specified log CSV file.</span>
</span><span id="L-296"><a href="#L-296"><span class="linenos"> 296</span></a>
</span><span id="L-297"><a href="#L-297"><span class="linenos"> 297</span></a><span class="sd">        Args:</span>
</span><span id="L-298"><a href="#L-298"><span class="linenos"> 298</span></a><span class="sd">            force (bool, optional): If True, forces re-conversion of addresses even if GPS data already exists. Defaults to False.</span>
</span><span id="L-299"><a href="#L-299"><span class="linenos"> 299</span></a><span class="sd">            log_csv (str, optional): Path to a log CSV file where operation details are recorded. Defaults to None.</span>
</span><span id="L-300"><a href="#L-300"><span class="linenos"> 300</span></a>
</span><span id="L-301"><a href="#L-301"><span class="linenos"> 301</span></a><span class="sd">        Returns:</span>
</span><span id="L-302"><a href="#L-302"><span class="linenos"> 302</span></a><span class="sd">            bool: True if the conversion process is completed successfully for all addresses; False otherwise.</span>
</span><span id="L-303"><a href="#L-303"><span class="linenos"> 303</span></a><span class="sd">        </span>
</span><span id="L-304"><a href="#L-304"><span class="linenos"> 304</span></a><span class="sd">        This method handles geocoding of addresses using the Google Maps API, respecting API rate limits</span>
</span><span id="L-305"><a href="#L-305"><span class="linenos"> 305</span></a><span class="sd">        and optionally logging the process. If `force` is True, existing GPS data is ignored, and addresses are re-geocoded.</span>
</span><span id="L-306"><a href="#L-306"><span class="linenos"> 306</span></a><span class="sd">            </span>
</span><span id="L-307"><a href="#L-307"><span class="linenos"> 307</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-308"><a href="#L-308"><span class="linenos"> 308</span></a>
</span><span id="L-309"><a href="#L-309"><span class="linenos"> 309</span></a>        <span class="c1"># start logfile if logging</span>
</span><span id="L-310"><a href="#L-310"><span class="linenos"> 310</span></a>        <span class="k">if</span> <span class="n">log_csv</span><span class="p">:</span>
</span><span id="L-311"><a href="#L-311"><span class="linenos"> 311</span></a>            <span class="n">log</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">log_csv</span><span class="p">,</span> <span class="s2">&quot;a+&quot;</span><span class="p">)</span>
</span><span id="L-312"><a href="#L-312"><span class="linenos"> 312</span></a>            <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Beginning the geocoding of addresses</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-313"><a href="#L-313"><span class="linenos"> 313</span></a>            <span class="c1"># dump the project data including the file system location of all data files to the log</span>
</span><span id="L-314"><a href="#L-314"><span class="linenos"> 314</span></a>            <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;project data&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-315"><a href="#L-315"><span class="linenos"> 315</span></a>            <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">project_directory</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-316"><a href="#L-316"><span class="linenos"> 316</span></a>
</span><span id="L-317"><a href="#L-317"><span class="linenos"> 317</span></a>            <span class="n">log</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
</span><span id="L-318"><a href="#L-318"><span class="linenos"> 318</span></a>        <span class="c1"># create a google API object if it doesn&#39;t exist</span>
</span><span id="L-319"><a href="#L-319"><span class="linenos"> 319</span></a>        <span class="c1"># if the project has an API key, use it, otherwise use the default .env key</span>
</span><span id="L-320"><a href="#L-320"><span class="linenos"> 320</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">GMAPS_API_KEY</span><span class="p">:</span>
</span><span id="L-321"><a href="#L-321"><span class="linenos"> 321</span></a>            <span class="n">api_key</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">GMAPS_API_KEY</span>
</span><span id="L-322"><a href="#L-322"><span class="linenos"> 322</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-323"><a href="#L-323"><span class="linenos"> 323</span></a>            <span class="n">api_key</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gAPI_key</span>
</span><span id="L-324"><a href="#L-324"><span class="linenos"> 324</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">gAPI</span><span class="p">:</span>
</span><span id="L-325"><a href="#L-325"><span class="linenos"> 325</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">gAPI</span> <span class="o">=</span> <span class="n">GAPI</span><span class="p">(</span><span class="n">api_key</span><span class="p">)</span>  
</span><span id="L-326"><a href="#L-326"><span class="linenos"> 326</span></a>        <span class="c1"># same action for both files</span>
</span><span id="L-327"><a href="#L-327"><span class="linenos"> 327</span></a>        <span class="n">out</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;employee_addresses.csv&quot;</span><span class="p">:</span> <span class="s2">&quot;employee_gps.csv&quot;</span><span class="p">,</span> <span class="s2">&quot;office_addresses.csv&quot;</span><span class="p">:</span> <span class="s2">&quot;office_gps.csv&quot;</span><span class="p">}</span>
</span><span id="L-328"><a href="#L-328"><span class="linenos"> 328</span></a>        <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">out</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
</span><span id="L-329"><a href="#L-329"><span class="linenos"> 329</span></a>            <span class="c1"># check to see if addresses are already in the project</span>
</span><span id="L-330"><a href="#L-330"><span class="linenos"> 330</span></a>            <span class="k">if</span> <span class="n">file</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">list_data_files</span><span class="p">():</span>
</span><span id="L-331"><a href="#L-331"><span class="linenos"> 331</span></a>                <span class="c1"># if the address data isn&#39;t already in the project, load it</span>
</span><span id="L-332"><a href="#L-332"><span class="linenos"> 332</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">file</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">force</span><span class="p">:</span>
</span><span id="L-333"><a href="#L-333"><span class="linenos"> 333</span></a>                    <span class="c1"># attempt to load the address data</span>
</span><span id="L-334"><a href="#L-334"><span class="linenos"> 334</span></a>                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">load_data_file</span><span class="p">(</span><span class="n">file</span><span class="p">):</span>
</span><span id="L-335"><a href="#L-335"><span class="linenos"> 335</span></a>                        <span class="k">pass</span> <span class="c1"># valid data loaded</span>
</span><span id="L-336"><a href="#L-336"><span class="linenos"> 336</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="L-337"><a href="#L-337"><span class="linenos"> 337</span></a>                        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Errors loading address data from project.&quot;</span><span class="p">)</span>
</span><span id="L-338"><a href="#L-338"><span class="linenos"> 338</span></a>                        <span class="k">return</span> <span class="kc">False</span>
</span><span id="L-339"><a href="#L-339"><span class="linenos"> 339</span></a>                <span class="c1"># if the address data is already in the project, use it</span>
</span><span id="L-340"><a href="#L-340"><span class="linenos"> 340</span></a>                <span class="c1"># create the project data object to hold the gps data</span>
</span><span id="L-341"><a href="#L-341"><span class="linenos"> 341</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">start_dataframe</span><span class="p">(</span><span class="n">out</span><span class="p">[</span><span class="n">file</span><span class="p">])</span>
</span><span id="L-342"><a href="#L-342"><span class="linenos"> 342</span></a>                <span class="c1"># iterate through the address data and convert each address to gps lat long in the project data object</span>
</span><span id="L-343"><a href="#L-343"><span class="linenos"> 343</span></a>                <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">file</span><span class="p">]</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
</span><span id="L-344"><a href="#L-344"><span class="linenos"> 344</span></a>                    <span class="c1"># get the geocoded address lat and long</span>
</span><span id="L-345"><a href="#L-345"><span class="linenos"> 345</span></a>                    <span class="k">try</span><span class="p">:</span>
</span><span id="L-346"><a href="#L-346"><span class="linenos"> 346</span></a>                        <span class="k">if</span> <span class="n">log_csv</span><span class="p">:</span> 
</span><span id="L-347"><a href="#L-347"><span class="linenos"> 347</span></a>                            <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Geocoding address: &quot;</span><span class="o">+</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;address&quot;</span><span class="p">]</span><span class="o">+</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-348"><a href="#L-348"><span class="linenos"> 348</span></a>                            <span class="n">log</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
</span><span id="L-349"><a href="#L-349"><span class="linenos"> 349</span></a>                            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Geocoding address: &quot;</span><span class="o">+</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;address&quot;</span><span class="p">]</span><span class="o">+</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-350"><a href="#L-350"><span class="linenos"> 350</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">sleepif</span><span class="p">()</span>
</span><span id="L-351"><a href="#L-351"><span class="linenos"> 351</span></a>                        <span class="k">try</span><span class="p">:</span>
</span><span id="L-352"><a href="#L-352"><span class="linenos"> 352</span></a>                            <span class="n">latlong</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gAPI</span><span class="o">.</span><span class="n">geocode</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;address&quot;</span><span class="p">])</span>
</span><span id="L-353"><a href="#L-353"><span class="linenos"> 353</span></a>                        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="L-354"><a href="#L-354"><span class="linenos"> 354</span></a>                            <span class="c1"># if logging, write the exception event to the logfile</span>
</span><span id="L-355"><a href="#L-355"><span class="linenos"> 355</span></a>                            <span class="bp">self</span><span class="o">.</span><span class="n">log_error</span><span class="p">(</span><span class="s2">&quot;Exception calling geocode function: &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-356"><a href="#L-356"><span class="linenos"> 356</span></a>                            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Exception calling geocode function: &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-357"><a href="#L-357"><span class="linenos"> 357</span></a>                            <span class="c1"># if the excetion is a recoverable one, retry after a delay, else raise the exception</span>
</span><span id="L-358"><a href="#L-358"><span class="linenos"> 358</span></a>                            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">handle_GAPI_exception</span><span class="p">(</span><span class="n">e</span><span class="p">):</span>
</span><span id="L-359"><a href="#L-359"><span class="linenos"> 359</span></a>                                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;recoverable exception, waiting to retry once&quot;</span><span class="p">)</span>
</span><span id="L-360"><a href="#L-360"><span class="linenos"> 360</span></a>                                <span class="n">sleep</span><span class="p">(</span><span class="mi">10000</span><span class="p">)</span>
</span><span id="L-361"><a href="#L-361"><span class="linenos"> 361</span></a>                                <span class="k">try</span><span class="p">:</span>
</span><span id="L-362"><a href="#L-362"><span class="linenos"> 362</span></a>                                    <span class="n">latlong</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gAPI</span><span class="o">.</span><span class="n">geocode</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;address&quot;</span><span class="p">])</span>
</span><span id="L-363"><a href="#L-363"><span class="linenos"> 363</span></a>                                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="L-364"><a href="#L-364"><span class="linenos"> 364</span></a>                                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Unrecoverable exception, tried twice skipping address&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-365"><a href="#L-365"><span class="linenos"> 365</span></a>                                    <span class="c1"># if logging, write the exception event to the logfile</span>
</span><span id="L-366"><a href="#L-366"><span class="linenos"> 366</span></a>                                    <span class="bp">self</span><span class="o">.</span><span class="n">log_error</span><span class="p">(</span><span class="s2">&quot;Recoverable error calling geocode function, failed twice. Deemed unrecoverable. Exception: &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-367"><a href="#L-367"><span class="linenos"> 367</span></a>                                    <span class="n">e</span><span class="o">.</span><span class="n">add_note</span> <span class="o">=</span> <span class="s2">&quot;Recoverable error calling geocode function, failed twice. Deemed unrecoverable&quot;</span>
</span><span id="L-368"><a href="#L-368"><span class="linenos"> 368</span></a>                                    <span class="k">raise</span> <span class="n">e</span>
</span><span id="L-369"><a href="#L-369"><span class="linenos"> 369</span></a>                            <span class="k">else</span><span class="p">:</span>
</span><span id="L-370"><a href="#L-370"><span class="linenos"> 370</span></a>                                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Recoverable exception calling geocode, skipping address. </span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-371"><a href="#L-371"><span class="linenos"> 371</span></a>                                <span class="bp">self</span><span class="o">.</span><span class="n">log_error</span><span class="p">(</span><span class="s2">&quot;Unrecoverable error calling geocode, failed once. Exception: &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-372"><a href="#L-372"><span class="linenos"> 372</span></a>                                <span class="n">e</span><span class="o">.</span><span class="n">add_note</span> <span class="o">=</span> <span class="s2">&quot;Unrecoverable error calling geocode, failed once&quot;</span>
</span><span id="L-373"><a href="#L-373"><span class="linenos"> 373</span></a>                                <span class="k">raise</span> <span class="n">e</span>
</span><span id="L-374"><a href="#L-374"><span class="linenos"> 374</span></a>                            
</span><span id="L-375"><a href="#L-375"><span class="linenos"> 375</span></a>
</span><span id="L-376"><a href="#L-376"><span class="linenos"> 376</span></a>                        <span class="c1"># insert the lat and long into a new row in the project data object</span>
</span><span id="L-377"><a href="#L-377"><span class="linenos"> 377</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">out</span><span class="p">[</span><span class="n">file</span><span class="p">]]</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;address&quot;</span><span class="p">:</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;address&quot;</span><span class="p">],</span><span class="s2">&quot;latitude&quot;</span><span class="p">:</span> <span class="n">latlong</span><span class="p">[</span><span class="s1">&#39;lat&#39;</span><span class="p">],</span> <span class="s2">&quot;longitude&quot;</span><span class="p">:</span> <span class="n">latlong</span><span class="p">[</span><span class="s1">&#39;lng&#39;</span><span class="p">]}</span>
</span><span id="L-378"><a href="#L-378"><span class="linenos"> 378</span></a>                    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="L-379"><a href="#L-379"><span class="linenos"> 379</span></a>                        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Error saving geocode address result: &quot;</span><span class="o">+</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;address&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> Got exception: &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
</span><span id="L-380"><a href="#L-380"><span class="linenos"> 380</span></a>                        <span class="k">if</span> <span class="n">log_csv</span><span class="p">:</span> <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Error saving geocode result address: &quot;</span><span class="o">+</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;address&quot;</span><span class="p">]</span><span class="o">+</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-381"><a href="#L-381"><span class="linenos"> 381</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">log_error</span><span class="p">(</span><span class="s2">&quot;Error saving geocode result address: &quot;</span><span class="o">+</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;address&quot;</span><span class="p">]</span><span class="o">+</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;Got exception: &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
</span><span id="L-382"><a href="#L-382"><span class="linenos"> 382</span></a>                        <span class="k">raise</span> <span class="n">e</span>
</span><span id="L-383"><a href="#L-383"><span class="linenos"> 383</span></a>                                            
</span><span id="L-384"><a href="#L-384"><span class="linenos"> 384</span></a>                <span class="c1"># save the project data object to the csv file</span>
</span><span id="L-385"><a href="#L-385"><span class="linenos"> 385</span></a>                <span class="k">if</span> <span class="n">file</span> <span class="o">==</span> <span class="s2">&quot;employee_addresses.csv&quot;</span><span class="p">:</span>
</span><span id="L-386"><a href="#L-386"><span class="linenos"> 386</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">save_data_file</span><span class="p">(</span><span class="n">out</span><span class="p">[</span><span class="n">file</span><span class="p">])</span>
</span><span id="L-387"><a href="#L-387"><span class="linenos"> 387</span></a>                <span class="k">elif</span> <span class="n">file</span> <span class="o">==</span> <span class="s2">&quot;office_addresses.csv&quot;</span><span class="p">:</span>
</span><span id="L-388"><a href="#L-388"><span class="linenos"> 388</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">save_data_file</span><span class="p">(</span><span class="n">out</span><span class="p">[</span><span class="n">file</span><span class="p">])</span>
</span><span id="L-389"><a href="#L-389"><span class="linenos"> 389</span></a>                <span class="c1"># update the analysis phase</span>
</span><span id="L-390"><a href="#L-390"><span class="linenos"> 390</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">update_analysis_phase</span><span class="p">()</span>
</span><span id="L-391"><a href="#L-391"><span class="linenos"> 391</span></a>                <span class="k">if</span> <span class="n">log_csv</span><span class="p">:</span> <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Geocoding complete</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-392"><a href="#L-392"><span class="linenos"> 392</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-393"><a href="#L-393"><span class="linenos"> 393</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Address data &quot;</span><span class="o">+</span><span class="n">file</span><span class="o">+</span><span class="s2">&quot; missing from project.&quot;</span><span class="p">)</span>
</span><span id="L-394"><a href="#L-394"><span class="linenos"> 394</span></a>                <span class="k">return</span> <span class="kc">False</span>   
</span><span id="L-395"><a href="#L-395"><span class="linenos"> 395</span></a>        <span class="k">if</span> <span class="n">log_csv</span><span class="p">:</span> <span class="n">log</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>             
</span><span id="L-396"><a href="#L-396"><span class="linenos"> 396</span></a>        <span class="k">return</span> <span class="kc">True</span>
</span><span id="L-397"><a href="#L-397"><span class="linenos"> 397</span></a>    
</span><span id="L-398"><a href="#L-398"><span class="linenos"> 398</span></a>    <span class="k">def</span> <span class="nf">fuzz_employee_gps</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="L-399"><a href="#L-399"><span class="linenos"> 399</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-400"><a href="#L-400"><span class="linenos"> 400</span></a><span class="sd">        Applies a fuzzing process to employee GPS coordinates to anonymize locations.</span>
</span><span id="L-401"><a href="#L-401"><span class="linenos"> 401</span></a>
</span><span id="L-402"><a href="#L-402"><span class="linenos"> 402</span></a><span class="sd">        This method adds a small, random displacement to the latitude and longitude of employee addresses. </span>
</span><span id="L-403"><a href="#L-403"><span class="linenos"> 403</span></a><span class="sd">        This process is intended to protect privacy by preventing the exact identification of employee home locations.</span>
</span><span id="L-404"><a href="#L-404"><span class="linenos"> 404</span></a>
</span><span id="L-405"><a href="#L-405"><span class="linenos"> 405</span></a><span class="sd">        Args:</span>
</span><span id="L-406"><a href="#L-406"><span class="linenos"> 406</span></a><span class="sd">            force (bool, optional): If True, forces re-fuzzing of GPS coordinates even if fuzzed data already exists. Defaults to False.</span>
</span><span id="L-407"><a href="#L-407"><span class="linenos"> 407</span></a>
</span><span id="L-408"><a href="#L-408"><span class="linenos"> 408</span></a><span class="sd">        Returns:</span>
</span><span id="L-409"><a href="#L-409"><span class="linenos"> 409</span></a><span class="sd">            bool: True if fuzzing is successfully applied to all employee GPS coordinates; False otherwise.</span>
</span><span id="L-410"><a href="#L-410"><span class="linenos"> 410</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-411"><a href="#L-411"><span class="linenos"> 411</span></a>        <span class="c1"># if the google API object doesn&#39;t exist, create it</span>
</span><span id="L-412"><a href="#L-412"><span class="linenos"> 412</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">gAPI</span><span class="p">:</span>
</span><span id="L-413"><a href="#L-413"><span class="linenos"> 413</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">gAPI</span> <span class="o">=</span> <span class="n">GAPI</span><span class="p">()</span>
</span><span id="L-414"><a href="#L-414"><span class="linenos"> 414</span></a>        <span class="c1"># add a small amount of fuzz to the employee gps coordinates</span>
</span><span id="L-415"><a href="#L-415"><span class="linenos"> 415</span></a>        <span class="c1"># if the gps data isn&#39;t already in the project, load it</span>
</span><span id="L-416"><a href="#L-416"><span class="linenos"> 416</span></a>        <span class="k">if</span> <span class="s2">&quot;employee_gps.csv&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">list_data_files</span><span class="p">():</span>
</span><span id="L-417"><a href="#L-417"><span class="linenos"> 417</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;employee_gps.csv&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">force</span><span class="p">:</span>
</span><span id="L-418"><a href="#L-418"><span class="linenos"> 418</span></a>                <span class="c1"># attempt to load the gps data</span>
</span><span id="L-419"><a href="#L-419"><span class="linenos"> 419</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">load_data_file</span><span class="p">(</span><span class="s2">&quot;employee_gps.csv&quot;</span><span class="p">):</span>
</span><span id="L-420"><a href="#L-420"><span class="linenos"> 420</span></a>                    <span class="k">pass</span>
</span><span id="L-421"><a href="#L-421"><span class="linenos"> 421</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="L-422"><a href="#L-422"><span class="linenos"> 422</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Errors loading gps data from project.&quot;</span><span class="p">)</span>
</span><span id="L-423"><a href="#L-423"><span class="linenos"> 423</span></a>                    <span class="k">return</span> <span class="kc">False</span>
</span><span id="L-424"><a href="#L-424"><span class="linenos"> 424</span></a>            <span class="c1"># if the gps data is already in the project, use it</span>
</span><span id="L-425"><a href="#L-425"><span class="linenos"> 425</span></a>            <span class="c1"># create the project data object to hold the fuzzed gps data</span>
</span><span id="L-426"><a href="#L-426"><span class="linenos"> 426</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">start_dataframe</span><span class="p">(</span><span class="s2">&quot;gps_fuzz.csv&quot;</span><span class="p">)</span>
</span><span id="L-427"><a href="#L-427"><span class="linenos"> 427</span></a>            <span class="c1"># iterate through the gps data and fuzz each set of coordinates</span>
</span><span id="L-428"><a href="#L-428"><span class="linenos"> 428</span></a>            <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;employee_gps.csv&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
</span><span id="L-429"><a href="#L-429"><span class="linenos"> 429</span></a>                <span class="c1"># fuzz the lat and long</span>
</span><span id="L-430"><a href="#L-430"><span class="linenos"> 430</span></a>                <span class="n">latlong</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gAPI</span><span class="o">.</span><span class="n">fuzz_latlong</span><span class="p">({</span><span class="s2">&quot;lat&quot;</span><span class="p">:</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;latitude&quot;</span><span class="p">],</span> <span class="s2">&quot;lng&quot;</span><span class="p">:</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;longitude&quot;</span><span class="p">]},</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">gps_fuzz_factor</span><span class="p">)</span>
</span><span id="L-431"><a href="#L-431"><span class="linenos"> 431</span></a>                <span class="c1"># insert the fuzzed lat and long into a new row in the project data object</span>
</span><span id="L-432"><a href="#L-432"><span class="linenos"> 432</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;gps_fuzz.csv&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;latitude&quot;</span><span class="p">:</span> <span class="n">latlong</span><span class="p">[</span><span class="s1">&#39;lat&#39;</span><span class="p">],</span> <span class="s2">&quot;longitude&quot;</span><span class="p">:</span> <span class="n">latlong</span><span class="p">[</span><span class="s1">&#39;lng&#39;</span><span class="p">]}</span>
</span><span id="L-433"><a href="#L-433"><span class="linenos"> 433</span></a>            <span class="c1"># save the project data object to the csv file</span>
</span><span id="L-434"><a href="#L-434"><span class="linenos"> 434</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">save_data_file</span><span class="p">(</span><span class="s2">&quot;gps_fuzz.csv&quot;</span><span class="p">)</span>
</span><span id="L-435"><a href="#L-435"><span class="linenos"> 435</span></a>            <span class="c1"># update the analysis phase</span>
</span><span id="L-436"><a href="#L-436"><span class="linenos"> 436</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">update_analysis_phase</span><span class="p">()</span>
</span><span id="L-437"><a href="#L-437"><span class="linenos"> 437</span></a>        <span class="k">else</span><span class="p">:</span>    
</span><span id="L-438"><a href="#L-438"><span class="linenos"> 438</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;GPS data missing from project.&quot;</span><span class="p">)</span>
</span><span id="L-439"><a href="#L-439"><span class="linenos"> 439</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="L-440"><a href="#L-440"><span class="linenos"> 440</span></a>        
</span><span id="L-441"><a href="#L-441"><span class="linenos"> 441</span></a>    <span class="k">def</span> <span class="nf">get_commute_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">log_csv</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="L-442"><a href="#L-442"><span class="linenos"> 442</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-443"><a href="#L-443"><span class="linenos"> 443</span></a><span class="sd">        Generates commute data for employees based on their GPS coordinates and the office locations.</span>
</span><span id="L-444"><a href="#L-444"><span class="linenos"> 444</span></a>
</span><span id="L-445"><a href="#L-445"><span class="linenos"> 445</span></a><span class="sd">        This method calculates commute times and distances from employees&#39; locations to the office, accounting for specified commute times. </span>
</span><span id="L-446"><a href="#L-446"><span class="linenos"> 446</span></a><span class="sd">        Optionally logs the operation details if a log CSV file path is provided.</span>
</span><span id="L-447"><a href="#L-447"><span class="linenos"> 447</span></a>
</span><span id="L-448"><a href="#L-448"><span class="linenos"> 448</span></a><span class="sd">        Args:</span>
</span><span id="L-449"><a href="#L-449"><span class="linenos"> 449</span></a><span class="sd">            force (bool, optional): If True, forces regeneration of commute data even if it already exists. Defaults to False.</span>
</span><span id="L-450"><a href="#L-450"><span class="linenos"> 450</span></a><span class="sd">            log_csv (str, optional): Path to a log CSV file where operation details are recorded. Defaults to None.</span>
</span><span id="L-451"><a href="#L-451"><span class="linenos"> 451</span></a>
</span><span id="L-452"><a href="#L-452"><span class="linenos"> 452</span></a><span class="sd">        Returns:</span>
</span><span id="L-453"><a href="#L-453"><span class="linenos"> 453</span></a><span class="sd">            bool: True if commute data is successfully generated; False otherwise.</span>
</span><span id="L-454"><a href="#L-454"><span class="linenos"> 454</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-455"><a href="#L-455"><span class="linenos"> 455</span></a>
</span><span id="L-456"><a href="#L-456"><span class="linenos"> 456</span></a>        <span class="c1"># if the use fuzzed data flag is set, use the fuzzed data, otherwise use the original data</span>
</span><span id="L-457"><a href="#L-457"><span class="linenos"> 457</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">use_gps_fuzzing</span><span class="o">==</span><span class="kc">True</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">use_gps_fuzzing</span><span class="o">==</span><span class="s2">&quot;True&quot;</span><span class="p">:</span>
</span><span id="L-458"><a href="#L-458"><span class="linenos"> 458</span></a>            <span class="c1"># if the fuzzed gps data isn&#39;t already in the project, load it</span>
</span><span id="L-459"><a href="#L-459"><span class="linenos"> 459</span></a>            <span class="k">if</span> <span class="s2">&quot;gps_fuzz.csv&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">list_data_files</span><span class="p">():</span>
</span><span id="L-460"><a href="#L-460"><span class="linenos"> 460</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;gps_fuzz.csv&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">force</span><span class="p">:</span>
</span><span id="L-461"><a href="#L-461"><span class="linenos"> 461</span></a>                    <span class="c1"># attempt to load the fuzzed gps data</span>
</span><span id="L-462"><a href="#L-462"><span class="linenos"> 462</span></a>                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">load_data_file</span><span class="p">(</span><span class="s2">&quot;gps_fuzz.csv&quot;</span><span class="p">):</span>
</span><span id="L-463"><a href="#L-463"><span class="linenos"> 463</span></a>                        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Using fuzzed GPS data.&quot;</span><span class="p">)</span>
</span><span id="L-464"><a href="#L-464"><span class="linenos"> 464</span></a>                        <span class="k">pass</span>
</span><span id="L-465"><a href="#L-465"><span class="linenos"> 465</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="L-466"><a href="#L-466"><span class="linenos"> 466</span></a>                        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Errors loading fuzzed gps data from project.&quot;</span><span class="p">)</span>
</span><span id="L-467"><a href="#L-467"><span class="linenos"> 467</span></a>                        <span class="k">return</span> <span class="kc">False</span>
</span><span id="L-468"><a href="#L-468"><span class="linenos"> 468</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-469"><a href="#L-469"><span class="linenos"> 469</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Fuzzed GPS data missing from project.&quot;</span><span class="p">)</span>
</span><span id="L-470"><a href="#L-470"><span class="linenos"> 470</span></a>                <span class="k">return</span> <span class="kc">False</span>
</span><span id="L-471"><a href="#L-471"><span class="linenos"> 471</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-472"><a href="#L-472"><span class="linenos"> 472</span></a>            <span class="c1"># use the un fuzzed data</span>
</span><span id="L-473"><a href="#L-473"><span class="linenos"> 473</span></a>            <span class="c1"># if the gps data isn&#39;t already in the project, load it</span>
</span><span id="L-474"><a href="#L-474"><span class="linenos"> 474</span></a>            <span class="k">if</span> <span class="s2">&quot;employee_gps.csv&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">list_data_files</span><span class="p">():</span>
</span><span id="L-475"><a href="#L-475"><span class="linenos"> 475</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;employee_gps.csv&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">force</span><span class="p">:</span>
</span><span id="L-476"><a href="#L-476"><span class="linenos"> 476</span></a>                    <span class="c1"># attempt to load the gps data</span>
</span><span id="L-477"><a href="#L-477"><span class="linenos"> 477</span></a>                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">load_data_file</span><span class="p">(</span><span class="s2">&quot;employee_gps.csv&quot;</span><span class="p">):</span>
</span><span id="L-478"><a href="#L-478"><span class="linenos"> 478</span></a>                        <span class="k">pass</span>
</span><span id="L-479"><a href="#L-479"><span class="linenos"> 479</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="L-480"><a href="#L-480"><span class="linenos"> 480</span></a>                        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Errors loading gps data from project.&quot;</span><span class="p">)</span>
</span><span id="L-481"><a href="#L-481"><span class="linenos"> 481</span></a>                        <span class="k">return</span> <span class="kc">False</span>
</span><span id="L-482"><a href="#L-482"><span class="linenos"> 482</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="L-483"><a href="#L-483"><span class="linenos"> 483</span></a>                    <span class="k">pass</span>
</span><span id="L-484"><a href="#L-484"><span class="linenos"> 484</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-485"><a href="#L-485"><span class="linenos"> 485</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;GPS data missing from project.&quot;</span><span class="p">)</span>
</span><span id="L-486"><a href="#L-486"><span class="linenos"> 486</span></a>                <span class="k">return</span> <span class="kc">False</span>
</span><span id="L-487"><a href="#L-487"><span class="linenos"> 487</span></a>        <span class="c1"># attempt to load the office gps data</span>
</span><span id="L-488"><a href="#L-488"><span class="linenos"> 488</span></a>        <span class="k">if</span> <span class="s2">&quot;office_gps.csv&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">list_data_files</span><span class="p">():</span>
</span><span id="L-489"><a href="#L-489"><span class="linenos"> 489</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;office_gps.csv&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">force</span><span class="p">:</span>
</span><span id="L-490"><a href="#L-490"><span class="linenos"> 490</span></a>                <span class="c1"># attempt to load the office gps data</span>
</span><span id="L-491"><a href="#L-491"><span class="linenos"> 491</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">load_data_file</span><span class="p">(</span><span class="s2">&quot;office_gps.csv&quot;</span><span class="p">):</span>
</span><span id="L-492"><a href="#L-492"><span class="linenos"> 492</span></a>                    <span class="k">pass</span>
</span><span id="L-493"><a href="#L-493"><span class="linenos"> 493</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="L-494"><a href="#L-494"><span class="linenos"> 494</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Errors loading office gps data from project.&quot;</span><span class="p">)</span>
</span><span id="L-495"><a href="#L-495"><span class="linenos"> 495</span></a>                    <span class="k">return</span> <span class="kc">False</span>
</span><span id="L-496"><a href="#L-496"><span class="linenos"> 496</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-497"><a href="#L-497"><span class="linenos"> 497</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Office GPS data missing from project.&quot;</span><span class="p">)</span>
</span><span id="L-498"><a href="#L-498"><span class="linenos"> 498</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="L-499"><a href="#L-499"><span class="linenos"> 499</span></a>        
</span><span id="L-500"><a href="#L-500"><span class="linenos"> 500</span></a>        <span class="c1"># touch the logfile to lock</span>
</span><span id="L-501"><a href="#L-501"><span class="linenos"> 501</span></a>        <span class="k">if</span> <span class="n">log_csv</span><span class="p">:</span>
</span><span id="L-502"><a href="#L-502"><span class="linenos"> 502</span></a>            <span class="n">log</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">log_csv</span><span class="p">,</span> <span class="s2">&quot;a+&quot;</span><span class="p">)</span>
</span><span id="L-503"><a href="#L-503"><span class="linenos"> 503</span></a>            <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Beginning the generation of commute data</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-504"><a href="#L-504"><span class="linenos"> 504</span></a>            <span class="n">log</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
</span><span id="L-505"><a href="#L-505"><span class="linenos"> 505</span></a>        <span class="c1"># if the google API object doesn&#39;t exist, create it</span>
</span><span id="L-506"><a href="#L-506"><span class="linenos"> 506</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">gAPI</span><span class="p">:</span>
</span><span id="L-507"><a href="#L-507"><span class="linenos"> 507</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">gAPI</span> <span class="o">=</span> <span class="n">GAPI</span><span class="p">()</span>
</span><span id="L-508"><a href="#L-508"><span class="linenos"> 508</span></a>        <span class="c1"># create a new dataframe to hold the commute data</span>
</span><span id="L-509"><a href="#L-509"><span class="linenos"> 509</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">start_dataframe</span><span class="p">(</span><span class="s2">&quot;commute_data.csv&quot;</span><span class="p">)</span>
</span><span id="L-510"><a href="#L-510"><span class="linenos"> 510</span></a>        <span class="c1"># create preparatory helper variables</span>
</span><span id="L-511"><a href="#L-511"><span class="linenos"> 511</span></a>        <span class="c1"># create datetime objects for the morning commute times</span>
</span><span id="L-512"><a href="#L-512"><span class="linenos"> 512</span></a>        <span class="n">morning_departure</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">morning_commute_start</span><span class="p">,</span> <span class="s2">&quot;%H:%M&quot;</span><span class="p">)</span>
</span><span id="L-513"><a href="#L-513"><span class="linenos"> 513</span></a>        <span class="n">evening_departure</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">evening_commute_start</span><span class="p">,</span> <span class="s2">&quot;%H:%M&quot;</span><span class="p">)</span>
</span><span id="L-514"><a href="#L-514"><span class="linenos"> 514</span></a>        <span class="n">days</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;m&quot;</span><span class="p">,</span><span class="s2">&quot;t&quot;</span><span class="p">,</span><span class="s2">&quot;w&quot;</span><span class="p">,</span><span class="s2">&quot;h&quot;</span><span class="p">,</span><span class="s2">&quot;f&quot;</span><span class="p">]</span>
</span><span id="L-515"><a href="#L-515"><span class="linenos"> 515</span></a>        <span class="n">times</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;morning&quot;</span><span class="p">,</span><span class="s2">&quot;evening&quot;</span><span class="p">]</span>
</span><span id="L-516"><a href="#L-516"><span class="linenos"> 516</span></a>        <span class="n">values</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;duration_in_traffic&quot;</span><span class="p">]</span>
</span><span id="L-517"><a href="#L-517"><span class="linenos"> 517</span></a>        <span class="c1"># get today&#39;s data and calculate days until NEXT monday</span>
</span><span id="L-518"><a href="#L-518"><span class="linenos"> 518</span></a>        <span class="n">today</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">today</span><span class="p">()</span>
</span><span id="L-519"><a href="#L-519"><span class="linenos"> 519</span></a>        <span class="n">days_until_monday</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="o">-</span><span class="n">today</span><span class="o">.</span><span class="n">weekday</span><span class="p">())</span> <span class="o">%</span> <span class="mi">7</span>
</span><span id="L-520"><a href="#L-520"><span class="linenos"> 520</span></a>        <span class="k">if</span> <span class="n">days_until_monday</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> <span class="c1"># today is a monday, we want the next one</span>
</span><span id="L-521"><a href="#L-521"><span class="linenos"> 521</span></a>            <span class="c1"># get the date of next monday</span>
</span><span id="L-522"><a href="#L-522"><span class="linenos"> 522</span></a>            <span class="n">days_until_monday</span> <span class="o">=</span> <span class="mi">7</span>
</span><span id="L-523"><a href="#L-523"><span class="linenos"> 523</span></a>        <span class="c1"># get the calendar date seven days from today</span>
</span><span id="L-524"><a href="#L-524"><span class="linenos"> 524</span></a>        <span class="n">next_monday</span> <span class="o">=</span> <span class="n">today</span> <span class="o">+</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="n">days_until_monday</span><span class="p">)</span>
</span><span id="L-525"><a href="#L-525"><span class="linenos"> 525</span></a>        <span class="c1">#next_monday = today.replace(day=today.day+days_until_monday)</span>
</span><span id="L-526"><a href="#L-526"><span class="linenos"> 526</span></a>        <span class="c1"># based off of next_monday, create morning and evening date time objects for commute departure times in project attributes</span>
</span><span id="L-527"><a href="#L-527"><span class="linenos"> 527</span></a>        <span class="n">commutes</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;m_morning&#39;</span><span class="p">:</span><span class="n">datetime</span><span class="o">.</span><span class="n">combine</span><span class="p">(</span><span class="n">next_monday</span><span class="p">,</span> <span class="n">morning_departure</span><span class="o">.</span><span class="n">time</span><span class="p">()),</span>
</span><span id="L-528"><a href="#L-528"><span class="linenos"> 528</span></a>                    <span class="s1">&#39;m_evening&#39;</span><span class="p">:</span><span class="n">datetime</span><span class="o">.</span><span class="n">combine</span><span class="p">(</span><span class="n">next_monday</span><span class="p">,</span> <span class="n">evening_departure</span><span class="o">.</span><span class="n">time</span><span class="p">()),</span>
</span><span id="L-529"><a href="#L-529"><span class="linenos"> 529</span></a>                    <span class="s1">&#39;t_morning&#39;</span><span class="p">:</span><span class="n">datetime</span><span class="o">.</span><span class="n">combine</span><span class="p">(</span><span class="n">next_monday</span><span class="o">+</span><span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span> <span class="n">morning_departure</span><span class="o">.</span><span class="n">time</span><span class="p">()),</span>
</span><span id="L-530"><a href="#L-530"><span class="linenos"> 530</span></a>                    <span class="s1">&#39;t_evening&#39;</span><span class="p">:</span><span class="n">datetime</span><span class="o">.</span><span class="n">combine</span><span class="p">(</span><span class="n">next_monday</span><span class="o">+</span><span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span> <span class="n">evening_departure</span><span class="o">.</span><span class="n">time</span><span class="p">()),</span>
</span><span id="L-531"><a href="#L-531"><span class="linenos"> 531</span></a>                    <span class="s1">&#39;w_morning&#39;</span><span class="p">:</span><span class="n">datetime</span><span class="o">.</span><span class="n">combine</span><span class="p">(</span><span class="n">next_monday</span><span class="o">+</span><span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">2</span><span class="p">),</span> <span class="n">morning_departure</span><span class="o">.</span><span class="n">time</span><span class="p">()),</span>
</span><span id="L-532"><a href="#L-532"><span class="linenos"> 532</span></a>                    <span class="s1">&#39;w_evening&#39;</span><span class="p">:</span><span class="n">datetime</span><span class="o">.</span><span class="n">combine</span><span class="p">(</span><span class="n">next_monday</span><span class="o">+</span><span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">2</span><span class="p">),</span> <span class="n">evening_departure</span><span class="o">.</span><span class="n">time</span><span class="p">()),</span>
</span><span id="L-533"><a href="#L-533"><span class="linenos"> 533</span></a>                    <span class="s1">&#39;h_morning&#39;</span><span class="p">:</span><span class="n">datetime</span><span class="o">.</span><span class="n">combine</span><span class="p">(</span><span class="n">next_monday</span><span class="o">+</span><span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">3</span><span class="p">),</span> <span class="n">morning_departure</span><span class="o">.</span><span class="n">time</span><span class="p">()),</span>
</span><span id="L-534"><a href="#L-534"><span class="linenos"> 534</span></a>                    <span class="s1">&#39;h_evening&#39;</span><span class="p">:</span><span class="n">datetime</span><span class="o">.</span><span class="n">combine</span><span class="p">(</span><span class="n">next_monday</span><span class="o">+</span><span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">3</span><span class="p">),</span> <span class="n">evening_departure</span><span class="o">.</span><span class="n">time</span><span class="p">()),</span>
</span><span id="L-535"><a href="#L-535"><span class="linenos"> 535</span></a>                    <span class="s1">&#39;f_morning&#39;</span><span class="p">:</span><span class="n">datetime</span><span class="o">.</span><span class="n">combine</span><span class="p">(</span><span class="n">next_monday</span><span class="o">+</span><span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">4</span><span class="p">),</span> <span class="n">morning_departure</span><span class="o">.</span><span class="n">time</span><span class="p">()),</span>
</span><span id="L-536"><a href="#L-536"><span class="linenos"> 536</span></a>                    <span class="s1">&#39;f_evening&#39;</span><span class="p">:</span><span class="n">datetime</span><span class="o">.</span><span class="n">combine</span><span class="p">(</span><span class="n">next_monday</span><span class="o">+</span><span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">4</span><span class="p">),</span> <span class="n">evening_departure</span><span class="o">.</span><span class="n">time</span><span class="p">())</span>
</span><span id="L-537"><a href="#L-537"><span class="linenos"> 537</span></a>                    <span class="p">}</span>
</span><span id="L-538"><a href="#L-538"><span class="linenos"> 538</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-539"><a href="#L-539"><span class="linenos"> 539</span></a><span class="sd">        &quot;commute_data.csv&quot;: [&quot;office_address&quot;,&quot;origin_lat&quot;, &quot;origin_long&quot;, &quot;destination_lat&quot;, &quot;destination_long&quot;, </span>
</span><span id="L-540"><a href="#L-540"><span class="linenos"> 540</span></a><span class="sd">                                 &quot;miles&quot;, &quot;duration&quot;, &quot;emissions&quot;, &quot;commute_cost&quot;,</span>
</span><span id="L-541"><a href="#L-541"><span class="linenos"> 541</span></a><span class="sd">                                 &quot;m_morning_duration_in_traffic&quot;, </span>
</span><span id="L-542"><a href="#L-542"><span class="linenos"> 542</span></a><span class="sd">                                 &quot;m_morning_emissions&quot;, </span>
</span><span id="L-543"><a href="#L-543"><span class="linenos"> 543</span></a><span class="sd">                                 &quot;m_evening_duration_in_traffic&quot;, </span>
</span><span id="L-544"><a href="#L-544"><span class="linenos"> 544</span></a><span class="sd">                                 &quot;m_evening_emissions&quot;,</span>
</span><span id="L-545"><a href="#L-545"><span class="linenos"> 545</span></a><span class="sd">                                 &quot;t_morning_duration_in_traffic&quot;, </span>
</span><span id="L-546"><a href="#L-546"><span class="linenos"> 546</span></a><span class="sd">                                 &quot;t_morning_emissions&quot;, </span>
</span><span id="L-547"><a href="#L-547"><span class="linenos"> 547</span></a><span class="sd">                                 &quot;t_evening_duration_in_traffic&quot;, </span>
</span><span id="L-548"><a href="#L-548"><span class="linenos"> 548</span></a><span class="sd">                                 &quot;t_evening_emissions&quot;,</span>
</span><span id="L-549"><a href="#L-549"><span class="linenos"> 549</span></a><span class="sd">                                 &quot;w_morning_duration_in_traffic&quot;, </span>
</span><span id="L-550"><a href="#L-550"><span class="linenos"> 550</span></a><span class="sd">                                 &quot;w_morning_emissions&quot;, </span>
</span><span id="L-551"><a href="#L-551"><span class="linenos"> 551</span></a><span class="sd">                                 &quot;w_evening_duration_in_traffic&quot;, </span>
</span><span id="L-552"><a href="#L-552"><span class="linenos"> 552</span></a><span class="sd">                                 &quot;w_evening_emissions&quot;,</span>
</span><span id="L-553"><a href="#L-553"><span class="linenos"> 553</span></a><span class="sd">                                 &quot;h_morning_duration_in_traffic&quot;, </span>
</span><span id="L-554"><a href="#L-554"><span class="linenos"> 554</span></a><span class="sd">                                 &quot;h_morning_emissions&quot;, </span>
</span><span id="L-555"><a href="#L-555"><span class="linenos"> 555</span></a><span class="sd">                                 &quot;h_evening_duration_in_traffic&quot;, </span>
</span><span id="L-556"><a href="#L-556"><span class="linenos"> 556</span></a><span class="sd">                                 &quot;h_evening_emissions&quot;,</span>
</span><span id="L-557"><a href="#L-557"><span class="linenos"> 557</span></a><span class="sd">                                 &quot;f_morning_duration_in_traffic&quot;, </span>
</span><span id="L-558"><a href="#L-558"><span class="linenos"> 558</span></a><span class="sd">                                 &quot;f_morning_emissions&quot;, </span>
</span><span id="L-559"><a href="#L-559"><span class="linenos"> 559</span></a><span class="sd">                                 &quot;f_evening_duration_in_traffic&quot;, </span>
</span><span id="L-560"><a href="#L-560"><span class="linenos"> 560</span></a><span class="sd">                                 &quot;f_evening_emissions&quot;]</span>
</span><span id="L-561"><a href="#L-561"><span class="linenos"> 561</span></a><span class="sd">        &quot;&quot;&quot;</span>       
</span><span id="L-562"><a href="#L-562"><span class="linenos"> 562</span></a>        <span class="c1"># for each office location</span>
</span><span id="L-563"><a href="#L-563"><span class="linenos"> 563</span></a>        <span class="n">data_key</span> <span class="o">=</span> <span class="s2">&quot;employee_gps.csv&quot;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">use_gps_fuzzing</span><span class="o">==</span><span class="kc">False</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">use_gps_fuzzing</span><span class="o">==</span><span class="kc">False</span> <span class="k">else</span> <span class="s2">&quot;gps_fuzz.csv&quot;</span>
</span><span id="L-564"><a href="#L-564"><span class="linenos"> 564</span></a>        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;office_gps.csv&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
</span><span id="L-565"><a href="#L-565"><span class="linenos"> 565</span></a>            <span class="c1"># for each employee+</span>
</span><span id="L-566"><a href="#L-566"><span class="linenos"> 566</span></a>            <span class="k">for</span> <span class="n">index2</span><span class="p">,</span> <span class="n">row2</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">data_key</span><span class="p">]</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
</span><span id="L-567"><a href="#L-567"><span class="linenos"> 567</span></a>                <span class="n">data_row</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;commute_data.csv&quot;</span><span class="p">])</span>
</span><span id="L-568"><a href="#L-568"><span class="linenos"> 568</span></a>                <span class="c1"># create a row in the dataframe for this employee to this office, add initial data, use -1 for all incomplete calculations</span>
</span><span id="L-569"><a href="#L-569"><span class="linenos"> 569</span></a>                <span class="n">val</span><span class="o">=</span> <span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;address&quot;</span><span class="p">],</span><span class="n">row2</span><span class="p">[</span><span class="s2">&quot;latitude&quot;</span><span class="p">],</span> <span class="n">row2</span><span class="p">[</span><span class="s2">&quot;longitude&quot;</span><span class="p">],</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;latitude&quot;</span><span class="p">],</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;longitude&quot;</span><span class="p">]]</span> <span class="o">+</span> <span class="p">[</span><span class="o">-</span><span class="mf">1.0</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">24</span><span class="p">)]</span>
</span><span id="L-570"><a href="#L-570"><span class="linenos"> 570</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;commute_data.csv&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">data_row</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span>
</span><span id="L-571"><a href="#L-571"><span class="linenos"> 571</span></a>                <span class="c1"># calculate the commute time for this employee to this office</span>
</span><span id="L-572"><a href="#L-572"><span class="linenos"> 572</span></a>                <span class="k">for</span> <span class="n">day</span> <span class="ow">in</span> <span class="n">days</span><span class="p">:</span>
</span><span id="L-573"><a href="#L-573"><span class="linenos"> 573</span></a>                    <span class="k">for</span> <span class="n">time</span> <span class="ow">in</span> <span class="n">times</span><span class="p">:</span>
</span><span id="L-574"><a href="#L-574"><span class="linenos"> 574</span></a>                        <span class="c1"># log iff logging</span>
</span><span id="L-575"><a href="#L-575"><span class="linenos"> 575</span></a>                        <span class="c1"># create source and destination placeholders</span>
</span><span id="L-576"><a href="#L-576"><span class="linenos"> 576</span></a>                        <span class="k">if</span> <span class="s2">&quot;evening&quot;</span> <span class="ow">in</span> <span class="n">time</span><span class="p">:</span>
</span><span id="L-577"><a href="#L-577"><span class="linenos"> 577</span></a>                            <span class="n">source</span> <span class="o">=</span> <span class="p">(</span><span class="n">row2</span><span class="p">[</span><span class="s2">&quot;latitude&quot;</span><span class="p">],</span><span class="n">row2</span><span class="p">[</span><span class="s2">&quot;longitude&quot;</span><span class="p">])</span>
</span><span id="L-578"><a href="#L-578"><span class="linenos"> 578</span></a>                            <span class="n">destination</span> <span class="o">=</span> <span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;latitude&quot;</span><span class="p">],</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;longitude&quot;</span><span class="p">])</span>
</span><span id="L-579"><a href="#L-579"><span class="linenos"> 579</span></a>                        <span class="k">else</span><span class="p">:</span>
</span><span id="L-580"><a href="#L-580"><span class="linenos"> 580</span></a>                            <span class="n">source</span> <span class="o">=</span> <span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;latitude&quot;</span><span class="p">],</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;longitude&quot;</span><span class="p">])</span>
</span><span id="L-581"><a href="#L-581"><span class="linenos"> 581</span></a>                            <span class="n">destination</span> <span class="o">=</span> <span class="p">(</span><span class="n">row2</span><span class="p">[</span><span class="s2">&quot;latitude&quot;</span><span class="p">],</span><span class="n">row2</span><span class="p">[</span><span class="s2">&quot;longitude&quot;</span><span class="p">])</span>
</span><span id="L-582"><a href="#L-582"><span class="linenos"> 582</span></a>                        <span class="k">if</span> <span class="n">log_csv</span><span class="p">:</span> 
</span><span id="L-583"><a href="#L-583"><span class="linenos"> 583</span></a>                            <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Calculating commute time for &quot;</span> <span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">source</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">+</span><span class="s2">&quot;,&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">source</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">+</span><span class="s2">&quot; to &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">destination</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">+</span><span class="s2">&quot;,&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">destination</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">+</span><span class="s2">&quot; at &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">commutes</span><span class="p">[</span><span class="n">day</span><span class="o">+</span><span class="s2">&quot;_&quot;</span><span class="o">+</span><span class="n">time</span><span class="p">])</span><span class="o">+</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-584"><a href="#L-584"><span class="linenos"> 584</span></a>                            <span class="n">log</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
</span><span id="L-585"><a href="#L-585"><span class="linenos"> 585</span></a>                        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Calculating commute time for &quot;</span> <span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">source</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">+</span><span class="s2">&quot;,&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">source</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">+</span><span class="s2">&quot; to &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">destination</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">+</span><span class="s2">&quot;,&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">destination</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">+</span><span class="s2">&quot; at &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">commutes</span><span class="p">[</span><span class="n">day</span><span class="o">+</span><span class="s2">&quot;_&quot;</span><span class="o">+</span><span class="n">time</span><span class="p">])</span><span class="o">+</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-586"><a href="#L-586"><span class="linenos"> 586</span></a>                        <span class="c1"># sleep if necessary for rate limit</span>
</span><span id="L-587"><a href="#L-587"><span class="linenos"> 587</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">sleepif</span><span class="p">()</span>
</span><span id="L-588"><a href="#L-588"><span class="linenos"> 588</span></a>                        <span class="k">try</span><span class="p">:</span>
</span><span id="L-589"><a href="#L-589"><span class="linenos"> 589</span></a>                            <span class="c1"># get the commute time</span>
</span><span id="L-590"><a href="#L-590"><span class="linenos"> 590</span></a>                            <span class="n">commute</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gAPI</span><span class="o">.</span><span class="n">commute</span><span class="p">((</span><span class="n">source</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">source</span><span class="p">[</span><span class="mi">1</span><span class="p">]),(</span><span class="n">destination</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">destination</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span><span class="n">commutes</span><span class="p">[</span><span class="n">day</span><span class="o">+</span><span class="s2">&quot;_&quot;</span><span class="o">+</span><span class="n">time</span><span class="p">])</span>
</span><span id="L-591"><a href="#L-591"><span class="linenos"> 591</span></a>                        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="L-592"><a href="#L-592"><span class="linenos"> 592</span></a>                            <span class="c1"># if logging, write the exception event to the logfile</span>
</span><span id="L-593"><a href="#L-593"><span class="linenos"> 593</span></a>                            <span class="k">if</span> <span class="n">log_csv</span><span class="p">:</span>
</span><span id="L-594"><a href="#L-594"><span class="linenos"> 594</span></a>                                <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Exception calling commute function: &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-595"><a href="#L-595"><span class="linenos"> 595</span></a>                                <span class="n">log</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
</span><span id="L-596"><a href="#L-596"><span class="linenos"> 596</span></a>                            <span class="bp">self</span><span class="o">.</span><span class="n">log_error</span><span class="p">(</span><span class="s2">&quot;Exception calling commute function: &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-597"><a href="#L-597"><span class="linenos"> 597</span></a>                            <span class="c1"># if the excetion is a recoverable one, retry after a delay, else raise the exception</span>
</span><span id="L-598"><a href="#L-598"><span class="linenos"> 598</span></a>                            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">handle_GAPI_exception</span><span class="p">(</span><span class="n">e</span><span class="p">):</span>
</span><span id="L-599"><a href="#L-599"><span class="linenos"> 599</span></a>                                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;recoverable exception, waiting to retry once&quot;</span><span class="p">)</span>
</span><span id="L-600"><a href="#L-600"><span class="linenos"> 600</span></a>                                <span class="n">sleep</span><span class="p">(</span><span class="mi">10000</span><span class="p">)</span>
</span><span id="L-601"><a href="#L-601"><span class="linenos"> 601</span></a>                                <span class="k">try</span><span class="p">:</span>
</span><span id="L-602"><a href="#L-602"><span class="linenos"> 602</span></a>                                    <span class="n">commute</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gAPI</span><span class="o">.</span><span class="n">commute</span><span class="p">((</span><span class="n">source</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">source</span><span class="p">[</span><span class="mi">1</span><span class="p">]),(</span><span class="n">destination</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span><span class="n">destination</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span><span class="n">commutes</span><span class="p">[</span><span class="n">day</span><span class="o">+</span><span class="s2">&quot;_&quot;</span><span class="o">+</span><span class="n">time</span><span class="p">])</span>
</span><span id="L-603"><a href="#L-603"><span class="linenos"> 603</span></a>                                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="L-604"><a href="#L-604"><span class="linenos"> 604</span></a>                                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Recoverable exception, tried twice skipping address, deemed unrecoverable. &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-605"><a href="#L-605"><span class="linenos"> 605</span></a>                                    <span class="c1"># if logging, write the exception event to the logfile</span>
</span><span id="L-606"><a href="#L-606"><span class="linenos"> 606</span></a>                                    <span class="bp">self</span><span class="o">.</span><span class="n">log_error</span><span class="p">(</span><span class="s2">&quot;Recoverable error calling commute function, failed twice. Deemed unrecoverable. Exception: &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-607"><a href="#L-607"><span class="linenos"> 607</span></a>                                    <span class="n">e</span><span class="o">.</span><span class="n">add_note</span> <span class="o">=</span> <span class="s2">&quot;Recoverable error calling commute function, failed twice. Deemed unrecoverable&quot;</span>
</span><span id="L-608"><a href="#L-608"><span class="linenos"> 608</span></a>                                    <span class="k">raise</span> <span class="n">e</span>
</span><span id="L-609"><a href="#L-609"><span class="linenos"> 609</span></a>                            <span class="k">else</span><span class="p">:</span>
</span><span id="L-610"><a href="#L-610"><span class="linenos"> 610</span></a>                                <span class="c1"># print the full stack trace and raise e</span>
</span><span id="L-611"><a href="#L-611"><span class="linenos"> 611</span></a>                                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Unrecoverable unknown exception, tried once. &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-612"><a href="#L-612"><span class="linenos"> 612</span></a>                                <span class="c1"># if logging, write the exception event to the logfile</span>
</span><span id="L-613"><a href="#L-613"><span class="linenos"> 613</span></a>                                <span class="bp">self</span><span class="o">.</span><span class="n">log_error</span><span class="p">(</span><span class="s2">&quot;Unrecoverable error calling commute function, failed once. Exception: &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-614"><a href="#L-614"><span class="linenos"> 614</span></a>                                <span class="n">e</span><span class="o">.</span><span class="n">add_note</span> <span class="o">=</span> <span class="s2">&quot;Unrecoverable error calling commute function, failed once&quot;</span>
</span><span id="L-615"><a href="#L-615"><span class="linenos"> 615</span></a>                                <span class="k">raise</span> <span class="n">e</span>
</span><span id="L-616"><a href="#L-616"><span class="linenos"> 616</span></a>                        <span class="k">try</span><span class="p">:</span>
</span><span id="L-617"><a href="#L-617"><span class="linenos"> 617</span></a>                            <span class="c1"># Update the row in the dataframe with the commute time</span>
</span><span id="L-618"><a href="#L-618"><span class="linenos"> 618</span></a>                            <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;commute_data.csv&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">data_row</span><span class="p">,</span><span class="n">day</span><span class="o">+</span><span class="s2">&quot;_&quot;</span><span class="o">+</span><span class="n">time</span><span class="o">+</span><span class="s2">&quot;_duration_in_traffic&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">convert_stringtime_to_minutes</span><span class="p">(</span><span class="n">commute</span><span class="p">[</span><span class="s2">&quot;duration_in_traffic&quot;</span><span class="p">]))</span>
</span><span id="L-619"><a href="#L-619"><span class="linenos"> 619</span></a>                            <span class="c1"># if this is the first time through, insert the distance and duration into the dataframe</span>
</span><span id="L-620"><a href="#L-620"><span class="linenos"> 620</span></a>                            <span class="k">if</span> <span class="n">day</span> <span class="o">==</span> <span class="s2">&quot;m&quot;</span> <span class="ow">and</span> <span class="n">time</span> <span class="o">==</span> <span class="s2">&quot;morning&quot;</span><span class="p">:</span>
</span><span id="L-621"><a href="#L-621"><span class="linenos"> 621</span></a>                                <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;commute_data.csv&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">data_row</span><span class="p">,</span><span class="s2">&quot;miles&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">convert_stringdistance_to_d</span><span class="p">(</span><span class="n">commute</span><span class="p">[</span><span class="s2">&quot;distance&quot;</span><span class="p">]))</span>
</span><span id="L-622"><a href="#L-622"><span class="linenos"> 622</span></a>                                <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;commute_data.csv&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">data_row</span><span class="p">,</span><span class="s2">&quot;duration&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">convert_stringtime_to_minutes</span><span class="p">(</span><span class="n">commute</span><span class="p">[</span><span class="s2">&quot;duration&quot;</span><span class="p">]))</span>
</span><span id="L-623"><a href="#L-623"><span class="linenos"> 623</span></a>                        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="L-624"><a href="#L-624"><span class="linenos"> 624</span></a>                            <span class="c1"># if logging, write the exception event to the logfile</span>
</span><span id="L-625"><a href="#L-625"><span class="linenos"> 625</span></a>                            <span class="k">if</span> <span class="n">log_csv</span><span class="p">:</span>
</span><span id="L-626"><a href="#L-626"><span class="linenos"> 626</span></a>                                <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Exception updating commute data: &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-627"><a href="#L-627"><span class="linenos"> 627</span></a>                                <span class="n">log</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
</span><span id="L-628"><a href="#L-628"><span class="linenos"> 628</span></a>                            <span class="bp">self</span><span class="o">.</span><span class="n">log_error</span><span class="p">(</span><span class="s2">&quot;Exception updating commute data: &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-629"><a href="#L-629"><span class="linenos"> 629</span></a>                            <span class="n">e</span><span class="o">.</span><span class="n">add_note</span> <span class="o">=</span> <span class="s2">&quot;Exception updating commute data after calling commute function.&quot;</span>
</span><span id="L-630"><a href="#L-630"><span class="linenos"> 630</span></a>                            <span class="k">raise</span> <span class="n">e</span>
</span><span id="L-631"><a href="#L-631"><span class="linenos"> 631</span></a>                        
</span><span id="L-632"><a href="#L-632"><span class="linenos"> 632</span></a>        <span class="c1"># save the project data object to the csv file</span>
</span><span id="L-633"><a href="#L-633"><span class="linenos"> 633</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">save_data_file</span><span class="p">(</span><span class="s2">&quot;commute_data.csv&quot;</span><span class="p">)</span>
</span><span id="L-634"><a href="#L-634"><span class="linenos"> 634</span></a>
</span><span id="L-635"><a href="#L-635"><span class="linenos"> 635</span></a>
</span><span id="L-636"><a href="#L-636"><span class="linenos"> 636</span></a>    <span class="k">def</span> <span class="nf">convert_stringtime_to_minutes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">time_string</span><span class="p">):</span>
</span><span id="L-637"><a href="#L-637"><span class="linenos"> 637</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-638"><a href="#L-638"><span class="linenos"> 638</span></a><span class="sd">        Converts a string representing distance into miles.</span>
</span><span id="L-639"><a href="#L-639"><span class="linenos"> 639</span></a>
</span><span id="L-640"><a href="#L-640"><span class="linenos"> 640</span></a><span class="sd">        Parses a string for distance measurements expressed in various units (miles, kilometers, meters, etc.) and converts </span>
</span><span id="L-641"><a href="#L-641"><span class="linenos"> 641</span></a><span class="sd">        the total distance into miles.</span>
</span><span id="L-642"><a href="#L-642"><span class="linenos"> 642</span></a>
</span><span id="L-643"><a href="#L-643"><span class="linenos"> 643</span></a><span class="sd">        Args:</span>
</span><span id="L-644"><a href="#L-644"><span class="linenos"> 644</span></a><span class="sd">            distance_string (str): The distance string to convert.</span>
</span><span id="L-645"><a href="#L-645"><span class="linenos"> 645</span></a>
</span><span id="L-646"><a href="#L-646"><span class="linenos"> 646</span></a><span class="sd">        Returns:</span>
</span><span id="L-647"><a href="#L-647"><span class="linenos"> 647</span></a><span class="sd">            float: The total distance in miles.</span>
</span><span id="L-648"><a href="#L-648"><span class="linenos"> 648</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-649"><a href="#L-649"><span class="linenos"> 649</span></a>
</span><span id="L-650"><a href="#L-650"><span class="linenos"> 650</span></a>        <span class="c1"># Regular expression to find all occurrences of numbers followed by time units</span>
</span><span id="L-651"><a href="#L-651"><span class="linenos"> 651</span></a>        <span class="n">matches</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;(\d+)\s*(hour|minute|second|min|sec|hrs|hours|minutes|mins|seconds)s?&#39;</span><span class="p">,</span> <span class="n">time_string</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">)</span>
</span><span id="L-652"><a href="#L-652"><span class="linenos"> 652</span></a>        
</span><span id="L-653"><a href="#L-653"><span class="linenos"> 653</span></a>        <span class="c1"># Initialize a dictionary to hold our time values</span>
</span><span id="L-654"><a href="#L-654"><span class="linenos"> 654</span></a>        <span class="n">time_values</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;hours&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;minutes&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;seconds&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>
</span><span id="L-655"><a href="#L-655"><span class="linenos"> 655</span></a>        
</span><span id="L-656"><a href="#L-656"><span class="linenos"> 656</span></a>        <span class="c1"># Loop through all matches and update the time_values dictionary accordingly</span>
</span><span id="L-657"><a href="#L-657"><span class="linenos"> 657</span></a>        <span class="k">for</span> <span class="n">amount</span><span class="p">,</span> <span class="n">unit</span> <span class="ow">in</span> <span class="n">matches</span><span class="p">:</span>
</span><span id="L-658"><a href="#L-658"><span class="linenos"> 658</span></a>            <span class="k">if</span> <span class="n">unit</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;hour&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">unit</span> <span class="o">==</span> <span class="s1">&#39;hrs&#39;</span><span class="p">:</span>
</span><span id="L-659"><a href="#L-659"><span class="linenos"> 659</span></a>                <span class="n">time_values</span><span class="p">[</span><span class="s1">&#39;hours&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="nb">int</span><span class="p">(</span><span class="n">amount</span><span class="p">)</span>
</span><span id="L-660"><a href="#L-660"><span class="linenos"> 660</span></a>            <span class="k">elif</span> <span class="n">unit</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;min&#39;</span><span class="p">):</span>
</span><span id="L-661"><a href="#L-661"><span class="linenos"> 661</span></a>                <span class="n">time_values</span><span class="p">[</span><span class="s1">&#39;minutes&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="nb">int</span><span class="p">(</span><span class="n">amount</span><span class="p">)</span>
</span><span id="L-662"><a href="#L-662"><span class="linenos"> 662</span></a>            <span class="k">elif</span> <span class="n">unit</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;sec&#39;</span><span class="p">):</span>
</span><span id="L-663"><a href="#L-663"><span class="linenos"> 663</span></a>                <span class="n">time_values</span><span class="p">[</span><span class="s1">&#39;seconds&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="nb">int</span><span class="p">(</span><span class="n">amount</span><span class="p">)</span>
</span><span id="L-664"><a href="#L-664"><span class="linenos"> 664</span></a>        
</span><span id="L-665"><a href="#L-665"><span class="linenos"> 665</span></a>        <span class="c1"># create an integer to hold the total minutes</span>
</span><span id="L-666"><a href="#L-666"><span class="linenos"> 666</span></a>        <span class="n">total_minutes</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-667"><a href="#L-667"><span class="linenos"> 667</span></a>        <span class="c1"># sum the hours and minutes into total minutes</span>
</span><span id="L-668"><a href="#L-668"><span class="linenos"> 668</span></a>        <span class="n">total_minutes</span> <span class="o">+=</span> <span class="n">time_values</span><span class="p">[</span><span class="s1">&#39;hours&#39;</span><span class="p">]</span><span class="o">*</span><span class="mi">60</span>
</span><span id="L-669"><a href="#L-669"><span class="linenos"> 669</span></a>        <span class="n">total_minutes</span> <span class="o">+=</span> <span class="n">time_values</span><span class="p">[</span><span class="s1">&#39;minutes&#39;</span><span class="p">]</span>
</span><span id="L-670"><a href="#L-670"><span class="linenos"> 670</span></a>        <span class="k">return</span> <span class="n">total_minutes</span>
</span><span id="L-671"><a href="#L-671"><span class="linenos"> 671</span></a>
</span><span id="L-672"><a href="#L-672"><span class="linenos"> 672</span></a>
</span><span id="L-673"><a href="#L-673"><span class="linenos"> 673</span></a>    <span class="k">def</span> <span class="nf">convert_stringdistance_to_d</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">distance_string</span><span class="p">):</span>
</span><span id="L-674"><a href="#L-674"><span class="linenos"> 674</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-675"><a href="#L-675"><span class="linenos"> 675</span></a><span class="sd">        Converts a string representing distance into miles.</span>
</span><span id="L-676"><a href="#L-676"><span class="linenos"> 676</span></a>
</span><span id="L-677"><a href="#L-677"><span class="linenos"> 677</span></a><span class="sd">        Parses a string for distance measurements expressed in various units (miles, kilometers, meters, etc.) and converts </span>
</span><span id="L-678"><a href="#L-678"><span class="linenos"> 678</span></a><span class="sd">        the total distance into miles.</span>
</span><span id="L-679"><a href="#L-679"><span class="linenos"> 679</span></a>
</span><span id="L-680"><a href="#L-680"><span class="linenos"> 680</span></a><span class="sd">        Args:</span>
</span><span id="L-681"><a href="#L-681"><span class="linenos"> 681</span></a><span class="sd">            distance_string (str): The distance string to convert.</span>
</span><span id="L-682"><a href="#L-682"><span class="linenos"> 682</span></a>
</span><span id="L-683"><a href="#L-683"><span class="linenos"> 683</span></a><span class="sd">        Returns:</span>
</span><span id="L-684"><a href="#L-684"><span class="linenos"> 684</span></a><span class="sd">            float: The total distance in miles.</span>
</span><span id="L-685"><a href="#L-685"><span class="linenos"> 685</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-686"><a href="#L-686"><span class="linenos"> 686</span></a>
</span><span id="L-687"><a href="#L-687"><span class="linenos"> 687</span></a>        <span class="c1"># Regular expression to find all occurrences of numbers followed by distance units</span>
</span><span id="L-688"><a href="#L-688"><span class="linenos"> 688</span></a>        <span class="n">matches</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;(\b\d+(?:\.\d+)?)\s*(mile|kilometer|meter|foot|yard|inch|mi|km|m|ft|yd|in)s?&#39;</span><span class="p">,</span> <span class="n">distance_string</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">)</span>
</span><span id="L-689"><a href="#L-689"><span class="linenos"> 689</span></a>        
</span><span id="L-690"><a href="#L-690"><span class="linenos"> 690</span></a>        <span class="c1"># Initialize a dictionary to hold our distance values</span>
</span><span id="L-691"><a href="#L-691"><span class="linenos"> 691</span></a>        <span class="n">distance_values</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;miles&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;kilometers&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;meters&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;feet&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;yards&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;inches&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>
</span><span id="L-692"><a href="#L-692"><span class="linenos"> 692</span></a>        <span class="c1"># Loop through all matches and update the distance_values dictionary accordingly</span>
</span><span id="L-693"><a href="#L-693"><span class="linenos"> 693</span></a>        <span class="k">for</span> <span class="n">amount</span><span class="p">,</span> <span class="n">unit</span> <span class="ow">in</span> <span class="n">matches</span><span class="p">:</span>
</span><span id="L-694"><a href="#L-694"><span class="linenos"> 694</span></a>            <span class="k">if</span> <span class="n">unit</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;mile&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">unit</span> <span class="o">==</span> <span class="s1">&#39;mi&#39;</span><span class="p">:</span>
</span><span id="L-695"><a href="#L-695"><span class="linenos"> 695</span></a>                <span class="n">distance_values</span><span class="p">[</span><span class="s1">&#39;miles&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="nb">float</span><span class="p">(</span><span class="n">amount</span><span class="p">)</span>
</span><span id="L-696"><a href="#L-696"><span class="linenos"> 696</span></a>            <span class="k">elif</span> <span class="n">unit</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;kilometer&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">unit</span> <span class="o">==</span> <span class="s1">&#39;km&#39;</span><span class="p">:</span>
</span><span id="L-697"><a href="#L-697"><span class="linenos"> 697</span></a>                <span class="n">distance_values</span><span class="p">[</span><span class="s1">&#39;kilometers&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="nb">float</span><span class="p">(</span><span class="n">amount</span><span class="p">)</span>
</span><span id="L-698"><a href="#L-698"><span class="linenos"> 698</span></a>            <span class="k">elif</span> <span class="n">unit</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;meter&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">unit</span> <span class="o">==</span> <span class="s1">&#39;m&#39;</span><span class="p">:</span>
</span><span id="L-699"><a href="#L-699"><span class="linenos"> 699</span></a>                <span class="n">distance_values</span><span class="p">[</span><span class="s1">&#39;meters&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="nb">float</span><span class="p">(</span><span class="n">amount</span><span class="p">)</span>
</span><span id="L-700"><a href="#L-700"><span class="linenos"> 700</span></a>            <span class="k">elif</span> <span class="n">unit</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;foot&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">unit</span> <span class="o">==</span> <span class="s1">&#39;ft&#39;</span><span class="p">:</span>
</span><span id="L-701"><a href="#L-701"><span class="linenos"> 701</span></a>                <span class="n">distance_values</span><span class="p">[</span><span class="s1">&#39;feet&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="nb">float</span><span class="p">(</span><span class="n">amount</span><span class="p">)</span>
</span><span id="L-702"><a href="#L-702"><span class="linenos"> 702</span></a>            <span class="k">elif</span> <span class="n">unit</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;yard&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">unit</span> <span class="o">==</span> <span class="s1">&#39;yd&#39;</span><span class="p">:</span>
</span><span id="L-703"><a href="#L-703"><span class="linenos"> 703</span></a>                <span class="n">distance_values</span><span class="p">[</span><span class="s1">&#39;yards&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="nb">float</span><span class="p">(</span><span class="n">amount</span><span class="p">)</span>
</span><span id="L-704"><a href="#L-704"><span class="linenos"> 704</span></a>            <span class="k">elif</span> <span class="n">unit</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;inch&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">unit</span> <span class="o">==</span> <span class="s1">&#39;in&#39;</span><span class="p">:</span>
</span><span id="L-705"><a href="#L-705"><span class="linenos"> 705</span></a>                <span class="n">distance_values</span><span class="p">[</span><span class="s1">&#39;inches&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="nb">float</span><span class="p">(</span><span class="n">amount</span><span class="p">)</span>
</span><span id="L-706"><a href="#L-706"><span class="linenos"> 706</span></a>        
</span><span id="L-707"><a href="#L-707"><span class="linenos"> 707</span></a>        <span class="c1"># create an integer to hold the total miles</span>
</span><span id="L-708"><a href="#L-708"><span class="linenos"> 708</span></a>        <span class="n">total_miles</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-709"><a href="#L-709"><span class="linenos"> 709</span></a>        <span class="c1"># sum the miles into total miles</span>
</span><span id="L-710"><a href="#L-710"><span class="linenos"> 710</span></a>        <span class="n">total_miles</span> <span class="o">+=</span> <span class="n">distance_values</span><span class="p">[</span><span class="s1">&#39;miles&#39;</span><span class="p">]</span>
</span><span id="L-711"><a href="#L-711"><span class="linenos"> 711</span></a>        <span class="k">return</span> <span class="n">total_miles</span>
</span><span id="L-712"><a href="#L-712"><span class="linenos"> 712</span></a>    
</span><span id="L-713"><a href="#L-713"><span class="linenos"> 713</span></a>    <span class="k">def</span> <span class="nf">get_commute_cost</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="L-714"><a href="#L-714"><span class="linenos"> 714</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-715"><a href="#L-715"><span class="linenos"> 715</span></a><span class="sd">        Updates the commute data with calculated commute costs based on distances.</span>
</span><span id="L-716"><a href="#L-716"><span class="linenos"> 716</span></a>
</span><span id="L-717"><a href="#L-717"><span class="linenos"> 717</span></a><span class="sd">        Commute costs are calculated using the project&#39;s specified mileage rate applied to the commute distances for each employee.</span>
</span><span id="L-718"><a href="#L-718"><span class="linenos"> 718</span></a>
</span><span id="L-719"><a href="#L-719"><span class="linenos"> 719</span></a><span class="sd">        Args:</span>
</span><span id="L-720"><a href="#L-720"><span class="linenos"> 720</span></a><span class="sd">            force (bool, optional): If True, forces recalculation of commute costs even if they are already calculated. Defaults to False.</span>
</span><span id="L-721"><a href="#L-721"><span class="linenos"> 721</span></a>
</span><span id="L-722"><a href="#L-722"><span class="linenos"> 722</span></a><span class="sd">        Returns:</span>
</span><span id="L-723"><a href="#L-723"><span class="linenos"> 723</span></a><span class="sd">            bool: True if commute costs are successfully calculated; False otherwise.</span>
</span><span id="L-724"><a href="#L-724"><span class="linenos"> 724</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-725"><a href="#L-725"><span class="linenos"> 725</span></a>        <span class="c1"># update the commute data to calculate the commute cost</span>
</span><span id="L-726"><a href="#L-726"><span class="linenos"> 726</span></a>        <span class="k">if</span> <span class="s2">&quot;commute_data.csv&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">list_data_files</span><span class="p">():</span>
</span><span id="L-727"><a href="#L-727"><span class="linenos"> 727</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;commute_data.csv&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">force</span><span class="p">:</span>
</span><span id="L-728"><a href="#L-728"><span class="linenos"> 728</span></a>                <span class="c1"># attempt to load the commute data</span>
</span><span id="L-729"><a href="#L-729"><span class="linenos"> 729</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">load_data_file</span><span class="p">(</span><span class="s2">&quot;commute_data.csv&quot;</span><span class="p">):</span>
</span><span id="L-730"><a href="#L-730"><span class="linenos"> 730</span></a>                    <span class="k">pass</span>
</span><span id="L-731"><a href="#L-731"><span class="linenos"> 731</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="L-732"><a href="#L-732"><span class="linenos"> 732</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Errors loading commute data from project.&quot;</span><span class="p">)</span>
</span><span id="L-733"><a href="#L-733"><span class="linenos"> 733</span></a>                    <span class="k">return</span> <span class="kc">False</span>
</span><span id="L-734"><a href="#L-734"><span class="linenos"> 734</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-735"><a href="#L-735"><span class="linenos"> 735</span></a>                <span class="k">pass</span>
</span><span id="L-736"><a href="#L-736"><span class="linenos"> 736</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-737"><a href="#L-737"><span class="linenos"> 737</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Commute data missing from project.&quot;</span><span class="p">)</span>
</span><span id="L-738"><a href="#L-738"><span class="linenos"> 738</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="L-739"><a href="#L-739"><span class="linenos"> 739</span></a>        <span class="c1"># calculate the commute cost for each employee</span>
</span><span id="L-740"><a href="#L-740"><span class="linenos"> 740</span></a>        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;commute_data.csv&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
</span><span id="L-741"><a href="#L-741"><span class="linenos"> 741</span></a>            <span class="c1"># calculate the commute cost</span>
</span><span id="L-742"><a href="#L-742"><span class="linenos"> 742</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;commute_data.csv&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">index</span><span class="p">,</span><span class="s2">&quot;commute_cost&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;miles&quot;</span><span class="p">])</span> <span class="o">*</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">mileage_rate</span><span class="p">)</span>
</span><span id="L-743"><a href="#L-743"><span class="linenos"> 743</span></a>        <span class="c1"># save the project data object to the csv file</span>
</span><span id="L-744"><a href="#L-744"><span class="linenos"> 744</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">save_data_file</span><span class="p">(</span><span class="s2">&quot;commute_data.csv&quot;</span><span class="p">)</span>
</span><span id="L-745"><a href="#L-745"><span class="linenos"> 745</span></a>    
</span><span id="L-746"><a href="#L-746"><span class="linenos"> 746</span></a>    <span class="k">def</span> <span class="nf">get_commute_emissions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="L-747"><a href="#L-747"><span class="linenos"> 747</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-748"><a href="#L-748"><span class="linenos"> 748</span></a><span class="sd">        Calculates and updates commute data with emissions estimates based on commute distances.</span>
</span><span id="L-749"><a href="#L-749"><span class="linenos"> 749</span></a>
</span><span id="L-750"><a href="#L-750"><span class="linenos"> 750</span></a><span class="sd">        Commute emissions are calculated using the project&#39;s specified CO2 emissions per mile, applied to the commute distances </span>
</span><span id="L-751"><a href="#L-751"><span class="linenos"> 751</span></a><span class="sd">        for each employee. Optionally adjusts emissions based on traffic conditions.</span>
</span><span id="L-752"><a href="#L-752"><span class="linenos"> 752</span></a>
</span><span id="L-753"><a href="#L-753"><span class="linenos"> 753</span></a><span class="sd">        Args:</span>
</span><span id="L-754"><a href="#L-754"><span class="linenos"> 754</span></a><span class="sd">            force (bool, optional): If True, forces recalculation of commute emissions even if they are already calculated. Defaults to False.</span>
</span><span id="L-755"><a href="#L-755"><span class="linenos"> 755</span></a>
</span><span id="L-756"><a href="#L-756"><span class="linenos"> 756</span></a><span class="sd">        Returns:</span>
</span><span id="L-757"><a href="#L-757"><span class="linenos"> 757</span></a><span class="sd">            bool: True if commute emissions are successfully calculated; False otherwise.</span>
</span><span id="L-758"><a href="#L-758"><span class="linenos"> 758</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-759"><a href="#L-759"><span class="linenos"> 759</span></a>
</span><span id="L-760"><a href="#L-760"><span class="linenos"> 760</span></a>        <span class="c1"># update the commute data to calculate the commute emissions</span>
</span><span id="L-761"><a href="#L-761"><span class="linenos"> 761</span></a>        <span class="k">if</span> <span class="s2">&quot;commute_data.csv&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">list_data_files</span><span class="p">():</span>
</span><span id="L-762"><a href="#L-762"><span class="linenos"> 762</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;commute_data.csv&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">force</span><span class="p">:</span>
</span><span id="L-763"><a href="#L-763"><span class="linenos"> 763</span></a>                <span class="c1"># attempt to load the commute data</span>
</span><span id="L-764"><a href="#L-764"><span class="linenos"> 764</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">load_data_file</span><span class="p">(</span><span class="s2">&quot;commute_data.csv&quot;</span><span class="p">):</span>
</span><span id="L-765"><a href="#L-765"><span class="linenos"> 765</span></a>                    <span class="k">pass</span>
</span><span id="L-766"><a href="#L-766"><span class="linenos"> 766</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="L-767"><a href="#L-767"><span class="linenos"> 767</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Errors loading commute data from project.&quot;</span><span class="p">)</span>
</span><span id="L-768"><a href="#L-768"><span class="linenos"> 768</span></a>                    <span class="k">return</span> <span class="kc">False</span>
</span><span id="L-769"><a href="#L-769"><span class="linenos"> 769</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-770"><a href="#L-770"><span class="linenos"> 770</span></a>                <span class="k">pass</span>
</span><span id="L-771"><a href="#L-771"><span class="linenos"> 771</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-772"><a href="#L-772"><span class="linenos"> 772</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Commute data missing from project.&quot;</span><span class="p">)</span>
</span><span id="L-773"><a href="#L-773"><span class="linenos"> 773</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="L-774"><a href="#L-774"><span class="linenos"> 774</span></a>        <span class="c1"># calculate the commute emissions for each row in the commute data</span>
</span><span id="L-775"><a href="#L-775"><span class="linenos"> 775</span></a>        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;commute_data.csv&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
</span><span id="L-776"><a href="#L-776"><span class="linenos"> 776</span></a>            <span class="c1"># calculate the commute emissions</span>
</span><span id="L-777"><a href="#L-777"><span class="linenos"> 777</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;commute_data.csv&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">index</span><span class="p">,</span><span class="s2">&quot;emissions&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;miles&quot;</span><span class="p">])</span> <span class="o">*</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">CO2_per_mile</span><span class="p">)</span>
</span><span id="L-778"><a href="#L-778"><span class="linenos"> 778</span></a>            <span class="c1"># calcualte the emissions for each day and time</span>
</span><span id="L-779"><a href="#L-779"><span class="linenos"> 779</span></a>            <span class="k">for</span> <span class="n">day</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;m&quot;</span><span class="p">,</span><span class="s2">&quot;t&quot;</span><span class="p">,</span><span class="s2">&quot;w&quot;</span><span class="p">,</span><span class="s2">&quot;h&quot;</span><span class="p">,</span><span class="s2">&quot;f&quot;</span><span class="p">]:</span>
</span><span id="L-780"><a href="#L-780"><span class="linenos"> 780</span></a>                <span class="k">for</span> <span class="n">time</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;morning&quot;</span><span class="p">,</span><span class="s2">&quot;evening&quot;</span><span class="p">]:</span>
</span><span id="L-781"><a href="#L-781"><span class="linenos"> 781</span></a>                    <span class="c1"># get the traffic regime for this commute</span>
</span><span id="L-782"><a href="#L-782"><span class="linenos"> 782</span></a>                    <span class="n">emissions_factor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_traffic_emissions_factor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_traffic_regime</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;miles&quot;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="n">day</span><span class="o">+</span><span class="s2">&quot;_&quot;</span><span class="o">+</span><span class="n">time</span><span class="o">+</span><span class="s2">&quot;_duration_in_traffic&quot;</span><span class="p">]))</span>
</span><span id="L-783"><a href="#L-783"><span class="linenos"> 783</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;commute_data.csv&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">index</span><span class="p">,</span><span class="n">day</span><span class="o">+</span><span class="s2">&quot;_&quot;</span><span class="o">+</span><span class="n">time</span><span class="o">+</span><span class="s2">&quot;_emissions&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;miles&quot;</span><span class="p">])</span> <span class="o">*</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">CO2_per_mile</span><span class="p">)</span> <span class="o">*</span> <span class="n">emissions_factor</span>
</span><span id="L-784"><a href="#L-784"><span class="linenos"> 784</span></a>                    
</span><span id="L-785"><a href="#L-785"><span class="linenos"> 785</span></a>        <span class="c1"># save the project data object to the csv file</span>
</span><span id="L-786"><a href="#L-786"><span class="linenos"> 786</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">save_data_file</span><span class="p">(</span><span class="s2">&quot;commute_data.csv&quot;</span><span class="p">)</span>
</span><span id="L-787"><a href="#L-787"><span class="linenos"> 787</span></a>
</span><span id="L-788"><a href="#L-788"><span class="linenos"> 788</span></a>
</span><span id="L-789"><a href="#L-789"><span class="linenos"> 789</span></a>    <span class="k">def</span> <span class="nf">get_traffic_regime</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">distance</span><span class="p">,</span> <span class="n">duration_in_traffic</span><span class="p">):</span>
</span><span id="L-790"><a href="#L-790"><span class="linenos"> 790</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-791"><a href="#L-791"><span class="linenos"> 791</span></a><span class="sd">        Determines the traffic regime based on the commute distance and duration in traffic.</span>
</span><span id="L-792"><a href="#L-792"><span class="linenos"> 792</span></a>
</span><span id="L-793"><a href="#L-793"><span class="linenos"> 793</span></a><span class="sd">        The traffic regime is an estimation of traffic conditions affecting the commute, categorized into levels based on the </span>
</span><span id="L-794"><a href="#L-794"><span class="linenos"> 794</span></a><span class="sd">        relationship between the expected duration and the actual duration in traffic.</span>
</span><span id="L-795"><a href="#L-795"><span class="linenos"> 795</span></a>
</span><span id="L-796"><a href="#L-796"><span class="linenos"> 796</span></a><span class="sd">        Args:</span>
</span><span id="L-797"><a href="#L-797"><span class="linenos"> 797</span></a><span class="sd">            distance (float): The distance of the commute.</span>
</span><span id="L-798"><a href="#L-798"><span class="linenos"> 798</span></a><span class="sd">            duration_in_traffic (int): The duration of the commute in traffic in minutes.</span>
</span><span id="L-799"><a href="#L-799"><span class="linenos"> 799</span></a>
</span><span id="L-800"><a href="#L-800"><span class="linenos"> 800</span></a><span class="sd">        Returns:</span>
</span><span id="L-801"><a href="#L-801"><span class="linenos"> 801</span></a><span class="sd">            int: The traffic regime level, indicating the severity of traffic conditions.</span>
</span><span id="L-802"><a href="#L-802"><span class="linenos"> 802</span></a><span class="sd">    </span>
</span><span id="L-803"><a href="#L-803"><span class="linenos"> 803</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-804"><a href="#L-804"><span class="linenos"> 804</span></a>        <span class="c1"># get the average speed</span>
</span><span id="L-805"><a href="#L-805"><span class="linenos"> 805</span></a>        <span class="n">average_speed</span> <span class="o">=</span> <span class="n">distance</span> <span class="o">/</span> <span class="p">(</span><span class="n">duration_in_traffic</span><span class="o">/</span><span class="mi">60</span><span class="p">)</span>
</span><span id="L-806"><a href="#L-806"><span class="linenos"> 806</span></a>        <span class="c1"># if the average speed is less than the lower bound of regime 2, return regime 1</span>
</span><span id="L-807"><a href="#L-807"><span class="linenos"> 807</span></a>        <span class="k">if</span> <span class="n">average_speed</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">traffic_regime_2</span><span class="p">:</span>
</span><span id="L-808"><a href="#L-808"><span class="linenos"> 808</span></a>            <span class="k">return</span> <span class="mi">1</span>
</span><span id="L-809"><a href="#L-809"><span class="linenos"> 809</span></a>        <span class="c1"># if the average speed is less than the lower bound of regime 3, return regime 2</span>
</span><span id="L-810"><a href="#L-810"><span class="linenos"> 810</span></a>        <span class="k">if</span> <span class="n">average_speed</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">traffic_regime_3</span><span class="p">:</span>
</span><span id="L-811"><a href="#L-811"><span class="linenos"> 811</span></a>            <span class="k">return</span> <span class="mi">2</span>
</span><span id="L-812"><a href="#L-812"><span class="linenos"> 812</span></a>        <span class="c1"># if the average speed is greater than or equal to the lower bound of regime 3, return regime 3</span>
</span><span id="L-813"><a href="#L-813"><span class="linenos"> 813</span></a>        <span class="k">return</span> <span class="mi">3</span>
</span><span id="L-814"><a href="#L-814"><span class="linenos"> 814</span></a>        
</span><span id="L-815"><a href="#L-815"><span class="linenos"> 815</span></a>    <span class="k">def</span> <span class="nf">get_traffic_emissions_factor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">regime</span><span class="p">):</span>
</span><span id="L-816"><a href="#L-816"><span class="linenos"> 816</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-817"><a href="#L-817"><span class="linenos"> 817</span></a><span class="sd">        Retrieves the emissions factor associated with a given traffic regime.</span>
</span><span id="L-818"><a href="#L-818"><span class="linenos"> 818</span></a>
</span><span id="L-819"><a href="#L-819"><span class="linenos"> 819</span></a><span class="sd">        This method returns a multiplier that adjusts the calculated emissions based on the traffic regime, </span>
</span><span id="L-820"><a href="#L-820"><span class="linenos"> 820</span></a><span class="sd">        with different factors indicating varying levels of traffic congestion.</span>
</span><span id="L-821"><a href="#L-821"><span class="linenos"> 821</span></a>
</span><span id="L-822"><a href="#L-822"><span class="linenos"> 822</span></a><span class="sd">        Args:</span>
</span><span id="L-823"><a href="#L-823"><span class="linenos"> 823</span></a><span class="sd">            regime (int): The traffic regime level as determined by get_traffic_regime method.</span>
</span><span id="L-824"><a href="#L-824"><span class="linenos"> 824</span></a>
</span><span id="L-825"><a href="#L-825"><span class="linenos"> 825</span></a><span class="sd">        Returns:</span>
</span><span id="L-826"><a href="#L-826"><span class="linenos"> 826</span></a><span class="sd">            float: The emissions factor corresponding to the specified traffic regime.</span>
</span><span id="L-827"><a href="#L-827"><span class="linenos"> 827</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-828"><a href="#L-828"><span class="linenos"> 828</span></a>
</span><span id="L-829"><a href="#L-829"><span class="linenos"> 829</span></a>        <span class="c1"># return the emissions factor for the traffic regime</span>
</span><span id="L-830"><a href="#L-830"><span class="linenos"> 830</span></a>        <span class="k">if</span> <span class="n">regime</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="L-831"><a href="#L-831"><span class="linenos"> 831</span></a>            <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">traffic_regime_1_coeff</span><span class="p">)</span>
</span><span id="L-832"><a href="#L-832"><span class="linenos"> 832</span></a>        <span class="k">if</span> <span class="n">regime</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
</span><span id="L-833"><a href="#L-833"><span class="linenos"> 833</span></a>            <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">traffic_regime_2_coeff</span><span class="p">)</span>
</span><span id="L-834"><a href="#L-834"><span class="linenos"> 834</span></a>        <span class="k">if</span> <span class="n">regime</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
</span><span id="L-835"><a href="#L-835"><span class="linenos"> 835</span></a>            <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">traffic_regime_3_coeff</span><span class="p">)</span>
</span><span id="L-836"><a href="#L-836"><span class="linenos"> 836</span></a>        <span class="k">return</span> <span class="mf">1.0</span>
</span><span id="L-837"><a href="#L-837"><span class="linenos"> 837</span></a>
</span><span id="L-838"><a href="#L-838"><span class="linenos"> 838</span></a>    <span class="k">def</span> <span class="nf">handle_GAPI_exception</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exception</span><span class="p">):</span>
</span><span id="L-839"><a href="#L-839"><span class="linenos"> 839</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-840"><a href="#L-840"><span class="linenos"> 840</span></a><span class="sd">        Determines the course of action for a given Google API exception.</span>
</span><span id="L-841"><a href="#L-841"><span class="linenos"> 841</span></a>
</span><span id="L-842"><a href="#L-842"><span class="linenos"> 842</span></a><span class="sd">        Based on the type of exception encountered during API calls, this method decides whether the exception is recoverable </span>
</span><span id="L-843"><a href="#L-843"><span class="linenos"> 843</span></a><span class="sd">        (suggesting a retry might succeed) or if it&#39;s unrecoverable, necessitating alternate handling.</span>
</span><span id="L-844"><a href="#L-844"><span class="linenos"> 844</span></a>
</span><span id="L-845"><a href="#L-845"><span class="linenos"> 845</span></a><span class="sd">        Args:</span>
</span><span id="L-846"><a href="#L-846"><span class="linenos"> 846</span></a><span class="sd">            exception (Exception): The exception encountered during a Google API call.</span>
</span><span id="L-847"><a href="#L-847"><span class="linenos"> 847</span></a>
</span><span id="L-848"><a href="#L-848"><span class="linenos"> 848</span></a><span class="sd">        Returns:</span>
</span><span id="L-849"><a href="#L-849"><span class="linenos"> 849</span></a><span class="sd">            bool: True if the exception is considered recoverable, False otherwise.</span>
</span><span id="L-850"><a href="#L-850"><span class="linenos"> 850</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-851"><a href="#L-851"><span class="linenos"> 851</span></a>
</span><span id="L-852"><a href="#L-852"><span class="linenos"> 852</span></a>        <span class="c1"># Extract the type of the exception as a string</span>
</span><span id="L-853"><a href="#L-853"><span class="linenos"> 853</span></a>        <span class="n">exception_type</span> <span class="o">=</span> <span class="n">exception</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span>
</span><span id="L-854"><a href="#L-854"><span class="linenos"> 854</span></a>        
</span><span id="L-855"><a href="#L-855"><span class="linenos"> 855</span></a>        <span class="c1"># Check if the exception type is in our predefined dictionary</span>
</span><span id="L-856"><a href="#L-856"><span class="linenos"> 856</span></a>        <span class="k">if</span> <span class="n">exception_type</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">gAPI</span><span class="o">.</span><span class="n">google_api_exceptions</span><span class="p">:</span>
</span><span id="L-857"><a href="#L-857"><span class="linenos"> 857</span></a>            <span class="n">action</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gAPI</span><span class="o">.</span><span class="n">google_api_exceptions</span><span class="p">[</span><span class="n">exception_type</span><span class="p">]</span>
</span><span id="L-858"><a href="#L-858"><span class="linenos"> 858</span></a>            <span class="k">if</span> <span class="n">action</span> <span class="o">==</span> <span class="s1">&#39;recoverable&#39;</span><span class="p">:</span>
</span><span id="L-859"><a href="#L-859"><span class="linenos"> 859</span></a>                <span class="k">return</span> <span class="kc">True</span>
</span><span id="L-860"><a href="#L-860"><span class="linenos"> 860</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-861"><a href="#L-861"><span class="linenos"> 861</span></a>                <span class="k">return</span> <span class="kc">False</span>
</span><span id="L-862"><a href="#L-862"><span class="linenos"> 862</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-863"><a href="#L-863"><span class="linenos"> 863</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Encountered an undefined exception type (&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">exception</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;). Raising the exception...&quot;</span><span class="p">)</span>
</span><span id="L-864"><a href="#L-864"><span class="linenos"> 864</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="L-865"><a href="#L-865"><span class="linenos"> 865</span></a>
</span><span id="L-866"><a href="#L-866"><span class="linenos"> 866</span></a>    <span class="k">def</span> <span class="nf">generate_graphs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">graph</span><span class="o">=</span><span class="s2">&quot;_all&quot;</span><span class="p">):</span>
</span><span id="L-867"><a href="#L-867"><span class="linenos"> 867</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-868"><a href="#L-868"><span class="linenos"> 868</span></a><span class="sd">        Generates and saves graphical representations of analyzed commute data.</span>
</span><span id="L-869"><a href="#L-869"><span class="linenos"> 869</span></a>
</span><span id="L-870"><a href="#L-870"><span class="linenos"> 870</span></a><span class="sd">        Based on the available commute data, this method generates graphs such as the geographical distribution </span>
</span><span id="L-871"><a href="#L-871"><span class="linenos"> 871</span></a><span class="sd">        of analyzed locations and the local analysis of commute geography. It supports generating all graphs or </span>
</span><span id="L-872"><a href="#L-872"><span class="linenos"> 872</span></a><span class="sd">        a specific one based on the `graph` parameter.</span>
</span><span id="L-873"><a href="#L-873"><span class="linenos"> 873</span></a>
</span><span id="L-874"><a href="#L-874"><span class="linenos"> 874</span></a><span class="sd">        Args:</span>
</span><span id="L-875"><a href="#L-875"><span class="linenos"> 875</span></a><span class="sd">            graph (str, optional): Specifies which graph to generate. Use &quot;_all&quot; to generate all graphs, or specify a </span>
</span><span id="L-876"><a href="#L-876"><span class="linenos"> 876</span></a><span class="sd">            particular graph&#39;s key. Defaults to &quot;_all&quot;.</span>
</span><span id="L-877"><a href="#L-877"><span class="linenos"> 877</span></a>
</span><span id="L-878"><a href="#L-878"><span class="linenos"> 878</span></a><span class="sd">        Returns:</span>
</span><span id="L-879"><a href="#L-879"><span class="linenos"> 879</span></a><span class="sd">            list: A list of dictionaries, each containing details about the generated graphs, including file paths and titles.</span>
</span><span id="L-880"><a href="#L-880"><span class="linenos"> 880</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-881"><a href="#L-881"><span class="linenos"> 881</span></a>
</span><span id="L-882"><a href="#L-882"><span class="linenos"> 882</span></a>        <span class="c1"># define a color palette supporting up to 10 unique colors</span>
</span><span id="L-883"><a href="#L-883"><span class="linenos"> 883</span></a>        <span class="n">color_palette</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;#6e7c8a&#39;</span><span class="p">,</span> <span class="s1">&#39;#90a08f&#39;</span><span class="p">,</span> <span class="s1">&#39;#c3a3a9&#39;</span><span class="p">,</span> <span class="s1">&#39;#b1c5c3&#39;</span><span class="p">,</span> <span class="s1">&#39;#e1c08b&#39;</span><span class="p">,</span> <span class="s1">&#39;#a592ba&#39;</span><span class="p">,</span> <span class="s1">&#39;#a8b1d5&#39;</span><span class="p">,</span> <span class="s1">&#39;#d4abad&#39;</span><span class="p">,</span> <span class="s1">&#39;#c4c38a&#39;</span><span class="p">,</span> <span class="s1">&#39;#ceb2ab&#39;</span><span class="p">]</span>
</span><span id="L-884"><a href="#L-884"><span class="linenos"> 884</span></a>                        <span class="c1"># lighter pastel [&#39;#7D8A97&#39;, &#39;#A3B0A2&#39;, &#39;#D3BCC0&#39;, &#39;#C9D7D6&#39;, &#39;#EAD2AC&#39;, &#39;#B8A9C9&#39;, &#39;#C5CBE3&#39;, &#39;#E3C8C9&#39;, &#39;#D1D0A3&#39;, &#39;#DECBC6&#39;]</span>
</span><span id="L-885"><a href="#L-885"><span class="linenos"> 885</span></a>
</span><span id="L-886"><a href="#L-886"><span class="linenos"> 886</span></a>        <span class="c1"># Create a new list of colors &quot;i&quot; long, recycling colors as needed</span>
</span><span id="L-887"><a href="#L-887"><span class="linenos"> 887</span></a>        <span class="k">def</span> <span class="nf">colors</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
</span><span id="L-888"><a href="#L-888"><span class="linenos"> 888</span></a>            <span class="k">return</span> <span class="n">color_palette</span><span class="p">[</span><span class="n">i</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">color_palette</span><span class="p">)]</span>
</span><span id="L-889"><a href="#L-889"><span class="linenos"> 889</span></a>
</span><span id="L-890"><a href="#L-890"><span class="linenos"> 890</span></a>        <span class="c1"># generate the graphs for the project</span>
</span><span id="L-891"><a href="#L-891"><span class="linenos"> 891</span></a>        <span class="c1"># if the commute data isn&#39;t already in the project, load it</span>
</span><span id="L-892"><a href="#L-892"><span class="linenos"> 892</span></a>        <span class="k">if</span> <span class="s2">&quot;commute_data.csv&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">list_data_files</span><span class="p">():</span>
</span><span id="L-893"><a href="#L-893"><span class="linenos"> 893</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;commute_data.csv&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-894"><a href="#L-894"><span class="linenos"> 894</span></a>                <span class="c1"># attempt to load the commute data</span>
</span><span id="L-895"><a href="#L-895"><span class="linenos"> 895</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">load_data_file</span><span class="p">(</span><span class="s2">&quot;commute_data.csv&quot;</span><span class="p">):</span>
</span><span id="L-896"><a href="#L-896"><span class="linenos"> 896</span></a>                    <span class="k">pass</span>
</span><span id="L-897"><a href="#L-897"><span class="linenos"> 897</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="L-898"><a href="#L-898"><span class="linenos"> 898</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Errors loading commute data from project.&quot;</span><span class="p">)</span>
</span><span id="L-899"><a href="#L-899"><span class="linenos"> 899</span></a>                    <span class="k">return</span> <span class="kc">False</span>
</span><span id="L-900"><a href="#L-900"><span class="linenos"> 900</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-901"><a href="#L-901"><span class="linenos"> 901</span></a>                <span class="k">pass</span>
</span><span id="L-902"><a href="#L-902"><span class="linenos"> 902</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-903"><a href="#L-903"><span class="linenos"> 903</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Commute data missing from project.&quot;</span><span class="p">)</span>
</span><span id="L-904"><a href="#L-904"><span class="linenos"> 904</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="L-905"><a href="#L-905"><span class="linenos"> 905</span></a>        
</span><span id="L-906"><a href="#L-906"><span class="linenos"> 906</span></a>        <span class="c1"># create the graphing object</span>
</span><span id="L-907"><a href="#L-907"><span class="linenos"> 907</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">graphing</span> <span class="o">=</span> <span class="n">Graphing</span><span class="p">()</span>
</span><span id="L-908"><a href="#L-908"><span class="linenos"> 908</span></a>        
</span><span id="L-909"><a href="#L-909"><span class="linenos"> 909</span></a>        <span class="c1"># create a list of dicts to map the graphs to return to UI, they will be plotted in the order they are listed</span>
</span><span id="L-910"><a href="#L-910"><span class="linenos"> 910</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">graph_list</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-911"><a href="#L-911"><span class="linenos"> 911</span></a> 
</span><span id="L-912"><a href="#L-912"><span class="linenos"> 912</span></a>        <span class="c1">### generate the graphs  ###</span>
</span><span id="L-913"><a href="#L-913"><span class="linenos"> 913</span></a>        <span class="n">plots_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project_directory</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">project_name</span><span class="p">,</span> <span class="s2">&quot;plots&quot;</span><span class="p">)</span>
</span><span id="L-914"><a href="#L-914"><span class="linenos"> 914</span></a>        <span class="c1"># get the baseline data</span>
</span><span id="L-915"><a href="#L-915"><span class="linenos"> 915</span></a>        <span class="n">emp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">get_emp_gps</span><span class="p">()</span>
</span><span id="L-916"><a href="#L-916"><span class="linenos"> 916</span></a>        
</span><span id="L-917"><a href="#L-917"><span class="linenos"> 917</span></a>        <span class="n">offices</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">get_office_gps</span><span class="p">()</span>
</span><span id="L-918"><a href="#L-918"><span class="linenos"> 918</span></a>        <span class="n">commute_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">get_commute_data</span><span class="p">()</span>
</span><span id="L-919"><a href="#L-919"><span class="linenos"> 919</span></a>        
</span><span id="L-920"><a href="#L-920"><span class="linenos"> 920</span></a>        <span class="c1"># helper function to get a base cost dataframe</span>
</span><span id="L-921"><a href="#L-921"><span class="linenos"> 921</span></a>        <span class="k">def</span> <span class="nf">get_base_cost_df</span><span class="p">(</span><span class="n">emp</span><span class="p">,</span> <span class="n">officeaddr</span><span class="p">):</span>
</span><span id="L-922"><a href="#L-922"><span class="linenos"> 922</span></a>            <span class="n">rows</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-923"><a href="#L-923"><span class="linenos"> 923</span></a>            <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">emp</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
</span><span id="L-924"><a href="#L-924"><span class="linenos"> 924</span></a>                <span class="n">cost</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="L-925"><a href="#L-925"><span class="linenos"> 925</span></a>                <span class="n">rows</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s1">&#39;latitude&#39;</span><span class="p">:</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;latitude&#39;</span><span class="p">],</span><span class="s1">&#39;longitude&#39;</span><span class="p">:</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;longitude&#39;</span><span class="p">],</span><span class="s1">&#39;office&#39;</span><span class="p">:</span><span class="n">officeaddr</span><span class="p">,</span><span class="s1">&#39;cost&#39;</span><span class="p">:</span><span class="n">cost</span><span class="p">})</span>
</span><span id="L-926"><a href="#L-926"><span class="linenos"> 926</span></a>            <span class="c1">#cost_df = pd.DataFrame(rows)</span>
</span><span id="L-927"><a href="#L-927"><span class="linenos"> 927</span></a>            <span class="k">return</span> <span class="n">rows</span>
</span><span id="L-928"><a href="#L-928"><span class="linenos"> 928</span></a>            
</span><span id="L-929"><a href="#L-929"><span class="linenos"> 929</span></a>        <span class="c1">################################################################################ </span>
</span><span id="L-930"><a href="#L-930"><span class="linenos"> 930</span></a>        <span class="c1"># GRAPH: </span>
</span><span id="L-931"><a href="#L-931"><span class="linenos"> 931</span></a>        <span class="c1">## Geographical Distribution of Analyzed Locations</span>
</span><span id="L-932"><a href="#L-932"><span class="linenos"> 932</span></a>        <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Geographical Distribution of Analyzed Locations&quot;</span>
</span><span id="L-933"><a href="#L-933"><span class="linenos"> 933</span></a>        <span class="n">key</span> <span class="o">=</span> <span class="s2">&quot;gdal&quot;</span>
</span><span id="L-934"><a href="#L-934"><span class="linenos"> 934</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">graph_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="p">{</span><span class="s2">&quot;GRAPH&quot;</span><span class="p">:</span> <span class="n">key</span><span class="p">,</span>
</span><span id="L-935"><a href="#L-935"><span class="linenos"> 935</span></a>                                 <span class="s2">&quot;TITLE&quot;</span><span class="p">:</span> <span class="n">title</span><span class="p">,</span>
</span><span id="L-936"><a href="#L-936"><span class="linenos"> 936</span></a>                                 <span class="s2">&quot;FILENAME&quot;</span><span class="p">:</span> <span class="n">key</span><span class="o">+</span><span class="s2">&quot;.png&quot;</span><span class="p">,</span>
</span><span id="L-937"><a href="#L-937"><span class="linenos"> 937</span></a>                                <span class="s2">&quot;PLOT-DESCRIPTION&quot;</span><span class="p">:</span> <span class="s2">&quot;Employee addresses and potential office locations are visualized on a map, &quot;</span> <span class="o">+</span> \
</span><span id="L-938"><a href="#L-938"><span class="linenos"> 938</span></a>                                    <span class="s2">&quot;including those which may be outside of the commuting radius.  A total of &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">emp</span><span class="p">))</span><span class="o">+</span><span class="s2">&quot; employee addresses &quot;</span> <span class="o">+</span> \
</span><span id="L-939"><a href="#L-939"><span class="linenos"> 939</span></a>                                    <span class="s2">&quot;and &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">offices</span><span class="p">))</span><span class="o">+</span><span class="s2">&quot; office locations are included in the analysis.&quot;</span>               
</span><span id="L-940"><a href="#L-940"><span class="linenos"> 940</span></a>                                <span class="p">})</span>
</span><span id="L-941"><a href="#L-941"><span class="linenos"> 941</span></a>        <span class="k">if</span> <span class="n">graph</span> <span class="o">==</span> <span class="s2">&quot;_all&quot;</span> <span class="ow">or</span> <span class="n">graph</span> <span class="o">==</span> <span class="n">key</span><span class="p">:</span>
</span><span id="L-942"><a href="#L-942"><span class="linenos"> 942</span></a>            <span class="n">plt</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graphing</span><span class="o">.</span><span class="n">get_map_view</span><span class="p">(</span><span class="n">emp</span><span class="p">,</span> <span class="n">offices</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span> <span class="n">font_mod</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span>
</span><span id="L-943"><a href="#L-943"><span class="linenos"> 943</span></a>                                                 <span class="n">commute_color</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">commute_data</span><span class="o">=</span><span class="n">commute_data</span><span class="p">,</span> <span class="n">convex_hull</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">size_o</span><span class="o">=</span><span class="mi">400</span><span class="p">,</span> <span class="n">size_e</span><span class="o">=</span><span class="mi">40</span><span class="p">)</span>
</span><span id="L-944"><a href="#L-944"><span class="linenos"> 944</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">(</span><span class="n">pad</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
</span><span id="L-945"><a href="#L-945"><span class="linenos"> 945</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">plots_dir</span><span class="o">+</span><span class="s2">&quot;/gdal.png&quot;</span><span class="p">)</span>
</span><span id="L-946"><a href="#L-946"><span class="linenos"> 946</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="L-947"><a href="#L-947"><span class="linenos"> 947</span></a>
</span><span id="L-948"><a href="#L-948"><span class="linenos"> 948</span></a>        <span class="c1">################################################################################</span>
</span><span id="L-949"><a href="#L-949"><span class="linenos"> 949</span></a>        <span class="c1">### GRAPH SET: Local Analysis for Office X</span>
</span><span id="L-950"><a href="#L-950"><span class="linenos"> 950</span></a>        <span class="c1"># iterate through offices, generate a graph for each office</span>
</span><span id="L-951"><a href="#L-951"><span class="linenos"> 951</span></a>        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">offices</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
</span><span id="L-952"><a href="#L-952"><span class="linenos"> 952</span></a>            <span class="c1">################################################################################ </span>
</span><span id="L-953"><a href="#L-953"><span class="linenos"> 953</span></a>            <span class="c1"># GRAPH: </span>
</span><span id="L-954"><a href="#L-954"><span class="linenos"> 954</span></a>            <span class="c1">## Local Analysis for Office X</span>
</span><span id="L-955"><a href="#L-955"><span class="linenos"> 955</span></a>            <span class="n">key</span> <span class="o">=</span> <span class="s1">&#39;lafo&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
</span><span id="L-956"><a href="#L-956"><span class="linenos"> 956</span></a>            <span class="n">OfficeAddr</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;address&quot;</span><span class="p">]</span>
</span><span id="L-957"><a href="#L-957"><span class="linenos"> 957</span></a>            <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;Employee Distribution for &quot;</span><span class="o">+</span><span class="n">OfficeAddr</span>
</span><span id="L-958"><a href="#L-958"><span class="linenos"> 958</span></a>            <span class="n">short_title</span> <span class="o">=</span> <span class="s2">&quot;Employee Distribution for Office &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">index</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
</span><span id="L-959"><a href="#L-959"><span class="linenos"> 959</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">graph_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="p">{</span><span class="s2">&quot;GRAPH&quot;</span><span class="p">:</span> <span class="n">key</span><span class="p">,</span>
</span><span id="L-960"><a href="#L-960"><span class="linenos"> 960</span></a>                                    <span class="s2">&quot;TITLE&quot;</span><span class="p">:</span> <span class="n">short_title</span><span class="p">,</span>
</span><span id="L-961"><a href="#L-961"><span class="linenos"> 961</span></a>                                    <span class="s2">&quot;FILENAME&quot;</span><span class="p">:</span> <span class="n">key</span><span class="o">+</span><span class="s2">&quot;.png&quot;</span><span class="p">,</span>
</span><span id="L-962"><a href="#L-962"><span class="linenos"> 962</span></a>                                    <span class="s2">&quot;PLOT-DESCRIPTION&quot;</span><span class="p">:</span> <span class="s2">&quot;This graph displays the commute cutoff distribution for employees relative to the office at &quot;</span><span class="o">+</span><span class="n">OfficeAddr</span><span class="o">+</span><span class="s2">&quot;. &quot;</span> <span class="o">+</span> \
</span><span id="L-963"><a href="#L-963"><span class="linenos"> 963</span></a>                                                        <span class="s2">&quot;The cutoff distance is &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">commute_range_cut_off</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot; miles. The circle represents the linear distance &quot;</span> <span class="o">+</span> \
</span><span id="L-964"><a href="#L-964"><span class="linenos"> 964</span></a>                                                        <span class="s2">&quot;but more importantly is the actual driving distance represented by the convex hull, the shape of which is a result of &quot;</span> <span class="o">+</span> \
</span><span id="L-965"><a href="#L-965"><span class="linenos"> 965</span></a>                                                        <span class="s2">&quot;roadway complexities.  The bounded region will vary widely between offices analyzed.&quot;</span>
</span><span id="L-966"><a href="#L-966"><span class="linenos"> 966</span></a>                                                        
</span><span id="L-967"><a href="#L-967"><span class="linenos"> 967</span></a>                                    <span class="p">})</span>
</span><span id="L-968"><a href="#L-968"><span class="linenos"> 968</span></a>            <span class="k">if</span> <span class="n">graph</span> <span class="o">==</span> <span class="s2">&quot;_all&quot;</span> <span class="ow">or</span> <span class="n">graph</span> <span class="o">==</span> <span class="n">key</span><span class="p">:</span>
</span><span id="L-969"><a href="#L-969"><span class="linenos"> 969</span></a>                <span class="c1">#just get the first office row</span>
</span><span id="L-970"><a href="#L-970"><span class="linenos"> 970</span></a>                <span class="c1">#offices = pd.DataFrame(offices.iloc[0],offices.columns).reset_index(drop=True)</span>
</span><span id="L-971"><a href="#L-971"><span class="linenos"> 971</span></a>                <span class="n">office</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">to_frame</span><span class="p">()</span><span class="o">.</span><span class="n">T</span>
</span><span id="L-972"><a href="#L-972"><span class="linenos"> 972</span></a>                <span class="n">plt</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graphing</span><span class="o">.</span><span class="n">get_map_view</span><span class="p">(</span><span class="n">emp</span><span class="p">,</span> <span class="n">office</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Employee Distribution for </span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">+</span><span class="n">OfficeAddr</span><span class="p">,</span> 
</span><span id="L-973"><a href="#L-973"><span class="linenos"> 973</span></a>                                                    <span class="n">cutoff_distance</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">commute_range_cut_off</span><span class="o">*</span><span class="mi">2</span><span class="p">,</span>
</span><span id="L-974"><a href="#L-974"><span class="linenos"> 974</span></a>                                                    <span class="n">commute_radius</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">commute_range_cut_off</span><span class="p">,</span> <span class="n">font_mod</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span>
</span><span id="L-975"><a href="#L-975"><span class="linenos"> 975</span></a>                                                    <span class="n">commute_color</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">commute_data</span><span class="o">=</span><span class="n">commute_data</span><span class="p">,</span> <span class="n">convex_hull</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">legend_loc</span><span class="o">=</span><span class="s1">&#39;lower right&#39;</span><span class="p">)</span>
</span><span id="L-976"><a href="#L-976"><span class="linenos"> 976</span></a>                <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">(</span><span class="n">pad</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
</span><span id="L-977"><a href="#L-977"><span class="linenos"> 977</span></a>                <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">plots_dir</span><span class="o">+</span><span class="s2">&quot;/&quot;</span><span class="o">+</span><span class="n">key</span><span class="o">+</span><span class="s2">&quot;.png&quot;</span><span class="p">)</span>
</span><span id="L-978"><a href="#L-978"><span class="linenos"> 978</span></a>                <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="L-979"><a href="#L-979"><span class="linenos"> 979</span></a>
</span><span id="L-980"><a href="#L-980"><span class="linenos"> 980</span></a>                <span class="c1"># get the employees within the cutoff distance by driving distance, then add the count to the plot description</span>
</span><span id="L-981"><a href="#L-981"><span class="linenos"> 981</span></a>                <span class="n">emp_within</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graphing</span><span class="o">.</span><span class="n">filter_drive_distance</span><span class="p">(</span><span class="n">emp</span><span class="p">,</span><span class="n">office</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">commute_range_cut_off</span><span class="p">,</span> <span class="n">commute_data</span><span class="o">=</span><span class="n">commute_data</span><span class="p">)</span>
</span><span id="L-982"><a href="#L-982"><span class="linenos"> 982</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">graph_list</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;PLOT-DESCRIPTION&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph_list</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;PLOT-DESCRIPTION&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot; There are &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">emp_within</span><span class="p">))</span> <span class="o">+</span> \
</span><span id="L-983"><a href="#L-983"><span class="linenos"> 983</span></a>                                                                <span class="s2">&quot; of the total &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">emp</span><span class="p">))</span> <span class="o">+</span> <span class="s2">&quot; employees within the cutoff distance, a total of &quot;</span> <span class="o">+</span> \
</span><span id="L-984"><a href="#L-984"><span class="linenos"> 984</span></a>                                                                <span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">emp_within</span><span class="p">)</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">emp</span><span class="p">)</span><span class="o">*</span><span class="mi">100</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="si">% o</span><span class="s2">f the total employees.&quot;</span>
</span><span id="L-985"><a href="#L-985"><span class="linenos"> 985</span></a>
</span><span id="L-986"><a href="#L-986"><span class="linenos"> 986</span></a>        <span class="c1">################################################################################ </span>
</span><span id="L-987"><a href="#L-987"><span class="linenos"> 987</span></a>        <span class="c1"># GRAPH: </span>
</span><span id="L-988"><a href="#L-988"><span class="linenos"> 988</span></a>        <span class="c1">## Local Analysis of Commute Geography</span>
</span><span id="L-989"><a href="#L-989"><span class="linenos"> 989</span></a>        <span class="n">key</span> <span class="o">=</span> <span class="s1">&#39;lacg&#39;</span>
</span><span id="L-990"><a href="#L-990"><span class="linenos"> 990</span></a>        <span class="c1">#OfficeAddr = row[&quot;address&quot;]</span>
</span><span id="L-991"><a href="#L-991"><span class="linenos"> 991</span></a>        <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;Local Analysis of Commute Geography&quot;</span>
</span><span id="L-992"><a href="#L-992"><span class="linenos"> 992</span></a>        <span class="n">short_title</span> <span class="o">=</span> <span class="n">title</span>
</span><span id="L-993"><a href="#L-993"><span class="linenos"> 993</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">graph_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="p">{</span><span class="s2">&quot;GRAPH&quot;</span><span class="p">:</span> <span class="n">key</span><span class="p">,</span>
</span><span id="L-994"><a href="#L-994"><span class="linenos"> 994</span></a>                                <span class="s2">&quot;TITLE&quot;</span><span class="p">:</span> <span class="n">short_title</span><span class="p">,</span>
</span><span id="L-995"><a href="#L-995"><span class="linenos"> 995</span></a>                                <span class="s2">&quot;FILENAME&quot;</span><span class="p">:</span> <span class="n">key</span><span class="o">+</span><span class="s2">&quot;.png&quot;</span><span class="p">,</span>
</span><span id="L-996"><a href="#L-996"><span class="linenos"> 996</span></a>                                <span class="s2">&quot;PLOT-DESCRIPTION&quot;</span><span class="p">:</span> <span class="s2">&quot;The graph displays several key observations.  Firstly, the green points are employees whose remote work &quot;</span> <span class="o">+</span> \
</span><span id="L-997"><a href="#L-997"><span class="linenos"> 997</span></a>                                                    <span class="s2">&quot;status will be unaffected by the relocation. The red points within the green convex hull will have remote &quot;</span> <span class="o">+</span> \
</span><span id="L-998"><a href="#L-998"><span class="linenos"> 998</span></a>                                                    <span class="s2">&quot;work status affected by the relocation while those outside the green convex hull remain unaffected by all scenarios. &quot;</span> <span class="o">+</span> \
</span><span id="L-999"><a href="#L-999"><span class="linenos"> 999</span></a>                                                    <span class="s2">&quot;Black circles represent a bounding linear distance of &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">commute_range_cut_off</span><span class="p">)</span> <span class="o">+</span><span class="s2">&quot; miles from each office options for perspective.&quot;</span>
</span><span id="L-1000"><a href="#L-1000"><span class="linenos">1000</span></a>                                <span class="p">})</span>
</span><span id="L-1001"><a href="#L-1001"><span class="linenos">1001</span></a>        <span class="k">if</span> <span class="n">graph</span> <span class="o">==</span> <span class="s2">&quot;_all&quot;</span> <span class="ow">or</span> <span class="n">graph</span> <span class="o">==</span> <span class="n">key</span><span class="p">:</span>
</span><span id="L-1002"><a href="#L-1002"><span class="linenos">1002</span></a>            <span class="n">plt</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graphing</span><span class="o">.</span><span class="n">get_map_view</span><span class="p">(</span><span class="n">emp</span><span class="p">,</span> <span class="n">offices</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span> 
</span><span id="L-1003"><a href="#L-1003"><span class="linenos">1003</span></a>                                                 <span class="n">cutoff_radius</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">commute_range_cut_off</span><span class="o">*</span><span class="mi">2</span><span class="p">,</span>
</span><span id="L-1004"><a href="#L-1004"><span class="linenos">1004</span></a>                                                 <span class="n">commute_radius</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">commute_range_cut_off</span><span class="p">,</span> <span class="n">legend_loc</span><span class="o">=</span><span class="s1">&#39;lower left&#39;</span><span class="p">,</span> <span class="n">font_mod</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span>
</span><span id="L-1005"><a href="#L-1005"><span class="linenos">1005</span></a>                                                 <span class="n">commute_color</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">commute_data</span><span class="o">=</span><span class="n">commute_data</span><span class="p">,</span> <span class="n">convex_hull</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">size_o</span><span class="o">=</span><span class="mi">500</span><span class="p">)</span>
</span><span id="L-1006"><a href="#L-1006"><span class="linenos">1006</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">(</span><span class="n">pad</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
</span><span id="L-1007"><a href="#L-1007"><span class="linenos">1007</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">plots_dir</span><span class="o">+</span><span class="s2">&quot;/&quot;</span><span class="o">+</span><span class="n">key</span><span class="o">+</span><span class="s2">&quot;.png&quot;</span><span class="p">)</span>
</span><span id="L-1008"><a href="#L-1008"><span class="linenos">1008</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="L-1009"><a href="#L-1009"><span class="linenos">1009</span></a>
</span><span id="L-1010"><a href="#L-1010"><span class="linenos">1010</span></a>
</span><span id="L-1011"><a href="#L-1011"><span class="linenos">1011</span></a>        <span class="c1">################################################################################ </span>
</span><span id="L-1012"><a href="#L-1012"><span class="linenos">1012</span></a>        <span class="c1"># GRAPH: </span>
</span><span id="L-1013"><a href="#L-1013"><span class="linenos">1013</span></a>        <span class="c1">## Employees Impacted by Remote Work Policy &amp; Relocation</span>
</span><span id="L-1014"><a href="#L-1014"><span class="linenos">1014</span></a>        <span class="n">key</span> <span class="o">=</span> <span class="s1">&#39;lacg2&#39;</span>
</span><span id="L-1015"><a href="#L-1015"><span class="linenos">1015</span></a>        <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;Employees Impacted by Remote Work Policy &amp; Relocation&quot;</span>
</span><span id="L-1016"><a href="#L-1016"><span class="linenos">1016</span></a>        <span class="n">short_title</span> <span class="o">=</span> <span class="n">title</span>
</span><span id="L-1017"><a href="#L-1017"><span class="linenos">1017</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">graph_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="p">{</span><span class="s2">&quot;GRAPH&quot;</span><span class="p">:</span> <span class="n">key</span><span class="p">,</span>
</span><span id="L-1018"><a href="#L-1018"><span class="linenos">1018</span></a>                                <span class="s2">&quot;TITLE&quot;</span><span class="p">:</span> <span class="n">short_title</span><span class="p">,</span>
</span><span id="L-1019"><a href="#L-1019"><span class="linenos">1019</span></a>                                <span class="s2">&quot;FILENAME&quot;</span><span class="p">:</span> <span class="n">key</span><span class="o">+</span><span class="s2">&quot;.png&quot;</span><span class="p">,</span>
</span><span id="L-1020"><a href="#L-1020"><span class="linenos">1020</span></a>                                <span class="s2">&quot;PLOT-DESCRIPTION&quot;</span><span class="p">:</span> <span class="s2">&quot;deferred&quot;</span>                                
</span><span id="L-1021"><a href="#L-1021"><span class="linenos">1021</span></a>                                <span class="p">})</span>
</span><span id="L-1022"><a href="#L-1022"><span class="linenos">1022</span></a>        
</span><span id="L-1023"><a href="#L-1023"><span class="linenos">1023</span></a>        <span class="k">if</span> <span class="n">graph</span> <span class="o">==</span> <span class="s2">&quot;_all&quot;</span> <span class="ow">or</span> <span class="n">graph</span> <span class="o">==</span> <span class="n">key</span><span class="p">:</span>
</span><span id="L-1024"><a href="#L-1024"><span class="linenos">1024</span></a>            <span class="n">plt</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graphing</span><span class="o">.</span><span class="n">get_map_view</span><span class="p">(</span><span class="n">emp</span><span class="p">,</span> <span class="n">offices</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span> <span class="n">font_mod</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span>
</span><span id="L-1025"><a href="#L-1025"><span class="linenos">1025</span></a>                                                 <span class="n">cutoff_radius</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">commute_range_cut_off</span><span class="o">*</span><span class="mf">1.2</span><span class="p">,</span>
</span><span id="L-1026"><a href="#L-1026"><span class="linenos">1026</span></a>                                                 <span class="n">commute_radius</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">commute_range_cut_off</span><span class="p">,</span> 
</span><span id="L-1027"><a href="#L-1027"><span class="linenos">1027</span></a>                                                 <span class="n">commute_color</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">commute_data</span><span class="o">=</span><span class="n">commute_data</span><span class="p">,</span> <span class="n">convex_hull</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">size_o</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span> <span class="n">manual_plot</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-1028"><a href="#L-1028"><span class="linenos">1028</span></a>            
</span><span id="L-1029"><a href="#L-1029"><span class="linenos">1029</span></a>            <span class="n">emp_within</span><span class="p">,</span> <span class="n">emp_outside</span><span class="p">,</span> <span class="n">emp_overlap</span><span class="p">,</span> <span class="n">emp_within_all</span><span class="p">,</span> <span class="n">emp_outside_all</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
</span><span id="L-1030"><a href="#L-1030"><span class="linenos">1030</span></a>            
</span><span id="L-1031"><a href="#L-1031"><span class="linenos">1031</span></a>            <span class="n">emp_within</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graphing</span><span class="o">.</span><span class="n">filter_drive_distance</span><span class="p">(</span><span class="n">emp</span><span class="p">,</span><span class="n">offices</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">commute_range_cut_off</span><span class="p">,</span> <span class="n">commute_data</span><span class="o">=</span><span class="n">commute_data</span><span class="p">,</span> <span class="n">inside</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-1032"><a href="#L-1032"><span class="linenos">1032</span></a>            <span class="n">emp_outside</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graphing</span><span class="o">.</span><span class="n">filter_drive_distance</span><span class="p">(</span><span class="n">emp</span><span class="p">,</span><span class="n">offices</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">commute_range_cut_off</span><span class="p">,</span> <span class="n">commute_data</span><span class="o">=</span><span class="n">commute_data</span><span class="p">,</span> <span class="n">inside</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="L-1033"><a href="#L-1033"><span class="linenos">1033</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">emp_within</span><span class="o">.</span><span class="n">empty</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">emp_outside</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>                
</span><span id="L-1034"><a href="#L-1034"><span class="linenos">1034</span></a>                <span class="n">emp_overlap</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graphing</span><span class="o">.</span><span class="n">get_common_points</span><span class="p">(</span><span class="n">emp_within</span><span class="p">,</span><span class="n">emp_outside</span><span class="p">)</span>
</span><span id="L-1035"><a href="#L-1035"><span class="linenos">1035</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">emp_within</span><span class="o">.</span><span class="n">empty</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">emp_outside</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
</span><span id="L-1036"><a href="#L-1036"><span class="linenos">1036</span></a>                <span class="n">emp_outside_all</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graphing</span><span class="o">.</span><span class="n">get_unique_points</span><span class="p">(</span><span class="n">emp_outside</span><span class="p">,</span><span class="n">emp_overlap</span><span class="p">)</span>
</span><span id="L-1037"><a href="#L-1037"><span class="linenos">1037</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">emp_within</span><span class="o">.</span><span class="n">empty</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">emp_outside</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
</span><span id="L-1038"><a href="#L-1038"><span class="linenos">1038</span></a>                <span class="n">emp_within_all</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graphing</span><span class="o">.</span><span class="n">get_unique_points</span><span class="p">(</span><span class="n">emp_within</span><span class="p">,</span><span class="n">emp_overlap</span><span class="p">)</span>
</span><span id="L-1039"><a href="#L-1039"><span class="linenos">1039</span></a>            <span class="n">emp_within_list</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-1040"><a href="#L-1040"><span class="linenos">1040</span></a>            <span class="n">hullvars</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;color&quot;</span><span class="p">:</span><span class="s2">&quot;red&quot;</span><span class="p">,</span><span class="s2">&quot;linewidth&quot;</span><span class="p">:</span><span class="mi">50</span><span class="p">,</span><span class="s2">&quot;alpha&quot;</span><span class="p">:</span><span class="mf">0.07</span><span class="p">}</span>
</span><span id="L-1041"><a href="#L-1041"><span class="linenos">1041</span></a>            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">offices</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
</span><span id="L-1042"><a href="#L-1042"><span class="linenos">1042</span></a>                <span class="n">office</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">to_frame</span><span class="p">()</span><span class="o">.</span><span class="n">T</span>
</span><span id="L-1043"><a href="#L-1043"><span class="linenos">1043</span></a>                <span class="n">emp_within_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">graphing</span><span class="o">.</span><span class="n">filter_drive_distance</span><span class="p">(</span><span class="n">emp</span><span class="p">,</span><span class="n">office</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">commute_range_cut_off</span><span class="p">,</span> <span class="n">commute_data</span><span class="o">=</span><span class="n">commute_data</span><span class="p">,</span> <span class="n">inside</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
</span><span id="L-1044"><a href="#L-1044"><span class="linenos">1044</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">graphing</span><span class="o">.</span><span class="n">plot_convex_hull</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">emp_within_list</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="o">**</span><span class="n">hullvars</span><span class="p">)</span>
</span><span id="L-1045"><a href="#L-1045"><span class="linenos">1045</span></a>
</span><span id="L-1046"><a href="#L-1046"><span class="linenos">1046</span></a>            <span class="c1"># plot the points</span>
</span><span id="L-1047"><a href="#L-1047"><span class="linenos">1047</span></a>            <span class="k">if</span> <span class="n">emp_within_all</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">emp_within_all</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
</span><span id="L-1048"><a href="#L-1048"><span class="linenos">1048</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">graphing</span><span class="o">.</span><span class="n">plot_addresses</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">emp_within_all</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Unaffected by </span><span class="se">\n</span><span class="s2">Relocation Decision&quot;</span><span class="p">)</span>
</span><span id="L-1049"><a href="#L-1049"><span class="linenos">1049</span></a>            <span class="c1">#if emp_outside_all is not None and not emp_outside_all.empty:</span>
</span><span id="L-1050"><a href="#L-1050"><span class="linenos">1050</span></a>                <span class="c1">#self.graphing.plot_addresses(ax, emp_outside_all,color=&#39;gray&#39;,label=&quot;Outside Commute \nRadius for Offices&quot;)</span>
</span><span id="L-1051"><a href="#L-1051"><span class="linenos">1051</span></a>            <span class="k">if</span> <span class="n">emp_overlap</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">emp_overlap</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
</span><span id="L-1052"><a href="#L-1052"><span class="linenos">1052</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">graphing</span><span class="o">.</span><span class="n">plot_addresses</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">emp_overlap</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span><span class="n">s</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Impacted by </span><span class="se">\n</span><span class="s2">Relocation Decision&quot;</span><span class="p">)</span>
</span><span id="L-1053"><a href="#L-1053"><span class="linenos">1053</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">graphing</span><span class="o">.</span><span class="n">plot_offices</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">offices</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">400</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Potential Office Locations&quot;</span><span class="p">)</span>
</span><span id="L-1054"><a href="#L-1054"><span class="linenos">1054</span></a>            <span class="k">if</span> <span class="n">emp_within_all</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">emp_within_all</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
</span><span id="L-1055"><a href="#L-1055"><span class="linenos">1055</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">graphing</span><span class="o">.</span><span class="n">plot_convex_hull</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">emp_within_all</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>
</span><span id="L-1056"><a href="#L-1056"><span class="linenos">1056</span></a>            <span class="k">if</span> <span class="n">emp_overlap</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">emp_overlap</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
</span><span id="L-1057"><a href="#L-1057"><span class="linenos">1057</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">graphing</span><span class="o">.</span><span class="n">plot_convex_hull</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">emp_overlap</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">)</span>
</span><span id="L-1058"><a href="#L-1058"><span class="linenos">1058</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">graphing</span><span class="o">.</span><span class="n">add_scalebar</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span><span class="n">font_mod</span><span class="o">=</span><span class="mf">1.5</span><span class="p">)</span>
</span><span id="L-1059"><a href="#L-1059"><span class="linenos">1059</span></a>            <span class="c1"># add legend</span>
</span><span id="L-1060"><a href="#L-1060"><span class="linenos">1060</span></a>            <span class="n">handles</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">get_legend_handles_labels</span><span class="p">()</span>
</span><span id="L-1061"><a href="#L-1061"><span class="linenos">1061</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">graphing</span><span class="o">.</span><span class="n">map_view_standard_legend</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">handles</span><span class="p">,</span> <span class="n">labels</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
</span><span id="L-1062"><a href="#L-1062"><span class="linenos">1062</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">25</span><span class="p">)</span>
</span><span id="L-1063"><a href="#L-1063"><span class="linenos">1063</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">(</span><span class="n">pad</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
</span><span id="L-1064"><a href="#L-1064"><span class="linenos">1064</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">plots_dir</span><span class="o">+</span><span class="s2">&quot;/&quot;</span><span class="o">+</span><span class="n">key</span><span class="o">+</span><span class="s2">&quot;.png&quot;</span><span class="p">)</span>
</span><span id="L-1065"><a href="#L-1065"><span class="linenos">1065</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="L-1066"><a href="#L-1066"><span class="linenos">1066</span></a>            
</span><span id="L-1067"><a href="#L-1067"><span class="linenos">1067</span></a>
</span><span id="L-1068"><a href="#L-1068"><span class="linenos">1068</span></a>            <span class="c1"># udpate the plot description</span>
</span><span id="L-1069"><a href="#L-1069"><span class="linenos">1069</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">graph_list</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;PLOT-DESCRIPTION&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;This graph displays the &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="mi">0</span> <span class="k">if</span> <span class="n">emp_overlap</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">emp_overlap</span><span class="o">.</span><span class="n">empty</span> <span class="k">else</span> <span class="nb">len</span><span class="p">(</span><span class="n">emp_overlap</span><span class="p">))</span> <span class="o">+</span> <span class="s2">&quot; employees that are impacted by the relocaiton.  &quot;</span> <span class="o">+</span> \
</span><span id="L-1070"><a href="#L-1070"><span class="linenos">1070</span></a>                                <span class="s2">&quot;Specifically, the red indicates employees that either rotate into, or out of the remote work policy by cutoff-distance. This is &quot;</span> <span class="o">+</span> \
</span><span id="L-1071"><a href="#L-1071"><span class="linenos">1071</span></a>                                <span class="nb">str</span><span class="p">(</span><span class="mi">0</span> <span class="k">if</span> <span class="n">emp_overlap</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">emp_overlap</span><span class="o">.</span><span class="n">empty</span> <span class="k">else</span> <span class="nb">round</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">emp_overlap</span><span class="p">)</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">emp</span><span class="p">)</span><span class="o">*</span><span class="mi">100</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="si">% o</span><span class="s2">f the total employees.  &quot;</span>
</span><span id="L-1072"><a href="#L-1072"><span class="linenos">1072</span></a>        
</span><span id="L-1073"><a href="#L-1073"><span class="linenos">1073</span></a>
</span><span id="L-1074"><a href="#L-1074"><span class="linenos">1074</span></a>        <span class="c1">################################################################################ </span>
</span><span id="L-1075"><a href="#L-1075"><span class="linenos">1075</span></a>        <span class="c1"># GRAPH: </span>
</span><span id="L-1076"><a href="#L-1076"><span class="linenos">1076</span></a>        <span class="c1">## Baseline Commute Cost Analysis</span>
</span><span id="L-1077"><a href="#L-1077"><span class="linenos">1077</span></a>        <span class="n">key</span> <span class="o">=</span> <span class="s1">&#39;bcca&#39;</span>
</span><span id="L-1078"><a href="#L-1078"><span class="linenos">1078</span></a>        <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;Baseline Commute Cost Analysis&quot;</span>
</span><span id="L-1079"><a href="#L-1079"><span class="linenos">1079</span></a>        <span class="n">short_title</span> <span class="o">=</span> <span class="n">title</span>
</span><span id="L-1080"><a href="#L-1080"><span class="linenos">1080</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">graph_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="p">{</span><span class="s2">&quot;GRAPH&quot;</span><span class="p">:</span> <span class="n">key</span><span class="p">,</span>
</span><span id="L-1081"><a href="#L-1081"><span class="linenos">1081</span></a>                                <span class="s2">&quot;TITLE&quot;</span><span class="p">:</span> <span class="n">short_title</span><span class="p">,</span>
</span><span id="L-1082"><a href="#L-1082"><span class="linenos">1082</span></a>                                <span class="s2">&quot;FILENAME&quot;</span><span class="p">:</span> <span class="n">key</span><span class="o">+</span><span class="s2">&quot;.png&quot;</span><span class="p">,</span>
</span><span id="L-1083"><a href="#L-1083"><span class="linenos">1083</span></a>                                <span class="s2">&quot;PLOT-DESCRIPTION&quot;</span><span class="p">:</span> <span class="s2">&quot;deferred&quot;</span>
</span><span id="L-1084"><a href="#L-1084"><span class="linenos">1084</span></a>                                <span class="p">})</span>
</span><span id="L-1085"><a href="#L-1085"><span class="linenos">1085</span></a>        
</span><span id="L-1086"><a href="#L-1086"><span class="linenos">1086</span></a>        <span class="k">if</span> <span class="n">graph</span> <span class="o">==</span> <span class="s2">&quot;_all&quot;</span> <span class="ow">or</span> <span class="n">graph</span> <span class="o">==</span> <span class="n">key</span><span class="p">:</span>
</span><span id="L-1087"><a href="#L-1087"><span class="linenos">1087</span></a>            <span class="c1"># get the value to plot</span>
</span><span id="L-1088"><a href="#L-1088"><span class="linenos">1088</span></a>            <span class="n">value</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;commute_cost&#39;</span><span class="p">]</span>
</span><span id="L-1089"><a href="#L-1089"><span class="linenos">1089</span></a>            <span class="c1"># baseline will be first office, assumed to be the current office, or &quot;as is use case&quot;</span>
</span><span id="L-1090"><a href="#L-1090"><span class="linenos">1090</span></a>            <span class="n">office</span> <span class="o">=</span> <span class="n">offices</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">to_frame</span><span class="p">()</span><span class="o">.</span><span class="n">T</span>
</span><span id="L-1091"><a href="#L-1091"><span class="linenos">1091</span></a>            <span class="c1"># employees to analyze are within the cutoff distance for this office</span>
</span><span id="L-1092"><a href="#L-1092"><span class="linenos">1092</span></a>            <span class="n">emp_within</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graphing</span><span class="o">.</span><span class="n">filter_drive_distance</span><span class="p">(</span><span class="n">emp</span><span class="p">,</span><span class="n">office</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">commute_range_cut_off</span><span class="p">,</span> <span class="n">commute_data</span><span class="o">=</span><span class="n">commute_data</span><span class="p">)</span>
</span><span id="L-1093"><a href="#L-1093"><span class="linenos">1093</span></a>            <span class="c1"># get commute cost values </span>
</span><span id="L-1094"><a href="#L-1094"><span class="linenos">1094</span></a>            <span class="n">cost_values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graphing</span><span class="o">.</span><span class="n">get_commute_values</span><span class="p">(</span><span class="n">emp_within</span><span class="p">,</span> <span class="n">office</span><span class="p">,</span> <span class="n">commute_data</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
</span><span id="L-1095"><a href="#L-1095"><span class="linenos">1095</span></a>            <span class="c1"># calculate the bin list based upon a the max value of the data</span>
</span><span id="L-1096"><a href="#L-1096"><span class="linenos">1096</span></a>            <span class="n">binmax</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">cost_values</span><span class="p">[</span><span class="s1">&#39;commute_cost&#39;</span><span class="p">])</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
</span><span id="L-1097"><a href="#L-1097"><span class="linenos">1097</span></a>            <span class="n">step</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="L-1098"><a href="#L-1098"><span class="linenos">1098</span></a>            <span class="c1"># round the binmax up to the nearest step</span>
</span><span id="L-1099"><a href="#L-1099"><span class="linenos">1099</span></a>            <span class="n">bins</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">binmax</span> <span class="o">+</span> <span class="n">step</span> <span class="o">-</span> <span class="p">(</span><span class="n">binmax</span> <span class="o">%</span> <span class="n">step</span><span class="p">)),</span> <span class="n">step</span><span class="p">)</span>
</span><span id="L-1100"><a href="#L-1100"><span class="linenos">1100</span></a>            <span class="n">plt</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graphing</span><span class="o">.</span><span class="n">get_histogram</span><span class="p">(</span><span class="n">emp_within</span><span class="p">,</span> <span class="n">office</span><span class="p">,</span> <span class="n">commute_data</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">suptitle</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span id="L-1101"><a href="#L-1101"><span class="linenos">1101</span></a>                                      <span class="n">x_label</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="s1">&#39;\$ (USD) based on \$&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">mileage_rate</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39; per mile.&#39;</span><span class="p">),</span> <span class="n">y_label</span><span class="o">=</span><span class="s1">&#39;# Employees&#39;</span><span class="p">,</span>
</span><span id="L-1102"><a href="#L-1102"><span class="linenos">1102</span></a>                                      <span class="n">bins</span><span class="o">=</span><span class="n">bins</span><span class="p">,</span> <span class="n">rows</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">cols</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">column_titles</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Baseline Commute Cost Analysis for &quot;</span><span class="o">+</span><span class="n">office</span><span class="p">[</span><span class="s2">&quot;address&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">],</span> <span class="n">cumulative_line</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">font_mod</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
</span><span id="L-1103"><a href="#L-1103"><span class="linenos">1103</span></a>            
</span><span id="L-1104"><a href="#L-1104"><span class="linenos">1104</span></a>            <span class="c1"># udpate the plot description</span>
</span><span id="L-1105"><a href="#L-1105"><span class="linenos">1105</span></a>            <span class="n">median_cost</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">cost_values</span><span class="p">[</span><span class="s1">&#39;commute_cost&#39;</span><span class="p">]),</span><span class="mi">2</span><span class="p">)</span>
</span><span id="L-1106"><a href="#L-1106"><span class="linenos">1106</span></a>            <span class="n">average_cost</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">cost_values</span><span class="p">[</span><span class="s1">&#39;commute_cost&#39;</span><span class="p">]),</span><span class="mi">2</span><span class="p">)</span>
</span><span id="L-1107"><a href="#L-1107"><span class="linenos">1107</span></a>            <span class="n">commutes</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">commute_days_per_week</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">commute_weeks_per_year</span>
</span><span id="L-1108"><a href="#L-1108"><span class="linenos">1108</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">graph_list</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;PLOT-DESCRIPTION&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;This graph displays the distribution of commute costs for employees within the &quot;</span> <span class="o">+</span> \
</span><span id="L-1109"><a href="#L-1109"><span class="linenos">1109</span></a>                                                    <span class="s2">&quot;cutoff distance of the office at &quot;</span><span class="o">+</span><span class="n">office</span><span class="p">[</span><span class="s2">&quot;address&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="s2">&quot;.  &quot;</span> <span class="o">+</span> \
</span><span id="L-1110"><a href="#L-1110"><span class="linenos">1110</span></a>                                                    <span class="s2">&quot;The median cost per commute is $&quot;</span><span class="o">+</span><span class="s2">&quot;</span><span class="si">{:.2f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">median_cost</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;, and the average cost per commute is $&quot;</span><span class="o">+</span><span class="s2">&quot;</span><span class="si">{:.2f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">average_cost</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;, one way. &quot;</span> <span class="o">+</span> \
</span><span id="L-1111"><a href="#L-1111"><span class="linenos">1111</span></a>                                                    <span class="s2">&quot;For 2 commutes per day, &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">commute_days_per_week</span><span class="p">)</span> <span class="o">+</span> \
</span><span id="L-1112"><a href="#L-1112"><span class="linenos">1112</span></a>                                                    <span class="s2">&quot; days per week, and &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">commute_weeks_per_year</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; weeks per year (&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">commutes</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; commutes/yr), the &quot;</span> <span class="o">+</span> \
</span><span id="L-1113"><a href="#L-1113"><span class="linenos">1113</span></a>                                                    <span class="s2">&quot;median and average annual cost per employee is $&quot;</span><span class="o">+</span><span class="s2">&quot;</span><span class="si">{:.2f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">median_cost</span><span class="o">*</span><span class="n">commutes</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span><span class="o">+</span><span class="s2">&quot; and $&quot;</span><span class="o">+</span><span class="s2">&quot;</span><span class="si">{:.2f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">average_cost</span><span class="o">*</span><span class="n">commutes</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span><span class="o">+</span><span class="s2">&quot; respectively not including tolls, etc. &quot;</span> <span class="o">+</span> \
</span><span id="L-1114"><a href="#L-1114"><span class="linenos">1114</span></a>                                                    <span class="s2">&quot;Minimum and maximum annual costs within the designated commute range are: $&quot;</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="si">{:.2f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">cost_values</span><span class="p">[</span><span class="s1">&#39;commute_cost&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">commutes</span><span class="p">),</span><span class="mi">2</span><span class="p">))</span> <span class="o">+</span> <span class="s2">&quot; and $&quot;</span> <span class="o">+</span> \
</span><span id="L-1115"><a href="#L-1115"><span class="linenos">1115</span></a>                                                    <span class="s2">&quot;</span><span class="si">{:.2f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">cost_values</span><span class="p">[</span><span class="s1">&#39;commute_cost&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">commutes</span><span class="p">),</span><span class="mi">2</span><span class="p">))</span> <span class="o">+</span> <span class="s2">&quot; respectively.  In total, the workforce within the cutoff distance &quot;</span> <span class="o">+</span> \
</span><span id="L-1116"><a href="#L-1116"><span class="linenos">1116</span></a>                                                    <span class="s2">&quot;has a total annual commute cost of $&quot;</span><span class="o">+</span><span class="s2">&quot;</span><span class="si">{:,.2f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">cost_values</span><span class="p">[</span><span class="s1">&#39;commute_cost&#39;</span><span class="p">])</span><span class="o">*</span><span class="n">commutes</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span><span class="o">+</span><span class="s2">&quot;. Values based on $&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">mileage_rate</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot; per mile.&quot;</span>
</span><span id="L-1117"><a href="#L-1117"><span class="linenos">1117</span></a>            
</span><span id="L-1118"><a href="#L-1118"><span class="linenos">1118</span></a>            <span class="c1"># add a text box with the stats, using two decimal places and adding commas at the thousands</span>
</span><span id="L-1119"><a href="#L-1119"><span class="linenos">1119</span></a>            <span class="n">t</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;me&#39;</span> <span class="p">:</span> <span class="s1">&#39;Median: |$</span><span class="si">{:,.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">median_cost</span><span class="o">*</span><span class="n">commutes</span><span class="p">),</span>
</span><span id="L-1120"><a href="#L-1120"><span class="linenos">1120</span></a>                <span class="s1">&#39;av&#39;</span> <span class="p">:</span> <span class="s1">&#39;Average: |$</span><span class="si">{:,.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">average_cost</span><span class="o">*</span><span class="n">commutes</span><span class="p">),</span>
</span><span id="L-1121"><a href="#L-1121"><span class="linenos">1121</span></a>                <span class="s1">&#39;mi&#39;</span> <span class="p">:</span> <span class="s1">&#39;Min: |$</span><span class="si">{:,.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">cost_values</span><span class="p">[</span><span class="s1">&#39;commute_cost&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">commutes</span><span class="p">),</span><span class="mi">2</span><span class="p">)),</span>
</span><span id="L-1122"><a href="#L-1122"><span class="linenos">1122</span></a>                <span class="s1">&#39;ma&#39;</span> <span class="p">:</span> <span class="s1">&#39;Max: |$</span><span class="si">{:,.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">cost_values</span><span class="p">[</span><span class="s1">&#39;commute_cost&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">commutes</span><span class="p">),</span><span class="mi">2</span><span class="p">)),</span>
</span><span id="L-1123"><a href="#L-1123"><span class="linenos">1123</span></a>                <span class="s1">&#39;to&#39;</span> <span class="p">:</span> <span class="s1">&#39;Total: |$</span><span class="si">{:,.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">cost_values</span><span class="p">[</span><span class="s1">&#39;commute_cost&#39;</span><span class="p">])</span><span class="o">*</span><span class="n">commutes</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
</span><span id="L-1124"><a href="#L-1124"><span class="linenos">1124</span></a>                <span class="p">}</span>
</span><span id="L-1125"><a href="#L-1125"><span class="linenos">1125</span></a>            <span class="c1"># get the longest string value</span>
</span><span id="L-1126"><a href="#L-1126"><span class="linenos">1126</span></a>            <span class="n">max_len</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="s1">&#39;me&#39;</span><span class="p">]),</span><span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="s1">&#39;av&#39;</span><span class="p">]),</span><span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="s1">&#39;to&#39;</span><span class="p">]),</span><span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="s1">&#39;mi&#39;</span><span class="p">]),</span><span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="s1">&#39;ma&#39;</span><span class="p">]))</span>
</span><span id="L-1127"><a href="#L-1127"><span class="linenos">1127</span></a>            <span class="c1"># calculate how many narrow numbers/letters exist in the string, we need to add additional space for each</span>
</span><span id="L-1128"><a href="#L-1128"><span class="linenos">1128</span></a>            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">t</span><span class="p">:</span>
</span><span id="L-1129"><a href="#L-1129"><span class="linenos">1129</span></a>                <span class="n">t</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">t</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">,</span><span class="s2">&quot; &quot;</span><span class="o">*</span><span class="p">(</span><span class="n">max_len</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="n">k</span><span class="p">])))</span>
</span><span id="L-1130"><a href="#L-1130"><span class="linenos">1130</span></a>
</span><span id="L-1131"><a href="#L-1131"><span class="linenos">1131</span></a>
</span><span id="L-1132"><a href="#L-1132"><span class="linenos">1132</span></a>            <span class="c1"># add spaces to make all the same length, replacing |</span>
</span><span id="L-1133"><a href="#L-1133"><span class="linenos">1133</span></a>            <span class="n">textstr</span> <span class="o">=</span> <span class="s2">&quot;Annualized Costs: &quot;</span>
</span><span id="L-1134"><a href="#L-1134"><span class="linenos">1134</span></a>            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">t</span><span class="p">:</span>
</span><span id="L-1135"><a href="#L-1135"><span class="linenos">1135</span></a>                <span class="n">textstr</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">t</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
</span><span id="L-1136"><a href="#L-1136"><span class="linenos">1136</span></a>            
</span><span id="L-1137"><a href="#L-1137"><span class="linenos">1137</span></a>            <span class="n">props</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">boxstyle</span><span class="o">=</span><span class="s1">&#39;round&#39;</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;wheat&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
</span><span id="L-1138"><a href="#L-1138"><span class="linenos">1138</span></a>                
</span><span id="L-1139"><a href="#L-1139"><span class="linenos">1139</span></a>            <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">.95</span><span class="p">,</span> <span class="mf">.5</span><span class="p">,</span> <span class="n">textstr</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span>
</span><span id="L-1140"><a href="#L-1140"><span class="linenos">1140</span></a>                        <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">bbox</span><span class="o">=</span><span class="n">props</span><span class="p">,</span> <span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;family&#39;</span><span class="p">:</span> <span class="s1">&#39;monospace&#39;</span><span class="p">},</span> <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">)</span>
</span><span id="L-1141"><a href="#L-1141"><span class="linenos">1141</span></a>
</span><span id="L-1142"><a href="#L-1142"><span class="linenos">1142</span></a>
</span><span id="L-1143"><a href="#L-1143"><span class="linenos">1143</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">(</span><span class="n">pad</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
</span><span id="L-1144"><a href="#L-1144"><span class="linenos">1144</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">plots_dir</span><span class="o">+</span><span class="s2">&quot;/&quot;</span><span class="o">+</span><span class="n">key</span><span class="o">+</span><span class="s2">&quot;.png&quot;</span><span class="p">)</span>
</span><span id="L-1145"><a href="#L-1145"><span class="linenos">1145</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="L-1146"><a href="#L-1146"><span class="linenos">1146</span></a>
</span><span id="L-1147"><a href="#L-1147"><span class="linenos">1147</span></a>            
</span><span id="L-1148"><a href="#L-1148"><span class="linenos">1148</span></a>
</span><span id="L-1149"><a href="#L-1149"><span class="linenos">1149</span></a>        <span class="c1">################################################################################ </span>
</span><span id="L-1150"><a href="#L-1150"><span class="linenos">1150</span></a>        <span class="c1"># GRAPH: </span>
</span><span id="L-1151"><a href="#L-1151"><span class="linenos">1151</span></a>        <span class="c1">## Commute Costs per Office</span>
</span><span id="L-1152"><a href="#L-1152"><span class="linenos">1152</span></a>        <span class="n">key</span> <span class="o">=</span> <span class="s1">&#39;ccpo&#39;</span>
</span><span id="L-1153"><a href="#L-1153"><span class="linenos">1153</span></a>        <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;Commute Costs per Office&quot;</span>
</span><span id="L-1154"><a href="#L-1154"><span class="linenos">1154</span></a>        <span class="n">short_title</span> <span class="o">=</span> <span class="n">title</span>
</span><span id="L-1155"><a href="#L-1155"><span class="linenos">1155</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">graph_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="p">{</span><span class="s2">&quot;GRAPH&quot;</span><span class="p">:</span> <span class="n">key</span><span class="p">,</span>
</span><span id="L-1156"><a href="#L-1156"><span class="linenos">1156</span></a>                                <span class="s2">&quot;TITLE&quot;</span><span class="p">:</span> <span class="n">short_title</span><span class="p">,</span>
</span><span id="L-1157"><a href="#L-1157"><span class="linenos">1157</span></a>                                <span class="s2">&quot;FILENAME&quot;</span><span class="p">:</span> <span class="n">key</span><span class="o">+</span><span class="s2">&quot;.png&quot;</span><span class="p">,</span>
</span><span id="L-1158"><a href="#L-1158"><span class="linenos">1158</span></a>                                <span class="s2">&quot;PLOT-DESCRIPTION&quot;</span><span class="p">:</span> <span class="s2">&quot;This graph displays the distribution of commute costs for employees within the &quot;</span> <span class="o">+</span> \
</span><span id="L-1159"><a href="#L-1159"><span class="linenos">1159</span></a>                                                    <span class="s2">&quot;cutoff distance of the office options. Overall commute costs are shown for each office &quot;</span> <span class="o">+</span> \
</span><span id="L-1160"><a href="#L-1160"><span class="linenos">1160</span></a>                                                    <span class="s2">&quot;option.  This analysis inlcudes only per mile costs, not including tolls, etc.  &quot;</span> <span class="o">+</span> \
</span><span id="L-1161"><a href="#L-1161"><span class="linenos">1161</span></a>                                                    <span class="s2">&quot;Costs due to cash equivalent for time not included.&quot;</span>
</span><span id="L-1162"><a href="#L-1162"><span class="linenos">1162</span></a>                                <span class="p">})</span>
</span><span id="L-1163"><a href="#L-1163"><span class="linenos">1163</span></a>        
</span><span id="L-1164"><a href="#L-1164"><span class="linenos">1164</span></a>        <span class="k">if</span> <span class="n">graph</span> <span class="o">==</span> <span class="s2">&quot;_all&quot;</span> <span class="ow">or</span> <span class="n">graph</span> <span class="o">==</span> <span class="n">key</span><span class="p">:</span>
</span><span id="L-1165"><a href="#L-1165"><span class="linenos">1165</span></a>            <span class="c1"># get the value to plot</span>
</span><span id="L-1166"><a href="#L-1166"><span class="linenos">1166</span></a>            <span class="n">value</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-1167"><a href="#L-1167"><span class="linenos">1167</span></a>            <span class="c1"># employees to analyze are within the cutoff distance for this office</span>
</span><span id="L-1168"><a href="#L-1168"><span class="linenos">1168</span></a>            <span class="c1"># for this analysis, we need to iterate through options</span>
</span><span id="L-1169"><a href="#L-1169"><span class="linenos">1169</span></a>            <span class="n">emp_within</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-1170"><a href="#L-1170"><span class="linenos">1170</span></a>            <span class="n">office_addrs</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-1171"><a href="#L-1171"><span class="linenos">1171</span></a>            <span class="n">cost_values</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-1172"><a href="#L-1172"><span class="linenos">1172</span></a>            <span class="n">median_costs</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-1173"><a href="#L-1173"><span class="linenos">1173</span></a>            <span class="n">average_costs</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-1174"><a href="#L-1174"><span class="linenos">1174</span></a>            <span class="n">total_costs</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-1175"><a href="#L-1175"><span class="linenos">1175</span></a>            <span class="n">min_costs</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-1176"><a href="#L-1176"><span class="linenos">1176</span></a>            <span class="n">max_costs</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-1177"><a href="#L-1177"><span class="linenos">1177</span></a>            <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">offices</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
</span><span id="L-1178"><a href="#L-1178"><span class="linenos">1178</span></a>                <span class="n">office</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">to_frame</span><span class="p">()</span><span class="o">.</span><span class="n">T</span>
</span><span id="L-1179"><a href="#L-1179"><span class="linenos">1179</span></a>                <span class="n">emp_within</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">graphing</span><span class="o">.</span><span class="n">filter_drive_distance</span><span class="p">(</span><span class="n">emp</span><span class="p">,</span><span class="n">office</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">commute_range_cut_off</span><span class="p">,</span> <span class="n">commute_data</span><span class="o">=</span><span class="n">commute_data</span><span class="p">))</span>
</span><span id="L-1180"><a href="#L-1180"><span class="linenos">1180</span></a>                <span class="n">office_addrs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">office</span><span class="p">[</span><span class="s2">&quot;address&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="L-1181"><a href="#L-1181"><span class="linenos">1181</span></a>                <span class="n">value</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;commute_cost&#39;</span><span class="p">)</span>
</span><span id="L-1182"><a href="#L-1182"><span class="linenos">1182</span></a>                <span class="n">cost_values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">graphing</span><span class="o">.</span><span class="n">get_commute_values</span><span class="p">(</span><span class="n">emp_within</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">office</span><span class="p">,</span> <span class="n">commute_data</span><span class="p">,</span> <span class="n">value</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span>
</span><span id="L-1183"><a href="#L-1183"><span class="linenos">1183</span></a>                <span class="n">commutes</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">commute_days_per_week</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">commute_weeks_per_year</span>
</span><span id="L-1184"><a href="#L-1184"><span class="linenos">1184</span></a>                <span class="n">median_costs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">cost_values</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;commute_cost&#39;</span><span class="p">])</span><span class="o">*</span><span class="n">commutes</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
</span><span id="L-1185"><a href="#L-1185"><span class="linenos">1185</span></a>                <span class="n">average_costs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">cost_values</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;commute_cost&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">commutes</span><span class="p">),</span><span class="mi">2</span><span class="p">))</span>
</span><span id="L-1186"><a href="#L-1186"><span class="linenos">1186</span></a>                <span class="n">total_costs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">cost_values</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;commute_cost&#39;</span><span class="p">])</span><span class="o">*</span><span class="n">commutes</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
</span><span id="L-1187"><a href="#L-1187"><span class="linenos">1187</span></a>                <span class="n">min_costs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">cost_values</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;commute_cost&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">commutes</span><span class="p">),</span><span class="mi">2</span><span class="p">))</span>
</span><span id="L-1188"><a href="#L-1188"><span class="linenos">1188</span></a>                <span class="n">max_costs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">cost_values</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;commute_cost&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">commutes</span><span class="p">),</span><span class="mi">2</span><span class="p">))</span>
</span><span id="L-1189"><a href="#L-1189"><span class="linenos">1189</span></a>
</span><span id="L-1190"><a href="#L-1190"><span class="linenos">1190</span></a>
</span><span id="L-1191"><a href="#L-1191"><span class="linenos">1191</span></a>            <span class="c1"># calculate the bin list based upon a the max value of the data</span>
</span><span id="L-1192"><a href="#L-1192"><span class="linenos">1192</span></a>            <span class="c1">#binmax = int(max(cost_values[&#39;commute_cost&#39;])+1)</span>
</span><span id="L-1193"><a href="#L-1193"><span class="linenos">1193</span></a>            <span class="n">binmax</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-1194"><a href="#L-1194"><span class="linenos">1194</span></a>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">cost_values</span><span class="p">)):</span>
</span><span id="L-1195"><a href="#L-1195"><span class="linenos">1195</span></a>                <span class="k">if</span> <span class="nb">max</span><span class="p">(</span><span class="n">cost_values</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;commute_cost&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="n">binmax</span><span class="p">:</span>
</span><span id="L-1196"><a href="#L-1196"><span class="linenos">1196</span></a>                    <span class="n">binmax</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">cost_values</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;commute_cost&#39;</span><span class="p">])</span>
</span><span id="L-1197"><a href="#L-1197"><span class="linenos">1197</span></a>            <span class="n">step</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="L-1198"><a href="#L-1198"><span class="linenos">1198</span></a>            <span class="c1"># round the binmax up to the nearest step</span>
</span><span id="L-1199"><a href="#L-1199"><span class="linenos">1199</span></a>            <span class="n">bins</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">binmax</span> <span class="o">+</span> <span class="n">step</span> <span class="o">-</span> <span class="p">(</span><span class="n">binmax</span> <span class="o">%</span> <span class="n">step</span><span class="p">)),</span> <span class="n">step</span><span class="p">)</span>
</span><span id="L-1200"><a href="#L-1200"><span class="linenos">1200</span></a>            <span class="n">plt</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graphing</span><span class="o">.</span><span class="n">get_histogram</span><span class="p">(</span><span class="n">emp</span><span class="p">,</span> <span class="n">offices</span><span class="p">,</span> <span class="n">commute_data</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">suptitle</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">cutoff_radius</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">commute_range_cut_off</span><span class="p">,</span>
</span><span id="L-1201"><a href="#L-1201"><span class="linenos">1201</span></a>                                      <span class="n">x_label</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="s1">&#39;\$ (USD), one-way, based on \$&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">mileage_rate</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39; per mile.&#39;</span><span class="p">),</span> <span class="n">y_label</span><span class="o">=</span><span class="s1">&#39;# Employees&#39;</span><span class="p">,</span>
</span><span id="L-1202"><a href="#L-1202"><span class="linenos">1202</span></a>                                      <span class="n">bins</span><span class="o">=</span><span class="n">bins</span><span class="p">,</span> <span class="n">rows</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">office_addrs</span><span class="p">),</span> <span class="n">cols</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">column_titles</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Commute Cost Analysis for Options&quot;</span><span class="p">],</span> 
</span><span id="L-1203"><a href="#L-1203"><span class="linenos">1203</span></a>                                      <span class="n">cumulative_line</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">font_mod</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">manual_plot</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-1204"><a href="#L-1204"><span class="linenos">1204</span></a>            
</span><span id="L-1205"><a href="#L-1205"><span class="linenos">1205</span></a>            <span class="c1"># manually add histograms for each office option</span>
</span><span id="L-1206"><a href="#L-1206"><span class="linenos">1206</span></a>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">emp_within</span><span class="p">)):</span>
</span><span id="L-1207"><a href="#L-1207"><span class="linenos">1207</span></a>                <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">cost_values</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;commute_cost&#39;</span><span class="p">],</span> <span class="n">bins</span><span class="o">=</span><span class="n">bins</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;#555555&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">align</span><span class="o">=</span><span class="s1">&#39;mid&#39;</span><span class="p">,</span> 
</span><span id="L-1208"><a href="#L-1208"><span class="linenos">1208</span></a>                           <span class="n">rwidth</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">office_addrs</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
</span><span id="L-1209"><a href="#L-1209"><span class="linenos">1209</span></a>                <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;major&#39;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
</span><span id="L-1210"><a href="#L-1210"><span class="linenos">1210</span></a>                
</span><span id="L-1211"><a href="#L-1211"><span class="linenos">1211</span></a>                <span class="c1"># add a legend to show the office options</span>
</span><span id="L-1212"><a href="#L-1212"><span class="linenos">1212</span></a>                <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper right&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
</span><span id="L-1213"><a href="#L-1213"><span class="linenos">1213</span></a>                
</span><span id="L-1214"><a href="#L-1214"><span class="linenos">1214</span></a>                <span class="c1"># add a text box with the stats, using two decimal places and adding commas at the thousands</span>
</span><span id="L-1215"><a href="#L-1215"><span class="linenos">1215</span></a>                <span class="n">t</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;me&#39;</span> <span class="p">:</span> <span class="s1">&#39;Median: |$</span><span class="si">{:,.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">median_costs</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span>
</span><span id="L-1216"><a href="#L-1216"><span class="linenos">1216</span></a>                    <span class="s1">&#39;av&#39;</span> <span class="p">:</span> <span class="s1">&#39;Average: |$</span><span class="si">{:,.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">average_costs</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span>
</span><span id="L-1217"><a href="#L-1217"><span class="linenos">1217</span></a>                    <span class="s1">&#39;mi&#39;</span> <span class="p">:</span> <span class="s1">&#39;Min: |$</span><span class="si">{:,.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">min_costs</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span>
</span><span id="L-1218"><a href="#L-1218"><span class="linenos">1218</span></a>                    <span class="s1">&#39;ma&#39;</span> <span class="p">:</span> <span class="s1">&#39;Max: |$</span><span class="si">{:,.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">max_costs</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span>
</span><span id="L-1219"><a href="#L-1219"><span class="linenos">1219</span></a>                    <span class="s1">&#39;to&#39;</span> <span class="p">:</span> <span class="s1">&#39;Total: |$</span><span class="si">{:,.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">total_costs</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</span><span id="L-1220"><a href="#L-1220"><span class="linenos">1220</span></a>                    <span class="p">}</span>             
</span><span id="L-1221"><a href="#L-1221"><span class="linenos">1221</span></a>                <span class="c1"># get the longest string value</span>
</span><span id="L-1222"><a href="#L-1222"><span class="linenos">1222</span></a>                <span class="n">max_len</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="s1">&#39;me&#39;</span><span class="p">]),</span><span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="s1">&#39;av&#39;</span><span class="p">]),</span><span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="s1">&#39;to&#39;</span><span class="p">]),</span><span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="s1">&#39;mi&#39;</span><span class="p">]),</span><span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="s1">&#39;ma&#39;</span><span class="p">]))</span>
</span><span id="L-1223"><a href="#L-1223"><span class="linenos">1223</span></a>                
</span><span id="L-1224"><a href="#L-1224"><span class="linenos">1224</span></a>                <span class="c1"># calculate how many narrow numbers/letters exist in the string, we need to add additional space for each</span>
</span><span id="L-1225"><a href="#L-1225"><span class="linenos">1225</span></a>                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">t</span><span class="p">:</span>
</span><span id="L-1226"><a href="#L-1226"><span class="linenos">1226</span></a>                    <span class="n">t</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">t</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">,</span><span class="s2">&quot; &quot;</span><span class="o">*</span><span class="p">(</span><span class="n">max_len</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="n">k</span><span class="p">])))</span>
</span><span id="L-1227"><a href="#L-1227"><span class="linenos">1227</span></a>
</span><span id="L-1228"><a href="#L-1228"><span class="linenos">1228</span></a>
</span><span id="L-1229"><a href="#L-1229"><span class="linenos">1229</span></a>                <span class="c1"># add spaces to make all the same length, replacing |</span>
</span><span id="L-1230"><a href="#L-1230"><span class="linenos">1230</span></a>                <span class="n">textstr</span> <span class="o">=</span> <span class="s2">&quot;Annualized Costs: &quot;</span>
</span><span id="L-1231"><a href="#L-1231"><span class="linenos">1231</span></a>                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">t</span><span class="p">:</span>
</span><span id="L-1232"><a href="#L-1232"><span class="linenos">1232</span></a>                    <span class="n">textstr</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">t</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
</span><span id="L-1233"><a href="#L-1233"><span class="linenos">1233</span></a>                <span class="c1"># these are matplotlib.patch.Patch properties</span>
</span><span id="L-1234"><a href="#L-1234"><span class="linenos">1234</span></a>                <span class="n">props</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">boxstyle</span><span class="o">=</span><span class="s1">&#39;round&#39;</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;wheat&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
</span><span id="L-1235"><a href="#L-1235"><span class="linenos">1235</span></a>                <span class="c1"># place a text box in upper right in axes coords, </span>
</span><span id="L-1236"><a href="#L-1236"><span class="linenos">1236</span></a>                <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">.95</span><span class="p">,</span> <span class="mf">.5</span><span class="p">,</span> <span class="n">textstr</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">,</span>
</span><span id="L-1237"><a href="#L-1237"><span class="linenos">1237</span></a>                            <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">bbox</span><span class="o">=</span><span class="n">props</span><span class="p">,</span> <span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;family&#39;</span><span class="p">:</span> <span class="s1">&#39;monospace&#39;</span><span class="p">},</span> <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">)</span>
</span><span id="L-1238"><a href="#L-1238"><span class="linenos">1238</span></a>                
</span><span id="L-1239"><a href="#L-1239"><span class="linenos">1239</span></a>            
</span><span id="L-1240"><a href="#L-1240"><span class="linenos">1240</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">(</span><span class="n">pad</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
</span><span id="L-1241"><a href="#L-1241"><span class="linenos">1241</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">plots_dir</span><span class="o">+</span><span class="s2">&quot;/&quot;</span><span class="o">+</span><span class="n">key</span><span class="o">+</span><span class="s2">&quot;.png&quot;</span><span class="p">)</span>
</span><span id="L-1242"><a href="#L-1242"><span class="linenos">1242</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="L-1243"><a href="#L-1243"><span class="linenos">1243</span></a>
</span><span id="L-1244"><a href="#L-1244"><span class="linenos">1244</span></a>            
</span><span id="L-1245"><a href="#L-1245"><span class="linenos">1245</span></a>            
</span><span id="L-1246"><a href="#L-1246"><span class="linenos">1246</span></a>        
</span><span id="L-1247"><a href="#L-1247"><span class="linenos">1247</span></a>        <span class="c1">################################################################################ </span>
</span><span id="L-1248"><a href="#L-1248"><span class="linenos">1248</span></a>        <span class="c1"># GRAPH: </span>
</span><span id="L-1249"><a href="#L-1249"><span class="linenos">1249</span></a>        <span class="c1">## Employee Commute Cost Differential Analysis</span>
</span><span id="L-1250"><a href="#L-1250"><span class="linenos">1250</span></a>        <span class="n">key</span> <span class="o">=</span> <span class="s1">&#39;eccda&#39;</span>
</span><span id="L-1251"><a href="#L-1251"><span class="linenos">1251</span></a>        <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;Employee Commute Cost Differential Analysis&quot;</span>
</span><span id="L-1252"><a href="#L-1252"><span class="linenos">1252</span></a>        <span class="n">short_title</span> <span class="o">=</span> <span class="n">title</span>
</span><span id="L-1253"><a href="#L-1253"><span class="linenos">1253</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">graph_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="p">{</span><span class="s2">&quot;GRAPH&quot;</span><span class="p">:</span> <span class="n">key</span><span class="p">,</span>
</span><span id="L-1254"><a href="#L-1254"><span class="linenos">1254</span></a>                                <span class="s2">&quot;TITLE&quot;</span><span class="p">:</span> <span class="n">short_title</span><span class="p">,</span>
</span><span id="L-1255"><a href="#L-1255"><span class="linenos">1255</span></a>                                <span class="s2">&quot;FILENAME&quot;</span><span class="p">:</span> <span class="n">key</span><span class="o">+</span><span class="s2">&quot;.png&quot;</span><span class="p">,</span>
</span><span id="L-1256"><a href="#L-1256"><span class="linenos">1256</span></a>                                <span class="s2">&quot;PLOT-DESCRIPTION&quot;</span><span class="p">:</span> <span class="s2">&quot;This graph displays the distribution of commute costs for employees within the &quot;</span> <span class="o">+</span> \
</span><span id="L-1257"><a href="#L-1257"><span class="linenos">1257</span></a>                                                    <span class="s2">&quot;cutoff distance of the office options. Changes in per-employee commute costs are shown for each office &quot;</span> <span class="o">+</span> \
</span><span id="L-1258"><a href="#L-1258"><span class="linenos">1258</span></a>                                                    <span class="s2">&quot;option relative to the existing office locaton.  This analysis inlcudes only per mile costs, not including tolls, etc.  &quot;</span> <span class="o">+</span> \
</span><span id="L-1259"><a href="#L-1259"><span class="linenos">1259</span></a>                                                    <span class="s2">&quot;Costs due to cash equivalent for time not included.&quot;</span>
</span><span id="L-1260"><a href="#L-1260"><span class="linenos">1260</span></a>                                <span class="p">})</span>
</span><span id="L-1261"><a href="#L-1261"><span class="linenos">1261</span></a>        
</span><span id="L-1262"><a href="#L-1262"><span class="linenos">1262</span></a>        <span class="k">if</span> <span class="n">graph</span> <span class="o">==</span> <span class="s2">&quot;_all&quot;</span> <span class="ow">or</span> <span class="n">graph</span> <span class="o">==</span> <span class="n">key</span><span class="p">:</span>
</span><span id="L-1263"><a href="#L-1263"><span class="linenos">1263</span></a>            <span class="c1"># get the value to plot</span>
</span><span id="L-1264"><a href="#L-1264"><span class="linenos">1264</span></a>            <span class="n">value</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-1265"><a href="#L-1265"><span class="linenos">1265</span></a>            <span class="c1"># employees to analyze are within the cutoff distance for this office</span>
</span><span id="L-1266"><a href="#L-1266"><span class="linenos">1266</span></a>            <span class="c1"># for this analysis, we need to iterate through options</span>
</span><span id="L-1267"><a href="#L-1267"><span class="linenos">1267</span></a>            <span class="n">current_office</span> <span class="o">=</span> <span class="n">offices</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">to_frame</span><span class="p">()</span><span class="o">.</span><span class="n">T</span>
</span><span id="L-1268"><a href="#L-1268"><span class="linenos">1268</span></a>            <span class="n">other_offices</span> <span class="o">=</span> <span class="n">offices</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="L-1269"><a href="#L-1269"><span class="linenos">1269</span></a>            <span class="n">cost_values</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-1270"><a href="#L-1270"><span class="linenos">1270</span></a>            <span class="n">withins</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-1271"><a href="#L-1271"><span class="linenos">1271</span></a>            <span class="n">commutes</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">commute_days_per_week</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">commute_weeks_per_year</span>
</span><span id="L-1272"><a href="#L-1272"><span class="linenos">1272</span></a>            
</span><span id="L-1273"><a href="#L-1273"><span class="linenos">1273</span></a>            <span class="c1"># for each employee, calculate the commute cost to the current office, place a new dataframe with lat, long, office, and cost</span>
</span><span id="L-1274"><a href="#L-1274"><span class="linenos">1274</span></a>            <span class="c1"># if the employee is within the cutoff distance, if outside the cutoff distance, the cost is 0</span>
</span><span id="L-1275"><a href="#L-1275"><span class="linenos">1275</span></a>            <span class="c1"># start by looping through ALL employees and adding a row with the current office, and cost = 0</span>
</span><span id="L-1276"><a href="#L-1276"><span class="linenos">1276</span></a>                    
</span><span id="L-1277"><a href="#L-1277"><span class="linenos">1277</span></a>
</span><span id="L-1278"><a href="#L-1278"><span class="linenos">1278</span></a>            <span class="n">base_costs</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">get_base_cost_df</span><span class="p">(</span><span class="n">emp</span><span class="p">,</span> <span class="n">current_office</span><span class="p">[</span><span class="s1">&#39;address&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
</span><span id="L-1279"><a href="#L-1279"><span class="linenos">1279</span></a>            <span class="c1"># now get emp_within for the current office, and update the relevant rows of base_costs with actual costs for those employees </span>
</span><span id="L-1280"><a href="#L-1280"><span class="linenos">1280</span></a>            <span class="c1"># using the commute_cost column in the commute_data dataframe where the employee lat long matches the commute_data lat long and office address</span>
</span><span id="L-1281"><a href="#L-1281"><span class="linenos">1281</span></a>            
</span><span id="L-1282"><a href="#L-1282"><span class="linenos">1282</span></a>            <span class="n">base_emp_within</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graphing</span><span class="o">.</span><span class="n">filter_drive_distance</span><span class="p">(</span><span class="n">emp</span><span class="p">,</span><span class="n">current_office</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">commute_range_cut_off</span><span class="p">,</span> <span class="n">commute_data</span><span class="o">=</span><span class="n">commute_data</span><span class="p">)</span>
</span><span id="L-1283"><a href="#L-1283"><span class="linenos">1283</span></a>
</span><span id="L-1284"><a href="#L-1284"><span class="linenos">1284</span></a>            <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">base_emp_within</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
</span><span id="L-1285"><a href="#L-1285"><span class="linenos">1285</span></a>                <span class="c1"># get the cost from the commute_data</span>
</span><span id="L-1286"><a href="#L-1286"><span class="linenos">1286</span></a>                <span class="n">cost</span> <span class="o">=</span> <span class="n">commute_data</span><span class="p">[(</span><span class="n">commute_data</span><span class="p">[</span><span class="s1">&#39;origin_lat&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;latitude&#39;</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">commute_data</span><span class="p">[</span><span class="s1">&#39;origin_long&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;longitude&#39;</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">commute_data</span><span class="p">[</span><span class="s1">&#39;office_address&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">current_office</span><span class="p">[</span><span class="s1">&#39;address&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">])][</span><span class="s1">&#39;commute_cost&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-1287"><a href="#L-1287"><span class="linenos">1287</span></a>                <span class="n">base_costs</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">base_costs</span><span class="p">[</span><span class="s1">&#39;latitude&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;latitude&#39;</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">base_costs</span><span class="p">[</span><span class="s1">&#39;longitude&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;longitude&#39;</span><span class="p">]),</span><span class="s1">&#39;cost&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cost</span>
</span><span id="L-1288"><a href="#L-1288"><span class="linenos">1288</span></a>            <span class="c1"># now we have a dataframe with all employees, and the cost to the current office</span>
</span><span id="L-1289"><a href="#L-1289"><span class="linenos">1289</span></a>        
</span><span id="L-1290"><a href="#L-1290"><span class="linenos">1290</span></a>            <span class="c1"># now iterate through the other offices, get a base cost dataframe, and then update the relevant rows with actual costs, place in cost_values</span>
</span><span id="L-1291"><a href="#L-1291"><span class="linenos">1291</span></a>            <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">other_offices</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
</span><span id="L-1292"><a href="#L-1292"><span class="linenos">1292</span></a>                <span class="n">office</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">to_frame</span><span class="p">()</span><span class="o">.</span><span class="n">T</span>
</span><span id="L-1293"><a href="#L-1293"><span class="linenos">1293</span></a>                <span class="n">tmp_costs</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">get_base_cost_df</span><span class="p">(</span><span class="n">emp</span><span class="p">,</span> <span class="n">office</span><span class="p">[</span><span class="s1">&#39;address&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
</span><span id="L-1294"><a href="#L-1294"><span class="linenos">1294</span></a>                <span class="n">emp_within</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graphing</span><span class="o">.</span><span class="n">filter_drive_distance</span><span class="p">(</span><span class="n">emp</span><span class="p">,</span><span class="n">office</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">commute_range_cut_off</span><span class="p">,</span> <span class="n">commute_data</span><span class="o">=</span><span class="n">commute_data</span><span class="p">)</span>
</span><span id="L-1295"><a href="#L-1295"><span class="linenos">1295</span></a>                <span class="c1"># we will use this later to get the differential for each employee, without the employees that aren&#39;t overlapping</span>
</span><span id="L-1296"><a href="#L-1296"><span class="linenos">1296</span></a>                <span class="n">withins</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">emp_within</span><span class="p">)</span>
</span><span id="L-1297"><a href="#L-1297"><span class="linenos">1297</span></a>                <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">emp_within</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
</span><span id="L-1298"><a href="#L-1298"><span class="linenos">1298</span></a>                    <span class="c1"># get the cost from the commute_data</span>
</span><span id="L-1299"><a href="#L-1299"><span class="linenos">1299</span></a>                    <span class="n">cost</span> <span class="o">=</span> <span class="n">commute_data</span><span class="p">[(</span><span class="n">commute_data</span><span class="p">[</span><span class="s1">&#39;origin_lat&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;latitude&#39;</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">commute_data</span><span class="p">[</span><span class="s1">&#39;origin_long&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;longitude&#39;</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">commute_data</span><span class="p">[</span><span class="s1">&#39;office_address&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">office</span><span class="p">[</span><span class="s1">&#39;address&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">])][</span><span class="s1">&#39;commute_cost&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-1300"><a href="#L-1300"><span class="linenos">1300</span></a>                    <span class="n">tmp_costs</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">tmp_costs</span><span class="p">[</span><span class="s1">&#39;latitude&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;latitude&#39;</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">tmp_costs</span><span class="p">[</span><span class="s1">&#39;longitude&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;longitude&#39;</span><span class="p">]),</span><span class="s1">&#39;cost&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cost</span>
</span><span id="L-1301"><a href="#L-1301"><span class="linenos">1301</span></a>                <span class="n">cost_values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tmp_costs</span><span class="p">)</span>
</span><span id="L-1302"><a href="#L-1302"><span class="linenos">1302</span></a>            
</span><span id="L-1303"><a href="#L-1303"><span class="linenos">1303</span></a>            <span class="c1"># now we have a full list of costs for each employee to each office, we can get the differentials</span>
</span><span id="L-1304"><a href="#L-1304"><span class="linenos">1304</span></a>            <span class="c1"># create a list to hold the differential dataframes</span>
</span><span id="L-1305"><a href="#L-1305"><span class="linenos">1305</span></a>            <span class="n">diffs</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-1306"><a href="#L-1306"><span class="linenos">1306</span></a>            <span class="c1"># for each cost dataframe, calculate the differential from the base_costs dataframe into a new dataframe</span>
</span><span id="L-1307"><a href="#L-1307"><span class="linenos">1307</span></a>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">cost_values</span><span class="p">)):</span>
</span><span id="L-1308"><a href="#L-1308"><span class="linenos">1308</span></a>                <span class="c1"># get the differential</span>
</span><span id="L-1309"><a href="#L-1309"><span class="linenos">1309</span></a>                <span class="n">diffs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cost_values</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;cost&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">base_costs</span><span class="p">[</span><span class="s1">&#39;cost&#39;</span><span class="p">])</span>
</span><span id="L-1310"><a href="#L-1310"><span class="linenos">1310</span></a>            <span class="c1"># now we have a list of dataframes with the differentials, we eliminate all rows with 0 cost differential to prevent skewing the histogram</span>
</span><span id="L-1311"><a href="#L-1311"><span class="linenos">1311</span></a>            <span class="c1"># calculate the bin list based upon a the min (negative) and max (positive) values of the data     </span>
</span><span id="L-1312"><a href="#L-1312"><span class="linenos">1312</span></a>            <span class="n">binmin</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-1313"><a href="#L-1313"><span class="linenos">1313</span></a>            <span class="n">binmax</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-1314"><a href="#L-1314"><span class="linenos">1314</span></a>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">diffs</span><span class="p">)):</span>
</span><span id="L-1315"><a href="#L-1315"><span class="linenos">1315</span></a>                <span class="k">if</span> <span class="nb">min</span><span class="p">(</span><span class="n">diffs</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">&lt;</span> <span class="n">binmin</span><span class="p">:</span>
</span><span id="L-1316"><a href="#L-1316"><span class="linenos">1316</span></a>                    <span class="n">binmin</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">diffs</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</span><span id="L-1317"><a href="#L-1317"><span class="linenos">1317</span></a>                <span class="k">if</span> <span class="nb">max</span><span class="p">(</span><span class="n">diffs</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">&gt;</span> <span class="n">binmax</span><span class="p">:</span>
</span><span id="L-1318"><a href="#L-1318"><span class="linenos">1318</span></a>                    <span class="n">binmax</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">diffs</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</span><span id="L-1319"><a href="#L-1319"><span class="linenos">1319</span></a>            <span class="n">step</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="L-1320"><a href="#L-1320"><span class="linenos">1320</span></a>            <span class="c1"># round the binmin down to the nearest step, max up to the nearest step</span>
</span><span id="L-1321"><a href="#L-1321"><span class="linenos">1321</span></a>            <span class="n">bins</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">binmin</span> <span class="o">-</span> <span class="p">(</span><span class="n">binmin</span> <span class="o">%</span> <span class="n">step</span><span class="p">)),</span> <span class="nb">int</span><span class="p">(</span><span class="n">binmax</span> <span class="o">+</span> <span class="n">step</span> <span class="o">-</span> <span class="p">(</span><span class="n">binmax</span> <span class="o">%</span> <span class="n">step</span><span class="p">)),</span> <span class="n">step</span><span class="p">)</span>
</span><span id="L-1322"><a href="#L-1322"><span class="linenos">1322</span></a>
</span><span id="L-1323"><a href="#L-1323"><span class="linenos">1323</span></a>            <span class="n">plt</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graphing</span><span class="o">.</span><span class="n">get_histogram</span><span class="p">(</span><span class="n">emp</span><span class="p">,</span> <span class="n">other_offices</span><span class="p">,</span> <span class="n">commute_data</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">suptitle</span><span class="o">=</span><span class="s2">&quot;Employee Commute Cost Differential Analysis&quot;</span><span class="p">,</span> <span class="n">cutoff_radius</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">commute_range_cut_off</span><span class="p">,</span>
</span><span id="L-1324"><a href="#L-1324"><span class="linenos">1324</span></a>                                      <span class="n">x_label</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="s1">&#39;\$ (USD) based on \$&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">mileage_rate</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39; per mile.&#39;</span><span class="p">),</span> <span class="n">y_label</span><span class="o">=</span><span class="s1">&#39;# Employees (log scale)&#39;</span><span class="p">,</span>
</span><span id="L-1325"><a href="#L-1325"><span class="linenos">1325</span></a>                                      <span class="n">bins</span><span class="o">=</span><span class="n">bins</span><span class="p">,</span> <span class="n">rows</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">other_offices</span><span class="p">),</span> <span class="n">cols</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">column_titles</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Employee Commute Cost Differential Analysis&quot;</span><span class="p">],</span> 
</span><span id="L-1326"><a href="#L-1326"><span class="linenos">1326</span></a>                                      <span class="n">cumulative_line</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">font_mod</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">manual_plot</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-1327"><a href="#L-1327"><span class="linenos">1327</span></a>            
</span><span id="L-1328"><a href="#L-1328"><span class="linenos">1328</span></a>            <span class="c1"># manually add histograms for each office option</span>
</span><span id="L-1329"><a href="#L-1329"><span class="linenos">1329</span></a>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">diffs</span><span class="p">)):</span>
</span><span id="L-1330"><a href="#L-1330"><span class="linenos">1330</span></a>                <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">diffs</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">bins</span><span class="o">=</span><span class="n">bins</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;#555555&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">align</span><span class="o">=</span><span class="s1">&#39;mid&#39;</span><span class="p">,</span> 
</span><span id="L-1331"><a href="#L-1331"><span class="linenos">1331</span></a>                           <span class="n">rwidth</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">other_offices</span><span class="p">[</span><span class="s1">&#39;address&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>
</span><span id="L-1332"><a href="#L-1332"><span class="linenos">1332</span></a>                <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;major&#39;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
</span><span id="L-1333"><a href="#L-1333"><span class="linenos">1333</span></a>                
</span><span id="L-1334"><a href="#L-1334"><span class="linenos">1334</span></a>                <span class="c1"># add a legend to show the office options</span>
</span><span id="L-1335"><a href="#L-1335"><span class="linenos">1335</span></a>                <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper right&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
</span><span id="L-1336"><a href="#L-1336"><span class="linenos">1336</span></a>                
</span><span id="L-1337"><a href="#L-1337"><span class="linenos">1337</span></a>                <span class="c1"># add a text box with the stats, using two decimal places and adding commas at the thousands</span>
</span><span id="L-1338"><a href="#L-1338"><span class="linenos">1338</span></a>                <span class="n">t</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;me&#39;</span> <span class="p">:</span> <span class="s1">&#39;Median: |$</span><span class="si">{:,.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">diffs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">commutes</span><span class="p">)),</span>
</span><span id="L-1339"><a href="#L-1339"><span class="linenos">1339</span></a>                    <span class="s1">&#39;av&#39;</span> <span class="p">:</span> <span class="s1">&#39;Average: |$</span><span class="si">{:,.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">diffs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">commutes</span><span class="p">)),</span>
</span><span id="L-1340"><a href="#L-1340"><span class="linenos">1340</span></a>                    <span class="s1">&#39;mi&#39;</span> <span class="p">:</span> <span class="s1">&#39;Min: |$</span><span class="si">{:,.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">diffs</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">*</span><span class="n">commutes</span><span class="p">),</span>
</span><span id="L-1341"><a href="#L-1341"><span class="linenos">1341</span></a>                    <span class="s1">&#39;ma&#39;</span> <span class="p">:</span> <span class="s1">&#39;Max: |$</span><span class="si">{:,.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">diffs</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">*</span><span class="n">commutes</span><span class="p">),</span>
</span><span id="L-1342"><a href="#L-1342"><span class="linenos">1342</span></a>                    <span class="s1">&#39;to&#39;</span> <span class="p">:</span> <span class="s1">&#39;Total: |$</span><span class="si">{:,.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">diffs</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">*</span><span class="n">commutes</span><span class="p">)</span>
</span><span id="L-1343"><a href="#L-1343"><span class="linenos">1343</span></a>                    <span class="p">}</span>             
</span><span id="L-1344"><a href="#L-1344"><span class="linenos">1344</span></a>                <span class="c1"># get the longest string value</span>
</span><span id="L-1345"><a href="#L-1345"><span class="linenos">1345</span></a>                <span class="n">max_len</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="s1">&#39;me&#39;</span><span class="p">]),</span><span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="s1">&#39;av&#39;</span><span class="p">]),</span><span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="s1">&#39;to&#39;</span><span class="p">]),</span><span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="s1">&#39;mi&#39;</span><span class="p">]),</span><span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="s1">&#39;ma&#39;</span><span class="p">]))</span>
</span><span id="L-1346"><a href="#L-1346"><span class="linenos">1346</span></a>                
</span><span id="L-1347"><a href="#L-1347"><span class="linenos">1347</span></a>                <span class="c1"># calculate additional space</span>
</span><span id="L-1348"><a href="#L-1348"><span class="linenos">1348</span></a>                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">t</span><span class="p">:</span>
</span><span id="L-1349"><a href="#L-1349"><span class="linenos">1349</span></a>                    <span class="n">t</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">t</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">,</span><span class="s2">&quot; &quot;</span><span class="o">*</span><span class="p">(</span><span class="n">max_len</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="n">k</span><span class="p">])))</span>
</span><span id="L-1350"><a href="#L-1350"><span class="linenos">1350</span></a>
</span><span id="L-1351"><a href="#L-1351"><span class="linenos">1351</span></a>
</span><span id="L-1352"><a href="#L-1352"><span class="linenos">1352</span></a>                <span class="c1"># add spaces to make all the same length, replacing |</span>
</span><span id="L-1353"><a href="#L-1353"><span class="linenos">1353</span></a>                <span class="n">textstr</span> <span class="o">=</span> <span class="s2">&quot;Annualized </span><span class="se">\n</span><span class="s2">Differentials: &quot;</span>
</span><span id="L-1354"><a href="#L-1354"><span class="linenos">1354</span></a>                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">t</span><span class="p">:</span>
</span><span id="L-1355"><a href="#L-1355"><span class="linenos">1355</span></a>                    <span class="n">textstr</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">t</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
</span><span id="L-1356"><a href="#L-1356"><span class="linenos">1356</span></a>                <span class="c1"># these are matplotlib.patch.Patch properties</span>
</span><span id="L-1357"><a href="#L-1357"><span class="linenos">1357</span></a>                <span class="n">props</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">boxstyle</span><span class="o">=</span><span class="s1">&#39;round&#39;</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;wheat&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
</span><span id="L-1358"><a href="#L-1358"><span class="linenos">1358</span></a>                <span class="c1"># place a text box in upper left in axes coords, </span>
</span><span id="L-1359"><a href="#L-1359"><span class="linenos">1359</span></a>                <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">.05</span><span class="p">,</span> <span class="mf">.75</span><span class="p">,</span> <span class="n">textstr</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">,</span>
</span><span id="L-1360"><a href="#L-1360"><span class="linenos">1360</span></a>                            <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">bbox</span><span class="o">=</span><span class="n">props</span><span class="p">,</span> <span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;family&#39;</span><span class="p">:</span> <span class="s1">&#39;monospace&#39;</span><span class="p">},</span> <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">)</span>
</span><span id="L-1361"><a href="#L-1361"><span class="linenos">1361</span></a>                
</span><span id="L-1362"><a href="#L-1362"><span class="linenos">1362</span></a>                <span class="c1"># now, take the base_cost and the cost_values[i] and get the differential for each employee omitting </span>
</span><span id="L-1363"><a href="#L-1363"><span class="linenos">1363</span></a>                <span class="c1"># any employees that are zero cost in one, and not zero cost in the other</span>
</span><span id="L-1364"><a href="#L-1364"><span class="linenos">1364</span></a>                <span class="c1"># this will omit those employees who rotated to/from remote work status as a result of the move.</span>
</span><span id="L-1365"><a href="#L-1365"><span class="linenos">1365</span></a>                <span class="n">mask</span> <span class="o">=</span> <span class="p">(</span><span class="n">cost_values</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;cost&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">base_costs</span><span class="p">[</span><span class="s1">&#39;cost&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="L-1366"><a href="#L-1366"><span class="linenos">1366</span></a>                <span class="n">differences</span> <span class="o">=</span> <span class="p">(</span><span class="n">cost_values</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;cost&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">base_costs</span><span class="p">[</span><span class="s1">&#39;cost&#39;</span><span class="p">])[</span><span class="n">mask</span><span class="p">]</span>
</span><span id="L-1367"><a href="#L-1367"><span class="linenos">1367</span></a>                
</span><span id="L-1368"><a href="#L-1368"><span class="linenos">1368</span></a>                <span class="c1"># Convert differences to a list and store in diffs</span>
</span><span id="L-1369"><a href="#L-1369"><span class="linenos">1369</span></a>                <span class="n">diffs2</span> <span class="o">=</span> <span class="n">differences</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
</span><span id="L-1370"><a href="#L-1370"><span class="linenos">1370</span></a>
</span><span id="L-1371"><a href="#L-1371"><span class="linenos">1371</span></a>                <span class="c1"># get the differential</span>
</span><span id="L-1372"><a href="#L-1372"><span class="linenos">1372</span></a>                <span class="c1"># get the stats</span>
</span><span id="L-1373"><a href="#L-1373"><span class="linenos">1373</span></a>                <span class="n">median</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">diffs2</span><span class="p">)</span><span class="o">*</span><span class="n">commutes</span>
</span><span id="L-1374"><a href="#L-1374"><span class="linenos">1374</span></a>                <span class="n">average</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">diffs2</span><span class="p">)</span><span class="o">*</span><span class="n">commutes</span>
</span><span id="L-1375"><a href="#L-1375"><span class="linenos">1375</span></a>                <span class="n">minimum</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">diffs2</span><span class="p">)</span><span class="o">*</span><span class="n">commutes</span>
</span><span id="L-1376"><a href="#L-1376"><span class="linenos">1376</span></a>                <span class="n">maximum</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">diffs2</span><span class="p">)</span><span class="o">*</span><span class="n">commutes</span>
</span><span id="L-1377"><a href="#L-1377"><span class="linenos">1377</span></a>                <span class="n">total</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">diffs2</span><span class="p">)</span><span class="o">*</span><span class="n">commutes</span>
</span><span id="L-1378"><a href="#L-1378"><span class="linenos">1378</span></a>               
</span><span id="L-1379"><a href="#L-1379"><span class="linenos">1379</span></a>                <span class="c1"># add a text box with the stats, using two decimal places and adding commas at the thousands</span>
</span><span id="L-1380"><a href="#L-1380"><span class="linenos">1380</span></a>                <span class="n">t</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;me&#39;</span> <span class="p">:</span> <span class="s1">&#39;Median: |$</span><span class="si">{:,.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">median</span><span class="p">),</span>
</span><span id="L-1381"><a href="#L-1381"><span class="linenos">1381</span></a>                    <span class="s1">&#39;av&#39;</span> <span class="p">:</span> <span class="s1">&#39;Average: |$</span><span class="si">{:,.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">average</span><span class="p">),</span>
</span><span id="L-1382"><a href="#L-1382"><span class="linenos">1382</span></a>                    <span class="s1">&#39;mi&#39;</span> <span class="p">:</span> <span class="s1">&#39;Min: |$</span><span class="si">{:,.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">minimum</span><span class="p">),</span>
</span><span id="L-1383"><a href="#L-1383"><span class="linenos">1383</span></a>                    <span class="s1">&#39;ma&#39;</span> <span class="p">:</span> <span class="s1">&#39;Max: |$</span><span class="si">{:,.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">maximum</span><span class="p">),</span>
</span><span id="L-1384"><a href="#L-1384"><span class="linenos">1384</span></a>                    <span class="s1">&#39;to&#39;</span> <span class="p">:</span> <span class="s1">&#39;Total: |$</span><span class="si">{:,.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">total</span><span class="p">)</span>
</span><span id="L-1385"><a href="#L-1385"><span class="linenos">1385</span></a>                    <span class="p">}</span>
</span><span id="L-1386"><a href="#L-1386"><span class="linenos">1386</span></a>                
</span><span id="L-1387"><a href="#L-1387"><span class="linenos">1387</span></a>                <span class="c1"># get the longest string value</span>
</span><span id="L-1388"><a href="#L-1388"><span class="linenos">1388</span></a>                <span class="n">max_len</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="s1">&#39;me&#39;</span><span class="p">]),</span><span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="s1">&#39;av&#39;</span><span class="p">]),</span><span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="s1">&#39;to&#39;</span><span class="p">]),</span><span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="s1">&#39;mi&#39;</span><span class="p">]),</span><span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="s1">&#39;ma&#39;</span><span class="p">]))</span>
</span><span id="L-1389"><a href="#L-1389"><span class="linenos">1389</span></a>                <span class="c1"># calculate how many narrow numbers/letters exist in the string, we need to add additional space for each</span>
</span><span id="L-1390"><a href="#L-1390"><span class="linenos">1390</span></a>                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">t</span><span class="p">:</span>
</span><span id="L-1391"><a href="#L-1391"><span class="linenos">1391</span></a>                    <span class="n">t</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">t</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">,</span><span class="s2">&quot; &quot;</span><span class="o">*</span><span class="p">(</span><span class="n">max_len</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="n">k</span><span class="p">])))</span>
</span><span id="L-1392"><a href="#L-1392"><span class="linenos">1392</span></a>                <span class="c1"># add spaces to make all the same length, replacing |</span>
</span><span id="L-1393"><a href="#L-1393"><span class="linenos">1393</span></a>                <span class="n">textstr</span> <span class="o">=</span> <span class="s2">&quot;Annualized Differentials omitting </span><span class="se">\n</span><span class="s2"> Employees Rotating to/from Remote Work: &quot;</span>
</span><span id="L-1394"><a href="#L-1394"><span class="linenos">1394</span></a>                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">t</span><span class="p">:</span>
</span><span id="L-1395"><a href="#L-1395"><span class="linenos">1395</span></a>                    <span class="n">textstr</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">t</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
</span><span id="L-1396"><a href="#L-1396"><span class="linenos">1396</span></a>                <span class="c1"># place a text box in upper right in axes coords, </span>
</span><span id="L-1397"><a href="#L-1397"><span class="linenos">1397</span></a>                <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">.95</span><span class="p">,</span> <span class="mf">.75</span><span class="p">,</span> <span class="n">textstr</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">,</span>
</span><span id="L-1398"><a href="#L-1398"><span class="linenos">1398</span></a>                            <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">bbox</span><span class="o">=</span><span class="n">props</span><span class="p">,</span> <span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;family&#39;</span><span class="p">:</span> <span class="s1">&#39;monospace&#39;</span><span class="p">},</span> <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">)</span>
</span><span id="L-1399"><a href="#L-1399"><span class="linenos">1399</span></a>                
</span><span id="L-1400"><a href="#L-1400"><span class="linenos">1400</span></a>
</span><span id="L-1401"><a href="#L-1401"><span class="linenos">1401</span></a>                <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
</span><span id="L-1402"><a href="#L-1402"><span class="linenos">1402</span></a>
</span><span id="L-1403"><a href="#L-1403"><span class="linenos">1403</span></a>
</span><span id="L-1404"><a href="#L-1404"><span class="linenos">1404</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">(</span><span class="n">pad</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
</span><span id="L-1405"><a href="#L-1405"><span class="linenos">1405</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">plots_dir</span><span class="o">+</span><span class="s2">&quot;/&quot;</span><span class="o">+</span><span class="n">key</span><span class="o">+</span><span class="s2">&quot;.png&quot;</span><span class="p">)</span>
</span><span id="L-1406"><a href="#L-1406"><span class="linenos">1406</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="L-1407"><a href="#L-1407"><span class="linenos">1407</span></a>            
</span><span id="L-1408"><a href="#L-1408"><span class="linenos">1408</span></a>        
</span><span id="L-1409"><a href="#L-1409"><span class="linenos">1409</span></a>
</span><span id="L-1410"><a href="#L-1410"><span class="linenos">1410</span></a>        <span class="c1">################################################################################</span>
</span><span id="L-1411"><a href="#L-1411"><span class="linenos">1411</span></a>        <span class="c1">### GRAPH SET: Local Analysis for Office X</span>
</span><span id="L-1412"><a href="#L-1412"><span class="linenos">1412</span></a>        <span class="c1"># iterate through offices, generate a graph for each office</span>
</span><span id="L-1413"><a href="#L-1413"><span class="linenos">1413</span></a>        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">offices</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>  
</span><span id="L-1414"><a href="#L-1414"><span class="linenos">1414</span></a>        <span class="c1">################################################################################ </span>
</span><span id="L-1415"><a href="#L-1415"><span class="linenos">1415</span></a>            <span class="c1"># GRAPH: </span>
</span><span id="L-1416"><a href="#L-1416"><span class="linenos">1416</span></a>            <span class="c1">## Weekly Commute Duration Analysis</span>
</span><span id="L-1417"><a href="#L-1417"><span class="linenos">1417</span></a>            <span class="n">key</span> <span class="o">=</span> <span class="s1">&#39;wcda&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
</span><span id="L-1418"><a href="#L-1418"><span class="linenos">1418</span></a>            <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;Weekly Commute Duration Analysis &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;address&quot;</span><span class="p">])</span>
</span><span id="L-1419"><a href="#L-1419"><span class="linenos">1419</span></a>            <span class="n">short_title</span> <span class="o">=</span> <span class="n">title</span>
</span><span id="L-1420"><a href="#L-1420"><span class="linenos">1420</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">graph_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="p">{</span><span class="s2">&quot;GRAPH&quot;</span><span class="p">:</span> <span class="n">key</span><span class="p">,</span>
</span><span id="L-1421"><a href="#L-1421"><span class="linenos">1421</span></a>                                    <span class="s2">&quot;TITLE&quot;</span><span class="p">:</span> <span class="n">short_title</span><span class="p">,</span>
</span><span id="L-1422"><a href="#L-1422"><span class="linenos">1422</span></a>                                    <span class="s2">&quot;FILENAME&quot;</span><span class="p">:</span> <span class="n">key</span><span class="o">+</span><span class="s2">&quot;.png&quot;</span><span class="p">,</span>
</span><span id="L-1423"><a href="#L-1423"><span class="linenos">1423</span></a>                                    <span class="s2">&quot;PLOT-DESCRIPTION&quot;</span><span class="p">:</span>  <span class="s2">&quot;This graph displays the the morning and evening commute durations for employees within the &quot;</span> <span class="o">+</span> \
</span><span id="L-1424"><a href="#L-1424"><span class="linenos">1424</span></a>                                                        <span class="s2">&quot;cutoff distance of the current office.  The analysis is broken down by day of the week, &quot;</span> <span class="o">+</span> \
</span><span id="L-1425"><a href="#L-1425"><span class="linenos">1425</span></a>                                                        <span class="s2">&quot;and the distribution of commute times is shown for each day.  The commute times are based on &quot;</span> <span class="o">+</span> \
</span><span id="L-1426"><a href="#L-1426"><span class="linenos">1426</span></a>                                                        <span class="s2">&quot;the commute data derived based on traffic conditions, and are in minutes. The analysis is specific &quot;</span> <span class="o">+</span> \
</span><span id="L-1427"><a href="#L-1427"><span class="linenos">1427</span></a>                                                        <span class="s2">&quot;to the office at &quot;</span><span class="o">+</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;address&quot;</span><span class="p">]</span><span class="o">+</span><span class="s2">&quot;.&quot;</span>
</span><span id="L-1428"><a href="#L-1428"><span class="linenos">1428</span></a>                                    <span class="p">})</span>
</span><span id="L-1429"><a href="#L-1429"><span class="linenos">1429</span></a>            
</span><span id="L-1430"><a href="#L-1430"><span class="linenos">1430</span></a>            <span class="k">if</span> <span class="n">graph</span> <span class="o">==</span> <span class="s2">&quot;_all&quot;</span> <span class="ow">or</span> <span class="n">graph</span> <span class="o">==</span> <span class="n">key</span><span class="p">:</span>
</span><span id="L-1431"><a href="#L-1431"><span class="linenos">1431</span></a>                <span class="c1"># only calculate for the first office, the current office</span>
</span><span id="L-1432"><a href="#L-1432"><span class="linenos">1432</span></a>                <span class="c1">#office = offices.iloc[0].to_frame().T</span>
</span><span id="L-1433"><a href="#L-1433"><span class="linenos">1433</span></a>                <span class="n">office</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">to_frame</span><span class="p">()</span><span class="o">.</span><span class="n">T</span>
</span><span id="L-1434"><a href="#L-1434"><span class="linenos">1434</span></a>                <span class="n">values</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;m_morning_duration_in_traffic&#39;</span><span class="p">,</span><span class="s1">&#39;m_evening_duration_in_traffic&#39;</span><span class="p">,</span>
</span><span id="L-1435"><a href="#L-1435"><span class="linenos">1435</span></a>                        <span class="s1">&#39;t_morning_duration_in_traffic&#39;</span><span class="p">,</span><span class="s1">&#39;t_evening_duration_in_traffic&#39;</span><span class="p">,</span>
</span><span id="L-1436"><a href="#L-1436"><span class="linenos">1436</span></a>                        <span class="s1">&#39;w_morning_duration_in_traffic&#39;</span><span class="p">,</span><span class="s1">&#39;w_evening_duration_in_traffic&#39;</span><span class="p">,</span>
</span><span id="L-1437"><a href="#L-1437"><span class="linenos">1437</span></a>                        <span class="s1">&#39;h_morning_duration_in_traffic&#39;</span><span class="p">,</span><span class="s1">&#39;h_evening_duration_in_traffic&#39;</span><span class="p">,</span>
</span><span id="L-1438"><a href="#L-1438"><span class="linenos">1438</span></a>                        <span class="s1">&#39;f_morning_duration_in_traffic&#39;</span><span class="p">,</span><span class="s1">&#39;f_evening_duration_in_traffic&#39;</span><span class="p">]</span>
</span><span id="L-1439"><a href="#L-1439"><span class="linenos">1439</span></a>                <span class="n">cumulative_markers</span> <span class="o">=</span> <span class="p">{</span><span class="mi">50</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;purple&#39;</span><span class="p">,</span> <span class="s1">&#39;marker&#39;</span><span class="p">:</span> <span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="s1">&#39;50%&#39;</span><span class="p">,</span> <span class="s1">&#39;linestyle&#39;</span><span class="p">:</span> <span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="s1">&#39;linewidth&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">},</span>
</span><span id="L-1440"><a href="#L-1440"><span class="linenos">1440</span></a>                                    <span class="mi">75</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="s1">&#39;marker&#39;</span><span class="p">:</span> <span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="s1">&#39;75%&#39;</span><span class="p">,</span> <span class="s1">&#39;linestyle&#39;</span><span class="p">:</span> <span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="s1">&#39;linewidth&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">},}</span>
</span><span id="L-1441"><a href="#L-1441"><span class="linenos">1441</span></a>                <span class="c1"># calculate teh bins based on the max value of the data</span>
</span><span id="L-1442"><a href="#L-1442"><span class="linenos">1442</span></a>                <span class="n">binmax</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-1443"><a href="#L-1443"><span class="linenos">1443</span></a>                <span class="n">emp_within</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graphing</span><span class="o">.</span><span class="n">filter_drive_distance</span><span class="p">(</span><span class="n">emp</span><span class="p">,</span><span class="n">office</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">commute_range_cut_off</span><span class="p">,</span> <span class="n">commute_data</span><span class="o">=</span><span class="n">commute_data</span><span class="p">)</span>
</span><span id="L-1444"><a href="#L-1444"><span class="linenos">1444</span></a>                <span class="n">val_set</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graphing</span><span class="o">.</span><span class="n">get_commute_values</span><span class="p">(</span><span class="n">emp_within</span><span class="p">,</span> <span class="n">office</span><span class="p">,</span> <span class="n">commute_data</span><span class="p">,</span> <span class="n">values</span><span class="p">)</span>
</span><span id="L-1445"><a href="#L-1445"><span class="linenos">1445</span></a>                <span class="c1"># get max value of val_set</span>
</span><span id="L-1446"><a href="#L-1446"><span class="linenos">1446</span></a>                <span class="c1"># val_set is a DataFrame containing the extracted values for each employee location that matches the given office location. The DataFrame includes &#39;latitude&#39; and &#39;longitude&#39; of the employee locations and the specified `values`.</span>
</span><span id="L-1447"><a href="#L-1447"><span class="linenos">1447</span></a>                <span class="k">for</span> <span class="n">each</span> <span class="ow">in</span> <span class="n">values</span><span class="p">:</span>
</span><span id="L-1448"><a href="#L-1448"><span class="linenos">1448</span></a>                    <span class="k">if</span> <span class="nb">max</span><span class="p">(</span><span class="n">val_set</span><span class="p">[</span><span class="n">each</span><span class="p">])</span> <span class="o">&gt;</span> <span class="n">binmax</span><span class="p">:</span>
</span><span id="L-1449"><a href="#L-1449"><span class="linenos">1449</span></a>                        <span class="n">binmax</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">val_set</span><span class="p">[</span><span class="n">each</span><span class="p">])</span>            
</span><span id="L-1450"><a href="#L-1450"><span class="linenos">1450</span></a>                <span class="n">step</span> <span class="o">=</span> <span class="mi">5</span>
</span><span id="L-1451"><a href="#L-1451"><span class="linenos">1451</span></a>                <span class="c1"># round the binmax up to the nearest step</span>
</span><span id="L-1452"><a href="#L-1452"><span class="linenos">1452</span></a>                <span class="n">bins</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">binmax</span> <span class="o">+</span> <span class="n">step</span> <span class="o">-</span> <span class="p">(</span><span class="n">binmax</span> <span class="o">%</span> <span class="n">step</span><span class="p">)),</span> <span class="n">step</span><span class="p">)</span>
</span><span id="L-1453"><a href="#L-1453"><span class="linenos">1453</span></a>                <span class="n">plt</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graphing</span><span class="o">.</span><span class="n">get_histogram</span><span class="p">(</span><span class="n">emp</span><span class="p">,</span> <span class="n">office</span><span class="p">,</span> <span class="n">commute_data</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span> <span class="n">suptitle</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;address&#39;</span><span class="p">])</span><span class="o">+</span><span class="s2">&quot; Commute Analysis&quot;</span><span class="p">,</span> <span class="n">x_label</span><span class="o">=</span><span class="s1">&#39;Minutes in Traffic&#39;</span><span class="p">,</span> <span class="n">y_label</span><span class="o">=</span><span class="s1">&#39;# Employees&#39;</span><span class="p">,</span>  
</span><span id="L-1454"><a href="#L-1454"><span class="linenos">1454</span></a>                            <span class="n">commute_radius</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">commute_range_cut_off</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="n">bins</span><span class="p">,</span> <span class="n">rows</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">cols</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">column_titles</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Morning Commute&#39;</span><span class="p">,</span><span class="s1">&#39;Evening Commute&#39;</span><span class="p">],</span> <span class="n">cumulative_line</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="L-1455"><a href="#L-1455"><span class="linenos">1455</span></a>                            <span class="n">cumulative_color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">cumulative_linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">cumulative_linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">cumulative_markers</span><span class="o">=</span><span class="n">cumulative_markers</span><span class="p">,</span> <span class="n">font_mod</span><span class="o">=</span><span class="mf">1.5</span><span class="p">)</span>
</span><span id="L-1456"><a href="#L-1456"><span class="linenos">1456</span></a>                
</span><span id="L-1457"><a href="#L-1457"><span class="linenos">1457</span></a>                <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;center right&#39;</span><span class="p">)</span>
</span><span id="L-1458"><a href="#L-1458"><span class="linenos">1458</span></a>                <span class="k">for</span> <span class="n">each</span> <span class="ow">in</span> <span class="n">plt</span><span class="o">.</span><span class="n">gcf</span><span class="p">()</span><span class="o">.</span><span class="n">get_axes</span><span class="p">():</span>
</span><span id="L-1459"><a href="#L-1459"><span class="linenos">1459</span></a>                    <span class="c1"># Add monday through Friday labels on first column only</span>
</span><span id="L-1460"><a href="#L-1460"><span class="linenos">1460</span></a>                    <span class="k">if</span> <span class="n">each</span><span class="o">.</span><span class="n">get_subplotspec</span><span class="p">()</span><span class="o">.</span><span class="n">colspan</span><span class="o">.</span><span class="n">start</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-1461"><a href="#L-1461"><span class="linenos">1461</span></a>                        <span class="c1"># first row is monday, second is tuesday, etc</span>
</span><span id="L-1462"><a href="#L-1462"><span class="linenos">1462</span></a>                        <span class="n">row</span> <span class="o">=</span> <span class="n">each</span><span class="o">.</span><span class="n">get_subplotspec</span><span class="p">()</span><span class="o">.</span><span class="n">rowspan</span><span class="o">.</span><span class="n">start</span>
</span><span id="L-1463"><a href="#L-1463"><span class="linenos">1463</span></a>                        <span class="k">if</span> <span class="n">row</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-1464"><a href="#L-1464"><span class="linenos">1464</span></a>                            <span class="n">each</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.02</span><span class="p">,</span> <span class="mf">0.85</span><span class="p">,</span> <span class="s1">&#39;Monday&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">each</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;top&#39;</span><span class="p">)</span>
</span><span id="L-1465"><a href="#L-1465"><span class="linenos">1465</span></a>                        <span class="k">elif</span> <span class="n">row</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="L-1466"><a href="#L-1466"><span class="linenos">1466</span></a>                            <span class="n">each</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.02</span><span class="p">,</span> <span class="mf">0.85</span><span class="p">,</span> <span class="s1">&#39;Tuesday&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">each</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;top&#39;</span><span class="p">)</span>
</span><span id="L-1467"><a href="#L-1467"><span class="linenos">1467</span></a>                        <span class="k">elif</span> <span class="n">row</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
</span><span id="L-1468"><a href="#L-1468"><span class="linenos">1468</span></a>                            <span class="n">each</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.02</span><span class="p">,</span> <span class="mf">0.85</span><span class="p">,</span> <span class="s1">&#39;Wednesday&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">each</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;top&#39;</span><span class="p">)</span>
</span><span id="L-1469"><a href="#L-1469"><span class="linenos">1469</span></a>                        <span class="k">elif</span> <span class="n">row</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
</span><span id="L-1470"><a href="#L-1470"><span class="linenos">1470</span></a>                            <span class="n">each</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.02</span><span class="p">,</span> <span class="mf">0.85</span><span class="p">,</span> <span class="s1">&#39;Thursday&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">each</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;top&#39;</span><span class="p">)</span>
</span><span id="L-1471"><a href="#L-1471"><span class="linenos">1471</span></a>                        <span class="k">elif</span> <span class="n">row</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
</span><span id="L-1472"><a href="#L-1472"><span class="linenos">1472</span></a>                            <span class="n">each</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.02</span><span class="p">,</span> <span class="mf">0.85</span><span class="p">,</span> <span class="s1">&#39;Friday&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">each</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;top&#39;</span><span class="p">)</span>
</span><span id="L-1473"><a href="#L-1473"><span class="linenos">1473</span></a>                            
</span><span id="L-1474"><a href="#L-1474"><span class="linenos">1474</span></a>                <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">(</span><span class="n">pad</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
</span><span id="L-1475"><a href="#L-1475"><span class="linenos">1475</span></a>                <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">plots_dir</span><span class="o">+</span><span class="s2">&quot;/&quot;</span><span class="o">+</span><span class="n">key</span><span class="o">+</span><span class="s2">&quot;.png&quot;</span><span class="p">)</span>
</span><span id="L-1476"><a href="#L-1476"><span class="linenos">1476</span></a>                <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="L-1477"><a href="#L-1477"><span class="linenos">1477</span></a>
</span><span id="L-1478"><a href="#L-1478"><span class="linenos">1478</span></a>
</span><span id="L-1479"><a href="#L-1479"><span class="linenos">1479</span></a>        <span class="c1">################################################################################</span>
</span><span id="L-1480"><a href="#L-1480"><span class="linenos">1480</span></a>        <span class="c1">### GRAPH SET: Local Analysis for Office X</span>
</span><span id="L-1481"><a href="#L-1481"><span class="linenos">1481</span></a>        <span class="c1"># iterate through offices, generate a graph for each office</span>
</span><span id="L-1482"><a href="#L-1482"><span class="linenos">1482</span></a>        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">offices</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>            
</span><span id="L-1483"><a href="#L-1483"><span class="linenos">1483</span></a>            <span class="c1"># GRAPH: </span>
</span><span id="L-1484"><a href="#L-1484"><span class="linenos">1484</span></a>            <span class="c1">## Normalized Weekly Commute Duration Analysis</span>
</span><span id="L-1485"><a href="#L-1485"><span class="linenos">1485</span></a>            <span class="n">key</span> <span class="o">=</span> <span class="s1">&#39;nwcda&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
</span><span id="L-1486"><a href="#L-1486"><span class="linenos">1486</span></a>            <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;Normalized Weekly Commute Duration Analysis &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;address&quot;</span><span class="p">])</span>
</span><span id="L-1487"><a href="#L-1487"><span class="linenos">1487</span></a>            <span class="n">short_title</span> <span class="o">=</span> <span class="n">title</span>
</span><span id="L-1488"><a href="#L-1488"><span class="linenos">1488</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">graph_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="p">{</span><span class="s2">&quot;GRAPH&quot;</span><span class="p">:</span> <span class="n">key</span><span class="p">,</span>
</span><span id="L-1489"><a href="#L-1489"><span class="linenos">1489</span></a>                                    <span class="s2">&quot;TITLE&quot;</span><span class="p">:</span> <span class="n">short_title</span><span class="p">,</span>
</span><span id="L-1490"><a href="#L-1490"><span class="linenos">1490</span></a>                                    <span class="s2">&quot;FILENAME&quot;</span><span class="p">:</span> <span class="n">key</span><span class="o">+</span><span class="s2">&quot;.png&quot;</span><span class="p">,</span>
</span><span id="L-1491"><a href="#L-1491"><span class="linenos">1491</span></a>                                    <span class="s2">&quot;PLOT-DESCRIPTION&quot;</span><span class="p">:</span>  <span class="s2">&quot;This graph displays the the morning and evening commute durations for employees within the &quot;</span> <span class="o">+</span> \
</span><span id="L-1492"><a href="#L-1492"><span class="linenos">1492</span></a>                                                        <span class="s2">&quot;cutoff distance of the current office, normalized to reflect the duration in traffic as a percentage &quot;</span> <span class="o">+</span> \
</span><span id="L-1493"><a href="#L-1493"><span class="linenos">1493</span></a>                                                        <span class="s2">&quot; of the duration without traffic.  The analysis is broken down by day of the week, &quot;</span> <span class="o">+</span> \
</span><span id="L-1494"><a href="#L-1494"><span class="linenos">1494</span></a>                                                        <span class="s2">&quot;and the distribution of commute times is shown for each day.  The commute times are based on &quot;</span> <span class="o">+</span> \
</span><span id="L-1495"><a href="#L-1495"><span class="linenos">1495</span></a>                                                        <span class="s2">&quot;the commute data derived based on traffic conditions, and are in minutes. The analysis is specific &quot;</span> <span class="o">+</span> \
</span><span id="L-1496"><a href="#L-1496"><span class="linenos">1496</span></a>                                                        <span class="s2">&quot;to the office at &quot;</span><span class="o">+</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;address&quot;</span><span class="p">]</span><span class="o">+</span><span class="s2">&quot;.&quot;</span>
</span><span id="L-1497"><a href="#L-1497"><span class="linenos">1497</span></a>                                    <span class="p">})</span>
</span><span id="L-1498"><a href="#L-1498"><span class="linenos">1498</span></a>            
</span><span id="L-1499"><a href="#L-1499"><span class="linenos">1499</span></a>            <span class="k">if</span> <span class="n">graph</span> <span class="o">==</span> <span class="s2">&quot;_all&quot;</span> <span class="ow">or</span> <span class="n">graph</span> <span class="o">==</span> <span class="n">key</span><span class="p">:</span>
</span><span id="L-1500"><a href="#L-1500"><span class="linenos">1500</span></a>                <span class="c1"># only calculate for the first office, the current office</span>
</span><span id="L-1501"><a href="#L-1501"><span class="linenos">1501</span></a>                <span class="c1">#office = offices.iloc[0].to_frame().T</span>
</span><span id="L-1502"><a href="#L-1502"><span class="linenos">1502</span></a>                <span class="n">office</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">to_frame</span><span class="p">()</span><span class="o">.</span><span class="n">T</span>
</span><span id="L-1503"><a href="#L-1503"><span class="linenos">1503</span></a>                <span class="n">values</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;m_morning_duration_in_traffic&#39;</span><span class="p">,</span><span class="s1">&#39;m_evening_duration_in_traffic&#39;</span><span class="p">,</span>
</span><span id="L-1504"><a href="#L-1504"><span class="linenos">1504</span></a>                        <span class="s1">&#39;t_morning_duration_in_traffic&#39;</span><span class="p">,</span><span class="s1">&#39;t_evening_duration_in_traffic&#39;</span><span class="p">,</span>
</span><span id="L-1505"><a href="#L-1505"><span class="linenos">1505</span></a>                        <span class="s1">&#39;w_morning_duration_in_traffic&#39;</span><span class="p">,</span><span class="s1">&#39;w_evening_duration_in_traffic&#39;</span><span class="p">,</span>
</span><span id="L-1506"><a href="#L-1506"><span class="linenos">1506</span></a>                        <span class="s1">&#39;h_morning_duration_in_traffic&#39;</span><span class="p">,</span><span class="s1">&#39;h_evening_duration_in_traffic&#39;</span><span class="p">,</span>
</span><span id="L-1507"><a href="#L-1507"><span class="linenos">1507</span></a>                        <span class="s1">&#39;f_morning_duration_in_traffic&#39;</span><span class="p">,</span><span class="s1">&#39;f_evening_duration_in_traffic&#39;</span><span class="p">]</span>
</span><span id="L-1508"><a href="#L-1508"><span class="linenos">1508</span></a>                <span class="n">cumulative_markers</span> <span class="o">=</span> <span class="p">{</span><span class="mi">50</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;purple&#39;</span><span class="p">,</span> <span class="s1">&#39;marker&#39;</span><span class="p">:</span> <span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="s1">&#39;Median (min)&#39;</span><span class="p">,</span> <span class="s1">&#39;linestyle&#39;</span><span class="p">:</span> <span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="s1">&#39;linewidth&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">}}</span>
</span><span id="L-1509"><a href="#L-1509"><span class="linenos">1509</span></a>                
</span><span id="L-1510"><a href="#L-1510"><span class="linenos">1510</span></a>                <span class="n">emp_within</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graphing</span><span class="o">.</span><span class="n">filter_drive_distance</span><span class="p">(</span><span class="n">emp</span><span class="p">,</span><span class="n">office</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">commute_range_cut_off</span><span class="p">,</span> <span class="n">commute_data</span><span class="o">=</span><span class="n">commute_data</span><span class="p">)</span>
</span><span id="L-1511"><a href="#L-1511"><span class="linenos">1511</span></a>                <span class="n">val_set</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graphing</span><span class="o">.</span><span class="n">get_commute_values</span><span class="p">(</span><span class="n">emp_within</span><span class="p">,</span> <span class="n">office</span><span class="p">,</span> <span class="n">commute_data</span><span class="p">,</span> <span class="n">values</span><span class="p">)</span>
</span><span id="L-1512"><a href="#L-1512"><span class="linenos">1512</span></a>                <span class="n">val_set_free</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graphing</span><span class="o">.</span><span class="n">get_commute_values</span><span class="p">(</span><span class="n">emp_within</span><span class="p">,</span> <span class="n">office</span><span class="p">,</span> <span class="n">commute_data</span><span class="p">,</span> <span class="s2">&quot;duration&quot;</span><span class="p">)</span>
</span><span id="L-1513"><a href="#L-1513"><span class="linenos">1513</span></a>                <span class="c1"># Normalize the values in val_set by dividing by the corresponding values in val_set_free, and multiplying by 100</span>
</span><span id="L-1514"><a href="#L-1514"><span class="linenos">1514</span></a>                <span class="k">for</span> <span class="n">each</span> <span class="ow">in</span> <span class="n">values</span><span class="p">:</span>
</span><span id="L-1515"><a href="#L-1515"><span class="linenos">1515</span></a>                    <span class="n">val_set</span><span class="p">[</span><span class="n">each</span><span class="p">]</span> <span class="o">=</span> <span class="n">val_set</span><span class="p">[</span><span class="n">each</span><span class="p">]</span> <span class="o">/</span> <span class="n">val_set_free</span><span class="p">[</span><span class="s1">&#39;duration&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">100</span>
</span><span id="L-1516"><a href="#L-1516"><span class="linenos">1516</span></a>                
</span><span id="L-1517"><a href="#L-1517"><span class="linenos">1517</span></a>                <span class="c1"># calculate teh bins based on the max value of the data</span>
</span><span id="L-1518"><a href="#L-1518"><span class="linenos">1518</span></a>                <span class="n">binmax</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-1519"><a href="#L-1519"><span class="linenos">1519</span></a>                <span class="n">binmin</span> <span class="o">=</span> <span class="mi">100</span>
</span><span id="L-1520"><a href="#L-1520"><span class="linenos">1520</span></a>                <span class="k">for</span> <span class="n">each</span> <span class="ow">in</span> <span class="n">values</span><span class="p">:</span>
</span><span id="L-1521"><a href="#L-1521"><span class="linenos">1521</span></a>                    <span class="k">if</span> <span class="nb">max</span><span class="p">(</span><span class="n">val_set</span><span class="p">[</span><span class="n">each</span><span class="p">])</span> <span class="o">&gt;</span> <span class="n">binmax</span><span class="p">:</span>
</span><span id="L-1522"><a href="#L-1522"><span class="linenos">1522</span></a>                        <span class="n">binmax</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">val_set</span><span class="p">[</span><span class="n">each</span><span class="p">])</span>
</span><span id="L-1523"><a href="#L-1523"><span class="linenos">1523</span></a>                    <span class="k">if</span> <span class="nb">min</span><span class="p">(</span><span class="n">val_set</span><span class="p">[</span><span class="n">each</span><span class="p">])</span> <span class="o">&lt;</span> <span class="n">binmin</span><span class="p">:</span>
</span><span id="L-1524"><a href="#L-1524"><span class="linenos">1524</span></a>                        <span class="n">binmin</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">val_set</span><span class="p">[</span><span class="n">each</span><span class="p">])</span>            
</span><span id="L-1525"><a href="#L-1525"><span class="linenos">1525</span></a>                <span class="n">step</span> <span class="o">=</span> <span class="mi">5</span>
</span><span id="L-1526"><a href="#L-1526"><span class="linenos">1526</span></a>                <span class="c1"># round the binmax up to the nearest step, and binmin down to the nearest step</span>
</span><span id="L-1527"><a href="#L-1527"><span class="linenos">1527</span></a>                <span class="n">bins</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">binmin</span> <span class="o">-</span> <span class="p">(</span><span class="n">binmin</span> <span class="o">%</span> <span class="n">step</span><span class="p">)),</span> <span class="nb">int</span><span class="p">(</span><span class="n">binmax</span> <span class="o">+</span> <span class="n">step</span> <span class="o">-</span> <span class="p">(</span><span class="n">binmax</span> <span class="o">%</span> <span class="n">step</span><span class="p">)),</span> <span class="n">step</span><span class="p">)</span>
</span><span id="L-1528"><a href="#L-1528"><span class="linenos">1528</span></a>                
</span><span id="L-1529"><a href="#L-1529"><span class="linenos">1529</span></a>                <span class="n">plt</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graphing</span><span class="o">.</span><span class="n">get_histogram</span><span class="p">(</span><span class="n">emp</span><span class="p">,</span> <span class="n">office</span><span class="p">,</span> <span class="n">commute_data</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span> <span class="n">suptitle</span><span class="o">=</span><span class="s2">&quot;Normalized &#39;In Traffic&#39; Commute Analysis, </span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;address&#39;</span><span class="p">]),</span> 
</span><span id="L-1530"><a href="#L-1530"><span class="linenos">1530</span></a>                                                      <span class="n">x_label</span><span class="o">=</span><span class="s1">&#39;Normalized (In-Traffic / Traffic-Free) </span><span class="se">\n</span><span class="s1"> Commute Duration (%)&#39;</span><span class="p">,</span> <span class="n">y_label</span><span class="o">=</span><span class="s1">&#39;# Employees&#39;</span><span class="p">,</span>  
</span><span id="L-1531"><a href="#L-1531"><span class="linenos">1531</span></a>                            <span class="n">commute_radius</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">commute_range_cut_off</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="n">bins</span><span class="p">,</span> <span class="n">rows</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">cols</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">column_titles</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Morning Commute&#39;</span><span class="p">,</span><span class="s1">&#39;Evening Commute&#39;</span><span class="p">],</span> <span class="n">cumulative_line</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="L-1532"><a href="#L-1532"><span class="linenos">1532</span></a>                            <span class="n">cumulative_color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">cumulative_linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">cumulative_linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">cumulative_markers</span><span class="o">=</span><span class="n">cumulative_markers</span><span class="p">,</span> 
</span><span id="L-1533"><a href="#L-1533"><span class="linenos">1533</span></a>                            <span class="n">override_values</span><span class="o">=</span><span class="n">val_set</span><span class="p">,</span> <span class="n">font_mod</span><span class="o">=</span><span class="mf">1.5</span><span class="p">)</span>
</span><span id="L-1534"><a href="#L-1534"><span class="linenos">1534</span></a>                
</span><span id="L-1535"><a href="#L-1535"><span class="linenos">1535</span></a>                
</span><span id="L-1536"><a href="#L-1536"><span class="linenos">1536</span></a>                <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;center right&#39;</span><span class="p">)</span>
</span><span id="L-1537"><a href="#L-1537"><span class="linenos">1537</span></a>                <span class="k">for</span> <span class="n">each</span> <span class="ow">in</span> <span class="n">plt</span><span class="o">.</span><span class="n">gcf</span><span class="p">()</span><span class="o">.</span><span class="n">get_axes</span><span class="p">():</span>
</span><span id="L-1538"><a href="#L-1538"><span class="linenos">1538</span></a>                    <span class="c1"># Add monday through Friday labels on first column only</span>
</span><span id="L-1539"><a href="#L-1539"><span class="linenos">1539</span></a>                    <span class="k">if</span> <span class="n">each</span><span class="o">.</span><span class="n">get_subplotspec</span><span class="p">()</span><span class="o">.</span><span class="n">colspan</span><span class="o">.</span><span class="n">start</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-1540"><a href="#L-1540"><span class="linenos">1540</span></a>                        <span class="c1"># first row is monday, second is tuesday, etc</span>
</span><span id="L-1541"><a href="#L-1541"><span class="linenos">1541</span></a>                        <span class="n">row</span> <span class="o">=</span> <span class="n">each</span><span class="o">.</span><span class="n">get_subplotspec</span><span class="p">()</span><span class="o">.</span><span class="n">rowspan</span><span class="o">.</span><span class="n">start</span>
</span><span id="L-1542"><a href="#L-1542"><span class="linenos">1542</span></a>                        <span class="k">if</span> <span class="n">row</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-1543"><a href="#L-1543"><span class="linenos">1543</span></a>                            <span class="n">each</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.02</span><span class="p">,</span> <span class="mf">0.85</span><span class="p">,</span> <span class="s1">&#39;Monday&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">each</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;top&#39;</span><span class="p">)</span>
</span><span id="L-1544"><a href="#L-1544"><span class="linenos">1544</span></a>                        <span class="k">elif</span> <span class="n">row</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="L-1545"><a href="#L-1545"><span class="linenos">1545</span></a>                            <span class="n">each</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.02</span><span class="p">,</span> <span class="mf">0.85</span><span class="p">,</span> <span class="s1">&#39;Tuesday&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">each</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;top&#39;</span><span class="p">)</span>
</span><span id="L-1546"><a href="#L-1546"><span class="linenos">1546</span></a>                        <span class="k">elif</span> <span class="n">row</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
</span><span id="L-1547"><a href="#L-1547"><span class="linenos">1547</span></a>                            <span class="n">each</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.02</span><span class="p">,</span> <span class="mf">0.85</span><span class="p">,</span> <span class="s1">&#39;Wednesday&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">each</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;top&#39;</span><span class="p">)</span>
</span><span id="L-1548"><a href="#L-1548"><span class="linenos">1548</span></a>                        <span class="k">elif</span> <span class="n">row</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
</span><span id="L-1549"><a href="#L-1549"><span class="linenos">1549</span></a>                            <span class="n">each</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.02</span><span class="p">,</span> <span class="mf">0.85</span><span class="p">,</span> <span class="s1">&#39;Thursday&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">each</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;top&#39;</span><span class="p">)</span>
</span><span id="L-1550"><a href="#L-1550"><span class="linenos">1550</span></a>                        <span class="k">elif</span> <span class="n">row</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
</span><span id="L-1551"><a href="#L-1551"><span class="linenos">1551</span></a>                            <span class="n">each</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.02</span><span class="p">,</span> <span class="mf">0.85</span><span class="p">,</span> <span class="s1">&#39;Friday&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">each</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;top&#39;</span><span class="p">)</span>
</span><span id="L-1552"><a href="#L-1552"><span class="linenos">1552</span></a>                            
</span><span id="L-1553"><a href="#L-1553"><span class="linenos">1553</span></a>                <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">(</span><span class="n">pad</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
</span><span id="L-1554"><a href="#L-1554"><span class="linenos">1554</span></a>                <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">plots_dir</span><span class="o">+</span><span class="s2">&quot;/&quot;</span><span class="o">+</span><span class="n">key</span><span class="o">+</span><span class="s2">&quot;.png&quot;</span><span class="p">)</span>
</span><span id="L-1555"><a href="#L-1555"><span class="linenos">1555</span></a>                <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="L-1556"><a href="#L-1556"><span class="linenos">1556</span></a>
</span><span id="L-1557"><a href="#L-1557"><span class="linenos">1557</span></a>
</span><span id="L-1558"><a href="#L-1558"><span class="linenos">1558</span></a>
</span><span id="L-1559"><a href="#L-1559"><span class="linenos">1559</span></a>        <span class="c1">############################################################################################################</span>
</span><span id="L-1560"><a href="#L-1560"><span class="linenos">1560</span></a>        <span class="c1"># GRAPH:</span>
</span><span id="L-1561"><a href="#L-1561"><span class="linenos">1561</span></a>        <span class="c1">## Normalized Commute Distribution Analysis</span>
</span><span id="L-1562"><a href="#L-1562"><span class="linenos">1562</span></a>        <span class="n">key</span> <span class="o">=</span> <span class="s1">&#39;ncda&#39;</span>
</span><span id="L-1563"><a href="#L-1563"><span class="linenos">1563</span></a>        <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;Normalized Commute Distribution Analysis&quot;</span>
</span><span id="L-1564"><a href="#L-1564"><span class="linenos">1564</span></a>        <span class="n">short_title</span> <span class="o">=</span> <span class="n">title</span>
</span><span id="L-1565"><a href="#L-1565"><span class="linenos">1565</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">graph_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="p">{</span><span class="s2">&quot;GRAPH&quot;</span><span class="p">:</span> <span class="n">key</span><span class="p">,</span>
</span><span id="L-1566"><a href="#L-1566"><span class="linenos">1566</span></a>                                <span class="s2">&quot;TITLE&quot;</span><span class="p">:</span> <span class="n">short_title</span><span class="p">,</span>
</span><span id="L-1567"><a href="#L-1567"><span class="linenos">1567</span></a>                                <span class="s2">&quot;FILENAME&quot;</span><span class="p">:</span> <span class="n">key</span><span class="o">+</span><span class="s2">&quot;.png&quot;</span><span class="p">,</span>
</span><span id="L-1568"><a href="#L-1568"><span class="linenos">1568</span></a>                                <span class="s2">&quot;PLOT-DESCRIPTION&quot;</span><span class="p">:</span>  <span class="s2">&quot;This graph plots the the normalized commute durations against the distance of the commute. &quot;</span> <span class="o">+</span> \
</span><span id="L-1569"><a href="#L-1569"><span class="linenos">1569</span></a>                                                    <span class="s2">&quot;The objective is to affirm that the tails of the distribution are driven by shorter distance commutes &quot;</span> <span class="o">+</span> \
</span><span id="L-1570"><a href="#L-1570"><span class="linenos">1570</span></a>                                                    <span class="s2">&quot;and therefore present minimal risk of skewing the analysis when an average across days/employees is taken.&quot;</span>
</span><span id="L-1571"><a href="#L-1571"><span class="linenos">1571</span></a>                                <span class="p">})</span>
</span><span id="L-1572"><a href="#L-1572"><span class="linenos">1572</span></a>        
</span><span id="L-1573"><a href="#L-1573"><span class="linenos">1573</span></a>        <span class="k">if</span> <span class="n">graph</span> <span class="o">==</span> <span class="s2">&quot;_all&quot;</span> <span class="ow">or</span> <span class="n">graph</span> <span class="o">==</span> <span class="n">key</span><span class="p">:</span>
</span><span id="L-1574"><a href="#L-1574"><span class="linenos">1574</span></a>            <span class="n">office</span> <span class="o">=</span> <span class="n">offices</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">to_frame</span><span class="p">()</span><span class="o">.</span><span class="n">T</span>
</span><span id="L-1575"><a href="#L-1575"><span class="linenos">1575</span></a>            <span class="n">values</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;m_morning_duration_in_traffic&#39;</span><span class="p">,</span><span class="s1">&#39;m_evening_duration_in_traffic&#39;</span><span class="p">,</span>
</span><span id="L-1576"><a href="#L-1576"><span class="linenos">1576</span></a>                    <span class="s1">&#39;t_morning_duration_in_traffic&#39;</span><span class="p">,</span><span class="s1">&#39;t_evening_duration_in_traffic&#39;</span><span class="p">,</span>
</span><span id="L-1577"><a href="#L-1577"><span class="linenos">1577</span></a>                    <span class="s1">&#39;w_morning_duration_in_traffic&#39;</span><span class="p">,</span><span class="s1">&#39;w_evening_duration_in_traffic&#39;</span><span class="p">,</span>
</span><span id="L-1578"><a href="#L-1578"><span class="linenos">1578</span></a>                    <span class="s1">&#39;h_morning_duration_in_traffic&#39;</span><span class="p">,</span><span class="s1">&#39;h_evening_duration_in_traffic&#39;</span><span class="p">,</span>
</span><span id="L-1579"><a href="#L-1579"><span class="linenos">1579</span></a>                    <span class="s1">&#39;f_morning_duration_in_traffic&#39;</span><span class="p">,</span><span class="s1">&#39;f_evening_duration_in_traffic&#39;</span><span class="p">]</span>
</span><span id="L-1580"><a href="#L-1580"><span class="linenos">1580</span></a>            <span class="n">data_labels</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Monday Morning&#39;</span><span class="p">,</span><span class="s1">&#39;Monday Evening&#39;</span><span class="p">,</span>
</span><span id="L-1581"><a href="#L-1581"><span class="linenos">1581</span></a>                    <span class="s1">&#39;Tuesday Morning&#39;</span><span class="p">,</span><span class="s1">&#39;Tuesday Evening&#39;</span><span class="p">,</span>
</span><span id="L-1582"><a href="#L-1582"><span class="linenos">1582</span></a>                    <span class="s1">&#39;Wednesday Morning&#39;</span><span class="p">,</span><span class="s1">&#39;Wednesday Evening&#39;</span><span class="p">,</span>
</span><span id="L-1583"><a href="#L-1583"><span class="linenos">1583</span></a>                    <span class="s1">&#39;Thursday Morning&#39;</span><span class="p">,</span><span class="s1">&#39;Thursday Evening&#39;</span><span class="p">,</span>
</span><span id="L-1584"><a href="#L-1584"><span class="linenos">1584</span></a>                    <span class="s1">&#39;Friday Morning&#39;</span><span class="p">,</span><span class="s1">&#39;Friday Evening&#39;</span><span class="p">]</span>
</span><span id="L-1585"><a href="#L-1585"><span class="linenos">1585</span></a>            <span class="n">emp_within</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graphing</span><span class="o">.</span><span class="n">filter_drive_distance</span><span class="p">(</span><span class="n">emp</span><span class="p">,</span><span class="n">office</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">commute_range_cut_off</span><span class="p">,</span> <span class="n">commute_data</span><span class="o">=</span><span class="n">commute_data</span><span class="p">)</span>
</span><span id="L-1586"><a href="#L-1586"><span class="linenos">1586</span></a>            <span class="n">val_set</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graphing</span><span class="o">.</span><span class="n">get_commute_values</span><span class="p">(</span><span class="n">emp_within</span><span class="p">,</span> <span class="n">office</span><span class="p">,</span> <span class="n">commute_data</span><span class="p">,</span> <span class="n">values</span><span class="p">)</span>
</span><span id="L-1587"><a href="#L-1587"><span class="linenos">1587</span></a>            <span class="n">val_set_free</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graphing</span><span class="o">.</span><span class="n">get_commute_values</span><span class="p">(</span><span class="n">emp_within</span><span class="p">,</span> <span class="n">office</span><span class="p">,</span> <span class="n">commute_data</span><span class="p">,</span> <span class="s2">&quot;duration&quot;</span><span class="p">)</span>
</span><span id="L-1588"><a href="#L-1588"><span class="linenos">1588</span></a>            <span class="n">val_set_miles</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graphing</span><span class="o">.</span><span class="n">get_commute_values</span><span class="p">(</span><span class="n">emp_within</span><span class="p">,</span> <span class="n">office</span><span class="p">,</span> <span class="n">commute_data</span><span class="p">,</span> <span class="s2">&quot;miles&quot;</span><span class="p">)</span>
</span><span id="L-1589"><a href="#L-1589"><span class="linenos">1589</span></a>            <span class="c1"># Normalize the values in val_set by dividing by the corresponding values in val_set_free, and multiplying by 100</span>
</span><span id="L-1590"><a href="#L-1590"><span class="linenos">1590</span></a>            <span class="k">for</span> <span class="n">each</span> <span class="ow">in</span> <span class="n">values</span><span class="p">:</span>
</span><span id="L-1591"><a href="#L-1591"><span class="linenos">1591</span></a>                <span class="n">val_set</span><span class="p">[</span><span class="n">each</span><span class="p">]</span> <span class="o">=</span> <span class="n">val_set</span><span class="p">[</span><span class="n">each</span><span class="p">]</span> <span class="o">/</span> <span class="n">val_set_free</span><span class="p">[</span><span class="s1">&#39;duration&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">100</span>
</span><span id="L-1592"><a href="#L-1592"><span class="linenos">1592</span></a>
</span><span id="L-1593"><a href="#L-1593"><span class="linenos">1593</span></a>            <span class="n">plt</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graphing</span><span class="o">.</span><span class="n">get_scatterplot</span><span class="p">(</span><span class="n">emp</span><span class="p">,</span> <span class="n">office</span><span class="p">,</span> <span class="n">commute_data</span><span class="p">,</span> <span class="s2">&quot;miles&quot;</span><span class="p">,</span> <span class="s2">&quot;duration&quot;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span> <span class="n">x_label</span><span class="o">=</span><span class="s1">&#39;Normalized (In-Traffic / Traffic-Free) </span><span class="se">\n</span><span class="s1"> Commute Duration (%)&#39;</span><span class="p">,</span> 
</span><span id="L-1594"><a href="#L-1594"><span class="linenos">1594</span></a>                                                    <span class="n">y_label</span><span class="o">=</span><span class="s1">&#39;Commute Distance miles&#39;</span><span class="p">,</span>
</span><span id="L-1595"><a href="#L-1595"><span class="linenos">1595</span></a>                                                    <span class="n">cutoff_radius</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">commute_range_cut_off</span><span class="p">,</span> <span class="n">commute_radius</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">commute_range_cut_off</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">15</span><span class="p">),</span> <span class="n">manual_plot</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">font_mod</span><span class="o">=</span><span class="mf">1.5</span><span class="p">)</span>
</span><span id="L-1596"><a href="#L-1596"><span class="linenos">1596</span></a>            <span class="c1"># manually add scatter plots for each day</span>
</span><span id="L-1597"><a href="#L-1597"><span class="linenos">1597</span></a>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">)):</span>
</span><span id="L-1598"><a href="#L-1598"><span class="linenos">1598</span></a>                <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">val_set</span><span class="p">[</span><span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">]],</span> <span class="n">val_set_miles</span><span class="p">[</span><span class="s1">&#39;miles&#39;</span><span class="p">],</span>  <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;#555555&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> 
</span><span id="L-1599"><a href="#L-1599"><span class="linenos">1599</span></a>                           <span class="n">label</span><span class="o">=</span><span class="n">data_labels</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
</span><span id="L-1600"><a href="#L-1600"><span class="linenos">1600</span></a>                
</span><span id="L-1601"><a href="#L-1601"><span class="linenos">1601</span></a>                <span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;major&#39;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
</span><span id="L-1602"><a href="#L-1602"><span class="linenos">1602</span></a>              
</span><span id="L-1603"><a href="#L-1603"><span class="linenos">1603</span></a>                <span class="c1"># add a legend to show the office options</span>
</span><span id="L-1604"><a href="#L-1604"><span class="linenos">1604</span></a>                <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper right&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
</span><span id="L-1605"><a href="#L-1605"><span class="linenos">1605</span></a>
</span><span id="L-1606"><a href="#L-1606"><span class="linenos">1606</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">(</span><span class="n">pad</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
</span><span id="L-1607"><a href="#L-1607"><span class="linenos">1607</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">plots_dir</span><span class="o">+</span><span class="s2">&quot;/&quot;</span><span class="o">+</span><span class="n">key</span><span class="o">+</span><span class="s2">&quot;.png&quot;</span><span class="p">)</span>
</span><span id="L-1608"><a href="#L-1608"><span class="linenos">1608</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="L-1609"><a href="#L-1609"><span class="linenos">1609</span></a>
</span><span id="L-1610"><a href="#L-1610"><span class="linenos">1610</span></a>
</span><span id="L-1611"><a href="#L-1611"><span class="linenos">1611</span></a>        <span class="c1">############################################################################################################</span>
</span><span id="L-1612"><a href="#L-1612"><span class="linenos">1612</span></a>        <span class="c1"># GRAPH:</span>
</span><span id="L-1613"><a href="#L-1613"><span class="linenos">1613</span></a>        <span class="c1">## Normalized Commute Distribution Analysis Heat Map</span>
</span><span id="L-1614"><a href="#L-1614"><span class="linenos">1614</span></a>        <span class="n">key</span> <span class="o">=</span> <span class="s1">&#39;ncdahm&#39;</span>
</span><span id="L-1615"><a href="#L-1615"><span class="linenos">1615</span></a>        <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;Normalized Commute Distribution Analysis Heat Map&quot;</span>
</span><span id="L-1616"><a href="#L-1616"><span class="linenos">1616</span></a>        <span class="n">short_title</span> <span class="o">=</span> <span class="n">title</span>
</span><span id="L-1617"><a href="#L-1617"><span class="linenos">1617</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">graph_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="p">{</span><span class="s2">&quot;GRAPH&quot;</span><span class="p">:</span> <span class="n">key</span><span class="p">,</span>
</span><span id="L-1618"><a href="#L-1618"><span class="linenos">1618</span></a>                                <span class="s2">&quot;TITLE&quot;</span><span class="p">:</span> <span class="n">short_title</span><span class="p">,</span>
</span><span id="L-1619"><a href="#L-1619"><span class="linenos">1619</span></a>                                <span class="s2">&quot;FILENAME&quot;</span><span class="p">:</span> <span class="n">key</span><span class="o">+</span><span class="s2">&quot;.png&quot;</span><span class="p">,</span>
</span><span id="L-1620"><a href="#L-1620"><span class="linenos">1620</span></a>                                <span class="s2">&quot;PLOT-DESCRIPTION&quot;</span><span class="p">:</span>  <span class="s2">&quot;This graph plots the the normalized commute durations against the distance of the commute in a heat map. &quot;</span> <span class="o">+</span> \
</span><span id="L-1621"><a href="#L-1621"><span class="linenos">1621</span></a>                                                    <span class="s2">&quot;The objective is to understand the geography driving any strong departures from average or standard deviation.&quot;</span>
</span><span id="L-1622"><a href="#L-1622"><span class="linenos">1622</span></a>                                <span class="p">})</span>
</span><span id="L-1623"><a href="#L-1623"><span class="linenos">1623</span></a>        
</span><span id="L-1624"><a href="#L-1624"><span class="linenos">1624</span></a>        <span class="k">if</span> <span class="n">graph</span> <span class="o">==</span> <span class="s2">&quot;_all&quot;</span> <span class="ow">or</span> <span class="n">graph</span> <span class="o">==</span> <span class="n">key</span><span class="p">:</span>
</span><span id="L-1625"><a href="#L-1625"><span class="linenos">1625</span></a>            <span class="n">office</span> <span class="o">=</span> <span class="n">offices</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">to_frame</span><span class="p">()</span><span class="o">.</span><span class="n">T</span>
</span><span id="L-1626"><a href="#L-1626"><span class="linenos">1626</span></a>            <span class="n">values</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;m_morning_duration_in_traffic&#39;</span><span class="p">,</span><span class="s1">&#39;m_evening_duration_in_traffic&#39;</span><span class="p">,</span>
</span><span id="L-1627"><a href="#L-1627"><span class="linenos">1627</span></a>                    <span class="s1">&#39;t_morning_duration_in_traffic&#39;</span><span class="p">,</span><span class="s1">&#39;t_evening_duration_in_traffic&#39;</span><span class="p">,</span>
</span><span id="L-1628"><a href="#L-1628"><span class="linenos">1628</span></a>                    <span class="s1">&#39;w_morning_duration_in_traffic&#39;</span><span class="p">,</span><span class="s1">&#39;w_evening_duration_in_traffic&#39;</span><span class="p">,</span>
</span><span id="L-1629"><a href="#L-1629"><span class="linenos">1629</span></a>                    <span class="s1">&#39;h_morning_duration_in_traffic&#39;</span><span class="p">,</span><span class="s1">&#39;h_evening_duration_in_traffic&#39;</span><span class="p">,</span>
</span><span id="L-1630"><a href="#L-1630"><span class="linenos">1630</span></a>                    <span class="s1">&#39;f_morning_duration_in_traffic&#39;</span><span class="p">,</span><span class="s1">&#39;f_evening_duration_in_traffic&#39;</span><span class="p">]</span>
</span><span id="L-1631"><a href="#L-1631"><span class="linenos">1631</span></a>            <span class="n">data_labels</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Monday Morning&#39;</span><span class="p">,</span><span class="s1">&#39;Monday Evening&#39;</span><span class="p">,</span>
</span><span id="L-1632"><a href="#L-1632"><span class="linenos">1632</span></a>                    <span class="s1">&#39;Tuesday Morning&#39;</span><span class="p">,</span><span class="s1">&#39;Tuesday Evening&#39;</span><span class="p">,</span>
</span><span id="L-1633"><a href="#L-1633"><span class="linenos">1633</span></a>                    <span class="s1">&#39;Wednesday Morning&#39;</span><span class="p">,</span><span class="s1">&#39;Wednesday Evening&#39;</span><span class="p">,</span>
</span><span id="L-1634"><a href="#L-1634"><span class="linenos">1634</span></a>                    <span class="s1">&#39;Thursday Morning&#39;</span><span class="p">,</span><span class="s1">&#39;Thursday Evening&#39;</span><span class="p">,</span>
</span><span id="L-1635"><a href="#L-1635"><span class="linenos">1635</span></a>                    <span class="s1">&#39;Friday Morning&#39;</span><span class="p">,</span><span class="s1">&#39;Friday Evening&#39;</span><span class="p">]</span>
</span><span id="L-1636"><a href="#L-1636"><span class="linenos">1636</span></a>            
</span><span id="L-1637"><a href="#L-1637"><span class="linenos">1637</span></a>            <span class="n">emp_within</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graphing</span><span class="o">.</span><span class="n">filter_drive_distance</span><span class="p">(</span><span class="n">emp</span><span class="p">,</span><span class="n">office</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">commute_range_cut_off</span><span class="p">,</span> <span class="n">commute_data</span><span class="o">=</span><span class="n">commute_data</span><span class="p">)</span>
</span><span id="L-1638"><a href="#L-1638"><span class="linenos">1638</span></a>            <span class="n">val_set</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graphing</span><span class="o">.</span><span class="n">get_commute_values</span><span class="p">(</span><span class="n">emp_within</span><span class="p">,</span> <span class="n">office</span><span class="p">,</span> <span class="n">commute_data</span><span class="p">,</span> <span class="n">commute_data</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">to_list</span><span class="p">())</span>
</span><span id="L-1639"><a href="#L-1639"><span class="linenos">1639</span></a>            <span class="c1"># restore origin_lat and origin_long to the val_set</span>
</span><span id="L-1640"><a href="#L-1640"><span class="linenos">1640</span></a>            <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;origin_lat&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;latitude&#39;</span><span class="p">]</span>
</span><span id="L-1641"><a href="#L-1641"><span class="linenos">1641</span></a>            <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;origin_long&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;longitude&#39;</span><span class="p">]</span>
</span><span id="L-1642"><a href="#L-1642"><span class="linenos">1642</span></a>            <span class="n">val_set_free</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graphing</span><span class="o">.</span><span class="n">get_commute_values</span><span class="p">(</span><span class="n">emp_within</span><span class="p">,</span> <span class="n">office</span><span class="p">,</span> <span class="n">commute_data</span><span class="p">,</span> <span class="s2">&quot;duration&quot;</span><span class="p">)</span>
</span><span id="L-1643"><a href="#L-1643"><span class="linenos">1643</span></a>            <span class="c1"># Normalize the values in val_set by dividing by the corresponding values in val_set_free, and multiplying by 100</span>
</span><span id="L-1644"><a href="#L-1644"><span class="linenos">1644</span></a>            <span class="k">for</span> <span class="n">each</span> <span class="ow">in</span> <span class="n">values</span><span class="p">:</span>
</span><span id="L-1645"><a href="#L-1645"><span class="linenos">1645</span></a>                <span class="n">val_set</span><span class="p">[</span><span class="n">each</span><span class="p">]</span> <span class="o">=</span> <span class="n">val_set</span><span class="p">[</span><span class="n">each</span><span class="p">]</span> <span class="o">/</span> <span class="n">val_set_free</span><span class="p">[</span><span class="s1">&#39;duration&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">100</span>
</span><span id="L-1646"><a href="#L-1646"><span class="linenos">1646</span></a>            
</span><span id="L-1647"><a href="#L-1647"><span class="linenos">1647</span></a>            <span class="n">plt</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graphing</span><span class="o">.</span><span class="n">get_heatmap</span><span class="p">(</span><span class="n">emp_within</span><span class="p">,</span> <span class="n">office</span><span class="p">,</span> <span class="n">val_set</span><span class="p">,</span> <span class="n">values</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span> 
</span><span id="L-1648"><a href="#L-1648"><span class="linenos">1648</span></a>                                                <span class="n">value_label</span><span class="o">=</span><span class="s2">&quot;Normalized Commute in Traffic (% vs. Free)&quot;</span><span class="p">,</span> <span class="n">cutoff_distance</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">commute_range_cut_off</span><span class="p">,</span> <span class="n">commute_radius</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">commute_range_cut_off</span><span class="p">,</span>
</span><span id="L-1649"><a href="#L-1649"><span class="linenos">1649</span></a>                                                <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;jet&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">levels</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">font_mod</span><span class="o">=</span><span class="mf">1.5</span><span class="p">)</span>
</span><span id="L-1650"><a href="#L-1650"><span class="linenos">1650</span></a>
</span><span id="L-1651"><a href="#L-1651"><span class="linenos">1651</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">(</span><span class="n">pad</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
</span><span id="L-1652"><a href="#L-1652"><span class="linenos">1652</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">plots_dir</span><span class="o">+</span><span class="s2">&quot;/&quot;</span><span class="o">+</span><span class="n">key</span><span class="o">+</span><span class="s2">&quot;.png&quot;</span><span class="p">)</span>
</span><span id="L-1653"><a href="#L-1653"><span class="linenos">1653</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="L-1654"><a href="#L-1654"><span class="linenos">1654</span></a>            
</span><span id="L-1655"><a href="#L-1655"><span class="linenos">1655</span></a>        <span class="c1">################################################################################</span>
</span><span id="L-1656"><a href="#L-1656"><span class="linenos">1656</span></a>        <span class="c1">### GRAPH SET: Local Analysis for Office X</span>
</span><span id="L-1657"><a href="#L-1657"><span class="linenos">1657</span></a>        <span class="c1"># iterate through offices, generate a graph for each office</span>
</span><span id="L-1658"><a href="#L-1658"><span class="linenos">1658</span></a>        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">offices</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>    
</span><span id="L-1659"><a href="#L-1659"><span class="linenos">1659</span></a>        <span class="c1">############################################################################################################</span>
</span><span id="L-1660"><a href="#L-1660"><span class="linenos">1660</span></a>            <span class="c1"># GRAPH:</span>
</span><span id="L-1661"><a href="#L-1661"><span class="linenos">1661</span></a>            <span class="c1">## Normalized Commute Standard Deviation Analysis</span>
</span><span id="L-1662"><a href="#L-1662"><span class="linenos">1662</span></a>            <span class="n">key</span> <span class="o">=</span> <span class="s1">&#39;ncsda&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
</span><span id="L-1663"><a href="#L-1663"><span class="linenos">1663</span></a>            <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;Normalized Commute Standard Deviation Analysis&quot;</span> <span class="o">+</span> <span class="s2">&quot; for </span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;address&quot;</span><span class="p">]</span>
</span><span id="L-1664"><a href="#L-1664"><span class="linenos">1664</span></a>            <span class="n">short_title</span> <span class="o">=</span> <span class="n">title</span>
</span><span id="L-1665"><a href="#L-1665"><span class="linenos">1665</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">graph_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="p">{</span><span class="s2">&quot;GRAPH&quot;</span><span class="p">:</span> <span class="n">key</span><span class="p">,</span>
</span><span id="L-1666"><a href="#L-1666"><span class="linenos">1666</span></a>                                    <span class="s2">&quot;TITLE&quot;</span><span class="p">:</span> <span class="n">short_title</span><span class="p">,</span>
</span><span id="L-1667"><a href="#L-1667"><span class="linenos">1667</span></a>                                    <span class="s2">&quot;FILENAME&quot;</span><span class="p">:</span> <span class="n">key</span><span class="o">+</span><span class="s2">&quot;.png&quot;</span><span class="p">,</span>
</span><span id="L-1668"><a href="#L-1668"><span class="linenos">1668</span></a>                                    <span class="s2">&quot;PLOT-DESCRIPTION&quot;</span><span class="p">:</span>  <span class="s2">&quot;This graph shows the per-employee distribution of standard deviation to assess the &quot;</span> <span class="o">+</span> \
</span><span id="L-1669"><a href="#L-1669"><span class="linenos">1669</span></a>                                    <span class="s2">&quot;validity of using the average commute time as a metric for comparison.  This analysis is specific to the &quot;</span> <span class="o">+</span> \
</span><span id="L-1670"><a href="#L-1670"><span class="linenos">1670</span></a>                                    <span class="s2">&quot;office location at &quot;</span> <span class="o">+</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;address&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;.&quot;</span>
</span><span id="L-1671"><a href="#L-1671"><span class="linenos">1671</span></a>                                    <span class="p">})</span>
</span><span id="L-1672"><a href="#L-1672"><span class="linenos">1672</span></a>            
</span><span id="L-1673"><a href="#L-1673"><span class="linenos">1673</span></a>            <span class="k">if</span> <span class="n">graph</span> <span class="o">==</span> <span class="s2">&quot;_all&quot;</span> <span class="ow">or</span> <span class="n">graph</span> <span class="o">==</span> <span class="n">key</span><span class="p">:</span>
</span><span id="L-1674"><a href="#L-1674"><span class="linenos">1674</span></a>                <span class="n">office</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">to_frame</span><span class="p">()</span><span class="o">.</span><span class="n">T</span>
</span><span id="L-1675"><a href="#L-1675"><span class="linenos">1675</span></a>                <span class="n">values</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;m_morning_duration_in_traffic&#39;</span><span class="p">,</span><span class="s1">&#39;m_evening_duration_in_traffic&#39;</span><span class="p">,</span>
</span><span id="L-1676"><a href="#L-1676"><span class="linenos">1676</span></a>                        <span class="s1">&#39;t_morning_duration_in_traffic&#39;</span><span class="p">,</span><span class="s1">&#39;t_evening_duration_in_traffic&#39;</span><span class="p">,</span>
</span><span id="L-1677"><a href="#L-1677"><span class="linenos">1677</span></a>                        <span class="s1">&#39;w_morning_duration_in_traffic&#39;</span><span class="p">,</span><span class="s1">&#39;w_evening_duration_in_traffic&#39;</span><span class="p">,</span>
</span><span id="L-1678"><a href="#L-1678"><span class="linenos">1678</span></a>                        <span class="s1">&#39;h_morning_duration_in_traffic&#39;</span><span class="p">,</span><span class="s1">&#39;h_evening_duration_in_traffic&#39;</span><span class="p">,</span>
</span><span id="L-1679"><a href="#L-1679"><span class="linenos">1679</span></a>                        <span class="s1">&#39;f_morning_duration_in_traffic&#39;</span><span class="p">,</span><span class="s1">&#39;f_evening_duration_in_traffic&#39;</span><span class="p">]</span>
</span><span id="L-1680"><a href="#L-1680"><span class="linenos">1680</span></a>
</span><span id="L-1681"><a href="#L-1681"><span class="linenos">1681</span></a>                <span class="n">emp_within</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graphing</span><span class="o">.</span><span class="n">filter_drive_distance</span><span class="p">(</span><span class="n">emp</span><span class="p">,</span><span class="n">office</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">commute_range_cut_off</span><span class="p">,</span> <span class="n">commute_data</span><span class="o">=</span><span class="n">commute_data</span><span class="p">)</span>
</span><span id="L-1682"><a href="#L-1682"><span class="linenos">1682</span></a>                <span class="n">val_set</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graphing</span><span class="o">.</span><span class="n">get_commute_values</span><span class="p">(</span><span class="n">emp_within</span><span class="p">,</span> <span class="n">office</span><span class="p">,</span> <span class="n">commute_data</span><span class="p">,</span> <span class="n">values</span><span class="p">)</span>
</span><span id="L-1683"><a href="#L-1683"><span class="linenos">1683</span></a>                <span class="n">val_set_free</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graphing</span><span class="o">.</span><span class="n">get_commute_values</span><span class="p">(</span><span class="n">emp_within</span><span class="p">,</span> <span class="n">office</span><span class="p">,</span> <span class="n">commute_data</span><span class="p">,</span> <span class="s2">&quot;duration&quot;</span><span class="p">)</span>
</span><span id="L-1684"><a href="#L-1684"><span class="linenos">1684</span></a>                <span class="n">val_set_miles</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graphing</span><span class="o">.</span><span class="n">get_commute_values</span><span class="p">(</span><span class="n">emp_within</span><span class="p">,</span> <span class="n">office</span><span class="p">,</span> <span class="n">commute_data</span><span class="p">,</span> <span class="s2">&quot;miles&quot;</span><span class="p">)</span>
</span><span id="L-1685"><a href="#L-1685"><span class="linenos">1685</span></a>                
</span><span id="L-1686"><a href="#L-1686"><span class="linenos">1686</span></a>                <span class="n">mean</span> <span class="o">=</span> <span class="n">val_set</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="n">values</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="L-1687"><a href="#L-1687"><span class="linenos">1687</span></a>                <span class="n">std</span> <span class="o">=</span> <span class="n">val_set</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="n">values</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="L-1688"><a href="#L-1688"><span class="linenos">1688</span></a>                <span class="n">max_val</span> <span class="o">=</span> <span class="n">val_set</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="n">values</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="L-1689"><a href="#L-1689"><span class="linenos">1689</span></a>                <span class="n">min_val</span> <span class="o">=</span> <span class="n">val_set</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="n">values</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="L-1690"><a href="#L-1690"><span class="linenos">1690</span></a>                <span class="n">data_labels</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Mean&#39;</span><span class="p">,</span><span class="s1">&#39;Standard Deviation&#39;</span><span class="p">,</span><span class="s1">&#39;Max&#39;</span><span class="p">,</span><span class="s1">&#39;Min&#39;</span><span class="p">]</span>
</span><span id="L-1691"><a href="#L-1691"><span class="linenos">1691</span></a>                <span class="n">x</span> <span class="o">=</span> <span class="p">[</span><span class="n">mean</span><span class="p">,</span> <span class="n">std</span><span class="p">,</span> <span class="n">max_val</span><span class="p">,</span> <span class="n">min_val</span><span class="p">]</span>
</span><span id="L-1692"><a href="#L-1692"><span class="linenos">1692</span></a>                <span class="c1"># Normalize the values in val_set by dividing by the corresponding values in val_set_free, and multiplying by 100</span>
</span><span id="L-1693"><a href="#L-1693"><span class="linenos">1693</span></a>                <span class="c1">#for each in values:</span>
</span><span id="L-1694"><a href="#L-1694"><span class="linenos">1694</span></a>                <span class="c1">#   val_set[each] = val_set[each] / val_set_free[&#39;duration&#39;] * 100</span>
</span><span id="L-1695"><a href="#L-1695"><span class="linenos">1695</span></a>
</span><span id="L-1696"><a href="#L-1696"><span class="linenos">1696</span></a>                <span class="n">plt</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graphing</span><span class="o">.</span><span class="n">get_scatterplot</span><span class="p">(</span><span class="n">emp</span><span class="p">,</span> <span class="n">office</span><span class="p">,</span> <span class="n">commute_data</span><span class="p">,</span> <span class="s2">&quot;miles&quot;</span><span class="p">,</span> <span class="s2">&quot;duration&quot;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span> <span class="n">x_label</span><span class="o">=</span><span class="s1">&#39;Duration (min)&#39;</span><span class="p">,</span> 
</span><span id="L-1697"><a href="#L-1697"><span class="linenos">1697</span></a>                                                        <span class="n">y_label</span><span class="o">=</span><span class="s1">&#39;Commute Distance (miles)&#39;</span><span class="p">,</span>
</span><span id="L-1698"><a href="#L-1698"><span class="linenos">1698</span></a>                                                        <span class="n">cutoff_radius</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">commute_range_cut_off</span><span class="p">,</span> <span class="n">commute_radius</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">commute_range_cut_off</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">15</span><span class="p">),</span> <span class="n">manual_plot</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">font_mod</span><span class="o">=</span><span class="mf">1.5</span><span class="p">)</span>
</span><span id="L-1699"><a href="#L-1699"><span class="linenos">1699</span></a>                
</span><span id="L-1700"><a href="#L-1700"><span class="linenos">1700</span></a>                <span class="c1"># manually add scatter plots for each day</span>
</span><span id="L-1701"><a href="#L-1701"><span class="linenos">1701</span></a>                <span class="c1">#for i in range(len(data_labels)):</span>
</span><span id="L-1702"><a href="#L-1702"><span class="linenos">1702</span></a>                <span class="n">i</span><span class="o">=</span><span class="mi">1</span>
</span><span id="L-1703"><a href="#L-1703"><span class="linenos">1703</span></a>                <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">val_set_miles</span><span class="p">[</span><span class="s1">&#39;miles&#39;</span><span class="p">],</span>  <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;#555555&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
</span><span id="L-1704"><a href="#L-1704"><span class="linenos">1704</span></a>                            <span class="n">label</span><span class="o">=</span><span class="n">data_labels</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</span><span id="L-1705"><a href="#L-1705"><span class="linenos">1705</span></a>                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">val_set</span><span class="p">)):</span>
</span><span id="L-1706"><a href="#L-1706"><span class="linenos">1706</span></a>                    <span class="c1"># add end bars to the lines</span>
</span><span id="L-1707"><a href="#L-1707"><span class="linenos">1707</span></a>                    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">min_val</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">max_val</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span><span class="p">]],</span> <span class="p">[</span><span class="n">val_set_miles</span><span class="p">[</span><span class="s1">&#39;miles&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">val_set_miles</span><span class="p">[</span><span class="s1">&#39;miles&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span><span class="p">]],</span> <span class="s1">&#39;k-&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;|&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>   
</span><span id="L-1708"><a href="#L-1708"><span class="linenos">1708</span></a>
</span><span id="L-1709"><a href="#L-1709"><span class="linenos">1709</span></a>                <span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;major&#39;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
</span><span id="L-1710"><a href="#L-1710"><span class="linenos">1710</span></a>                
</span><span id="L-1711"><a href="#L-1711"><span class="linenos">1711</span></a>                <span class="c1"># add a legend to show the office options</span>
</span><span id="L-1712"><a href="#L-1712"><span class="linenos">1712</span></a>                <span class="c1"># add a legend entry for the label=&#39;Min/Max Spread&#39;</span>
</span><span id="L-1713"><a href="#L-1713"><span class="linenos">1713</span></a>                <span class="n">handles</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_legend_handles_labels</span><span class="p">()</span>
</span><span id="L-1714"><a href="#L-1714"><span class="linenos">1714</span></a>                <span class="n">new_handle</span> <span class="o">=</span> <span class="n">Line2D</span><span class="p">([],</span> <span class="p">[],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Min/Max Spread&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;|&#39;</span><span class="p">)</span>
</span><span id="L-1715"><a href="#L-1715"><span class="linenos">1715</span></a>                <span class="n">new_label</span> <span class="o">=</span> <span class="s1">&#39;In-Traffic Min/Max Spread for Week (miles)&#39;</span>
</span><span id="L-1716"><a href="#L-1716"><span class="linenos">1716</span></a>                <span class="n">handles</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_handle</span><span class="p">)</span>
</span><span id="L-1717"><a href="#L-1717"><span class="linenos">1717</span></a>                <span class="n">labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_label</span><span class="p">)</span>
</span><span id="L-1718"><a href="#L-1718"><span class="linenos">1718</span></a>            
</span><span id="L-1719"><a href="#L-1719"><span class="linenos">1719</span></a>                <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">handles</span><span class="o">=</span><span class="n">handles</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="n">labels</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;lower right&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
</span><span id="L-1720"><a href="#L-1720"><span class="linenos">1720</span></a>                
</span><span id="L-1721"><a href="#L-1721"><span class="linenos">1721</span></a>                <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">(</span><span class="n">pad</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
</span><span id="L-1722"><a href="#L-1722"><span class="linenos">1722</span></a>                <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">plots_dir</span><span class="o">+</span><span class="s2">&quot;/&quot;</span><span class="o">+</span><span class="n">key</span><span class="o">+</span><span class="s2">&quot;.png&quot;</span><span class="p">)</span>
</span><span id="L-1723"><a href="#L-1723"><span class="linenos">1723</span></a>                <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="L-1724"><a href="#L-1724"><span class="linenos">1724</span></a>            
</span><span id="L-1725"><a href="#L-1725"><span class="linenos">1725</span></a>
</span><span id="L-1726"><a href="#L-1726"><span class="linenos">1726</span></a>        <span class="c1">################################################################################</span>
</span><span id="L-1727"><a href="#L-1727"><span class="linenos">1727</span></a>        <span class="c1">### GRAPH SET: Local Analysis for Office X</span>
</span><span id="L-1728"><a href="#L-1728"><span class="linenos">1728</span></a>        <span class="c1"># iterate through offices, generate a graph for each office</span>
</span><span id="L-1729"><a href="#L-1729"><span class="linenos">1729</span></a>        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">offices</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>    
</span><span id="L-1730"><a href="#L-1730"><span class="linenos">1730</span></a>        <span class="c1">############################################################################################################</span>
</span><span id="L-1731"><a href="#L-1731"><span class="linenos">1731</span></a>            <span class="c1"># GRAPH:</span>
</span><span id="L-1732"><a href="#L-1732"><span class="linenos">1732</span></a>            <span class="c1">## Time-Based Commute Cost Analysis</span>
</span><span id="L-1733"><a href="#L-1733"><span class="linenos">1733</span></a>            <span class="n">key</span> <span class="o">=</span> <span class="s1">&#39;tbcca&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
</span><span id="L-1734"><a href="#L-1734"><span class="linenos">1734</span></a>            <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;Time-Based Commute Cost Analysis&quot;</span> <span class="o">+</span> <span class="s2">&quot; for </span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;address&quot;</span><span class="p">]</span>
</span><span id="L-1735"><a href="#L-1735"><span class="linenos">1735</span></a>            <span class="n">short_title</span> <span class="o">=</span> <span class="n">title</span>
</span><span id="L-1736"><a href="#L-1736"><span class="linenos">1736</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">graph_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="p">{</span><span class="s2">&quot;GRAPH&quot;</span><span class="p">:</span> <span class="n">key</span><span class="p">,</span>
</span><span id="L-1737"><a href="#L-1737"><span class="linenos">1737</span></a>                                    <span class="s2">&quot;TITLE&quot;</span><span class="p">:</span> <span class="n">short_title</span><span class="p">,</span>
</span><span id="L-1738"><a href="#L-1738"><span class="linenos">1738</span></a>                                    <span class="s2">&quot;FILENAME&quot;</span><span class="p">:</span> <span class="n">key</span><span class="o">+</span><span class="s2">&quot;.png&quot;</span><span class="p">,</span>
</span><span id="L-1739"><a href="#L-1739"><span class="linenos">1739</span></a>                                    <span class="s2">&quot;PLOT-DESCRIPTION&quot;</span><span class="p">:</span>  <span class="s2">&quot;This graph shows the average and high/conservative cost of employees commuting to &quot;</span> <span class="o">+</span> \
</span><span id="L-1740"><a href="#L-1740"><span class="linenos">1740</span></a>                                    <span class="s2">&quot;the office location at &quot;</span> <span class="o">+</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;address&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;. The average cost is based upon the morning average and evening &quot;</span> <span class="o">+</span> \
</span><span id="L-1741"><a href="#L-1741"><span class="linenos">1741</span></a>                                    <span class="s2">&quot;average commute times, while the high/conservative cost is based upon the highest morning maximum and evening values for &quot;</span> <span class="o">+</span> \
</span><span id="L-1742"><a href="#L-1742"><span class="linenos">1742</span></a>                                    <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">commute_days_per_week</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; days per week.&quot;</span>
</span><span id="L-1743"><a href="#L-1743"><span class="linenos">1743</span></a>                                    <span class="p">})</span>
</span><span id="L-1744"><a href="#L-1744"><span class="linenos">1744</span></a>            
</span><span id="L-1745"><a href="#L-1745"><span class="linenos">1745</span></a>            <span class="k">if</span> <span class="n">graph</span> <span class="o">==</span> <span class="s2">&quot;_all&quot;</span> <span class="ow">or</span> <span class="n">graph</span> <span class="o">==</span> <span class="n">key</span><span class="p">:</span>
</span><span id="L-1746"><a href="#L-1746"><span class="linenos">1746</span></a>                <span class="n">office</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">to_frame</span><span class="p">()</span><span class="o">.</span><span class="n">T</span>
</span><span id="L-1747"><a href="#L-1747"><span class="linenos">1747</span></a>
</span><span id="L-1748"><a href="#L-1748"><span class="linenos">1748</span></a>                <span class="c1"># get the needed commute values</span>
</span><span id="L-1749"><a href="#L-1749"><span class="linenos">1749</span></a>                <span class="n">values</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;m_morning_duration_in_traffic&#39;</span><span class="p">,</span><span class="s1">&#39;m_evening_duration_in_traffic&#39;</span><span class="p">,</span>
</span><span id="L-1750"><a href="#L-1750"><span class="linenos">1750</span></a>                        <span class="s1">&#39;t_morning_duration_in_traffic&#39;</span><span class="p">,</span><span class="s1">&#39;t_evening_duration_in_traffic&#39;</span><span class="p">,</span>
</span><span id="L-1751"><a href="#L-1751"><span class="linenos">1751</span></a>                        <span class="s1">&#39;w_morning_duration_in_traffic&#39;</span><span class="p">,</span><span class="s1">&#39;w_evening_duration_in_traffic&#39;</span><span class="p">,</span>
</span><span id="L-1752"><a href="#L-1752"><span class="linenos">1752</span></a>                        <span class="s1">&#39;h_morning_duration_in_traffic&#39;</span><span class="p">,</span><span class="s1">&#39;h_evening_duration_in_traffic&#39;</span><span class="p">,</span>
</span><span id="L-1753"><a href="#L-1753"><span class="linenos">1753</span></a>                        <span class="s1">&#39;f_morning_duration_in_traffic&#39;</span><span class="p">,</span><span class="s1">&#39;f_evening_duration_in_traffic&#39;</span><span class="p">]</span>
</span><span id="L-1754"><a href="#L-1754"><span class="linenos">1754</span></a>                
</span><span id="L-1755"><a href="#L-1755"><span class="linenos">1755</span></a>                <span class="n">mornings</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;m_morning_duration_in_traffic&#39;</span><span class="p">,</span><span class="s1">&#39;t_morning_duration_in_traffic&#39;</span><span class="p">,</span><span class="s1">&#39;w_morning_duration_in_traffic&#39;</span><span class="p">,</span><span class="s1">&#39;h_morning_duration_in_traffic&#39;</span><span class="p">,</span><span class="s1">&#39;f_morning_duration_in_traffic&#39;</span><span class="p">]</span>
</span><span id="L-1756"><a href="#L-1756"><span class="linenos">1756</span></a>                <span class="n">evenings</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;m_evening_duration_in_traffic&#39;</span><span class="p">,</span><span class="s1">&#39;t_evening_duration_in_traffic&#39;</span><span class="p">,</span><span class="s1">&#39;w_evening_duration_in_traffic&#39;</span><span class="p">,</span><span class="s1">&#39;h_evening_duration_in_traffic&#39;</span><span class="p">,</span><span class="s1">&#39;f_evening_duration_in_traffic&#39;</span><span class="p">]</span>
</span><span id="L-1757"><a href="#L-1757"><span class="linenos">1757</span></a>                <span class="n">cdpw</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">commute_days_per_week</span>
</span><span id="L-1758"><a href="#L-1758"><span class="linenos">1758</span></a>
</span><span id="L-1759"><a href="#L-1759"><span class="linenos">1759</span></a>                <span class="n">emp_within</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graphing</span><span class="o">.</span><span class="n">filter_drive_distance</span><span class="p">(</span><span class="n">emp</span><span class="p">,</span><span class="n">office</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">commute_range_cut_off</span><span class="p">,</span> <span class="n">commute_data</span><span class="o">=</span><span class="n">commute_data</span><span class="p">)</span>
</span><span id="L-1760"><a href="#L-1760"><span class="linenos">1760</span></a>                <span class="n">val_set</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graphing</span><span class="o">.</span><span class="n">get_commute_values</span><span class="p">(</span><span class="n">emp_within</span><span class="p">,</span> <span class="n">office</span><span class="p">,</span> <span class="n">commute_data</span><span class="p">,</span> <span class="n">values</span><span class="p">)</span>
</span><span id="L-1761"><a href="#L-1761"><span class="linenos">1761</span></a>                
</span><span id="L-1762"><a href="#L-1762"><span class="linenos">1762</span></a>                
</span><span id="L-1763"><a href="#L-1763"><span class="linenos">1763</span></a>
</span><span id="L-1764"><a href="#L-1764"><span class="linenos">1764</span></a>                <span class="c1"># Calculate and insert the average morning and evening commute times directly into val_set</span>
</span><span id="L-1765"><a href="#L-1765"><span class="linenos">1765</span></a>                <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;Morning Average&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">val_set</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">mornings</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="L-1766"><a href="#L-1766"><span class="linenos">1766</span></a>                <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;Evening Average&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">val_set</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">evenings</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="L-1767"><a href="#L-1767"><span class="linenos">1767</span></a>
</span><span id="L-1768"><a href="#L-1768"><span class="linenos">1768</span></a>                <span class="c1"># Calculate and insert the top &#39;cdpw&#39; maximum morning and evening commute times</span>
</span><span id="L-1769"><a href="#L-1769"><span class="linenos">1769</span></a>                <span class="c1"># Note: Adjust the code below to calculate the averages of the top &#39;cdpw&#39; as new columns directly</span>
</span><span id="L-1770"><a href="#L-1770"><span class="linenos">1770</span></a>                <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;Average Top CDPW Morning&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">val_set</span><span class="p">[</span><span class="n">mornings</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="n">row</span><span class="o">.</span><span class="n">nlargest</span><span class="p">(</span><span class="n">cdpw</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="L-1771"><a href="#L-1771"><span class="linenos">1771</span></a>                <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;Average Top CDPW Evening&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">val_set</span><span class="p">[</span><span class="n">evenings</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="n">row</span><span class="o">.</span><span class="n">nlargest</span><span class="p">(</span><span class="n">cdpw</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="L-1772"><a href="#L-1772"><span class="linenos">1772</span></a>
</span><span id="L-1773"><a href="#L-1773"><span class="linenos">1773</span></a>                <span class="c1"># Calculate a per-minute cost based on &quot;median_salary&quot; and &quot;hours_per_year&quot;</span>
</span><span id="L-1774"><a href="#L-1774"><span class="linenos">1774</span></a>                <span class="n">per_minute_cost</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">median_salary</span> <span class="o">/</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">hours_per_year</span> <span class="o">*</span> <span class="mi">60</span><span class="p">)</span>
</span><span id="L-1775"><a href="#L-1775"><span class="linenos">1775</span></a>
</span><span id="L-1776"><a href="#L-1776"><span class="linenos">1776</span></a>                <span class="c1"># Calculate and insert the average cost for the week directly into val_set</span>
</span><span id="L-1777"><a href="#L-1777"><span class="linenos">1777</span></a>                <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;Morning Average Cost&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;Morning Average&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">per_minute_cost</span>
</span><span id="L-1778"><a href="#L-1778"><span class="linenos">1778</span></a>                <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;Evening Average Cost&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;Evening Average&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">per_minute_cost</span>
</span><span id="L-1779"><a href="#L-1779"><span class="linenos">1779</span></a>
</span><span id="L-1780"><a href="#L-1780"><span class="linenos">1780</span></a>                <span class="c1"># Calculate and insert the high/conservative cost for the week directly into val_set</span>
</span><span id="L-1781"><a href="#L-1781"><span class="linenos">1781</span></a>                <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;Morning High Cost&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;Average Top CDPW Morning&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">per_minute_cost</span>
</span><span id="L-1782"><a href="#L-1782"><span class="linenos">1782</span></a>                <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;Evening High Cost&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;Average Top CDPW Evening&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">per_minute_cost</span>
</span><span id="L-1783"><a href="#L-1783"><span class="linenos">1783</span></a>
</span><span id="L-1784"><a href="#L-1784"><span class="linenos">1784</span></a>                <span class="c1"># create bins based on the max value of the data</span>
</span><span id="L-1785"><a href="#L-1785"><span class="linenos">1785</span></a>                <span class="n">binmax</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-1786"><a href="#L-1786"><span class="linenos">1786</span></a>                <span class="k">for</span> <span class="n">each</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;Morning Average Cost&#39;</span><span class="p">,</span><span class="s1">&#39;Evening Average Cost&#39;</span><span class="p">,</span><span class="s1">&#39;Morning High Cost&#39;</span><span class="p">,</span><span class="s1">&#39;Evening High Cost&#39;</span><span class="p">]:</span>
</span><span id="L-1787"><a href="#L-1787"><span class="linenos">1787</span></a>                    <span class="k">if</span> <span class="nb">max</span><span class="p">(</span><span class="n">val_set</span><span class="p">[</span><span class="n">each</span><span class="p">])</span> <span class="o">&gt;</span> <span class="n">binmax</span><span class="p">:</span>
</span><span id="L-1788"><a href="#L-1788"><span class="linenos">1788</span></a>                        <span class="n">binmax</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">val_set</span><span class="p">[</span><span class="n">each</span><span class="p">])</span>
</span><span id="L-1789"><a href="#L-1789"><span class="linenos">1789</span></a>                <span class="n">step</span> <span class="o">=</span> <span class="mi">5</span>
</span><span id="L-1790"><a href="#L-1790"><span class="linenos">1790</span></a>                <span class="c1"># round the binmax up to the nearest step</span>
</span><span id="L-1791"><a href="#L-1791"><span class="linenos">1791</span></a>                <span class="n">bins</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">binmax</span> <span class="o">+</span> <span class="n">step</span> <span class="o">-</span> <span class="p">(</span><span class="n">binmax</span> <span class="o">%</span> <span class="n">step</span><span class="p">)),</span> <span class="n">step</span><span class="p">)</span>
</span><span id="L-1792"><a href="#L-1792"><span class="linenos">1792</span></a>                
</span><span id="L-1793"><a href="#L-1793"><span class="linenos">1793</span></a>                <span class="n">font_mod</span> <span class="o">=</span> <span class="mf">1.5</span>
</span><span id="L-1794"><a href="#L-1794"><span class="linenos">1794</span></a>                <span class="c1"># create histograms for the morning and evening average costs</span>
</span><span id="L-1795"><a href="#L-1795"><span class="linenos">1795</span></a>                <span class="n">plt</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graphing</span><span class="o">.</span><span class="n">get_histogram</span><span class="p">(</span><span class="n">emp</span><span class="p">,</span> <span class="n">office</span><span class="p">,</span> <span class="n">commute_data</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;m_morning_duration_in_traffic&#39;</span><span class="p">,</span><span class="s1">&#39;m_evening_duration_in_traffic&#39;</span><span class="p">],</span> 
</span><span id="L-1796"><a href="#L-1796"><span class="linenos">1796</span></a>                                                      <span class="n">suptitle</span><span class="o">=</span><span class="s2">&quot;Average and Maximum Time-in-Traffic Costs for </span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;address&#39;</span><span class="p">]),</span> 
</span><span id="L-1797"><a href="#L-1797"><span class="linenos">1797</span></a>                                                      <span class="n">cutoff_radius</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">commute_range_cut_off</span><span class="p">,</span>
</span><span id="L-1798"><a href="#L-1798"><span class="linenos">1798</span></a>                                      <span class="n">x_label</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="s1">&#39;\$ (USD) based on median salary (converted to per minute)&#39;</span><span class="p">),</span> <span class="n">y_label</span><span class="o">=</span><span class="s1">&#39;# Employees&#39;</span><span class="p">,</span>
</span><span id="L-1799"><a href="#L-1799"><span class="linenos">1799</span></a>                                      <span class="n">bins</span><span class="o">=</span><span class="n">bins</span><span class="p">,</span> <span class="n">rows</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">cols</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">column_titles</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Average&quot;</span><span class="p">,</span><span class="s2">&quot;High/Conservative&quot;</span><span class="p">],</span> 
</span><span id="L-1800"><a href="#L-1800"><span class="linenos">1800</span></a>                                      <span class="n">cumulative_line</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">font_mod</span><span class="o">=</span><span class="n">font_mod</span><span class="p">,</span> <span class="n">manual_plot</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">sharey</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-1801"><a href="#L-1801"><span class="linenos">1801</span></a>                <span class="n">plot_vals</span> <span class="o">=</span> <span class="p">[[</span><span class="s1">&#39;Morning Average Cost&#39;</span><span class="p">,</span><span class="s2">&quot;Morning High Cost&quot;</span><span class="p">],[</span><span class="s2">&quot;Evening Average Cost&quot;</span><span class="p">,</span><span class="s2">&quot;Evening High Cost&quot;</span><span class="p">]]</span>
</span><span id="L-1802"><a href="#L-1802"><span class="linenos">1802</span></a>                <span class="c1"># manually add histograms for each office option</span>
</span><span id="L-1803"><a href="#L-1803"><span class="linenos">1803</span></a>                <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
</span><span id="L-1804"><a href="#L-1804"><span class="linenos">1804</span></a>                    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
</span><span id="L-1805"><a href="#L-1805"><span class="linenos">1805</span></a>                        <span class="n">ax</span><span class="p">[</span><span class="n">r</span><span class="p">,</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">val_set</span><span class="p">[</span><span class="n">plot_vals</span><span class="p">[</span><span class="n">r</span><span class="p">][</span><span class="n">c</span><span class="p">]],</span> <span class="n">bins</span><span class="o">=</span><span class="n">bins</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;#555555&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">align</span><span class="o">=</span><span class="s1">&#39;mid&#39;</span><span class="p">,</span> 
</span><span id="L-1806"><a href="#L-1806"><span class="linenos">1806</span></a>                                <span class="n">rwidth</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">plot_vals</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">(</span><span class="n">r</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>
</span><span id="L-1807"><a href="#L-1807"><span class="linenos">1807</span></a>                        <span class="n">ax</span><span class="p">[</span><span class="n">r</span><span class="p">,</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;major&#39;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
</span><span id="L-1808"><a href="#L-1808"><span class="linenos">1808</span></a>
</span><span id="L-1809"><a href="#L-1809"><span class="linenos">1809</span></a>                        <span class="c1"># add a text box in the upper right corner with the stats</span>
</span><span id="L-1810"><a href="#L-1810"><span class="linenos">1810</span></a>                        <span class="n">t</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;me&#39;</span> <span class="p">:</span> <span class="s1">&#39;Median: |$</span><span class="si">{:,.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">val_set</span><span class="p">[</span><span class="n">plot_vals</span><span class="p">[</span><span class="n">r</span><span class="p">][</span><span class="n">c</span><span class="p">]])),</span>
</span><span id="L-1811"><a href="#L-1811"><span class="linenos">1811</span></a>                            <span class="s1">&#39;av&#39;</span> <span class="p">:</span> <span class="s1">&#39;Average: |$</span><span class="si">{:,.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">val_set</span><span class="p">[</span><span class="n">plot_vals</span><span class="p">[</span><span class="n">r</span><span class="p">][</span><span class="n">c</span><span class="p">]])),</span>
</span><span id="L-1812"><a href="#L-1812"><span class="linenos">1812</span></a>                            <span class="s1">&#39;mi&#39;</span> <span class="p">:</span> <span class="s1">&#39;Min: |$</span><span class="si">{:,.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">val_set</span><span class="p">[</span><span class="n">plot_vals</span><span class="p">[</span><span class="n">r</span><span class="p">][</span><span class="n">c</span><span class="p">]])),</span>
</span><span id="L-1813"><a href="#L-1813"><span class="linenos">1813</span></a>                            <span class="s1">&#39;ma&#39;</span> <span class="p">:</span> <span class="s1">&#39;Max: |$</span><span class="si">{:,.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">val_set</span><span class="p">[</span><span class="n">plot_vals</span><span class="p">[</span><span class="n">r</span><span class="p">][</span><span class="n">c</span><span class="p">]])),</span>
</span><span id="L-1814"><a href="#L-1814"><span class="linenos">1814</span></a>                            <span class="s1">&#39;to&#39;</span> <span class="p">:</span> <span class="s1">&#39;Total: |$</span><span class="si">{:,.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">val_set</span><span class="p">[</span><span class="n">plot_vals</span><span class="p">[</span><span class="n">r</span><span class="p">][</span><span class="n">c</span><span class="p">]]))</span>
</span><span id="L-1815"><a href="#L-1815"><span class="linenos">1815</span></a>                            <span class="p">}</span>
</span><span id="L-1816"><a href="#L-1816"><span class="linenos">1816</span></a>                        <span class="c1"># get the longest string value</span>
</span><span id="L-1817"><a href="#L-1817"><span class="linenos">1817</span></a>                        <span class="n">max_len</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="s1">&#39;me&#39;</span><span class="p">]),</span><span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="s1">&#39;av&#39;</span><span class="p">]),</span><span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="s1">&#39;to&#39;</span><span class="p">]),</span><span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="s1">&#39;mi&#39;</span><span class="p">]),</span><span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="s1">&#39;ma&#39;</span><span class="p">]))</span>
</span><span id="L-1818"><a href="#L-1818"><span class="linenos">1818</span></a>                        <span class="c1"># calculate additional space</span>
</span><span id="L-1819"><a href="#L-1819"><span class="linenos">1819</span></a>                        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">t</span><span class="p">:</span>
</span><span id="L-1820"><a href="#L-1820"><span class="linenos">1820</span></a>                            <span class="n">t</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">t</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">,</span><span class="s2">&quot; &quot;</span><span class="o">*</span><span class="p">(</span><span class="n">max_len</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="n">k</span><span class="p">])))</span>
</span><span id="L-1821"><a href="#L-1821"><span class="linenos">1821</span></a>                        <span class="c1"># add spaces to make all the same length, replacing |</span>
</span><span id="L-1822"><a href="#L-1822"><span class="linenos">1822</span></a>                        <span class="n">textstr</span> <span class="o">=</span> <span class="s2">&quot;Commute Time Cost: &quot;</span>
</span><span id="L-1823"><a href="#L-1823"><span class="linenos">1823</span></a>                        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">t</span><span class="p">:</span>
</span><span id="L-1824"><a href="#L-1824"><span class="linenos">1824</span></a>                            <span class="n">textstr</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">t</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
</span><span id="L-1825"><a href="#L-1825"><span class="linenos">1825</span></a>                        <span class="c1"># these are matplotlib.patch.Patch properties</span>
</span><span id="L-1826"><a href="#L-1826"><span class="linenos">1826</span></a>                        <span class="n">props</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">boxstyle</span><span class="o">=</span><span class="s1">&#39;round&#39;</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;wheat&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
</span><span id="L-1827"><a href="#L-1827"><span class="linenos">1827</span></a>                        <span class="c1"># place a text box in upper right in axes coords,</span>
</span><span id="L-1828"><a href="#L-1828"><span class="linenos">1828</span></a>                        <span class="n">ax</span><span class="p">[</span><span class="n">r</span><span class="p">,</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">.95</span><span class="p">,</span> <span class="mf">.75</span><span class="p">,</span> <span class="n">textstr</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="n">r</span><span class="p">,</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">,</span>
</span><span id="L-1829"><a href="#L-1829"><span class="linenos">1829</span></a>                                    <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">bbox</span><span class="o">=</span><span class="n">props</span><span class="p">,</span> <span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;family&#39;</span><span class="p">:</span> <span class="s1">&#39;monospace&#39;</span><span class="p">},</span> <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">)</span>
</span><span id="L-1830"><a href="#L-1830"><span class="linenos">1830</span></a>                        
</span><span id="L-1831"><a href="#L-1831"><span class="linenos">1831</span></a>
</span><span id="L-1832"><a href="#L-1832"><span class="linenos">1832</span></a>                        <span class="c1"># for the first column, add morning/evening text box the top left of the plot</span>
</span><span id="L-1833"><a href="#L-1833"><span class="linenos">1833</span></a>                        <span class="k">if</span> <span class="n">r</span><span class="o">==</span><span class="mi">0</span> <span class="ow">and</span> <span class="n">c</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-1834"><a href="#L-1834"><span class="linenos">1834</span></a>                            <span class="n">ax</span><span class="p">[</span><span class="n">r</span><span class="p">,</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.85</span><span class="p">,</span> <span class="s1">&#39;Morning&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="o">*</span><span class="n">font_mod</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="n">r</span><span class="p">,</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;top&#39;</span><span class="p">)</span>
</span><span id="L-1835"><a href="#L-1835"><span class="linenos">1835</span></a>                        <span class="k">if</span> <span class="n">r</span><span class="o">==</span><span class="mi">1</span> <span class="ow">and</span> <span class="n">c</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-1836"><a href="#L-1836"><span class="linenos">1836</span></a>                            <span class="n">ax</span><span class="p">[</span><span class="n">r</span><span class="p">,</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.85</span><span class="p">,</span> <span class="s1">&#39;Evening&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="o">*</span><span class="n">font_mod</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="n">r</span><span class="p">,</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;top&#39;</span><span class="p">)</span>
</span><span id="L-1837"><a href="#L-1837"><span class="linenos">1837</span></a>                            <span class="c1"># set a y axis label for the first column</span>
</span><span id="L-1838"><a href="#L-1838"><span class="linenos">1838</span></a>                            <span class="n">ax</span><span class="p">[</span><span class="n">r</span><span class="p">,</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;# Employees&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="o">*</span><span class="n">font_mod</span><span class="p">)</span>
</span><span id="L-1839"><a href="#L-1839"><span class="linenos">1839</span></a>                        <span class="k">if</span> <span class="n">r</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
</span><span id="L-1840"><a href="#L-1840"><span class="linenos">1840</span></a>                            <span class="n">ax</span><span class="p">[</span><span class="n">r</span><span class="p">,</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Employee Time Cost ($ USD)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="o">*</span><span class="n">font_mod</span><span class="p">)</span>
</span><span id="L-1841"><a href="#L-1841"><span class="linenos">1841</span></a>
</span><span id="L-1842"><a href="#L-1842"><span class="linenos">1842</span></a>                <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">(</span><span class="n">pad</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
</span><span id="L-1843"><a href="#L-1843"><span class="linenos">1843</span></a>                <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">plots_dir</span><span class="o">+</span><span class="s2">&quot;/&quot;</span><span class="o">+</span><span class="n">key</span><span class="o">+</span><span class="s2">&quot;.png&quot;</span><span class="p">)</span>
</span><span id="L-1844"><a href="#L-1844"><span class="linenos">1844</span></a>                <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>  
</span><span id="L-1845"><a href="#L-1845"><span class="linenos">1845</span></a>
</span><span id="L-1846"><a href="#L-1846"><span class="linenos">1846</span></a>
</span><span id="L-1847"><a href="#L-1847"><span class="linenos">1847</span></a>        <span class="c1">############################################################################################################</span>
</span><span id="L-1848"><a href="#L-1848"><span class="linenos">1848</span></a>        <span class="c1"># GRAPH:</span>
</span><span id="L-1849"><a href="#L-1849"><span class="linenos">1849</span></a>        <span class="c1">## Total Commute Cost Analysis</span>
</span><span id="L-1850"><a href="#L-1850"><span class="linenos">1850</span></a>        <span class="n">key</span> <span class="o">=</span> <span class="s1">&#39;tcca&#39;</span>
</span><span id="L-1851"><a href="#L-1851"><span class="linenos">1851</span></a>        <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;Total Commute Cost Analysis&quot;</span>
</span><span id="L-1852"><a href="#L-1852"><span class="linenos">1852</span></a>        <span class="n">short_title</span> <span class="o">=</span> <span class="n">title</span>
</span><span id="L-1853"><a href="#L-1853"><span class="linenos">1853</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">graph_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="p">{</span><span class="s2">&quot;GRAPH&quot;</span><span class="p">:</span> <span class="n">key</span><span class="p">,</span>
</span><span id="L-1854"><a href="#L-1854"><span class="linenos">1854</span></a>                                <span class="s2">&quot;TITLE&quot;</span><span class="p">:</span> <span class="n">short_title</span><span class="p">,</span>
</span><span id="L-1855"><a href="#L-1855"><span class="linenos">1855</span></a>                                <span class="s2">&quot;FILENAME&quot;</span><span class="p">:</span> <span class="n">key</span><span class="o">+</span><span class="s2">&quot;.png&quot;</span><span class="p">,</span>
</span><span id="L-1856"><a href="#L-1856"><span class="linenos">1856</span></a>                                <span class="s2">&quot;PLOT-DESCRIPTION&quot;</span><span class="p">:</span>  <span class="s2">&quot;This graph shows the total commute cost incurred by employees based upon mileage &quot;</span> <span class="o">+</span> \
</span><span id="L-1857"><a href="#L-1857"><span class="linenos">1857</span></a>                                <span class="s2">&quot; and the average and high/conservative cost of employee time commuting to each office.&quot;</span> <span class="o">+</span> \
</span><span id="L-1858"><a href="#L-1858"><span class="linenos">1858</span></a>                                <span class="s2">&quot;The average cost is based upon the morning average and evening &quot;</span> <span class="o">+</span> \
</span><span id="L-1859"><a href="#L-1859"><span class="linenos">1859</span></a>                                <span class="s2">&quot;average commute times, while the high/conservative cost is based upon the highest morning maximum and evening values for &quot;</span> <span class="o">+</span> \
</span><span id="L-1860"><a href="#L-1860"><span class="linenos">1860</span></a>                                <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">commute_days_per_week</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; days per week.&quot;</span>
</span><span id="L-1861"><a href="#L-1861"><span class="linenos">1861</span></a>                                <span class="p">})</span>
</span><span id="L-1862"><a href="#L-1862"><span class="linenos">1862</span></a>        <span class="k">if</span> <span class="n">graph</span> <span class="o">==</span> <span class="s2">&quot;_all&quot;</span> <span class="ow">or</span> <span class="n">graph</span> <span class="o">==</span> <span class="n">key</span><span class="p">:</span>
</span><span id="L-1863"><a href="#L-1863"><span class="linenos">1863</span></a>            <span class="n">employee_costs_to_office</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-1864"><a href="#L-1864"><span class="linenos">1864</span></a>
</span><span id="L-1865"><a href="#L-1865"><span class="linenos">1865</span></a>            <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">offices</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>    
</span><span id="L-1866"><a href="#L-1866"><span class="linenos">1866</span></a>                <span class="n">office</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">to_frame</span><span class="p">()</span><span class="o">.</span><span class="n">T</span>
</span><span id="L-1867"><a href="#L-1867"><span class="linenos">1867</span></a>            
</span><span id="L-1868"><a href="#L-1868"><span class="linenos">1868</span></a>                <span class="c1"># get the needed commute values</span>
</span><span id="L-1869"><a href="#L-1869"><span class="linenos">1869</span></a>                <span class="n">values</span> <span class="o">=</span> <span class="n">commute_data</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span>
</span><span id="L-1870"><a href="#L-1870"><span class="linenos">1870</span></a>                
</span><span id="L-1871"><a href="#L-1871"><span class="linenos">1871</span></a>                <span class="n">mornings</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;m_morning_duration_in_traffic&#39;</span><span class="p">,</span><span class="s1">&#39;t_morning_duration_in_traffic&#39;</span><span class="p">,</span><span class="s1">&#39;w_morning_duration_in_traffic&#39;</span><span class="p">,</span><span class="s1">&#39;h_morning_duration_in_traffic&#39;</span><span class="p">,</span><span class="s1">&#39;f_morning_duration_in_traffic&#39;</span><span class="p">]</span>
</span><span id="L-1872"><a href="#L-1872"><span class="linenos">1872</span></a>                <span class="n">evenings</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;m_evening_duration_in_traffic&#39;</span><span class="p">,</span><span class="s1">&#39;t_evening_duration_in_traffic&#39;</span><span class="p">,</span><span class="s1">&#39;w_evening_duration_in_traffic&#39;</span><span class="p">,</span><span class="s1">&#39;h_evening_duration_in_traffic&#39;</span><span class="p">,</span><span class="s1">&#39;f_evening_duration_in_traffic&#39;</span><span class="p">]</span>
</span><span id="L-1873"><a href="#L-1873"><span class="linenos">1873</span></a>                
</span><span id="L-1874"><a href="#L-1874"><span class="linenos">1874</span></a>                <span class="n">cdpw</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">commute_days_per_week</span>
</span><span id="L-1875"><a href="#L-1875"><span class="linenos">1875</span></a>
</span><span id="L-1876"><a href="#L-1876"><span class="linenos">1876</span></a>                <span class="n">emp_within</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graphing</span><span class="o">.</span><span class="n">filter_drive_distance</span><span class="p">(</span><span class="n">emp</span><span class="p">,</span><span class="n">office</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">commute_range_cut_off</span><span class="p">,</span> <span class="n">commute_data</span><span class="o">=</span><span class="n">commute_data</span><span class="p">)</span>
</span><span id="L-1877"><a href="#L-1877"><span class="linenos">1877</span></a>                <span class="n">val_set</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graphing</span><span class="o">.</span><span class="n">get_commute_values</span><span class="p">(</span><span class="n">emp_within</span><span class="p">,</span> <span class="n">office</span><span class="p">,</span> <span class="n">commute_data</span><span class="p">,</span> <span class="n">values</span><span class="p">)</span>
</span><span id="L-1878"><a href="#L-1878"><span class="linenos">1878</span></a>                
</span><span id="L-1879"><a href="#L-1879"><span class="linenos">1879</span></a>                
</span><span id="L-1880"><a href="#L-1880"><span class="linenos">1880</span></a>
</span><span id="L-1881"><a href="#L-1881"><span class="linenos">1881</span></a>                <span class="c1"># Calculate and insert the average morning and evening commute times directly into val_set</span>
</span><span id="L-1882"><a href="#L-1882"><span class="linenos">1882</span></a>                <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;Morning Average&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">val_set</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">mornings</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="L-1883"><a href="#L-1883"><span class="linenos">1883</span></a>                <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;Evening Average&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">val_set</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">evenings</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="L-1884"><a href="#L-1884"><span class="linenos">1884</span></a>
</span><span id="L-1885"><a href="#L-1885"><span class="linenos">1885</span></a>                <span class="c1"># Calculate and insert the top &#39;cdpw&#39; maximum morning and evening commute times</span>
</span><span id="L-1886"><a href="#L-1886"><span class="linenos">1886</span></a>                <span class="c1"># Note: Adjust the code below to calculate the averages of the top &#39;cdpw&#39; as new columns directly</span>
</span><span id="L-1887"><a href="#L-1887"><span class="linenos">1887</span></a>                <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;Average Top CDPW Morning&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">val_set</span><span class="p">[</span><span class="n">mornings</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="n">row</span><span class="o">.</span><span class="n">nlargest</span><span class="p">(</span><span class="n">cdpw</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="L-1888"><a href="#L-1888"><span class="linenos">1888</span></a>                <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;Average Top CDPW Evening&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">val_set</span><span class="p">[</span><span class="n">evenings</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="n">row</span><span class="o">.</span><span class="n">nlargest</span><span class="p">(</span><span class="n">cdpw</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="L-1889"><a href="#L-1889"><span class="linenos">1889</span></a>
</span><span id="L-1890"><a href="#L-1890"><span class="linenos">1890</span></a>                <span class="c1"># Calculate a per-minute cost based on &quot;median_salary&quot; and &quot;hours_per_year&quot;</span>
</span><span id="L-1891"><a href="#L-1891"><span class="linenos">1891</span></a>                <span class="n">per_minute_cost</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">median_salary</span> <span class="o">/</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">hours_per_year</span> <span class="o">*</span> <span class="mi">60</span><span class="p">)</span>
</span><span id="L-1892"><a href="#L-1892"><span class="linenos">1892</span></a>
</span><span id="L-1893"><a href="#L-1893"><span class="linenos">1893</span></a>                <span class="c1"># Calculate and insert the average cost for the week directly into val_set</span>
</span><span id="L-1894"><a href="#L-1894"><span class="linenos">1894</span></a>                <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;Morning Average Cost&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;Morning Average&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">per_minute_cost</span>
</span><span id="L-1895"><a href="#L-1895"><span class="linenos">1895</span></a>                <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;Evening Average Cost&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;Evening Average&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">per_minute_cost</span>
</span><span id="L-1896"><a href="#L-1896"><span class="linenos">1896</span></a>
</span><span id="L-1897"><a href="#L-1897"><span class="linenos">1897</span></a>                <span class="c1"># Calculate and insert the high/conservative cost for the week directly into val_set</span>
</span><span id="L-1898"><a href="#L-1898"><span class="linenos">1898</span></a>                <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;Morning High Cost&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;Average Top CDPW Morning&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">per_minute_cost</span>
</span><span id="L-1899"><a href="#L-1899"><span class="linenos">1899</span></a>                <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;Evening High Cost&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;Average Top CDPW Evening&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">per_minute_cost</span>
</span><span id="L-1900"><a href="#L-1900"><span class="linenos">1900</span></a>
</span><span id="L-1901"><a href="#L-1901"><span class="linenos">1901</span></a>                <span class="c1"># Calculate a Total Average Time and Total High Time cost</span>
</span><span id="L-1902"><a href="#L-1902"><span class="linenos">1902</span></a>                <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;Total Average Time Cost&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;Morning Average Cost&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;Evening Average Cost&#39;</span><span class="p">]</span>
</span><span id="L-1903"><a href="#L-1903"><span class="linenos">1903</span></a>                <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;Total High Time Cost&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;Morning High Cost&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;Evening High Cost&#39;</span><span class="p">]</span>
</span><span id="L-1904"><a href="#L-1904"><span class="linenos">1904</span></a>
</span><span id="L-1905"><a href="#L-1905"><span class="linenos">1905</span></a>                <span class="c1"># Calculate a Total Average Cost and Total High Cost</span>
</span><span id="L-1906"><a href="#L-1906"><span class="linenos">1906</span></a>                <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;Total Average Cost&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;Total Average Time Cost&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;commute_cost&#39;</span><span class="p">]</span>
</span><span id="L-1907"><a href="#L-1907"><span class="linenos">1907</span></a>                <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;Total High Cost&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;Total High Time Cost&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;commute_cost&#39;</span><span class="p">]</span>
</span><span id="L-1908"><a href="#L-1908"><span class="linenos">1908</span></a>                
</span><span id="L-1909"><a href="#L-1909"><span class="linenos">1909</span></a>                <span class="c1"># add the current val_set to the employee_costs_to_office dictionary</span>
</span><span id="L-1910"><a href="#L-1910"><span class="linenos">1910</span></a>                <span class="n">employee_costs_to_office</span><span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;address&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">val_set</span>
</span><span id="L-1911"><a href="#L-1911"><span class="linenos">1911</span></a>
</span><span id="L-1912"><a href="#L-1912"><span class="linenos">1912</span></a>            <span class="n">dvalues</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Total Average Cost&#39;</span><span class="p">,</span><span class="s1">&#39;Total High Cost&#39;</span><span class="p">]</span>
</span><span id="L-1913"><a href="#L-1913"><span class="linenos">1913</span></a>            <span class="n">bins</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-1914"><a href="#L-1914"><span class="linenos">1914</span></a>
</span><span id="L-1915"><a href="#L-1915"><span class="linenos">1915</span></a>            <span class="c1"># now iterate through again to get bins</span>
</span><span id="L-1916"><a href="#L-1916"><span class="linenos">1916</span></a>            <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">offices</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
</span><span id="L-1917"><a href="#L-1917"><span class="linenos">1917</span></a>                <span class="c1"># create bins based on the max value of the Total Average Cost and Total High Cost data for each office, get the max value for bins</span>
</span><span id="L-1918"><a href="#L-1918"><span class="linenos">1918</span></a>                <span class="n">binmax</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-1919"><a href="#L-1919"><span class="linenos">1919</span></a>                <span class="k">for</span> <span class="n">each</span> <span class="ow">in</span> <span class="n">dvalues</span><span class="p">:</span>
</span><span id="L-1920"><a href="#L-1920"><span class="linenos">1920</span></a>                    <span class="k">if</span> <span class="nb">max</span><span class="p">(</span><span class="n">employee_costs_to_office</span><span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;address&#39;</span><span class="p">]][</span><span class="n">each</span><span class="p">])</span> <span class="o">&gt;</span> <span class="n">binmax</span><span class="p">:</span>
</span><span id="L-1921"><a href="#L-1921"><span class="linenos">1921</span></a>                        <span class="n">binmax</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">employee_costs_to_office</span><span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;address&#39;</span><span class="p">]][</span><span class="n">each</span><span class="p">])</span>
</span><span id="L-1922"><a href="#L-1922"><span class="linenos">1922</span></a>                <span class="n">step</span> <span class="o">=</span> <span class="mi">5</span>
</span><span id="L-1923"><a href="#L-1923"><span class="linenos">1923</span></a>
</span><span id="L-1924"><a href="#L-1924"><span class="linenos">1924</span></a>            <span class="c1"># round the binmax up to the nearest step</span>
</span><span id="L-1925"><a href="#L-1925"><span class="linenos">1925</span></a>            <span class="n">bins</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">binmax</span> <span class="o">+</span> <span class="n">step</span> <span class="o">-</span> <span class="p">(</span><span class="n">binmax</span> <span class="o">%</span> <span class="n">step</span><span class="p">)),</span> <span class="n">step</span><span class="p">)</span>
</span><span id="L-1926"><a href="#L-1926"><span class="linenos">1926</span></a>            
</span><span id="L-1927"><a href="#L-1927"><span class="linenos">1927</span></a>            <span class="n">font_mod</span> <span class="o">=</span> <span class="mf">1.5</span>
</span><span id="L-1928"><a href="#L-1928"><span class="linenos">1928</span></a>            
</span><span id="L-1929"><a href="#L-1929"><span class="linenos">1929</span></a>            <span class="c1"># create histograms for the morning and evening average costs</span>
</span><span id="L-1930"><a href="#L-1930"><span class="linenos">1930</span></a>            <span class="n">plt</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graphing</span><span class="o">.</span><span class="n">get_histogram</span><span class="p">(</span><span class="n">emp</span><span class="p">,</span> <span class="n">office</span><span class="p">,</span> <span class="n">commute_data</span><span class="p">,</span> <span class="n">dvalues</span><span class="p">,</span> 
</span><span id="L-1931"><a href="#L-1931"><span class="linenos">1931</span></a>                                                    <span class="n">suptitle</span><span class="o">=</span><span class="s2">&quot;Total Employee Commute Costs per Day&quot;</span><span class="p">,</span><span class="n">cutoff_radius</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">commute_range_cut_off</span><span class="p">,</span>
</span><span id="L-1932"><a href="#L-1932"><span class="linenos">1932</span></a>                                    <span class="n">x_label</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="s1">&#39;\$ (USD)&#39;</span><span class="p">),</span> <span class="n">y_label</span><span class="o">=</span><span class="s1">&#39;# Employees&#39;</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="n">bins</span><span class="p">,</span> <span class="n">rows</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">employee_costs_to_office</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span> <span class="n">cols</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> 
</span><span id="L-1933"><a href="#L-1933"><span class="linenos">1933</span></a>                                    <span class="n">column_titles</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Average&quot;</span><span class="p">,</span><span class="s2">&quot;High/Conservative&quot;</span><span class="p">],</span> <span class="n">cumulative_line</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">font_mod</span><span class="o">=</span><span class="n">font_mod</span><span class="p">,</span> <span class="n">manual_plot</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> 
</span><span id="L-1934"><a href="#L-1934"><span class="linenos">1934</span></a>                                    <span class="n">sharey</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">override_values</span><span class="o">=</span><span class="n">employee_costs_to_office</span><span class="p">)</span>
</span><span id="L-1935"><a href="#L-1935"><span class="linenos">1935</span></a>            
</span><span id="L-1936"><a href="#L-1936"><span class="linenos">1936</span></a>            <span class="c1"># manually add histograms for each office option</span>
</span><span id="L-1937"><a href="#L-1937"><span class="linenos">1937</span></a>            <span class="n">keys</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">employee_costs_to_office</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
</span><span id="L-1938"><a href="#L-1938"><span class="linenos">1938</span></a>            <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">keys</span><span class="p">)):</span>
</span><span id="L-1939"><a href="#L-1939"><span class="linenos">1939</span></a>                <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dvalues</span><span class="p">)):</span>
</span><span id="L-1940"><a href="#L-1940"><span class="linenos">1940</span></a>                    <span class="n">ax</span><span class="p">[</span><span class="n">r</span><span class="p">,</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">employee_costs_to_office</span><span class="p">[</span><span class="n">keys</span><span class="p">[</span><span class="n">r</span><span class="p">]][</span><span class="n">dvalues</span><span class="p">[</span><span class="n">c</span><span class="p">]],</span> <span class="n">bins</span><span class="o">=</span><span class="n">bins</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;#555555&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> 
</span><span id="L-1941"><a href="#L-1941"><span class="linenos">1941</span></a>                                 <span class="n">zorder</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">align</span><span class="o">=</span><span class="s1">&#39;mid&#39;</span><span class="p">,</span> <span class="n">rwidth</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">dvalues</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">(</span><span class="n">r</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>
</span><span id="L-1942"><a href="#L-1942"><span class="linenos">1942</span></a>                    <span class="n">ax</span><span class="p">[</span><span class="n">r</span><span class="p">,</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;major&#39;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
</span><span id="L-1943"><a href="#L-1943"><span class="linenos">1943</span></a>
</span><span id="L-1944"><a href="#L-1944"><span class="linenos">1944</span></a>                    <span class="c1"># add a text box in the upper right corner with the stats</span>
</span><span id="L-1945"><a href="#L-1945"><span class="linenos">1945</span></a>                    <span class="n">t</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;me&#39;</span> <span class="p">:</span> <span class="s1">&#39;Median: |$</span><span class="si">{:,.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">employee_costs_to_office</span><span class="p">[</span><span class="n">keys</span><span class="p">[</span><span class="n">r</span><span class="p">]][</span><span class="n">dvalues</span><span class="p">[</span><span class="n">c</span><span class="p">]])),</span>
</span><span id="L-1946"><a href="#L-1946"><span class="linenos">1946</span></a>                        <span class="s1">&#39;av&#39;</span> <span class="p">:</span> <span class="s1">&#39;Average: |$</span><span class="si">{:,.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">employee_costs_to_office</span><span class="p">[</span><span class="n">keys</span><span class="p">[</span><span class="n">r</span><span class="p">]][</span><span class="n">dvalues</span><span class="p">[</span><span class="n">c</span><span class="p">]])),</span>
</span><span id="L-1947"><a href="#L-1947"><span class="linenos">1947</span></a>                        <span class="s1">&#39;mi&#39;</span> <span class="p">:</span> <span class="s1">&#39;Min: |$</span><span class="si">{:,.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">employee_costs_to_office</span><span class="p">[</span><span class="n">keys</span><span class="p">[</span><span class="n">r</span><span class="p">]][</span><span class="n">dvalues</span><span class="p">[</span><span class="n">c</span><span class="p">]])),</span>
</span><span id="L-1948"><a href="#L-1948"><span class="linenos">1948</span></a>                        <span class="s1">&#39;ma&#39;</span> <span class="p">:</span> <span class="s1">&#39;Max: |$</span><span class="si">{:,.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">employee_costs_to_office</span><span class="p">[</span><span class="n">keys</span><span class="p">[</span><span class="n">r</span><span class="p">]][</span><span class="n">dvalues</span><span class="p">[</span><span class="n">c</span><span class="p">]])),</span>
</span><span id="L-1949"><a href="#L-1949"><span class="linenos">1949</span></a>                        <span class="s1">&#39;to&#39;</span> <span class="p">:</span> <span class="s1">&#39;Total: |$</span><span class="si">{:,.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">employee_costs_to_office</span><span class="p">[</span><span class="n">keys</span><span class="p">[</span><span class="n">r</span><span class="p">]][</span><span class="n">dvalues</span><span class="p">[</span><span class="n">c</span><span class="p">]])),</span>
</span><span id="L-1950"><a href="#L-1950"><span class="linenos">1950</span></a>                        <span class="s1">&#39;co&#39;</span> <span class="p">:</span> <span class="s1">&#39;Count: |</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">employee_costs_to_office</span><span class="p">[</span><span class="n">keys</span><span class="p">[</span><span class="n">r</span><span class="p">]][</span><span class="n">dvalues</span><span class="p">[</span><span class="n">c</span><span class="p">]]))</span>
</span><span id="L-1951"><a href="#L-1951"><span class="linenos">1951</span></a>                        <span class="p">}</span>
</span><span id="L-1952"><a href="#L-1952"><span class="linenos">1952</span></a>                    <span class="c1"># get the longest string value</span>
</span><span id="L-1953"><a href="#L-1953"><span class="linenos">1953</span></a>                    <span class="n">max_len</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="s1">&#39;me&#39;</span><span class="p">]),</span><span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="s1">&#39;av&#39;</span><span class="p">]),</span><span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="s1">&#39;to&#39;</span><span class="p">]),</span><span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="s1">&#39;mi&#39;</span><span class="p">]),</span><span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="s1">&#39;ma&#39;</span><span class="p">]),</span><span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="s1">&#39;co&#39;</span><span class="p">]))</span>
</span><span id="L-1954"><a href="#L-1954"><span class="linenos">1954</span></a>                    <span class="c1"># calculate additional space</span>
</span><span id="L-1955"><a href="#L-1955"><span class="linenos">1955</span></a>                    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">t</span><span class="p">:</span>
</span><span id="L-1956"><a href="#L-1956"><span class="linenos">1956</span></a>                        <span class="n">t</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">t</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">,</span><span class="s2">&quot; &quot;</span><span class="o">*</span><span class="p">(</span><span class="n">max_len</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="n">k</span><span class="p">])))</span>
</span><span id="L-1957"><a href="#L-1957"><span class="linenos">1957</span></a>                    <span class="c1"># add spaces to make all the same length, replacing |</span>
</span><span id="L-1958"><a href="#L-1958"><span class="linenos">1958</span></a>                    <span class="n">textstr</span> <span class="o">=</span> <span class="s2">&quot;Employee Commute </span><span class="se">\n</span><span class="s2"> Cost per Day: &quot;</span>
</span><span id="L-1959"><a href="#L-1959"><span class="linenos">1959</span></a>                    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">t</span><span class="p">:</span>
</span><span id="L-1960"><a href="#L-1960"><span class="linenos">1960</span></a>                        <span class="n">textstr</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">t</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
</span><span id="L-1961"><a href="#L-1961"><span class="linenos">1961</span></a>                    <span class="c1"># these are matplotlib.patch.Patch properties</span>
</span><span id="L-1962"><a href="#L-1962"><span class="linenos">1962</span></a>                    <span class="n">props</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">boxstyle</span><span class="o">=</span><span class="s1">&#39;round&#39;</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;wheat&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
</span><span id="L-1963"><a href="#L-1963"><span class="linenos">1963</span></a>                    <span class="c1"># place a text box in upper right in axes coords,</span>
</span><span id="L-1964"><a href="#L-1964"><span class="linenos">1964</span></a>                    <span class="n">ax</span><span class="p">[</span><span class="n">r</span><span class="p">,</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">.95</span><span class="p">,</span> <span class="mf">.7</span><span class="p">,</span> <span class="n">textstr</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="n">r</span><span class="p">,</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">,</span>
</span><span id="L-1965"><a href="#L-1965"><span class="linenos">1965</span></a>                                <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">bbox</span><span class="o">=</span><span class="n">props</span><span class="p">,</span> <span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;family&#39;</span><span class="p">:</span> <span class="s1">&#39;monospace&#39;</span><span class="p">},</span> <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">)</span>
</span><span id="L-1966"><a href="#L-1966"><span class="linenos">1966</span></a>                    
</span><span id="L-1967"><a href="#L-1967"><span class="linenos">1967</span></a>                    <span class="c1"># add the address to the top left of the plot</span>
</span><span id="L-1968"><a href="#L-1968"><span class="linenos">1968</span></a>                    <span class="k">if</span> <span class="n">c</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
</span><span id="L-1969"><a href="#L-1969"><span class="linenos">1969</span></a>                        <span class="n">ax</span><span class="p">[</span><span class="n">r</span><span class="p">,</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.02</span><span class="p">,</span> <span class="mf">0.98</span><span class="p">,</span> <span class="n">keys</span><span class="p">[</span><span class="n">r</span><span class="p">],</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="o">*</span><span class="n">font_mod</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="n">r</span><span class="p">,</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;top&#39;</span><span class="p">)</span>
</span><span id="L-1970"><a href="#L-1970"><span class="linenos">1970</span></a>
</span><span id="L-1971"><a href="#L-1971"><span class="linenos">1971</span></a>                    <span class="c1"># for the first column, add morning/evening text box the top left of the plot</span>
</span><span id="L-1972"><a href="#L-1972"><span class="linenos">1972</span></a>                    <span class="k">if</span> <span class="n">r</span><span class="o">==</span><span class="nb">len</span><span class="p">(</span><span class="n">employee_costs_to_office</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span>
</span><span id="L-1973"><a href="#L-1973"><span class="linenos">1973</span></a>                        <span class="n">ax</span><span class="p">[</span><span class="n">r</span><span class="p">,</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Employee Total Cost ($ USD / Day)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="o">*</span><span class="n">font_mod</span><span class="p">)</span>                        
</span><span id="L-1974"><a href="#L-1974"><span class="linenos">1974</span></a>             
</span><span id="L-1975"><a href="#L-1975"><span class="linenos">1975</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">(</span><span class="n">pad</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
</span><span id="L-1976"><a href="#L-1976"><span class="linenos">1976</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">plots_dir</span><span class="o">+</span><span class="s2">&quot;/&quot;</span><span class="o">+</span><span class="n">key</span><span class="o">+</span><span class="s2">&quot;.png&quot;</span><span class="p">)</span>
</span><span id="L-1977"><a href="#L-1977"><span class="linenos">1977</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span> 
</span><span id="L-1978"><a href="#L-1978"><span class="linenos">1978</span></a>
</span><span id="L-1979"><a href="#L-1979"><span class="linenos">1979</span></a>        <span class="c1">################################################################################ </span>
</span><span id="L-1980"><a href="#L-1980"><span class="linenos">1980</span></a>        <span class="c1"># GRAPH: </span>
</span><span id="L-1981"><a href="#L-1981"><span class="linenos">1981</span></a>        <span class="c1">## Total Employee Commute Cost Differential Analysis</span>
</span><span id="L-1982"><a href="#L-1982"><span class="linenos">1982</span></a>        <span class="n">key</span> <span class="o">=</span> <span class="s1">&#39;teccda&#39;</span>
</span><span id="L-1983"><a href="#L-1983"><span class="linenos">1983</span></a>        <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;Total Employee Commute Cost Differential Analysis&quot;</span>
</span><span id="L-1984"><a href="#L-1984"><span class="linenos">1984</span></a>        <span class="n">short_title</span> <span class="o">=</span> <span class="n">title</span>
</span><span id="L-1985"><a href="#L-1985"><span class="linenos">1985</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">graph_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="p">{</span><span class="s2">&quot;GRAPH&quot;</span><span class="p">:</span> <span class="n">key</span><span class="p">,</span>
</span><span id="L-1986"><a href="#L-1986"><span class="linenos">1986</span></a>                                <span class="s2">&quot;TITLE&quot;</span><span class="p">:</span> <span class="n">short_title</span><span class="p">,</span>
</span><span id="L-1987"><a href="#L-1987"><span class="linenos">1987</span></a>                                <span class="s2">&quot;FILENAME&quot;</span><span class="p">:</span> <span class="n">key</span><span class="o">+</span><span class="s2">&quot;.png&quot;</span><span class="p">,</span>
</span><span id="L-1988"><a href="#L-1988"><span class="linenos">1988</span></a>                                <span class="s2">&quot;PLOT-DESCRIPTION&quot;</span><span class="p">:</span> <span class="s2">&quot;This graph displays the distribution of commute costs for employees within the &quot;</span> <span class="o">+</span> \
</span><span id="L-1989"><a href="#L-1989"><span class="linenos">1989</span></a>                                                    <span class="s2">&quot;cutoff distance of the office options. Changes in per-employee commute costs are shown for each office &quot;</span> <span class="o">+</span> \
</span><span id="L-1990"><a href="#L-1990"><span class="linenos">1990</span></a>                                                    <span class="s2">&quot;option relative to the existing office locaton.  This analysis inlcudes per mile costs (not including tolls, etc.) as well as  &quot;</span> <span class="o">+</span> \
</span><span id="L-1991"><a href="#L-1991"><span class="linenos">1991</span></a>                                                    <span class="s2">&quot;average and conservative costs due to cash equivalent for time.&quot;</span>
</span><span id="L-1992"><a href="#L-1992"><span class="linenos">1992</span></a>                                <span class="p">})</span>
</span><span id="L-1993"><a href="#L-1993"><span class="linenos">1993</span></a>        
</span><span id="L-1994"><a href="#L-1994"><span class="linenos">1994</span></a>        <span class="k">if</span> <span class="n">graph</span> <span class="o">==</span> <span class="s2">&quot;_all&quot;</span> <span class="ow">or</span> <span class="n">graph</span> <span class="o">==</span> <span class="n">key</span><span class="p">:</span>
</span><span id="L-1995"><a href="#L-1995"><span class="linenos">1995</span></a>            <span class="c1"># gather the data for the analysis</span>
</span><span id="L-1996"><a href="#L-1996"><span class="linenos">1996</span></a>            <span class="n">base_costs</span><span class="p">,</span> <span class="n">cost_values</span><span class="p">,</span> <span class="n">average_diffs</span><span class="p">,</span> <span class="n">conservative_diffs</span><span class="p">,</span> <span class="n">withins</span><span class="p">,</span> <span class="n">employee_costs_to_office</span><span class="p">,</span> <span class="n">current_office</span><span class="p">,</span> <span class="n">other_offices</span> <span class="o">=</span> \
</span><span id="L-1997"><a href="#L-1997"><span class="linenos">1997</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">get_attrition_analysis</span><span class="p">(</span><span class="n">emp</span><span class="p">,</span> <span class="n">offices</span><span class="p">,</span> <span class="n">commute_data</span><span class="p">)</span>
</span><span id="L-1998"><a href="#L-1998"><span class="linenos">1998</span></a>
</span><span id="L-1999"><a href="#L-1999"><span class="linenos">1999</span></a>
</span><span id="L-2000"><a href="#L-2000"><span class="linenos">2000</span></a>            <span class="c1"># now we have a list of dataframes with the differentials, we eliminate all rows with 0 cost differential to prevent skewing the histogram</span>
</span><span id="L-2001"><a href="#L-2001"><span class="linenos">2001</span></a>            <span class="c1"># calculate the bin list based upon a the min (negative) and max (positive) values of the data     </span>
</span><span id="L-2002"><a href="#L-2002"><span class="linenos">2002</span></a>            <span class="n">binmin</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-2003"><a href="#L-2003"><span class="linenos">2003</span></a>            <span class="n">binmax</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-2004"><a href="#L-2004"><span class="linenos">2004</span></a>            <span class="n">diffs</span> <span class="o">=</span> <span class="p">[</span><span class="n">average_diffs</span><span class="p">,</span> <span class="n">conservative_diffs</span><span class="p">]</span>
</span><span id="L-2005"><a href="#L-2005"><span class="linenos">2005</span></a>            <span class="k">for</span> <span class="n">diff</span> <span class="ow">in</span> <span class="n">diffs</span><span class="p">:</span>
</span><span id="L-2006"><a href="#L-2006"><span class="linenos">2006</span></a>                <span class="k">for</span> <span class="n">each</span> <span class="ow">in</span> <span class="n">diff</span><span class="p">:</span>
</span><span id="L-2007"><a href="#L-2007"><span class="linenos">2007</span></a>                    <span class="k">if</span> <span class="nb">min</span><span class="p">(</span><span class="n">each</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">binmin</span><span class="p">:</span>
</span><span id="L-2008"><a href="#L-2008"><span class="linenos">2008</span></a>                        <span class="n">binmin</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">each</span><span class="p">)</span>
</span><span id="L-2009"><a href="#L-2009"><span class="linenos">2009</span></a>                    <span class="k">if</span> <span class="nb">max</span><span class="p">(</span><span class="n">each</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">binmax</span><span class="p">:</span>
</span><span id="L-2010"><a href="#L-2010"><span class="linenos">2010</span></a>                        <span class="n">binmax</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">each</span><span class="p">)</span>
</span><span id="L-2011"><a href="#L-2011"><span class="linenos">2011</span></a>            <span class="n">step</span> <span class="o">=</span> <span class="mi">10</span> 
</span><span id="L-2012"><a href="#L-2012"><span class="linenos">2012</span></a>            <span class="c1"># round the binmin down to the nearest step, max up to the nearest step</span>
</span><span id="L-2013"><a href="#L-2013"><span class="linenos">2013</span></a>            <span class="n">bins</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">binmin</span> <span class="o">-</span> <span class="p">(</span><span class="n">binmin</span> <span class="o">%</span> <span class="n">step</span><span class="p">)),</span> <span class="nb">int</span><span class="p">(</span><span class="n">binmax</span> <span class="o">+</span> <span class="n">step</span> <span class="o">-</span> <span class="p">(</span><span class="n">binmax</span> <span class="o">%</span> <span class="n">step</span><span class="p">)),</span> <span class="n">step</span><span class="p">)</span>
</span><span id="L-2014"><a href="#L-2014"><span class="linenos">2014</span></a>            <span class="n">dvalues</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Total Average Cost&#39;</span><span class="p">,</span><span class="s1">&#39;Total High Cost&#39;</span><span class="p">]</span>
</span><span id="L-2015"><a href="#L-2015"><span class="linenos">2015</span></a>            
</span><span id="L-2016"><a href="#L-2016"><span class="linenos">2016</span></a>            <span class="n">plt</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graphing</span><span class="o">.</span><span class="n">get_histogram</span><span class="p">(</span><span class="n">emp</span><span class="p">,</span> <span class="n">other_offices</span><span class="p">,</span> <span class="n">cost_values</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="n">dvalues</span><span class="p">,</span> <span class="n">suptitle</span><span class="o">=</span><span class="s2">&quot;Total Employee Commute Cost Differential Analysis&quot;</span><span class="p">,</span> <span class="n">cutoff_radius</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">commute_range_cut_off</span><span class="p">,</span>
</span><span id="L-2017"><a href="#L-2017"><span class="linenos">2017</span></a>                                      <span class="n">x_label</span><span class="o">=</span><span class="s1">&#39;\$ (USD) based on time and mileage&#39;</span><span class="p">,</span> <span class="n">y_label</span><span class="o">=</span><span class="s1">&#39;# Employees (log scale)&#39;</span><span class="p">,</span>
</span><span id="L-2018"><a href="#L-2018"><span class="linenos">2018</span></a>                                      <span class="n">bins</span><span class="o">=</span><span class="n">bins</span><span class="p">,</span> <span class="n">rows</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">other_offices</span><span class="p">),</span> <span class="n">cols</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">column_titles</span><span class="o">=</span><span class="n">dvalues</span><span class="p">,</span> 
</span><span id="L-2019"><a href="#L-2019"><span class="linenos">2019</span></a>                                      <span class="n">cumulative_line</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">font_mod</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">manual_plot</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">override_values</span><span class="o">=</span><span class="n">cost_values</span><span class="p">)</span>
</span><span id="L-2020"><a href="#L-2020"><span class="linenos">2020</span></a>            
</span><span id="L-2021"><a href="#L-2021"><span class="linenos">2021</span></a>            <span class="c1"># calculate the $ value for turnover due to cost</span>
</span><span id="L-2022"><a href="#L-2022"><span class="linenos">2022</span></a>            <span class="n">median_salary</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">median_salary</span>
</span><span id="L-2023"><a href="#L-2023"><span class="linenos">2023</span></a>            <span class="n">threshold</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">turnover_threshold_due_to_cost</span><span class="o">*</span><span class="n">median_salary</span>
</span><span id="L-2024"><a href="#L-2024"><span class="linenos">2024</span></a>            <span class="n">daily_threshold</span> <span class="o">=</span> <span class="n">threshold</span><span class="o">/</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">commute_days_per_week</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">commute_weeks_per_year</span><span class="p">)</span>
</span><span id="L-2025"><a href="#L-2025"><span class="linenos">2025</span></a>                   
</span><span id="L-2026"><a href="#L-2026"><span class="linenos">2026</span></a>            <span class="c1"># manually add histograms for each office option</span>
</span><span id="L-2027"><a href="#L-2027"><span class="linenos">2027</span></a>            <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">other_offices</span><span class="p">)):</span>
</span><span id="L-2028"><a href="#L-2028"><span class="linenos">2028</span></a>                <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
</span><span id="L-2029"><a href="#L-2029"><span class="linenos">2029</span></a>                    <span class="n">ax</span><span class="p">[</span><span class="n">r</span><span class="p">,</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">average_diffs</span><span class="p">[</span><span class="n">r</span><span class="p">],</span> <span class="n">bins</span><span class="o">=</span><span class="n">bins</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;#555555&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">align</span><span class="o">=</span><span class="s1">&#39;mid&#39;</span><span class="p">,</span> 
</span><span id="L-2030"><a href="#L-2030"><span class="linenos">2030</span></a>                            <span class="n">rwidth</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">other_offices</span><span class="p">[</span><span class="s1">&#39;address&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="n">r</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">(</span><span class="n">r</span><span class="o">+</span><span class="mi">2</span><span class="p">),</span> <span class="n">log</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-2031"><a href="#L-2031"><span class="linenos">2031</span></a>                    <span class="n">ax</span><span class="p">[</span><span class="n">r</span><span class="p">,</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;major&#39;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
</span><span id="L-2032"><a href="#L-2032"><span class="linenos">2032</span></a>                    <span class="k">if</span> <span class="n">c</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-2033"><a href="#L-2033"><span class="linenos">2033</span></a>                        <span class="n">ax</span><span class="p">[</span><span class="n">r</span><span class="p">,</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;# Employees (log scale)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
</span><span id="L-2034"><a href="#L-2034"><span class="linenos">2034</span></a>                        <span class="c1"># put office address top left of the plot</span>
</span><span id="L-2035"><a href="#L-2035"><span class="linenos">2035</span></a>                        <span class="n">ax</span><span class="p">[</span><span class="n">r</span><span class="p">,</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.03</span><span class="p">,</span> <span class="mf">0.99</span><span class="p">,</span> <span class="n">other_offices</span><span class="p">[</span><span class="s1">&#39;address&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="n">r</span><span class="p">],</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="n">r</span><span class="p">,</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;top&#39;</span><span class="p">)</span>
</span><span id="L-2036"><a href="#L-2036"><span class="linenos">2036</span></a>                    
</span><span id="L-2037"><a href="#L-2037"><span class="linenos">2037</span></a>                    <span class="k">if</span> <span class="n">r</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">other_offices</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span>
</span><span id="L-2038"><a href="#L-2038"><span class="linenos">2038</span></a>                        <span class="n">ax</span><span class="p">[</span><span class="n">r</span><span class="p">,</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Employee Total Cost Differential ($ USD)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
</span><span id="L-2039"><a href="#L-2039"><span class="linenos">2039</span></a>                    <span class="n">ax</span><span class="p">[</span><span class="n">r</span><span class="p">,</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;major&#39;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
</span><span id="L-2040"><a href="#L-2040"><span class="linenos">2040</span></a>                    <span class="c1"># draw a red box with alpha 0.1 over the plot from x=daily_threshold to x=binmax, and y=0 to y max</span>
</span><span id="L-2041"><a href="#L-2041"><span class="linenos">2041</span></a>                    <span class="n">ax</span><span class="p">[</span><span class="n">r</span><span class="p">,</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">fill_between</span><span class="p">([</span><span class="n">daily_threshold</span><span class="p">,</span><span class="n">binmax</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="o">**</span><span class="mi">3</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
</span><span id="L-2042"><a href="#L-2042"><span class="linenos">2042</span></a>                    <span class="n">ax</span><span class="p">[</span><span class="n">r</span><span class="p">,</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">fill_between</span><span class="p">([</span><span class="n">daily_threshold</span><span class="p">,</span><span class="n">binmax</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="o">**</span><span class="mi">3</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
</span><span id="L-2043"><a href="#L-2043"><span class="linenos">2043</span></a>                    
</span><span id="L-2044"><a href="#L-2044"><span class="linenos">2044</span></a>                    <span class="n">above_threshold</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-2045"><a href="#L-2045"><span class="linenos">2045</span></a>                    <span class="n">cost_impact</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-2046"><a href="#L-2046"><span class="linenos">2046</span></a>                    <span class="c1"># cycle through the average diffs and get a count of costs above the threshold</span>
</span><span id="L-2047"><a href="#L-2047"><span class="linenos">2047</span></a>                    <span class="k">if</span> <span class="n">c</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-2048"><a href="#L-2048"><span class="linenos">2048</span></a>                        <span class="k">for</span> <span class="n">each</span> <span class="ow">in</span> <span class="n">average_diffs</span><span class="p">[</span><span class="n">r</span><span class="p">]:</span>
</span><span id="L-2049"><a href="#L-2049"><span class="linenos">2049</span></a>                            <span class="k">if</span> <span class="n">each</span> <span class="o">&gt;</span> <span class="n">daily_threshold</span><span class="p">:</span>
</span><span id="L-2050"><a href="#L-2050"><span class="linenos">2050</span></a>                                <span class="n">above_threshold</span> <span class="o">+=</span> <span class="mi">1</span>                        
</span><span id="L-2051"><a href="#L-2051"><span class="linenos">2051</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="L-2052"><a href="#L-2052"><span class="linenos">2052</span></a>                        <span class="k">for</span> <span class="n">each</span> <span class="ow">in</span> <span class="n">conservative_diffs</span><span class="p">[</span><span class="n">r</span><span class="p">]:</span>
</span><span id="L-2053"><a href="#L-2053"><span class="linenos">2053</span></a>                            <span class="k">if</span> <span class="n">each</span> <span class="o">&gt;</span> <span class="n">daily_threshold</span><span class="p">:</span>
</span><span id="L-2054"><a href="#L-2054"><span class="linenos">2054</span></a>                                <span class="n">above_threshold</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="L-2055"><a href="#L-2055"><span class="linenos">2055</span></a>
</span><span id="L-2056"><a href="#L-2056"><span class="linenos">2056</span></a>                    <span class="c1"># cost impact is the # above threshold * employee replacement cost * probability of turnover</span>
</span><span id="L-2057"><a href="#L-2057"><span class="linenos">2057</span></a>                    <span class="n">cost_impact</span> <span class="o">=</span> <span class="n">above_threshold</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">turnover_probability_time_cost</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">employee_replacement_cost</span>
</span><span id="L-2058"><a href="#L-2058"><span class="linenos">2058</span></a>                    <span class="c1"># add a text box with the count</span>
</span><span id="L-2059"><a href="#L-2059"><span class="linenos">2059</span></a>                    <span class="n">t</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;dt&#39;</span> <span class="p">:</span> <span class="s1">&#39;Cost Threshold (\$/day): |$</span><span class="si">{:,.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">daily_threshold</span><span class="p">),</span>
</span><span id="L-2060"><a href="#L-2060"><span class="linenos">2060</span></a>                         <span class="s1">&#39;co&#39;</span> <span class="p">:</span> <span class="s1">&#39;# &gt; Threshold (#): |</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">above_threshold</span><span class="p">),</span>
</span><span id="L-2061"><a href="#L-2061"><span class="linenos">2061</span></a>                         <span class="s1">&#39;ci&#39;</span> <span class="p">:</span> <span class="s1">&#39;Expected Cost (\$): |$</span><span class="si">{:,.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cost_impact</span><span class="p">)</span>                         
</span><span id="L-2062"><a href="#L-2062"><span class="linenos">2062</span></a>                        <span class="p">}</span>
</span><span id="L-2063"><a href="#L-2063"><span class="linenos">2063</span></a>                    <span class="c1"># get the longest string value</span>
</span><span id="L-2064"><a href="#L-2064"><span class="linenos">2064</span></a>                    <span class="n">max_len</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="s1">&#39;co&#39;</span><span class="p">]),</span><span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="s1">&#39;ci&#39;</span><span class="p">]),</span><span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="s1">&#39;dt&#39;</span><span class="p">]))</span>
</span><span id="L-2065"><a href="#L-2065"><span class="linenos">2065</span></a>                    <span class="c1"># calculate additional space</span>
</span><span id="L-2066"><a href="#L-2066"><span class="linenos">2066</span></a>                    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">t</span><span class="p">:</span>
</span><span id="L-2067"><a href="#L-2067"><span class="linenos">2067</span></a>                        <span class="n">t</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">t</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">,</span><span class="s2">&quot; &quot;</span><span class="o">*</span><span class="p">(</span><span class="n">max_len</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="n">k</span><span class="p">])))</span>
</span><span id="L-2068"><a href="#L-2068"><span class="linenos">2068</span></a>                        <span class="n">t</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">t</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;# &gt; Threshold (#): &quot;</span><span class="p">,</span><span class="s2">&quot;# &gt; Threshold (#):&quot;</span><span class="o">*</span><span class="p">(</span><span class="n">max_len</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="n">k</span><span class="p">])))</span>
</span><span id="L-2069"><a href="#L-2069"><span class="linenos">2069</span></a>                    <span class="c1"># add spaces to make all the same length, replacing |</span>
</span><span id="L-2070"><a href="#L-2070"><span class="linenos">2070</span></a>                    <span class="n">textstr</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="c1">#Employees above \n Threshold: &quot;</span>
</span><span id="L-2071"><a href="#L-2071"><span class="linenos">2071</span></a>                    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">t</span><span class="p">:</span>
</span><span id="L-2072"><a href="#L-2072"><span class="linenos">2072</span></a>                        <span class="n">textstr</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">t</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
</span><span id="L-2073"><a href="#L-2073"><span class="linenos">2073</span></a>                    <span class="c1"># these are matplotlib.patch.Patch properties</span>
</span><span id="L-2074"><a href="#L-2074"><span class="linenos">2074</span></a>                    <span class="n">props</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">boxstyle</span><span class="o">=</span><span class="s1">&#39;round&#39;</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;wheat&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
</span><span id="L-2075"><a href="#L-2075"><span class="linenos">2075</span></a>                    <span class="c1"># place a text box in upper right in axes coords,</span>
</span><span id="L-2076"><a href="#L-2076"><span class="linenos">2076</span></a>                    <span class="n">ax</span><span class="p">[</span><span class="n">r</span><span class="p">,</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">.03</span><span class="p">,</span> <span class="mf">.85</span><span class="p">,</span> <span class="n">textstr</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="n">r</span><span class="p">,</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">,</span>
</span><span id="L-2077"><a href="#L-2077"><span class="linenos">2077</span></a>                                <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">bbox</span><span class="o">=</span><span class="n">props</span><span class="p">,</span> <span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;family&#39;</span><span class="p">:</span> <span class="s1">&#39;monospace&#39;</span><span class="p">},</span> <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">)</span>
</span><span id="L-2078"><a href="#L-2078"><span class="linenos">2078</span></a>            
</span><span id="L-2079"><a href="#L-2079"><span class="linenos">2079</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">(</span><span class="n">pad</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
</span><span id="L-2080"><a href="#L-2080"><span class="linenos">2080</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">plots_dir</span><span class="o">+</span><span class="s2">&quot;/&quot;</span><span class="o">+</span><span class="n">key</span><span class="o">+</span><span class="s2">&quot;.png&quot;</span><span class="p">)</span>
</span><span id="L-2081"><a href="#L-2081"><span class="linenos">2081</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="L-2082"><a href="#L-2082"><span class="linenos">2082</span></a>
</span><span id="L-2083"><a href="#L-2083"><span class="linenos">2083</span></a>
</span><span id="L-2084"><a href="#L-2084"><span class="linenos">2084</span></a>        <span class="c1">################################################################################</span>
</span><span id="L-2085"><a href="#L-2085"><span class="linenos">2085</span></a>        <span class="c1">### GRAPH SET: Local Analysis for Office X</span>
</span><span id="L-2086"><a href="#L-2086"><span class="linenos">2086</span></a>        <span class="c1"># iterate through offices, generate a graph for each office</span>
</span><span id="L-2087"><a href="#L-2087"><span class="linenos">2087</span></a>        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">offices</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>    
</span><span id="L-2088"><a href="#L-2088"><span class="linenos">2088</span></a>            <span class="c1">################################################################################ </span>
</span><span id="L-2089"><a href="#L-2089"><span class="linenos">2089</span></a>            <span class="c1"># GRAPH: </span>
</span><span id="L-2090"><a href="#L-2090"><span class="linenos">2090</span></a>            <span class="c1">## Traffic Regime Analysis</span>
</span><span id="L-2091"><a href="#L-2091"><span class="linenos">2091</span></a>            <span class="n">key</span> <span class="o">=</span> <span class="s1">&#39;tra&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
</span><span id="L-2092"><a href="#L-2092"><span class="linenos">2092</span></a>            <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;Traffic Regime Analysis for &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;address&#39;</span><span class="p">])</span>
</span><span id="L-2093"><a href="#L-2093"><span class="linenos">2093</span></a>            <span class="n">short_title</span> <span class="o">=</span> <span class="n">title</span>
</span><span id="L-2094"><a href="#L-2094"><span class="linenos">2094</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">graph_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="p">{</span><span class="s2">&quot;GRAPH&quot;</span><span class="p">:</span> <span class="n">key</span><span class="p">,</span>
</span><span id="L-2095"><a href="#L-2095"><span class="linenos">2095</span></a>                                    <span class="s2">&quot;TITLE&quot;</span><span class="p">:</span> <span class="n">short_title</span><span class="p">,</span>
</span><span id="L-2096"><a href="#L-2096"><span class="linenos">2096</span></a>                                    <span class="s2">&quot;FILENAME&quot;</span><span class="p">:</span> <span class="n">key</span><span class="o">+</span><span class="s2">&quot;.png&quot;</span><span class="p">,</span>
</span><span id="L-2097"><a href="#L-2097"><span class="linenos">2097</span></a>                                    <span class="s2">&quot;PLOT-DESCRIPTION&quot;</span><span class="p">:</span> <span class="s2">&quot;This pie chart outlines the percentage of employees that are in each traffic regime for commute to &quot;</span> <span class="o">+</span> \
</span><span id="L-2098"><a href="#L-2098"><span class="linenos">2098</span></a>                                    <span class="nb">str</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;address&#39;</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot; for each day of the week.&quot;</span>
</span><span id="L-2099"><a href="#L-2099"><span class="linenos">2099</span></a>                                    <span class="p">})</span>
</span><span id="L-2100"><a href="#L-2100"><span class="linenos">2100</span></a>            
</span><span id="L-2101"><a href="#L-2101"><span class="linenos">2101</span></a>            <span class="k">if</span> <span class="n">graph</span> <span class="o">==</span> <span class="s2">&quot;_all&quot;</span> <span class="ow">or</span> <span class="n">graph</span> <span class="o">==</span> <span class="n">key</span><span class="p">:</span>
</span><span id="L-2102"><a href="#L-2102"><span class="linenos">2102</span></a>                
</span><span id="L-2103"><a href="#L-2103"><span class="linenos">2103</span></a>                <span class="n">office</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">to_frame</span><span class="p">()</span><span class="o">.</span><span class="n">T</span>
</span><span id="L-2104"><a href="#L-2104"><span class="linenos">2104</span></a>                
</span><span id="L-2105"><a href="#L-2105"><span class="linenos">2105</span></a>                <span class="c1"># get the needed commute values</span>
</span><span id="L-2106"><a href="#L-2106"><span class="linenos">2106</span></a>                <span class="n">values</span> <span class="o">=</span> <span class="n">commute_data</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span>
</span><span id="L-2107"><a href="#L-2107"><span class="linenos">2107</span></a>                <span class="c1"># filter teh employees to only those within the cutoff distance</span>
</span><span id="L-2108"><a href="#L-2108"><span class="linenos">2108</span></a>                <span class="n">emp_within</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graphing</span><span class="o">.</span><span class="n">filter_drive_distance</span><span class="p">(</span><span class="n">emp</span><span class="p">,</span><span class="n">office</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">commute_range_cut_off</span><span class="p">,</span> <span class="n">commute_data</span><span class="o">=</span><span class="n">commute_data</span><span class="p">)</span>
</span><span id="L-2109"><a href="#L-2109"><span class="linenos">2109</span></a>                <span class="n">val_set</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graphing</span><span class="o">.</span><span class="n">get_commute_values</span><span class="p">(</span><span class="n">emp_within</span><span class="p">,</span> <span class="n">office</span><span class="p">,</span> <span class="n">commute_data</span><span class="p">,</span> <span class="n">values</span><span class="p">)</span>
</span><span id="L-2110"><a href="#L-2110"><span class="linenos">2110</span></a>                <span class="c1"># restore val_set columns latitutde and longitude to origin_lat and origin_long</span>
</span><span id="L-2111"><a href="#L-2111"><span class="linenos">2111</span></a>                <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;origin_lat&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;latitude&#39;</span><span class="p">]</span>
</span><span id="L-2112"><a href="#L-2112"><span class="linenos">2112</span></a>                <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;origin_long&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;longitude&#39;</span><span class="p">]</span>
</span><span id="L-2113"><a href="#L-2113"><span class="linenos">2113</span></a>
</span><span id="L-2114"><a href="#L-2114"><span class="linenos">2114</span></a>                <span class="c1"># for each employee, for each day&#39;s morning and evening commute, get the traffic regime</span>
</span><span id="L-2115"><a href="#L-2115"><span class="linenos">2115</span></a>                <span class="c1"># add the traffic regime to the val_set dataframe</span>
</span><span id="L-2116"><a href="#L-2116"><span class="linenos">2116</span></a>                
</span><span id="L-2117"><a href="#L-2117"><span class="linenos">2117</span></a>                <span class="c1"># lambda to call get_traffic_regime(distance, duration_in_traffic) using distance and duration_in_traffic columns</span>
</span><span id="L-2118"><a href="#L-2118"><span class="linenos">2118</span></a>                <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;m_morning_traffic_regime&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">val_set</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_traffic_regime</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;miles&#39;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;m_morning_duration_in_traffic&#39;</span><span class="p">]),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="L-2119"><a href="#L-2119"><span class="linenos">2119</span></a>                <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;m_evening_traffic_regime&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">val_set</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_traffic_regime</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;miles&#39;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;m_evening_duration_in_traffic&#39;</span><span class="p">]),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="L-2120"><a href="#L-2120"><span class="linenos">2120</span></a>                <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;t_morning_traffic_regime&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">val_set</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_traffic_regime</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;miles&#39;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;t_morning_duration_in_traffic&#39;</span><span class="p">]),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="L-2121"><a href="#L-2121"><span class="linenos">2121</span></a>                <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;t_evening_traffic_regime&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">val_set</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_traffic_regime</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;miles&#39;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;t_evening_duration_in_traffic&#39;</span><span class="p">]),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="L-2122"><a href="#L-2122"><span class="linenos">2122</span></a>                <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;w_morning_traffic_regime&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">val_set</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_traffic_regime</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;miles&#39;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;w_morning_duration_in_traffic&#39;</span><span class="p">]),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="L-2123"><a href="#L-2123"><span class="linenos">2123</span></a>                <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;w_evening_traffic_regime&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">val_set</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_traffic_regime</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;miles&#39;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;w_evening_duration_in_traffic&#39;</span><span class="p">]),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="L-2124"><a href="#L-2124"><span class="linenos">2124</span></a>                <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;h_morning_traffic_regime&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">val_set</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_traffic_regime</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;miles&#39;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;h_morning_duration_in_traffic&#39;</span><span class="p">]),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="L-2125"><a href="#L-2125"><span class="linenos">2125</span></a>                <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;h_evening_traffic_regime&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">val_set</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_traffic_regime</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;miles&#39;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;h_evening_duration_in_traffic&#39;</span><span class="p">]),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="L-2126"><a href="#L-2126"><span class="linenos">2126</span></a>                <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;f_morning_traffic_regime&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">val_set</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_traffic_regime</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;miles&#39;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;f_morning_duration_in_traffic&#39;</span><span class="p">]),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="L-2127"><a href="#L-2127"><span class="linenos">2127</span></a>                <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;f_evening_traffic_regime&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">val_set</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_traffic_regime</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;miles&#39;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;f_evening_duration_in_traffic&#39;</span><span class="p">]),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="L-2128"><a href="#L-2128"><span class="linenos">2128</span></a>
</span><span id="L-2129"><a href="#L-2129"><span class="linenos">2129</span></a>                <span class="c1"># save val_set to file for debugging</span>
</span><span id="L-2130"><a href="#L-2130"><span class="linenos">2130</span></a>            
</span><span id="L-2131"><a href="#L-2131"><span class="linenos">2131</span></a>                <span class="c1"># get the counts of each traffic regime for each office</span>
</span><span id="L-2132"><a href="#L-2132"><span class="linenos">2132</span></a>                <span class="n">traffic_graph_keys</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;m_morning_traffic_regime&#39;</span><span class="p">,</span>
</span><span id="L-2133"><a href="#L-2133"><span class="linenos">2133</span></a>                                        <span class="s1">&#39;t_morning_traffic_regime&#39;</span><span class="p">,</span>
</span><span id="L-2134"><a href="#L-2134"><span class="linenos">2134</span></a>                                        <span class="s1">&#39;w_morning_traffic_regime&#39;</span><span class="p">,</span>
</span><span id="L-2135"><a href="#L-2135"><span class="linenos">2135</span></a>                                        <span class="s1">&#39;h_morning_traffic_regime&#39;</span><span class="p">,</span>
</span><span id="L-2136"><a href="#L-2136"><span class="linenos">2136</span></a>                                        <span class="s1">&#39;f_morning_traffic_regime&#39;</span><span class="p">,</span>
</span><span id="L-2137"><a href="#L-2137"><span class="linenos">2137</span></a>                                        <span class="s1">&#39;m_evening_traffic_regime&#39;</span><span class="p">,</span>
</span><span id="L-2138"><a href="#L-2138"><span class="linenos">2138</span></a>                                        <span class="s1">&#39;t_evening_traffic_regime&#39;</span><span class="p">,</span>
</span><span id="L-2139"><a href="#L-2139"><span class="linenos">2139</span></a>                                        <span class="s1">&#39;w_evening_traffic_regime&#39;</span><span class="p">,</span>
</span><span id="L-2140"><a href="#L-2140"><span class="linenos">2140</span></a>                                        <span class="s1">&#39;h_evening_traffic_regime&#39;</span><span class="p">,</span>
</span><span id="L-2141"><a href="#L-2141"><span class="linenos">2141</span></a>                                        <span class="s1">&#39;f_evening_traffic_regime&#39;</span><span class="p">]</span>
</span><span id="L-2142"><a href="#L-2142"><span class="linenos">2142</span></a>                
</span><span id="L-2143"><a href="#L-2143"><span class="linenos">2143</span></a>                <span class="n">traffic_graphs_nice_names</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;m_morning_traffic_regime&quot;</span><span class="p">:</span><span class="s2">&quot;Monday Morning&quot;</span><span class="p">,</span>
</span><span id="L-2144"><a href="#L-2144"><span class="linenos">2144</span></a>                                             <span class="s2">&quot;t_morning_traffic_regime&quot;</span><span class="p">:</span><span class="s2">&quot;Tuesday Morning&quot;</span><span class="p">,</span>
</span><span id="L-2145"><a href="#L-2145"><span class="linenos">2145</span></a>                                             <span class="s2">&quot;w_morning_traffic_regime&quot;</span><span class="p">:</span><span class="s2">&quot;Wednesday Morning&quot;</span><span class="p">,</span>
</span><span id="L-2146"><a href="#L-2146"><span class="linenos">2146</span></a>                                             <span class="s2">&quot;h_morning_traffic_regime&quot;</span><span class="p">:</span><span class="s2">&quot;Thursday Morning&quot;</span><span class="p">,</span>
</span><span id="L-2147"><a href="#L-2147"><span class="linenos">2147</span></a>                                             <span class="s2">&quot;f_morning_traffic_regime&quot;</span><span class="p">:</span><span class="s2">&quot;Friday Morning&quot;</span><span class="p">,</span>
</span><span id="L-2148"><a href="#L-2148"><span class="linenos">2148</span></a>                                             <span class="s2">&quot;m_evening_traffic_regime&quot;</span><span class="p">:</span><span class="s2">&quot;Monday Evening&quot;</span><span class="p">,</span>
</span><span id="L-2149"><a href="#L-2149"><span class="linenos">2149</span></a>                                             <span class="s2">&quot;t_evening_traffic_regime&quot;</span><span class="p">:</span><span class="s2">&quot;Tuesday Evening&quot;</span><span class="p">,</span>
</span><span id="L-2150"><a href="#L-2150"><span class="linenos">2150</span></a>                                             <span class="s2">&quot;w_evening_traffic_regime&quot;</span><span class="p">:</span><span class="s2">&quot;Wednesday Evening&quot;</span><span class="p">,</span>
</span><span id="L-2151"><a href="#L-2151"><span class="linenos">2151</span></a>                                             <span class="s2">&quot;h_evening_traffic_regime&quot;</span><span class="p">:</span><span class="s2">&quot;Thursday Evening&quot;</span><span class="p">,</span>
</span><span id="L-2152"><a href="#L-2152"><span class="linenos">2152</span></a>                                             <span class="s2">&quot;f_evening_traffic_regime&quot;</span><span class="p">:</span><span class="s2">&quot;Friday Evening&quot;</span><span class="p">}</span>
</span><span id="L-2153"><a href="#L-2153"><span class="linenos">2153</span></a>                
</span><span id="L-2154"><a href="#L-2154"><span class="linenos">2154</span></a>                <span class="n">traffic_regimes</span> <span class="o">=</span> <span class="p">{</span><span class="mi">1</span><span class="p">:</span><span class="s2">&quot;Congested&quot;</span><span class="p">,</span><span class="mi">2</span><span class="p">:</span><span class="s2">&quot;Bounded&quot;</span><span class="p">,</span><span class="mi">3</span><span class="p">:</span><span class="s2">&quot;Free Flow&quot;</span><span class="p">}</span>
</span><span id="L-2155"><a href="#L-2155"><span class="linenos">2155</span></a>
</span><span id="L-2156"><a href="#L-2156"><span class="linenos">2156</span></a>                <span class="c1"># create a dictionary to hold the traffic regime counts for each day and morning/evening</span>
</span><span id="L-2157"><a href="#L-2157"><span class="linenos">2157</span></a>                <span class="n">traffic_regime_counts</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-2158"><a href="#L-2158"><span class="linenos">2158</span></a>                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">traffic_graph_keys</span><span class="p">:</span>
</span><span id="L-2159"><a href="#L-2159"><span class="linenos">2159</span></a>                    <span class="n">traffic_regime_counts</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">val_set</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>
</span><span id="L-2160"><a href="#L-2160"><span class="linenos">2160</span></a>                    <span class="c1"># sort the dictionary by key</span>
</span><span id="L-2161"><a href="#L-2161"><span class="linenos">2161</span></a>                    <span class="n">traffic_regime_counts</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">traffic_regime_counts</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">()))</span>
</span><span id="L-2162"><a href="#L-2162"><span class="linenos">2162</span></a>
</span><span id="L-2163"><a href="#L-2163"><span class="linenos">2163</span></a>                <span class="c1"># traffic_regime_counts now holds: </span>
</span><span id="L-2164"><a href="#L-2164"><span class="linenos">2164</span></a>                <span class="c1"># {&#39;m_morning_traffic_regime&#39;: {1: 1539, 2: 424}, &#39;t_morning_traffic_regime&#39;: {1: 1863, 2: 100}, &#39;w_morning_traffic_regime&#39;: {1: 1874, 2: 89}, &#39;h_morning_traffic_regime&#39;: {1: 1824, 2: 139}, &#39;f_morning_traffic_regime&#39;: {1: 1348, 2: 615}, &#39;m_evening_traffic_regime&#39;: {1: 1711, 2: 252}, &#39;t_evening_traffic_regime&#39;: {1: 1826, 2: 137}, &#39;w_evening_traffic_regime&#39;: {1: 1888, 2: 75}, &#39;h_evening_traffic_regime&#39;: {1: 1878, 2: 85}, &#39;f_evening_traffic_regime&#39;: {1: 1704, 2: 259}}</span>
</span><span id="L-2165"><a href="#L-2165"><span class="linenos">2165</span></a>                
</span><span id="L-2166"><a href="#L-2166"><span class="linenos">2166</span></a>                <span class="c1"># create a values variable holding a list of the traffic regime counts for each day and morning/evening</span>
</span><span id="L-2167"><a href="#L-2167"><span class="linenos">2167</span></a>                <span class="n">values</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-2168"><a href="#L-2168"><span class="linenos">2168</span></a>                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">traffic_graph_keys</span><span class="p">:</span>
</span><span id="L-2169"><a href="#L-2169"><span class="linenos">2169</span></a>                    <span class="n">values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">traffic_regime_counts</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span>
</span><span id="L-2170"><a href="#L-2170"><span class="linenos">2170</span></a>
</span><span id="L-2171"><a href="#L-2171"><span class="linenos">2171</span></a>                <span class="c1"># iterate through traffic regime counts and create a list of labels for each day and morning/evening for regimes where counts are present</span>
</span><span id="L-2172"><a href="#L-2172"><span class="linenos">2172</span></a>                <span class="n">labels</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-2173"><a href="#L-2173"><span class="linenos">2173</span></a>                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">traffic_graph_keys</span><span class="p">:</span>
</span><span id="L-2174"><a href="#L-2174"><span class="linenos">2174</span></a>                    <span class="n">label</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-2175"><a href="#L-2175"><span class="linenos">2175</span></a>                    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">traffic_regime_counts</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
</span><span id="L-2176"><a href="#L-2176"><span class="linenos">2176</span></a>                        <span class="n">label</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">traffic_regimes</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
</span><span id="L-2177"><a href="#L-2177"><span class="linenos">2177</span></a>                    <span class="n">labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>
</span><span id="L-2178"><a href="#L-2178"><span class="linenos">2178</span></a>                
</span><span id="L-2179"><a href="#L-2179"><span class="linenos">2179</span></a>                <span class="c1"># iterate through the labels and get the colors for each traffic regime colors(i+1) will return a color for each regime</span>
</span><span id="L-2180"><a href="#L-2180"><span class="linenos">2180</span></a>                <span class="n">colors_list</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-2181"><a href="#L-2181"><span class="linenos">2181</span></a>                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">labels</span><span class="p">)):</span>
</span><span id="L-2182"><a href="#L-2182"><span class="linenos">2182</span></a>                    <span class="n">color_list</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-2183"><a href="#L-2183"><span class="linenos">2183</span></a>                    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">labels</span><span class="p">[</span><span class="n">i</span><span class="p">])):</span>
</span><span id="L-2184"><a href="#L-2184"><span class="linenos">2184</span></a>                        <span class="n">color_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">colors</span><span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="mi">7</span><span class="p">))</span>
</span><span id="L-2185"><a href="#L-2185"><span class="linenos">2185</span></a>                    <span class="n">colors_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">color_list</span><span class="p">)</span>
</span><span id="L-2186"><a href="#L-2186"><span class="linenos">2186</span></a>                
</span><span id="L-2187"><a href="#L-2187"><span class="linenos">2187</span></a>                <span class="c1"># create a titles variable holding a list of the traffic graph nice names</span>
</span><span id="L-2188"><a href="#L-2188"><span class="linenos">2188</span></a>                <span class="n">titles</span> <span class="o">=</span> <span class="p">[</span><span class="n">traffic_graphs_nice_names</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">traffic_graph_keys</span><span class="p">]</span>
</span><span id="L-2189"><a href="#L-2189"><span class="linenos">2189</span></a>                <span class="n">rows</span> <span class="o">=</span> <span class="mi">2</span>
</span><span id="L-2190"><a href="#L-2190"><span class="linenos">2190</span></a>                <span class="n">cols</span> <span class="o">=</span> <span class="mi">5</span>
</span><span id="L-2191"><a href="#L-2191"><span class="linenos">2191</span></a>                <span class="c1"># create a composite pie chart, five wide, with rows for morning and evening.  Each pie chart will display three values, Congested, Bounded, Free Flow</span>
</span><span id="L-2192"><a href="#L-2192"><span class="linenos">2192</span></a>                <span class="n">plt</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graphing</span><span class="o">.</span><span class="n">get_piechart</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="n">titles</span><span class="o">=</span><span class="n">titles</span><span class="p">,</span> <span class="n">suptitle</span><span class="o">=</span><span class="n">title</span><span class="p">,</span> <span class="n">value_labels</span><span class="o">=</span><span class="n">labels</span><span class="p">,</span> 
</span><span id="L-2193"><a href="#L-2193"><span class="linenos">2193</span></a>                                                    <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">21</span><span class="p">,</span><span class="mi">7</span><span class="p">),</span> <span class="n">manual_plot</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">font_mod</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">rows</span><span class="o">=</span><span class="n">rows</span><span class="p">,</span> <span class="n">cols</span><span class="o">=</span><span class="n">cols</span><span class="p">,</span> <span class="n">startangle</span><span class="o">=</span><span class="mi">70</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="n">colors_list</span><span class="p">)</span>
</span><span id="L-2194"><a href="#L-2194"><span class="linenos">2194</span></a>                <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">(</span><span class="n">pad</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">w_pad</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">h_pad</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="L-2195"><a href="#L-2195"><span class="linenos">2195</span></a>                <span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">top</span><span class="o">=</span><span class="mf">0.85</span><span class="p">)</span>
</span><span id="L-2196"><a href="#L-2196"><span class="linenos">2196</span></a>                <span class="c1"># mauanlly adjust the font size of suptitle and plot titles</span>
</span><span id="L-2197"><a href="#L-2197"><span class="linenos">2197</span></a>                <span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">25</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">)</span>
</span><span id="L-2198"><a href="#L-2198"><span class="linenos">2198</span></a>                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">rows</span><span class="p">):</span>
</span><span id="L-2199"><a href="#L-2199"><span class="linenos">2199</span></a>                    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">cols</span><span class="p">):</span>
</span><span id="L-2200"><a href="#L-2200"><span class="linenos">2200</span></a>                        <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">title</span><span class="o">.</span><span class="n">set_fontsize</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>
</span><span id="L-2201"><a href="#L-2201"><span class="linenos">2201</span></a>                        <span class="c1"># set bold</span>
</span><span id="L-2202"><a href="#L-2202"><span class="linenos">2202</span></a>                        <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">title</span><span class="o">.</span><span class="n">set_fontweight</span><span class="p">(</span><span class="s1">&#39;bold&#39;</span><span class="p">)</span>
</span><span id="L-2203"><a href="#L-2203"><span class="linenos">2203</span></a>                
</span><span id="L-2204"><a href="#L-2204"><span class="linenos">2204</span></a>                <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">plots_dir</span><span class="o">+</span><span class="s2">&quot;/&quot;</span><span class="o">+</span><span class="n">key</span><span class="o">+</span><span class="s2">&quot;.png&quot;</span><span class="p">)</span>
</span><span id="L-2205"><a href="#L-2205"><span class="linenos">2205</span></a>                <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="L-2206"><a href="#L-2206"><span class="linenos">2206</span></a>                
</span><span id="L-2207"><a href="#L-2207"><span class="linenos">2207</span></a>
</span><span id="L-2208"><a href="#L-2208"><span class="linenos">2208</span></a>        <span class="c1">################################################################################</span>
</span><span id="L-2209"><a href="#L-2209"><span class="linenos">2209</span></a>        <span class="c1">### GRAPH SET: Local Analysis for Office X</span>
</span><span id="L-2210"><a href="#L-2210"><span class="linenos">2210</span></a>        <span class="c1"># iterate through offices, generate a graph for each office</span>
</span><span id="L-2211"><a href="#L-2211"><span class="linenos">2211</span></a>        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">offices</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>    
</span><span id="L-2212"><a href="#L-2212"><span class="linenos">2212</span></a>            <span class="c1">################################################################################ </span>
</span><span id="L-2213"><a href="#L-2213"><span class="linenos">2213</span></a>            <span class="c1"># GRAPH: </span>
</span><span id="L-2214"><a href="#L-2214"><span class="linenos">2214</span></a>            <span class="c1">## Worst Case Emissions Rate Heat Map Analysis</span>
</span><span id="L-2215"><a href="#L-2215"><span class="linenos">2215</span></a>            <span class="n">key</span> <span class="o">=</span> <span class="s1">&#39;wcerhma&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
</span><span id="L-2216"><a href="#L-2216"><span class="linenos">2216</span></a>            <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;Worst Case Emissions Rate Heat Map Analysis for &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;address&#39;</span><span class="p">])</span>
</span><span id="L-2217"><a href="#L-2217"><span class="linenos">2217</span></a>            <span class="n">short_title</span> <span class="o">=</span> <span class="n">title</span>
</span><span id="L-2218"><a href="#L-2218"><span class="linenos">2218</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">graph_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="p">{</span><span class="s2">&quot;GRAPH&quot;</span><span class="p">:</span> <span class="n">key</span><span class="p">,</span>
</span><span id="L-2219"><a href="#L-2219"><span class="linenos">2219</span></a>                                    <span class="s2">&quot;TITLE&quot;</span><span class="p">:</span> <span class="n">short_title</span><span class="p">,</span>
</span><span id="L-2220"><a href="#L-2220"><span class="linenos">2220</span></a>                                    <span class="s2">&quot;FILENAME&quot;</span><span class="p">:</span> <span class="n">key</span><span class="o">+</span><span class="s2">&quot;.png&quot;</span><span class="p">,</span>
</span><span id="L-2221"><a href="#L-2221"><span class="linenos">2221</span></a>                                    <span class="s2">&quot;PLOT-DESCRIPTION&quot;</span><span class="p">:</span> <span class="s2">&quot;This heat map displays the representative worst case emissions rates for each office option. &quot;</span>
</span><span id="L-2222"><a href="#L-2222"><span class="linenos">2222</span></a>                                    <span class="p">})</span>
</span><span id="L-2223"><a href="#L-2223"><span class="linenos">2223</span></a>            
</span><span id="L-2224"><a href="#L-2224"><span class="linenos">2224</span></a>            <span class="k">if</span> <span class="n">graph</span> <span class="o">==</span> <span class="s2">&quot;_all&quot;</span> <span class="ow">or</span> <span class="n">graph</span> <span class="o">==</span> <span class="n">key</span><span class="p">:</span>
</span><span id="L-2225"><a href="#L-2225"><span class="linenos">2225</span></a>                <span class="n">office</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">to_frame</span><span class="p">()</span><span class="o">.</span><span class="n">T</span>
</span><span id="L-2226"><a href="#L-2226"><span class="linenos">2226</span></a>                <span class="c1"># get the needed commute values</span>
</span><span id="L-2227"><a href="#L-2227"><span class="linenos">2227</span></a>                <span class="n">values</span> <span class="o">=</span> <span class="n">commute_data</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span>
</span><span id="L-2228"><a href="#L-2228"><span class="linenos">2228</span></a>                <span class="c1"># filter teh employees to only those within the cutoff distance</span>
</span><span id="L-2229"><a href="#L-2229"><span class="linenos">2229</span></a>                <span class="n">emp_within</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graphing</span><span class="o">.</span><span class="n">filter_drive_distance</span><span class="p">(</span><span class="n">emp</span><span class="p">,</span><span class="n">office</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">commute_range_cut_off</span><span class="p">,</span> <span class="n">commute_data</span><span class="o">=</span><span class="n">commute_data</span><span class="p">)</span>
</span><span id="L-2230"><a href="#L-2230"><span class="linenos">2230</span></a>                <span class="n">val_set</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graphing</span><span class="o">.</span><span class="n">get_commute_values</span><span class="p">(</span><span class="n">emp_within</span><span class="p">,</span> <span class="n">office</span><span class="p">,</span> <span class="n">commute_data</span><span class="p">,</span> <span class="n">values</span><span class="p">)</span>
</span><span id="L-2231"><a href="#L-2231"><span class="linenos">2231</span></a>                <span class="c1"># restore val_set columns latitutde and longitude to origin_lat and origin_long</span>
</span><span id="L-2232"><a href="#L-2232"><span class="linenos">2232</span></a>                <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;origin_lat&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;latitude&#39;</span><span class="p">]</span>
</span><span id="L-2233"><a href="#L-2233"><span class="linenos">2233</span></a>                <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;origin_long&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;longitude&#39;</span><span class="p">]</span>
</span><span id="L-2234"><a href="#L-2234"><span class="linenos">2234</span></a>
</span><span id="L-2235"><a href="#L-2235"><span class="linenos">2235</span></a>                <span class="n">traffic_graph_keys</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;m_morning_emissions&#39;</span><span class="p">,</span>
</span><span id="L-2236"><a href="#L-2236"><span class="linenos">2236</span></a>                                        <span class="s1">&#39;t_morning_emissions&#39;</span><span class="p">,</span>
</span><span id="L-2237"><a href="#L-2237"><span class="linenos">2237</span></a>                                        <span class="s1">&#39;w_morning_emissions&#39;</span><span class="p">,</span>
</span><span id="L-2238"><a href="#L-2238"><span class="linenos">2238</span></a>                                        <span class="s1">&#39;h_morning_emissions&#39;</span><span class="p">,</span>
</span><span id="L-2239"><a href="#L-2239"><span class="linenos">2239</span></a>                                        <span class="s1">&#39;f_morning_emissions&#39;</span><span class="p">,</span>
</span><span id="L-2240"><a href="#L-2240"><span class="linenos">2240</span></a>                                        <span class="s1">&#39;m_evening_emissions&#39;</span><span class="p">,</span>
</span><span id="L-2241"><a href="#L-2241"><span class="linenos">2241</span></a>                                        <span class="s1">&#39;t_evening_emissions&#39;</span><span class="p">,</span>
</span><span id="L-2242"><a href="#L-2242"><span class="linenos">2242</span></a>                                        <span class="s1">&#39;w_evening_emissions&#39;</span><span class="p">,</span>
</span><span id="L-2243"><a href="#L-2243"><span class="linenos">2243</span></a>                                        <span class="s1">&#39;h_evening_emissions&#39;</span><span class="p">,</span>
</span><span id="L-2244"><a href="#L-2244"><span class="linenos">2244</span></a>                                        <span class="s1">&#39;f_evening_emissions&#39;</span><span class="p">]</span>
</span><span id="L-2245"><a href="#L-2245"><span class="linenos">2245</span></a>                
</span><span id="L-2246"><a href="#L-2246"><span class="linenos">2246</span></a>                <span class="n">traffic_graphs_nice_names</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;m_morning_emissions&quot;</span><span class="p">:</span><span class="s2">&quot;Monday Morning&quot;</span><span class="p">,</span>
</span><span id="L-2247"><a href="#L-2247"><span class="linenos">2247</span></a>                                             <span class="s2">&quot;t_morning_emissions&quot;</span><span class="p">:</span><span class="s2">&quot;Tuesday Morning&quot;</span><span class="p">,</span>
</span><span id="L-2248"><a href="#L-2248"><span class="linenos">2248</span></a>                                             <span class="s2">&quot;w_morning_emissions&quot;</span><span class="p">:</span><span class="s2">&quot;Wednesday Morning&quot;</span><span class="p">,</span>
</span><span id="L-2249"><a href="#L-2249"><span class="linenos">2249</span></a>                                             <span class="s2">&quot;h_morning_emissions&quot;</span><span class="p">:</span><span class="s2">&quot;Thursday Morning&quot;</span><span class="p">,</span>
</span><span id="L-2250"><a href="#L-2250"><span class="linenos">2250</span></a>                                             <span class="s2">&quot;f_morning_emissions&quot;</span><span class="p">:</span><span class="s2">&quot;Friday Morning&quot;</span><span class="p">,</span>
</span><span id="L-2251"><a href="#L-2251"><span class="linenos">2251</span></a>                                             <span class="s2">&quot;m_evening_emissions&quot;</span><span class="p">:</span><span class="s2">&quot;Monday Evening&quot;</span><span class="p">,</span>
</span><span id="L-2252"><a href="#L-2252"><span class="linenos">2252</span></a>                                             <span class="s2">&quot;t_evening_emissions&quot;</span><span class="p">:</span><span class="s2">&quot;Tuesday Evening&quot;</span><span class="p">,</span>
</span><span id="L-2253"><a href="#L-2253"><span class="linenos">2253</span></a>                                             <span class="s2">&quot;w_evening_emissions&quot;</span><span class="p">:</span><span class="s2">&quot;Wednesday Evening&quot;</span><span class="p">,</span>
</span><span id="L-2254"><a href="#L-2254"><span class="linenos">2254</span></a>                                             <span class="s2">&quot;h_evening_emissions&quot;</span><span class="p">:</span><span class="s2">&quot;Thursday Evening&quot;</span><span class="p">,</span>
</span><span id="L-2255"><a href="#L-2255"><span class="linenos">2255</span></a>                                             <span class="s2">&quot;f_evening_emissions&quot;</span><span class="p">:</span><span class="s2">&quot;Friday Evening&quot;</span><span class="p">}</span>
</span><span id="L-2256"><a href="#L-2256"><span class="linenos">2256</span></a>                
</span><span id="L-2257"><a href="#L-2257"><span class="linenos">2257</span></a>                <span class="c1"># get the sum total emissions for each day and morning/evening</span>
</span><span id="L-2258"><a href="#L-2258"><span class="linenos">2258</span></a>                <span class="n">emissions</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-2259"><a href="#L-2259"><span class="linenos">2259</span></a>                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">traffic_graph_keys</span><span class="p">:</span>
</span><span id="L-2260"><a href="#L-2260"><span class="linenos">2260</span></a>                    <span class="n">emissions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">val_set</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span>
</span><span id="L-2261"><a href="#L-2261"><span class="linenos">2261</span></a>
</span><span id="L-2262"><a href="#L-2262"><span class="linenos">2262</span></a>                <span class="c1"># create a dictionary to hold the emissions for each day and morning/evening</span>
</span><span id="L-2263"><a href="#L-2263"><span class="linenos">2263</span></a>                <span class="n">emissions_dict</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-2264"><a href="#L-2264"><span class="linenos">2264</span></a>                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">traffic_graph_keys</span><span class="p">)):</span>
</span><span id="L-2265"><a href="#L-2265"><span class="linenos">2265</span></a>                    <span class="n">emissions_dict</span><span class="p">[</span><span class="n">traffic_graph_keys</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">=</span> <span class="n">emissions</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</span><span id="L-2266"><a href="#L-2266"><span class="linenos">2266</span></a>                
</span><span id="L-2267"><a href="#L-2267"><span class="linenos">2267</span></a>
</span><span id="L-2268"><a href="#L-2268"><span class="linenos">2268</span></a>                <span class="n">plt</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graphing</span><span class="o">.</span><span class="n">get_heatmap</span><span class="p">(</span><span class="n">emp_within</span><span class="p">,</span> <span class="n">office</span><span class="p">,</span> <span class="n">val_set</span><span class="p">,</span> <span class="s2">&quot;w_evening_emissions&quot;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Worst Case Emissions Rate (Wed. Evening)) </span><span class="se">\n</span><span class="s2">for &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;address&#39;</span><span class="p">]),</span> 
</span><span id="L-2269"><a href="#L-2269"><span class="linenos">2269</span></a>                                                <span class="n">value_label</span><span class="o">=</span><span class="s2">&quot;CO2 Emissions in Traffic (kg/commute)&quot;</span><span class="p">,</span> <span class="n">cutoff_distance</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">commute_range_cut_off</span><span class="p">,</span> 
</span><span id="L-2270"><a href="#L-2270"><span class="linenos">2270</span></a>                                                <span class="n">commute_radius</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">commute_range_cut_off</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.4</span><span class="p">,</span> <span class="n">levels</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">font_mod</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span> 
</span><span id="L-2271"><a href="#L-2271"><span class="linenos">2271</span></a>                                                <span class="n">convex_hull</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">plot_points</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">imagery</span><span class="o">=</span><span class="s2">&quot;Google&quot;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gist_heat_r&#39;</span><span class="p">)</span>
</span><span id="L-2272"><a href="#L-2272"><span class="linenos">2272</span></a>                <span class="c1"># add a text label to the bottom right of the plot with the total emissions for the plotted value</span>
</span><span id="L-2273"><a href="#L-2273"><span class="linenos">2273</span></a>                <span class="n">t</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;em&#39;</span> <span class="p">:</span> <span class="s1">&#39;Total Emissions / Commute: </span><span class="si">{:.2f}</span><span class="s1"> kg&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">emissions_dict</span><span class="p">[</span><span class="s1">&#39;w_evening_emissions&#39;</span><span class="p">])}</span>    
</span><span id="L-2274"><a href="#L-2274"><span class="linenos">2274</span></a>                <span class="c1"># add to plot</span>
</span><span id="L-2275"><a href="#L-2275"><span class="linenos">2275</span></a>                <span class="n">textstr</span> <span class="o">=</span> <span class="n">t</span><span class="p">[</span><span class="s1">&#39;em&#39;</span><span class="p">]</span>                              
</span><span id="L-2276"><a href="#L-2276"><span class="linenos">2276</span></a>                <span class="c1"># these are matplotlib.patch.Patch properties</span>
</span><span id="L-2277"><a href="#L-2277"><span class="linenos">2277</span></a>                <span class="n">props</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">boxstyle</span><span class="o">=</span><span class="s1">&#39;round&#39;</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="L-2278"><a href="#L-2278"><span class="linenos">2278</span></a>                <span class="c1"># place a text box in lower right in axes coords,</span>
</span><span id="L-2279"><a href="#L-2279"><span class="linenos">2279</span></a>                <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">.985</span><span class="p">,</span> <span class="mf">.015</span><span class="p">,</span> <span class="n">textstr</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">,</span>
</span><span id="L-2280"><a href="#L-2280"><span class="linenos">2280</span></a>                            <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;bottom&#39;</span><span class="p">,</span> <span class="n">bbox</span><span class="o">=</span><span class="n">props</span><span class="p">,</span> <span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;family&#39;</span><span class="p">:</span> <span class="s1">&#39;monospace&#39;</span><span class="p">},</span> <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">)</span>
</span><span id="L-2281"><a href="#L-2281"><span class="linenos">2281</span></a>                <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">plots_dir</span><span class="o">+</span><span class="s2">&quot;/&quot;</span><span class="o">+</span><span class="n">key</span><span class="o">+</span><span class="s2">&quot;.png&quot;</span><span class="p">)</span>
</span><span id="L-2282"><a href="#L-2282"><span class="linenos">2282</span></a>                <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="L-2283"><a href="#L-2283"><span class="linenos">2283</span></a>                
</span><span id="L-2284"><a href="#L-2284"><span class="linenos">2284</span></a>        <span class="c1">#TODO : GRAPH THE EMISSIONS FOR EACH OFFICE</span>
</span><span id="L-2285"><a href="#L-2285"><span class="linenos">2285</span></a>
</span><span id="L-2286"><a href="#L-2286"><span class="linenos">2286</span></a>
</span><span id="L-2287"><a href="#L-2287"><span class="linenos">2287</span></a>        <span class="c1">################################################################################ </span>
</span><span id="L-2288"><a href="#L-2288"><span class="linenos">2288</span></a>        <span class="c1"># GRAPH: </span>
</span><span id="L-2289"><a href="#L-2289"><span class="linenos">2289</span></a>        <span class="c1">## Total Emissions Cost Differential Analysis</span>
</span><span id="L-2290"><a href="#L-2290"><span class="linenos">2290</span></a>        <span class="n">key</span> <span class="o">=</span> <span class="s1">&#39;tecdca&#39;</span>
</span><span id="L-2291"><a href="#L-2291"><span class="linenos">2291</span></a>        <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;Total Emissions Cost Differential Analysis&quot;</span>
</span><span id="L-2292"><a href="#L-2292"><span class="linenos">2292</span></a>        <span class="n">short_title</span> <span class="o">=</span> <span class="n">title</span>
</span><span id="L-2293"><a href="#L-2293"><span class="linenos">2293</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">graph_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="p">{</span><span class="s2">&quot;GRAPH&quot;</span><span class="p">:</span> <span class="n">key</span><span class="p">,</span>
</span><span id="L-2294"><a href="#L-2294"><span class="linenos">2294</span></a>                                <span class="s2">&quot;TITLE&quot;</span><span class="p">:</span> <span class="n">short_title</span><span class="p">,</span>
</span><span id="L-2295"><a href="#L-2295"><span class="linenos">2295</span></a>                                <span class="s2">&quot;FILENAME&quot;</span><span class="p">:</span> <span class="n">key</span><span class="o">+</span><span class="s2">&quot;.png&quot;</span><span class="p">,</span>
</span><span id="L-2296"><a href="#L-2296"><span class="linenos">2296</span></a>                                <span class="s2">&quot;PLOT-DESCRIPTION&quot;</span><span class="p">:</span> <span class="s2">&quot;This graph displays the differential cost associated with emissions based on the office options.&quot;</span>
</span><span id="L-2297"><a href="#L-2297"><span class="linenos">2297</span></a>                                <span class="p">})</span>
</span><span id="L-2298"><a href="#L-2298"><span class="linenos">2298</span></a>        
</span><span id="L-2299"><a href="#L-2299"><span class="linenos">2299</span></a>        <span class="k">if</span> <span class="n">graph</span> <span class="o">==</span> <span class="s2">&quot;_all&quot;</span> <span class="ow">or</span> <span class="n">graph</span> <span class="o">==</span> <span class="n">key</span><span class="p">:</span>
</span><span id="L-2300"><a href="#L-2300"><span class="linenos">2300</span></a>            <span class="c1"># gather the data for the analysis</span>
</span><span id="L-2301"><a href="#L-2301"><span class="linenos">2301</span></a>            <span class="n">base_costs</span><span class="p">,</span> <span class="n">cost_values</span><span class="p">,</span> <span class="n">average_diffs</span><span class="p">,</span> <span class="n">conservative_diffs</span><span class="p">,</span> <span class="n">withins</span><span class="p">,</span> <span class="n">employee_costs_to_office</span><span class="p">,</span> <span class="n">current_office</span><span class="p">,</span> <span class="n">other_offices</span> <span class="o">=</span> \
</span><span id="L-2302"><a href="#L-2302"><span class="linenos">2302</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">get_emissions_analysis</span><span class="p">(</span><span class="n">emp</span><span class="p">,</span> <span class="n">offices</span><span class="p">,</span> <span class="n">commute_data</span><span class="p">)</span>
</span><span id="L-2303"><a href="#L-2303"><span class="linenos">2303</span></a>
</span><span id="L-2304"><a href="#L-2304"><span class="linenos">2304</span></a>        
</span><span id="L-2305"><a href="#L-2305"><span class="linenos">2305</span></a>            <span class="c1"># now we have a list of dataframes with the differentials, we eliminate all rows with 0 cost differential to prevent skewing the histogram</span>
</span><span id="L-2306"><a href="#L-2306"><span class="linenos">2306</span></a>            <span class="c1"># calculate the bin list based upon a the min (negative) and max (positive) values of the data     </span>
</span><span id="L-2307"><a href="#L-2307"><span class="linenos">2307</span></a>            <span class="n">binmin</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-2308"><a href="#L-2308"><span class="linenos">2308</span></a>            <span class="n">binmax</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-2309"><a href="#L-2309"><span class="linenos">2309</span></a>            <span class="n">diffs</span> <span class="o">=</span> <span class="p">[</span><span class="n">average_diffs</span><span class="p">,</span> <span class="n">conservative_diffs</span><span class="p">]</span>
</span><span id="L-2310"><a href="#L-2310"><span class="linenos">2310</span></a>            <span class="k">for</span> <span class="n">diff</span> <span class="ow">in</span> <span class="n">diffs</span><span class="p">:</span>
</span><span id="L-2311"><a href="#L-2311"><span class="linenos">2311</span></a>                <span class="k">for</span> <span class="n">each</span> <span class="ow">in</span> <span class="n">diff</span><span class="p">:</span>
</span><span id="L-2312"><a href="#L-2312"><span class="linenos">2312</span></a>                    <span class="k">if</span> <span class="nb">min</span><span class="p">(</span><span class="n">each</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">binmin</span><span class="p">:</span>
</span><span id="L-2313"><a href="#L-2313"><span class="linenos">2313</span></a>                        <span class="n">binmin</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">each</span><span class="p">)</span>
</span><span id="L-2314"><a href="#L-2314"><span class="linenos">2314</span></a>                    <span class="k">if</span> <span class="nb">max</span><span class="p">(</span><span class="n">each</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">binmax</span><span class="p">:</span>
</span><span id="L-2315"><a href="#L-2315"><span class="linenos">2315</span></a>                        <span class="n">binmax</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">each</span><span class="p">)</span>
</span><span id="L-2316"><a href="#L-2316"><span class="linenos">2316</span></a>            <span class="n">step</span> <span class="o">=</span> <span class="mf">0.001</span>
</span><span id="L-2317"><a href="#L-2317"><span class="linenos">2317</span></a>            <span class="c1"># round the binmin down to the nearest step, max up to the nearest step</span>
</span><span id="L-2318"><a href="#L-2318"><span class="linenos">2318</span></a>            <span class="n">bins</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">binmin</span> <span class="o">-</span> <span class="p">(</span><span class="n">binmin</span> <span class="o">%</span> <span class="n">step</span><span class="p">),</span> <span class="n">binmax</span> <span class="o">+</span> <span class="n">step</span> <span class="o">-</span> <span class="p">(</span><span class="n">binmax</span> <span class="o">%</span> <span class="n">step</span><span class="p">),</span> <span class="n">step</span><span class="p">)</span>
</span><span id="L-2319"><a href="#L-2319"><span class="linenos">2319</span></a>
</span><span id="L-2320"><a href="#L-2320"><span class="linenos">2320</span></a>            <span class="n">dvalues</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Total Average Cost&#39;</span><span class="p">,</span><span class="s1">&#39;Total High Cost&#39;</span><span class="p">]</span>
</span><span id="L-2321"><a href="#L-2321"><span class="linenos">2321</span></a>            
</span><span id="L-2322"><a href="#L-2322"><span class="linenos">2322</span></a>            <span class="n">plt</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graphing</span><span class="o">.</span><span class="n">get_histogram</span><span class="p">(</span><span class="n">emp</span><span class="p">,</span> <span class="n">other_offices</span><span class="p">,</span> <span class="n">cost_values</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="n">dvalues</span><span class="p">,</span> <span class="n">suptitle</span><span class="o">=</span><span class="n">title</span><span class="p">,</span> <span class="n">cutoff_radius</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">commute_range_cut_off</span><span class="p">,</span>
</span><span id="L-2323"><a href="#L-2323"><span class="linenos">2323</span></a>                                      <span class="n">x_label</span><span class="o">=</span><span class="s1">&#39;\$ (USD) per commute&#39;</span><span class="p">,</span> <span class="n">y_label</span><span class="o">=</span><span class="s1">&#39;# Employees (log scale)&#39;</span><span class="p">,</span>
</span><span id="L-2324"><a href="#L-2324"><span class="linenos">2324</span></a>                                      <span class="n">bins</span><span class="o">=</span><span class="n">bins</span><span class="p">,</span> <span class="n">rows</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">other_offices</span><span class="p">),</span> <span class="n">cols</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">column_titles</span><span class="o">=</span><span class="n">dvalues</span><span class="p">,</span> 
</span><span id="L-2325"><a href="#L-2325"><span class="linenos">2325</span></a>                                      <span class="n">cumulative_line</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">font_mod</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">manual_plot</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">override_values</span><span class="o">=</span><span class="n">cost_values</span><span class="p">)</span>
</span><span id="L-2326"><a href="#L-2326"><span class="linenos">2326</span></a>            
</span><span id="L-2327"><a href="#L-2327"><span class="linenos">2327</span></a>                  
</span><span id="L-2328"><a href="#L-2328"><span class="linenos">2328</span></a>            <span class="c1"># manually add histograms for each office option</span>
</span><span id="L-2329"><a href="#L-2329"><span class="linenos">2329</span></a>            <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">other_offices</span><span class="p">)):</span>
</span><span id="L-2330"><a href="#L-2330"><span class="linenos">2330</span></a>                <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
</span><span id="L-2331"><a href="#L-2331"><span class="linenos">2331</span></a>                    <span class="n">ax</span><span class="p">[</span><span class="n">r</span><span class="p">,</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">average_diffs</span><span class="p">[</span><span class="n">r</span><span class="p">],</span> <span class="n">bins</span><span class="o">=</span><span class="n">bins</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;#555555&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">align</span><span class="o">=</span><span class="s1">&#39;mid&#39;</span><span class="p">,</span> 
</span><span id="L-2332"><a href="#L-2332"><span class="linenos">2332</span></a>                            <span class="n">rwidth</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">other_offices</span><span class="p">[</span><span class="s1">&#39;address&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="n">r</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">(</span><span class="n">r</span><span class="o">+</span><span class="mi">2</span><span class="p">),</span> <span class="n">log</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-2333"><a href="#L-2333"><span class="linenos">2333</span></a>                    <span class="n">ax</span><span class="p">[</span><span class="n">r</span><span class="p">,</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;major&#39;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
</span><span id="L-2334"><a href="#L-2334"><span class="linenos">2334</span></a>                    <span class="k">if</span> <span class="n">c</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-2335"><a href="#L-2335"><span class="linenos">2335</span></a>                        <span class="n">ax</span><span class="p">[</span><span class="n">r</span><span class="p">,</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;# Employees (log scale)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
</span><span id="L-2336"><a href="#L-2336"><span class="linenos">2336</span></a>                        <span class="c1"># put office address top left of the plot</span>
</span><span id="L-2337"><a href="#L-2337"><span class="linenos">2337</span></a>                        <span class="n">ax</span><span class="p">[</span><span class="n">r</span><span class="p">,</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.03</span><span class="p">,</span> <span class="mf">0.99</span><span class="p">,</span> <span class="n">other_offices</span><span class="p">[</span><span class="s1">&#39;address&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="n">r</span><span class="p">],</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="n">r</span><span class="p">,</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;top&#39;</span><span class="p">)</span>
</span><span id="L-2338"><a href="#L-2338"><span class="linenos">2338</span></a>                    
</span><span id="L-2339"><a href="#L-2339"><span class="linenos">2339</span></a>                    <span class="k">if</span> <span class="n">r</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">other_offices</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span>
</span><span id="L-2340"><a href="#L-2340"><span class="linenos">2340</span></a>                        <span class="n">ax</span><span class="p">[</span><span class="n">r</span><span class="p">,</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Cost of C02 Emissions (\$USD/commuting day)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
</span><span id="L-2341"><a href="#L-2341"><span class="linenos">2341</span></a>                    <span class="n">ax</span><span class="p">[</span><span class="n">r</span><span class="p">,</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;major&#39;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
</span><span id="L-2342"><a href="#L-2342"><span class="linenos">2342</span></a>                    
</span><span id="L-2343"><a href="#L-2343"><span class="linenos">2343</span></a>                    <span class="c1"># cost impact is the summation of the cost of emissions for all employees</span>
</span><span id="L-2344"><a href="#L-2344"><span class="linenos">2344</span></a>                    <span class="n">cost_impact_avg</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">average_diffs</span><span class="p">[</span><span class="n">r</span><span class="p">])</span>
</span><span id="L-2345"><a href="#L-2345"><span class="linenos">2345</span></a>                    <span class="n">cost_impact_con</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">conservative_diffs</span><span class="p">[</span><span class="n">r</span><span class="p">])</span>
</span><span id="L-2346"><a href="#L-2346"><span class="linenos">2346</span></a>                    
</span><span id="L-2347"><a href="#L-2347"><span class="linenos">2347</span></a>                    <span class="c1"># add a text box with the count</span>
</span><span id="L-2348"><a href="#L-2348"><span class="linenos">2348</span></a>                    <span class="n">t</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;co&#39;</span> <span class="p">:</span> <span class="s1">&#39;Total Avg Emissions Cost Difference</span><span class="se">\n</span><span class="s1"> (\$/commuting day): $</span><span class="si">{:,.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cost_impact_avg</span><span class="p">),</span>
</span><span id="L-2349"><a href="#L-2349"><span class="linenos">2349</span></a>                            <span class="s1">&#39;ci&#39;</span> <span class="p">:</span> <span class="s1">&#39;Total Conservative Cost Difference</span><span class="se">\n</span><span class="s1"> (\$/commuting day): $</span><span class="si">{:,.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cost_impact_con</span><span class="p">)</span>                         
</span><span id="L-2350"><a href="#L-2350"><span class="linenos">2350</span></a>                            <span class="p">}</span>
</span><span id="L-2351"><a href="#L-2351"><span class="linenos">2351</span></a>                    
</span><span id="L-2352"><a href="#L-2352"><span class="linenos">2352</span></a>                    <span class="n">textstr</span> <span class="o">=</span> <span class="n">t</span><span class="p">[</span><span class="s1">&#39;co&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="n">c</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">t</span><span class="p">[</span><span class="s1">&#39;ci&#39;</span><span class="p">]</span>
</span><span id="L-2353"><a href="#L-2353"><span class="linenos">2353</span></a>                    <span class="c1"># these are matplotlib.patch.Patch properties</span>
</span><span id="L-2354"><a href="#L-2354"><span class="linenos">2354</span></a>                    <span class="n">props</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">boxstyle</span><span class="o">=</span><span class="s1">&#39;round&#39;</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;wheat&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
</span><span id="L-2355"><a href="#L-2355"><span class="linenos">2355</span></a>                    <span class="c1"># place a text box in upper right in axes coords,</span>
</span><span id="L-2356"><a href="#L-2356"><span class="linenos">2356</span></a>                    <span class="n">ax</span><span class="p">[</span><span class="n">r</span><span class="p">,</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">.03</span><span class="p">,</span> <span class="mf">.85</span><span class="p">,</span> <span class="n">textstr</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="n">r</span><span class="p">,</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">,</span>
</span><span id="L-2357"><a href="#L-2357"><span class="linenos">2357</span></a>                                <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">bbox</span><span class="o">=</span><span class="n">props</span><span class="p">,</span> <span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;family&#39;</span><span class="p">:</span> <span class="s1">&#39;monospace&#39;</span><span class="p">},</span> <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">)</span>
</span><span id="L-2358"><a href="#L-2358"><span class="linenos">2358</span></a>                    
</span><span id="L-2359"><a href="#L-2359"><span class="linenos">2359</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">(</span><span class="n">pad</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
</span><span id="L-2360"><a href="#L-2360"><span class="linenos">2360</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">plots_dir</span><span class="o">+</span><span class="s2">&quot;/&quot;</span><span class="o">+</span><span class="n">key</span><span class="o">+</span><span class="s2">&quot;.png&quot;</span><span class="p">)</span>
</span><span id="L-2361"><a href="#L-2361"><span class="linenos">2361</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="L-2362"><a href="#L-2362"><span class="linenos">2362</span></a>
</span><span id="L-2363"><a href="#L-2363"><span class="linenos">2363</span></a>
</span><span id="L-2364"><a href="#L-2364"><span class="linenos">2364</span></a>
</span><span id="L-2365"><a href="#L-2365"><span class="linenos">2365</span></a>
</span><span id="L-2366"><a href="#L-2366"><span class="linenos">2366</span></a>        <span class="c1"># write the graphs to graphs.json in the project plots directory</span>
</span><span id="L-2367"><a href="#L-2367"><span class="linenos">2367</span></a>        <span class="c1"># convert self.graphs_list to json</span>
</span><span id="L-2368"><a href="#L-2368"><span class="linenos">2368</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">plots_dir</span><span class="p">,</span> <span class="s2">&quot;graphs.json&quot;</span><span class="p">),</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="L-2369"><a href="#L-2369"><span class="linenos">2369</span></a>            <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">graph_list</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
</span><span id="L-2370"><a href="#L-2370"><span class="linenos">2370</span></a>
</span><span id="L-2371"><a href="#L-2371"><span class="linenos">2371</span></a>        <span class="c1"># update the analysis phase</span>
</span><span id="L-2372"><a href="#L-2372"><span class="linenos">2372</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">update_analysis_phase</span><span class="p">()</span>
</span><span id="L-2373"><a href="#L-2373"><span class="linenos">2373</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph_list</span>
</span><span id="L-2374"><a href="#L-2374"><span class="linenos">2374</span></a>    
</span><span id="L-2375"><a href="#L-2375"><span class="linenos">2375</span></a>
</span><span id="L-2376"><a href="#L-2376"><span class="linenos">2376</span></a>
</span><span id="L-2377"><a href="#L-2377"><span class="linenos">2377</span></a>
</span><span id="L-2378"><a href="#L-2378"><span class="linenos">2378</span></a>
</span><span id="L-2379"><a href="#L-2379"><span class="linenos">2379</span></a>    <span class="k">def</span> <span class="nf">generate_tables</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">table</span><span class="o">=</span><span class="s2">&quot;_all&quot;</span><span class="p">):</span>
</span><span id="L-2380"><a href="#L-2380"><span class="linenos">2380</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-2381"><a href="#L-2381"><span class="linenos">2381</span></a><span class="sd">        Generates and saves tabular representations of analyzed commute data.</span>
</span><span id="L-2382"><a href="#L-2382"><span class="linenos">2382</span></a>
</span><span id="L-2383"><a href="#L-2383"><span class="linenos">2383</span></a><span class="sd">        Based on the available commute data, this method generates tables such as the overall cost comparison analytics.</span>
</span><span id="L-2384"><a href="#L-2384"><span class="linenos">2384</span></a>
</span><span id="L-2385"><a href="#L-2385"><span class="linenos">2385</span></a><span class="sd">        Args:</span>
</span><span id="L-2386"><a href="#L-2386"><span class="linenos">2386</span></a><span class="sd">            graph (str, optional): Specifies which table to generate. Use &quot;_all&quot; to generate all tables, or specify a </span>
</span><span id="L-2387"><a href="#L-2387"><span class="linenos">2387</span></a><span class="sd">            particular table&#39;s key. Defaults to &quot;_all&quot;.</span>
</span><span id="L-2388"><a href="#L-2388"><span class="linenos">2388</span></a>
</span><span id="L-2389"><a href="#L-2389"><span class="linenos">2389</span></a><span class="sd">        Returns:</span>
</span><span id="L-2390"><a href="#L-2390"><span class="linenos">2390</span></a><span class="sd">            list: A list of dictionaries, each containing details about the generated tables, including file paths and titles.</span>
</span><span id="L-2391"><a href="#L-2391"><span class="linenos">2391</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-2392"><a href="#L-2392"><span class="linenos">2392</span></a>
</span><span id="L-2393"><a href="#L-2393"><span class="linenos">2393</span></a>        <span class="c1"># generate the tables for the project</span>
</span><span id="L-2394"><a href="#L-2394"><span class="linenos">2394</span></a>        <span class="c1"># if the commute data isn&#39;t already in the project, load it</span>
</span><span id="L-2395"><a href="#L-2395"><span class="linenos">2395</span></a>        <span class="k">if</span> <span class="s2">&quot;commute_data.csv&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">list_data_files</span><span class="p">():</span>
</span><span id="L-2396"><a href="#L-2396"><span class="linenos">2396</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;commute_data.csv&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-2397"><a href="#L-2397"><span class="linenos">2397</span></a>                <span class="c1"># attempt to load the commute data</span>
</span><span id="L-2398"><a href="#L-2398"><span class="linenos">2398</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">load_data_file</span><span class="p">(</span><span class="s2">&quot;commute_data.csv&quot;</span><span class="p">):</span>
</span><span id="L-2399"><a href="#L-2399"><span class="linenos">2399</span></a>                    <span class="k">pass</span>
</span><span id="L-2400"><a href="#L-2400"><span class="linenos">2400</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="L-2401"><a href="#L-2401"><span class="linenos">2401</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Errors loading commute data from project.&quot;</span><span class="p">)</span>
</span><span id="L-2402"><a href="#L-2402"><span class="linenos">2402</span></a>                    <span class="k">return</span> <span class="kc">False</span>
</span><span id="L-2403"><a href="#L-2403"><span class="linenos">2403</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-2404"><a href="#L-2404"><span class="linenos">2404</span></a>                <span class="k">pass</span>
</span><span id="L-2405"><a href="#L-2405"><span class="linenos">2405</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-2406"><a href="#L-2406"><span class="linenos">2406</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Commute data missing from project.&quot;</span><span class="p">)</span>
</span><span id="L-2407"><a href="#L-2407"><span class="linenos">2407</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="L-2408"><a href="#L-2408"><span class="linenos">2408</span></a>        
</span><span id="L-2409"><a href="#L-2409"><span class="linenos">2409</span></a>        <span class="c1"># create a list of dicts to map the tables to return to UI, they will be plotted in the order they are listed</span>
</span><span id="L-2410"><a href="#L-2410"><span class="linenos">2410</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">table_list</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-2411"><a href="#L-2411"><span class="linenos">2411</span></a> 
</span><span id="L-2412"><a href="#L-2412"><span class="linenos">2412</span></a>        <span class="c1">### generate the tables  ###</span>
</span><span id="L-2413"><a href="#L-2413"><span class="linenos">2413</span></a>        <span class="n">tables_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project_directory</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">project_name</span><span class="p">,</span> <span class="s2">&quot;tables&quot;</span><span class="p">)</span>
</span><span id="L-2414"><a href="#L-2414"><span class="linenos">2414</span></a>        <span class="c1"># if it doesn&#39;t exist, create it</span>
</span><span id="L-2415"><a href="#L-2415"><span class="linenos">2415</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">tables_dir</span><span class="p">):</span>
</span><span id="L-2416"><a href="#L-2416"><span class="linenos">2416</span></a>            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">tables_dir</span><span class="p">)</span>
</span><span id="L-2417"><a href="#L-2417"><span class="linenos">2417</span></a>
</span><span id="L-2418"><a href="#L-2418"><span class="linenos">2418</span></a>        <span class="c1"># get the baseline data</span>
</span><span id="L-2419"><a href="#L-2419"><span class="linenos">2419</span></a>        <span class="n">emp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">get_emp_gps</span><span class="p">()</span>
</span><span id="L-2420"><a href="#L-2420"><span class="linenos">2420</span></a>        <span class="n">offices</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">get_office_gps</span><span class="p">()</span>
</span><span id="L-2421"><a href="#L-2421"><span class="linenos">2421</span></a>        <span class="n">commute_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">get_commute_data</span><span class="p">()</span>
</span><span id="L-2422"><a href="#L-2422"><span class="linenos">2422</span></a>        
</span><span id="L-2423"><a href="#L-2423"><span class="linenos">2423</span></a>        <span class="c1"># helper function to save the table</span>
</span><span id="L-2424"><a href="#L-2424"><span class="linenos">2424</span></a>        <span class="k">def</span> <span class="nf">save_table</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">tables_dir</span><span class="o">=</span><span class="n">tables_dir</span><span class="p">):</span>
</span><span id="L-2425"><a href="#L-2425"><span class="linenos">2425</span></a>            <span class="c1"># write the table to a file</span>
</span><span id="L-2426"><a href="#L-2426"><span class="linenos">2426</span></a>            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tables_dir</span><span class="p">,</span> <span class="n">key</span><span class="o">+</span><span class="s2">&quot;.html&quot;</span><span class="p">),</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="L-2427"><a href="#L-2427"><span class="linenos">2427</span></a>                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
</span><span id="L-2428"><a href="#L-2428"><span class="linenos">2428</span></a>
</span><span id="L-2429"><a href="#L-2429"><span class="linenos">2429</span></a>        <span class="c1">################################################################################</span>
</span><span id="L-2430"><a href="#L-2430"><span class="linenos">2430</span></a>        <span class="c1">### TABLE SET: Office Addresses and Lat/Longs</span>
</span><span id="L-2431"><a href="#L-2431"><span class="linenos">2431</span></a>        <span class="c1"># iterate through offices and generate a table for each office</span>
</span><span id="L-2432"><a href="#L-2432"><span class="linenos">2432</span></a>        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">offices</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>    
</span><span id="L-2433"><a href="#L-2433"><span class="linenos">2433</span></a>            <span class="c1">################################################################################ </span>
</span><span id="L-2434"><a href="#L-2434"><span class="linenos">2434</span></a>            <span class="c1"># TABLE: </span>
</span><span id="L-2435"><a href="#L-2435"><span class="linenos">2435</span></a>            <span class="c1">## Location Information</span>
</span><span id="L-2436"><a href="#L-2436"><span class="linenos">2436</span></a>            <span class="n">key</span> <span class="o">=</span> <span class="s1">&#39;li&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
</span><span id="L-2437"><a href="#L-2437"><span class="linenos">2437</span></a>            <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;Location Information &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;address&#39;</span><span class="p">])</span>
</span><span id="L-2438"><a href="#L-2438"><span class="linenos">2438</span></a>            <span class="n">short_title</span> <span class="o">=</span> <span class="n">title</span>
</span><span id="L-2439"><a href="#L-2439"><span class="linenos">2439</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">table_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="p">{</span><span class="s2">&quot;TABLE&quot;</span><span class="p">:</span> <span class="n">key</span><span class="p">,</span>
</span><span id="L-2440"><a href="#L-2440"><span class="linenos">2440</span></a>                                    <span class="s2">&quot;TITLE&quot;</span><span class="p">:</span> <span class="n">short_title</span><span class="p">,</span>
</span><span id="L-2441"><a href="#L-2441"><span class="linenos">2441</span></a>                                    <span class="s2">&quot;FILENAME&quot;</span><span class="p">:</span> <span class="n">key</span><span class="o">+</span><span class="s2">&quot;.html&quot;</span><span class="p">,</span>
</span><span id="L-2442"><a href="#L-2442"><span class="linenos">2442</span></a>                                    <span class="s2">&quot;TABLE-DESCRIPTION&quot;</span><span class="p">:</span> <span class="s2">&quot;This table displays the location information for office option &quot;</span> <span class="o">+</span> \
</span><span id="L-2443"><a href="#L-2443"><span class="linenos">2443</span></a>                                    <span class="nb">str</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;address&#39;</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot;.&quot;</span>
</span><span id="L-2444"><a href="#L-2444"><span class="linenos">2444</span></a>                                    <span class="p">})</span>
</span><span id="L-2445"><a href="#L-2445"><span class="linenos">2445</span></a>            
</span><span id="L-2446"><a href="#L-2446"><span class="linenos">2446</span></a>            <span class="k">if</span> <span class="n">table</span> <span class="o">==</span> <span class="s2">&quot;_all&quot;</span> <span class="ow">or</span> <span class="n">table</span> <span class="o">==</span> <span class="n">key</span><span class="p">:</span>
</span><span id="L-2447"><a href="#L-2447"><span class="linenos">2447</span></a>                <span class="n">office</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">to_frame</span><span class="p">()</span><span class="o">.</span><span class="n">T</span>
</span><span id="L-2448"><a href="#L-2448"><span class="linenos">2448</span></a>                <span class="c1"># get the needed commute values</span>
</span><span id="L-2449"><a href="#L-2449"><span class="linenos">2449</span></a>
</span><span id="L-2450"><a href="#L-2450"><span class="linenos">2450</span></a>                <span class="c1"># create a dataframe with the office address and lat/long</span>
</span><span id="L-2451"><a href="#L-2451"><span class="linenos">2451</span></a>                <span class="n">location_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
</span><span id="L-2452"><a href="#L-2452"><span class="linenos">2452</span></a>                <span class="n">location_data</span><span class="p">[</span><span class="s1">&#39;Office Address&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;address&#39;</span><span class="p">]]</span>
</span><span id="L-2453"><a href="#L-2453"><span class="linenos">2453</span></a>                <span class="n">location_data</span><span class="p">[</span><span class="s1">&#39;Latitude&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;latitude&#39;</span><span class="p">]]</span>
</span><span id="L-2454"><a href="#L-2454"><span class="linenos">2454</span></a>                <span class="n">location_data</span><span class="p">[</span><span class="s1">&#39;Longitude&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;longitude&#39;</span><span class="p">]]</span>
</span><span id="L-2455"><a href="#L-2455"><span class="linenos">2455</span></a>                <span class="c1"># create a table</span>
</span><span id="L-2456"><a href="#L-2456"><span class="linenos">2456</span></a>                <span class="n">t</span> <span class="o">=</span> <span class="n">location_data</span><span class="o">.</span><span class="n">to_html</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="L-2457"><a href="#L-2457"><span class="linenos">2457</span></a>                <span class="c1"># write the table to a file</span>
</span><span id="L-2458"><a href="#L-2458"><span class="linenos">2458</span></a>                <span class="n">save_table</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>
</span><span id="L-2459"><a href="#L-2459"><span class="linenos">2459</span></a>
</span><span id="L-2460"><a href="#L-2460"><span class="linenos">2460</span></a>
</span><span id="L-2461"><a href="#L-2461"><span class="linenos">2461</span></a>        <span class="c1">################################################################################ </span>
</span><span id="L-2462"><a href="#L-2462"><span class="linenos">2462</span></a>        <span class="c1"># TABLE: </span>
</span><span id="L-2463"><a href="#L-2463"><span class="linenos">2463</span></a>        <span class="c1">## Overal Cost Comparison Table</span>
</span><span id="L-2464"><a href="#L-2464"><span class="linenos">2464</span></a>        <span class="n">key</span> <span class="o">=</span> <span class="s1">&#39;occt&#39;</span>
</span><span id="L-2465"><a href="#L-2465"><span class="linenos">2465</span></a>        <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;Overall Cost Comparison Table&quot;</span>
</span><span id="L-2466"><a href="#L-2466"><span class="linenos">2466</span></a>        <span class="n">short_title</span> <span class="o">=</span> <span class="n">title</span>
</span><span id="L-2467"><a href="#L-2467"><span class="linenos">2467</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">table_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="p">{</span><span class="s2">&quot;TABLE&quot;</span><span class="p">:</span> <span class="n">key</span><span class="p">,</span>
</span><span id="L-2468"><a href="#L-2468"><span class="linenos">2468</span></a>                                <span class="s2">&quot;TITLE&quot;</span><span class="p">:</span> <span class="n">short_title</span><span class="p">,</span>
</span><span id="L-2469"><a href="#L-2469"><span class="linenos">2469</span></a>                                <span class="s2">&quot;FILENAME&quot;</span><span class="p">:</span> <span class="n">key</span><span class="o">+</span><span class="s2">&quot;.html&quot;</span><span class="p">,</span>
</span><span id="L-2470"><a href="#L-2470"><span class="linenos">2470</span></a>                                <span class="s2">&quot;TABLE-DESCRIPTION&quot;</span><span class="p">:</span> <span class="s2">&quot;This table displays the overall cost comparison for each office option.&quot;</span>
</span><span id="L-2471"><a href="#L-2471"><span class="linenos">2471</span></a>                                <span class="p">})</span>
</span><span id="L-2472"><a href="#L-2472"><span class="linenos">2472</span></a>        
</span><span id="L-2473"><a href="#L-2473"><span class="linenos">2473</span></a>        <span class="k">if</span> <span class="n">table</span> <span class="o">==</span> <span class="s2">&quot;_all&quot;</span> <span class="ow">or</span> <span class="n">table</span> <span class="o">==</span> <span class="n">key</span><span class="p">:</span>
</span><span id="L-2474"><a href="#L-2474"><span class="linenos">2474</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Generating table for: &quot;</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">table</span><span class="p">)</span>
</span><span id="L-2475"><a href="#L-2475"><span class="linenos">2475</span></a>            <span class="n">office</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">to_frame</span><span class="p">()</span><span class="o">.</span><span class="n">T</span>
</span><span id="L-2476"><a href="#L-2476"><span class="linenos">2476</span></a>            <span class="c1"># gather the data for the analysis</span>
</span><span id="L-2477"><a href="#L-2477"><span class="linenos">2477</span></a>            <span class="n">val_set</span><span class="p">,</span> <span class="n">base_costs</span><span class="p">,</span> <span class="n">cost_values</span><span class="p">,</span> <span class="n">average_diffs</span><span class="p">,</span> <span class="n">conservative_diffs</span><span class="p">,</span> <span class="n">withins</span><span class="p">,</span> <span class="n">employee_costs_to_office</span><span class="p">,</span> <span class="n">current_office</span><span class="p">,</span> <span class="n">other_offices</span> <span class="o">=</span> \
</span><span id="L-2478"><a href="#L-2478"><span class="linenos">2478</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">get_attrition_analysis</span><span class="p">(</span><span class="n">emp</span><span class="p">,</span> <span class="n">offices</span><span class="p">,</span> <span class="n">commute_data</span><span class="p">)</span>
</span><span id="L-2479"><a href="#L-2479"><span class="linenos">2479</span></a>
</span><span id="L-2480"><a href="#L-2480"><span class="linenos">2480</span></a>            <span class="c1"># commute related costs</span>
</span><span id="L-2481"><a href="#L-2481"><span class="linenos">2481</span></a>                <span class="c1"># pass</span>
</span><span id="L-2482"><a href="#L-2482"><span class="linenos">2482</span></a>            
</span><span id="L-2483"><a href="#L-2483"><span class="linenos">2483</span></a>            <span class="c1"># ####### employee attrition related costs</span>
</span><span id="L-2484"><a href="#L-2484"><span class="linenos">2484</span></a>            <span class="c1"># turnover threshold due to cost</span>
</span><span id="L-2485"><a href="#L-2485"><span class="linenos">2485</span></a>            <span class="n">median_salary</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">median_salary</span>
</span><span id="L-2486"><a href="#L-2486"><span class="linenos">2486</span></a>            <span class="n">threshold</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">turnover_threshold_due_to_cost</span><span class="o">*</span><span class="n">median_salary</span>
</span><span id="L-2487"><a href="#L-2487"><span class="linenos">2487</span></a>            <span class="n">daily_threshold</span> <span class="o">=</span> <span class="n">threshold</span><span class="o">/</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">commute_days_per_week</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">commute_weeks_per_year</span><span class="p">)</span>
</span><span id="L-2488"><a href="#L-2488"><span class="linenos">2488</span></a>            <span class="c1"># turnover probability due to time cost</span>
</span><span id="L-2489"><a href="#L-2489"><span class="linenos">2489</span></a>            <span class="n">turnover_probability_time_cost</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">turnover_probability_time_cost</span>
</span><span id="L-2490"><a href="#L-2490"><span class="linenos">2490</span></a>            <span class="c1"># employee replacement cost</span>
</span><span id="L-2491"><a href="#L-2491"><span class="linenos">2491</span></a>            <span class="n">employee_replacement_cost</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">employee_replacement_cost</span>
</span><span id="L-2492"><a href="#L-2492"><span class="linenos">2492</span></a>
</span><span id="L-2493"><a href="#L-2493"><span class="linenos">2493</span></a>
</span><span id="L-2494"><a href="#L-2494"><span class="linenos">2494</span></a>
</span><span id="L-2495"><a href="#L-2495"><span class="linenos">2495</span></a>
</span><span id="L-2496"><a href="#L-2496"><span class="linenos">2496</span></a>            <span class="c1"># ######## emissions related costs</span>
</span><span id="L-2497"><a href="#L-2497"><span class="linenos">2497</span></a>
</span><span id="L-2498"><a href="#L-2498"><span class="linenos">2498</span></a>            <span class="c1"># discount rate</span>
</span><span id="L-2499"><a href="#L-2499"><span class="linenos">2499</span></a>
</span><span id="L-2500"><a href="#L-2500"><span class="linenos">2500</span></a>
</span><span id="L-2501"><a href="#L-2501"><span class="linenos">2501</span></a>
</span><span id="L-2502"><a href="#L-2502"><span class="linenos">2502</span></a>
</span><span id="L-2503"><a href="#L-2503"><span class="linenos">2503</span></a>            <span class="c1"># create a dataframe with the office address and lat/long</span>
</span><span id="L-2504"><a href="#L-2504"><span class="linenos">2504</span></a>            <span class="n">location_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
</span><span id="L-2505"><a href="#L-2505"><span class="linenos">2505</span></a>            <span class="n">location_data</span><span class="p">[</span><span class="s1">&#39;Office Address&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;address&#39;</span><span class="p">]]</span>
</span><span id="L-2506"><a href="#L-2506"><span class="linenos">2506</span></a>            <span class="n">location_data</span><span class="p">[</span><span class="s1">&#39;Latitude&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;latitude&#39;</span><span class="p">]]</span>
</span><span id="L-2507"><a href="#L-2507"><span class="linenos">2507</span></a>            <span class="n">location_data</span><span class="p">[</span><span class="s1">&#39;Longitude&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;longitude&#39;</span><span class="p">]]</span>
</span><span id="L-2508"><a href="#L-2508"><span class="linenos">2508</span></a>            <span class="c1"># create a table</span>
</span><span id="L-2509"><a href="#L-2509"><span class="linenos">2509</span></a>            <span class="n">t</span> <span class="o">=</span> <span class="n">location_data</span><span class="o">.</span><span class="n">to_html</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="L-2510"><a href="#L-2510"><span class="linenos">2510</span></a>            <span class="c1"># write the table to a file</span>
</span><span id="L-2511"><a href="#L-2511"><span class="linenos">2511</span></a>            <span class="n">save_table</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>
</span><span id="L-2512"><a href="#L-2512"><span class="linenos">2512</span></a>
</span><span id="L-2513"><a href="#L-2513"><span class="linenos">2513</span></a>
</span><span id="L-2514"><a href="#L-2514"><span class="linenos">2514</span></a>
</span><span id="L-2515"><a href="#L-2515"><span class="linenos">2515</span></a>
</span><span id="L-2516"><a href="#L-2516"><span class="linenos">2516</span></a>
</span><span id="L-2517"><a href="#L-2517"><span class="linenos">2517</span></a>
</span><span id="L-2518"><a href="#L-2518"><span class="linenos">2518</span></a>
</span><span id="L-2519"><a href="#L-2519"><span class="linenos">2519</span></a>
</span><span id="L-2520"><a href="#L-2520"><span class="linenos">2520</span></a>
</span><span id="L-2521"><a href="#L-2521"><span class="linenos">2521</span></a>
</span><span id="L-2522"><a href="#L-2522"><span class="linenos">2522</span></a>
</span><span id="L-2523"><a href="#L-2523"><span class="linenos">2523</span></a>        <span class="c1"># write the graphs to tables.json in the project tables directory</span>
</span><span id="L-2524"><a href="#L-2524"><span class="linenos">2524</span></a>        <span class="c1"># convert self.tables_list to json</span>
</span><span id="L-2525"><a href="#L-2525"><span class="linenos">2525</span></a>        <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">table_list</span><span class="p">)</span>
</span><span id="L-2526"><a href="#L-2526"><span class="linenos">2526</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tables_dir</span><span class="p">,</span> <span class="s2">&quot;tables.json&quot;</span><span class="p">),</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="L-2527"><a href="#L-2527"><span class="linenos">2527</span></a>            <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">table_list</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
</span><span id="L-2528"><a href="#L-2528"><span class="linenos">2528</span></a>        
</span><span id="L-2529"><a href="#L-2529"><span class="linenos">2529</span></a>        <span class="c1"># update the analysis phase</span>
</span><span id="L-2530"><a href="#L-2530"><span class="linenos">2530</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">update_analysis_phase</span><span class="p">()</span>
</span><span id="L-2531"><a href="#L-2531"><span class="linenos">2531</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">table_list</span>
</span><span id="L-2532"><a href="#L-2532"><span class="linenos">2532</span></a>        <span class="c1">################################################################################</span>
</span><span id="L-2533"><a href="#L-2533"><span class="linenos">2533</span></a><span class="w">    </span>
</span><span id="L-2534"><a href="#L-2534"><span class="linenos">2534</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-2535"><a href="#L-2535"><span class="linenos">2535</span></a><span class="sd">        # Constants</span>
</span><span id="L-2536"><a href="#L-2536"><span class="linenos">2536</span></a><span class="sd">    annual_savings = 0.25  # in millions</span>
</span><span id="L-2537"><a href="#L-2537"><span class="linenos">2537</span></a><span class="sd">    attrition_costs_year_1 = 0.05  # in millions</span>
</span><span id="L-2538"><a href="#L-2538"><span class="linenos">2538</span></a><span class="sd">    annual_emissions_costs = 0.01  # in millions</span>
</span><span id="L-2539"><a href="#L-2539"><span class="linenos">2539</span></a><span class="sd">    discount_rate = 0.05</span>
</span><span id="L-2540"><a href="#L-2540"><span class="linenos">2540</span></a><span class="sd">    years = 5</span>
</span><span id="L-2541"><a href="#L-2541"><span class="linenos">2541</span></a>
</span><span id="L-2542"><a href="#L-2542"><span class="linenos">2542</span></a><span class="sd">    # Calculating NPV</span>
</span><span id="L-2543"><a href="#L-2543"><span class="linenos">2543</span></a><span class="sd">    npv = 0</span>
</span><span id="L-2544"><a href="#L-2544"><span class="linenos">2544</span></a>
</span><span id="L-2545"><a href="#L-2545"><span class="linenos">2545</span></a><span class="sd">    # Year 1 cash flow (including attrition cost)</span>
</span><span id="L-2546"><a href="#L-2546"><span class="linenos">2546</span></a><span class="sd">    year_1_net_savings = annual_savings - attrition_costs_year_1</span>
</span><span id="L-2547"><a href="#L-2547"><span class="linenos">2547</span></a><span class="sd">    npv += year_1_net_savings / (1 + discount_rate)**1</span>
</span><span id="L-2548"><a href="#L-2548"><span class="linenos">2548</span></a>
</span><span id="L-2549"><a href="#L-2549"><span class="linenos">2549</span></a><span class="sd">    # Years 2-5 cash flows (including emissions costs)</span>
</span><span id="L-2550"><a href="#L-2550"><span class="linenos">2550</span></a><span class="sd">    for year in range(2, years + 1):</span>
</span><span id="L-2551"><a href="#L-2551"><span class="linenos">2551</span></a><span class="sd">        annual_net_savings = annual_savings - annual_emissions_costs</span>
</span><span id="L-2552"><a href="#L-2552"><span class="linenos">2552</span></a><span class="sd">        npv += annual_net_savings / (1 + discount_rate)**year</span>
</span><span id="L-2553"><a href="#L-2553"><span class="linenos">2553</span></a>
</span><span id="L-2554"><a href="#L-2554"><span class="linenos">2554</span></a><span class="sd">    npv</span>
</span><span id="L-2555"><a href="#L-2555"><span class="linenos">2555</span></a>
</span><span id="L-2556"><a href="#L-2556"><span class="linenos">2556</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-2557"><a href="#L-2557"><span class="linenos">2557</span></a>    <span class="k">def</span> <span class="nf">get_attrition_analysis</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">emp</span><span class="p">,</span> <span class="n">offices</span><span class="p">,</span> <span class="n">commute_data</span><span class="p">):</span>
</span><span id="L-2558"><a href="#L-2558"><span class="linenos">2558</span></a>        <span class="c1"># helper function to get a base cost dataframe</span>
</span><span id="L-2559"><a href="#L-2559"><span class="linenos">2559</span></a>        <span class="k">def</span> <span class="nf">get_base_cost_df</span><span class="p">(</span><span class="n">emp</span><span class="p">,</span> <span class="n">officeaddr</span><span class="p">):</span>
</span><span id="L-2560"><a href="#L-2560"><span class="linenos">2560</span></a>            <span class="n">rows</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-2561"><a href="#L-2561"><span class="linenos">2561</span></a>            <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">emp</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
</span><span id="L-2562"><a href="#L-2562"><span class="linenos">2562</span></a>                <span class="n">cost</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="L-2563"><a href="#L-2563"><span class="linenos">2563</span></a>                <span class="n">rows</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s1">&#39;latitude&#39;</span><span class="p">:</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;latitude&#39;</span><span class="p">],</span><span class="s1">&#39;longitude&#39;</span><span class="p">:</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;longitude&#39;</span><span class="p">],</span><span class="s1">&#39;office&#39;</span><span class="p">:</span><span class="n">officeaddr</span><span class="p">,</span><span class="s1">&#39;cost&#39;</span><span class="p">:</span><span class="n">cost</span><span class="p">})</span>
</span><span id="L-2564"><a href="#L-2564"><span class="linenos">2564</span></a>            <span class="c1">#cost_df = pd.DataFrame(rows)</span>
</span><span id="L-2565"><a href="#L-2565"><span class="linenos">2565</span></a>            <span class="k">return</span> <span class="n">rows</span>
</span><span id="L-2566"><a href="#L-2566"><span class="linenos">2566</span></a>        
</span><span id="L-2567"><a href="#L-2567"><span class="linenos">2567</span></a>        <span class="n">employee_costs_to_office</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-2568"><a href="#L-2568"><span class="linenos">2568</span></a>        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">offices</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>    
</span><span id="L-2569"><a href="#L-2569"><span class="linenos">2569</span></a>            <span class="n">office</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">to_frame</span><span class="p">()</span><span class="o">.</span><span class="n">T</span>
</span><span id="L-2570"><a href="#L-2570"><span class="linenos">2570</span></a>            
</span><span id="L-2571"><a href="#L-2571"><span class="linenos">2571</span></a>            <span class="c1"># get the needed commute values</span>
</span><span id="L-2572"><a href="#L-2572"><span class="linenos">2572</span></a>            <span class="n">values</span> <span class="o">=</span> <span class="n">commute_data</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span>
</span><span id="L-2573"><a href="#L-2573"><span class="linenos">2573</span></a>            
</span><span id="L-2574"><a href="#L-2574"><span class="linenos">2574</span></a>            <span class="n">mornings</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;m_morning_duration_in_traffic&#39;</span><span class="p">,</span><span class="s1">&#39;t_morning_duration_in_traffic&#39;</span><span class="p">,</span><span class="s1">&#39;w_morning_duration_in_traffic&#39;</span><span class="p">,</span><span class="s1">&#39;h_morning_duration_in_traffic&#39;</span><span class="p">,</span><span class="s1">&#39;f_morning_duration_in_traffic&#39;</span><span class="p">]</span>
</span><span id="L-2575"><a href="#L-2575"><span class="linenos">2575</span></a>            <span class="n">evenings</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;m_evening_duration_in_traffic&#39;</span><span class="p">,</span><span class="s1">&#39;t_evening_duration_in_traffic&#39;</span><span class="p">,</span><span class="s1">&#39;w_evening_duration_in_traffic&#39;</span><span class="p">,</span><span class="s1">&#39;h_evening_duration_in_traffic&#39;</span><span class="p">,</span><span class="s1">&#39;f_evening_duration_in_traffic&#39;</span><span class="p">]</span>
</span><span id="L-2576"><a href="#L-2576"><span class="linenos">2576</span></a>            
</span><span id="L-2577"><a href="#L-2577"><span class="linenos">2577</span></a>            <span class="n">cdpw</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">commute_days_per_week</span>
</span><span id="L-2578"><a href="#L-2578"><span class="linenos">2578</span></a>
</span><span id="L-2579"><a href="#L-2579"><span class="linenos">2579</span></a>            <span class="n">emp_within</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graphing</span><span class="o">.</span><span class="n">filter_drive_distance</span><span class="p">(</span><span class="n">emp</span><span class="p">,</span><span class="n">office</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">commute_range_cut_off</span><span class="p">,</span> <span class="n">commute_data</span><span class="o">=</span><span class="n">commute_data</span><span class="p">)</span>
</span><span id="L-2580"><a href="#L-2580"><span class="linenos">2580</span></a>            <span class="n">val_set</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graphing</span><span class="o">.</span><span class="n">get_commute_values</span><span class="p">(</span><span class="n">emp_within</span><span class="p">,</span> <span class="n">office</span><span class="p">,</span> <span class="n">commute_data</span><span class="p">,</span> <span class="n">values</span><span class="p">)</span>
</span><span id="L-2581"><a href="#L-2581"><span class="linenos">2581</span></a>            
</span><span id="L-2582"><a href="#L-2582"><span class="linenos">2582</span></a>            <span class="c1"># restore val_set columns latitutde and longitude to origin_lat and origin_long</span>
</span><span id="L-2583"><a href="#L-2583"><span class="linenos">2583</span></a>            <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;origin_lat&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;latitude&#39;</span><span class="p">]</span>
</span><span id="L-2584"><a href="#L-2584"><span class="linenos">2584</span></a>            <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;origin_long&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;longitude&#39;</span><span class="p">]</span>
</span><span id="L-2585"><a href="#L-2585"><span class="linenos">2585</span></a>
</span><span id="L-2586"><a href="#L-2586"><span class="linenos">2586</span></a>            
</span><span id="L-2587"><a href="#L-2587"><span class="linenos">2587</span></a>
</span><span id="L-2588"><a href="#L-2588"><span class="linenos">2588</span></a>            <span class="c1"># Calculate and insert the average morning and evening commute times directly into val_set</span>
</span><span id="L-2589"><a href="#L-2589"><span class="linenos">2589</span></a>            <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;Morning Average&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">val_set</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">mornings</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="L-2590"><a href="#L-2590"><span class="linenos">2590</span></a>            <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;Evening Average&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">val_set</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">evenings</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="L-2591"><a href="#L-2591"><span class="linenos">2591</span></a>
</span><span id="L-2592"><a href="#L-2592"><span class="linenos">2592</span></a>            <span class="c1"># Calculate and insert the top &#39;cdpw&#39; maximum morning and evening commute times</span>
</span><span id="L-2593"><a href="#L-2593"><span class="linenos">2593</span></a>            <span class="c1"># Note: Adjust the code below to calculate the averages of the top &#39;cdpw&#39; as new columns directly</span>
</span><span id="L-2594"><a href="#L-2594"><span class="linenos">2594</span></a>            <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;Average Top CDPW Morning&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">val_set</span><span class="p">[</span><span class="n">mornings</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="n">row</span><span class="o">.</span><span class="n">nlargest</span><span class="p">(</span><span class="n">cdpw</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="L-2595"><a href="#L-2595"><span class="linenos">2595</span></a>            <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;Average Top CDPW Evening&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">val_set</span><span class="p">[</span><span class="n">evenings</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="n">row</span><span class="o">.</span><span class="n">nlargest</span><span class="p">(</span><span class="n">cdpw</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="L-2596"><a href="#L-2596"><span class="linenos">2596</span></a>
</span><span id="L-2597"><a href="#L-2597"><span class="linenos">2597</span></a>            <span class="c1"># Calculate a per-minute cost based on &quot;median_salary&quot; and &quot;hours_per_year&quot;</span>
</span><span id="L-2598"><a href="#L-2598"><span class="linenos">2598</span></a>            <span class="n">per_minute_cost</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">median_salary</span> <span class="o">/</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">hours_per_year</span> <span class="o">*</span> <span class="mi">60</span><span class="p">)</span>
</span><span id="L-2599"><a href="#L-2599"><span class="linenos">2599</span></a>
</span><span id="L-2600"><a href="#L-2600"><span class="linenos">2600</span></a>            <span class="c1"># Calculate and insert the average cost for the week directly into val_set</span>
</span><span id="L-2601"><a href="#L-2601"><span class="linenos">2601</span></a>            <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;Morning Average Cost&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;Morning Average&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">per_minute_cost</span>
</span><span id="L-2602"><a href="#L-2602"><span class="linenos">2602</span></a>            <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;Evening Average Cost&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;Evening Average&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">per_minute_cost</span>
</span><span id="L-2603"><a href="#L-2603"><span class="linenos">2603</span></a>
</span><span id="L-2604"><a href="#L-2604"><span class="linenos">2604</span></a>            <span class="c1"># Calculate and insert the high/conservative cost for the week directly into val_set</span>
</span><span id="L-2605"><a href="#L-2605"><span class="linenos">2605</span></a>            <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;Morning High Cost&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;Average Top CDPW Morning&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">per_minute_cost</span>
</span><span id="L-2606"><a href="#L-2606"><span class="linenos">2606</span></a>            <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;Evening High Cost&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;Average Top CDPW Evening&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">per_minute_cost</span>
</span><span id="L-2607"><a href="#L-2607"><span class="linenos">2607</span></a>
</span><span id="L-2608"><a href="#L-2608"><span class="linenos">2608</span></a>            <span class="c1"># Calculate a Total Average Time and Total High Time cost</span>
</span><span id="L-2609"><a href="#L-2609"><span class="linenos">2609</span></a>            <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;Total Average Time Cost&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;Morning Average Cost&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;Evening Average Cost&#39;</span><span class="p">]</span>
</span><span id="L-2610"><a href="#L-2610"><span class="linenos">2610</span></a>            <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;Total High Time Cost&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;Morning High Cost&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;Evening High Cost&#39;</span><span class="p">]</span>
</span><span id="L-2611"><a href="#L-2611"><span class="linenos">2611</span></a>
</span><span id="L-2612"><a href="#L-2612"><span class="linenos">2612</span></a>            <span class="c1"># Calculate a Total Average Cost and Total High Cost</span>
</span><span id="L-2613"><a href="#L-2613"><span class="linenos">2613</span></a>            <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;Total Average Cost&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;Total Average Time Cost&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;commute_cost&#39;</span><span class="p">]</span>
</span><span id="L-2614"><a href="#L-2614"><span class="linenos">2614</span></a>            <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;Total High Cost&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;Total High Time Cost&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;commute_cost&#39;</span><span class="p">]</span>
</span><span id="L-2615"><a href="#L-2615"><span class="linenos">2615</span></a>            
</span><span id="L-2616"><a href="#L-2616"><span class="linenos">2616</span></a>            <span class="c1"># add the current val_set to the employee_costs_to_office dictionary</span>
</span><span id="L-2617"><a href="#L-2617"><span class="linenos">2617</span></a>            <span class="n">employee_costs_to_office</span><span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;address&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">val_set</span>
</span><span id="L-2618"><a href="#L-2618"><span class="linenos">2618</span></a>        
</span><span id="L-2619"><a href="#L-2619"><span class="linenos">2619</span></a>        <span class="c1"># employees to analyze are within the cutoff distance for this office</span>
</span><span id="L-2620"><a href="#L-2620"><span class="linenos">2620</span></a>        <span class="c1"># for this analysis, we need to iterate through options</span>
</span><span id="L-2621"><a href="#L-2621"><span class="linenos">2621</span></a>        <span class="n">current_office</span> <span class="o">=</span> <span class="n">offices</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">to_frame</span><span class="p">()</span><span class="o">.</span><span class="n">T</span>
</span><span id="L-2622"><a href="#L-2622"><span class="linenos">2622</span></a>        <span class="n">other_offices</span> <span class="o">=</span> <span class="n">offices</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="L-2623"><a href="#L-2623"><span class="linenos">2623</span></a>        <span class="n">cost_values</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-2624"><a href="#L-2624"><span class="linenos">2624</span></a>        <span class="n">withins</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-2625"><a href="#L-2625"><span class="linenos">2625</span></a>        <span class="n">commutes</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">commute_days_per_week</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">commute_weeks_per_year</span>
</span><span id="L-2626"><a href="#L-2626"><span class="linenos">2626</span></a>        
</span><span id="L-2627"><a href="#L-2627"><span class="linenos">2627</span></a>        <span class="c1"># for each employee, calculate the commute cost to the current office, place a new dataframe with lat, long, office, and cost</span>
</span><span id="L-2628"><a href="#L-2628"><span class="linenos">2628</span></a>        <span class="c1"># if the employee is within the cutoff distance, if outside the cutoff distance, the cost is 0</span>
</span><span id="L-2629"><a href="#L-2629"><span class="linenos">2629</span></a>        <span class="c1"># start by looping through ALL employees and adding a row with the current office, and cost = 0</span>
</span><span id="L-2630"><a href="#L-2630"><span class="linenos">2630</span></a>                
</span><span id="L-2631"><a href="#L-2631"><span class="linenos">2631</span></a>
</span><span id="L-2632"><a href="#L-2632"><span class="linenos">2632</span></a>        <span class="n">base_costs</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">get_base_cost_df</span><span class="p">(</span><span class="n">emp</span><span class="p">,</span> <span class="n">current_office</span><span class="p">[</span><span class="s1">&#39;address&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
</span><span id="L-2633"><a href="#L-2633"><span class="linenos">2633</span></a>        <span class="c1"># add columns for total average cost and total high cost</span>
</span><span id="L-2634"><a href="#L-2634"><span class="linenos">2634</span></a>        <span class="n">base_costs</span><span class="p">[</span><span class="s1">&#39;Total Average Cost&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="L-2635"><a href="#L-2635"><span class="linenos">2635</span></a>        <span class="n">base_costs</span><span class="p">[</span><span class="s1">&#39;Total High Cost&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="L-2636"><a href="#L-2636"><span class="linenos">2636</span></a>        <span class="c1"># now get emp_within for the current office, and update the relevant rows of base_costs with actual costs for those employees </span>
</span><span id="L-2637"><a href="#L-2637"><span class="linenos">2637</span></a>        <span class="c1"># using the commute_cost column in the commute_data dataframe where the employee lat long matches the commute_data lat long and office address</span>
</span><span id="L-2638"><a href="#L-2638"><span class="linenos">2638</span></a>        
</span><span id="L-2639"><a href="#L-2639"><span class="linenos">2639</span></a>        <span class="n">base_emp_within</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graphing</span><span class="o">.</span><span class="n">filter_drive_distance</span><span class="p">(</span><span class="n">emp</span><span class="p">,</span><span class="n">current_office</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">commute_range_cut_off</span><span class="p">,</span> <span class="n">commute_data</span><span class="o">=</span><span class="n">commute_data</span><span class="p">)</span>
</span><span id="L-2640"><a href="#L-2640"><span class="linenos">2640</span></a>
</span><span id="L-2641"><a href="#L-2641"><span class="linenos">2641</span></a>        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">base_emp_within</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
</span><span id="L-2642"><a href="#L-2642"><span class="linenos">2642</span></a>            <span class="c1"># set val_set from the employee_costs_to_office = {} dictionary</span>
</span><span id="L-2643"><a href="#L-2643"><span class="linenos">2643</span></a>            <span class="n">val_set</span> <span class="o">=</span> <span class="n">employee_costs_to_office</span><span class="p">[</span><span class="n">current_office</span><span class="p">[</span><span class="s1">&#39;address&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
</span><span id="L-2644"><a href="#L-2644"><span class="linenos">2644</span></a>            <span class="c1"># get the cost from the commute_data</span>
</span><span id="L-2645"><a href="#L-2645"><span class="linenos">2645</span></a>            <span class="n">avg_cost</span> <span class="o">=</span> <span class="n">val_set</span><span class="p">[(</span><span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;origin_lat&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;latitude&#39;</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;origin_long&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;longitude&#39;</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;office_address&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">current_office</span><span class="p">[</span><span class="s1">&#39;address&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">])][</span><span class="s1">&#39;Total Average Cost&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-2646"><a href="#L-2646"><span class="linenos">2646</span></a>            <span class="n">conservative_cost</span> <span class="o">=</span> <span class="n">val_set</span><span class="p">[(</span><span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;origin_lat&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;latitude&#39;</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;origin_long&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;longitude&#39;</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;office_address&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">current_office</span><span class="p">[</span><span class="s1">&#39;address&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">])][</span><span class="s1">&#39;Total High Cost&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-2647"><a href="#L-2647"><span class="linenos">2647</span></a>            <span class="n">base_costs</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">base_costs</span><span class="p">[</span><span class="s1">&#39;latitude&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;latitude&#39;</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">base_costs</span><span class="p">[</span><span class="s1">&#39;longitude&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;longitude&#39;</span><span class="p">]),</span><span class="s1">&#39;Total Average Cost&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">avg_cost</span>
</span><span id="L-2648"><a href="#L-2648"><span class="linenos">2648</span></a>            <span class="n">base_costs</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">base_costs</span><span class="p">[</span><span class="s1">&#39;latitude&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;latitude&#39;</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">base_costs</span><span class="p">[</span><span class="s1">&#39;longitude&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;longitude&#39;</span><span class="p">]),</span><span class="s1">&#39;Total High Cost&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">conservative_cost</span>
</span><span id="L-2649"><a href="#L-2649"><span class="linenos">2649</span></a>
</span><span id="L-2650"><a href="#L-2650"><span class="linenos">2650</span></a>        <span class="c1"># now we have a dataframe with all employees, and the cost to the current office</span>
</span><span id="L-2651"><a href="#L-2651"><span class="linenos">2651</span></a>    
</span><span id="L-2652"><a href="#L-2652"><span class="linenos">2652</span></a>        <span class="c1"># now iterate through the other offices, get a base cost dataframe, and then update the relevant rows with actual costs, place in cost_values</span>
</span><span id="L-2653"><a href="#L-2653"><span class="linenos">2653</span></a>        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">other_offices</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
</span><span id="L-2654"><a href="#L-2654"><span class="linenos">2654</span></a>            <span class="n">office</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">to_frame</span><span class="p">()</span><span class="o">.</span><span class="n">T</span>
</span><span id="L-2655"><a href="#L-2655"><span class="linenos">2655</span></a>            <span class="n">tmp_costs</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">get_base_cost_df</span><span class="p">(</span><span class="n">emp</span><span class="p">,</span> <span class="n">office</span><span class="p">[</span><span class="s1">&#39;address&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
</span><span id="L-2656"><a href="#L-2656"><span class="linenos">2656</span></a>            <span class="c1"># add columns for total average cost and total high cost</span>
</span><span id="L-2657"><a href="#L-2657"><span class="linenos">2657</span></a>            <span class="n">tmp_costs</span><span class="p">[</span><span class="s1">&#39;Total Average Cost&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="L-2658"><a href="#L-2658"><span class="linenos">2658</span></a>            <span class="n">tmp_costs</span><span class="p">[</span><span class="s1">&#39;Total High Cost&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="L-2659"><a href="#L-2659"><span class="linenos">2659</span></a>            <span class="n">emp_within</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graphing</span><span class="o">.</span><span class="n">filter_drive_distance</span><span class="p">(</span><span class="n">emp</span><span class="p">,</span><span class="n">office</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">commute_range_cut_off</span><span class="p">,</span> <span class="n">commute_data</span><span class="o">=</span><span class="n">commute_data</span><span class="p">)</span>
</span><span id="L-2660"><a href="#L-2660"><span class="linenos">2660</span></a>            <span class="c1"># we will use this later to get the differential for each employee, without the employees that aren&#39;t overlapping</span>
</span><span id="L-2661"><a href="#L-2661"><span class="linenos">2661</span></a>            <span class="n">withins</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">emp_within</span><span class="p">)</span>
</span><span id="L-2662"><a href="#L-2662"><span class="linenos">2662</span></a>
</span><span id="L-2663"><a href="#L-2663"><span class="linenos">2663</span></a>            <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">emp_within</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
</span><span id="L-2664"><a href="#L-2664"><span class="linenos">2664</span></a>                <span class="c1"># set val_set from the employee_costs_to_office = {} dictionary</span>
</span><span id="L-2665"><a href="#L-2665"><span class="linenos">2665</span></a>                <span class="n">val_set</span> <span class="o">=</span> <span class="n">employee_costs_to_office</span><span class="p">[</span><span class="n">office</span><span class="p">[</span><span class="s1">&#39;address&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
</span><span id="L-2666"><a href="#L-2666"><span class="linenos">2666</span></a>                <span class="c1"># get the cost from the commute_data</span>
</span><span id="L-2667"><a href="#L-2667"><span class="linenos">2667</span></a>                <span class="n">avg_cost</span> <span class="o">=</span> <span class="n">val_set</span><span class="p">[(</span><span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;origin_lat&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;latitude&#39;</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;origin_long&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;longitude&#39;</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;office_address&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">office</span><span class="p">[</span><span class="s1">&#39;address&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">])][</span><span class="s1">&#39;Total Average Cost&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-2668"><a href="#L-2668"><span class="linenos">2668</span></a>                <span class="n">conservative_cost</span> <span class="o">=</span> <span class="n">val_set</span><span class="p">[(</span><span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;origin_lat&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;latitude&#39;</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;origin_long&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;longitude&#39;</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;office_address&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">office</span><span class="p">[</span><span class="s1">&#39;address&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">])][</span><span class="s1">&#39;Total High Cost&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-2669"><a href="#L-2669"><span class="linenos">2669</span></a>                <span class="n">tmp_costs</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">tmp_costs</span><span class="p">[</span><span class="s1">&#39;latitude&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;latitude&#39;</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">tmp_costs</span><span class="p">[</span><span class="s1">&#39;longitude&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;longitude&#39;</span><span class="p">]),</span><span class="s1">&#39;Total Average Cost&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">avg_cost</span>
</span><span id="L-2670"><a href="#L-2670"><span class="linenos">2670</span></a>                <span class="n">tmp_costs</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">tmp_costs</span><span class="p">[</span><span class="s1">&#39;latitude&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;latitude&#39;</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">tmp_costs</span><span class="p">[</span><span class="s1">&#39;longitude&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;longitude&#39;</span><span class="p">]),</span><span class="s1">&#39;Total High Cost&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">conservative_cost</span>
</span><span id="L-2671"><a href="#L-2671"><span class="linenos">2671</span></a>            
</span><span id="L-2672"><a href="#L-2672"><span class="linenos">2672</span></a>            <span class="n">cost_values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tmp_costs</span><span class="p">)</span>
</span><span id="L-2673"><a href="#L-2673"><span class="linenos">2673</span></a>            
</span><span id="L-2674"><a href="#L-2674"><span class="linenos">2674</span></a>        <span class="c1"># now we have a full list of costs for each employee to each office, we can get the differentials</span>
</span><span id="L-2675"><a href="#L-2675"><span class="linenos">2675</span></a>        <span class="c1"># create a list to hold the differential dataframes</span>
</span><span id="L-2676"><a href="#L-2676"><span class="linenos">2676</span></a>        <span class="n">average_diffs</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-2677"><a href="#L-2677"><span class="linenos">2677</span></a>        <span class="n">conservative_diffs</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-2678"><a href="#L-2678"><span class="linenos">2678</span></a>        <span class="c1"># for each cost dataframe, calculate the differential from the base_costs dataframe into a new dataframe</span>
</span><span id="L-2679"><a href="#L-2679"><span class="linenos">2679</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">cost_values</span><span class="p">)):</span>
</span><span id="L-2680"><a href="#L-2680"><span class="linenos">2680</span></a>            <span class="c1"># get the differential</span>
</span><span id="L-2681"><a href="#L-2681"><span class="linenos">2681</span></a>            <span class="n">average_diffs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cost_values</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;Total Average Cost&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">base_costs</span><span class="p">[</span><span class="s1">&#39;Total Average Cost&#39;</span><span class="p">])</span>
</span><span id="L-2682"><a href="#L-2682"><span class="linenos">2682</span></a>            <span class="n">conservative_diffs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cost_values</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;Total High Cost&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">base_costs</span><span class="p">[</span><span class="s1">&#39;Total High Cost&#39;</span><span class="p">])</span>
</span><span id="L-2683"><a href="#L-2683"><span class="linenos">2683</span></a>
</span><span id="L-2684"><a href="#L-2684"><span class="linenos">2684</span></a>        <span class="k">return</span> <span class="n">base_costs</span><span class="p">,</span> <span class="n">cost_values</span><span class="p">,</span> <span class="n">average_diffs</span><span class="p">,</span> <span class="n">conservative_diffs</span><span class="p">,</span> <span class="n">withins</span><span class="p">,</span> <span class="n">employee_costs_to_office</span><span class="p">,</span> <span class="n">current_office</span><span class="p">,</span> <span class="n">other_offices</span>
</span><span id="L-2685"><a href="#L-2685"><span class="linenos">2685</span></a>    
</span><span id="L-2686"><a href="#L-2686"><span class="linenos">2686</span></a>
</span><span id="L-2687"><a href="#L-2687"><span class="linenos">2687</span></a>
</span><span id="L-2688"><a href="#L-2688"><span class="linenos">2688</span></a>
</span><span id="L-2689"><a href="#L-2689"><span class="linenos">2689</span></a>
</span><span id="L-2690"><a href="#L-2690"><span class="linenos">2690</span></a>    <span class="k">def</span> <span class="nf">get_emissions_analysis</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">emp</span><span class="p">,</span> <span class="n">offices</span><span class="p">,</span> <span class="n">commute_data</span><span class="p">):</span>
</span><span id="L-2691"><a href="#L-2691"><span class="linenos">2691</span></a>        <span class="c1"># helper function to get a base cost dataframe</span>
</span><span id="L-2692"><a href="#L-2692"><span class="linenos">2692</span></a>        <span class="k">def</span> <span class="nf">get_base_cost_df</span><span class="p">(</span><span class="n">emp</span><span class="p">,</span> <span class="n">officeaddr</span><span class="p">):</span>
</span><span id="L-2693"><a href="#L-2693"><span class="linenos">2693</span></a>            <span class="n">rows</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-2694"><a href="#L-2694"><span class="linenos">2694</span></a>            <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">emp</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
</span><span id="L-2695"><a href="#L-2695"><span class="linenos">2695</span></a>                <span class="n">cost</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="L-2696"><a href="#L-2696"><span class="linenos">2696</span></a>                <span class="n">rows</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s1">&#39;latitude&#39;</span><span class="p">:</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;latitude&#39;</span><span class="p">],</span><span class="s1">&#39;longitude&#39;</span><span class="p">:</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;longitude&#39;</span><span class="p">],</span><span class="s1">&#39;office&#39;</span><span class="p">:</span><span class="n">officeaddr</span><span class="p">,</span><span class="s1">&#39;cost&#39;</span><span class="p">:</span><span class="n">cost</span><span class="p">})</span>
</span><span id="L-2697"><a href="#L-2697"><span class="linenos">2697</span></a>            <span class="c1">#cost_df = pd.DataFrame(rows)</span>
</span><span id="L-2698"><a href="#L-2698"><span class="linenos">2698</span></a>            <span class="k">return</span> <span class="n">rows</span>
</span><span id="L-2699"><a href="#L-2699"><span class="linenos">2699</span></a>        
</span><span id="L-2700"><a href="#L-2700"><span class="linenos">2700</span></a>        <span class="n">employee_costs_to_office</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-2701"><a href="#L-2701"><span class="linenos">2701</span></a>        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">offices</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>    
</span><span id="L-2702"><a href="#L-2702"><span class="linenos">2702</span></a>            <span class="n">office</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">to_frame</span><span class="p">()</span><span class="o">.</span><span class="n">T</span>
</span><span id="L-2703"><a href="#L-2703"><span class="linenos">2703</span></a>            
</span><span id="L-2704"><a href="#L-2704"><span class="linenos">2704</span></a>            <span class="c1"># get the needed commute values</span>
</span><span id="L-2705"><a href="#L-2705"><span class="linenos">2705</span></a>            <span class="n">values</span> <span class="o">=</span> <span class="n">commute_data</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span>
</span><span id="L-2706"><a href="#L-2706"><span class="linenos">2706</span></a>            
</span><span id="L-2707"><a href="#L-2707"><span class="linenos">2707</span></a>            <span class="n">mornings</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;m_morning_emissions&#39;</span><span class="p">,</span><span class="s1">&#39;t_morning_emissions&#39;</span><span class="p">,</span><span class="s1">&#39;w_morning_emissions&#39;</span><span class="p">,</span><span class="s1">&#39;h_morning_emissions&#39;</span><span class="p">,</span><span class="s1">&#39;f_morning_emissions&#39;</span><span class="p">]</span>
</span><span id="L-2708"><a href="#L-2708"><span class="linenos">2708</span></a>            <span class="n">evenings</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;m_evening_emissions&#39;</span><span class="p">,</span><span class="s1">&#39;t_evening_emissions&#39;</span><span class="p">,</span><span class="s1">&#39;w_evening_emissions&#39;</span><span class="p">,</span><span class="s1">&#39;h_evening_emissions&#39;</span><span class="p">,</span><span class="s1">&#39;f_evening_emissions&#39;</span><span class="p">]</span>
</span><span id="L-2709"><a href="#L-2709"><span class="linenos">2709</span></a>            
</span><span id="L-2710"><a href="#L-2710"><span class="linenos">2710</span></a>            <span class="n">cdpw</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">commute_days_per_week</span>
</span><span id="L-2711"><a href="#L-2711"><span class="linenos">2711</span></a>
</span><span id="L-2712"><a href="#L-2712"><span class="linenos">2712</span></a>            <span class="n">emp_within</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graphing</span><span class="o">.</span><span class="n">filter_drive_distance</span><span class="p">(</span><span class="n">emp</span><span class="p">,</span><span class="n">office</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">commute_range_cut_off</span><span class="p">,</span> <span class="n">commute_data</span><span class="o">=</span><span class="n">commute_data</span><span class="p">)</span>
</span><span id="L-2713"><a href="#L-2713"><span class="linenos">2713</span></a>            <span class="n">val_set</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graphing</span><span class="o">.</span><span class="n">get_commute_values</span><span class="p">(</span><span class="n">emp_within</span><span class="p">,</span> <span class="n">office</span><span class="p">,</span> <span class="n">commute_data</span><span class="p">,</span> <span class="n">values</span><span class="p">)</span>
</span><span id="L-2714"><a href="#L-2714"><span class="linenos">2714</span></a>            
</span><span id="L-2715"><a href="#L-2715"><span class="linenos">2715</span></a>            <span class="c1"># restore val_set columns latitutde and longitude to origin_lat and origin_long</span>
</span><span id="L-2716"><a href="#L-2716"><span class="linenos">2716</span></a>            <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;origin_lat&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;latitude&#39;</span><span class="p">]</span>
</span><span id="L-2717"><a href="#L-2717"><span class="linenos">2717</span></a>            <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;origin_long&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;longitude&#39;</span><span class="p">]</span>
</span><span id="L-2718"><a href="#L-2718"><span class="linenos">2718</span></a>
</span><span id="L-2719"><a href="#L-2719"><span class="linenos">2719</span></a>            <span class="c1"># Calculate and insert the average morning and evening commute times directly into val_set</span>
</span><span id="L-2720"><a href="#L-2720"><span class="linenos">2720</span></a>            <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;Morning Average&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">val_set</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">mornings</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="L-2721"><a href="#L-2721"><span class="linenos">2721</span></a>            <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;Evening Average&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">val_set</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">evenings</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="L-2722"><a href="#L-2722"><span class="linenos">2722</span></a>            
</span><span id="L-2723"><a href="#L-2723"><span class="linenos">2723</span></a>            <span class="c1"># Calculate and insert the top &#39;cdpw&#39; maximum morning and evening commute times</span>
</span><span id="L-2724"><a href="#L-2724"><span class="linenos">2724</span></a>            <span class="c1"># Note: Adjust the code below to calculate the averages of the top &#39;cdpw&#39; as new columns directly</span>
</span><span id="L-2725"><a href="#L-2725"><span class="linenos">2725</span></a>            <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;Average Top CDPW Morning&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">val_set</span><span class="p">[</span><span class="n">mornings</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="n">row</span><span class="o">.</span><span class="n">nlargest</span><span class="p">(</span><span class="n">cdpw</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="L-2726"><a href="#L-2726"><span class="linenos">2726</span></a>            <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;Average Top CDPW Evening&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">val_set</span><span class="p">[</span><span class="n">evenings</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="n">row</span><span class="o">.</span><span class="n">nlargest</span><span class="p">(</span><span class="n">cdpw</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="L-2727"><a href="#L-2727"><span class="linenos">2727</span></a>            
</span><span id="L-2728"><a href="#L-2728"><span class="linenos">2728</span></a>            <span class="c1"># emissions figure are in kg/commute. To get cost we need the CO2_credit_cost, which is $/metric ton</span>
</span><span id="L-2729"><a href="#L-2729"><span class="linenos">2729</span></a>            <span class="n">per_kg_CO2_cost</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">CO2_credit_cost</span> <span class="o">/</span> <span class="mi">1000</span>
</span><span id="L-2730"><a href="#L-2730"><span class="linenos">2730</span></a>
</span><span id="L-2731"><a href="#L-2731"><span class="linenos">2731</span></a>            <span class="c1"># Calculate and insert the average cost for the week directly into val_set</span>
</span><span id="L-2732"><a href="#L-2732"><span class="linenos">2732</span></a>            <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;Morning Average Cost&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;Morning Average&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">per_kg_CO2_cost</span>
</span><span id="L-2733"><a href="#L-2733"><span class="linenos">2733</span></a>            <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;Evening Average Cost&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;Evening Average&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">per_kg_CO2_cost</span>
</span><span id="L-2734"><a href="#L-2734"><span class="linenos">2734</span></a>            
</span><span id="L-2735"><a href="#L-2735"><span class="linenos">2735</span></a>            <span class="c1"># Calculate and insert the high/conservative cost for the week directly into val_set</span>
</span><span id="L-2736"><a href="#L-2736"><span class="linenos">2736</span></a>            <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;Morning High Cost&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;Average Top CDPW Morning&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">per_kg_CO2_cost</span>
</span><span id="L-2737"><a href="#L-2737"><span class="linenos">2737</span></a>            <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;Evening High Cost&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;Average Top CDPW Evening&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">per_kg_CO2_cost</span>
</span><span id="L-2738"><a href="#L-2738"><span class="linenos">2738</span></a>
</span><span id="L-2739"><a href="#L-2739"><span class="linenos">2739</span></a>            <span class="c1"># Calculate a Total Average Time and Total High Time cost</span>
</span><span id="L-2740"><a href="#L-2740"><span class="linenos">2740</span></a>            <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;Total Average Cost&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;Morning Average Cost&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;Evening Average Cost&#39;</span><span class="p">]</span>
</span><span id="L-2741"><a href="#L-2741"><span class="linenos">2741</span></a>            <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;Total High Cost&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;Morning High Cost&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;Evening High Cost&#39;</span><span class="p">]</span>
</span><span id="L-2742"><a href="#L-2742"><span class="linenos">2742</span></a>            
</span><span id="L-2743"><a href="#L-2743"><span class="linenos">2743</span></a>            <span class="c1"># add the current val_set to the employee_costs_to_office dictionary</span>
</span><span id="L-2744"><a href="#L-2744"><span class="linenos">2744</span></a>            <span class="n">employee_costs_to_office</span><span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;address&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">val_set</span>
</span><span id="L-2745"><a href="#L-2745"><span class="linenos">2745</span></a>        
</span><span id="L-2746"><a href="#L-2746"><span class="linenos">2746</span></a>        <span class="c1"># employees to analyze are within the cutoff distance for this office</span>
</span><span id="L-2747"><a href="#L-2747"><span class="linenos">2747</span></a>        <span class="c1"># for this analysis, we need to iterate through options</span>
</span><span id="L-2748"><a href="#L-2748"><span class="linenos">2748</span></a>        <span class="n">current_office</span> <span class="o">=</span> <span class="n">offices</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">to_frame</span><span class="p">()</span><span class="o">.</span><span class="n">T</span>
</span><span id="L-2749"><a href="#L-2749"><span class="linenos">2749</span></a>        <span class="n">other_offices</span> <span class="o">=</span> <span class="n">offices</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="L-2750"><a href="#L-2750"><span class="linenos">2750</span></a>        <span class="n">cost_values</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-2751"><a href="#L-2751"><span class="linenos">2751</span></a>        <span class="n">withins</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-2752"><a href="#L-2752"><span class="linenos">2752</span></a>        <span class="n">commutes</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">commute_days_per_week</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">commute_weeks_per_year</span>
</span><span id="L-2753"><a href="#L-2753"><span class="linenos">2753</span></a>        
</span><span id="L-2754"><a href="#L-2754"><span class="linenos">2754</span></a>        <span class="c1"># for each employee, calculate the commute cost to the current office, place a new dataframe with lat, long, office, and cost</span>
</span><span id="L-2755"><a href="#L-2755"><span class="linenos">2755</span></a>        <span class="c1"># if the employee is within the cutoff distance, if outside the cutoff distance, the cost is 0</span>
</span><span id="L-2756"><a href="#L-2756"><span class="linenos">2756</span></a>        <span class="c1"># start by looping through ALL employees and adding a row with the current office, and cost = 0</span>
</span><span id="L-2757"><a href="#L-2757"><span class="linenos">2757</span></a>                
</span><span id="L-2758"><a href="#L-2758"><span class="linenos">2758</span></a>
</span><span id="L-2759"><a href="#L-2759"><span class="linenos">2759</span></a>        <span class="n">base_costs</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">get_base_cost_df</span><span class="p">(</span><span class="n">emp</span><span class="p">,</span> <span class="n">current_office</span><span class="p">[</span><span class="s1">&#39;address&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
</span><span id="L-2760"><a href="#L-2760"><span class="linenos">2760</span></a>        <span class="c1"># add columns for total average cost and total high cost</span>
</span><span id="L-2761"><a href="#L-2761"><span class="linenos">2761</span></a>        <span class="n">base_costs</span><span class="p">[</span><span class="s1">&#39;Total Average Cost&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="L-2762"><a href="#L-2762"><span class="linenos">2762</span></a>        <span class="n">base_costs</span><span class="p">[</span><span class="s1">&#39;Total High Cost&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="L-2763"><a href="#L-2763"><span class="linenos">2763</span></a>        <span class="c1"># now get emp_within for the current office, and update the relevant rows of base_costs with actual costs for those employees </span>
</span><span id="L-2764"><a href="#L-2764"><span class="linenos">2764</span></a>        <span class="c1"># using the commute_cost column in the commute_data dataframe where the employee lat long matches the commute_data lat long and office address</span>
</span><span id="L-2765"><a href="#L-2765"><span class="linenos">2765</span></a>        
</span><span id="L-2766"><a href="#L-2766"><span class="linenos">2766</span></a>        <span class="n">base_emp_within</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graphing</span><span class="o">.</span><span class="n">filter_drive_distance</span><span class="p">(</span><span class="n">emp</span><span class="p">,</span><span class="n">current_office</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">commute_range_cut_off</span><span class="p">,</span> <span class="n">commute_data</span><span class="o">=</span><span class="n">commute_data</span><span class="p">)</span>
</span><span id="L-2767"><a href="#L-2767"><span class="linenos">2767</span></a>
</span><span id="L-2768"><a href="#L-2768"><span class="linenos">2768</span></a>        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">base_emp_within</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
</span><span id="L-2769"><a href="#L-2769"><span class="linenos">2769</span></a>            <span class="c1"># set val_set from the employee_costs_to_office = {} dictionary</span>
</span><span id="L-2770"><a href="#L-2770"><span class="linenos">2770</span></a>            <span class="n">val_set</span> <span class="o">=</span> <span class="n">employee_costs_to_office</span><span class="p">[</span><span class="n">current_office</span><span class="p">[</span><span class="s1">&#39;address&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
</span><span id="L-2771"><a href="#L-2771"><span class="linenos">2771</span></a>            <span class="c1"># get the cost from the commute_data</span>
</span><span id="L-2772"><a href="#L-2772"><span class="linenos">2772</span></a>            <span class="n">avg_cost</span> <span class="o">=</span> <span class="n">val_set</span><span class="p">[(</span><span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;origin_lat&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;latitude&#39;</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;origin_long&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;longitude&#39;</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;office_address&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">current_office</span><span class="p">[</span><span class="s1">&#39;address&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">])][</span><span class="s1">&#39;Total Average Cost&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-2773"><a href="#L-2773"><span class="linenos">2773</span></a>            <span class="n">conservative_cost</span> <span class="o">=</span> <span class="n">val_set</span><span class="p">[(</span><span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;origin_lat&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;latitude&#39;</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;origin_long&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;longitude&#39;</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;office_address&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">current_office</span><span class="p">[</span><span class="s1">&#39;address&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">])][</span><span class="s1">&#39;Total High Cost&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-2774"><a href="#L-2774"><span class="linenos">2774</span></a>            <span class="n">base_costs</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">base_costs</span><span class="p">[</span><span class="s1">&#39;latitude&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;latitude&#39;</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">base_costs</span><span class="p">[</span><span class="s1">&#39;longitude&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;longitude&#39;</span><span class="p">]),</span><span class="s1">&#39;Total Average Cost&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">avg_cost</span>
</span><span id="L-2775"><a href="#L-2775"><span class="linenos">2775</span></a>            <span class="n">base_costs</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">base_costs</span><span class="p">[</span><span class="s1">&#39;latitude&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;latitude&#39;</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">base_costs</span><span class="p">[</span><span class="s1">&#39;longitude&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;longitude&#39;</span><span class="p">]),</span><span class="s1">&#39;Total High Cost&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">conservative_cost</span>
</span><span id="L-2776"><a href="#L-2776"><span class="linenos">2776</span></a>
</span><span id="L-2777"><a href="#L-2777"><span class="linenos">2777</span></a>        <span class="c1"># now we have a dataframe with all employees, and the cost to the current office</span>
</span><span id="L-2778"><a href="#L-2778"><span class="linenos">2778</span></a>    
</span><span id="L-2779"><a href="#L-2779"><span class="linenos">2779</span></a>        <span class="c1"># now iterate through the other offices, get a base cost dataframe, and then update the relevant rows with actual costs, place in cost_values</span>
</span><span id="L-2780"><a href="#L-2780"><span class="linenos">2780</span></a>        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">other_offices</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
</span><span id="L-2781"><a href="#L-2781"><span class="linenos">2781</span></a>            <span class="n">office</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">to_frame</span><span class="p">()</span><span class="o">.</span><span class="n">T</span>
</span><span id="L-2782"><a href="#L-2782"><span class="linenos">2782</span></a>            <span class="n">tmp_costs</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">get_base_cost_df</span><span class="p">(</span><span class="n">emp</span><span class="p">,</span> <span class="n">office</span><span class="p">[</span><span class="s1">&#39;address&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
</span><span id="L-2783"><a href="#L-2783"><span class="linenos">2783</span></a>            <span class="c1"># add columns for total average cost and total high cost</span>
</span><span id="L-2784"><a href="#L-2784"><span class="linenos">2784</span></a>            <span class="n">tmp_costs</span><span class="p">[</span><span class="s1">&#39;Total Average Cost&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="L-2785"><a href="#L-2785"><span class="linenos">2785</span></a>            <span class="n">tmp_costs</span><span class="p">[</span><span class="s1">&#39;Total High Cost&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="L-2786"><a href="#L-2786"><span class="linenos">2786</span></a>            <span class="n">emp_within</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graphing</span><span class="o">.</span><span class="n">filter_drive_distance</span><span class="p">(</span><span class="n">emp</span><span class="p">,</span><span class="n">office</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">commute_range_cut_off</span><span class="p">,</span> <span class="n">commute_data</span><span class="o">=</span><span class="n">commute_data</span><span class="p">)</span>
</span><span id="L-2787"><a href="#L-2787"><span class="linenos">2787</span></a>            <span class="c1"># we will use this later to get the differential for each employee, without the employees that aren&#39;t overlapping</span>
</span><span id="L-2788"><a href="#L-2788"><span class="linenos">2788</span></a>            <span class="n">withins</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">emp_within</span><span class="p">)</span>
</span><span id="L-2789"><a href="#L-2789"><span class="linenos">2789</span></a>
</span><span id="L-2790"><a href="#L-2790"><span class="linenos">2790</span></a>            <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">emp_within</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
</span><span id="L-2791"><a href="#L-2791"><span class="linenos">2791</span></a>                <span class="c1"># set val_set from the employee_costs_to_office = {} dictionary</span>
</span><span id="L-2792"><a href="#L-2792"><span class="linenos">2792</span></a>                <span class="n">val_set</span> <span class="o">=</span> <span class="n">employee_costs_to_office</span><span class="p">[</span><span class="n">office</span><span class="p">[</span><span class="s1">&#39;address&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
</span><span id="L-2793"><a href="#L-2793"><span class="linenos">2793</span></a>                <span class="c1"># get the cost from the commute_data</span>
</span><span id="L-2794"><a href="#L-2794"><span class="linenos">2794</span></a>                <span class="n">avg_cost</span> <span class="o">=</span> <span class="n">val_set</span><span class="p">[(</span><span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;origin_lat&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;latitude&#39;</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;origin_long&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;longitude&#39;</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;office_address&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">office</span><span class="p">[</span><span class="s1">&#39;address&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">])][</span><span class="s1">&#39;Total Average Cost&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-2795"><a href="#L-2795"><span class="linenos">2795</span></a>                <span class="n">conservative_cost</span> <span class="o">=</span> <span class="n">val_set</span><span class="p">[(</span><span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;origin_lat&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;latitude&#39;</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;origin_long&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;longitude&#39;</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;office_address&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">office</span><span class="p">[</span><span class="s1">&#39;address&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">])][</span><span class="s1">&#39;Total High Cost&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-2796"><a href="#L-2796"><span class="linenos">2796</span></a>                <span class="n">tmp_costs</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">tmp_costs</span><span class="p">[</span><span class="s1">&#39;latitude&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;latitude&#39;</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">tmp_costs</span><span class="p">[</span><span class="s1">&#39;longitude&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;longitude&#39;</span><span class="p">]),</span><span class="s1">&#39;Total Average Cost&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">avg_cost</span>
</span><span id="L-2797"><a href="#L-2797"><span class="linenos">2797</span></a>                <span class="n">tmp_costs</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">tmp_costs</span><span class="p">[</span><span class="s1">&#39;latitude&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;latitude&#39;</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">tmp_costs</span><span class="p">[</span><span class="s1">&#39;longitude&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;longitude&#39;</span><span class="p">]),</span><span class="s1">&#39;Total High Cost&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">conservative_cost</span>
</span><span id="L-2798"><a href="#L-2798"><span class="linenos">2798</span></a>            
</span><span id="L-2799"><a href="#L-2799"><span class="linenos">2799</span></a>            <span class="n">cost_values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tmp_costs</span><span class="p">)</span>
</span><span id="L-2800"><a href="#L-2800"><span class="linenos">2800</span></a>            
</span><span id="L-2801"><a href="#L-2801"><span class="linenos">2801</span></a>        <span class="c1"># now we have a full list of costs for each employee to each office, we can get the differentials</span>
</span><span id="L-2802"><a href="#L-2802"><span class="linenos">2802</span></a>        <span class="c1"># create a list to hold the differential dataframes</span>
</span><span id="L-2803"><a href="#L-2803"><span class="linenos">2803</span></a>        <span class="n">average_diffs</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-2804"><a href="#L-2804"><span class="linenos">2804</span></a>        <span class="n">conservative_diffs</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-2805"><a href="#L-2805"><span class="linenos">2805</span></a>        <span class="c1"># for each cost dataframe, calculate the differential from the base_costs dataframe into a new dataframe</span>
</span><span id="L-2806"><a href="#L-2806"><span class="linenos">2806</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">cost_values</span><span class="p">)):</span>
</span><span id="L-2807"><a href="#L-2807"><span class="linenos">2807</span></a>            <span class="c1"># get the differential</span>
</span><span id="L-2808"><a href="#L-2808"><span class="linenos">2808</span></a>            <span class="n">average_diffs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cost_values</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;Total Average Cost&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">base_costs</span><span class="p">[</span><span class="s1">&#39;Total Average Cost&#39;</span><span class="p">])</span>
</span><span id="L-2809"><a href="#L-2809"><span class="linenos">2809</span></a>            <span class="n">conservative_diffs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cost_values</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;Total High Cost&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">base_costs</span><span class="p">[</span><span class="s1">&#39;Total High Cost&#39;</span><span class="p">])</span>
</span><span id="L-2810"><a href="#L-2810"><span class="linenos">2810</span></a>
</span><span id="L-2811"><a href="#L-2811"><span class="linenos">2811</span></a>        <span class="k">return</span> <span class="n">base_costs</span><span class="p">,</span> <span class="n">cost_values</span><span class="p">,</span> <span class="n">average_diffs</span><span class="p">,</span> <span class="n">conservative_diffs</span><span class="p">,</span> <span class="n">withins</span><span class="p">,</span> <span class="n">employee_costs_to_office</span><span class="p">,</span> <span class="n">current_office</span><span class="p">,</span> <span class="n">other_offices</span>
</span></pre></div>


            </section>
                <section id="Analyzer">
                            <input id="Analyzer-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">Analyzer</span>:

                <label class="view-source-button" for="Analyzer-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Analyzer"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Analyzer-37"><a href="#Analyzer-37"><span class="linenos">  37</span></a><span class="k">class</span> <span class="nc">Analyzer</span><span class="p">:</span>
</span><span id="Analyzer-38"><a href="#Analyzer-38"><span class="linenos">  38</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">proj</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">project_directory</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">env_file</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
</span><span id="Analyzer-39"><a href="#Analyzer-39"><span class="linenos">  39</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Analyzer-40"><a href="#Analyzer-40"><span class="linenos">  40</span></a><span class="sd">        Initializes the Analyzer with specified project details and configuration.</span>
</span><span id="Analyzer-41"><a href="#Analyzer-41"><span class="linenos">  41</span></a>
</span><span id="Analyzer-42"><a href="#Analyzer-42"><span class="linenos">  42</span></a><span class="sd">        Args:</span>
</span><span id="Analyzer-43"><a href="#Analyzer-43"><span class="linenos">  43</span></a><span class="sd">            proj (str, optional): The name of the project to load or create. Defaults to None.</span>
</span><span id="Analyzer-44"><a href="#Analyzer-44"><span class="linenos">  44</span></a><span class="sd">            project_directory (str, optional): The directory where project files are stored. Defaults to None.</span>
</span><span id="Analyzer-45"><a href="#Analyzer-45"><span class="linenos">  45</span></a><span class="sd">            env_file (str, optional): Path to a .env file for loading configuration variables. Defaults to an empty string.</span>
</span><span id="Analyzer-46"><a href="#Analyzer-46"><span class="linenos">  46</span></a>
</span><span id="Analyzer-47"><a href="#Analyzer-47"><span class="linenos">  47</span></a><span class="sd">        Raises:</span>
</span><span id="Analyzer-48"><a href="#Analyzer-48"><span class="linenos">  48</span></a><span class="sd">            ValueError: If the specified project directory does not exist or no .env file is provided when expected.</span>
</span><span id="Analyzer-49"><a href="#Analyzer-49"><span class="linenos">  49</span></a><span class="sd">        </span>
</span><span id="Analyzer-50"><a href="#Analyzer-50"><span class="linenos">  50</span></a><span class="sd">        This constructor sets up the API rate limiting, loads the .env configuration, initializes the Google API client,</span>
</span><span id="Analyzer-51"><a href="#Analyzer-51"><span class="linenos">  51</span></a><span class="sd">        and prepares the project directory and graphs subdirectory as needed.</span>
</span><span id="Analyzer-52"><a href="#Analyzer-52"><span class="linenos">  52</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Analyzer-53"><a href="#Analyzer-53"><span class="linenos">  53</span></a>
</span><span id="Analyzer-54"><a href="#Analyzer-54"><span class="linenos">  54</span></a>        <span class="c1"># api rate limit is 3000 requests per minute, we see errors at 1000 requests per minute, so we limit to 300 per minute</span>
</span><span id="Analyzer-55"><a href="#Analyzer-55"><span class="linenos">  55</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">api_rate_limit</span> <span class="o">=</span> <span class="mi">300</span>
</span><span id="Analyzer-56"><a href="#Analyzer-56"><span class="linenos">  56</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">sleep_time</span> <span class="o">=</span> <span class="mi">60</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">api_rate_limit</span>
</span><span id="Analyzer-57"><a href="#Analyzer-57"><span class="linenos">  57</span></a>        <span class="c1"># create a last call variable, set it to a time in the past</span>
</span><span id="Analyzer-58"><a href="#Analyzer-58"><span class="linenos">  58</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">last_call</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span> <span class="o">-</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">seconds</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sleep_time</span><span class="p">)</span>
</span><span id="Analyzer-59"><a href="#Analyzer-59"><span class="linenos">  59</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gAPI</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Analyzer-60"><a href="#Analyzer-60"><span class="linenos">  60</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gAPI_key</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="Analyzer-61"><a href="#Analyzer-61"><span class="linenos">  61</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">analysis_phase</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Analyzer-62"><a href="#Analyzer-62"><span class="linenos">  62</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">env_file</span> <span class="o">=</span> <span class="n">env_file</span>
</span><span id="Analyzer-63"><a href="#Analyzer-63"><span class="linenos">  63</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">project_directory</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Analyzer-64"><a href="#Analyzer-64"><span class="linenos">  64</span></a>        <span class="c1"># load the .env file if it exists</span>
</span><span id="Analyzer-65"><a href="#Analyzer-65"><span class="linenos">  65</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">env_file</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">env_file</span><span class="p">):</span>
</span><span id="Analyzer-66"><a href="#Analyzer-66"><span class="linenos">  66</span></a>            <span class="n">load_dotenv</span><span class="p">(</span><span class="n">env_file</span><span class="p">,</span><span class="n">override</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="Analyzer-67"><a href="#Analyzer-67"><span class="linenos">  67</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Analyzer-68"><a href="#Analyzer-68"><span class="linenos">  68</span></a>            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">env_file</span><span class="p">):</span>
</span><span id="Analyzer-69"><a href="#Analyzer-69"><span class="linenos">  69</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;No .env file provided.&quot;</span><span class="p">)</span>
</span><span id="Analyzer-70"><a href="#Analyzer-70"><span class="linenos">  70</span></a>            <span class="c1"># attempt to load the .env file from the CWD</span>
</span><span id="Analyzer-71"><a href="#Analyzer-71"><span class="linenos">  71</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">env_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">(),</span> <span class="s2">&quot;.env&quot;</span><span class="p">)</span>
</span><span id="Analyzer-72"><a href="#Analyzer-72"><span class="linenos">  72</span></a>            <span class="n">load_dotenv</span><span class="p">(</span><span class="n">override</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="Analyzer-73"><a href="#Analyzer-73"><span class="linenos">  73</span></a>        <span class="c1"># if the .env has keys, use them, otherwise use the defaults</span>
</span><span id="Analyzer-74"><a href="#Analyzer-74"><span class="linenos">  74</span></a>        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;GMAPS_API_KEY&quot;</span><span class="p">):</span>
</span><span id="Analyzer-75"><a href="#Analyzer-75"><span class="linenos">  75</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">gAPI_key</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;GMAPS_API_KEY&quot;</span><span class="p">)</span>
</span><span id="Analyzer-76"><a href="#Analyzer-76"><span class="linenos">  76</span></a>        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;DEFAULT_PROJECT_DIRECTORY&quot;</span><span class="p">):</span>
</span><span id="Analyzer-77"><a href="#Analyzer-77"><span class="linenos">  77</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">project_directory</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;DEFAULT_PROJECT_DIRECTORY&quot;</span><span class="p">)</span>
</span><span id="Analyzer-78"><a href="#Analyzer-78"><span class="linenos">  78</span></a>        <span class="c1"># if a project directory is provided, override .env and use it, otherwise use the default</span>
</span><span id="Analyzer-79"><a href="#Analyzer-79"><span class="linenos">  79</span></a>        <span class="k">if</span> <span class="n">project_directory</span><span class="p">:</span>
</span><span id="Analyzer-80"><a href="#Analyzer-80"><span class="linenos">  80</span></a>            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">project_directory</span><span class="p">):</span>
</span><span id="Analyzer-81"><a href="#Analyzer-81"><span class="linenos">  81</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">project_directory</span> <span class="o">=</span> <span class="n">project_directory</span>
</span><span id="Analyzer-82"><a href="#Analyzer-82"><span class="linenos">  82</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Analyzer-83"><a href="#Analyzer-83"><span class="linenos">  83</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Project directory does not exist.&quot;</span><span class="p">)</span>
</span><span id="Analyzer-84"><a href="#Analyzer-84"><span class="linenos">  84</span></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">project_directory</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Analyzer-85"><a href="#Analyzer-85"><span class="linenos">  85</span></a>            <span class="c1"># use the CWD for now</span>
</span><span id="Analyzer-86"><a href="#Analyzer-86"><span class="linenos">  86</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">project_directory</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="vm">__file__</span><span class="p">),</span> <span class="s2">&quot;projects&quot;</span><span class="p">)</span>
</span><span id="Analyzer-87"><a href="#Analyzer-87"><span class="linenos">  87</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">project</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Analyzer-88"><a href="#Analyzer-88"><span class="linenos">  88</span></a>        <span class="c1"># if a project called for, load or create it        </span>
</span><span id="Analyzer-89"><a href="#Analyzer-89"><span class="linenos">  89</span></a>        <span class="k">if</span> <span class="n">proj</span><span class="p">:</span>
</span><span id="Analyzer-90"><a href="#Analyzer-90"><span class="linenos">  90</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">project</span> <span class="o">=</span> <span class="n">Project</span><span class="p">(</span><span class="n">proj</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">project_directory</span><span class="p">)</span>
</span><span id="Analyzer-91"><a href="#Analyzer-91"><span class="linenos">  91</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Analyzer-92"><a href="#Analyzer-92"><span class="linenos">  92</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">project</span> <span class="o">=</span> <span class="n">Project</span><span class="p">(</span> <span class="kc">None</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">project_directory</span><span class="p">)</span>
</span><span id="Analyzer-93"><a href="#Analyzer-93"><span class="linenos">  93</span></a>        <span class="c1"># if a project is loaded, check for a subdirectory called &quot;plots&quot; in the project folder, </span>
</span><span id="Analyzer-94"><a href="#Analyzer-94"><span class="linenos">  94</span></a>            <span class="c1"># create it if it doesn&#39;t exist, then list the plot .png filenames</span>
</span><span id="Analyzer-95"><a href="#Analyzer-95"><span class="linenos">  95</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">load_graphs</span><span class="p">()</span>
</span><span id="Analyzer-96"><a href="#Analyzer-96"><span class="linenos">  96</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">graphing</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Analyzer-97"><a href="#Analyzer-97"><span class="linenos">  97</span></a>        <span class="c1"># update the analysis phase</span>
</span><span id="Analyzer-98"><a href="#Analyzer-98"><span class="linenos">  98</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">update_analysis_phase</span><span class="p">()</span>
</span><span id="Analyzer-99"><a href="#Analyzer-99"><span class="linenos">  99</span></a>        <span class="k">return</span> <span class="kc">None</span>
</span><span id="Analyzer-100"><a href="#Analyzer-100"><span class="linenos"> 100</span></a>
</span><span id="Analyzer-101"><a href="#Analyzer-101"><span class="linenos"> 101</span></a>    <span class="k">def</span> <span class="nf">load_graphs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Analyzer-102"><a href="#Analyzer-102"><span class="linenos"> 102</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Analyzer-103"><a href="#Analyzer-103"><span class="linenos"> 103</span></a><span class="sd">        Loads the list of graph filenames from the project&#39;s &#39;plots&#39; directory.</span>
</span><span id="Analyzer-104"><a href="#Analyzer-104"><span class="linenos"> 104</span></a>
</span><span id="Analyzer-105"><a href="#Analyzer-105"><span class="linenos"> 105</span></a><span class="sd">        This method checks if the &#39;plots&#39; subdirectory exists within the current project directory. </span>
</span><span id="Analyzer-106"><a href="#Analyzer-106"><span class="linenos"> 106</span></a><span class="sd">        If it doesn&#39;t exist, it creates the directory. It then updates the instance variable with a list of .png filenames </span>
</span><span id="Analyzer-107"><a href="#Analyzer-107"><span class="linenos"> 107</span></a><span class="sd">        found in the &#39;plots&#39; directory.</span>
</span><span id="Analyzer-108"><a href="#Analyzer-108"><span class="linenos"> 108</span></a>
</span><span id="Analyzer-109"><a href="#Analyzer-109"><span class="linenos"> 109</span></a><span class="sd">        Returns:</span>
</span><span id="Analyzer-110"><a href="#Analyzer-110"><span class="linenos"> 110</span></a><span class="sd">            bool: True if the project has a &#39;plots&#39; directory, False otherwise.</span>
</span><span id="Analyzer-111"><a href="#Analyzer-111"><span class="linenos"> 111</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Analyzer-112"><a href="#Analyzer-112"><span class="linenos"> 112</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">project_name</span> <span class="o">!=</span><span class="s2">&quot;&quot;</span><span class="p">:</span>
</span><span id="Analyzer-113"><a href="#Analyzer-113"><span class="linenos"> 113</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project_directory</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">project_name</span><span class="p">,</span> <span class="s2">&quot;plots&quot;</span><span class="p">)):</span>
</span><span id="Analyzer-114"><a href="#Analyzer-114"><span class="linenos"> 114</span></a>                <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project_directory</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">project_name</span><span class="p">,</span> <span class="s2">&quot;plots&quot;</span><span class="p">))</span>
</span><span id="Analyzer-115"><a href="#Analyzer-115"><span class="linenos"> 115</span></a>            <span class="c1"># load the list of .png filenames into a self.graphs attribute only if they are .png files</span>
</span><span id="Analyzer-116"><a href="#Analyzer-116"><span class="linenos"> 116</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">graphs</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project_directory</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">project_name</span><span class="p">,</span> <span class="s2">&quot;plots&quot;</span><span class="p">))</span> <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.png&#39;</span><span class="p">)]</span>
</span><span id="Analyzer-117"><a href="#Analyzer-117"><span class="linenos"> 117</span></a>            <span class="k">return</span> <span class="kc">True</span>
</span><span id="Analyzer-118"><a href="#Analyzer-118"><span class="linenos"> 118</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Analyzer-119"><a href="#Analyzer-119"><span class="linenos"> 119</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">graphs</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Analyzer-120"><a href="#Analyzer-120"><span class="linenos"> 120</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="Analyzer-121"><a href="#Analyzer-121"><span class="linenos"> 121</span></a>
</span><span id="Analyzer-122"><a href="#Analyzer-122"><span class="linenos"> 122</span></a>    <span class="k">def</span> <span class="nf">sleepif</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Analyzer-123"><a href="#Analyzer-123"><span class="linenos"> 123</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Analyzer-124"><a href="#Analyzer-124"><span class="linenos"> 124</span></a><span class="sd">        Ensures adherence to the API rate limit by sleeping if the time since the last API call is less than the required wait time.</span>
</span><span id="Analyzer-125"><a href="#Analyzer-125"><span class="linenos"> 125</span></a>
</span><span id="Analyzer-126"><a href="#Analyzer-126"><span class="linenos"> 126</span></a><span class="sd">        This method calculates the time elapsed since the last API call and pauses execution for the remainder of the time needed to </span>
</span><span id="Analyzer-127"><a href="#Analyzer-127"><span class="linenos"> 127</span></a><span class="sd">        comply with the set rate limit, ensuring that API requests do not exceed the prescribed rate.</span>
</span><span id="Analyzer-128"><a href="#Analyzer-128"><span class="linenos"> 128</span></a>
</span><span id="Analyzer-129"><a href="#Analyzer-129"><span class="linenos"> 129</span></a><span class="sd">        Returns:</span>
</span><span id="Analyzer-130"><a href="#Analyzer-130"><span class="linenos"> 130</span></a><span class="sd">            None</span>
</span><span id="Analyzer-131"><a href="#Analyzer-131"><span class="linenos"> 131</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Analyzer-132"><a href="#Analyzer-132"><span class="linenos"> 132</span></a>        <span class="c1"># if the delta between the current time and the last call is less than the sleep time, sleep for the difference</span>
</span><span id="Analyzer-133"><a href="#Analyzer-133"><span class="linenos"> 133</span></a>        <span class="k">if</span> <span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_call</span><span class="p">)</span><span class="o">.</span><span class="n">seconds</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">sleep_time</span><span class="p">:</span>
</span><span id="Analyzer-134"><a href="#Analyzer-134"><span class="linenos"> 134</span></a>            <span class="n">sleep</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sleep_time</span> <span class="o">-</span> <span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_call</span><span class="p">)</span><span class="o">.</span><span class="n">seconds</span><span class="p">)</span>
</span><span id="Analyzer-135"><a href="#Analyzer-135"><span class="linenos"> 135</span></a>        <span class="k">return</span> <span class="kc">None</span>
</span><span id="Analyzer-136"><a href="#Analyzer-136"><span class="linenos"> 136</span></a>
</span><span id="Analyzer-137"><a href="#Analyzer-137"><span class="linenos"> 137</span></a>    <span class="k">def</span> <span class="nf">log_error</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">):</span>
</span><span id="Analyzer-138"><a href="#Analyzer-138"><span class="linenos"> 138</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Analyzer-139"><a href="#Analyzer-139"><span class="linenos"> 139</span></a><span class="sd">        Logs an error message to the &#39;error_log.txt&#39; file.</span>
</span><span id="Analyzer-140"><a href="#Analyzer-140"><span class="linenos"> 140</span></a>
</span><span id="Analyzer-141"><a href="#Analyzer-141"><span class="linenos"> 141</span></a><span class="sd">        Appends the provided message to a log file dedicated to errors, facilitating debugging and error tracking over time.</span>
</span><span id="Analyzer-142"><a href="#Analyzer-142"><span class="linenos"> 142</span></a>
</span><span id="Analyzer-143"><a href="#Analyzer-143"><span class="linenos"> 143</span></a><span class="sd">        Args:</span>
</span><span id="Analyzer-144"><a href="#Analyzer-144"><span class="linenos"> 144</span></a><span class="sd">            message (str): The error message to log.</span>
</span><span id="Analyzer-145"><a href="#Analyzer-145"><span class="linenos"> 145</span></a>
</span><span id="Analyzer-146"><a href="#Analyzer-146"><span class="linenos"> 146</span></a><span class="sd">        Returns:</span>
</span><span id="Analyzer-147"><a href="#Analyzer-147"><span class="linenos"> 147</span></a><span class="sd">            None</span>
</span><span id="Analyzer-148"><a href="#Analyzer-148"><span class="linenos"> 148</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Analyzer-149"><a href="#Analyzer-149"><span class="linenos"> 149</span></a>        <span class="c1"># append the message to the error.txt log</span>
</span><span id="Analyzer-150"><a href="#Analyzer-150"><span class="linenos"> 150</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;error_log.txt&quot;</span><span class="p">,</span> <span class="s2">&quot;a&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="Analyzer-151"><a href="#Analyzer-151"><span class="linenos"> 151</span></a>            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
</span><span id="Analyzer-152"><a href="#Analyzer-152"><span class="linenos"> 152</span></a>        <span class="k">return</span> <span class="kc">None</span>
</span><span id="Analyzer-153"><a href="#Analyzer-153"><span class="linenos"> 153</span></a>
</span><span id="Analyzer-154"><a href="#Analyzer-154"><span class="linenos"> 154</span></a>    <span class="k">def</span> <span class="nf">save_env</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">project_directory</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">gAPI_key</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">env_file</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="Analyzer-155"><a href="#Analyzer-155"><span class="linenos"> 155</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Analyzer-156"><a href="#Analyzer-156"><span class="linenos"> 156</span></a><span class="sd">        Saves the specified environment variables to the .env file and updates the runtime environment.</span>
</span><span id="Analyzer-157"><a href="#Analyzer-157"><span class="linenos"> 157</span></a>
</span><span id="Analyzer-158"><a href="#Analyzer-158"><span class="linenos"> 158</span></a><span class="sd">        This method allows dynamic updating of critical environment variables, including the Google Maps API key and the default project directory. </span>
</span><span id="Analyzer-159"><a href="#Analyzer-159"><span class="linenos"> 159</span></a><span class="sd">        If any arguments are provided, they override the corresponding instance variables before saving.</span>
</span><span id="Analyzer-160"><a href="#Analyzer-160"><span class="linenos"> 160</span></a>
</span><span id="Analyzer-161"><a href="#Analyzer-161"><span class="linenos"> 161</span></a><span class="sd">        Args:</span>
</span><span id="Analyzer-162"><a href="#Analyzer-162"><span class="linenos"> 162</span></a><span class="sd">            project_directory (str, optional): The directory where project files are stored. If specified, overrides the existing value.</span>
</span><span id="Analyzer-163"><a href="#Analyzer-163"><span class="linenos"> 163</span></a><span class="sd">            gAPI_key (str, optional): The Google Maps API key. If specified, overrides the existing value.</span>
</span><span id="Analyzer-164"><a href="#Analyzer-164"><span class="linenos"> 164</span></a><span class="sd">            env_file (str, optional): Path to the .env file. If specified, overrides the existing value.</span>
</span><span id="Analyzer-165"><a href="#Analyzer-165"><span class="linenos"> 165</span></a>
</span><span id="Analyzer-166"><a href="#Analyzer-166"><span class="linenos"> 166</span></a><span class="sd">        Raises:</span>
</span><span id="Analyzer-167"><a href="#Analyzer-167"><span class="linenos"> 167</span></a><span class="sd">            ValueError: If no .env file path is provided.</span>
</span><span id="Analyzer-168"><a href="#Analyzer-168"><span class="linenos"> 168</span></a>
</span><span id="Analyzer-169"><a href="#Analyzer-169"><span class="linenos"> 169</span></a><span class="sd">        Returns:</span>
</span><span id="Analyzer-170"><a href="#Analyzer-170"><span class="linenos"> 170</span></a><span class="sd">            None</span>
</span><span id="Analyzer-171"><a href="#Analyzer-171"><span class="linenos"> 171</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Analyzer-172"><a href="#Analyzer-172"><span class="linenos"> 172</span></a>        <span class="c1"># if variables specified, override self and then save to .env</span>
</span><span id="Analyzer-173"><a href="#Analyzer-173"><span class="linenos"> 173</span></a>        <span class="k">if</span> <span class="n">project_directory</span><span class="p">:</span>
</span><span id="Analyzer-174"><a href="#Analyzer-174"><span class="linenos"> 174</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">project_directory</span> <span class="o">=</span> <span class="n">project_directory</span>
</span><span id="Analyzer-175"><a href="#Analyzer-175"><span class="linenos"> 175</span></a>        <span class="k">if</span> <span class="n">gAPI_key</span><span class="p">:</span>
</span><span id="Analyzer-176"><a href="#Analyzer-176"><span class="linenos"> 176</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">gAPI_key</span> <span class="o">=</span> <span class="n">gAPI_key</span>
</span><span id="Analyzer-177"><a href="#Analyzer-177"><span class="linenos"> 177</span></a>        <span class="k">if</span> <span class="n">env_file</span><span class="p">:</span>
</span><span id="Analyzer-178"><a href="#Analyzer-178"><span class="linenos"> 178</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">env_file</span> <span class="o">=</span> <span class="n">env_file</span>
</span><span id="Analyzer-179"><a href="#Analyzer-179"><span class="linenos"> 179</span></a>        <span class="c1"># save the .env file</span>
</span><span id="Analyzer-180"><a href="#Analyzer-180"><span class="linenos"> 180</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">env_file</span><span class="p">:</span>
</span><span id="Analyzer-181"><a href="#Analyzer-181"><span class="linenos"> 181</span></a>            <span class="n">set_key</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">env_file</span><span class="p">,</span> <span class="s2">&quot;GMAPS_API_KEY&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gAPI_key</span><span class="p">)</span>
</span><span id="Analyzer-182"><a href="#Analyzer-182"><span class="linenos"> 182</span></a>            <span class="n">set_key</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">env_file</span><span class="p">,</span> <span class="s2">&quot;DEFAULT_PROJECT_DIRECTORY&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">project_directory</span><span class="p">)</span>
</span><span id="Analyzer-183"><a href="#Analyzer-183"><span class="linenos"> 183</span></a>
</span><span id="Analyzer-184"><a href="#Analyzer-184"><span class="linenos"> 184</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Analyzer-185"><a href="#Analyzer-185"><span class="linenos"> 185</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;No .env file provided.&quot;</span><span class="p">)</span>
</span><span id="Analyzer-186"><a href="#Analyzer-186"><span class="linenos"> 186</span></a>
</span><span id="Analyzer-187"><a href="#Analyzer-187"><span class="linenos"> 187</span></a>        <span class="c1"># update the current runtime environment</span>
</span><span id="Analyzer-188"><a href="#Analyzer-188"><span class="linenos"> 188</span></a>        <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;GMAPS_API_KEY&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gAPI_key</span>
</span><span id="Analyzer-189"><a href="#Analyzer-189"><span class="linenos"> 189</span></a>        <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;DEFAULT_PROJECT_DIRECTORY&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">project_directory</span>
</span><span id="Analyzer-190"><a href="#Analyzer-190"><span class="linenos"> 190</span></a>
</span><span id="Analyzer-191"><a href="#Analyzer-191"><span class="linenos"> 191</span></a>    <span class="k">def</span> <span class="nf">list_projects</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Analyzer-192"><a href="#Analyzer-192"><span class="linenos"> 192</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Analyzer-193"><a href="#Analyzer-193"><span class="linenos"> 193</span></a><span class="sd">        Lists all projects within the project directory.</span>
</span><span id="Analyzer-194"><a href="#Analyzer-194"><span class="linenos"> 194</span></a>
</span><span id="Analyzer-195"><a href="#Analyzer-195"><span class="linenos"> 195</span></a><span class="sd">        Retrieves the names of all subdirectories within the project directory, treating each as a separate project. </span>
</span><span id="Analyzer-196"><a href="#Analyzer-196"><span class="linenos"> 196</span></a><span class="sd">        This method is useful for enumerating all available projects for selection or analysis.</span>
</span><span id="Analyzer-197"><a href="#Analyzer-197"><span class="linenos"> 197</span></a>
</span><span id="Analyzer-198"><a href="#Analyzer-198"><span class="linenos"> 198</span></a><span class="sd">        Returns:</span>
</span><span id="Analyzer-199"><a href="#Analyzer-199"><span class="linenos"> 199</span></a><span class="sd">            list: A list of project names (subdirectory names) within the project directory.</span>
</span><span id="Analyzer-200"><a href="#Analyzer-200"><span class="linenos"> 200</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Analyzer-201"><a href="#Analyzer-201"><span class="linenos"> 201</span></a>        <span class="c1"># list all projects in the project directory</span>
</span><span id="Analyzer-202"><a href="#Analyzer-202"><span class="linenos"> 202</span></a>        <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project_directory</span><span class="p">)</span>
</span><span id="Analyzer-203"><a href="#Analyzer-203"><span class="linenos"> 203</span></a>    
</span><span id="Analyzer-204"><a href="#Analyzer-204"><span class="linenos"> 204</span></a>    <span class="k">def</span> <span class="nf">create_project</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">project_name</span><span class="p">):</span>
</span><span id="Analyzer-205"><a href="#Analyzer-205"><span class="linenos"> 205</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Analyzer-206"><a href="#Analyzer-206"><span class="linenos"> 206</span></a><span class="sd">        Creates a new project with the specified name.</span>
</span><span id="Analyzer-207"><a href="#Analyzer-207"><span class="linenos"> 207</span></a>
</span><span id="Analyzer-208"><a href="#Analyzer-208"><span class="linenos"> 208</span></a><span class="sd">        This method initializes a new `Project` instance and sets it as the current project. It updates the analysis phase </span>
</span><span id="Analyzer-209"><a href="#Analyzer-209"><span class="linenos"> 209</span></a><span class="sd">        based on the new project&#39;s status.</span>
</span><span id="Analyzer-210"><a href="#Analyzer-210"><span class="linenos"> 210</span></a>
</span><span id="Analyzer-211"><a href="#Analyzer-211"><span class="linenos"> 211</span></a><span class="sd">        Args:</span>
</span><span id="Analyzer-212"><a href="#Analyzer-212"><span class="linenos"> 212</span></a><span class="sd">            project_name (str): The name of the new project to create.</span>
</span><span id="Analyzer-213"><a href="#Analyzer-213"><span class="linenos"> 213</span></a>
</span><span id="Analyzer-214"><a href="#Analyzer-214"><span class="linenos"> 214</span></a><span class="sd">        Returns:</span>
</span><span id="Analyzer-215"><a href="#Analyzer-215"><span class="linenos"> 215</span></a><span class="sd">            bool: True if the project is successfully created, False otherwise.</span>
</span><span id="Analyzer-216"><a href="#Analyzer-216"><span class="linenos"> 216</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Analyzer-217"><a href="#Analyzer-217"><span class="linenos"> 217</span></a>        <span class="c1"># create a new project</span>
</span><span id="Analyzer-218"><a href="#Analyzer-218"><span class="linenos"> 218</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">project</span> <span class="o">=</span> <span class="n">Project</span><span class="p">(</span><span class="n">project_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">project_directory</span><span class="p">)</span>
</span><span id="Analyzer-219"><a href="#Analyzer-219"><span class="linenos"> 219</span></a>        <span class="c1"># update the analysis phase</span>
</span><span id="Analyzer-220"><a href="#Analyzer-220"><span class="linenos"> 220</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">update_analysis_phase</span><span class="p">()</span>
</span><span id="Analyzer-221"><a href="#Analyzer-221"><span class="linenos"> 221</span></a>        <span class="k">return</span> <span class="kc">True</span>
</span><span id="Analyzer-222"><a href="#Analyzer-222"><span class="linenos"> 222</span></a>    
</span><span id="Analyzer-223"><a href="#Analyzer-223"><span class="linenos"> 223</span></a>    <span class="k">def</span> <span class="nf">load_project</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">project_name</span><span class="p">):</span>
</span><span id="Analyzer-224"><a href="#Analyzer-224"><span class="linenos"> 224</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Analyzer-225"><a href="#Analyzer-225"><span class="linenos"> 225</span></a><span class="sd">        Loads an existing project by name.</span>
</span><span id="Analyzer-226"><a href="#Analyzer-226"><span class="linenos"> 226</span></a>
</span><span id="Analyzer-227"><a href="#Analyzer-227"><span class="linenos"> 227</span></a><span class="sd">        Sets the specified project as the current project, loads any associated graphs, and updates the analysis phase </span>
</span><span id="Analyzer-228"><a href="#Analyzer-228"><span class="linenos"> 228</span></a><span class="sd">        based on the loaded project&#39;s status.</span>
</span><span id="Analyzer-229"><a href="#Analyzer-229"><span class="linenos"> 229</span></a>
</span><span id="Analyzer-230"><a href="#Analyzer-230"><span class="linenos"> 230</span></a><span class="sd">        Args:</span>
</span><span id="Analyzer-231"><a href="#Analyzer-231"><span class="linenos"> 231</span></a><span class="sd">            project_name (str): The name of the project to load.</span>
</span><span id="Analyzer-232"><a href="#Analyzer-232"><span class="linenos"> 232</span></a>
</span><span id="Analyzer-233"><a href="#Analyzer-233"><span class="linenos"> 233</span></a><span class="sd">        Returns:</span>
</span><span id="Analyzer-234"><a href="#Analyzer-234"><span class="linenos"> 234</span></a><span class="sd">            bool: True if the project is successfully loaded, False otherwise.</span>
</span><span id="Analyzer-235"><a href="#Analyzer-235"><span class="linenos"> 235</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Analyzer-236"><a href="#Analyzer-236"><span class="linenos"> 236</span></a>     <span class="c1"># load an existing project</span>
</span><span id="Analyzer-237"><a href="#Analyzer-237"><span class="linenos"> 237</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">project</span> <span class="o">=</span> <span class="n">Project</span><span class="p">(</span><span class="n">project_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">project_directory</span><span class="p">)</span>
</span><span id="Analyzer-238"><a href="#Analyzer-238"><span class="linenos"> 238</span></a>        <span class="c1"># load the graphs if any</span>
</span><span id="Analyzer-239"><a href="#Analyzer-239"><span class="linenos"> 239</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">load_graphs</span><span class="p">()</span>
</span><span id="Analyzer-240"><a href="#Analyzer-240"><span class="linenos"> 240</span></a>        <span class="c1"># update the analysis phase</span>
</span><span id="Analyzer-241"><a href="#Analyzer-241"><span class="linenos"> 241</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">update_analysis_phase</span><span class="p">()</span>
</span><span id="Analyzer-242"><a href="#Analyzer-242"><span class="linenos"> 242</span></a>        <span class="k">return</span> <span class="kc">True</span>
</span><span id="Analyzer-243"><a href="#Analyzer-243"><span class="linenos"> 243</span></a>
</span><span id="Analyzer-244"><a href="#Analyzer-244"><span class="linenos"> 244</span></a>    <span class="k">def</span> <span class="nf">update_analysis_phase</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Analyzer-245"><a href="#Analyzer-245"><span class="linenos"> 245</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Analyzer-246"><a href="#Analyzer-246"><span class="linenos"> 246</span></a><span class="sd">        Updates the analysis phase based on the current state of the project data.</span>
</span><span id="Analyzer-247"><a href="#Analyzer-247"><span class="linenos"> 247</span></a>
</span><span id="Analyzer-248"><a href="#Analyzer-248"><span class="linenos"> 248</span></a><span class="sd">        This method determines the current phase of analysis by checking the availability of specific data files within the project. </span>
</span><span id="Analyzer-249"><a href="#Analyzer-249"><span class="linenos"> 249</span></a><span class="sd">        The analysis phase is a critical component that guides the workflow and available actions within the current project context.</span>
</span><span id="Analyzer-250"><a href="#Analyzer-250"><span class="linenos"> 250</span></a>
</span><span id="Analyzer-251"><a href="#Analyzer-251"><span class="linenos"> 251</span></a><span class="sd">        Returns:</span>
</span><span id="Analyzer-252"><a href="#Analyzer-252"><span class="linenos"> 252</span></a><span class="sd">            int: The updated analysis phase.</span>
</span><span id="Analyzer-253"><a href="#Analyzer-253"><span class="linenos"> 253</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Analyzer-254"><a href="#Analyzer-254"><span class="linenos"> 254</span></a>
</span><span id="Analyzer-255"><a href="#Analyzer-255"><span class="linenos"> 255</span></a>        <span class="c1"># if project is none, phase is zero</span>
</span><span id="Analyzer-256"><a href="#Analyzer-256"><span class="linenos"> 256</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Analyzer-257"><a href="#Analyzer-257"><span class="linenos"> 257</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">analysis_phase</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Analyzer-258"><a href="#Analyzer-258"><span class="linenos"> 258</span></a>            <span class="k">return</span> <span class="mi">0</span>
</span><span id="Analyzer-259"><a href="#Analyzer-259"><span class="linenos"> 259</span></a>        <span class="c1"># if there is a project and there is no employee_addresses.csv in the project, phase is 1</span>
</span><span id="Analyzer-260"><a href="#Analyzer-260"><span class="linenos"> 260</span></a>        <span class="k">if</span> <span class="s2">&quot;employee_addresses.csv&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">list_data_files</span><span class="p">():</span>
</span><span id="Analyzer-261"><a href="#Analyzer-261"><span class="linenos"> 261</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">analysis_phase</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="Analyzer-262"><a href="#Analyzer-262"><span class="linenos"> 262</span></a>            <span class="k">return</span> <span class="mi">1</span>
</span><span id="Analyzer-263"><a href="#Analyzer-263"><span class="linenos"> 263</span></a>        <span class="c1"># if there is a project and there is a employee_addresses.csv in the project, phase is 2</span>
</span><span id="Analyzer-264"><a href="#Analyzer-264"><span class="linenos"> 264</span></a>        <span class="k">if</span> <span class="s2">&quot;employee_addresses.csv&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">list_data_files</span><span class="p">()</span> <span class="ow">and</span> <span class="s2">&quot;office_addresses.csv&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">list_data_files</span><span class="p">():</span>
</span><span id="Analyzer-265"><a href="#Analyzer-265"><span class="linenos"> 265</span></a>            <span class="c1"># if there is also a employee_gps.csv in the project, phase is 3</span>
</span><span id="Analyzer-266"><a href="#Analyzer-266"><span class="linenos"> 266</span></a>            <span class="k">if</span> <span class="s2">&quot;employee_gps.csv&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">list_data_files</span><span class="p">()</span> <span class="ow">and</span> <span class="s2">&quot;office_gps.csv&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">list_data_files</span><span class="p">():</span>
</span><span id="Analyzer-267"><a href="#Analyzer-267"><span class="linenos"> 267</span></a>                <span class="c1"># if there is also a gps_fuzz.csv in the project, or if using GPS fuzz is set to fals, we are at phase is 4</span>
</span><span id="Analyzer-268"><a href="#Analyzer-268"><span class="linenos"> 268</span></a>                <span class="k">if</span> <span class="s2">&quot;gps_fuzz.csv&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">list_data_files</span><span class="p">()</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">use_gps_fuzzing</span><span class="o">==</span><span class="kc">False</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">use_gps_fuzzing</span><span class="o">==</span><span class="s2">&quot;False&quot;</span><span class="p">:</span>
</span><span id="Analyzer-269"><a href="#Analyzer-269"><span class="linenos"> 269</span></a>                    <span class="c1"># if there is also a commute_data.csv in the project, phase is 5</span>
</span><span id="Analyzer-270"><a href="#Analyzer-270"><span class="linenos"> 270</span></a>                    <span class="k">if</span> <span class="s2">&quot;commute_data.csv&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">list_data_files</span><span class="p">():</span>
</span><span id="Analyzer-271"><a href="#Analyzer-271"><span class="linenos"> 271</span></a>                        <span class="c1"># if graphs.json is present in the plots dir, we&#39;ve graphed, phase is 6</span>
</span><span id="Analyzer-272"><a href="#Analyzer-272"><span class="linenos"> 272</span></a>                        <span class="k">if</span> <span class="s2">&quot;plots&quot;</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project_directory</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">project_name</span><span class="p">))</span> <span class="ow">and</span> <span class="s2">&quot;graphs.json&quot;</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project_directory</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">project_name</span><span class="p">,</span> <span class="s2">&quot;plots&quot;</span><span class="p">)):</span>
</span><span id="Analyzer-273"><a href="#Analyzer-273"><span class="linenos"> 273</span></a>                            <span class="c1"># if tables dir exists and tables.json is present, we&#39;ve tabled, phase is 7</span>
</span><span id="Analyzer-274"><a href="#Analyzer-274"><span class="linenos"> 274</span></a>                            <span class="k">if</span> <span class="s2">&quot;tables&quot;</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project_directory</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">project_name</span><span class="p">))</span> <span class="ow">and</span> <span class="s2">&quot;tables.json&quot;</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project_directory</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">project_name</span><span class="p">,</span> <span class="s2">&quot;tables&quot;</span><span class="p">)):</span>
</span><span id="Analyzer-275"><a href="#Analyzer-275"><span class="linenos"> 275</span></a>                                <span class="bp">self</span><span class="o">.</span><span class="n">analysis_phase</span> <span class="o">=</span> <span class="mi">7</span>
</span><span id="Analyzer-276"><a href="#Analyzer-276"><span class="linenos"> 276</span></a>                                <span class="k">return</span> <span class="mi">7</span>
</span><span id="Analyzer-277"><a href="#Analyzer-277"><span class="linenos"> 277</span></a>                            <span class="bp">self</span><span class="o">.</span><span class="n">analysis_phase</span> <span class="o">=</span> <span class="mi">7</span>
</span><span id="Analyzer-278"><a href="#Analyzer-278"><span class="linenos"> 278</span></a>                            <span class="k">return</span> <span class="mi">7</span>
</span><span id="Analyzer-279"><a href="#Analyzer-279"><span class="linenos"> 279</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">analysis_phase</span> <span class="o">=</span> <span class="mi">5</span>
</span><span id="Analyzer-280"><a href="#Analyzer-280"><span class="linenos"> 280</span></a>                        <span class="k">return</span> <span class="mi">5</span>
</span><span id="Analyzer-281"><a href="#Analyzer-281"><span class="linenos"> 281</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="Analyzer-282"><a href="#Analyzer-282"><span class="linenos"> 282</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">analysis_phase</span> <span class="o">=</span> <span class="mi">4</span>
</span><span id="Analyzer-283"><a href="#Analyzer-283"><span class="linenos"> 283</span></a>                        <span class="k">return</span> <span class="mi">4</span>
</span><span id="Analyzer-284"><a href="#Analyzer-284"><span class="linenos"> 284</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="Analyzer-285"><a href="#Analyzer-285"><span class="linenos"> 285</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">analysis_phase</span> <span class="o">=</span> <span class="mi">3</span>
</span><span id="Analyzer-286"><a href="#Analyzer-286"><span class="linenos"> 286</span></a>                    <span class="k">return</span> <span class="mi">3</span>
</span><span id="Analyzer-287"><a href="#Analyzer-287"><span class="linenos"> 287</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Analyzer-288"><a href="#Analyzer-288"><span class="linenos"> 288</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">analysis_phase</span> <span class="o">=</span> <span class="mi">2</span>
</span><span id="Analyzer-289"><a href="#Analyzer-289"><span class="linenos"> 289</span></a>                <span class="k">return</span> <span class="mi">2</span>
</span><span id="Analyzer-290"><a href="#Analyzer-290"><span class="linenos"> 290</span></a>        
</span><span id="Analyzer-291"><a href="#Analyzer-291"><span class="linenos"> 291</span></a>    <span class="k">def</span> <span class="nf">convert_addresses_to_gps</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">log_csv</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="Analyzer-292"><a href="#Analyzer-292"><span class="linenos"> 292</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Analyzer-293"><a href="#Analyzer-293"><span class="linenos"> 293</span></a><span class="sd">        Converts addresses from specified CSV files to GPS coordinates using the Google Maps API.</span>
</span><span id="Analyzer-294"><a href="#Analyzer-294"><span class="linenos"> 294</span></a>
</span><span id="Analyzer-295"><a href="#Analyzer-295"><span class="linenos"> 295</span></a><span class="sd">        This method processes both employee and office address data, converting each address to latitude and longitude coordinates. </span>
</span><span id="Analyzer-296"><a href="#Analyzer-296"><span class="linenos"> 296</span></a><span class="sd">        The results are saved to corresponding GPS data files. If logging is enabled, the process details are recorded in a specified log CSV file.</span>
</span><span id="Analyzer-297"><a href="#Analyzer-297"><span class="linenos"> 297</span></a>
</span><span id="Analyzer-298"><a href="#Analyzer-298"><span class="linenos"> 298</span></a><span class="sd">        Args:</span>
</span><span id="Analyzer-299"><a href="#Analyzer-299"><span class="linenos"> 299</span></a><span class="sd">            force (bool, optional): If True, forces re-conversion of addresses even if GPS data already exists. Defaults to False.</span>
</span><span id="Analyzer-300"><a href="#Analyzer-300"><span class="linenos"> 300</span></a><span class="sd">            log_csv (str, optional): Path to a log CSV file where operation details are recorded. Defaults to None.</span>
</span><span id="Analyzer-301"><a href="#Analyzer-301"><span class="linenos"> 301</span></a>
</span><span id="Analyzer-302"><a href="#Analyzer-302"><span class="linenos"> 302</span></a><span class="sd">        Returns:</span>
</span><span id="Analyzer-303"><a href="#Analyzer-303"><span class="linenos"> 303</span></a><span class="sd">            bool: True if the conversion process is completed successfully for all addresses; False otherwise.</span>
</span><span id="Analyzer-304"><a href="#Analyzer-304"><span class="linenos"> 304</span></a><span class="sd">        </span>
</span><span id="Analyzer-305"><a href="#Analyzer-305"><span class="linenos"> 305</span></a><span class="sd">        This method handles geocoding of addresses using the Google Maps API, respecting API rate limits</span>
</span><span id="Analyzer-306"><a href="#Analyzer-306"><span class="linenos"> 306</span></a><span class="sd">        and optionally logging the process. If `force` is True, existing GPS data is ignored, and addresses are re-geocoded.</span>
</span><span id="Analyzer-307"><a href="#Analyzer-307"><span class="linenos"> 307</span></a><span class="sd">            </span>
</span><span id="Analyzer-308"><a href="#Analyzer-308"><span class="linenos"> 308</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Analyzer-309"><a href="#Analyzer-309"><span class="linenos"> 309</span></a>
</span><span id="Analyzer-310"><a href="#Analyzer-310"><span class="linenos"> 310</span></a>        <span class="c1"># start logfile if logging</span>
</span><span id="Analyzer-311"><a href="#Analyzer-311"><span class="linenos"> 311</span></a>        <span class="k">if</span> <span class="n">log_csv</span><span class="p">:</span>
</span><span id="Analyzer-312"><a href="#Analyzer-312"><span class="linenos"> 312</span></a>            <span class="n">log</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">log_csv</span><span class="p">,</span> <span class="s2">&quot;a+&quot;</span><span class="p">)</span>
</span><span id="Analyzer-313"><a href="#Analyzer-313"><span class="linenos"> 313</span></a>            <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Beginning the geocoding of addresses</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Analyzer-314"><a href="#Analyzer-314"><span class="linenos"> 314</span></a>            <span class="c1"># dump the project data including the file system location of all data files to the log</span>
</span><span id="Analyzer-315"><a href="#Analyzer-315"><span class="linenos"> 315</span></a>            <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;project data&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Analyzer-316"><a href="#Analyzer-316"><span class="linenos"> 316</span></a>            <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">project_directory</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Analyzer-317"><a href="#Analyzer-317"><span class="linenos"> 317</span></a>
</span><span id="Analyzer-318"><a href="#Analyzer-318"><span class="linenos"> 318</span></a>            <span class="n">log</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
</span><span id="Analyzer-319"><a href="#Analyzer-319"><span class="linenos"> 319</span></a>        <span class="c1"># create a google API object if it doesn&#39;t exist</span>
</span><span id="Analyzer-320"><a href="#Analyzer-320"><span class="linenos"> 320</span></a>        <span class="c1"># if the project has an API key, use it, otherwise use the default .env key</span>
</span><span id="Analyzer-321"><a href="#Analyzer-321"><span class="linenos"> 321</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">GMAPS_API_KEY</span><span class="p">:</span>
</span><span id="Analyzer-322"><a href="#Analyzer-322"><span class="linenos"> 322</span></a>            <span class="n">api_key</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">GMAPS_API_KEY</span>
</span><span id="Analyzer-323"><a href="#Analyzer-323"><span class="linenos"> 323</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Analyzer-324"><a href="#Analyzer-324"><span class="linenos"> 324</span></a>            <span class="n">api_key</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gAPI_key</span>
</span><span id="Analyzer-325"><a href="#Analyzer-325"><span class="linenos"> 325</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">gAPI</span><span class="p">:</span>
</span><span id="Analyzer-326"><a href="#Analyzer-326"><span class="linenos"> 326</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">gAPI</span> <span class="o">=</span> <span class="n">GAPI</span><span class="p">(</span><span class="n">api_key</span><span class="p">)</span>  
</span><span id="Analyzer-327"><a href="#Analyzer-327"><span class="linenos"> 327</span></a>        <span class="c1"># same action for both files</span>
</span><span id="Analyzer-328"><a href="#Analyzer-328"><span class="linenos"> 328</span></a>        <span class="n">out</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;employee_addresses.csv&quot;</span><span class="p">:</span> <span class="s2">&quot;employee_gps.csv&quot;</span><span class="p">,</span> <span class="s2">&quot;office_addresses.csv&quot;</span><span class="p">:</span> <span class="s2">&quot;office_gps.csv&quot;</span><span class="p">}</span>
</span><span id="Analyzer-329"><a href="#Analyzer-329"><span class="linenos"> 329</span></a>        <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">out</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
</span><span id="Analyzer-330"><a href="#Analyzer-330"><span class="linenos"> 330</span></a>            <span class="c1"># check to see if addresses are already in the project</span>
</span><span id="Analyzer-331"><a href="#Analyzer-331"><span class="linenos"> 331</span></a>            <span class="k">if</span> <span class="n">file</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">list_data_files</span><span class="p">():</span>
</span><span id="Analyzer-332"><a href="#Analyzer-332"><span class="linenos"> 332</span></a>                <span class="c1"># if the address data isn&#39;t already in the project, load it</span>
</span><span id="Analyzer-333"><a href="#Analyzer-333"><span class="linenos"> 333</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">file</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">force</span><span class="p">:</span>
</span><span id="Analyzer-334"><a href="#Analyzer-334"><span class="linenos"> 334</span></a>                    <span class="c1"># attempt to load the address data</span>
</span><span id="Analyzer-335"><a href="#Analyzer-335"><span class="linenos"> 335</span></a>                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">load_data_file</span><span class="p">(</span><span class="n">file</span><span class="p">):</span>
</span><span id="Analyzer-336"><a href="#Analyzer-336"><span class="linenos"> 336</span></a>                        <span class="k">pass</span> <span class="c1"># valid data loaded</span>
</span><span id="Analyzer-337"><a href="#Analyzer-337"><span class="linenos"> 337</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="Analyzer-338"><a href="#Analyzer-338"><span class="linenos"> 338</span></a>                        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Errors loading address data from project.&quot;</span><span class="p">)</span>
</span><span id="Analyzer-339"><a href="#Analyzer-339"><span class="linenos"> 339</span></a>                        <span class="k">return</span> <span class="kc">False</span>
</span><span id="Analyzer-340"><a href="#Analyzer-340"><span class="linenos"> 340</span></a>                <span class="c1"># if the address data is already in the project, use it</span>
</span><span id="Analyzer-341"><a href="#Analyzer-341"><span class="linenos"> 341</span></a>                <span class="c1"># create the project data object to hold the gps data</span>
</span><span id="Analyzer-342"><a href="#Analyzer-342"><span class="linenos"> 342</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">start_dataframe</span><span class="p">(</span><span class="n">out</span><span class="p">[</span><span class="n">file</span><span class="p">])</span>
</span><span id="Analyzer-343"><a href="#Analyzer-343"><span class="linenos"> 343</span></a>                <span class="c1"># iterate through the address data and convert each address to gps lat long in the project data object</span>
</span><span id="Analyzer-344"><a href="#Analyzer-344"><span class="linenos"> 344</span></a>                <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">file</span><span class="p">]</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
</span><span id="Analyzer-345"><a href="#Analyzer-345"><span class="linenos"> 345</span></a>                    <span class="c1"># get the geocoded address lat and long</span>
</span><span id="Analyzer-346"><a href="#Analyzer-346"><span class="linenos"> 346</span></a>                    <span class="k">try</span><span class="p">:</span>
</span><span id="Analyzer-347"><a href="#Analyzer-347"><span class="linenos"> 347</span></a>                        <span class="k">if</span> <span class="n">log_csv</span><span class="p">:</span> 
</span><span id="Analyzer-348"><a href="#Analyzer-348"><span class="linenos"> 348</span></a>                            <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Geocoding address: &quot;</span><span class="o">+</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;address&quot;</span><span class="p">]</span><span class="o">+</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Analyzer-349"><a href="#Analyzer-349"><span class="linenos"> 349</span></a>                            <span class="n">log</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
</span><span id="Analyzer-350"><a href="#Analyzer-350"><span class="linenos"> 350</span></a>                            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Geocoding address: &quot;</span><span class="o">+</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;address&quot;</span><span class="p">]</span><span class="o">+</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Analyzer-351"><a href="#Analyzer-351"><span class="linenos"> 351</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">sleepif</span><span class="p">()</span>
</span><span id="Analyzer-352"><a href="#Analyzer-352"><span class="linenos"> 352</span></a>                        <span class="k">try</span><span class="p">:</span>
</span><span id="Analyzer-353"><a href="#Analyzer-353"><span class="linenos"> 353</span></a>                            <span class="n">latlong</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gAPI</span><span class="o">.</span><span class="n">geocode</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;address&quot;</span><span class="p">])</span>
</span><span id="Analyzer-354"><a href="#Analyzer-354"><span class="linenos"> 354</span></a>                        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="Analyzer-355"><a href="#Analyzer-355"><span class="linenos"> 355</span></a>                            <span class="c1"># if logging, write the exception event to the logfile</span>
</span><span id="Analyzer-356"><a href="#Analyzer-356"><span class="linenos"> 356</span></a>                            <span class="bp">self</span><span class="o">.</span><span class="n">log_error</span><span class="p">(</span><span class="s2">&quot;Exception calling geocode function: &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Analyzer-357"><a href="#Analyzer-357"><span class="linenos"> 357</span></a>                            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Exception calling geocode function: &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Analyzer-358"><a href="#Analyzer-358"><span class="linenos"> 358</span></a>                            <span class="c1"># if the excetion is a recoverable one, retry after a delay, else raise the exception</span>
</span><span id="Analyzer-359"><a href="#Analyzer-359"><span class="linenos"> 359</span></a>                            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">handle_GAPI_exception</span><span class="p">(</span><span class="n">e</span><span class="p">):</span>
</span><span id="Analyzer-360"><a href="#Analyzer-360"><span class="linenos"> 360</span></a>                                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;recoverable exception, waiting to retry once&quot;</span><span class="p">)</span>
</span><span id="Analyzer-361"><a href="#Analyzer-361"><span class="linenos"> 361</span></a>                                <span class="n">sleep</span><span class="p">(</span><span class="mi">10000</span><span class="p">)</span>
</span><span id="Analyzer-362"><a href="#Analyzer-362"><span class="linenos"> 362</span></a>                                <span class="k">try</span><span class="p">:</span>
</span><span id="Analyzer-363"><a href="#Analyzer-363"><span class="linenos"> 363</span></a>                                    <span class="n">latlong</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gAPI</span><span class="o">.</span><span class="n">geocode</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;address&quot;</span><span class="p">])</span>
</span><span id="Analyzer-364"><a href="#Analyzer-364"><span class="linenos"> 364</span></a>                                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="Analyzer-365"><a href="#Analyzer-365"><span class="linenos"> 365</span></a>                                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Unrecoverable exception, tried twice skipping address&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Analyzer-366"><a href="#Analyzer-366"><span class="linenos"> 366</span></a>                                    <span class="c1"># if logging, write the exception event to the logfile</span>
</span><span id="Analyzer-367"><a href="#Analyzer-367"><span class="linenos"> 367</span></a>                                    <span class="bp">self</span><span class="o">.</span><span class="n">log_error</span><span class="p">(</span><span class="s2">&quot;Recoverable error calling geocode function, failed twice. Deemed unrecoverable. Exception: &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Analyzer-368"><a href="#Analyzer-368"><span class="linenos"> 368</span></a>                                    <span class="n">e</span><span class="o">.</span><span class="n">add_note</span> <span class="o">=</span> <span class="s2">&quot;Recoverable error calling geocode function, failed twice. Deemed unrecoverable&quot;</span>
</span><span id="Analyzer-369"><a href="#Analyzer-369"><span class="linenos"> 369</span></a>                                    <span class="k">raise</span> <span class="n">e</span>
</span><span id="Analyzer-370"><a href="#Analyzer-370"><span class="linenos"> 370</span></a>                            <span class="k">else</span><span class="p">:</span>
</span><span id="Analyzer-371"><a href="#Analyzer-371"><span class="linenos"> 371</span></a>                                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Recoverable exception calling geocode, skipping address. </span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Analyzer-372"><a href="#Analyzer-372"><span class="linenos"> 372</span></a>                                <span class="bp">self</span><span class="o">.</span><span class="n">log_error</span><span class="p">(</span><span class="s2">&quot;Unrecoverable error calling geocode, failed once. Exception: &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Analyzer-373"><a href="#Analyzer-373"><span class="linenos"> 373</span></a>                                <span class="n">e</span><span class="o">.</span><span class="n">add_note</span> <span class="o">=</span> <span class="s2">&quot;Unrecoverable error calling geocode, failed once&quot;</span>
</span><span id="Analyzer-374"><a href="#Analyzer-374"><span class="linenos"> 374</span></a>                                <span class="k">raise</span> <span class="n">e</span>
</span><span id="Analyzer-375"><a href="#Analyzer-375"><span class="linenos"> 375</span></a>                            
</span><span id="Analyzer-376"><a href="#Analyzer-376"><span class="linenos"> 376</span></a>
</span><span id="Analyzer-377"><a href="#Analyzer-377"><span class="linenos"> 377</span></a>                        <span class="c1"># insert the lat and long into a new row in the project data object</span>
</span><span id="Analyzer-378"><a href="#Analyzer-378"><span class="linenos"> 378</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">out</span><span class="p">[</span><span class="n">file</span><span class="p">]]</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;address&quot;</span><span class="p">:</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;address&quot;</span><span class="p">],</span><span class="s2">&quot;latitude&quot;</span><span class="p">:</span> <span class="n">latlong</span><span class="p">[</span><span class="s1">&#39;lat&#39;</span><span class="p">],</span> <span class="s2">&quot;longitude&quot;</span><span class="p">:</span> <span class="n">latlong</span><span class="p">[</span><span class="s1">&#39;lng&#39;</span><span class="p">]}</span>
</span><span id="Analyzer-379"><a href="#Analyzer-379"><span class="linenos"> 379</span></a>                    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="Analyzer-380"><a href="#Analyzer-380"><span class="linenos"> 380</span></a>                        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Error saving geocode address result: &quot;</span><span class="o">+</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;address&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> Got exception: &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
</span><span id="Analyzer-381"><a href="#Analyzer-381"><span class="linenos"> 381</span></a>                        <span class="k">if</span> <span class="n">log_csv</span><span class="p">:</span> <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Error saving geocode result address: &quot;</span><span class="o">+</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;address&quot;</span><span class="p">]</span><span class="o">+</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Analyzer-382"><a href="#Analyzer-382"><span class="linenos"> 382</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">log_error</span><span class="p">(</span><span class="s2">&quot;Error saving geocode result address: &quot;</span><span class="o">+</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;address&quot;</span><span class="p">]</span><span class="o">+</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;Got exception: &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
</span><span id="Analyzer-383"><a href="#Analyzer-383"><span class="linenos"> 383</span></a>                        <span class="k">raise</span> <span class="n">e</span>
</span><span id="Analyzer-384"><a href="#Analyzer-384"><span class="linenos"> 384</span></a>                                            
</span><span id="Analyzer-385"><a href="#Analyzer-385"><span class="linenos"> 385</span></a>                <span class="c1"># save the project data object to the csv file</span>
</span><span id="Analyzer-386"><a href="#Analyzer-386"><span class="linenos"> 386</span></a>                <span class="k">if</span> <span class="n">file</span> <span class="o">==</span> <span class="s2">&quot;employee_addresses.csv&quot;</span><span class="p">:</span>
</span><span id="Analyzer-387"><a href="#Analyzer-387"><span class="linenos"> 387</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">save_data_file</span><span class="p">(</span><span class="n">out</span><span class="p">[</span><span class="n">file</span><span class="p">])</span>
</span><span id="Analyzer-388"><a href="#Analyzer-388"><span class="linenos"> 388</span></a>                <span class="k">elif</span> <span class="n">file</span> <span class="o">==</span> <span class="s2">&quot;office_addresses.csv&quot;</span><span class="p">:</span>
</span><span id="Analyzer-389"><a href="#Analyzer-389"><span class="linenos"> 389</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">save_data_file</span><span class="p">(</span><span class="n">out</span><span class="p">[</span><span class="n">file</span><span class="p">])</span>
</span><span id="Analyzer-390"><a href="#Analyzer-390"><span class="linenos"> 390</span></a>                <span class="c1"># update the analysis phase</span>
</span><span id="Analyzer-391"><a href="#Analyzer-391"><span class="linenos"> 391</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">update_analysis_phase</span><span class="p">()</span>
</span><span id="Analyzer-392"><a href="#Analyzer-392"><span class="linenos"> 392</span></a>                <span class="k">if</span> <span class="n">log_csv</span><span class="p">:</span> <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Geocoding complete</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Analyzer-393"><a href="#Analyzer-393"><span class="linenos"> 393</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Analyzer-394"><a href="#Analyzer-394"><span class="linenos"> 394</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Address data &quot;</span><span class="o">+</span><span class="n">file</span><span class="o">+</span><span class="s2">&quot; missing from project.&quot;</span><span class="p">)</span>
</span><span id="Analyzer-395"><a href="#Analyzer-395"><span class="linenos"> 395</span></a>                <span class="k">return</span> <span class="kc">False</span>   
</span><span id="Analyzer-396"><a href="#Analyzer-396"><span class="linenos"> 396</span></a>        <span class="k">if</span> <span class="n">log_csv</span><span class="p">:</span> <span class="n">log</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>             
</span><span id="Analyzer-397"><a href="#Analyzer-397"><span class="linenos"> 397</span></a>        <span class="k">return</span> <span class="kc">True</span>
</span><span id="Analyzer-398"><a href="#Analyzer-398"><span class="linenos"> 398</span></a>    
</span><span id="Analyzer-399"><a href="#Analyzer-399"><span class="linenos"> 399</span></a>    <span class="k">def</span> <span class="nf">fuzz_employee_gps</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="Analyzer-400"><a href="#Analyzer-400"><span class="linenos"> 400</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Analyzer-401"><a href="#Analyzer-401"><span class="linenos"> 401</span></a><span class="sd">        Applies a fuzzing process to employee GPS coordinates to anonymize locations.</span>
</span><span id="Analyzer-402"><a href="#Analyzer-402"><span class="linenos"> 402</span></a>
</span><span id="Analyzer-403"><a href="#Analyzer-403"><span class="linenos"> 403</span></a><span class="sd">        This method adds a small, random displacement to the latitude and longitude of employee addresses. </span>
</span><span id="Analyzer-404"><a href="#Analyzer-404"><span class="linenos"> 404</span></a><span class="sd">        This process is intended to protect privacy by preventing the exact identification of employee home locations.</span>
</span><span id="Analyzer-405"><a href="#Analyzer-405"><span class="linenos"> 405</span></a>
</span><span id="Analyzer-406"><a href="#Analyzer-406"><span class="linenos"> 406</span></a><span class="sd">        Args:</span>
</span><span id="Analyzer-407"><a href="#Analyzer-407"><span class="linenos"> 407</span></a><span class="sd">            force (bool, optional): If True, forces re-fuzzing of GPS coordinates even if fuzzed data already exists. Defaults to False.</span>
</span><span id="Analyzer-408"><a href="#Analyzer-408"><span class="linenos"> 408</span></a>
</span><span id="Analyzer-409"><a href="#Analyzer-409"><span class="linenos"> 409</span></a><span class="sd">        Returns:</span>
</span><span id="Analyzer-410"><a href="#Analyzer-410"><span class="linenos"> 410</span></a><span class="sd">            bool: True if fuzzing is successfully applied to all employee GPS coordinates; False otherwise.</span>
</span><span id="Analyzer-411"><a href="#Analyzer-411"><span class="linenos"> 411</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Analyzer-412"><a href="#Analyzer-412"><span class="linenos"> 412</span></a>        <span class="c1"># if the google API object doesn&#39;t exist, create it</span>
</span><span id="Analyzer-413"><a href="#Analyzer-413"><span class="linenos"> 413</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">gAPI</span><span class="p">:</span>
</span><span id="Analyzer-414"><a href="#Analyzer-414"><span class="linenos"> 414</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">gAPI</span> <span class="o">=</span> <span class="n">GAPI</span><span class="p">()</span>
</span><span id="Analyzer-415"><a href="#Analyzer-415"><span class="linenos"> 415</span></a>        <span class="c1"># add a small amount of fuzz to the employee gps coordinates</span>
</span><span id="Analyzer-416"><a href="#Analyzer-416"><span class="linenos"> 416</span></a>        <span class="c1"># if the gps data isn&#39;t already in the project, load it</span>
</span><span id="Analyzer-417"><a href="#Analyzer-417"><span class="linenos"> 417</span></a>        <span class="k">if</span> <span class="s2">&quot;employee_gps.csv&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">list_data_files</span><span class="p">():</span>
</span><span id="Analyzer-418"><a href="#Analyzer-418"><span class="linenos"> 418</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;employee_gps.csv&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">force</span><span class="p">:</span>
</span><span id="Analyzer-419"><a href="#Analyzer-419"><span class="linenos"> 419</span></a>                <span class="c1"># attempt to load the gps data</span>
</span><span id="Analyzer-420"><a href="#Analyzer-420"><span class="linenos"> 420</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">load_data_file</span><span class="p">(</span><span class="s2">&quot;employee_gps.csv&quot;</span><span class="p">):</span>
</span><span id="Analyzer-421"><a href="#Analyzer-421"><span class="linenos"> 421</span></a>                    <span class="k">pass</span>
</span><span id="Analyzer-422"><a href="#Analyzer-422"><span class="linenos"> 422</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="Analyzer-423"><a href="#Analyzer-423"><span class="linenos"> 423</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Errors loading gps data from project.&quot;</span><span class="p">)</span>
</span><span id="Analyzer-424"><a href="#Analyzer-424"><span class="linenos"> 424</span></a>                    <span class="k">return</span> <span class="kc">False</span>
</span><span id="Analyzer-425"><a href="#Analyzer-425"><span class="linenos"> 425</span></a>            <span class="c1"># if the gps data is already in the project, use it</span>
</span><span id="Analyzer-426"><a href="#Analyzer-426"><span class="linenos"> 426</span></a>            <span class="c1"># create the project data object to hold the fuzzed gps data</span>
</span><span id="Analyzer-427"><a href="#Analyzer-427"><span class="linenos"> 427</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">start_dataframe</span><span class="p">(</span><span class="s2">&quot;gps_fuzz.csv&quot;</span><span class="p">)</span>
</span><span id="Analyzer-428"><a href="#Analyzer-428"><span class="linenos"> 428</span></a>            <span class="c1"># iterate through the gps data and fuzz each set of coordinates</span>
</span><span id="Analyzer-429"><a href="#Analyzer-429"><span class="linenos"> 429</span></a>            <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;employee_gps.csv&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
</span><span id="Analyzer-430"><a href="#Analyzer-430"><span class="linenos"> 430</span></a>                <span class="c1"># fuzz the lat and long</span>
</span><span id="Analyzer-431"><a href="#Analyzer-431"><span class="linenos"> 431</span></a>                <span class="n">latlong</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gAPI</span><span class="o">.</span><span class="n">fuzz_latlong</span><span class="p">({</span><span class="s2">&quot;lat&quot;</span><span class="p">:</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;latitude&quot;</span><span class="p">],</span> <span class="s2">&quot;lng&quot;</span><span class="p">:</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;longitude&quot;</span><span class="p">]},</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">gps_fuzz_factor</span><span class="p">)</span>
</span><span id="Analyzer-432"><a href="#Analyzer-432"><span class="linenos"> 432</span></a>                <span class="c1"># insert the fuzzed lat and long into a new row in the project data object</span>
</span><span id="Analyzer-433"><a href="#Analyzer-433"><span class="linenos"> 433</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;gps_fuzz.csv&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;latitude&quot;</span><span class="p">:</span> <span class="n">latlong</span><span class="p">[</span><span class="s1">&#39;lat&#39;</span><span class="p">],</span> <span class="s2">&quot;longitude&quot;</span><span class="p">:</span> <span class="n">latlong</span><span class="p">[</span><span class="s1">&#39;lng&#39;</span><span class="p">]}</span>
</span><span id="Analyzer-434"><a href="#Analyzer-434"><span class="linenos"> 434</span></a>            <span class="c1"># save the project data object to the csv file</span>
</span><span id="Analyzer-435"><a href="#Analyzer-435"><span class="linenos"> 435</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">save_data_file</span><span class="p">(</span><span class="s2">&quot;gps_fuzz.csv&quot;</span><span class="p">)</span>
</span><span id="Analyzer-436"><a href="#Analyzer-436"><span class="linenos"> 436</span></a>            <span class="c1"># update the analysis phase</span>
</span><span id="Analyzer-437"><a href="#Analyzer-437"><span class="linenos"> 437</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">update_analysis_phase</span><span class="p">()</span>
</span><span id="Analyzer-438"><a href="#Analyzer-438"><span class="linenos"> 438</span></a>        <span class="k">else</span><span class="p">:</span>    
</span><span id="Analyzer-439"><a href="#Analyzer-439"><span class="linenos"> 439</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;GPS data missing from project.&quot;</span><span class="p">)</span>
</span><span id="Analyzer-440"><a href="#Analyzer-440"><span class="linenos"> 440</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="Analyzer-441"><a href="#Analyzer-441"><span class="linenos"> 441</span></a>        
</span><span id="Analyzer-442"><a href="#Analyzer-442"><span class="linenos"> 442</span></a>    <span class="k">def</span> <span class="nf">get_commute_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">log_csv</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="Analyzer-443"><a href="#Analyzer-443"><span class="linenos"> 443</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Analyzer-444"><a href="#Analyzer-444"><span class="linenos"> 444</span></a><span class="sd">        Generates commute data for employees based on their GPS coordinates and the office locations.</span>
</span><span id="Analyzer-445"><a href="#Analyzer-445"><span class="linenos"> 445</span></a>
</span><span id="Analyzer-446"><a href="#Analyzer-446"><span class="linenos"> 446</span></a><span class="sd">        This method calculates commute times and distances from employees&#39; locations to the office, accounting for specified commute times. </span>
</span><span id="Analyzer-447"><a href="#Analyzer-447"><span class="linenos"> 447</span></a><span class="sd">        Optionally logs the operation details if a log CSV file path is provided.</span>
</span><span id="Analyzer-448"><a href="#Analyzer-448"><span class="linenos"> 448</span></a>
</span><span id="Analyzer-449"><a href="#Analyzer-449"><span class="linenos"> 449</span></a><span class="sd">        Args:</span>
</span><span id="Analyzer-450"><a href="#Analyzer-450"><span class="linenos"> 450</span></a><span class="sd">            force (bool, optional): If True, forces regeneration of commute data even if it already exists. Defaults to False.</span>
</span><span id="Analyzer-451"><a href="#Analyzer-451"><span class="linenos"> 451</span></a><span class="sd">            log_csv (str, optional): Path to a log CSV file where operation details are recorded. Defaults to None.</span>
</span><span id="Analyzer-452"><a href="#Analyzer-452"><span class="linenos"> 452</span></a>
</span><span id="Analyzer-453"><a href="#Analyzer-453"><span class="linenos"> 453</span></a><span class="sd">        Returns:</span>
</span><span id="Analyzer-454"><a href="#Analyzer-454"><span class="linenos"> 454</span></a><span class="sd">            bool: True if commute data is successfully generated; False otherwise.</span>
</span><span id="Analyzer-455"><a href="#Analyzer-455"><span class="linenos"> 455</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Analyzer-456"><a href="#Analyzer-456"><span class="linenos"> 456</span></a>
</span><span id="Analyzer-457"><a href="#Analyzer-457"><span class="linenos"> 457</span></a>        <span class="c1"># if the use fuzzed data flag is set, use the fuzzed data, otherwise use the original data</span>
</span><span id="Analyzer-458"><a href="#Analyzer-458"><span class="linenos"> 458</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">use_gps_fuzzing</span><span class="o">==</span><span class="kc">True</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">use_gps_fuzzing</span><span class="o">==</span><span class="s2">&quot;True&quot;</span><span class="p">:</span>
</span><span id="Analyzer-459"><a href="#Analyzer-459"><span class="linenos"> 459</span></a>            <span class="c1"># if the fuzzed gps data isn&#39;t already in the project, load it</span>
</span><span id="Analyzer-460"><a href="#Analyzer-460"><span class="linenos"> 460</span></a>            <span class="k">if</span> <span class="s2">&quot;gps_fuzz.csv&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">list_data_files</span><span class="p">():</span>
</span><span id="Analyzer-461"><a href="#Analyzer-461"><span class="linenos"> 461</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;gps_fuzz.csv&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">force</span><span class="p">:</span>
</span><span id="Analyzer-462"><a href="#Analyzer-462"><span class="linenos"> 462</span></a>                    <span class="c1"># attempt to load the fuzzed gps data</span>
</span><span id="Analyzer-463"><a href="#Analyzer-463"><span class="linenos"> 463</span></a>                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">load_data_file</span><span class="p">(</span><span class="s2">&quot;gps_fuzz.csv&quot;</span><span class="p">):</span>
</span><span id="Analyzer-464"><a href="#Analyzer-464"><span class="linenos"> 464</span></a>                        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Using fuzzed GPS data.&quot;</span><span class="p">)</span>
</span><span id="Analyzer-465"><a href="#Analyzer-465"><span class="linenos"> 465</span></a>                        <span class="k">pass</span>
</span><span id="Analyzer-466"><a href="#Analyzer-466"><span class="linenos"> 466</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="Analyzer-467"><a href="#Analyzer-467"><span class="linenos"> 467</span></a>                        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Errors loading fuzzed gps data from project.&quot;</span><span class="p">)</span>
</span><span id="Analyzer-468"><a href="#Analyzer-468"><span class="linenos"> 468</span></a>                        <span class="k">return</span> <span class="kc">False</span>
</span><span id="Analyzer-469"><a href="#Analyzer-469"><span class="linenos"> 469</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Analyzer-470"><a href="#Analyzer-470"><span class="linenos"> 470</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Fuzzed GPS data missing from project.&quot;</span><span class="p">)</span>
</span><span id="Analyzer-471"><a href="#Analyzer-471"><span class="linenos"> 471</span></a>                <span class="k">return</span> <span class="kc">False</span>
</span><span id="Analyzer-472"><a href="#Analyzer-472"><span class="linenos"> 472</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Analyzer-473"><a href="#Analyzer-473"><span class="linenos"> 473</span></a>            <span class="c1"># use the un fuzzed data</span>
</span><span id="Analyzer-474"><a href="#Analyzer-474"><span class="linenos"> 474</span></a>            <span class="c1"># if the gps data isn&#39;t already in the project, load it</span>
</span><span id="Analyzer-475"><a href="#Analyzer-475"><span class="linenos"> 475</span></a>            <span class="k">if</span> <span class="s2">&quot;employee_gps.csv&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">list_data_files</span><span class="p">():</span>
</span><span id="Analyzer-476"><a href="#Analyzer-476"><span class="linenos"> 476</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;employee_gps.csv&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">force</span><span class="p">:</span>
</span><span id="Analyzer-477"><a href="#Analyzer-477"><span class="linenos"> 477</span></a>                    <span class="c1"># attempt to load the gps data</span>
</span><span id="Analyzer-478"><a href="#Analyzer-478"><span class="linenos"> 478</span></a>                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">load_data_file</span><span class="p">(</span><span class="s2">&quot;employee_gps.csv&quot;</span><span class="p">):</span>
</span><span id="Analyzer-479"><a href="#Analyzer-479"><span class="linenos"> 479</span></a>                        <span class="k">pass</span>
</span><span id="Analyzer-480"><a href="#Analyzer-480"><span class="linenos"> 480</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="Analyzer-481"><a href="#Analyzer-481"><span class="linenos"> 481</span></a>                        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Errors loading gps data from project.&quot;</span><span class="p">)</span>
</span><span id="Analyzer-482"><a href="#Analyzer-482"><span class="linenos"> 482</span></a>                        <span class="k">return</span> <span class="kc">False</span>
</span><span id="Analyzer-483"><a href="#Analyzer-483"><span class="linenos"> 483</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="Analyzer-484"><a href="#Analyzer-484"><span class="linenos"> 484</span></a>                    <span class="k">pass</span>
</span><span id="Analyzer-485"><a href="#Analyzer-485"><span class="linenos"> 485</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Analyzer-486"><a href="#Analyzer-486"><span class="linenos"> 486</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;GPS data missing from project.&quot;</span><span class="p">)</span>
</span><span id="Analyzer-487"><a href="#Analyzer-487"><span class="linenos"> 487</span></a>                <span class="k">return</span> <span class="kc">False</span>
</span><span id="Analyzer-488"><a href="#Analyzer-488"><span class="linenos"> 488</span></a>        <span class="c1"># attempt to load the office gps data</span>
</span><span id="Analyzer-489"><a href="#Analyzer-489"><span class="linenos"> 489</span></a>        <span class="k">if</span> <span class="s2">&quot;office_gps.csv&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">list_data_files</span><span class="p">():</span>
</span><span id="Analyzer-490"><a href="#Analyzer-490"><span class="linenos"> 490</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;office_gps.csv&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">force</span><span class="p">:</span>
</span><span id="Analyzer-491"><a href="#Analyzer-491"><span class="linenos"> 491</span></a>                <span class="c1"># attempt to load the office gps data</span>
</span><span id="Analyzer-492"><a href="#Analyzer-492"><span class="linenos"> 492</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">load_data_file</span><span class="p">(</span><span class="s2">&quot;office_gps.csv&quot;</span><span class="p">):</span>
</span><span id="Analyzer-493"><a href="#Analyzer-493"><span class="linenos"> 493</span></a>                    <span class="k">pass</span>
</span><span id="Analyzer-494"><a href="#Analyzer-494"><span class="linenos"> 494</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="Analyzer-495"><a href="#Analyzer-495"><span class="linenos"> 495</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Errors loading office gps data from project.&quot;</span><span class="p">)</span>
</span><span id="Analyzer-496"><a href="#Analyzer-496"><span class="linenos"> 496</span></a>                    <span class="k">return</span> <span class="kc">False</span>
</span><span id="Analyzer-497"><a href="#Analyzer-497"><span class="linenos"> 497</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Analyzer-498"><a href="#Analyzer-498"><span class="linenos"> 498</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Office GPS data missing from project.&quot;</span><span class="p">)</span>
</span><span id="Analyzer-499"><a href="#Analyzer-499"><span class="linenos"> 499</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="Analyzer-500"><a href="#Analyzer-500"><span class="linenos"> 500</span></a>        
</span><span id="Analyzer-501"><a href="#Analyzer-501"><span class="linenos"> 501</span></a>        <span class="c1"># touch the logfile to lock</span>
</span><span id="Analyzer-502"><a href="#Analyzer-502"><span class="linenos"> 502</span></a>        <span class="k">if</span> <span class="n">log_csv</span><span class="p">:</span>
</span><span id="Analyzer-503"><a href="#Analyzer-503"><span class="linenos"> 503</span></a>            <span class="n">log</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">log_csv</span><span class="p">,</span> <span class="s2">&quot;a+&quot;</span><span class="p">)</span>
</span><span id="Analyzer-504"><a href="#Analyzer-504"><span class="linenos"> 504</span></a>            <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Beginning the generation of commute data</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Analyzer-505"><a href="#Analyzer-505"><span class="linenos"> 505</span></a>            <span class="n">log</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
</span><span id="Analyzer-506"><a href="#Analyzer-506"><span class="linenos"> 506</span></a>        <span class="c1"># if the google API object doesn&#39;t exist, create it</span>
</span><span id="Analyzer-507"><a href="#Analyzer-507"><span class="linenos"> 507</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">gAPI</span><span class="p">:</span>
</span><span id="Analyzer-508"><a href="#Analyzer-508"><span class="linenos"> 508</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">gAPI</span> <span class="o">=</span> <span class="n">GAPI</span><span class="p">()</span>
</span><span id="Analyzer-509"><a href="#Analyzer-509"><span class="linenos"> 509</span></a>        <span class="c1"># create a new dataframe to hold the commute data</span>
</span><span id="Analyzer-510"><a href="#Analyzer-510"><span class="linenos"> 510</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">start_dataframe</span><span class="p">(</span><span class="s2">&quot;commute_data.csv&quot;</span><span class="p">)</span>
</span><span id="Analyzer-511"><a href="#Analyzer-511"><span class="linenos"> 511</span></a>        <span class="c1"># create preparatory helper variables</span>
</span><span id="Analyzer-512"><a href="#Analyzer-512"><span class="linenos"> 512</span></a>        <span class="c1"># create datetime objects for the morning commute times</span>
</span><span id="Analyzer-513"><a href="#Analyzer-513"><span class="linenos"> 513</span></a>        <span class="n">morning_departure</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">morning_commute_start</span><span class="p">,</span> <span class="s2">&quot;%H:%M&quot;</span><span class="p">)</span>
</span><span id="Analyzer-514"><a href="#Analyzer-514"><span class="linenos"> 514</span></a>        <span class="n">evening_departure</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">evening_commute_start</span><span class="p">,</span> <span class="s2">&quot;%H:%M&quot;</span><span class="p">)</span>
</span><span id="Analyzer-515"><a href="#Analyzer-515"><span class="linenos"> 515</span></a>        <span class="n">days</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;m&quot;</span><span class="p">,</span><span class="s2">&quot;t&quot;</span><span class="p">,</span><span class="s2">&quot;w&quot;</span><span class="p">,</span><span class="s2">&quot;h&quot;</span><span class="p">,</span><span class="s2">&quot;f&quot;</span><span class="p">]</span>
</span><span id="Analyzer-516"><a href="#Analyzer-516"><span class="linenos"> 516</span></a>        <span class="n">times</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;morning&quot;</span><span class="p">,</span><span class="s2">&quot;evening&quot;</span><span class="p">]</span>
</span><span id="Analyzer-517"><a href="#Analyzer-517"><span class="linenos"> 517</span></a>        <span class="n">values</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;duration_in_traffic&quot;</span><span class="p">]</span>
</span><span id="Analyzer-518"><a href="#Analyzer-518"><span class="linenos"> 518</span></a>        <span class="c1"># get today&#39;s data and calculate days until NEXT monday</span>
</span><span id="Analyzer-519"><a href="#Analyzer-519"><span class="linenos"> 519</span></a>        <span class="n">today</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">today</span><span class="p">()</span>
</span><span id="Analyzer-520"><a href="#Analyzer-520"><span class="linenos"> 520</span></a>        <span class="n">days_until_monday</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="o">-</span><span class="n">today</span><span class="o">.</span><span class="n">weekday</span><span class="p">())</span> <span class="o">%</span> <span class="mi">7</span>
</span><span id="Analyzer-521"><a href="#Analyzer-521"><span class="linenos"> 521</span></a>        <span class="k">if</span> <span class="n">days_until_monday</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> <span class="c1"># today is a monday, we want the next one</span>
</span><span id="Analyzer-522"><a href="#Analyzer-522"><span class="linenos"> 522</span></a>            <span class="c1"># get the date of next monday</span>
</span><span id="Analyzer-523"><a href="#Analyzer-523"><span class="linenos"> 523</span></a>            <span class="n">days_until_monday</span> <span class="o">=</span> <span class="mi">7</span>
</span><span id="Analyzer-524"><a href="#Analyzer-524"><span class="linenos"> 524</span></a>        <span class="c1"># get the calendar date seven days from today</span>
</span><span id="Analyzer-525"><a href="#Analyzer-525"><span class="linenos"> 525</span></a>        <span class="n">next_monday</span> <span class="o">=</span> <span class="n">today</span> <span class="o">+</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="n">days_until_monday</span><span class="p">)</span>
</span><span id="Analyzer-526"><a href="#Analyzer-526"><span class="linenos"> 526</span></a>        <span class="c1">#next_monday = today.replace(day=today.day+days_until_monday)</span>
</span><span id="Analyzer-527"><a href="#Analyzer-527"><span class="linenos"> 527</span></a>        <span class="c1"># based off of next_monday, create morning and evening date time objects for commute departure times in project attributes</span>
</span><span id="Analyzer-528"><a href="#Analyzer-528"><span class="linenos"> 528</span></a>        <span class="n">commutes</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;m_morning&#39;</span><span class="p">:</span><span class="n">datetime</span><span class="o">.</span><span class="n">combine</span><span class="p">(</span><span class="n">next_monday</span><span class="p">,</span> <span class="n">morning_departure</span><span class="o">.</span><span class="n">time</span><span class="p">()),</span>
</span><span id="Analyzer-529"><a href="#Analyzer-529"><span class="linenos"> 529</span></a>                    <span class="s1">&#39;m_evening&#39;</span><span class="p">:</span><span class="n">datetime</span><span class="o">.</span><span class="n">combine</span><span class="p">(</span><span class="n">next_monday</span><span class="p">,</span> <span class="n">evening_departure</span><span class="o">.</span><span class="n">time</span><span class="p">()),</span>
</span><span id="Analyzer-530"><a href="#Analyzer-530"><span class="linenos"> 530</span></a>                    <span class="s1">&#39;t_morning&#39;</span><span class="p">:</span><span class="n">datetime</span><span class="o">.</span><span class="n">combine</span><span class="p">(</span><span class="n">next_monday</span><span class="o">+</span><span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span> <span class="n">morning_departure</span><span class="o">.</span><span class="n">time</span><span class="p">()),</span>
</span><span id="Analyzer-531"><a href="#Analyzer-531"><span class="linenos"> 531</span></a>                    <span class="s1">&#39;t_evening&#39;</span><span class="p">:</span><span class="n">datetime</span><span class="o">.</span><span class="n">combine</span><span class="p">(</span><span class="n">next_monday</span><span class="o">+</span><span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span> <span class="n">evening_departure</span><span class="o">.</span><span class="n">time</span><span class="p">()),</span>
</span><span id="Analyzer-532"><a href="#Analyzer-532"><span class="linenos"> 532</span></a>                    <span class="s1">&#39;w_morning&#39;</span><span class="p">:</span><span class="n">datetime</span><span class="o">.</span><span class="n">combine</span><span class="p">(</span><span class="n">next_monday</span><span class="o">+</span><span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">2</span><span class="p">),</span> <span class="n">morning_departure</span><span class="o">.</span><span class="n">time</span><span class="p">()),</span>
</span><span id="Analyzer-533"><a href="#Analyzer-533"><span class="linenos"> 533</span></a>                    <span class="s1">&#39;w_evening&#39;</span><span class="p">:</span><span class="n">datetime</span><span class="o">.</span><span class="n">combine</span><span class="p">(</span><span class="n">next_monday</span><span class="o">+</span><span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">2</span><span class="p">),</span> <span class="n">evening_departure</span><span class="o">.</span><span class="n">time</span><span class="p">()),</span>
</span><span id="Analyzer-534"><a href="#Analyzer-534"><span class="linenos"> 534</span></a>                    <span class="s1">&#39;h_morning&#39;</span><span class="p">:</span><span class="n">datetime</span><span class="o">.</span><span class="n">combine</span><span class="p">(</span><span class="n">next_monday</span><span class="o">+</span><span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">3</span><span class="p">),</span> <span class="n">morning_departure</span><span class="o">.</span><span class="n">time</span><span class="p">()),</span>
</span><span id="Analyzer-535"><a href="#Analyzer-535"><span class="linenos"> 535</span></a>                    <span class="s1">&#39;h_evening&#39;</span><span class="p">:</span><span class="n">datetime</span><span class="o">.</span><span class="n">combine</span><span class="p">(</span><span class="n">next_monday</span><span class="o">+</span><span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">3</span><span class="p">),</span> <span class="n">evening_departure</span><span class="o">.</span><span class="n">time</span><span class="p">()),</span>
</span><span id="Analyzer-536"><a href="#Analyzer-536"><span class="linenos"> 536</span></a>                    <span class="s1">&#39;f_morning&#39;</span><span class="p">:</span><span class="n">datetime</span><span class="o">.</span><span class="n">combine</span><span class="p">(</span><span class="n">next_monday</span><span class="o">+</span><span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">4</span><span class="p">),</span> <span class="n">morning_departure</span><span class="o">.</span><span class="n">time</span><span class="p">()),</span>
</span><span id="Analyzer-537"><a href="#Analyzer-537"><span class="linenos"> 537</span></a>                    <span class="s1">&#39;f_evening&#39;</span><span class="p">:</span><span class="n">datetime</span><span class="o">.</span><span class="n">combine</span><span class="p">(</span><span class="n">next_monday</span><span class="o">+</span><span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">4</span><span class="p">),</span> <span class="n">evening_departure</span><span class="o">.</span><span class="n">time</span><span class="p">())</span>
</span><span id="Analyzer-538"><a href="#Analyzer-538"><span class="linenos"> 538</span></a>                    <span class="p">}</span>
</span><span id="Analyzer-539"><a href="#Analyzer-539"><span class="linenos"> 539</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Analyzer-540"><a href="#Analyzer-540"><span class="linenos"> 540</span></a><span class="sd">        &quot;commute_data.csv&quot;: [&quot;office_address&quot;,&quot;origin_lat&quot;, &quot;origin_long&quot;, &quot;destination_lat&quot;, &quot;destination_long&quot;, </span>
</span><span id="Analyzer-541"><a href="#Analyzer-541"><span class="linenos"> 541</span></a><span class="sd">                                 &quot;miles&quot;, &quot;duration&quot;, &quot;emissions&quot;, &quot;commute_cost&quot;,</span>
</span><span id="Analyzer-542"><a href="#Analyzer-542"><span class="linenos"> 542</span></a><span class="sd">                                 &quot;m_morning_duration_in_traffic&quot;, </span>
</span><span id="Analyzer-543"><a href="#Analyzer-543"><span class="linenos"> 543</span></a><span class="sd">                                 &quot;m_morning_emissions&quot;, </span>
</span><span id="Analyzer-544"><a href="#Analyzer-544"><span class="linenos"> 544</span></a><span class="sd">                                 &quot;m_evening_duration_in_traffic&quot;, </span>
</span><span id="Analyzer-545"><a href="#Analyzer-545"><span class="linenos"> 545</span></a><span class="sd">                                 &quot;m_evening_emissions&quot;,</span>
</span><span id="Analyzer-546"><a href="#Analyzer-546"><span class="linenos"> 546</span></a><span class="sd">                                 &quot;t_morning_duration_in_traffic&quot;, </span>
</span><span id="Analyzer-547"><a href="#Analyzer-547"><span class="linenos"> 547</span></a><span class="sd">                                 &quot;t_morning_emissions&quot;, </span>
</span><span id="Analyzer-548"><a href="#Analyzer-548"><span class="linenos"> 548</span></a><span class="sd">                                 &quot;t_evening_duration_in_traffic&quot;, </span>
</span><span id="Analyzer-549"><a href="#Analyzer-549"><span class="linenos"> 549</span></a><span class="sd">                                 &quot;t_evening_emissions&quot;,</span>
</span><span id="Analyzer-550"><a href="#Analyzer-550"><span class="linenos"> 550</span></a><span class="sd">                                 &quot;w_morning_duration_in_traffic&quot;, </span>
</span><span id="Analyzer-551"><a href="#Analyzer-551"><span class="linenos"> 551</span></a><span class="sd">                                 &quot;w_morning_emissions&quot;, </span>
</span><span id="Analyzer-552"><a href="#Analyzer-552"><span class="linenos"> 552</span></a><span class="sd">                                 &quot;w_evening_duration_in_traffic&quot;, </span>
</span><span id="Analyzer-553"><a href="#Analyzer-553"><span class="linenos"> 553</span></a><span class="sd">                                 &quot;w_evening_emissions&quot;,</span>
</span><span id="Analyzer-554"><a href="#Analyzer-554"><span class="linenos"> 554</span></a><span class="sd">                                 &quot;h_morning_duration_in_traffic&quot;, </span>
</span><span id="Analyzer-555"><a href="#Analyzer-555"><span class="linenos"> 555</span></a><span class="sd">                                 &quot;h_morning_emissions&quot;, </span>
</span><span id="Analyzer-556"><a href="#Analyzer-556"><span class="linenos"> 556</span></a><span class="sd">                                 &quot;h_evening_duration_in_traffic&quot;, </span>
</span><span id="Analyzer-557"><a href="#Analyzer-557"><span class="linenos"> 557</span></a><span class="sd">                                 &quot;h_evening_emissions&quot;,</span>
</span><span id="Analyzer-558"><a href="#Analyzer-558"><span class="linenos"> 558</span></a><span class="sd">                                 &quot;f_morning_duration_in_traffic&quot;, </span>
</span><span id="Analyzer-559"><a href="#Analyzer-559"><span class="linenos"> 559</span></a><span class="sd">                                 &quot;f_morning_emissions&quot;, </span>
</span><span id="Analyzer-560"><a href="#Analyzer-560"><span class="linenos"> 560</span></a><span class="sd">                                 &quot;f_evening_duration_in_traffic&quot;, </span>
</span><span id="Analyzer-561"><a href="#Analyzer-561"><span class="linenos"> 561</span></a><span class="sd">                                 &quot;f_evening_emissions&quot;]</span>
</span><span id="Analyzer-562"><a href="#Analyzer-562"><span class="linenos"> 562</span></a><span class="sd">        &quot;&quot;&quot;</span>       
</span><span id="Analyzer-563"><a href="#Analyzer-563"><span class="linenos"> 563</span></a>        <span class="c1"># for each office location</span>
</span><span id="Analyzer-564"><a href="#Analyzer-564"><span class="linenos"> 564</span></a>        <span class="n">data_key</span> <span class="o">=</span> <span class="s2">&quot;employee_gps.csv&quot;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">use_gps_fuzzing</span><span class="o">==</span><span class="kc">False</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">use_gps_fuzzing</span><span class="o">==</span><span class="kc">False</span> <span class="k">else</span> <span class="s2">&quot;gps_fuzz.csv&quot;</span>
</span><span id="Analyzer-565"><a href="#Analyzer-565"><span class="linenos"> 565</span></a>        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;office_gps.csv&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
</span><span id="Analyzer-566"><a href="#Analyzer-566"><span class="linenos"> 566</span></a>            <span class="c1"># for each employee+</span>
</span><span id="Analyzer-567"><a href="#Analyzer-567"><span class="linenos"> 567</span></a>            <span class="k">for</span> <span class="n">index2</span><span class="p">,</span> <span class="n">row2</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">data_key</span><span class="p">]</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
</span><span id="Analyzer-568"><a href="#Analyzer-568"><span class="linenos"> 568</span></a>                <span class="n">data_row</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;commute_data.csv&quot;</span><span class="p">])</span>
</span><span id="Analyzer-569"><a href="#Analyzer-569"><span class="linenos"> 569</span></a>                <span class="c1"># create a row in the dataframe for this employee to this office, add initial data, use -1 for all incomplete calculations</span>
</span><span id="Analyzer-570"><a href="#Analyzer-570"><span class="linenos"> 570</span></a>                <span class="n">val</span><span class="o">=</span> <span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;address&quot;</span><span class="p">],</span><span class="n">row2</span><span class="p">[</span><span class="s2">&quot;latitude&quot;</span><span class="p">],</span> <span class="n">row2</span><span class="p">[</span><span class="s2">&quot;longitude&quot;</span><span class="p">],</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;latitude&quot;</span><span class="p">],</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;longitude&quot;</span><span class="p">]]</span> <span class="o">+</span> <span class="p">[</span><span class="o">-</span><span class="mf">1.0</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">24</span><span class="p">)]</span>
</span><span id="Analyzer-571"><a href="#Analyzer-571"><span class="linenos"> 571</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;commute_data.csv&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">data_row</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span>
</span><span id="Analyzer-572"><a href="#Analyzer-572"><span class="linenos"> 572</span></a>                <span class="c1"># calculate the commute time for this employee to this office</span>
</span><span id="Analyzer-573"><a href="#Analyzer-573"><span class="linenos"> 573</span></a>                <span class="k">for</span> <span class="n">day</span> <span class="ow">in</span> <span class="n">days</span><span class="p">:</span>
</span><span id="Analyzer-574"><a href="#Analyzer-574"><span class="linenos"> 574</span></a>                    <span class="k">for</span> <span class="n">time</span> <span class="ow">in</span> <span class="n">times</span><span class="p">:</span>
</span><span id="Analyzer-575"><a href="#Analyzer-575"><span class="linenos"> 575</span></a>                        <span class="c1"># log iff logging</span>
</span><span id="Analyzer-576"><a href="#Analyzer-576"><span class="linenos"> 576</span></a>                        <span class="c1"># create source and destination placeholders</span>
</span><span id="Analyzer-577"><a href="#Analyzer-577"><span class="linenos"> 577</span></a>                        <span class="k">if</span> <span class="s2">&quot;evening&quot;</span> <span class="ow">in</span> <span class="n">time</span><span class="p">:</span>
</span><span id="Analyzer-578"><a href="#Analyzer-578"><span class="linenos"> 578</span></a>                            <span class="n">source</span> <span class="o">=</span> <span class="p">(</span><span class="n">row2</span><span class="p">[</span><span class="s2">&quot;latitude&quot;</span><span class="p">],</span><span class="n">row2</span><span class="p">[</span><span class="s2">&quot;longitude&quot;</span><span class="p">])</span>
</span><span id="Analyzer-579"><a href="#Analyzer-579"><span class="linenos"> 579</span></a>                            <span class="n">destination</span> <span class="o">=</span> <span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;latitude&quot;</span><span class="p">],</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;longitude&quot;</span><span class="p">])</span>
</span><span id="Analyzer-580"><a href="#Analyzer-580"><span class="linenos"> 580</span></a>                        <span class="k">else</span><span class="p">:</span>
</span><span id="Analyzer-581"><a href="#Analyzer-581"><span class="linenos"> 581</span></a>                            <span class="n">source</span> <span class="o">=</span> <span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;latitude&quot;</span><span class="p">],</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;longitude&quot;</span><span class="p">])</span>
</span><span id="Analyzer-582"><a href="#Analyzer-582"><span class="linenos"> 582</span></a>                            <span class="n">destination</span> <span class="o">=</span> <span class="p">(</span><span class="n">row2</span><span class="p">[</span><span class="s2">&quot;latitude&quot;</span><span class="p">],</span><span class="n">row2</span><span class="p">[</span><span class="s2">&quot;longitude&quot;</span><span class="p">])</span>
</span><span id="Analyzer-583"><a href="#Analyzer-583"><span class="linenos"> 583</span></a>                        <span class="k">if</span> <span class="n">log_csv</span><span class="p">:</span> 
</span><span id="Analyzer-584"><a href="#Analyzer-584"><span class="linenos"> 584</span></a>                            <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Calculating commute time for &quot;</span> <span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">source</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">+</span><span class="s2">&quot;,&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">source</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">+</span><span class="s2">&quot; to &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">destination</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">+</span><span class="s2">&quot;,&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">destination</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">+</span><span class="s2">&quot; at &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">commutes</span><span class="p">[</span><span class="n">day</span><span class="o">+</span><span class="s2">&quot;_&quot;</span><span class="o">+</span><span class="n">time</span><span class="p">])</span><span class="o">+</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Analyzer-585"><a href="#Analyzer-585"><span class="linenos"> 585</span></a>                            <span class="n">log</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
</span><span id="Analyzer-586"><a href="#Analyzer-586"><span class="linenos"> 586</span></a>                        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Calculating commute time for &quot;</span> <span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">source</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">+</span><span class="s2">&quot;,&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">source</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">+</span><span class="s2">&quot; to &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">destination</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">+</span><span class="s2">&quot;,&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">destination</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">+</span><span class="s2">&quot; at &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">commutes</span><span class="p">[</span><span class="n">day</span><span class="o">+</span><span class="s2">&quot;_&quot;</span><span class="o">+</span><span class="n">time</span><span class="p">])</span><span class="o">+</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Analyzer-587"><a href="#Analyzer-587"><span class="linenos"> 587</span></a>                        <span class="c1"># sleep if necessary for rate limit</span>
</span><span id="Analyzer-588"><a href="#Analyzer-588"><span class="linenos"> 588</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">sleepif</span><span class="p">()</span>
</span><span id="Analyzer-589"><a href="#Analyzer-589"><span class="linenos"> 589</span></a>                        <span class="k">try</span><span class="p">:</span>
</span><span id="Analyzer-590"><a href="#Analyzer-590"><span class="linenos"> 590</span></a>                            <span class="c1"># get the commute time</span>
</span><span id="Analyzer-591"><a href="#Analyzer-591"><span class="linenos"> 591</span></a>                            <span class="n">commute</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gAPI</span><span class="o">.</span><span class="n">commute</span><span class="p">((</span><span class="n">source</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">source</span><span class="p">[</span><span class="mi">1</span><span class="p">]),(</span><span class="n">destination</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">destination</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span><span class="n">commutes</span><span class="p">[</span><span class="n">day</span><span class="o">+</span><span class="s2">&quot;_&quot;</span><span class="o">+</span><span class="n">time</span><span class="p">])</span>
</span><span id="Analyzer-592"><a href="#Analyzer-592"><span class="linenos"> 592</span></a>                        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="Analyzer-593"><a href="#Analyzer-593"><span class="linenos"> 593</span></a>                            <span class="c1"># if logging, write the exception event to the logfile</span>
</span><span id="Analyzer-594"><a href="#Analyzer-594"><span class="linenos"> 594</span></a>                            <span class="k">if</span> <span class="n">log_csv</span><span class="p">:</span>
</span><span id="Analyzer-595"><a href="#Analyzer-595"><span class="linenos"> 595</span></a>                                <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Exception calling commute function: &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Analyzer-596"><a href="#Analyzer-596"><span class="linenos"> 596</span></a>                                <span class="n">log</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
</span><span id="Analyzer-597"><a href="#Analyzer-597"><span class="linenos"> 597</span></a>                            <span class="bp">self</span><span class="o">.</span><span class="n">log_error</span><span class="p">(</span><span class="s2">&quot;Exception calling commute function: &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Analyzer-598"><a href="#Analyzer-598"><span class="linenos"> 598</span></a>                            <span class="c1"># if the excetion is a recoverable one, retry after a delay, else raise the exception</span>
</span><span id="Analyzer-599"><a href="#Analyzer-599"><span class="linenos"> 599</span></a>                            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">handle_GAPI_exception</span><span class="p">(</span><span class="n">e</span><span class="p">):</span>
</span><span id="Analyzer-600"><a href="#Analyzer-600"><span class="linenos"> 600</span></a>                                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;recoverable exception, waiting to retry once&quot;</span><span class="p">)</span>
</span><span id="Analyzer-601"><a href="#Analyzer-601"><span class="linenos"> 601</span></a>                                <span class="n">sleep</span><span class="p">(</span><span class="mi">10000</span><span class="p">)</span>
</span><span id="Analyzer-602"><a href="#Analyzer-602"><span class="linenos"> 602</span></a>                                <span class="k">try</span><span class="p">:</span>
</span><span id="Analyzer-603"><a href="#Analyzer-603"><span class="linenos"> 603</span></a>                                    <span class="n">commute</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gAPI</span><span class="o">.</span><span class="n">commute</span><span class="p">((</span><span class="n">source</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">source</span><span class="p">[</span><span class="mi">1</span><span class="p">]),(</span><span class="n">destination</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span><span class="n">destination</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span><span class="n">commutes</span><span class="p">[</span><span class="n">day</span><span class="o">+</span><span class="s2">&quot;_&quot;</span><span class="o">+</span><span class="n">time</span><span class="p">])</span>
</span><span id="Analyzer-604"><a href="#Analyzer-604"><span class="linenos"> 604</span></a>                                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="Analyzer-605"><a href="#Analyzer-605"><span class="linenos"> 605</span></a>                                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Recoverable exception, tried twice skipping address, deemed unrecoverable. &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Analyzer-606"><a href="#Analyzer-606"><span class="linenos"> 606</span></a>                                    <span class="c1"># if logging, write the exception event to the logfile</span>
</span><span id="Analyzer-607"><a href="#Analyzer-607"><span class="linenos"> 607</span></a>                                    <span class="bp">self</span><span class="o">.</span><span class="n">log_error</span><span class="p">(</span><span class="s2">&quot;Recoverable error calling commute function, failed twice. Deemed unrecoverable. Exception: &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Analyzer-608"><a href="#Analyzer-608"><span class="linenos"> 608</span></a>                                    <span class="n">e</span><span class="o">.</span><span class="n">add_note</span> <span class="o">=</span> <span class="s2">&quot;Recoverable error calling commute function, failed twice. Deemed unrecoverable&quot;</span>
</span><span id="Analyzer-609"><a href="#Analyzer-609"><span class="linenos"> 609</span></a>                                    <span class="k">raise</span> <span class="n">e</span>
</span><span id="Analyzer-610"><a href="#Analyzer-610"><span class="linenos"> 610</span></a>                            <span class="k">else</span><span class="p">:</span>
</span><span id="Analyzer-611"><a href="#Analyzer-611"><span class="linenos"> 611</span></a>                                <span class="c1"># print the full stack trace and raise e</span>
</span><span id="Analyzer-612"><a href="#Analyzer-612"><span class="linenos"> 612</span></a>                                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Unrecoverable unknown exception, tried once. &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Analyzer-613"><a href="#Analyzer-613"><span class="linenos"> 613</span></a>                                <span class="c1"># if logging, write the exception event to the logfile</span>
</span><span id="Analyzer-614"><a href="#Analyzer-614"><span class="linenos"> 614</span></a>                                <span class="bp">self</span><span class="o">.</span><span class="n">log_error</span><span class="p">(</span><span class="s2">&quot;Unrecoverable error calling commute function, failed once. Exception: &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Analyzer-615"><a href="#Analyzer-615"><span class="linenos"> 615</span></a>                                <span class="n">e</span><span class="o">.</span><span class="n">add_note</span> <span class="o">=</span> <span class="s2">&quot;Unrecoverable error calling commute function, failed once&quot;</span>
</span><span id="Analyzer-616"><a href="#Analyzer-616"><span class="linenos"> 616</span></a>                                <span class="k">raise</span> <span class="n">e</span>
</span><span id="Analyzer-617"><a href="#Analyzer-617"><span class="linenos"> 617</span></a>                        <span class="k">try</span><span class="p">:</span>
</span><span id="Analyzer-618"><a href="#Analyzer-618"><span class="linenos"> 618</span></a>                            <span class="c1"># Update the row in the dataframe with the commute time</span>
</span><span id="Analyzer-619"><a href="#Analyzer-619"><span class="linenos"> 619</span></a>                            <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;commute_data.csv&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">data_row</span><span class="p">,</span><span class="n">day</span><span class="o">+</span><span class="s2">&quot;_&quot;</span><span class="o">+</span><span class="n">time</span><span class="o">+</span><span class="s2">&quot;_duration_in_traffic&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">convert_stringtime_to_minutes</span><span class="p">(</span><span class="n">commute</span><span class="p">[</span><span class="s2">&quot;duration_in_traffic&quot;</span><span class="p">]))</span>
</span><span id="Analyzer-620"><a href="#Analyzer-620"><span class="linenos"> 620</span></a>                            <span class="c1"># if this is the first time through, insert the distance and duration into the dataframe</span>
</span><span id="Analyzer-621"><a href="#Analyzer-621"><span class="linenos"> 621</span></a>                            <span class="k">if</span> <span class="n">day</span> <span class="o">==</span> <span class="s2">&quot;m&quot;</span> <span class="ow">and</span> <span class="n">time</span> <span class="o">==</span> <span class="s2">&quot;morning&quot;</span><span class="p">:</span>
</span><span id="Analyzer-622"><a href="#Analyzer-622"><span class="linenos"> 622</span></a>                                <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;commute_data.csv&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">data_row</span><span class="p">,</span><span class="s2">&quot;miles&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">convert_stringdistance_to_d</span><span class="p">(</span><span class="n">commute</span><span class="p">[</span><span class="s2">&quot;distance&quot;</span><span class="p">]))</span>
</span><span id="Analyzer-623"><a href="#Analyzer-623"><span class="linenos"> 623</span></a>                                <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;commute_data.csv&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">data_row</span><span class="p">,</span><span class="s2">&quot;duration&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">convert_stringtime_to_minutes</span><span class="p">(</span><span class="n">commute</span><span class="p">[</span><span class="s2">&quot;duration&quot;</span><span class="p">]))</span>
</span><span id="Analyzer-624"><a href="#Analyzer-624"><span class="linenos"> 624</span></a>                        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="Analyzer-625"><a href="#Analyzer-625"><span class="linenos"> 625</span></a>                            <span class="c1"># if logging, write the exception event to the logfile</span>
</span><span id="Analyzer-626"><a href="#Analyzer-626"><span class="linenos"> 626</span></a>                            <span class="k">if</span> <span class="n">log_csv</span><span class="p">:</span>
</span><span id="Analyzer-627"><a href="#Analyzer-627"><span class="linenos"> 627</span></a>                                <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Exception updating commute data: &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Analyzer-628"><a href="#Analyzer-628"><span class="linenos"> 628</span></a>                                <span class="n">log</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
</span><span id="Analyzer-629"><a href="#Analyzer-629"><span class="linenos"> 629</span></a>                            <span class="bp">self</span><span class="o">.</span><span class="n">log_error</span><span class="p">(</span><span class="s2">&quot;Exception updating commute data: &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Analyzer-630"><a href="#Analyzer-630"><span class="linenos"> 630</span></a>                            <span class="n">e</span><span class="o">.</span><span class="n">add_note</span> <span class="o">=</span> <span class="s2">&quot;Exception updating commute data after calling commute function.&quot;</span>
</span><span id="Analyzer-631"><a href="#Analyzer-631"><span class="linenos"> 631</span></a>                            <span class="k">raise</span> <span class="n">e</span>
</span><span id="Analyzer-632"><a href="#Analyzer-632"><span class="linenos"> 632</span></a>                        
</span><span id="Analyzer-633"><a href="#Analyzer-633"><span class="linenos"> 633</span></a>        <span class="c1"># save the project data object to the csv file</span>
</span><span id="Analyzer-634"><a href="#Analyzer-634"><span class="linenos"> 634</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">save_data_file</span><span class="p">(</span><span class="s2">&quot;commute_data.csv&quot;</span><span class="p">)</span>
</span><span id="Analyzer-635"><a href="#Analyzer-635"><span class="linenos"> 635</span></a>
</span><span id="Analyzer-636"><a href="#Analyzer-636"><span class="linenos"> 636</span></a>
</span><span id="Analyzer-637"><a href="#Analyzer-637"><span class="linenos"> 637</span></a>    <span class="k">def</span> <span class="nf">convert_stringtime_to_minutes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">time_string</span><span class="p">):</span>
</span><span id="Analyzer-638"><a href="#Analyzer-638"><span class="linenos"> 638</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Analyzer-639"><a href="#Analyzer-639"><span class="linenos"> 639</span></a><span class="sd">        Converts a string representing distance into miles.</span>
</span><span id="Analyzer-640"><a href="#Analyzer-640"><span class="linenos"> 640</span></a>
</span><span id="Analyzer-641"><a href="#Analyzer-641"><span class="linenos"> 641</span></a><span class="sd">        Parses a string for distance measurements expressed in various units (miles, kilometers, meters, etc.) and converts </span>
</span><span id="Analyzer-642"><a href="#Analyzer-642"><span class="linenos"> 642</span></a><span class="sd">        the total distance into miles.</span>
</span><span id="Analyzer-643"><a href="#Analyzer-643"><span class="linenos"> 643</span></a>
</span><span id="Analyzer-644"><a href="#Analyzer-644"><span class="linenos"> 644</span></a><span class="sd">        Args:</span>
</span><span id="Analyzer-645"><a href="#Analyzer-645"><span class="linenos"> 645</span></a><span class="sd">            distance_string (str): The distance string to convert.</span>
</span><span id="Analyzer-646"><a href="#Analyzer-646"><span class="linenos"> 646</span></a>
</span><span id="Analyzer-647"><a href="#Analyzer-647"><span class="linenos"> 647</span></a><span class="sd">        Returns:</span>
</span><span id="Analyzer-648"><a href="#Analyzer-648"><span class="linenos"> 648</span></a><span class="sd">            float: The total distance in miles.</span>
</span><span id="Analyzer-649"><a href="#Analyzer-649"><span class="linenos"> 649</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Analyzer-650"><a href="#Analyzer-650"><span class="linenos"> 650</span></a>
</span><span id="Analyzer-651"><a href="#Analyzer-651"><span class="linenos"> 651</span></a>        <span class="c1"># Regular expression to find all occurrences of numbers followed by time units</span>
</span><span id="Analyzer-652"><a href="#Analyzer-652"><span class="linenos"> 652</span></a>        <span class="n">matches</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;(\d+)\s*(hour|minute|second|min|sec|hrs|hours|minutes|mins|seconds)s?&#39;</span><span class="p">,</span> <span class="n">time_string</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">)</span>
</span><span id="Analyzer-653"><a href="#Analyzer-653"><span class="linenos"> 653</span></a>        
</span><span id="Analyzer-654"><a href="#Analyzer-654"><span class="linenos"> 654</span></a>        <span class="c1"># Initialize a dictionary to hold our time values</span>
</span><span id="Analyzer-655"><a href="#Analyzer-655"><span class="linenos"> 655</span></a>        <span class="n">time_values</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;hours&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;minutes&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;seconds&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>
</span><span id="Analyzer-656"><a href="#Analyzer-656"><span class="linenos"> 656</span></a>        
</span><span id="Analyzer-657"><a href="#Analyzer-657"><span class="linenos"> 657</span></a>        <span class="c1"># Loop through all matches and update the time_values dictionary accordingly</span>
</span><span id="Analyzer-658"><a href="#Analyzer-658"><span class="linenos"> 658</span></a>        <span class="k">for</span> <span class="n">amount</span><span class="p">,</span> <span class="n">unit</span> <span class="ow">in</span> <span class="n">matches</span><span class="p">:</span>
</span><span id="Analyzer-659"><a href="#Analyzer-659"><span class="linenos"> 659</span></a>            <span class="k">if</span> <span class="n">unit</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;hour&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">unit</span> <span class="o">==</span> <span class="s1">&#39;hrs&#39;</span><span class="p">:</span>
</span><span id="Analyzer-660"><a href="#Analyzer-660"><span class="linenos"> 660</span></a>                <span class="n">time_values</span><span class="p">[</span><span class="s1">&#39;hours&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="nb">int</span><span class="p">(</span><span class="n">amount</span><span class="p">)</span>
</span><span id="Analyzer-661"><a href="#Analyzer-661"><span class="linenos"> 661</span></a>            <span class="k">elif</span> <span class="n">unit</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;min&#39;</span><span class="p">):</span>
</span><span id="Analyzer-662"><a href="#Analyzer-662"><span class="linenos"> 662</span></a>                <span class="n">time_values</span><span class="p">[</span><span class="s1">&#39;minutes&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="nb">int</span><span class="p">(</span><span class="n">amount</span><span class="p">)</span>
</span><span id="Analyzer-663"><a href="#Analyzer-663"><span class="linenos"> 663</span></a>            <span class="k">elif</span> <span class="n">unit</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;sec&#39;</span><span class="p">):</span>
</span><span id="Analyzer-664"><a href="#Analyzer-664"><span class="linenos"> 664</span></a>                <span class="n">time_values</span><span class="p">[</span><span class="s1">&#39;seconds&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="nb">int</span><span class="p">(</span><span class="n">amount</span><span class="p">)</span>
</span><span id="Analyzer-665"><a href="#Analyzer-665"><span class="linenos"> 665</span></a>        
</span><span id="Analyzer-666"><a href="#Analyzer-666"><span class="linenos"> 666</span></a>        <span class="c1"># create an integer to hold the total minutes</span>
</span><span id="Analyzer-667"><a href="#Analyzer-667"><span class="linenos"> 667</span></a>        <span class="n">total_minutes</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Analyzer-668"><a href="#Analyzer-668"><span class="linenos"> 668</span></a>        <span class="c1"># sum the hours and minutes into total minutes</span>
</span><span id="Analyzer-669"><a href="#Analyzer-669"><span class="linenos"> 669</span></a>        <span class="n">total_minutes</span> <span class="o">+=</span> <span class="n">time_values</span><span class="p">[</span><span class="s1">&#39;hours&#39;</span><span class="p">]</span><span class="o">*</span><span class="mi">60</span>
</span><span id="Analyzer-670"><a href="#Analyzer-670"><span class="linenos"> 670</span></a>        <span class="n">total_minutes</span> <span class="o">+=</span> <span class="n">time_values</span><span class="p">[</span><span class="s1">&#39;minutes&#39;</span><span class="p">]</span>
</span><span id="Analyzer-671"><a href="#Analyzer-671"><span class="linenos"> 671</span></a>        <span class="k">return</span> <span class="n">total_minutes</span>
</span><span id="Analyzer-672"><a href="#Analyzer-672"><span class="linenos"> 672</span></a>
</span><span id="Analyzer-673"><a href="#Analyzer-673"><span class="linenos"> 673</span></a>
</span><span id="Analyzer-674"><a href="#Analyzer-674"><span class="linenos"> 674</span></a>    <span class="k">def</span> <span class="nf">convert_stringdistance_to_d</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">distance_string</span><span class="p">):</span>
</span><span id="Analyzer-675"><a href="#Analyzer-675"><span class="linenos"> 675</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Analyzer-676"><a href="#Analyzer-676"><span class="linenos"> 676</span></a><span class="sd">        Converts a string representing distance into miles.</span>
</span><span id="Analyzer-677"><a href="#Analyzer-677"><span class="linenos"> 677</span></a>
</span><span id="Analyzer-678"><a href="#Analyzer-678"><span class="linenos"> 678</span></a><span class="sd">        Parses a string for distance measurements expressed in various units (miles, kilometers, meters, etc.) and converts </span>
</span><span id="Analyzer-679"><a href="#Analyzer-679"><span class="linenos"> 679</span></a><span class="sd">        the total distance into miles.</span>
</span><span id="Analyzer-680"><a href="#Analyzer-680"><span class="linenos"> 680</span></a>
</span><span id="Analyzer-681"><a href="#Analyzer-681"><span class="linenos"> 681</span></a><span class="sd">        Args:</span>
</span><span id="Analyzer-682"><a href="#Analyzer-682"><span class="linenos"> 682</span></a><span class="sd">            distance_string (str): The distance string to convert.</span>
</span><span id="Analyzer-683"><a href="#Analyzer-683"><span class="linenos"> 683</span></a>
</span><span id="Analyzer-684"><a href="#Analyzer-684"><span class="linenos"> 684</span></a><span class="sd">        Returns:</span>
</span><span id="Analyzer-685"><a href="#Analyzer-685"><span class="linenos"> 685</span></a><span class="sd">            float: The total distance in miles.</span>
</span><span id="Analyzer-686"><a href="#Analyzer-686"><span class="linenos"> 686</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Analyzer-687"><a href="#Analyzer-687"><span class="linenos"> 687</span></a>
</span><span id="Analyzer-688"><a href="#Analyzer-688"><span class="linenos"> 688</span></a>        <span class="c1"># Regular expression to find all occurrences of numbers followed by distance units</span>
</span><span id="Analyzer-689"><a href="#Analyzer-689"><span class="linenos"> 689</span></a>        <span class="n">matches</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;(\b\d+(?:\.\d+)?)\s*(mile|kilometer|meter|foot|yard|inch|mi|km|m|ft|yd|in)s?&#39;</span><span class="p">,</span> <span class="n">distance_string</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">)</span>
</span><span id="Analyzer-690"><a href="#Analyzer-690"><span class="linenos"> 690</span></a>        
</span><span id="Analyzer-691"><a href="#Analyzer-691"><span class="linenos"> 691</span></a>        <span class="c1"># Initialize a dictionary to hold our distance values</span>
</span><span id="Analyzer-692"><a href="#Analyzer-692"><span class="linenos"> 692</span></a>        <span class="n">distance_values</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;miles&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;kilometers&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;meters&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;feet&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;yards&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;inches&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>
</span><span id="Analyzer-693"><a href="#Analyzer-693"><span class="linenos"> 693</span></a>        <span class="c1"># Loop through all matches and update the distance_values dictionary accordingly</span>
</span><span id="Analyzer-694"><a href="#Analyzer-694"><span class="linenos"> 694</span></a>        <span class="k">for</span> <span class="n">amount</span><span class="p">,</span> <span class="n">unit</span> <span class="ow">in</span> <span class="n">matches</span><span class="p">:</span>
</span><span id="Analyzer-695"><a href="#Analyzer-695"><span class="linenos"> 695</span></a>            <span class="k">if</span> <span class="n">unit</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;mile&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">unit</span> <span class="o">==</span> <span class="s1">&#39;mi&#39;</span><span class="p">:</span>
</span><span id="Analyzer-696"><a href="#Analyzer-696"><span class="linenos"> 696</span></a>                <span class="n">distance_values</span><span class="p">[</span><span class="s1">&#39;miles&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="nb">float</span><span class="p">(</span><span class="n">amount</span><span class="p">)</span>
</span><span id="Analyzer-697"><a href="#Analyzer-697"><span class="linenos"> 697</span></a>            <span class="k">elif</span> <span class="n">unit</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;kilometer&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">unit</span> <span class="o">==</span> <span class="s1">&#39;km&#39;</span><span class="p">:</span>
</span><span id="Analyzer-698"><a href="#Analyzer-698"><span class="linenos"> 698</span></a>                <span class="n">distance_values</span><span class="p">[</span><span class="s1">&#39;kilometers&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="nb">float</span><span class="p">(</span><span class="n">amount</span><span class="p">)</span>
</span><span id="Analyzer-699"><a href="#Analyzer-699"><span class="linenos"> 699</span></a>            <span class="k">elif</span> <span class="n">unit</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;meter&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">unit</span> <span class="o">==</span> <span class="s1">&#39;m&#39;</span><span class="p">:</span>
</span><span id="Analyzer-700"><a href="#Analyzer-700"><span class="linenos"> 700</span></a>                <span class="n">distance_values</span><span class="p">[</span><span class="s1">&#39;meters&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="nb">float</span><span class="p">(</span><span class="n">amount</span><span class="p">)</span>
</span><span id="Analyzer-701"><a href="#Analyzer-701"><span class="linenos"> 701</span></a>            <span class="k">elif</span> <span class="n">unit</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;foot&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">unit</span> <span class="o">==</span> <span class="s1">&#39;ft&#39;</span><span class="p">:</span>
</span><span id="Analyzer-702"><a href="#Analyzer-702"><span class="linenos"> 702</span></a>                <span class="n">distance_values</span><span class="p">[</span><span class="s1">&#39;feet&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="nb">float</span><span class="p">(</span><span class="n">amount</span><span class="p">)</span>
</span><span id="Analyzer-703"><a href="#Analyzer-703"><span class="linenos"> 703</span></a>            <span class="k">elif</span> <span class="n">unit</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;yard&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">unit</span> <span class="o">==</span> <span class="s1">&#39;yd&#39;</span><span class="p">:</span>
</span><span id="Analyzer-704"><a href="#Analyzer-704"><span class="linenos"> 704</span></a>                <span class="n">distance_values</span><span class="p">[</span><span class="s1">&#39;yards&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="nb">float</span><span class="p">(</span><span class="n">amount</span><span class="p">)</span>
</span><span id="Analyzer-705"><a href="#Analyzer-705"><span class="linenos"> 705</span></a>            <span class="k">elif</span> <span class="n">unit</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;inch&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">unit</span> <span class="o">==</span> <span class="s1">&#39;in&#39;</span><span class="p">:</span>
</span><span id="Analyzer-706"><a href="#Analyzer-706"><span class="linenos"> 706</span></a>                <span class="n">distance_values</span><span class="p">[</span><span class="s1">&#39;inches&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="nb">float</span><span class="p">(</span><span class="n">amount</span><span class="p">)</span>
</span><span id="Analyzer-707"><a href="#Analyzer-707"><span class="linenos"> 707</span></a>        
</span><span id="Analyzer-708"><a href="#Analyzer-708"><span class="linenos"> 708</span></a>        <span class="c1"># create an integer to hold the total miles</span>
</span><span id="Analyzer-709"><a href="#Analyzer-709"><span class="linenos"> 709</span></a>        <span class="n">total_miles</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Analyzer-710"><a href="#Analyzer-710"><span class="linenos"> 710</span></a>        <span class="c1"># sum the miles into total miles</span>
</span><span id="Analyzer-711"><a href="#Analyzer-711"><span class="linenos"> 711</span></a>        <span class="n">total_miles</span> <span class="o">+=</span> <span class="n">distance_values</span><span class="p">[</span><span class="s1">&#39;miles&#39;</span><span class="p">]</span>
</span><span id="Analyzer-712"><a href="#Analyzer-712"><span class="linenos"> 712</span></a>        <span class="k">return</span> <span class="n">total_miles</span>
</span><span id="Analyzer-713"><a href="#Analyzer-713"><span class="linenos"> 713</span></a>    
</span><span id="Analyzer-714"><a href="#Analyzer-714"><span class="linenos"> 714</span></a>    <span class="k">def</span> <span class="nf">get_commute_cost</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="Analyzer-715"><a href="#Analyzer-715"><span class="linenos"> 715</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Analyzer-716"><a href="#Analyzer-716"><span class="linenos"> 716</span></a><span class="sd">        Updates the commute data with calculated commute costs based on distances.</span>
</span><span id="Analyzer-717"><a href="#Analyzer-717"><span class="linenos"> 717</span></a>
</span><span id="Analyzer-718"><a href="#Analyzer-718"><span class="linenos"> 718</span></a><span class="sd">        Commute costs are calculated using the project&#39;s specified mileage rate applied to the commute distances for each employee.</span>
</span><span id="Analyzer-719"><a href="#Analyzer-719"><span class="linenos"> 719</span></a>
</span><span id="Analyzer-720"><a href="#Analyzer-720"><span class="linenos"> 720</span></a><span class="sd">        Args:</span>
</span><span id="Analyzer-721"><a href="#Analyzer-721"><span class="linenos"> 721</span></a><span class="sd">            force (bool, optional): If True, forces recalculation of commute costs even if they are already calculated. Defaults to False.</span>
</span><span id="Analyzer-722"><a href="#Analyzer-722"><span class="linenos"> 722</span></a>
</span><span id="Analyzer-723"><a href="#Analyzer-723"><span class="linenos"> 723</span></a><span class="sd">        Returns:</span>
</span><span id="Analyzer-724"><a href="#Analyzer-724"><span class="linenos"> 724</span></a><span class="sd">            bool: True if commute costs are successfully calculated; False otherwise.</span>
</span><span id="Analyzer-725"><a href="#Analyzer-725"><span class="linenos"> 725</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Analyzer-726"><a href="#Analyzer-726"><span class="linenos"> 726</span></a>        <span class="c1"># update the commute data to calculate the commute cost</span>
</span><span id="Analyzer-727"><a href="#Analyzer-727"><span class="linenos"> 727</span></a>        <span class="k">if</span> <span class="s2">&quot;commute_data.csv&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">list_data_files</span><span class="p">():</span>
</span><span id="Analyzer-728"><a href="#Analyzer-728"><span class="linenos"> 728</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;commute_data.csv&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">force</span><span class="p">:</span>
</span><span id="Analyzer-729"><a href="#Analyzer-729"><span class="linenos"> 729</span></a>                <span class="c1"># attempt to load the commute data</span>
</span><span id="Analyzer-730"><a href="#Analyzer-730"><span class="linenos"> 730</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">load_data_file</span><span class="p">(</span><span class="s2">&quot;commute_data.csv&quot;</span><span class="p">):</span>
</span><span id="Analyzer-731"><a href="#Analyzer-731"><span class="linenos"> 731</span></a>                    <span class="k">pass</span>
</span><span id="Analyzer-732"><a href="#Analyzer-732"><span class="linenos"> 732</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="Analyzer-733"><a href="#Analyzer-733"><span class="linenos"> 733</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Errors loading commute data from project.&quot;</span><span class="p">)</span>
</span><span id="Analyzer-734"><a href="#Analyzer-734"><span class="linenos"> 734</span></a>                    <span class="k">return</span> <span class="kc">False</span>
</span><span id="Analyzer-735"><a href="#Analyzer-735"><span class="linenos"> 735</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Analyzer-736"><a href="#Analyzer-736"><span class="linenos"> 736</span></a>                <span class="k">pass</span>
</span><span id="Analyzer-737"><a href="#Analyzer-737"><span class="linenos"> 737</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Analyzer-738"><a href="#Analyzer-738"><span class="linenos"> 738</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Commute data missing from project.&quot;</span><span class="p">)</span>
</span><span id="Analyzer-739"><a href="#Analyzer-739"><span class="linenos"> 739</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="Analyzer-740"><a href="#Analyzer-740"><span class="linenos"> 740</span></a>        <span class="c1"># calculate the commute cost for each employee</span>
</span><span id="Analyzer-741"><a href="#Analyzer-741"><span class="linenos"> 741</span></a>        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;commute_data.csv&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
</span><span id="Analyzer-742"><a href="#Analyzer-742"><span class="linenos"> 742</span></a>            <span class="c1"># calculate the commute cost</span>
</span><span id="Analyzer-743"><a href="#Analyzer-743"><span class="linenos"> 743</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;commute_data.csv&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">index</span><span class="p">,</span><span class="s2">&quot;commute_cost&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;miles&quot;</span><span class="p">])</span> <span class="o">*</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">mileage_rate</span><span class="p">)</span>
</span><span id="Analyzer-744"><a href="#Analyzer-744"><span class="linenos"> 744</span></a>        <span class="c1"># save the project data object to the csv file</span>
</span><span id="Analyzer-745"><a href="#Analyzer-745"><span class="linenos"> 745</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">save_data_file</span><span class="p">(</span><span class="s2">&quot;commute_data.csv&quot;</span><span class="p">)</span>
</span><span id="Analyzer-746"><a href="#Analyzer-746"><span class="linenos"> 746</span></a>    
</span><span id="Analyzer-747"><a href="#Analyzer-747"><span class="linenos"> 747</span></a>    <span class="k">def</span> <span class="nf">get_commute_emissions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="Analyzer-748"><a href="#Analyzer-748"><span class="linenos"> 748</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Analyzer-749"><a href="#Analyzer-749"><span class="linenos"> 749</span></a><span class="sd">        Calculates and updates commute data with emissions estimates based on commute distances.</span>
</span><span id="Analyzer-750"><a href="#Analyzer-750"><span class="linenos"> 750</span></a>
</span><span id="Analyzer-751"><a href="#Analyzer-751"><span class="linenos"> 751</span></a><span class="sd">        Commute emissions are calculated using the project&#39;s specified CO2 emissions per mile, applied to the commute distances </span>
</span><span id="Analyzer-752"><a href="#Analyzer-752"><span class="linenos"> 752</span></a><span class="sd">        for each employee. Optionally adjusts emissions based on traffic conditions.</span>
</span><span id="Analyzer-753"><a href="#Analyzer-753"><span class="linenos"> 753</span></a>
</span><span id="Analyzer-754"><a href="#Analyzer-754"><span class="linenos"> 754</span></a><span class="sd">        Args:</span>
</span><span id="Analyzer-755"><a href="#Analyzer-755"><span class="linenos"> 755</span></a><span class="sd">            force (bool, optional): If True, forces recalculation of commute emissions even if they are already calculated. Defaults to False.</span>
</span><span id="Analyzer-756"><a href="#Analyzer-756"><span class="linenos"> 756</span></a>
</span><span id="Analyzer-757"><a href="#Analyzer-757"><span class="linenos"> 757</span></a><span class="sd">        Returns:</span>
</span><span id="Analyzer-758"><a href="#Analyzer-758"><span class="linenos"> 758</span></a><span class="sd">            bool: True if commute emissions are successfully calculated; False otherwise.</span>
</span><span id="Analyzer-759"><a href="#Analyzer-759"><span class="linenos"> 759</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Analyzer-760"><a href="#Analyzer-760"><span class="linenos"> 760</span></a>
</span><span id="Analyzer-761"><a href="#Analyzer-761"><span class="linenos"> 761</span></a>        <span class="c1"># update the commute data to calculate the commute emissions</span>
</span><span id="Analyzer-762"><a href="#Analyzer-762"><span class="linenos"> 762</span></a>        <span class="k">if</span> <span class="s2">&quot;commute_data.csv&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">list_data_files</span><span class="p">():</span>
</span><span id="Analyzer-763"><a href="#Analyzer-763"><span class="linenos"> 763</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;commute_data.csv&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">force</span><span class="p">:</span>
</span><span id="Analyzer-764"><a href="#Analyzer-764"><span class="linenos"> 764</span></a>                <span class="c1"># attempt to load the commute data</span>
</span><span id="Analyzer-765"><a href="#Analyzer-765"><span class="linenos"> 765</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">load_data_file</span><span class="p">(</span><span class="s2">&quot;commute_data.csv&quot;</span><span class="p">):</span>
</span><span id="Analyzer-766"><a href="#Analyzer-766"><span class="linenos"> 766</span></a>                    <span class="k">pass</span>
</span><span id="Analyzer-767"><a href="#Analyzer-767"><span class="linenos"> 767</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="Analyzer-768"><a href="#Analyzer-768"><span class="linenos"> 768</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Errors loading commute data from project.&quot;</span><span class="p">)</span>
</span><span id="Analyzer-769"><a href="#Analyzer-769"><span class="linenos"> 769</span></a>                    <span class="k">return</span> <span class="kc">False</span>
</span><span id="Analyzer-770"><a href="#Analyzer-770"><span class="linenos"> 770</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Analyzer-771"><a href="#Analyzer-771"><span class="linenos"> 771</span></a>                <span class="k">pass</span>
</span><span id="Analyzer-772"><a href="#Analyzer-772"><span class="linenos"> 772</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Analyzer-773"><a href="#Analyzer-773"><span class="linenos"> 773</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Commute data missing from project.&quot;</span><span class="p">)</span>
</span><span id="Analyzer-774"><a href="#Analyzer-774"><span class="linenos"> 774</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="Analyzer-775"><a href="#Analyzer-775"><span class="linenos"> 775</span></a>        <span class="c1"># calculate the commute emissions for each row in the commute data</span>
</span><span id="Analyzer-776"><a href="#Analyzer-776"><span class="linenos"> 776</span></a>        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;commute_data.csv&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
</span><span id="Analyzer-777"><a href="#Analyzer-777"><span class="linenos"> 777</span></a>            <span class="c1"># calculate the commute emissions</span>
</span><span id="Analyzer-778"><a href="#Analyzer-778"><span class="linenos"> 778</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;commute_data.csv&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">index</span><span class="p">,</span><span class="s2">&quot;emissions&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;miles&quot;</span><span class="p">])</span> <span class="o">*</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">CO2_per_mile</span><span class="p">)</span>
</span><span id="Analyzer-779"><a href="#Analyzer-779"><span class="linenos"> 779</span></a>            <span class="c1"># calcualte the emissions for each day and time</span>
</span><span id="Analyzer-780"><a href="#Analyzer-780"><span class="linenos"> 780</span></a>            <span class="k">for</span> <span class="n">day</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;m&quot;</span><span class="p">,</span><span class="s2">&quot;t&quot;</span><span class="p">,</span><span class="s2">&quot;w&quot;</span><span class="p">,</span><span class="s2">&quot;h&quot;</span><span class="p">,</span><span class="s2">&quot;f&quot;</span><span class="p">]:</span>
</span><span id="Analyzer-781"><a href="#Analyzer-781"><span class="linenos"> 781</span></a>                <span class="k">for</span> <span class="n">time</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;morning&quot;</span><span class="p">,</span><span class="s2">&quot;evening&quot;</span><span class="p">]:</span>
</span><span id="Analyzer-782"><a href="#Analyzer-782"><span class="linenos"> 782</span></a>                    <span class="c1"># get the traffic regime for this commute</span>
</span><span id="Analyzer-783"><a href="#Analyzer-783"><span class="linenos"> 783</span></a>                    <span class="n">emissions_factor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_traffic_emissions_factor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_traffic_regime</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;miles&quot;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="n">day</span><span class="o">+</span><span class="s2">&quot;_&quot;</span><span class="o">+</span><span class="n">time</span><span class="o">+</span><span class="s2">&quot;_duration_in_traffic&quot;</span><span class="p">]))</span>
</span><span id="Analyzer-784"><a href="#Analyzer-784"><span class="linenos"> 784</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;commute_data.csv&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">index</span><span class="p">,</span><span class="n">day</span><span class="o">+</span><span class="s2">&quot;_&quot;</span><span class="o">+</span><span class="n">time</span><span class="o">+</span><span class="s2">&quot;_emissions&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;miles&quot;</span><span class="p">])</span> <span class="o">*</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">CO2_per_mile</span><span class="p">)</span> <span class="o">*</span> <span class="n">emissions_factor</span>
</span><span id="Analyzer-785"><a href="#Analyzer-785"><span class="linenos"> 785</span></a>                    
</span><span id="Analyzer-786"><a href="#Analyzer-786"><span class="linenos"> 786</span></a>        <span class="c1"># save the project data object to the csv file</span>
</span><span id="Analyzer-787"><a href="#Analyzer-787"><span class="linenos"> 787</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">save_data_file</span><span class="p">(</span><span class="s2">&quot;commute_data.csv&quot;</span><span class="p">)</span>
</span><span id="Analyzer-788"><a href="#Analyzer-788"><span class="linenos"> 788</span></a>
</span><span id="Analyzer-789"><a href="#Analyzer-789"><span class="linenos"> 789</span></a>
</span><span id="Analyzer-790"><a href="#Analyzer-790"><span class="linenos"> 790</span></a>    <span class="k">def</span> <span class="nf">get_traffic_regime</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">distance</span><span class="p">,</span> <span class="n">duration_in_traffic</span><span class="p">):</span>
</span><span id="Analyzer-791"><a href="#Analyzer-791"><span class="linenos"> 791</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Analyzer-792"><a href="#Analyzer-792"><span class="linenos"> 792</span></a><span class="sd">        Determines the traffic regime based on the commute distance and duration in traffic.</span>
</span><span id="Analyzer-793"><a href="#Analyzer-793"><span class="linenos"> 793</span></a>
</span><span id="Analyzer-794"><a href="#Analyzer-794"><span class="linenos"> 794</span></a><span class="sd">        The traffic regime is an estimation of traffic conditions affecting the commute, categorized into levels based on the </span>
</span><span id="Analyzer-795"><a href="#Analyzer-795"><span class="linenos"> 795</span></a><span class="sd">        relationship between the expected duration and the actual duration in traffic.</span>
</span><span id="Analyzer-796"><a href="#Analyzer-796"><span class="linenos"> 796</span></a>
</span><span id="Analyzer-797"><a href="#Analyzer-797"><span class="linenos"> 797</span></a><span class="sd">        Args:</span>
</span><span id="Analyzer-798"><a href="#Analyzer-798"><span class="linenos"> 798</span></a><span class="sd">            distance (float): The distance of the commute.</span>
</span><span id="Analyzer-799"><a href="#Analyzer-799"><span class="linenos"> 799</span></a><span class="sd">            duration_in_traffic (int): The duration of the commute in traffic in minutes.</span>
</span><span id="Analyzer-800"><a href="#Analyzer-800"><span class="linenos"> 800</span></a>
</span><span id="Analyzer-801"><a href="#Analyzer-801"><span class="linenos"> 801</span></a><span class="sd">        Returns:</span>
</span><span id="Analyzer-802"><a href="#Analyzer-802"><span class="linenos"> 802</span></a><span class="sd">            int: The traffic regime level, indicating the severity of traffic conditions.</span>
</span><span id="Analyzer-803"><a href="#Analyzer-803"><span class="linenos"> 803</span></a><span class="sd">    </span>
</span><span id="Analyzer-804"><a href="#Analyzer-804"><span class="linenos"> 804</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Analyzer-805"><a href="#Analyzer-805"><span class="linenos"> 805</span></a>        <span class="c1"># get the average speed</span>
</span><span id="Analyzer-806"><a href="#Analyzer-806"><span class="linenos"> 806</span></a>        <span class="n">average_speed</span> <span class="o">=</span> <span class="n">distance</span> <span class="o">/</span> <span class="p">(</span><span class="n">duration_in_traffic</span><span class="o">/</span><span class="mi">60</span><span class="p">)</span>
</span><span id="Analyzer-807"><a href="#Analyzer-807"><span class="linenos"> 807</span></a>        <span class="c1"># if the average speed is less than the lower bound of regime 2, return regime 1</span>
</span><span id="Analyzer-808"><a href="#Analyzer-808"><span class="linenos"> 808</span></a>        <span class="k">if</span> <span class="n">average_speed</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">traffic_regime_2</span><span class="p">:</span>
</span><span id="Analyzer-809"><a href="#Analyzer-809"><span class="linenos"> 809</span></a>            <span class="k">return</span> <span class="mi">1</span>
</span><span id="Analyzer-810"><a href="#Analyzer-810"><span class="linenos"> 810</span></a>        <span class="c1"># if the average speed is less than the lower bound of regime 3, return regime 2</span>
</span><span id="Analyzer-811"><a href="#Analyzer-811"><span class="linenos"> 811</span></a>        <span class="k">if</span> <span class="n">average_speed</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">traffic_regime_3</span><span class="p">:</span>
</span><span id="Analyzer-812"><a href="#Analyzer-812"><span class="linenos"> 812</span></a>            <span class="k">return</span> <span class="mi">2</span>
</span><span id="Analyzer-813"><a href="#Analyzer-813"><span class="linenos"> 813</span></a>        <span class="c1"># if the average speed is greater than or equal to the lower bound of regime 3, return regime 3</span>
</span><span id="Analyzer-814"><a href="#Analyzer-814"><span class="linenos"> 814</span></a>        <span class="k">return</span> <span class="mi">3</span>
</span><span id="Analyzer-815"><a href="#Analyzer-815"><span class="linenos"> 815</span></a>        
</span><span id="Analyzer-816"><a href="#Analyzer-816"><span class="linenos"> 816</span></a>    <span class="k">def</span> <span class="nf">get_traffic_emissions_factor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">regime</span><span class="p">):</span>
</span><span id="Analyzer-817"><a href="#Analyzer-817"><span class="linenos"> 817</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Analyzer-818"><a href="#Analyzer-818"><span class="linenos"> 818</span></a><span class="sd">        Retrieves the emissions factor associated with a given traffic regime.</span>
</span><span id="Analyzer-819"><a href="#Analyzer-819"><span class="linenos"> 819</span></a>
</span><span id="Analyzer-820"><a href="#Analyzer-820"><span class="linenos"> 820</span></a><span class="sd">        This method returns a multiplier that adjusts the calculated emissions based on the traffic regime, </span>
</span><span id="Analyzer-821"><a href="#Analyzer-821"><span class="linenos"> 821</span></a><span class="sd">        with different factors indicating varying levels of traffic congestion.</span>
</span><span id="Analyzer-822"><a href="#Analyzer-822"><span class="linenos"> 822</span></a>
</span><span id="Analyzer-823"><a href="#Analyzer-823"><span class="linenos"> 823</span></a><span class="sd">        Args:</span>
</span><span id="Analyzer-824"><a href="#Analyzer-824"><span class="linenos"> 824</span></a><span class="sd">            regime (int): The traffic regime level as determined by get_traffic_regime method.</span>
</span><span id="Analyzer-825"><a href="#Analyzer-825"><span class="linenos"> 825</span></a>
</span><span id="Analyzer-826"><a href="#Analyzer-826"><span class="linenos"> 826</span></a><span class="sd">        Returns:</span>
</span><span id="Analyzer-827"><a href="#Analyzer-827"><span class="linenos"> 827</span></a><span class="sd">            float: The emissions factor corresponding to the specified traffic regime.</span>
</span><span id="Analyzer-828"><a href="#Analyzer-828"><span class="linenos"> 828</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Analyzer-829"><a href="#Analyzer-829"><span class="linenos"> 829</span></a>
</span><span id="Analyzer-830"><a href="#Analyzer-830"><span class="linenos"> 830</span></a>        <span class="c1"># return the emissions factor for the traffic regime</span>
</span><span id="Analyzer-831"><a href="#Analyzer-831"><span class="linenos"> 831</span></a>        <span class="k">if</span> <span class="n">regime</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="Analyzer-832"><a href="#Analyzer-832"><span class="linenos"> 832</span></a>            <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">traffic_regime_1_coeff</span><span class="p">)</span>
</span><span id="Analyzer-833"><a href="#Analyzer-833"><span class="linenos"> 833</span></a>        <span class="k">if</span> <span class="n">regime</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
</span><span id="Analyzer-834"><a href="#Analyzer-834"><span class="linenos"> 834</span></a>            <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">traffic_regime_2_coeff</span><span class="p">)</span>
</span><span id="Analyzer-835"><a href="#Analyzer-835"><span class="linenos"> 835</span></a>        <span class="k">if</span> <span class="n">regime</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
</span><span id="Analyzer-836"><a href="#Analyzer-836"><span class="linenos"> 836</span></a>            <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">traffic_regime_3_coeff</span><span class="p">)</span>
</span><span id="Analyzer-837"><a href="#Analyzer-837"><span class="linenos"> 837</span></a>        <span class="k">return</span> <span class="mf">1.0</span>
</span><span id="Analyzer-838"><a href="#Analyzer-838"><span class="linenos"> 838</span></a>
</span><span id="Analyzer-839"><a href="#Analyzer-839"><span class="linenos"> 839</span></a>    <span class="k">def</span> <span class="nf">handle_GAPI_exception</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exception</span><span class="p">):</span>
</span><span id="Analyzer-840"><a href="#Analyzer-840"><span class="linenos"> 840</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Analyzer-841"><a href="#Analyzer-841"><span class="linenos"> 841</span></a><span class="sd">        Determines the course of action for a given Google API exception.</span>
</span><span id="Analyzer-842"><a href="#Analyzer-842"><span class="linenos"> 842</span></a>
</span><span id="Analyzer-843"><a href="#Analyzer-843"><span class="linenos"> 843</span></a><span class="sd">        Based on the type of exception encountered during API calls, this method decides whether the exception is recoverable </span>
</span><span id="Analyzer-844"><a href="#Analyzer-844"><span class="linenos"> 844</span></a><span class="sd">        (suggesting a retry might succeed) or if it&#39;s unrecoverable, necessitating alternate handling.</span>
</span><span id="Analyzer-845"><a href="#Analyzer-845"><span class="linenos"> 845</span></a>
</span><span id="Analyzer-846"><a href="#Analyzer-846"><span class="linenos"> 846</span></a><span class="sd">        Args:</span>
</span><span id="Analyzer-847"><a href="#Analyzer-847"><span class="linenos"> 847</span></a><span class="sd">            exception (Exception): The exception encountered during a Google API call.</span>
</span><span id="Analyzer-848"><a href="#Analyzer-848"><span class="linenos"> 848</span></a>
</span><span id="Analyzer-849"><a href="#Analyzer-849"><span class="linenos"> 849</span></a><span class="sd">        Returns:</span>
</span><span id="Analyzer-850"><a href="#Analyzer-850"><span class="linenos"> 850</span></a><span class="sd">            bool: True if the exception is considered recoverable, False otherwise.</span>
</span><span id="Analyzer-851"><a href="#Analyzer-851"><span class="linenos"> 851</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Analyzer-852"><a href="#Analyzer-852"><span class="linenos"> 852</span></a>
</span><span id="Analyzer-853"><a href="#Analyzer-853"><span class="linenos"> 853</span></a>        <span class="c1"># Extract the type of the exception as a string</span>
</span><span id="Analyzer-854"><a href="#Analyzer-854"><span class="linenos"> 854</span></a>        <span class="n">exception_type</span> <span class="o">=</span> <span class="n">exception</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span>
</span><span id="Analyzer-855"><a href="#Analyzer-855"><span class="linenos"> 855</span></a>        
</span><span id="Analyzer-856"><a href="#Analyzer-856"><span class="linenos"> 856</span></a>        <span class="c1"># Check if the exception type is in our predefined dictionary</span>
</span><span id="Analyzer-857"><a href="#Analyzer-857"><span class="linenos"> 857</span></a>        <span class="k">if</span> <span class="n">exception_type</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">gAPI</span><span class="o">.</span><span class="n">google_api_exceptions</span><span class="p">:</span>
</span><span id="Analyzer-858"><a href="#Analyzer-858"><span class="linenos"> 858</span></a>            <span class="n">action</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gAPI</span><span class="o">.</span><span class="n">google_api_exceptions</span><span class="p">[</span><span class="n">exception_type</span><span class="p">]</span>
</span><span id="Analyzer-859"><a href="#Analyzer-859"><span class="linenos"> 859</span></a>            <span class="k">if</span> <span class="n">action</span> <span class="o">==</span> <span class="s1">&#39;recoverable&#39;</span><span class="p">:</span>
</span><span id="Analyzer-860"><a href="#Analyzer-860"><span class="linenos"> 860</span></a>                <span class="k">return</span> <span class="kc">True</span>
</span><span id="Analyzer-861"><a href="#Analyzer-861"><span class="linenos"> 861</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Analyzer-862"><a href="#Analyzer-862"><span class="linenos"> 862</span></a>                <span class="k">return</span> <span class="kc">False</span>
</span><span id="Analyzer-863"><a href="#Analyzer-863"><span class="linenos"> 863</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Analyzer-864"><a href="#Analyzer-864"><span class="linenos"> 864</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Encountered an undefined exception type (&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">exception</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;). Raising the exception...&quot;</span><span class="p">)</span>
</span><span id="Analyzer-865"><a href="#Analyzer-865"><span class="linenos"> 865</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="Analyzer-866"><a href="#Analyzer-866"><span class="linenos"> 866</span></a>
</span><span id="Analyzer-867"><a href="#Analyzer-867"><span class="linenos"> 867</span></a>    <span class="k">def</span> <span class="nf">generate_graphs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">graph</span><span class="o">=</span><span class="s2">&quot;_all&quot;</span><span class="p">):</span>
</span><span id="Analyzer-868"><a href="#Analyzer-868"><span class="linenos"> 868</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Analyzer-869"><a href="#Analyzer-869"><span class="linenos"> 869</span></a><span class="sd">        Generates and saves graphical representations of analyzed commute data.</span>
</span><span id="Analyzer-870"><a href="#Analyzer-870"><span class="linenos"> 870</span></a>
</span><span id="Analyzer-871"><a href="#Analyzer-871"><span class="linenos"> 871</span></a><span class="sd">        Based on the available commute data, this method generates graphs such as the geographical distribution </span>
</span><span id="Analyzer-872"><a href="#Analyzer-872"><span class="linenos"> 872</span></a><span class="sd">        of analyzed locations and the local analysis of commute geography. It supports generating all graphs or </span>
</span><span id="Analyzer-873"><a href="#Analyzer-873"><span class="linenos"> 873</span></a><span class="sd">        a specific one based on the `graph` parameter.</span>
</span><span id="Analyzer-874"><a href="#Analyzer-874"><span class="linenos"> 874</span></a>
</span><span id="Analyzer-875"><a href="#Analyzer-875"><span class="linenos"> 875</span></a><span class="sd">        Args:</span>
</span><span id="Analyzer-876"><a href="#Analyzer-876"><span class="linenos"> 876</span></a><span class="sd">            graph (str, optional): Specifies which graph to generate. Use &quot;_all&quot; to generate all graphs, or specify a </span>
</span><span id="Analyzer-877"><a href="#Analyzer-877"><span class="linenos"> 877</span></a><span class="sd">            particular graph&#39;s key. Defaults to &quot;_all&quot;.</span>
</span><span id="Analyzer-878"><a href="#Analyzer-878"><span class="linenos"> 878</span></a>
</span><span id="Analyzer-879"><a href="#Analyzer-879"><span class="linenos"> 879</span></a><span class="sd">        Returns:</span>
</span><span id="Analyzer-880"><a href="#Analyzer-880"><span class="linenos"> 880</span></a><span class="sd">            list: A list of dictionaries, each containing details about the generated graphs, including file paths and titles.</span>
</span><span id="Analyzer-881"><a href="#Analyzer-881"><span class="linenos"> 881</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Analyzer-882"><a href="#Analyzer-882"><span class="linenos"> 882</span></a>
</span><span id="Analyzer-883"><a href="#Analyzer-883"><span class="linenos"> 883</span></a>        <span class="c1"># define a color palette supporting up to 10 unique colors</span>
</span><span id="Analyzer-884"><a href="#Analyzer-884"><span class="linenos"> 884</span></a>        <span class="n">color_palette</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;#6e7c8a&#39;</span><span class="p">,</span> <span class="s1">&#39;#90a08f&#39;</span><span class="p">,</span> <span class="s1">&#39;#c3a3a9&#39;</span><span class="p">,</span> <span class="s1">&#39;#b1c5c3&#39;</span><span class="p">,</span> <span class="s1">&#39;#e1c08b&#39;</span><span class="p">,</span> <span class="s1">&#39;#a592ba&#39;</span><span class="p">,</span> <span class="s1">&#39;#a8b1d5&#39;</span><span class="p">,</span> <span class="s1">&#39;#d4abad&#39;</span><span class="p">,</span> <span class="s1">&#39;#c4c38a&#39;</span><span class="p">,</span> <span class="s1">&#39;#ceb2ab&#39;</span><span class="p">]</span>
</span><span id="Analyzer-885"><a href="#Analyzer-885"><span class="linenos"> 885</span></a>                        <span class="c1"># lighter pastel [&#39;#7D8A97&#39;, &#39;#A3B0A2&#39;, &#39;#D3BCC0&#39;, &#39;#C9D7D6&#39;, &#39;#EAD2AC&#39;, &#39;#B8A9C9&#39;, &#39;#C5CBE3&#39;, &#39;#E3C8C9&#39;, &#39;#D1D0A3&#39;, &#39;#DECBC6&#39;]</span>
</span><span id="Analyzer-886"><a href="#Analyzer-886"><span class="linenos"> 886</span></a>
</span><span id="Analyzer-887"><a href="#Analyzer-887"><span class="linenos"> 887</span></a>        <span class="c1"># Create a new list of colors &quot;i&quot; long, recycling colors as needed</span>
</span><span id="Analyzer-888"><a href="#Analyzer-888"><span class="linenos"> 888</span></a>        <span class="k">def</span> <span class="nf">colors</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
</span><span id="Analyzer-889"><a href="#Analyzer-889"><span class="linenos"> 889</span></a>            <span class="k">return</span> <span class="n">color_palette</span><span class="p">[</span><span class="n">i</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">color_palette</span><span class="p">)]</span>
</span><span id="Analyzer-890"><a href="#Analyzer-890"><span class="linenos"> 890</span></a>
</span><span id="Analyzer-891"><a href="#Analyzer-891"><span class="linenos"> 891</span></a>        <span class="c1"># generate the graphs for the project</span>
</span><span id="Analyzer-892"><a href="#Analyzer-892"><span class="linenos"> 892</span></a>        <span class="c1"># if the commute data isn&#39;t already in the project, load it</span>
</span><span id="Analyzer-893"><a href="#Analyzer-893"><span class="linenos"> 893</span></a>        <span class="k">if</span> <span class="s2">&quot;commute_data.csv&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">list_data_files</span><span class="p">():</span>
</span><span id="Analyzer-894"><a href="#Analyzer-894"><span class="linenos"> 894</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;commute_data.csv&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Analyzer-895"><a href="#Analyzer-895"><span class="linenos"> 895</span></a>                <span class="c1"># attempt to load the commute data</span>
</span><span id="Analyzer-896"><a href="#Analyzer-896"><span class="linenos"> 896</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">load_data_file</span><span class="p">(</span><span class="s2">&quot;commute_data.csv&quot;</span><span class="p">):</span>
</span><span id="Analyzer-897"><a href="#Analyzer-897"><span class="linenos"> 897</span></a>                    <span class="k">pass</span>
</span><span id="Analyzer-898"><a href="#Analyzer-898"><span class="linenos"> 898</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="Analyzer-899"><a href="#Analyzer-899"><span class="linenos"> 899</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Errors loading commute data from project.&quot;</span><span class="p">)</span>
</span><span id="Analyzer-900"><a href="#Analyzer-900"><span class="linenos"> 900</span></a>                    <span class="k">return</span> <span class="kc">False</span>
</span><span id="Analyzer-901"><a href="#Analyzer-901"><span class="linenos"> 901</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Analyzer-902"><a href="#Analyzer-902"><span class="linenos"> 902</span></a>                <span class="k">pass</span>
</span><span id="Analyzer-903"><a href="#Analyzer-903"><span class="linenos"> 903</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Analyzer-904"><a href="#Analyzer-904"><span class="linenos"> 904</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Commute data missing from project.&quot;</span><span class="p">)</span>
</span><span id="Analyzer-905"><a href="#Analyzer-905"><span class="linenos"> 905</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="Analyzer-906"><a href="#Analyzer-906"><span class="linenos"> 906</span></a>        
</span><span id="Analyzer-907"><a href="#Analyzer-907"><span class="linenos"> 907</span></a>        <span class="c1"># create the graphing object</span>
</span><span id="Analyzer-908"><a href="#Analyzer-908"><span class="linenos"> 908</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">graphing</span> <span class="o">=</span> <span class="n">Graphing</span><span class="p">()</span>
</span><span id="Analyzer-909"><a href="#Analyzer-909"><span class="linenos"> 909</span></a>        
</span><span id="Analyzer-910"><a href="#Analyzer-910"><span class="linenos"> 910</span></a>        <span class="c1"># create a list of dicts to map the graphs to return to UI, they will be plotted in the order they are listed</span>
</span><span id="Analyzer-911"><a href="#Analyzer-911"><span class="linenos"> 911</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">graph_list</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Analyzer-912"><a href="#Analyzer-912"><span class="linenos"> 912</span></a> 
</span><span id="Analyzer-913"><a href="#Analyzer-913"><span class="linenos"> 913</span></a>        <span class="c1">### generate the graphs  ###</span>
</span><span id="Analyzer-914"><a href="#Analyzer-914"><span class="linenos"> 914</span></a>        <span class="n">plots_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project_directory</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">project_name</span><span class="p">,</span> <span class="s2">&quot;plots&quot;</span><span class="p">)</span>
</span><span id="Analyzer-915"><a href="#Analyzer-915"><span class="linenos"> 915</span></a>        <span class="c1"># get the baseline data</span>
</span><span id="Analyzer-916"><a href="#Analyzer-916"><span class="linenos"> 916</span></a>        <span class="n">emp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">get_emp_gps</span><span class="p">()</span>
</span><span id="Analyzer-917"><a href="#Analyzer-917"><span class="linenos"> 917</span></a>        
</span><span id="Analyzer-918"><a href="#Analyzer-918"><span class="linenos"> 918</span></a>        <span class="n">offices</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">get_office_gps</span><span class="p">()</span>
</span><span id="Analyzer-919"><a href="#Analyzer-919"><span class="linenos"> 919</span></a>        <span class="n">commute_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">get_commute_data</span><span class="p">()</span>
</span><span id="Analyzer-920"><a href="#Analyzer-920"><span class="linenos"> 920</span></a>        
</span><span id="Analyzer-921"><a href="#Analyzer-921"><span class="linenos"> 921</span></a>        <span class="c1"># helper function to get a base cost dataframe</span>
</span><span id="Analyzer-922"><a href="#Analyzer-922"><span class="linenos"> 922</span></a>        <span class="k">def</span> <span class="nf">get_base_cost_df</span><span class="p">(</span><span class="n">emp</span><span class="p">,</span> <span class="n">officeaddr</span><span class="p">):</span>
</span><span id="Analyzer-923"><a href="#Analyzer-923"><span class="linenos"> 923</span></a>            <span class="n">rows</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Analyzer-924"><a href="#Analyzer-924"><span class="linenos"> 924</span></a>            <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">emp</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
</span><span id="Analyzer-925"><a href="#Analyzer-925"><span class="linenos"> 925</span></a>                <span class="n">cost</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="Analyzer-926"><a href="#Analyzer-926"><span class="linenos"> 926</span></a>                <span class="n">rows</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s1">&#39;latitude&#39;</span><span class="p">:</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;latitude&#39;</span><span class="p">],</span><span class="s1">&#39;longitude&#39;</span><span class="p">:</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;longitude&#39;</span><span class="p">],</span><span class="s1">&#39;office&#39;</span><span class="p">:</span><span class="n">officeaddr</span><span class="p">,</span><span class="s1">&#39;cost&#39;</span><span class="p">:</span><span class="n">cost</span><span class="p">})</span>
</span><span id="Analyzer-927"><a href="#Analyzer-927"><span class="linenos"> 927</span></a>            <span class="c1">#cost_df = pd.DataFrame(rows)</span>
</span><span id="Analyzer-928"><a href="#Analyzer-928"><span class="linenos"> 928</span></a>            <span class="k">return</span> <span class="n">rows</span>
</span><span id="Analyzer-929"><a href="#Analyzer-929"><span class="linenos"> 929</span></a>            
</span><span id="Analyzer-930"><a href="#Analyzer-930"><span class="linenos"> 930</span></a>        <span class="c1">################################################################################ </span>
</span><span id="Analyzer-931"><a href="#Analyzer-931"><span class="linenos"> 931</span></a>        <span class="c1"># GRAPH: </span>
</span><span id="Analyzer-932"><a href="#Analyzer-932"><span class="linenos"> 932</span></a>        <span class="c1">## Geographical Distribution of Analyzed Locations</span>
</span><span id="Analyzer-933"><a href="#Analyzer-933"><span class="linenos"> 933</span></a>        <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Geographical Distribution of Analyzed Locations&quot;</span>
</span><span id="Analyzer-934"><a href="#Analyzer-934"><span class="linenos"> 934</span></a>        <span class="n">key</span> <span class="o">=</span> <span class="s2">&quot;gdal&quot;</span>
</span><span id="Analyzer-935"><a href="#Analyzer-935"><span class="linenos"> 935</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">graph_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="p">{</span><span class="s2">&quot;GRAPH&quot;</span><span class="p">:</span> <span class="n">key</span><span class="p">,</span>
</span><span id="Analyzer-936"><a href="#Analyzer-936"><span class="linenos"> 936</span></a>                                 <span class="s2">&quot;TITLE&quot;</span><span class="p">:</span> <span class="n">title</span><span class="p">,</span>
</span><span id="Analyzer-937"><a href="#Analyzer-937"><span class="linenos"> 937</span></a>                                 <span class="s2">&quot;FILENAME&quot;</span><span class="p">:</span> <span class="n">key</span><span class="o">+</span><span class="s2">&quot;.png&quot;</span><span class="p">,</span>
</span><span id="Analyzer-938"><a href="#Analyzer-938"><span class="linenos"> 938</span></a>                                <span class="s2">&quot;PLOT-DESCRIPTION&quot;</span><span class="p">:</span> <span class="s2">&quot;Employee addresses and potential office locations are visualized on a map, &quot;</span> <span class="o">+</span> \
</span><span id="Analyzer-939"><a href="#Analyzer-939"><span class="linenos"> 939</span></a>                                    <span class="s2">&quot;including those which may be outside of the commuting radius.  A total of &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">emp</span><span class="p">))</span><span class="o">+</span><span class="s2">&quot; employee addresses &quot;</span> <span class="o">+</span> \
</span><span id="Analyzer-940"><a href="#Analyzer-940"><span class="linenos"> 940</span></a>                                    <span class="s2">&quot;and &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">offices</span><span class="p">))</span><span class="o">+</span><span class="s2">&quot; office locations are included in the analysis.&quot;</span>               
</span><span id="Analyzer-941"><a href="#Analyzer-941"><span class="linenos"> 941</span></a>                                <span class="p">})</span>
</span><span id="Analyzer-942"><a href="#Analyzer-942"><span class="linenos"> 942</span></a>        <span class="k">if</span> <span class="n">graph</span> <span class="o">==</span> <span class="s2">&quot;_all&quot;</span> <span class="ow">or</span> <span class="n">graph</span> <span class="o">==</span> <span class="n">key</span><span class="p">:</span>
</span><span id="Analyzer-943"><a href="#Analyzer-943"><span class="linenos"> 943</span></a>            <span class="n">plt</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graphing</span><span class="o">.</span><span class="n">get_map_view</span><span class="p">(</span><span class="n">emp</span><span class="p">,</span> <span class="n">offices</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span> <span class="n">font_mod</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span>
</span><span id="Analyzer-944"><a href="#Analyzer-944"><span class="linenos"> 944</span></a>                                                 <span class="n">commute_color</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">commute_data</span><span class="o">=</span><span class="n">commute_data</span><span class="p">,</span> <span class="n">convex_hull</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">size_o</span><span class="o">=</span><span class="mi">400</span><span class="p">,</span> <span class="n">size_e</span><span class="o">=</span><span class="mi">40</span><span class="p">)</span>
</span><span id="Analyzer-945"><a href="#Analyzer-945"><span class="linenos"> 945</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">(</span><span class="n">pad</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
</span><span id="Analyzer-946"><a href="#Analyzer-946"><span class="linenos"> 946</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">plots_dir</span><span class="o">+</span><span class="s2">&quot;/gdal.png&quot;</span><span class="p">)</span>
</span><span id="Analyzer-947"><a href="#Analyzer-947"><span class="linenos"> 947</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="Analyzer-948"><a href="#Analyzer-948"><span class="linenos"> 948</span></a>
</span><span id="Analyzer-949"><a href="#Analyzer-949"><span class="linenos"> 949</span></a>        <span class="c1">################################################################################</span>
</span><span id="Analyzer-950"><a href="#Analyzer-950"><span class="linenos"> 950</span></a>        <span class="c1">### GRAPH SET: Local Analysis for Office X</span>
</span><span id="Analyzer-951"><a href="#Analyzer-951"><span class="linenos"> 951</span></a>        <span class="c1"># iterate through offices, generate a graph for each office</span>
</span><span id="Analyzer-952"><a href="#Analyzer-952"><span class="linenos"> 952</span></a>        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">offices</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
</span><span id="Analyzer-953"><a href="#Analyzer-953"><span class="linenos"> 953</span></a>            <span class="c1">################################################################################ </span>
</span><span id="Analyzer-954"><a href="#Analyzer-954"><span class="linenos"> 954</span></a>            <span class="c1"># GRAPH: </span>
</span><span id="Analyzer-955"><a href="#Analyzer-955"><span class="linenos"> 955</span></a>            <span class="c1">## Local Analysis for Office X</span>
</span><span id="Analyzer-956"><a href="#Analyzer-956"><span class="linenos"> 956</span></a>            <span class="n">key</span> <span class="o">=</span> <span class="s1">&#39;lafo&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
</span><span id="Analyzer-957"><a href="#Analyzer-957"><span class="linenos"> 957</span></a>            <span class="n">OfficeAddr</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;address&quot;</span><span class="p">]</span>
</span><span id="Analyzer-958"><a href="#Analyzer-958"><span class="linenos"> 958</span></a>            <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;Employee Distribution for &quot;</span><span class="o">+</span><span class="n">OfficeAddr</span>
</span><span id="Analyzer-959"><a href="#Analyzer-959"><span class="linenos"> 959</span></a>            <span class="n">short_title</span> <span class="o">=</span> <span class="s2">&quot;Employee Distribution for Office &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">index</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
</span><span id="Analyzer-960"><a href="#Analyzer-960"><span class="linenos"> 960</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">graph_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="p">{</span><span class="s2">&quot;GRAPH&quot;</span><span class="p">:</span> <span class="n">key</span><span class="p">,</span>
</span><span id="Analyzer-961"><a href="#Analyzer-961"><span class="linenos"> 961</span></a>                                    <span class="s2">&quot;TITLE&quot;</span><span class="p">:</span> <span class="n">short_title</span><span class="p">,</span>
</span><span id="Analyzer-962"><a href="#Analyzer-962"><span class="linenos"> 962</span></a>                                    <span class="s2">&quot;FILENAME&quot;</span><span class="p">:</span> <span class="n">key</span><span class="o">+</span><span class="s2">&quot;.png&quot;</span><span class="p">,</span>
</span><span id="Analyzer-963"><a href="#Analyzer-963"><span class="linenos"> 963</span></a>                                    <span class="s2">&quot;PLOT-DESCRIPTION&quot;</span><span class="p">:</span> <span class="s2">&quot;This graph displays the commute cutoff distribution for employees relative to the office at &quot;</span><span class="o">+</span><span class="n">OfficeAddr</span><span class="o">+</span><span class="s2">&quot;. &quot;</span> <span class="o">+</span> \
</span><span id="Analyzer-964"><a href="#Analyzer-964"><span class="linenos"> 964</span></a>                                                        <span class="s2">&quot;The cutoff distance is &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">commute_range_cut_off</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot; miles. The circle represents the linear distance &quot;</span> <span class="o">+</span> \
</span><span id="Analyzer-965"><a href="#Analyzer-965"><span class="linenos"> 965</span></a>                                                        <span class="s2">&quot;but more importantly is the actual driving distance represented by the convex hull, the shape of which is a result of &quot;</span> <span class="o">+</span> \
</span><span id="Analyzer-966"><a href="#Analyzer-966"><span class="linenos"> 966</span></a>                                                        <span class="s2">&quot;roadway complexities.  The bounded region will vary widely between offices analyzed.&quot;</span>
</span><span id="Analyzer-967"><a href="#Analyzer-967"><span class="linenos"> 967</span></a>                                                        
</span><span id="Analyzer-968"><a href="#Analyzer-968"><span class="linenos"> 968</span></a>                                    <span class="p">})</span>
</span><span id="Analyzer-969"><a href="#Analyzer-969"><span class="linenos"> 969</span></a>            <span class="k">if</span> <span class="n">graph</span> <span class="o">==</span> <span class="s2">&quot;_all&quot;</span> <span class="ow">or</span> <span class="n">graph</span> <span class="o">==</span> <span class="n">key</span><span class="p">:</span>
</span><span id="Analyzer-970"><a href="#Analyzer-970"><span class="linenos"> 970</span></a>                <span class="c1">#just get the first office row</span>
</span><span id="Analyzer-971"><a href="#Analyzer-971"><span class="linenos"> 971</span></a>                <span class="c1">#offices = pd.DataFrame(offices.iloc[0],offices.columns).reset_index(drop=True)</span>
</span><span id="Analyzer-972"><a href="#Analyzer-972"><span class="linenos"> 972</span></a>                <span class="n">office</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">to_frame</span><span class="p">()</span><span class="o">.</span><span class="n">T</span>
</span><span id="Analyzer-973"><a href="#Analyzer-973"><span class="linenos"> 973</span></a>                <span class="n">plt</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graphing</span><span class="o">.</span><span class="n">get_map_view</span><span class="p">(</span><span class="n">emp</span><span class="p">,</span> <span class="n">office</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Employee Distribution for </span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">+</span><span class="n">OfficeAddr</span><span class="p">,</span> 
</span><span id="Analyzer-974"><a href="#Analyzer-974"><span class="linenos"> 974</span></a>                                                    <span class="n">cutoff_distance</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">commute_range_cut_off</span><span class="o">*</span><span class="mi">2</span><span class="p">,</span>
</span><span id="Analyzer-975"><a href="#Analyzer-975"><span class="linenos"> 975</span></a>                                                    <span class="n">commute_radius</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">commute_range_cut_off</span><span class="p">,</span> <span class="n">font_mod</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span>
</span><span id="Analyzer-976"><a href="#Analyzer-976"><span class="linenos"> 976</span></a>                                                    <span class="n">commute_color</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">commute_data</span><span class="o">=</span><span class="n">commute_data</span><span class="p">,</span> <span class="n">convex_hull</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">legend_loc</span><span class="o">=</span><span class="s1">&#39;lower right&#39;</span><span class="p">)</span>
</span><span id="Analyzer-977"><a href="#Analyzer-977"><span class="linenos"> 977</span></a>                <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">(</span><span class="n">pad</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
</span><span id="Analyzer-978"><a href="#Analyzer-978"><span class="linenos"> 978</span></a>                <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">plots_dir</span><span class="o">+</span><span class="s2">&quot;/&quot;</span><span class="o">+</span><span class="n">key</span><span class="o">+</span><span class="s2">&quot;.png&quot;</span><span class="p">)</span>
</span><span id="Analyzer-979"><a href="#Analyzer-979"><span class="linenos"> 979</span></a>                <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="Analyzer-980"><a href="#Analyzer-980"><span class="linenos"> 980</span></a>
</span><span id="Analyzer-981"><a href="#Analyzer-981"><span class="linenos"> 981</span></a>                <span class="c1"># get the employees within the cutoff distance by driving distance, then add the count to the plot description</span>
</span><span id="Analyzer-982"><a href="#Analyzer-982"><span class="linenos"> 982</span></a>                <span class="n">emp_within</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graphing</span><span class="o">.</span><span class="n">filter_drive_distance</span><span class="p">(</span><span class="n">emp</span><span class="p">,</span><span class="n">office</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">commute_range_cut_off</span><span class="p">,</span> <span class="n">commute_data</span><span class="o">=</span><span class="n">commute_data</span><span class="p">)</span>
</span><span id="Analyzer-983"><a href="#Analyzer-983"><span class="linenos"> 983</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">graph_list</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;PLOT-DESCRIPTION&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph_list</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;PLOT-DESCRIPTION&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot; There are &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">emp_within</span><span class="p">))</span> <span class="o">+</span> \
</span><span id="Analyzer-984"><a href="#Analyzer-984"><span class="linenos"> 984</span></a>                                                                <span class="s2">&quot; of the total &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">emp</span><span class="p">))</span> <span class="o">+</span> <span class="s2">&quot; employees within the cutoff distance, a total of &quot;</span> <span class="o">+</span> \
</span><span id="Analyzer-985"><a href="#Analyzer-985"><span class="linenos"> 985</span></a>                                                                <span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">emp_within</span><span class="p">)</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">emp</span><span class="p">)</span><span class="o">*</span><span class="mi">100</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="si">% o</span><span class="s2">f the total employees.&quot;</span>
</span><span id="Analyzer-986"><a href="#Analyzer-986"><span class="linenos"> 986</span></a>
</span><span id="Analyzer-987"><a href="#Analyzer-987"><span class="linenos"> 987</span></a>        <span class="c1">################################################################################ </span>
</span><span id="Analyzer-988"><a href="#Analyzer-988"><span class="linenos"> 988</span></a>        <span class="c1"># GRAPH: </span>
</span><span id="Analyzer-989"><a href="#Analyzer-989"><span class="linenos"> 989</span></a>        <span class="c1">## Local Analysis of Commute Geography</span>
</span><span id="Analyzer-990"><a href="#Analyzer-990"><span class="linenos"> 990</span></a>        <span class="n">key</span> <span class="o">=</span> <span class="s1">&#39;lacg&#39;</span>
</span><span id="Analyzer-991"><a href="#Analyzer-991"><span class="linenos"> 991</span></a>        <span class="c1">#OfficeAddr = row[&quot;address&quot;]</span>
</span><span id="Analyzer-992"><a href="#Analyzer-992"><span class="linenos"> 992</span></a>        <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;Local Analysis of Commute Geography&quot;</span>
</span><span id="Analyzer-993"><a href="#Analyzer-993"><span class="linenos"> 993</span></a>        <span class="n">short_title</span> <span class="o">=</span> <span class="n">title</span>
</span><span id="Analyzer-994"><a href="#Analyzer-994"><span class="linenos"> 994</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">graph_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="p">{</span><span class="s2">&quot;GRAPH&quot;</span><span class="p">:</span> <span class="n">key</span><span class="p">,</span>
</span><span id="Analyzer-995"><a href="#Analyzer-995"><span class="linenos"> 995</span></a>                                <span class="s2">&quot;TITLE&quot;</span><span class="p">:</span> <span class="n">short_title</span><span class="p">,</span>
</span><span id="Analyzer-996"><a href="#Analyzer-996"><span class="linenos"> 996</span></a>                                <span class="s2">&quot;FILENAME&quot;</span><span class="p">:</span> <span class="n">key</span><span class="o">+</span><span class="s2">&quot;.png&quot;</span><span class="p">,</span>
</span><span id="Analyzer-997"><a href="#Analyzer-997"><span class="linenos"> 997</span></a>                                <span class="s2">&quot;PLOT-DESCRIPTION&quot;</span><span class="p">:</span> <span class="s2">&quot;The graph displays several key observations.  Firstly, the green points are employees whose remote work &quot;</span> <span class="o">+</span> \
</span><span id="Analyzer-998"><a href="#Analyzer-998"><span class="linenos"> 998</span></a>                                                    <span class="s2">&quot;status will be unaffected by the relocation. The red points within the green convex hull will have remote &quot;</span> <span class="o">+</span> \
</span><span id="Analyzer-999"><a href="#Analyzer-999"><span class="linenos"> 999</span></a>                                                    <span class="s2">&quot;work status affected by the relocation while those outside the green convex hull remain unaffected by all scenarios. &quot;</span> <span class="o">+</span> \
</span><span id="Analyzer-1000"><a href="#Analyzer-1000"><span class="linenos">1000</span></a>                                                    <span class="s2">&quot;Black circles represent a bounding linear distance of &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">commute_range_cut_off</span><span class="p">)</span> <span class="o">+</span><span class="s2">&quot; miles from each office options for perspective.&quot;</span>
</span><span id="Analyzer-1001"><a href="#Analyzer-1001"><span class="linenos">1001</span></a>                                <span class="p">})</span>
</span><span id="Analyzer-1002"><a href="#Analyzer-1002"><span class="linenos">1002</span></a>        <span class="k">if</span> <span class="n">graph</span> <span class="o">==</span> <span class="s2">&quot;_all&quot;</span> <span class="ow">or</span> <span class="n">graph</span> <span class="o">==</span> <span class="n">key</span><span class="p">:</span>
</span><span id="Analyzer-1003"><a href="#Analyzer-1003"><span class="linenos">1003</span></a>            <span class="n">plt</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graphing</span><span class="o">.</span><span class="n">get_map_view</span><span class="p">(</span><span class="n">emp</span><span class="p">,</span> <span class="n">offices</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span> 
</span><span id="Analyzer-1004"><a href="#Analyzer-1004"><span class="linenos">1004</span></a>                                                 <span class="n">cutoff_radius</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">commute_range_cut_off</span><span class="o">*</span><span class="mi">2</span><span class="p">,</span>
</span><span id="Analyzer-1005"><a href="#Analyzer-1005"><span class="linenos">1005</span></a>                                                 <span class="n">commute_radius</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">commute_range_cut_off</span><span class="p">,</span> <span class="n">legend_loc</span><span class="o">=</span><span class="s1">&#39;lower left&#39;</span><span class="p">,</span> <span class="n">font_mod</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span>
</span><span id="Analyzer-1006"><a href="#Analyzer-1006"><span class="linenos">1006</span></a>                                                 <span class="n">commute_color</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">commute_data</span><span class="o">=</span><span class="n">commute_data</span><span class="p">,</span> <span class="n">convex_hull</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">size_o</span><span class="o">=</span><span class="mi">500</span><span class="p">)</span>
</span><span id="Analyzer-1007"><a href="#Analyzer-1007"><span class="linenos">1007</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">(</span><span class="n">pad</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
</span><span id="Analyzer-1008"><a href="#Analyzer-1008"><span class="linenos">1008</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">plots_dir</span><span class="o">+</span><span class="s2">&quot;/&quot;</span><span class="o">+</span><span class="n">key</span><span class="o">+</span><span class="s2">&quot;.png&quot;</span><span class="p">)</span>
</span><span id="Analyzer-1009"><a href="#Analyzer-1009"><span class="linenos">1009</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="Analyzer-1010"><a href="#Analyzer-1010"><span class="linenos">1010</span></a>
</span><span id="Analyzer-1011"><a href="#Analyzer-1011"><span class="linenos">1011</span></a>
</span><span id="Analyzer-1012"><a href="#Analyzer-1012"><span class="linenos">1012</span></a>        <span class="c1">################################################################################ </span>
</span><span id="Analyzer-1013"><a href="#Analyzer-1013"><span class="linenos">1013</span></a>        <span class="c1"># GRAPH: </span>
</span><span id="Analyzer-1014"><a href="#Analyzer-1014"><span class="linenos">1014</span></a>        <span class="c1">## Employees Impacted by Remote Work Policy &amp; Relocation</span>
</span><span id="Analyzer-1015"><a href="#Analyzer-1015"><span class="linenos">1015</span></a>        <span class="n">key</span> <span class="o">=</span> <span class="s1">&#39;lacg2&#39;</span>
</span><span id="Analyzer-1016"><a href="#Analyzer-1016"><span class="linenos">1016</span></a>        <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;Employees Impacted by Remote Work Policy &amp; Relocation&quot;</span>
</span><span id="Analyzer-1017"><a href="#Analyzer-1017"><span class="linenos">1017</span></a>        <span class="n">short_title</span> <span class="o">=</span> <span class="n">title</span>
</span><span id="Analyzer-1018"><a href="#Analyzer-1018"><span class="linenos">1018</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">graph_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="p">{</span><span class="s2">&quot;GRAPH&quot;</span><span class="p">:</span> <span class="n">key</span><span class="p">,</span>
</span><span id="Analyzer-1019"><a href="#Analyzer-1019"><span class="linenos">1019</span></a>                                <span class="s2">&quot;TITLE&quot;</span><span class="p">:</span> <span class="n">short_title</span><span class="p">,</span>
</span><span id="Analyzer-1020"><a href="#Analyzer-1020"><span class="linenos">1020</span></a>                                <span class="s2">&quot;FILENAME&quot;</span><span class="p">:</span> <span class="n">key</span><span class="o">+</span><span class="s2">&quot;.png&quot;</span><span class="p">,</span>
</span><span id="Analyzer-1021"><a href="#Analyzer-1021"><span class="linenos">1021</span></a>                                <span class="s2">&quot;PLOT-DESCRIPTION&quot;</span><span class="p">:</span> <span class="s2">&quot;deferred&quot;</span>                                
</span><span id="Analyzer-1022"><a href="#Analyzer-1022"><span class="linenos">1022</span></a>                                <span class="p">})</span>
</span><span id="Analyzer-1023"><a href="#Analyzer-1023"><span class="linenos">1023</span></a>        
</span><span id="Analyzer-1024"><a href="#Analyzer-1024"><span class="linenos">1024</span></a>        <span class="k">if</span> <span class="n">graph</span> <span class="o">==</span> <span class="s2">&quot;_all&quot;</span> <span class="ow">or</span> <span class="n">graph</span> <span class="o">==</span> <span class="n">key</span><span class="p">:</span>
</span><span id="Analyzer-1025"><a href="#Analyzer-1025"><span class="linenos">1025</span></a>            <span class="n">plt</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graphing</span><span class="o">.</span><span class="n">get_map_view</span><span class="p">(</span><span class="n">emp</span><span class="p">,</span> <span class="n">offices</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span> <span class="n">font_mod</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span>
</span><span id="Analyzer-1026"><a href="#Analyzer-1026"><span class="linenos">1026</span></a>                                                 <span class="n">cutoff_radius</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">commute_range_cut_off</span><span class="o">*</span><span class="mf">1.2</span><span class="p">,</span>
</span><span id="Analyzer-1027"><a href="#Analyzer-1027"><span class="linenos">1027</span></a>                                                 <span class="n">commute_radius</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">commute_range_cut_off</span><span class="p">,</span> 
</span><span id="Analyzer-1028"><a href="#Analyzer-1028"><span class="linenos">1028</span></a>                                                 <span class="n">commute_color</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">commute_data</span><span class="o">=</span><span class="n">commute_data</span><span class="p">,</span> <span class="n">convex_hull</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">size_o</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span> <span class="n">manual_plot</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="Analyzer-1029"><a href="#Analyzer-1029"><span class="linenos">1029</span></a>            
</span><span id="Analyzer-1030"><a href="#Analyzer-1030"><span class="linenos">1030</span></a>            <span class="n">emp_within</span><span class="p">,</span> <span class="n">emp_outside</span><span class="p">,</span> <span class="n">emp_overlap</span><span class="p">,</span> <span class="n">emp_within_all</span><span class="p">,</span> <span class="n">emp_outside_all</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
</span><span id="Analyzer-1031"><a href="#Analyzer-1031"><span class="linenos">1031</span></a>            
</span><span id="Analyzer-1032"><a href="#Analyzer-1032"><span class="linenos">1032</span></a>            <span class="n">emp_within</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graphing</span><span class="o">.</span><span class="n">filter_drive_distance</span><span class="p">(</span><span class="n">emp</span><span class="p">,</span><span class="n">offices</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">commute_range_cut_off</span><span class="p">,</span> <span class="n">commute_data</span><span class="o">=</span><span class="n">commute_data</span><span class="p">,</span> <span class="n">inside</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="Analyzer-1033"><a href="#Analyzer-1033"><span class="linenos">1033</span></a>            <span class="n">emp_outside</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graphing</span><span class="o">.</span><span class="n">filter_drive_distance</span><span class="p">(</span><span class="n">emp</span><span class="p">,</span><span class="n">offices</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">commute_range_cut_off</span><span class="p">,</span> <span class="n">commute_data</span><span class="o">=</span><span class="n">commute_data</span><span class="p">,</span> <span class="n">inside</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="Analyzer-1034"><a href="#Analyzer-1034"><span class="linenos">1034</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">emp_within</span><span class="o">.</span><span class="n">empty</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">emp_outside</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>                
</span><span id="Analyzer-1035"><a href="#Analyzer-1035"><span class="linenos">1035</span></a>                <span class="n">emp_overlap</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graphing</span><span class="o">.</span><span class="n">get_common_points</span><span class="p">(</span><span class="n">emp_within</span><span class="p">,</span><span class="n">emp_outside</span><span class="p">)</span>
</span><span id="Analyzer-1036"><a href="#Analyzer-1036"><span class="linenos">1036</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">emp_within</span><span class="o">.</span><span class="n">empty</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">emp_outside</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
</span><span id="Analyzer-1037"><a href="#Analyzer-1037"><span class="linenos">1037</span></a>                <span class="n">emp_outside_all</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graphing</span><span class="o">.</span><span class="n">get_unique_points</span><span class="p">(</span><span class="n">emp_outside</span><span class="p">,</span><span class="n">emp_overlap</span><span class="p">)</span>
</span><span id="Analyzer-1038"><a href="#Analyzer-1038"><span class="linenos">1038</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">emp_within</span><span class="o">.</span><span class="n">empty</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">emp_outside</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
</span><span id="Analyzer-1039"><a href="#Analyzer-1039"><span class="linenos">1039</span></a>                <span class="n">emp_within_all</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graphing</span><span class="o">.</span><span class="n">get_unique_points</span><span class="p">(</span><span class="n">emp_within</span><span class="p">,</span><span class="n">emp_overlap</span><span class="p">)</span>
</span><span id="Analyzer-1040"><a href="#Analyzer-1040"><span class="linenos">1040</span></a>            <span class="n">emp_within_list</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Analyzer-1041"><a href="#Analyzer-1041"><span class="linenos">1041</span></a>            <span class="n">hullvars</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;color&quot;</span><span class="p">:</span><span class="s2">&quot;red&quot;</span><span class="p">,</span><span class="s2">&quot;linewidth&quot;</span><span class="p">:</span><span class="mi">50</span><span class="p">,</span><span class="s2">&quot;alpha&quot;</span><span class="p">:</span><span class="mf">0.07</span><span class="p">}</span>
</span><span id="Analyzer-1042"><a href="#Analyzer-1042"><span class="linenos">1042</span></a>            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">offices</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
</span><span id="Analyzer-1043"><a href="#Analyzer-1043"><span class="linenos">1043</span></a>                <span class="n">office</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">to_frame</span><span class="p">()</span><span class="o">.</span><span class="n">T</span>
</span><span id="Analyzer-1044"><a href="#Analyzer-1044"><span class="linenos">1044</span></a>                <span class="n">emp_within_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">graphing</span><span class="o">.</span><span class="n">filter_drive_distance</span><span class="p">(</span><span class="n">emp</span><span class="p">,</span><span class="n">office</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">commute_range_cut_off</span><span class="p">,</span> <span class="n">commute_data</span><span class="o">=</span><span class="n">commute_data</span><span class="p">,</span> <span class="n">inside</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
</span><span id="Analyzer-1045"><a href="#Analyzer-1045"><span class="linenos">1045</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">graphing</span><span class="o">.</span><span class="n">plot_convex_hull</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">emp_within_list</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="o">**</span><span class="n">hullvars</span><span class="p">)</span>
</span><span id="Analyzer-1046"><a href="#Analyzer-1046"><span class="linenos">1046</span></a>
</span><span id="Analyzer-1047"><a href="#Analyzer-1047"><span class="linenos">1047</span></a>            <span class="c1"># plot the points</span>
</span><span id="Analyzer-1048"><a href="#Analyzer-1048"><span class="linenos">1048</span></a>            <span class="k">if</span> <span class="n">emp_within_all</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">emp_within_all</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
</span><span id="Analyzer-1049"><a href="#Analyzer-1049"><span class="linenos">1049</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">graphing</span><span class="o">.</span><span class="n">plot_addresses</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">emp_within_all</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Unaffected by </span><span class="se">\n</span><span class="s2">Relocation Decision&quot;</span><span class="p">)</span>
</span><span id="Analyzer-1050"><a href="#Analyzer-1050"><span class="linenos">1050</span></a>            <span class="c1">#if emp_outside_all is not None and not emp_outside_all.empty:</span>
</span><span id="Analyzer-1051"><a href="#Analyzer-1051"><span class="linenos">1051</span></a>                <span class="c1">#self.graphing.plot_addresses(ax, emp_outside_all,color=&#39;gray&#39;,label=&quot;Outside Commute \nRadius for Offices&quot;)</span>
</span><span id="Analyzer-1052"><a href="#Analyzer-1052"><span class="linenos">1052</span></a>            <span class="k">if</span> <span class="n">emp_overlap</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">emp_overlap</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
</span><span id="Analyzer-1053"><a href="#Analyzer-1053"><span class="linenos">1053</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">graphing</span><span class="o">.</span><span class="n">plot_addresses</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">emp_overlap</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span><span class="n">s</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Impacted by </span><span class="se">\n</span><span class="s2">Relocation Decision&quot;</span><span class="p">)</span>
</span><span id="Analyzer-1054"><a href="#Analyzer-1054"><span class="linenos">1054</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">graphing</span><span class="o">.</span><span class="n">plot_offices</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">offices</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">400</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Potential Office Locations&quot;</span><span class="p">)</span>
</span><span id="Analyzer-1055"><a href="#Analyzer-1055"><span class="linenos">1055</span></a>            <span class="k">if</span> <span class="n">emp_within_all</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">emp_within_all</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
</span><span id="Analyzer-1056"><a href="#Analyzer-1056"><span class="linenos">1056</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">graphing</span><span class="o">.</span><span class="n">plot_convex_hull</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">emp_within_all</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>
</span><span id="Analyzer-1057"><a href="#Analyzer-1057"><span class="linenos">1057</span></a>            <span class="k">if</span> <span class="n">emp_overlap</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">emp_overlap</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
</span><span id="Analyzer-1058"><a href="#Analyzer-1058"><span class="linenos">1058</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">graphing</span><span class="o">.</span><span class="n">plot_convex_hull</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">emp_overlap</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">)</span>
</span><span id="Analyzer-1059"><a href="#Analyzer-1059"><span class="linenos">1059</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">graphing</span><span class="o">.</span><span class="n">add_scalebar</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span><span class="n">font_mod</span><span class="o">=</span><span class="mf">1.5</span><span class="p">)</span>
</span><span id="Analyzer-1060"><a href="#Analyzer-1060"><span class="linenos">1060</span></a>            <span class="c1"># add legend</span>
</span><span id="Analyzer-1061"><a href="#Analyzer-1061"><span class="linenos">1061</span></a>            <span class="n">handles</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">get_legend_handles_labels</span><span class="p">()</span>
</span><span id="Analyzer-1062"><a href="#Analyzer-1062"><span class="linenos">1062</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">graphing</span><span class="o">.</span><span class="n">map_view_standard_legend</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">handles</span><span class="p">,</span> <span class="n">labels</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
</span><span id="Analyzer-1063"><a href="#Analyzer-1063"><span class="linenos">1063</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">25</span><span class="p">)</span>
</span><span id="Analyzer-1064"><a href="#Analyzer-1064"><span class="linenos">1064</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">(</span><span class="n">pad</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
</span><span id="Analyzer-1065"><a href="#Analyzer-1065"><span class="linenos">1065</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">plots_dir</span><span class="o">+</span><span class="s2">&quot;/&quot;</span><span class="o">+</span><span class="n">key</span><span class="o">+</span><span class="s2">&quot;.png&quot;</span><span class="p">)</span>
</span><span id="Analyzer-1066"><a href="#Analyzer-1066"><span class="linenos">1066</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="Analyzer-1067"><a href="#Analyzer-1067"><span class="linenos">1067</span></a>            
</span><span id="Analyzer-1068"><a href="#Analyzer-1068"><span class="linenos">1068</span></a>
</span><span id="Analyzer-1069"><a href="#Analyzer-1069"><span class="linenos">1069</span></a>            <span class="c1"># udpate the plot description</span>
</span><span id="Analyzer-1070"><a href="#Analyzer-1070"><span class="linenos">1070</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">graph_list</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;PLOT-DESCRIPTION&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;This graph displays the &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="mi">0</span> <span class="k">if</span> <span class="n">emp_overlap</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">emp_overlap</span><span class="o">.</span><span class="n">empty</span> <span class="k">else</span> <span class="nb">len</span><span class="p">(</span><span class="n">emp_overlap</span><span class="p">))</span> <span class="o">+</span> <span class="s2">&quot; employees that are impacted by the relocaiton.  &quot;</span> <span class="o">+</span> \
</span><span id="Analyzer-1071"><a href="#Analyzer-1071"><span class="linenos">1071</span></a>                                <span class="s2">&quot;Specifically, the red indicates employees that either rotate into, or out of the remote work policy by cutoff-distance. This is &quot;</span> <span class="o">+</span> \
</span><span id="Analyzer-1072"><a href="#Analyzer-1072"><span class="linenos">1072</span></a>                                <span class="nb">str</span><span class="p">(</span><span class="mi">0</span> <span class="k">if</span> <span class="n">emp_overlap</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">emp_overlap</span><span class="o">.</span><span class="n">empty</span> <span class="k">else</span> <span class="nb">round</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">emp_overlap</span><span class="p">)</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">emp</span><span class="p">)</span><span class="o">*</span><span class="mi">100</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="si">% o</span><span class="s2">f the total employees.  &quot;</span>
</span><span id="Analyzer-1073"><a href="#Analyzer-1073"><span class="linenos">1073</span></a>        
</span><span id="Analyzer-1074"><a href="#Analyzer-1074"><span class="linenos">1074</span></a>
</span><span id="Analyzer-1075"><a href="#Analyzer-1075"><span class="linenos">1075</span></a>        <span class="c1">################################################################################ </span>
</span><span id="Analyzer-1076"><a href="#Analyzer-1076"><span class="linenos">1076</span></a>        <span class="c1"># GRAPH: </span>
</span><span id="Analyzer-1077"><a href="#Analyzer-1077"><span class="linenos">1077</span></a>        <span class="c1">## Baseline Commute Cost Analysis</span>
</span><span id="Analyzer-1078"><a href="#Analyzer-1078"><span class="linenos">1078</span></a>        <span class="n">key</span> <span class="o">=</span> <span class="s1">&#39;bcca&#39;</span>
</span><span id="Analyzer-1079"><a href="#Analyzer-1079"><span class="linenos">1079</span></a>        <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;Baseline Commute Cost Analysis&quot;</span>
</span><span id="Analyzer-1080"><a href="#Analyzer-1080"><span class="linenos">1080</span></a>        <span class="n">short_title</span> <span class="o">=</span> <span class="n">title</span>
</span><span id="Analyzer-1081"><a href="#Analyzer-1081"><span class="linenos">1081</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">graph_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="p">{</span><span class="s2">&quot;GRAPH&quot;</span><span class="p">:</span> <span class="n">key</span><span class="p">,</span>
</span><span id="Analyzer-1082"><a href="#Analyzer-1082"><span class="linenos">1082</span></a>                                <span class="s2">&quot;TITLE&quot;</span><span class="p">:</span> <span class="n">short_title</span><span class="p">,</span>
</span><span id="Analyzer-1083"><a href="#Analyzer-1083"><span class="linenos">1083</span></a>                                <span class="s2">&quot;FILENAME&quot;</span><span class="p">:</span> <span class="n">key</span><span class="o">+</span><span class="s2">&quot;.png&quot;</span><span class="p">,</span>
</span><span id="Analyzer-1084"><a href="#Analyzer-1084"><span class="linenos">1084</span></a>                                <span class="s2">&quot;PLOT-DESCRIPTION&quot;</span><span class="p">:</span> <span class="s2">&quot;deferred&quot;</span>
</span><span id="Analyzer-1085"><a href="#Analyzer-1085"><span class="linenos">1085</span></a>                                <span class="p">})</span>
</span><span id="Analyzer-1086"><a href="#Analyzer-1086"><span class="linenos">1086</span></a>        
</span><span id="Analyzer-1087"><a href="#Analyzer-1087"><span class="linenos">1087</span></a>        <span class="k">if</span> <span class="n">graph</span> <span class="o">==</span> <span class="s2">&quot;_all&quot;</span> <span class="ow">or</span> <span class="n">graph</span> <span class="o">==</span> <span class="n">key</span><span class="p">:</span>
</span><span id="Analyzer-1088"><a href="#Analyzer-1088"><span class="linenos">1088</span></a>            <span class="c1"># get the value to plot</span>
</span><span id="Analyzer-1089"><a href="#Analyzer-1089"><span class="linenos">1089</span></a>            <span class="n">value</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;commute_cost&#39;</span><span class="p">]</span>
</span><span id="Analyzer-1090"><a href="#Analyzer-1090"><span class="linenos">1090</span></a>            <span class="c1"># baseline will be first office, assumed to be the current office, or &quot;as is use case&quot;</span>
</span><span id="Analyzer-1091"><a href="#Analyzer-1091"><span class="linenos">1091</span></a>            <span class="n">office</span> <span class="o">=</span> <span class="n">offices</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">to_frame</span><span class="p">()</span><span class="o">.</span><span class="n">T</span>
</span><span id="Analyzer-1092"><a href="#Analyzer-1092"><span class="linenos">1092</span></a>            <span class="c1"># employees to analyze are within the cutoff distance for this office</span>
</span><span id="Analyzer-1093"><a href="#Analyzer-1093"><span class="linenos">1093</span></a>            <span class="n">emp_within</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graphing</span><span class="o">.</span><span class="n">filter_drive_distance</span><span class="p">(</span><span class="n">emp</span><span class="p">,</span><span class="n">office</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">commute_range_cut_off</span><span class="p">,</span> <span class="n">commute_data</span><span class="o">=</span><span class="n">commute_data</span><span class="p">)</span>
</span><span id="Analyzer-1094"><a href="#Analyzer-1094"><span class="linenos">1094</span></a>            <span class="c1"># get commute cost values </span>
</span><span id="Analyzer-1095"><a href="#Analyzer-1095"><span class="linenos">1095</span></a>            <span class="n">cost_values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graphing</span><span class="o">.</span><span class="n">get_commute_values</span><span class="p">(</span><span class="n">emp_within</span><span class="p">,</span> <span class="n">office</span><span class="p">,</span> <span class="n">commute_data</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
</span><span id="Analyzer-1096"><a href="#Analyzer-1096"><span class="linenos">1096</span></a>            <span class="c1"># calculate the bin list based upon a the max value of the data</span>
</span><span id="Analyzer-1097"><a href="#Analyzer-1097"><span class="linenos">1097</span></a>            <span class="n">binmax</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">cost_values</span><span class="p">[</span><span class="s1">&#39;commute_cost&#39;</span><span class="p">])</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
</span><span id="Analyzer-1098"><a href="#Analyzer-1098"><span class="linenos">1098</span></a>            <span class="n">step</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="Analyzer-1099"><a href="#Analyzer-1099"><span class="linenos">1099</span></a>            <span class="c1"># round the binmax up to the nearest step</span>
</span><span id="Analyzer-1100"><a href="#Analyzer-1100"><span class="linenos">1100</span></a>            <span class="n">bins</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">binmax</span> <span class="o">+</span> <span class="n">step</span> <span class="o">-</span> <span class="p">(</span><span class="n">binmax</span> <span class="o">%</span> <span class="n">step</span><span class="p">)),</span> <span class="n">step</span><span class="p">)</span>
</span><span id="Analyzer-1101"><a href="#Analyzer-1101"><span class="linenos">1101</span></a>            <span class="n">plt</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graphing</span><span class="o">.</span><span class="n">get_histogram</span><span class="p">(</span><span class="n">emp_within</span><span class="p">,</span> <span class="n">office</span><span class="p">,</span> <span class="n">commute_data</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">suptitle</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span id="Analyzer-1102"><a href="#Analyzer-1102"><span class="linenos">1102</span></a>                                      <span class="n">x_label</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="s1">&#39;\$ (USD) based on \$&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">mileage_rate</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39; per mile.&#39;</span><span class="p">),</span> <span class="n">y_label</span><span class="o">=</span><span class="s1">&#39;# Employees&#39;</span><span class="p">,</span>
</span><span id="Analyzer-1103"><a href="#Analyzer-1103"><span class="linenos">1103</span></a>                                      <span class="n">bins</span><span class="o">=</span><span class="n">bins</span><span class="p">,</span> <span class="n">rows</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">cols</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">column_titles</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Baseline Commute Cost Analysis for &quot;</span><span class="o">+</span><span class="n">office</span><span class="p">[</span><span class="s2">&quot;address&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">],</span> <span class="n">cumulative_line</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">font_mod</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
</span><span id="Analyzer-1104"><a href="#Analyzer-1104"><span class="linenos">1104</span></a>            
</span><span id="Analyzer-1105"><a href="#Analyzer-1105"><span class="linenos">1105</span></a>            <span class="c1"># udpate the plot description</span>
</span><span id="Analyzer-1106"><a href="#Analyzer-1106"><span class="linenos">1106</span></a>            <span class="n">median_cost</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">cost_values</span><span class="p">[</span><span class="s1">&#39;commute_cost&#39;</span><span class="p">]),</span><span class="mi">2</span><span class="p">)</span>
</span><span id="Analyzer-1107"><a href="#Analyzer-1107"><span class="linenos">1107</span></a>            <span class="n">average_cost</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">cost_values</span><span class="p">[</span><span class="s1">&#39;commute_cost&#39;</span><span class="p">]),</span><span class="mi">2</span><span class="p">)</span>
</span><span id="Analyzer-1108"><a href="#Analyzer-1108"><span class="linenos">1108</span></a>            <span class="n">commutes</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">commute_days_per_week</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">commute_weeks_per_year</span>
</span><span id="Analyzer-1109"><a href="#Analyzer-1109"><span class="linenos">1109</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">graph_list</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;PLOT-DESCRIPTION&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;This graph displays the distribution of commute costs for employees within the &quot;</span> <span class="o">+</span> \
</span><span id="Analyzer-1110"><a href="#Analyzer-1110"><span class="linenos">1110</span></a>                                                    <span class="s2">&quot;cutoff distance of the office at &quot;</span><span class="o">+</span><span class="n">office</span><span class="p">[</span><span class="s2">&quot;address&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="s2">&quot;.  &quot;</span> <span class="o">+</span> \
</span><span id="Analyzer-1111"><a href="#Analyzer-1111"><span class="linenos">1111</span></a>                                                    <span class="s2">&quot;The median cost per commute is $&quot;</span><span class="o">+</span><span class="s2">&quot;</span><span class="si">{:.2f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">median_cost</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;, and the average cost per commute is $&quot;</span><span class="o">+</span><span class="s2">&quot;</span><span class="si">{:.2f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">average_cost</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;, one way. &quot;</span> <span class="o">+</span> \
</span><span id="Analyzer-1112"><a href="#Analyzer-1112"><span class="linenos">1112</span></a>                                                    <span class="s2">&quot;For 2 commutes per day, &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">commute_days_per_week</span><span class="p">)</span> <span class="o">+</span> \
</span><span id="Analyzer-1113"><a href="#Analyzer-1113"><span class="linenos">1113</span></a>                                                    <span class="s2">&quot; days per week, and &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">commute_weeks_per_year</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; weeks per year (&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">commutes</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; commutes/yr), the &quot;</span> <span class="o">+</span> \
</span><span id="Analyzer-1114"><a href="#Analyzer-1114"><span class="linenos">1114</span></a>                                                    <span class="s2">&quot;median and average annual cost per employee is $&quot;</span><span class="o">+</span><span class="s2">&quot;</span><span class="si">{:.2f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">median_cost</span><span class="o">*</span><span class="n">commutes</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span><span class="o">+</span><span class="s2">&quot; and $&quot;</span><span class="o">+</span><span class="s2">&quot;</span><span class="si">{:.2f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">average_cost</span><span class="o">*</span><span class="n">commutes</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span><span class="o">+</span><span class="s2">&quot; respectively not including tolls, etc. &quot;</span> <span class="o">+</span> \
</span><span id="Analyzer-1115"><a href="#Analyzer-1115"><span class="linenos">1115</span></a>                                                    <span class="s2">&quot;Minimum and maximum annual costs within the designated commute range are: $&quot;</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="si">{:.2f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">cost_values</span><span class="p">[</span><span class="s1">&#39;commute_cost&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">commutes</span><span class="p">),</span><span class="mi">2</span><span class="p">))</span> <span class="o">+</span> <span class="s2">&quot; and $&quot;</span> <span class="o">+</span> \
</span><span id="Analyzer-1116"><a href="#Analyzer-1116"><span class="linenos">1116</span></a>                                                    <span class="s2">&quot;</span><span class="si">{:.2f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">cost_values</span><span class="p">[</span><span class="s1">&#39;commute_cost&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">commutes</span><span class="p">),</span><span class="mi">2</span><span class="p">))</span> <span class="o">+</span> <span class="s2">&quot; respectively.  In total, the workforce within the cutoff distance &quot;</span> <span class="o">+</span> \
</span><span id="Analyzer-1117"><a href="#Analyzer-1117"><span class="linenos">1117</span></a>                                                    <span class="s2">&quot;has a total annual commute cost of $&quot;</span><span class="o">+</span><span class="s2">&quot;</span><span class="si">{:,.2f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">cost_values</span><span class="p">[</span><span class="s1">&#39;commute_cost&#39;</span><span class="p">])</span><span class="o">*</span><span class="n">commutes</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span><span class="o">+</span><span class="s2">&quot;. Values based on $&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">mileage_rate</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot; per mile.&quot;</span>
</span><span id="Analyzer-1118"><a href="#Analyzer-1118"><span class="linenos">1118</span></a>            
</span><span id="Analyzer-1119"><a href="#Analyzer-1119"><span class="linenos">1119</span></a>            <span class="c1"># add a text box with the stats, using two decimal places and adding commas at the thousands</span>
</span><span id="Analyzer-1120"><a href="#Analyzer-1120"><span class="linenos">1120</span></a>            <span class="n">t</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;me&#39;</span> <span class="p">:</span> <span class="s1">&#39;Median: |$</span><span class="si">{:,.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">median_cost</span><span class="o">*</span><span class="n">commutes</span><span class="p">),</span>
</span><span id="Analyzer-1121"><a href="#Analyzer-1121"><span class="linenos">1121</span></a>                <span class="s1">&#39;av&#39;</span> <span class="p">:</span> <span class="s1">&#39;Average: |$</span><span class="si">{:,.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">average_cost</span><span class="o">*</span><span class="n">commutes</span><span class="p">),</span>
</span><span id="Analyzer-1122"><a href="#Analyzer-1122"><span class="linenos">1122</span></a>                <span class="s1">&#39;mi&#39;</span> <span class="p">:</span> <span class="s1">&#39;Min: |$</span><span class="si">{:,.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">cost_values</span><span class="p">[</span><span class="s1">&#39;commute_cost&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">commutes</span><span class="p">),</span><span class="mi">2</span><span class="p">)),</span>
</span><span id="Analyzer-1123"><a href="#Analyzer-1123"><span class="linenos">1123</span></a>                <span class="s1">&#39;ma&#39;</span> <span class="p">:</span> <span class="s1">&#39;Max: |$</span><span class="si">{:,.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">cost_values</span><span class="p">[</span><span class="s1">&#39;commute_cost&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">commutes</span><span class="p">),</span><span class="mi">2</span><span class="p">)),</span>
</span><span id="Analyzer-1124"><a href="#Analyzer-1124"><span class="linenos">1124</span></a>                <span class="s1">&#39;to&#39;</span> <span class="p">:</span> <span class="s1">&#39;Total: |$</span><span class="si">{:,.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">cost_values</span><span class="p">[</span><span class="s1">&#39;commute_cost&#39;</span><span class="p">])</span><span class="o">*</span><span class="n">commutes</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
</span><span id="Analyzer-1125"><a href="#Analyzer-1125"><span class="linenos">1125</span></a>                <span class="p">}</span>
</span><span id="Analyzer-1126"><a href="#Analyzer-1126"><span class="linenos">1126</span></a>            <span class="c1"># get the longest string value</span>
</span><span id="Analyzer-1127"><a href="#Analyzer-1127"><span class="linenos">1127</span></a>            <span class="n">max_len</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="s1">&#39;me&#39;</span><span class="p">]),</span><span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="s1">&#39;av&#39;</span><span class="p">]),</span><span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="s1">&#39;to&#39;</span><span class="p">]),</span><span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="s1">&#39;mi&#39;</span><span class="p">]),</span><span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="s1">&#39;ma&#39;</span><span class="p">]))</span>
</span><span id="Analyzer-1128"><a href="#Analyzer-1128"><span class="linenos">1128</span></a>            <span class="c1"># calculate how many narrow numbers/letters exist in the string, we need to add additional space for each</span>
</span><span id="Analyzer-1129"><a href="#Analyzer-1129"><span class="linenos">1129</span></a>            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">t</span><span class="p">:</span>
</span><span id="Analyzer-1130"><a href="#Analyzer-1130"><span class="linenos">1130</span></a>                <span class="n">t</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">t</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">,</span><span class="s2">&quot; &quot;</span><span class="o">*</span><span class="p">(</span><span class="n">max_len</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="n">k</span><span class="p">])))</span>
</span><span id="Analyzer-1131"><a href="#Analyzer-1131"><span class="linenos">1131</span></a>
</span><span id="Analyzer-1132"><a href="#Analyzer-1132"><span class="linenos">1132</span></a>
</span><span id="Analyzer-1133"><a href="#Analyzer-1133"><span class="linenos">1133</span></a>            <span class="c1"># add spaces to make all the same length, replacing |</span>
</span><span id="Analyzer-1134"><a href="#Analyzer-1134"><span class="linenos">1134</span></a>            <span class="n">textstr</span> <span class="o">=</span> <span class="s2">&quot;Annualized Costs: &quot;</span>
</span><span id="Analyzer-1135"><a href="#Analyzer-1135"><span class="linenos">1135</span></a>            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">t</span><span class="p">:</span>
</span><span id="Analyzer-1136"><a href="#Analyzer-1136"><span class="linenos">1136</span></a>                <span class="n">textstr</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">t</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
</span><span id="Analyzer-1137"><a href="#Analyzer-1137"><span class="linenos">1137</span></a>            
</span><span id="Analyzer-1138"><a href="#Analyzer-1138"><span class="linenos">1138</span></a>            <span class="n">props</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">boxstyle</span><span class="o">=</span><span class="s1">&#39;round&#39;</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;wheat&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
</span><span id="Analyzer-1139"><a href="#Analyzer-1139"><span class="linenos">1139</span></a>                
</span><span id="Analyzer-1140"><a href="#Analyzer-1140"><span class="linenos">1140</span></a>            <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">.95</span><span class="p">,</span> <span class="mf">.5</span><span class="p">,</span> <span class="n">textstr</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span>
</span><span id="Analyzer-1141"><a href="#Analyzer-1141"><span class="linenos">1141</span></a>                        <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">bbox</span><span class="o">=</span><span class="n">props</span><span class="p">,</span> <span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;family&#39;</span><span class="p">:</span> <span class="s1">&#39;monospace&#39;</span><span class="p">},</span> <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">)</span>
</span><span id="Analyzer-1142"><a href="#Analyzer-1142"><span class="linenos">1142</span></a>
</span><span id="Analyzer-1143"><a href="#Analyzer-1143"><span class="linenos">1143</span></a>
</span><span id="Analyzer-1144"><a href="#Analyzer-1144"><span class="linenos">1144</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">(</span><span class="n">pad</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
</span><span id="Analyzer-1145"><a href="#Analyzer-1145"><span class="linenos">1145</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">plots_dir</span><span class="o">+</span><span class="s2">&quot;/&quot;</span><span class="o">+</span><span class="n">key</span><span class="o">+</span><span class="s2">&quot;.png&quot;</span><span class="p">)</span>
</span><span id="Analyzer-1146"><a href="#Analyzer-1146"><span class="linenos">1146</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="Analyzer-1147"><a href="#Analyzer-1147"><span class="linenos">1147</span></a>
</span><span id="Analyzer-1148"><a href="#Analyzer-1148"><span class="linenos">1148</span></a>            
</span><span id="Analyzer-1149"><a href="#Analyzer-1149"><span class="linenos">1149</span></a>
</span><span id="Analyzer-1150"><a href="#Analyzer-1150"><span class="linenos">1150</span></a>        <span class="c1">################################################################################ </span>
</span><span id="Analyzer-1151"><a href="#Analyzer-1151"><span class="linenos">1151</span></a>        <span class="c1"># GRAPH: </span>
</span><span id="Analyzer-1152"><a href="#Analyzer-1152"><span class="linenos">1152</span></a>        <span class="c1">## Commute Costs per Office</span>
</span><span id="Analyzer-1153"><a href="#Analyzer-1153"><span class="linenos">1153</span></a>        <span class="n">key</span> <span class="o">=</span> <span class="s1">&#39;ccpo&#39;</span>
</span><span id="Analyzer-1154"><a href="#Analyzer-1154"><span class="linenos">1154</span></a>        <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;Commute Costs per Office&quot;</span>
</span><span id="Analyzer-1155"><a href="#Analyzer-1155"><span class="linenos">1155</span></a>        <span class="n">short_title</span> <span class="o">=</span> <span class="n">title</span>
</span><span id="Analyzer-1156"><a href="#Analyzer-1156"><span class="linenos">1156</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">graph_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="p">{</span><span class="s2">&quot;GRAPH&quot;</span><span class="p">:</span> <span class="n">key</span><span class="p">,</span>
</span><span id="Analyzer-1157"><a href="#Analyzer-1157"><span class="linenos">1157</span></a>                                <span class="s2">&quot;TITLE&quot;</span><span class="p">:</span> <span class="n">short_title</span><span class="p">,</span>
</span><span id="Analyzer-1158"><a href="#Analyzer-1158"><span class="linenos">1158</span></a>                                <span class="s2">&quot;FILENAME&quot;</span><span class="p">:</span> <span class="n">key</span><span class="o">+</span><span class="s2">&quot;.png&quot;</span><span class="p">,</span>
</span><span id="Analyzer-1159"><a href="#Analyzer-1159"><span class="linenos">1159</span></a>                                <span class="s2">&quot;PLOT-DESCRIPTION&quot;</span><span class="p">:</span> <span class="s2">&quot;This graph displays the distribution of commute costs for employees within the &quot;</span> <span class="o">+</span> \
</span><span id="Analyzer-1160"><a href="#Analyzer-1160"><span class="linenos">1160</span></a>                                                    <span class="s2">&quot;cutoff distance of the office options. Overall commute costs are shown for each office &quot;</span> <span class="o">+</span> \
</span><span id="Analyzer-1161"><a href="#Analyzer-1161"><span class="linenos">1161</span></a>                                                    <span class="s2">&quot;option.  This analysis inlcudes only per mile costs, not including tolls, etc.  &quot;</span> <span class="o">+</span> \
</span><span id="Analyzer-1162"><a href="#Analyzer-1162"><span class="linenos">1162</span></a>                                                    <span class="s2">&quot;Costs due to cash equivalent for time not included.&quot;</span>
</span><span id="Analyzer-1163"><a href="#Analyzer-1163"><span class="linenos">1163</span></a>                                <span class="p">})</span>
</span><span id="Analyzer-1164"><a href="#Analyzer-1164"><span class="linenos">1164</span></a>        
</span><span id="Analyzer-1165"><a href="#Analyzer-1165"><span class="linenos">1165</span></a>        <span class="k">if</span> <span class="n">graph</span> <span class="o">==</span> <span class="s2">&quot;_all&quot;</span> <span class="ow">or</span> <span class="n">graph</span> <span class="o">==</span> <span class="n">key</span><span class="p">:</span>
</span><span id="Analyzer-1166"><a href="#Analyzer-1166"><span class="linenos">1166</span></a>            <span class="c1"># get the value to plot</span>
</span><span id="Analyzer-1167"><a href="#Analyzer-1167"><span class="linenos">1167</span></a>            <span class="n">value</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Analyzer-1168"><a href="#Analyzer-1168"><span class="linenos">1168</span></a>            <span class="c1"># employees to analyze are within the cutoff distance for this office</span>
</span><span id="Analyzer-1169"><a href="#Analyzer-1169"><span class="linenos">1169</span></a>            <span class="c1"># for this analysis, we need to iterate through options</span>
</span><span id="Analyzer-1170"><a href="#Analyzer-1170"><span class="linenos">1170</span></a>            <span class="n">emp_within</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Analyzer-1171"><a href="#Analyzer-1171"><span class="linenos">1171</span></a>            <span class="n">office_addrs</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Analyzer-1172"><a href="#Analyzer-1172"><span class="linenos">1172</span></a>            <span class="n">cost_values</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Analyzer-1173"><a href="#Analyzer-1173"><span class="linenos">1173</span></a>            <span class="n">median_costs</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Analyzer-1174"><a href="#Analyzer-1174"><span class="linenos">1174</span></a>            <span class="n">average_costs</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Analyzer-1175"><a href="#Analyzer-1175"><span class="linenos">1175</span></a>            <span class="n">total_costs</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Analyzer-1176"><a href="#Analyzer-1176"><span class="linenos">1176</span></a>            <span class="n">min_costs</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Analyzer-1177"><a href="#Analyzer-1177"><span class="linenos">1177</span></a>            <span class="n">max_costs</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Analyzer-1178"><a href="#Analyzer-1178"><span class="linenos">1178</span></a>            <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">offices</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
</span><span id="Analyzer-1179"><a href="#Analyzer-1179"><span class="linenos">1179</span></a>                <span class="n">office</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">to_frame</span><span class="p">()</span><span class="o">.</span><span class="n">T</span>
</span><span id="Analyzer-1180"><a href="#Analyzer-1180"><span class="linenos">1180</span></a>                <span class="n">emp_within</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">graphing</span><span class="o">.</span><span class="n">filter_drive_distance</span><span class="p">(</span><span class="n">emp</span><span class="p">,</span><span class="n">office</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">commute_range_cut_off</span><span class="p">,</span> <span class="n">commute_data</span><span class="o">=</span><span class="n">commute_data</span><span class="p">))</span>
</span><span id="Analyzer-1181"><a href="#Analyzer-1181"><span class="linenos">1181</span></a>                <span class="n">office_addrs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">office</span><span class="p">[</span><span class="s2">&quot;address&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="Analyzer-1182"><a href="#Analyzer-1182"><span class="linenos">1182</span></a>                <span class="n">value</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;commute_cost&#39;</span><span class="p">)</span>
</span><span id="Analyzer-1183"><a href="#Analyzer-1183"><span class="linenos">1183</span></a>                <span class="n">cost_values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">graphing</span><span class="o">.</span><span class="n">get_commute_values</span><span class="p">(</span><span class="n">emp_within</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">office</span><span class="p">,</span> <span class="n">commute_data</span><span class="p">,</span> <span class="n">value</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span>
</span><span id="Analyzer-1184"><a href="#Analyzer-1184"><span class="linenos">1184</span></a>                <span class="n">commutes</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">commute_days_per_week</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">commute_weeks_per_year</span>
</span><span id="Analyzer-1185"><a href="#Analyzer-1185"><span class="linenos">1185</span></a>                <span class="n">median_costs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">cost_values</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;commute_cost&#39;</span><span class="p">])</span><span class="o">*</span><span class="n">commutes</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
</span><span id="Analyzer-1186"><a href="#Analyzer-1186"><span class="linenos">1186</span></a>                <span class="n">average_costs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">cost_values</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;commute_cost&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">commutes</span><span class="p">),</span><span class="mi">2</span><span class="p">))</span>
</span><span id="Analyzer-1187"><a href="#Analyzer-1187"><span class="linenos">1187</span></a>                <span class="n">total_costs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">cost_values</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;commute_cost&#39;</span><span class="p">])</span><span class="o">*</span><span class="n">commutes</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
</span><span id="Analyzer-1188"><a href="#Analyzer-1188"><span class="linenos">1188</span></a>                <span class="n">min_costs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">cost_values</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;commute_cost&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">commutes</span><span class="p">),</span><span class="mi">2</span><span class="p">))</span>
</span><span id="Analyzer-1189"><a href="#Analyzer-1189"><span class="linenos">1189</span></a>                <span class="n">max_costs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">cost_values</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;commute_cost&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">commutes</span><span class="p">),</span><span class="mi">2</span><span class="p">))</span>
</span><span id="Analyzer-1190"><a href="#Analyzer-1190"><span class="linenos">1190</span></a>
</span><span id="Analyzer-1191"><a href="#Analyzer-1191"><span class="linenos">1191</span></a>
</span><span id="Analyzer-1192"><a href="#Analyzer-1192"><span class="linenos">1192</span></a>            <span class="c1"># calculate the bin list based upon a the max value of the data</span>
</span><span id="Analyzer-1193"><a href="#Analyzer-1193"><span class="linenos">1193</span></a>            <span class="c1">#binmax = int(max(cost_values[&#39;commute_cost&#39;])+1)</span>
</span><span id="Analyzer-1194"><a href="#Analyzer-1194"><span class="linenos">1194</span></a>            <span class="n">binmax</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Analyzer-1195"><a href="#Analyzer-1195"><span class="linenos">1195</span></a>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">cost_values</span><span class="p">)):</span>
</span><span id="Analyzer-1196"><a href="#Analyzer-1196"><span class="linenos">1196</span></a>                <span class="k">if</span> <span class="nb">max</span><span class="p">(</span><span class="n">cost_values</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;commute_cost&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="n">binmax</span><span class="p">:</span>
</span><span id="Analyzer-1197"><a href="#Analyzer-1197"><span class="linenos">1197</span></a>                    <span class="n">binmax</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">cost_values</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;commute_cost&#39;</span><span class="p">])</span>
</span><span id="Analyzer-1198"><a href="#Analyzer-1198"><span class="linenos">1198</span></a>            <span class="n">step</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="Analyzer-1199"><a href="#Analyzer-1199"><span class="linenos">1199</span></a>            <span class="c1"># round the binmax up to the nearest step</span>
</span><span id="Analyzer-1200"><a href="#Analyzer-1200"><span class="linenos">1200</span></a>            <span class="n">bins</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">binmax</span> <span class="o">+</span> <span class="n">step</span> <span class="o">-</span> <span class="p">(</span><span class="n">binmax</span> <span class="o">%</span> <span class="n">step</span><span class="p">)),</span> <span class="n">step</span><span class="p">)</span>
</span><span id="Analyzer-1201"><a href="#Analyzer-1201"><span class="linenos">1201</span></a>            <span class="n">plt</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graphing</span><span class="o">.</span><span class="n">get_histogram</span><span class="p">(</span><span class="n">emp</span><span class="p">,</span> <span class="n">offices</span><span class="p">,</span> <span class="n">commute_data</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">suptitle</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">cutoff_radius</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">commute_range_cut_off</span><span class="p">,</span>
</span><span id="Analyzer-1202"><a href="#Analyzer-1202"><span class="linenos">1202</span></a>                                      <span class="n">x_label</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="s1">&#39;\$ (USD), one-way, based on \$&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">mileage_rate</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39; per mile.&#39;</span><span class="p">),</span> <span class="n">y_label</span><span class="o">=</span><span class="s1">&#39;# Employees&#39;</span><span class="p">,</span>
</span><span id="Analyzer-1203"><a href="#Analyzer-1203"><span class="linenos">1203</span></a>                                      <span class="n">bins</span><span class="o">=</span><span class="n">bins</span><span class="p">,</span> <span class="n">rows</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">office_addrs</span><span class="p">),</span> <span class="n">cols</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">column_titles</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Commute Cost Analysis for Options&quot;</span><span class="p">],</span> 
</span><span id="Analyzer-1204"><a href="#Analyzer-1204"><span class="linenos">1204</span></a>                                      <span class="n">cumulative_line</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">font_mod</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">manual_plot</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="Analyzer-1205"><a href="#Analyzer-1205"><span class="linenos">1205</span></a>            
</span><span id="Analyzer-1206"><a href="#Analyzer-1206"><span class="linenos">1206</span></a>            <span class="c1"># manually add histograms for each office option</span>
</span><span id="Analyzer-1207"><a href="#Analyzer-1207"><span class="linenos">1207</span></a>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">emp_within</span><span class="p">)):</span>
</span><span id="Analyzer-1208"><a href="#Analyzer-1208"><span class="linenos">1208</span></a>                <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">cost_values</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;commute_cost&#39;</span><span class="p">],</span> <span class="n">bins</span><span class="o">=</span><span class="n">bins</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;#555555&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">align</span><span class="o">=</span><span class="s1">&#39;mid&#39;</span><span class="p">,</span> 
</span><span id="Analyzer-1209"><a href="#Analyzer-1209"><span class="linenos">1209</span></a>                           <span class="n">rwidth</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">office_addrs</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
</span><span id="Analyzer-1210"><a href="#Analyzer-1210"><span class="linenos">1210</span></a>                <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;major&#39;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
</span><span id="Analyzer-1211"><a href="#Analyzer-1211"><span class="linenos">1211</span></a>                
</span><span id="Analyzer-1212"><a href="#Analyzer-1212"><span class="linenos">1212</span></a>                <span class="c1"># add a legend to show the office options</span>
</span><span id="Analyzer-1213"><a href="#Analyzer-1213"><span class="linenos">1213</span></a>                <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper right&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
</span><span id="Analyzer-1214"><a href="#Analyzer-1214"><span class="linenos">1214</span></a>                
</span><span id="Analyzer-1215"><a href="#Analyzer-1215"><span class="linenos">1215</span></a>                <span class="c1"># add a text box with the stats, using two decimal places and adding commas at the thousands</span>
</span><span id="Analyzer-1216"><a href="#Analyzer-1216"><span class="linenos">1216</span></a>                <span class="n">t</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;me&#39;</span> <span class="p">:</span> <span class="s1">&#39;Median: |$</span><span class="si">{:,.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">median_costs</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span>
</span><span id="Analyzer-1217"><a href="#Analyzer-1217"><span class="linenos">1217</span></a>                    <span class="s1">&#39;av&#39;</span> <span class="p">:</span> <span class="s1">&#39;Average: |$</span><span class="si">{:,.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">average_costs</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span>
</span><span id="Analyzer-1218"><a href="#Analyzer-1218"><span class="linenos">1218</span></a>                    <span class="s1">&#39;mi&#39;</span> <span class="p">:</span> <span class="s1">&#39;Min: |$</span><span class="si">{:,.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">min_costs</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span>
</span><span id="Analyzer-1219"><a href="#Analyzer-1219"><span class="linenos">1219</span></a>                    <span class="s1">&#39;ma&#39;</span> <span class="p">:</span> <span class="s1">&#39;Max: |$</span><span class="si">{:,.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">max_costs</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span>
</span><span id="Analyzer-1220"><a href="#Analyzer-1220"><span class="linenos">1220</span></a>                    <span class="s1">&#39;to&#39;</span> <span class="p">:</span> <span class="s1">&#39;Total: |$</span><span class="si">{:,.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">total_costs</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</span><span id="Analyzer-1221"><a href="#Analyzer-1221"><span class="linenos">1221</span></a>                    <span class="p">}</span>             
</span><span id="Analyzer-1222"><a href="#Analyzer-1222"><span class="linenos">1222</span></a>                <span class="c1"># get the longest string value</span>
</span><span id="Analyzer-1223"><a href="#Analyzer-1223"><span class="linenos">1223</span></a>                <span class="n">max_len</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="s1">&#39;me&#39;</span><span class="p">]),</span><span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="s1">&#39;av&#39;</span><span class="p">]),</span><span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="s1">&#39;to&#39;</span><span class="p">]),</span><span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="s1">&#39;mi&#39;</span><span class="p">]),</span><span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="s1">&#39;ma&#39;</span><span class="p">]))</span>
</span><span id="Analyzer-1224"><a href="#Analyzer-1224"><span class="linenos">1224</span></a>                
</span><span id="Analyzer-1225"><a href="#Analyzer-1225"><span class="linenos">1225</span></a>                <span class="c1"># calculate how many narrow numbers/letters exist in the string, we need to add additional space for each</span>
</span><span id="Analyzer-1226"><a href="#Analyzer-1226"><span class="linenos">1226</span></a>                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">t</span><span class="p">:</span>
</span><span id="Analyzer-1227"><a href="#Analyzer-1227"><span class="linenos">1227</span></a>                    <span class="n">t</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">t</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">,</span><span class="s2">&quot; &quot;</span><span class="o">*</span><span class="p">(</span><span class="n">max_len</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="n">k</span><span class="p">])))</span>
</span><span id="Analyzer-1228"><a href="#Analyzer-1228"><span class="linenos">1228</span></a>
</span><span id="Analyzer-1229"><a href="#Analyzer-1229"><span class="linenos">1229</span></a>
</span><span id="Analyzer-1230"><a href="#Analyzer-1230"><span class="linenos">1230</span></a>                <span class="c1"># add spaces to make all the same length, replacing |</span>
</span><span id="Analyzer-1231"><a href="#Analyzer-1231"><span class="linenos">1231</span></a>                <span class="n">textstr</span> <span class="o">=</span> <span class="s2">&quot;Annualized Costs: &quot;</span>
</span><span id="Analyzer-1232"><a href="#Analyzer-1232"><span class="linenos">1232</span></a>                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">t</span><span class="p">:</span>
</span><span id="Analyzer-1233"><a href="#Analyzer-1233"><span class="linenos">1233</span></a>                    <span class="n">textstr</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">t</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
</span><span id="Analyzer-1234"><a href="#Analyzer-1234"><span class="linenos">1234</span></a>                <span class="c1"># these are matplotlib.patch.Patch properties</span>
</span><span id="Analyzer-1235"><a href="#Analyzer-1235"><span class="linenos">1235</span></a>                <span class="n">props</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">boxstyle</span><span class="o">=</span><span class="s1">&#39;round&#39;</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;wheat&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
</span><span id="Analyzer-1236"><a href="#Analyzer-1236"><span class="linenos">1236</span></a>                <span class="c1"># place a text box in upper right in axes coords, </span>
</span><span id="Analyzer-1237"><a href="#Analyzer-1237"><span class="linenos">1237</span></a>                <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">.95</span><span class="p">,</span> <span class="mf">.5</span><span class="p">,</span> <span class="n">textstr</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">,</span>
</span><span id="Analyzer-1238"><a href="#Analyzer-1238"><span class="linenos">1238</span></a>                            <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">bbox</span><span class="o">=</span><span class="n">props</span><span class="p">,</span> <span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;family&#39;</span><span class="p">:</span> <span class="s1">&#39;monospace&#39;</span><span class="p">},</span> <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">)</span>
</span><span id="Analyzer-1239"><a href="#Analyzer-1239"><span class="linenos">1239</span></a>                
</span><span id="Analyzer-1240"><a href="#Analyzer-1240"><span class="linenos">1240</span></a>            
</span><span id="Analyzer-1241"><a href="#Analyzer-1241"><span class="linenos">1241</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">(</span><span class="n">pad</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
</span><span id="Analyzer-1242"><a href="#Analyzer-1242"><span class="linenos">1242</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">plots_dir</span><span class="o">+</span><span class="s2">&quot;/&quot;</span><span class="o">+</span><span class="n">key</span><span class="o">+</span><span class="s2">&quot;.png&quot;</span><span class="p">)</span>
</span><span id="Analyzer-1243"><a href="#Analyzer-1243"><span class="linenos">1243</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="Analyzer-1244"><a href="#Analyzer-1244"><span class="linenos">1244</span></a>
</span><span id="Analyzer-1245"><a href="#Analyzer-1245"><span class="linenos">1245</span></a>            
</span><span id="Analyzer-1246"><a href="#Analyzer-1246"><span class="linenos">1246</span></a>            
</span><span id="Analyzer-1247"><a href="#Analyzer-1247"><span class="linenos">1247</span></a>        
</span><span id="Analyzer-1248"><a href="#Analyzer-1248"><span class="linenos">1248</span></a>        <span class="c1">################################################################################ </span>
</span><span id="Analyzer-1249"><a href="#Analyzer-1249"><span class="linenos">1249</span></a>        <span class="c1"># GRAPH: </span>
</span><span id="Analyzer-1250"><a href="#Analyzer-1250"><span class="linenos">1250</span></a>        <span class="c1">## Employee Commute Cost Differential Analysis</span>
</span><span id="Analyzer-1251"><a href="#Analyzer-1251"><span class="linenos">1251</span></a>        <span class="n">key</span> <span class="o">=</span> <span class="s1">&#39;eccda&#39;</span>
</span><span id="Analyzer-1252"><a href="#Analyzer-1252"><span class="linenos">1252</span></a>        <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;Employee Commute Cost Differential Analysis&quot;</span>
</span><span id="Analyzer-1253"><a href="#Analyzer-1253"><span class="linenos">1253</span></a>        <span class="n">short_title</span> <span class="o">=</span> <span class="n">title</span>
</span><span id="Analyzer-1254"><a href="#Analyzer-1254"><span class="linenos">1254</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">graph_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="p">{</span><span class="s2">&quot;GRAPH&quot;</span><span class="p">:</span> <span class="n">key</span><span class="p">,</span>
</span><span id="Analyzer-1255"><a href="#Analyzer-1255"><span class="linenos">1255</span></a>                                <span class="s2">&quot;TITLE&quot;</span><span class="p">:</span> <span class="n">short_title</span><span class="p">,</span>
</span><span id="Analyzer-1256"><a href="#Analyzer-1256"><span class="linenos">1256</span></a>                                <span class="s2">&quot;FILENAME&quot;</span><span class="p">:</span> <span class="n">key</span><span class="o">+</span><span class="s2">&quot;.png&quot;</span><span class="p">,</span>
</span><span id="Analyzer-1257"><a href="#Analyzer-1257"><span class="linenos">1257</span></a>                                <span class="s2">&quot;PLOT-DESCRIPTION&quot;</span><span class="p">:</span> <span class="s2">&quot;This graph displays the distribution of commute costs for employees within the &quot;</span> <span class="o">+</span> \
</span><span id="Analyzer-1258"><a href="#Analyzer-1258"><span class="linenos">1258</span></a>                                                    <span class="s2">&quot;cutoff distance of the office options. Changes in per-employee commute costs are shown for each office &quot;</span> <span class="o">+</span> \
</span><span id="Analyzer-1259"><a href="#Analyzer-1259"><span class="linenos">1259</span></a>                                                    <span class="s2">&quot;option relative to the existing office locaton.  This analysis inlcudes only per mile costs, not including tolls, etc.  &quot;</span> <span class="o">+</span> \
</span><span id="Analyzer-1260"><a href="#Analyzer-1260"><span class="linenos">1260</span></a>                                                    <span class="s2">&quot;Costs due to cash equivalent for time not included.&quot;</span>
</span><span id="Analyzer-1261"><a href="#Analyzer-1261"><span class="linenos">1261</span></a>                                <span class="p">})</span>
</span><span id="Analyzer-1262"><a href="#Analyzer-1262"><span class="linenos">1262</span></a>        
</span><span id="Analyzer-1263"><a href="#Analyzer-1263"><span class="linenos">1263</span></a>        <span class="k">if</span> <span class="n">graph</span> <span class="o">==</span> <span class="s2">&quot;_all&quot;</span> <span class="ow">or</span> <span class="n">graph</span> <span class="o">==</span> <span class="n">key</span><span class="p">:</span>
</span><span id="Analyzer-1264"><a href="#Analyzer-1264"><span class="linenos">1264</span></a>            <span class="c1"># get the value to plot</span>
</span><span id="Analyzer-1265"><a href="#Analyzer-1265"><span class="linenos">1265</span></a>            <span class="n">value</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Analyzer-1266"><a href="#Analyzer-1266"><span class="linenos">1266</span></a>            <span class="c1"># employees to analyze are within the cutoff distance for this office</span>
</span><span id="Analyzer-1267"><a href="#Analyzer-1267"><span class="linenos">1267</span></a>            <span class="c1"># for this analysis, we need to iterate through options</span>
</span><span id="Analyzer-1268"><a href="#Analyzer-1268"><span class="linenos">1268</span></a>            <span class="n">current_office</span> <span class="o">=</span> <span class="n">offices</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">to_frame</span><span class="p">()</span><span class="o">.</span><span class="n">T</span>
</span><span id="Analyzer-1269"><a href="#Analyzer-1269"><span class="linenos">1269</span></a>            <span class="n">other_offices</span> <span class="o">=</span> <span class="n">offices</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="Analyzer-1270"><a href="#Analyzer-1270"><span class="linenos">1270</span></a>            <span class="n">cost_values</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Analyzer-1271"><a href="#Analyzer-1271"><span class="linenos">1271</span></a>            <span class="n">withins</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Analyzer-1272"><a href="#Analyzer-1272"><span class="linenos">1272</span></a>            <span class="n">commutes</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">commute_days_per_week</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">commute_weeks_per_year</span>
</span><span id="Analyzer-1273"><a href="#Analyzer-1273"><span class="linenos">1273</span></a>            
</span><span id="Analyzer-1274"><a href="#Analyzer-1274"><span class="linenos">1274</span></a>            <span class="c1"># for each employee, calculate the commute cost to the current office, place a new dataframe with lat, long, office, and cost</span>
</span><span id="Analyzer-1275"><a href="#Analyzer-1275"><span class="linenos">1275</span></a>            <span class="c1"># if the employee is within the cutoff distance, if outside the cutoff distance, the cost is 0</span>
</span><span id="Analyzer-1276"><a href="#Analyzer-1276"><span class="linenos">1276</span></a>            <span class="c1"># start by looping through ALL employees and adding a row with the current office, and cost = 0</span>
</span><span id="Analyzer-1277"><a href="#Analyzer-1277"><span class="linenos">1277</span></a>                    
</span><span id="Analyzer-1278"><a href="#Analyzer-1278"><span class="linenos">1278</span></a>
</span><span id="Analyzer-1279"><a href="#Analyzer-1279"><span class="linenos">1279</span></a>            <span class="n">base_costs</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">get_base_cost_df</span><span class="p">(</span><span class="n">emp</span><span class="p">,</span> <span class="n">current_office</span><span class="p">[</span><span class="s1">&#39;address&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
</span><span id="Analyzer-1280"><a href="#Analyzer-1280"><span class="linenos">1280</span></a>            <span class="c1"># now get emp_within for the current office, and update the relevant rows of base_costs with actual costs for those employees </span>
</span><span id="Analyzer-1281"><a href="#Analyzer-1281"><span class="linenos">1281</span></a>            <span class="c1"># using the commute_cost column in the commute_data dataframe where the employee lat long matches the commute_data lat long and office address</span>
</span><span id="Analyzer-1282"><a href="#Analyzer-1282"><span class="linenos">1282</span></a>            
</span><span id="Analyzer-1283"><a href="#Analyzer-1283"><span class="linenos">1283</span></a>            <span class="n">base_emp_within</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graphing</span><span class="o">.</span><span class="n">filter_drive_distance</span><span class="p">(</span><span class="n">emp</span><span class="p">,</span><span class="n">current_office</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">commute_range_cut_off</span><span class="p">,</span> <span class="n">commute_data</span><span class="o">=</span><span class="n">commute_data</span><span class="p">)</span>
</span><span id="Analyzer-1284"><a href="#Analyzer-1284"><span class="linenos">1284</span></a>
</span><span id="Analyzer-1285"><a href="#Analyzer-1285"><span class="linenos">1285</span></a>            <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">base_emp_within</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
</span><span id="Analyzer-1286"><a href="#Analyzer-1286"><span class="linenos">1286</span></a>                <span class="c1"># get the cost from the commute_data</span>
</span><span id="Analyzer-1287"><a href="#Analyzer-1287"><span class="linenos">1287</span></a>                <span class="n">cost</span> <span class="o">=</span> <span class="n">commute_data</span><span class="p">[(</span><span class="n">commute_data</span><span class="p">[</span><span class="s1">&#39;origin_lat&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;latitude&#39;</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">commute_data</span><span class="p">[</span><span class="s1">&#39;origin_long&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;longitude&#39;</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">commute_data</span><span class="p">[</span><span class="s1">&#39;office_address&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">current_office</span><span class="p">[</span><span class="s1">&#39;address&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">])][</span><span class="s1">&#39;commute_cost&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="Analyzer-1288"><a href="#Analyzer-1288"><span class="linenos">1288</span></a>                <span class="n">base_costs</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">base_costs</span><span class="p">[</span><span class="s1">&#39;latitude&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;latitude&#39;</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">base_costs</span><span class="p">[</span><span class="s1">&#39;longitude&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;longitude&#39;</span><span class="p">]),</span><span class="s1">&#39;cost&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cost</span>
</span><span id="Analyzer-1289"><a href="#Analyzer-1289"><span class="linenos">1289</span></a>            <span class="c1"># now we have a dataframe with all employees, and the cost to the current office</span>
</span><span id="Analyzer-1290"><a href="#Analyzer-1290"><span class="linenos">1290</span></a>        
</span><span id="Analyzer-1291"><a href="#Analyzer-1291"><span class="linenos">1291</span></a>            <span class="c1"># now iterate through the other offices, get a base cost dataframe, and then update the relevant rows with actual costs, place in cost_values</span>
</span><span id="Analyzer-1292"><a href="#Analyzer-1292"><span class="linenos">1292</span></a>            <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">other_offices</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
</span><span id="Analyzer-1293"><a href="#Analyzer-1293"><span class="linenos">1293</span></a>                <span class="n">office</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">to_frame</span><span class="p">()</span><span class="o">.</span><span class="n">T</span>
</span><span id="Analyzer-1294"><a href="#Analyzer-1294"><span class="linenos">1294</span></a>                <span class="n">tmp_costs</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">get_base_cost_df</span><span class="p">(</span><span class="n">emp</span><span class="p">,</span> <span class="n">office</span><span class="p">[</span><span class="s1">&#39;address&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
</span><span id="Analyzer-1295"><a href="#Analyzer-1295"><span class="linenos">1295</span></a>                <span class="n">emp_within</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graphing</span><span class="o">.</span><span class="n">filter_drive_distance</span><span class="p">(</span><span class="n">emp</span><span class="p">,</span><span class="n">office</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">commute_range_cut_off</span><span class="p">,</span> <span class="n">commute_data</span><span class="o">=</span><span class="n">commute_data</span><span class="p">)</span>
</span><span id="Analyzer-1296"><a href="#Analyzer-1296"><span class="linenos">1296</span></a>                <span class="c1"># we will use this later to get the differential for each employee, without the employees that aren&#39;t overlapping</span>
</span><span id="Analyzer-1297"><a href="#Analyzer-1297"><span class="linenos">1297</span></a>                <span class="n">withins</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">emp_within</span><span class="p">)</span>
</span><span id="Analyzer-1298"><a href="#Analyzer-1298"><span class="linenos">1298</span></a>                <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">emp_within</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
</span><span id="Analyzer-1299"><a href="#Analyzer-1299"><span class="linenos">1299</span></a>                    <span class="c1"># get the cost from the commute_data</span>
</span><span id="Analyzer-1300"><a href="#Analyzer-1300"><span class="linenos">1300</span></a>                    <span class="n">cost</span> <span class="o">=</span> <span class="n">commute_data</span><span class="p">[(</span><span class="n">commute_data</span><span class="p">[</span><span class="s1">&#39;origin_lat&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;latitude&#39;</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">commute_data</span><span class="p">[</span><span class="s1">&#39;origin_long&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;longitude&#39;</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">commute_data</span><span class="p">[</span><span class="s1">&#39;office_address&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">office</span><span class="p">[</span><span class="s1">&#39;address&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">])][</span><span class="s1">&#39;commute_cost&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="Analyzer-1301"><a href="#Analyzer-1301"><span class="linenos">1301</span></a>                    <span class="n">tmp_costs</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">tmp_costs</span><span class="p">[</span><span class="s1">&#39;latitude&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;latitude&#39;</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">tmp_costs</span><span class="p">[</span><span class="s1">&#39;longitude&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;longitude&#39;</span><span class="p">]),</span><span class="s1">&#39;cost&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cost</span>
</span><span id="Analyzer-1302"><a href="#Analyzer-1302"><span class="linenos">1302</span></a>                <span class="n">cost_values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tmp_costs</span><span class="p">)</span>
</span><span id="Analyzer-1303"><a href="#Analyzer-1303"><span class="linenos">1303</span></a>            
</span><span id="Analyzer-1304"><a href="#Analyzer-1304"><span class="linenos">1304</span></a>            <span class="c1"># now we have a full list of costs for each employee to each office, we can get the differentials</span>
</span><span id="Analyzer-1305"><a href="#Analyzer-1305"><span class="linenos">1305</span></a>            <span class="c1"># create a list to hold the differential dataframes</span>
</span><span id="Analyzer-1306"><a href="#Analyzer-1306"><span class="linenos">1306</span></a>            <span class="n">diffs</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Analyzer-1307"><a href="#Analyzer-1307"><span class="linenos">1307</span></a>            <span class="c1"># for each cost dataframe, calculate the differential from the base_costs dataframe into a new dataframe</span>
</span><span id="Analyzer-1308"><a href="#Analyzer-1308"><span class="linenos">1308</span></a>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">cost_values</span><span class="p">)):</span>
</span><span id="Analyzer-1309"><a href="#Analyzer-1309"><span class="linenos">1309</span></a>                <span class="c1"># get the differential</span>
</span><span id="Analyzer-1310"><a href="#Analyzer-1310"><span class="linenos">1310</span></a>                <span class="n">diffs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cost_values</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;cost&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">base_costs</span><span class="p">[</span><span class="s1">&#39;cost&#39;</span><span class="p">])</span>
</span><span id="Analyzer-1311"><a href="#Analyzer-1311"><span class="linenos">1311</span></a>            <span class="c1"># now we have a list of dataframes with the differentials, we eliminate all rows with 0 cost differential to prevent skewing the histogram</span>
</span><span id="Analyzer-1312"><a href="#Analyzer-1312"><span class="linenos">1312</span></a>            <span class="c1"># calculate the bin list based upon a the min (negative) and max (positive) values of the data     </span>
</span><span id="Analyzer-1313"><a href="#Analyzer-1313"><span class="linenos">1313</span></a>            <span class="n">binmin</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Analyzer-1314"><a href="#Analyzer-1314"><span class="linenos">1314</span></a>            <span class="n">binmax</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Analyzer-1315"><a href="#Analyzer-1315"><span class="linenos">1315</span></a>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">diffs</span><span class="p">)):</span>
</span><span id="Analyzer-1316"><a href="#Analyzer-1316"><span class="linenos">1316</span></a>                <span class="k">if</span> <span class="nb">min</span><span class="p">(</span><span class="n">diffs</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">&lt;</span> <span class="n">binmin</span><span class="p">:</span>
</span><span id="Analyzer-1317"><a href="#Analyzer-1317"><span class="linenos">1317</span></a>                    <span class="n">binmin</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">diffs</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</span><span id="Analyzer-1318"><a href="#Analyzer-1318"><span class="linenos">1318</span></a>                <span class="k">if</span> <span class="nb">max</span><span class="p">(</span><span class="n">diffs</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">&gt;</span> <span class="n">binmax</span><span class="p">:</span>
</span><span id="Analyzer-1319"><a href="#Analyzer-1319"><span class="linenos">1319</span></a>                    <span class="n">binmax</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">diffs</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</span><span id="Analyzer-1320"><a href="#Analyzer-1320"><span class="linenos">1320</span></a>            <span class="n">step</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="Analyzer-1321"><a href="#Analyzer-1321"><span class="linenos">1321</span></a>            <span class="c1"># round the binmin down to the nearest step, max up to the nearest step</span>
</span><span id="Analyzer-1322"><a href="#Analyzer-1322"><span class="linenos">1322</span></a>            <span class="n">bins</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">binmin</span> <span class="o">-</span> <span class="p">(</span><span class="n">binmin</span> <span class="o">%</span> <span class="n">step</span><span class="p">)),</span> <span class="nb">int</span><span class="p">(</span><span class="n">binmax</span> <span class="o">+</span> <span class="n">step</span> <span class="o">-</span> <span class="p">(</span><span class="n">binmax</span> <span class="o">%</span> <span class="n">step</span><span class="p">)),</span> <span class="n">step</span><span class="p">)</span>
</span><span id="Analyzer-1323"><a href="#Analyzer-1323"><span class="linenos">1323</span></a>
</span><span id="Analyzer-1324"><a href="#Analyzer-1324"><span class="linenos">1324</span></a>            <span class="n">plt</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graphing</span><span class="o">.</span><span class="n">get_histogram</span><span class="p">(</span><span class="n">emp</span><span class="p">,</span> <span class="n">other_offices</span><span class="p">,</span> <span class="n">commute_data</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">suptitle</span><span class="o">=</span><span class="s2">&quot;Employee Commute Cost Differential Analysis&quot;</span><span class="p">,</span> <span class="n">cutoff_radius</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">commute_range_cut_off</span><span class="p">,</span>
</span><span id="Analyzer-1325"><a href="#Analyzer-1325"><span class="linenos">1325</span></a>                                      <span class="n">x_label</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="s1">&#39;\$ (USD) based on \$&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">mileage_rate</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39; per mile.&#39;</span><span class="p">),</span> <span class="n">y_label</span><span class="o">=</span><span class="s1">&#39;# Employees (log scale)&#39;</span><span class="p">,</span>
</span><span id="Analyzer-1326"><a href="#Analyzer-1326"><span class="linenos">1326</span></a>                                      <span class="n">bins</span><span class="o">=</span><span class="n">bins</span><span class="p">,</span> <span class="n">rows</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">other_offices</span><span class="p">),</span> <span class="n">cols</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">column_titles</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Employee Commute Cost Differential Analysis&quot;</span><span class="p">],</span> 
</span><span id="Analyzer-1327"><a href="#Analyzer-1327"><span class="linenos">1327</span></a>                                      <span class="n">cumulative_line</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">font_mod</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">manual_plot</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="Analyzer-1328"><a href="#Analyzer-1328"><span class="linenos">1328</span></a>            
</span><span id="Analyzer-1329"><a href="#Analyzer-1329"><span class="linenos">1329</span></a>            <span class="c1"># manually add histograms for each office option</span>
</span><span id="Analyzer-1330"><a href="#Analyzer-1330"><span class="linenos">1330</span></a>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">diffs</span><span class="p">)):</span>
</span><span id="Analyzer-1331"><a href="#Analyzer-1331"><span class="linenos">1331</span></a>                <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">diffs</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">bins</span><span class="o">=</span><span class="n">bins</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;#555555&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">align</span><span class="o">=</span><span class="s1">&#39;mid&#39;</span><span class="p">,</span> 
</span><span id="Analyzer-1332"><a href="#Analyzer-1332"><span class="linenos">1332</span></a>                           <span class="n">rwidth</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">other_offices</span><span class="p">[</span><span class="s1">&#39;address&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>
</span><span id="Analyzer-1333"><a href="#Analyzer-1333"><span class="linenos">1333</span></a>                <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;major&#39;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
</span><span id="Analyzer-1334"><a href="#Analyzer-1334"><span class="linenos">1334</span></a>                
</span><span id="Analyzer-1335"><a href="#Analyzer-1335"><span class="linenos">1335</span></a>                <span class="c1"># add a legend to show the office options</span>
</span><span id="Analyzer-1336"><a href="#Analyzer-1336"><span class="linenos">1336</span></a>                <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper right&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
</span><span id="Analyzer-1337"><a href="#Analyzer-1337"><span class="linenos">1337</span></a>                
</span><span id="Analyzer-1338"><a href="#Analyzer-1338"><span class="linenos">1338</span></a>                <span class="c1"># add a text box with the stats, using two decimal places and adding commas at the thousands</span>
</span><span id="Analyzer-1339"><a href="#Analyzer-1339"><span class="linenos">1339</span></a>                <span class="n">t</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;me&#39;</span> <span class="p">:</span> <span class="s1">&#39;Median: |$</span><span class="si">{:,.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">diffs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">commutes</span><span class="p">)),</span>
</span><span id="Analyzer-1340"><a href="#Analyzer-1340"><span class="linenos">1340</span></a>                    <span class="s1">&#39;av&#39;</span> <span class="p">:</span> <span class="s1">&#39;Average: |$</span><span class="si">{:,.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">diffs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">commutes</span><span class="p">)),</span>
</span><span id="Analyzer-1341"><a href="#Analyzer-1341"><span class="linenos">1341</span></a>                    <span class="s1">&#39;mi&#39;</span> <span class="p">:</span> <span class="s1">&#39;Min: |$</span><span class="si">{:,.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">diffs</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">*</span><span class="n">commutes</span><span class="p">),</span>
</span><span id="Analyzer-1342"><a href="#Analyzer-1342"><span class="linenos">1342</span></a>                    <span class="s1">&#39;ma&#39;</span> <span class="p">:</span> <span class="s1">&#39;Max: |$</span><span class="si">{:,.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">diffs</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">*</span><span class="n">commutes</span><span class="p">),</span>
</span><span id="Analyzer-1343"><a href="#Analyzer-1343"><span class="linenos">1343</span></a>                    <span class="s1">&#39;to&#39;</span> <span class="p">:</span> <span class="s1">&#39;Total: |$</span><span class="si">{:,.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">diffs</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">*</span><span class="n">commutes</span><span class="p">)</span>
</span><span id="Analyzer-1344"><a href="#Analyzer-1344"><span class="linenos">1344</span></a>                    <span class="p">}</span>             
</span><span id="Analyzer-1345"><a href="#Analyzer-1345"><span class="linenos">1345</span></a>                <span class="c1"># get the longest string value</span>
</span><span id="Analyzer-1346"><a href="#Analyzer-1346"><span class="linenos">1346</span></a>                <span class="n">max_len</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="s1">&#39;me&#39;</span><span class="p">]),</span><span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="s1">&#39;av&#39;</span><span class="p">]),</span><span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="s1">&#39;to&#39;</span><span class="p">]),</span><span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="s1">&#39;mi&#39;</span><span class="p">]),</span><span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="s1">&#39;ma&#39;</span><span class="p">]))</span>
</span><span id="Analyzer-1347"><a href="#Analyzer-1347"><span class="linenos">1347</span></a>                
</span><span id="Analyzer-1348"><a href="#Analyzer-1348"><span class="linenos">1348</span></a>                <span class="c1"># calculate additional space</span>
</span><span id="Analyzer-1349"><a href="#Analyzer-1349"><span class="linenos">1349</span></a>                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">t</span><span class="p">:</span>
</span><span id="Analyzer-1350"><a href="#Analyzer-1350"><span class="linenos">1350</span></a>                    <span class="n">t</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">t</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">,</span><span class="s2">&quot; &quot;</span><span class="o">*</span><span class="p">(</span><span class="n">max_len</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="n">k</span><span class="p">])))</span>
</span><span id="Analyzer-1351"><a href="#Analyzer-1351"><span class="linenos">1351</span></a>
</span><span id="Analyzer-1352"><a href="#Analyzer-1352"><span class="linenos">1352</span></a>
</span><span id="Analyzer-1353"><a href="#Analyzer-1353"><span class="linenos">1353</span></a>                <span class="c1"># add spaces to make all the same length, replacing |</span>
</span><span id="Analyzer-1354"><a href="#Analyzer-1354"><span class="linenos">1354</span></a>                <span class="n">textstr</span> <span class="o">=</span> <span class="s2">&quot;Annualized </span><span class="se">\n</span><span class="s2">Differentials: &quot;</span>
</span><span id="Analyzer-1355"><a href="#Analyzer-1355"><span class="linenos">1355</span></a>                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">t</span><span class="p">:</span>
</span><span id="Analyzer-1356"><a href="#Analyzer-1356"><span class="linenos">1356</span></a>                    <span class="n">textstr</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">t</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
</span><span id="Analyzer-1357"><a href="#Analyzer-1357"><span class="linenos">1357</span></a>                <span class="c1"># these are matplotlib.patch.Patch properties</span>
</span><span id="Analyzer-1358"><a href="#Analyzer-1358"><span class="linenos">1358</span></a>                <span class="n">props</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">boxstyle</span><span class="o">=</span><span class="s1">&#39;round&#39;</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;wheat&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
</span><span id="Analyzer-1359"><a href="#Analyzer-1359"><span class="linenos">1359</span></a>                <span class="c1"># place a text box in upper left in axes coords, </span>
</span><span id="Analyzer-1360"><a href="#Analyzer-1360"><span class="linenos">1360</span></a>                <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">.05</span><span class="p">,</span> <span class="mf">.75</span><span class="p">,</span> <span class="n">textstr</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">,</span>
</span><span id="Analyzer-1361"><a href="#Analyzer-1361"><span class="linenos">1361</span></a>                            <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">bbox</span><span class="o">=</span><span class="n">props</span><span class="p">,</span> <span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;family&#39;</span><span class="p">:</span> <span class="s1">&#39;monospace&#39;</span><span class="p">},</span> <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">)</span>
</span><span id="Analyzer-1362"><a href="#Analyzer-1362"><span class="linenos">1362</span></a>                
</span><span id="Analyzer-1363"><a href="#Analyzer-1363"><span class="linenos">1363</span></a>                <span class="c1"># now, take the base_cost and the cost_values[i] and get the differential for each employee omitting </span>
</span><span id="Analyzer-1364"><a href="#Analyzer-1364"><span class="linenos">1364</span></a>                <span class="c1"># any employees that are zero cost in one, and not zero cost in the other</span>
</span><span id="Analyzer-1365"><a href="#Analyzer-1365"><span class="linenos">1365</span></a>                <span class="c1"># this will omit those employees who rotated to/from remote work status as a result of the move.</span>
</span><span id="Analyzer-1366"><a href="#Analyzer-1366"><span class="linenos">1366</span></a>                <span class="n">mask</span> <span class="o">=</span> <span class="p">(</span><span class="n">cost_values</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;cost&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">base_costs</span><span class="p">[</span><span class="s1">&#39;cost&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="Analyzer-1367"><a href="#Analyzer-1367"><span class="linenos">1367</span></a>                <span class="n">differences</span> <span class="o">=</span> <span class="p">(</span><span class="n">cost_values</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;cost&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">base_costs</span><span class="p">[</span><span class="s1">&#39;cost&#39;</span><span class="p">])[</span><span class="n">mask</span><span class="p">]</span>
</span><span id="Analyzer-1368"><a href="#Analyzer-1368"><span class="linenos">1368</span></a>                
</span><span id="Analyzer-1369"><a href="#Analyzer-1369"><span class="linenos">1369</span></a>                <span class="c1"># Convert differences to a list and store in diffs</span>
</span><span id="Analyzer-1370"><a href="#Analyzer-1370"><span class="linenos">1370</span></a>                <span class="n">diffs2</span> <span class="o">=</span> <span class="n">differences</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
</span><span id="Analyzer-1371"><a href="#Analyzer-1371"><span class="linenos">1371</span></a>
</span><span id="Analyzer-1372"><a href="#Analyzer-1372"><span class="linenos">1372</span></a>                <span class="c1"># get the differential</span>
</span><span id="Analyzer-1373"><a href="#Analyzer-1373"><span class="linenos">1373</span></a>                <span class="c1"># get the stats</span>
</span><span id="Analyzer-1374"><a href="#Analyzer-1374"><span class="linenos">1374</span></a>                <span class="n">median</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">diffs2</span><span class="p">)</span><span class="o">*</span><span class="n">commutes</span>
</span><span id="Analyzer-1375"><a href="#Analyzer-1375"><span class="linenos">1375</span></a>                <span class="n">average</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">diffs2</span><span class="p">)</span><span class="o">*</span><span class="n">commutes</span>
</span><span id="Analyzer-1376"><a href="#Analyzer-1376"><span class="linenos">1376</span></a>                <span class="n">minimum</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">diffs2</span><span class="p">)</span><span class="o">*</span><span class="n">commutes</span>
</span><span id="Analyzer-1377"><a href="#Analyzer-1377"><span class="linenos">1377</span></a>                <span class="n">maximum</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">diffs2</span><span class="p">)</span><span class="o">*</span><span class="n">commutes</span>
</span><span id="Analyzer-1378"><a href="#Analyzer-1378"><span class="linenos">1378</span></a>                <span class="n">total</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">diffs2</span><span class="p">)</span><span class="o">*</span><span class="n">commutes</span>
</span><span id="Analyzer-1379"><a href="#Analyzer-1379"><span class="linenos">1379</span></a>               
</span><span id="Analyzer-1380"><a href="#Analyzer-1380"><span class="linenos">1380</span></a>                <span class="c1"># add a text box with the stats, using two decimal places and adding commas at the thousands</span>
</span><span id="Analyzer-1381"><a href="#Analyzer-1381"><span class="linenos">1381</span></a>                <span class="n">t</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;me&#39;</span> <span class="p">:</span> <span class="s1">&#39;Median: |$</span><span class="si">{:,.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">median</span><span class="p">),</span>
</span><span id="Analyzer-1382"><a href="#Analyzer-1382"><span class="linenos">1382</span></a>                    <span class="s1">&#39;av&#39;</span> <span class="p">:</span> <span class="s1">&#39;Average: |$</span><span class="si">{:,.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">average</span><span class="p">),</span>
</span><span id="Analyzer-1383"><a href="#Analyzer-1383"><span class="linenos">1383</span></a>                    <span class="s1">&#39;mi&#39;</span> <span class="p">:</span> <span class="s1">&#39;Min: |$</span><span class="si">{:,.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">minimum</span><span class="p">),</span>
</span><span id="Analyzer-1384"><a href="#Analyzer-1384"><span class="linenos">1384</span></a>                    <span class="s1">&#39;ma&#39;</span> <span class="p">:</span> <span class="s1">&#39;Max: |$</span><span class="si">{:,.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">maximum</span><span class="p">),</span>
</span><span id="Analyzer-1385"><a href="#Analyzer-1385"><span class="linenos">1385</span></a>                    <span class="s1">&#39;to&#39;</span> <span class="p">:</span> <span class="s1">&#39;Total: |$</span><span class="si">{:,.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">total</span><span class="p">)</span>
</span><span id="Analyzer-1386"><a href="#Analyzer-1386"><span class="linenos">1386</span></a>                    <span class="p">}</span>
</span><span id="Analyzer-1387"><a href="#Analyzer-1387"><span class="linenos">1387</span></a>                
</span><span id="Analyzer-1388"><a href="#Analyzer-1388"><span class="linenos">1388</span></a>                <span class="c1"># get the longest string value</span>
</span><span id="Analyzer-1389"><a href="#Analyzer-1389"><span class="linenos">1389</span></a>                <span class="n">max_len</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="s1">&#39;me&#39;</span><span class="p">]),</span><span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="s1">&#39;av&#39;</span><span class="p">]),</span><span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="s1">&#39;to&#39;</span><span class="p">]),</span><span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="s1">&#39;mi&#39;</span><span class="p">]),</span><span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="s1">&#39;ma&#39;</span><span class="p">]))</span>
</span><span id="Analyzer-1390"><a href="#Analyzer-1390"><span class="linenos">1390</span></a>                <span class="c1"># calculate how many narrow numbers/letters exist in the string, we need to add additional space for each</span>
</span><span id="Analyzer-1391"><a href="#Analyzer-1391"><span class="linenos">1391</span></a>                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">t</span><span class="p">:</span>
</span><span id="Analyzer-1392"><a href="#Analyzer-1392"><span class="linenos">1392</span></a>                    <span class="n">t</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">t</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">,</span><span class="s2">&quot; &quot;</span><span class="o">*</span><span class="p">(</span><span class="n">max_len</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="n">k</span><span class="p">])))</span>
</span><span id="Analyzer-1393"><a href="#Analyzer-1393"><span class="linenos">1393</span></a>                <span class="c1"># add spaces to make all the same length, replacing |</span>
</span><span id="Analyzer-1394"><a href="#Analyzer-1394"><span class="linenos">1394</span></a>                <span class="n">textstr</span> <span class="o">=</span> <span class="s2">&quot;Annualized Differentials omitting </span><span class="se">\n</span><span class="s2"> Employees Rotating to/from Remote Work: &quot;</span>
</span><span id="Analyzer-1395"><a href="#Analyzer-1395"><span class="linenos">1395</span></a>                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">t</span><span class="p">:</span>
</span><span id="Analyzer-1396"><a href="#Analyzer-1396"><span class="linenos">1396</span></a>                    <span class="n">textstr</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">t</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
</span><span id="Analyzer-1397"><a href="#Analyzer-1397"><span class="linenos">1397</span></a>                <span class="c1"># place a text box in upper right in axes coords, </span>
</span><span id="Analyzer-1398"><a href="#Analyzer-1398"><span class="linenos">1398</span></a>                <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">.95</span><span class="p">,</span> <span class="mf">.75</span><span class="p">,</span> <span class="n">textstr</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">,</span>
</span><span id="Analyzer-1399"><a href="#Analyzer-1399"><span class="linenos">1399</span></a>                            <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">bbox</span><span class="o">=</span><span class="n">props</span><span class="p">,</span> <span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;family&#39;</span><span class="p">:</span> <span class="s1">&#39;monospace&#39;</span><span class="p">},</span> <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">)</span>
</span><span id="Analyzer-1400"><a href="#Analyzer-1400"><span class="linenos">1400</span></a>                
</span><span id="Analyzer-1401"><a href="#Analyzer-1401"><span class="linenos">1401</span></a>
</span><span id="Analyzer-1402"><a href="#Analyzer-1402"><span class="linenos">1402</span></a>                <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
</span><span id="Analyzer-1403"><a href="#Analyzer-1403"><span class="linenos">1403</span></a>
</span><span id="Analyzer-1404"><a href="#Analyzer-1404"><span class="linenos">1404</span></a>
</span><span id="Analyzer-1405"><a href="#Analyzer-1405"><span class="linenos">1405</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">(</span><span class="n">pad</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
</span><span id="Analyzer-1406"><a href="#Analyzer-1406"><span class="linenos">1406</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">plots_dir</span><span class="o">+</span><span class="s2">&quot;/&quot;</span><span class="o">+</span><span class="n">key</span><span class="o">+</span><span class="s2">&quot;.png&quot;</span><span class="p">)</span>
</span><span id="Analyzer-1407"><a href="#Analyzer-1407"><span class="linenos">1407</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="Analyzer-1408"><a href="#Analyzer-1408"><span class="linenos">1408</span></a>            
</span><span id="Analyzer-1409"><a href="#Analyzer-1409"><span class="linenos">1409</span></a>        
</span><span id="Analyzer-1410"><a href="#Analyzer-1410"><span class="linenos">1410</span></a>
</span><span id="Analyzer-1411"><a href="#Analyzer-1411"><span class="linenos">1411</span></a>        <span class="c1">################################################################################</span>
</span><span id="Analyzer-1412"><a href="#Analyzer-1412"><span class="linenos">1412</span></a>        <span class="c1">### GRAPH SET: Local Analysis for Office X</span>
</span><span id="Analyzer-1413"><a href="#Analyzer-1413"><span class="linenos">1413</span></a>        <span class="c1"># iterate through offices, generate a graph for each office</span>
</span><span id="Analyzer-1414"><a href="#Analyzer-1414"><span class="linenos">1414</span></a>        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">offices</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>  
</span><span id="Analyzer-1415"><a href="#Analyzer-1415"><span class="linenos">1415</span></a>        <span class="c1">################################################################################ </span>
</span><span id="Analyzer-1416"><a href="#Analyzer-1416"><span class="linenos">1416</span></a>            <span class="c1"># GRAPH: </span>
</span><span id="Analyzer-1417"><a href="#Analyzer-1417"><span class="linenos">1417</span></a>            <span class="c1">## Weekly Commute Duration Analysis</span>
</span><span id="Analyzer-1418"><a href="#Analyzer-1418"><span class="linenos">1418</span></a>            <span class="n">key</span> <span class="o">=</span> <span class="s1">&#39;wcda&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
</span><span id="Analyzer-1419"><a href="#Analyzer-1419"><span class="linenos">1419</span></a>            <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;Weekly Commute Duration Analysis &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;address&quot;</span><span class="p">])</span>
</span><span id="Analyzer-1420"><a href="#Analyzer-1420"><span class="linenos">1420</span></a>            <span class="n">short_title</span> <span class="o">=</span> <span class="n">title</span>
</span><span id="Analyzer-1421"><a href="#Analyzer-1421"><span class="linenos">1421</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">graph_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="p">{</span><span class="s2">&quot;GRAPH&quot;</span><span class="p">:</span> <span class="n">key</span><span class="p">,</span>
</span><span id="Analyzer-1422"><a href="#Analyzer-1422"><span class="linenos">1422</span></a>                                    <span class="s2">&quot;TITLE&quot;</span><span class="p">:</span> <span class="n">short_title</span><span class="p">,</span>
</span><span id="Analyzer-1423"><a href="#Analyzer-1423"><span class="linenos">1423</span></a>                                    <span class="s2">&quot;FILENAME&quot;</span><span class="p">:</span> <span class="n">key</span><span class="o">+</span><span class="s2">&quot;.png&quot;</span><span class="p">,</span>
</span><span id="Analyzer-1424"><a href="#Analyzer-1424"><span class="linenos">1424</span></a>                                    <span class="s2">&quot;PLOT-DESCRIPTION&quot;</span><span class="p">:</span>  <span class="s2">&quot;This graph displays the the morning and evening commute durations for employees within the &quot;</span> <span class="o">+</span> \
</span><span id="Analyzer-1425"><a href="#Analyzer-1425"><span class="linenos">1425</span></a>                                                        <span class="s2">&quot;cutoff distance of the current office.  The analysis is broken down by day of the week, &quot;</span> <span class="o">+</span> \
</span><span id="Analyzer-1426"><a href="#Analyzer-1426"><span class="linenos">1426</span></a>                                                        <span class="s2">&quot;and the distribution of commute times is shown for each day.  The commute times are based on &quot;</span> <span class="o">+</span> \
</span><span id="Analyzer-1427"><a href="#Analyzer-1427"><span class="linenos">1427</span></a>                                                        <span class="s2">&quot;the commute data derived based on traffic conditions, and are in minutes. The analysis is specific &quot;</span> <span class="o">+</span> \
</span><span id="Analyzer-1428"><a href="#Analyzer-1428"><span class="linenos">1428</span></a>                                                        <span class="s2">&quot;to the office at &quot;</span><span class="o">+</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;address&quot;</span><span class="p">]</span><span class="o">+</span><span class="s2">&quot;.&quot;</span>
</span><span id="Analyzer-1429"><a href="#Analyzer-1429"><span class="linenos">1429</span></a>                                    <span class="p">})</span>
</span><span id="Analyzer-1430"><a href="#Analyzer-1430"><span class="linenos">1430</span></a>            
</span><span id="Analyzer-1431"><a href="#Analyzer-1431"><span class="linenos">1431</span></a>            <span class="k">if</span> <span class="n">graph</span> <span class="o">==</span> <span class="s2">&quot;_all&quot;</span> <span class="ow">or</span> <span class="n">graph</span> <span class="o">==</span> <span class="n">key</span><span class="p">:</span>
</span><span id="Analyzer-1432"><a href="#Analyzer-1432"><span class="linenos">1432</span></a>                <span class="c1"># only calculate for the first office, the current office</span>
</span><span id="Analyzer-1433"><a href="#Analyzer-1433"><span class="linenos">1433</span></a>                <span class="c1">#office = offices.iloc[0].to_frame().T</span>
</span><span id="Analyzer-1434"><a href="#Analyzer-1434"><span class="linenos">1434</span></a>                <span class="n">office</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">to_frame</span><span class="p">()</span><span class="o">.</span><span class="n">T</span>
</span><span id="Analyzer-1435"><a href="#Analyzer-1435"><span class="linenos">1435</span></a>                <span class="n">values</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;m_morning_duration_in_traffic&#39;</span><span class="p">,</span><span class="s1">&#39;m_evening_duration_in_traffic&#39;</span><span class="p">,</span>
</span><span id="Analyzer-1436"><a href="#Analyzer-1436"><span class="linenos">1436</span></a>                        <span class="s1">&#39;t_morning_duration_in_traffic&#39;</span><span class="p">,</span><span class="s1">&#39;t_evening_duration_in_traffic&#39;</span><span class="p">,</span>
</span><span id="Analyzer-1437"><a href="#Analyzer-1437"><span class="linenos">1437</span></a>                        <span class="s1">&#39;w_morning_duration_in_traffic&#39;</span><span class="p">,</span><span class="s1">&#39;w_evening_duration_in_traffic&#39;</span><span class="p">,</span>
</span><span id="Analyzer-1438"><a href="#Analyzer-1438"><span class="linenos">1438</span></a>                        <span class="s1">&#39;h_morning_duration_in_traffic&#39;</span><span class="p">,</span><span class="s1">&#39;h_evening_duration_in_traffic&#39;</span><span class="p">,</span>
</span><span id="Analyzer-1439"><a href="#Analyzer-1439"><span class="linenos">1439</span></a>                        <span class="s1">&#39;f_morning_duration_in_traffic&#39;</span><span class="p">,</span><span class="s1">&#39;f_evening_duration_in_traffic&#39;</span><span class="p">]</span>
</span><span id="Analyzer-1440"><a href="#Analyzer-1440"><span class="linenos">1440</span></a>                <span class="n">cumulative_markers</span> <span class="o">=</span> <span class="p">{</span><span class="mi">50</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;purple&#39;</span><span class="p">,</span> <span class="s1">&#39;marker&#39;</span><span class="p">:</span> <span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="s1">&#39;50%&#39;</span><span class="p">,</span> <span class="s1">&#39;linestyle&#39;</span><span class="p">:</span> <span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="s1">&#39;linewidth&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">},</span>
</span><span id="Analyzer-1441"><a href="#Analyzer-1441"><span class="linenos">1441</span></a>                                    <span class="mi">75</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="s1">&#39;marker&#39;</span><span class="p">:</span> <span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="s1">&#39;75%&#39;</span><span class="p">,</span> <span class="s1">&#39;linestyle&#39;</span><span class="p">:</span> <span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="s1">&#39;linewidth&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">},}</span>
</span><span id="Analyzer-1442"><a href="#Analyzer-1442"><span class="linenos">1442</span></a>                <span class="c1"># calculate teh bins based on the max value of the data</span>
</span><span id="Analyzer-1443"><a href="#Analyzer-1443"><span class="linenos">1443</span></a>                <span class="n">binmax</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Analyzer-1444"><a href="#Analyzer-1444"><span class="linenos">1444</span></a>                <span class="n">emp_within</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graphing</span><span class="o">.</span><span class="n">filter_drive_distance</span><span class="p">(</span><span class="n">emp</span><span class="p">,</span><span class="n">office</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">commute_range_cut_off</span><span class="p">,</span> <span class="n">commute_data</span><span class="o">=</span><span class="n">commute_data</span><span class="p">)</span>
</span><span id="Analyzer-1445"><a href="#Analyzer-1445"><span class="linenos">1445</span></a>                <span class="n">val_set</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graphing</span><span class="o">.</span><span class="n">get_commute_values</span><span class="p">(</span><span class="n">emp_within</span><span class="p">,</span> <span class="n">office</span><span class="p">,</span> <span class="n">commute_data</span><span class="p">,</span> <span class="n">values</span><span class="p">)</span>
</span><span id="Analyzer-1446"><a href="#Analyzer-1446"><span class="linenos">1446</span></a>                <span class="c1"># get max value of val_set</span>
</span><span id="Analyzer-1447"><a href="#Analyzer-1447"><span class="linenos">1447</span></a>                <span class="c1"># val_set is a DataFrame containing the extracted values for each employee location that matches the given office location. The DataFrame includes &#39;latitude&#39; and &#39;longitude&#39; of the employee locations and the specified `values`.</span>
</span><span id="Analyzer-1448"><a href="#Analyzer-1448"><span class="linenos">1448</span></a>                <span class="k">for</span> <span class="n">each</span> <span class="ow">in</span> <span class="n">values</span><span class="p">:</span>
</span><span id="Analyzer-1449"><a href="#Analyzer-1449"><span class="linenos">1449</span></a>                    <span class="k">if</span> <span class="nb">max</span><span class="p">(</span><span class="n">val_set</span><span class="p">[</span><span class="n">each</span><span class="p">])</span> <span class="o">&gt;</span> <span class="n">binmax</span><span class="p">:</span>
</span><span id="Analyzer-1450"><a href="#Analyzer-1450"><span class="linenos">1450</span></a>                        <span class="n">binmax</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">val_set</span><span class="p">[</span><span class="n">each</span><span class="p">])</span>            
</span><span id="Analyzer-1451"><a href="#Analyzer-1451"><span class="linenos">1451</span></a>                <span class="n">step</span> <span class="o">=</span> <span class="mi">5</span>
</span><span id="Analyzer-1452"><a href="#Analyzer-1452"><span class="linenos">1452</span></a>                <span class="c1"># round the binmax up to the nearest step</span>
</span><span id="Analyzer-1453"><a href="#Analyzer-1453"><span class="linenos">1453</span></a>                <span class="n">bins</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">binmax</span> <span class="o">+</span> <span class="n">step</span> <span class="o">-</span> <span class="p">(</span><span class="n">binmax</span> <span class="o">%</span> <span class="n">step</span><span class="p">)),</span> <span class="n">step</span><span class="p">)</span>
</span><span id="Analyzer-1454"><a href="#Analyzer-1454"><span class="linenos">1454</span></a>                <span class="n">plt</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graphing</span><span class="o">.</span><span class="n">get_histogram</span><span class="p">(</span><span class="n">emp</span><span class="p">,</span> <span class="n">office</span><span class="p">,</span> <span class="n">commute_data</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span> <span class="n">suptitle</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;address&#39;</span><span class="p">])</span><span class="o">+</span><span class="s2">&quot; Commute Analysis&quot;</span><span class="p">,</span> <span class="n">x_label</span><span class="o">=</span><span class="s1">&#39;Minutes in Traffic&#39;</span><span class="p">,</span> <span class="n">y_label</span><span class="o">=</span><span class="s1">&#39;# Employees&#39;</span><span class="p">,</span>  
</span><span id="Analyzer-1455"><a href="#Analyzer-1455"><span class="linenos">1455</span></a>                            <span class="n">commute_radius</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">commute_range_cut_off</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="n">bins</span><span class="p">,</span> <span class="n">rows</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">cols</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">column_titles</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Morning Commute&#39;</span><span class="p">,</span><span class="s1">&#39;Evening Commute&#39;</span><span class="p">],</span> <span class="n">cumulative_line</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="Analyzer-1456"><a href="#Analyzer-1456"><span class="linenos">1456</span></a>                            <span class="n">cumulative_color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">cumulative_linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">cumulative_linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">cumulative_markers</span><span class="o">=</span><span class="n">cumulative_markers</span><span class="p">,</span> <span class="n">font_mod</span><span class="o">=</span><span class="mf">1.5</span><span class="p">)</span>
</span><span id="Analyzer-1457"><a href="#Analyzer-1457"><span class="linenos">1457</span></a>                
</span><span id="Analyzer-1458"><a href="#Analyzer-1458"><span class="linenos">1458</span></a>                <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;center right&#39;</span><span class="p">)</span>
</span><span id="Analyzer-1459"><a href="#Analyzer-1459"><span class="linenos">1459</span></a>                <span class="k">for</span> <span class="n">each</span> <span class="ow">in</span> <span class="n">plt</span><span class="o">.</span><span class="n">gcf</span><span class="p">()</span><span class="o">.</span><span class="n">get_axes</span><span class="p">():</span>
</span><span id="Analyzer-1460"><a href="#Analyzer-1460"><span class="linenos">1460</span></a>                    <span class="c1"># Add monday through Friday labels on first column only</span>
</span><span id="Analyzer-1461"><a href="#Analyzer-1461"><span class="linenos">1461</span></a>                    <span class="k">if</span> <span class="n">each</span><span class="o">.</span><span class="n">get_subplotspec</span><span class="p">()</span><span class="o">.</span><span class="n">colspan</span><span class="o">.</span><span class="n">start</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Analyzer-1462"><a href="#Analyzer-1462"><span class="linenos">1462</span></a>                        <span class="c1"># first row is monday, second is tuesday, etc</span>
</span><span id="Analyzer-1463"><a href="#Analyzer-1463"><span class="linenos">1463</span></a>                        <span class="n">row</span> <span class="o">=</span> <span class="n">each</span><span class="o">.</span><span class="n">get_subplotspec</span><span class="p">()</span><span class="o">.</span><span class="n">rowspan</span><span class="o">.</span><span class="n">start</span>
</span><span id="Analyzer-1464"><a href="#Analyzer-1464"><span class="linenos">1464</span></a>                        <span class="k">if</span> <span class="n">row</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Analyzer-1465"><a href="#Analyzer-1465"><span class="linenos">1465</span></a>                            <span class="n">each</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.02</span><span class="p">,</span> <span class="mf">0.85</span><span class="p">,</span> <span class="s1">&#39;Monday&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">each</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;top&#39;</span><span class="p">)</span>
</span><span id="Analyzer-1466"><a href="#Analyzer-1466"><span class="linenos">1466</span></a>                        <span class="k">elif</span> <span class="n">row</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="Analyzer-1467"><a href="#Analyzer-1467"><span class="linenos">1467</span></a>                            <span class="n">each</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.02</span><span class="p">,</span> <span class="mf">0.85</span><span class="p">,</span> <span class="s1">&#39;Tuesday&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">each</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;top&#39;</span><span class="p">)</span>
</span><span id="Analyzer-1468"><a href="#Analyzer-1468"><span class="linenos">1468</span></a>                        <span class="k">elif</span> <span class="n">row</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
</span><span id="Analyzer-1469"><a href="#Analyzer-1469"><span class="linenos">1469</span></a>                            <span class="n">each</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.02</span><span class="p">,</span> <span class="mf">0.85</span><span class="p">,</span> <span class="s1">&#39;Wednesday&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">each</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;top&#39;</span><span class="p">)</span>
</span><span id="Analyzer-1470"><a href="#Analyzer-1470"><span class="linenos">1470</span></a>                        <span class="k">elif</span> <span class="n">row</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
</span><span id="Analyzer-1471"><a href="#Analyzer-1471"><span class="linenos">1471</span></a>                            <span class="n">each</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.02</span><span class="p">,</span> <span class="mf">0.85</span><span class="p">,</span> <span class="s1">&#39;Thursday&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">each</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;top&#39;</span><span class="p">)</span>
</span><span id="Analyzer-1472"><a href="#Analyzer-1472"><span class="linenos">1472</span></a>                        <span class="k">elif</span> <span class="n">row</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
</span><span id="Analyzer-1473"><a href="#Analyzer-1473"><span class="linenos">1473</span></a>                            <span class="n">each</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.02</span><span class="p">,</span> <span class="mf">0.85</span><span class="p">,</span> <span class="s1">&#39;Friday&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">each</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;top&#39;</span><span class="p">)</span>
</span><span id="Analyzer-1474"><a href="#Analyzer-1474"><span class="linenos">1474</span></a>                            
</span><span id="Analyzer-1475"><a href="#Analyzer-1475"><span class="linenos">1475</span></a>                <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">(</span><span class="n">pad</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
</span><span id="Analyzer-1476"><a href="#Analyzer-1476"><span class="linenos">1476</span></a>                <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">plots_dir</span><span class="o">+</span><span class="s2">&quot;/&quot;</span><span class="o">+</span><span class="n">key</span><span class="o">+</span><span class="s2">&quot;.png&quot;</span><span class="p">)</span>
</span><span id="Analyzer-1477"><a href="#Analyzer-1477"><span class="linenos">1477</span></a>                <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="Analyzer-1478"><a href="#Analyzer-1478"><span class="linenos">1478</span></a>
</span><span id="Analyzer-1479"><a href="#Analyzer-1479"><span class="linenos">1479</span></a>
</span><span id="Analyzer-1480"><a href="#Analyzer-1480"><span class="linenos">1480</span></a>        <span class="c1">################################################################################</span>
</span><span id="Analyzer-1481"><a href="#Analyzer-1481"><span class="linenos">1481</span></a>        <span class="c1">### GRAPH SET: Local Analysis for Office X</span>
</span><span id="Analyzer-1482"><a href="#Analyzer-1482"><span class="linenos">1482</span></a>        <span class="c1"># iterate through offices, generate a graph for each office</span>
</span><span id="Analyzer-1483"><a href="#Analyzer-1483"><span class="linenos">1483</span></a>        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">offices</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>            
</span><span id="Analyzer-1484"><a href="#Analyzer-1484"><span class="linenos">1484</span></a>            <span class="c1"># GRAPH: </span>
</span><span id="Analyzer-1485"><a href="#Analyzer-1485"><span class="linenos">1485</span></a>            <span class="c1">## Normalized Weekly Commute Duration Analysis</span>
</span><span id="Analyzer-1486"><a href="#Analyzer-1486"><span class="linenos">1486</span></a>            <span class="n">key</span> <span class="o">=</span> <span class="s1">&#39;nwcda&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
</span><span id="Analyzer-1487"><a href="#Analyzer-1487"><span class="linenos">1487</span></a>            <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;Normalized Weekly Commute Duration Analysis &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;address&quot;</span><span class="p">])</span>
</span><span id="Analyzer-1488"><a href="#Analyzer-1488"><span class="linenos">1488</span></a>            <span class="n">short_title</span> <span class="o">=</span> <span class="n">title</span>
</span><span id="Analyzer-1489"><a href="#Analyzer-1489"><span class="linenos">1489</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">graph_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="p">{</span><span class="s2">&quot;GRAPH&quot;</span><span class="p">:</span> <span class="n">key</span><span class="p">,</span>
</span><span id="Analyzer-1490"><a href="#Analyzer-1490"><span class="linenos">1490</span></a>                                    <span class="s2">&quot;TITLE&quot;</span><span class="p">:</span> <span class="n">short_title</span><span class="p">,</span>
</span><span id="Analyzer-1491"><a href="#Analyzer-1491"><span class="linenos">1491</span></a>                                    <span class="s2">&quot;FILENAME&quot;</span><span class="p">:</span> <span class="n">key</span><span class="o">+</span><span class="s2">&quot;.png&quot;</span><span class="p">,</span>
</span><span id="Analyzer-1492"><a href="#Analyzer-1492"><span class="linenos">1492</span></a>                                    <span class="s2">&quot;PLOT-DESCRIPTION&quot;</span><span class="p">:</span>  <span class="s2">&quot;This graph displays the the morning and evening commute durations for employees within the &quot;</span> <span class="o">+</span> \
</span><span id="Analyzer-1493"><a href="#Analyzer-1493"><span class="linenos">1493</span></a>                                                        <span class="s2">&quot;cutoff distance of the current office, normalized to reflect the duration in traffic as a percentage &quot;</span> <span class="o">+</span> \
</span><span id="Analyzer-1494"><a href="#Analyzer-1494"><span class="linenos">1494</span></a>                                                        <span class="s2">&quot; of the duration without traffic.  The analysis is broken down by day of the week, &quot;</span> <span class="o">+</span> \
</span><span id="Analyzer-1495"><a href="#Analyzer-1495"><span class="linenos">1495</span></a>                                                        <span class="s2">&quot;and the distribution of commute times is shown for each day.  The commute times are based on &quot;</span> <span class="o">+</span> \
</span><span id="Analyzer-1496"><a href="#Analyzer-1496"><span class="linenos">1496</span></a>                                                        <span class="s2">&quot;the commute data derived based on traffic conditions, and are in minutes. The analysis is specific &quot;</span> <span class="o">+</span> \
</span><span id="Analyzer-1497"><a href="#Analyzer-1497"><span class="linenos">1497</span></a>                                                        <span class="s2">&quot;to the office at &quot;</span><span class="o">+</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;address&quot;</span><span class="p">]</span><span class="o">+</span><span class="s2">&quot;.&quot;</span>
</span><span id="Analyzer-1498"><a href="#Analyzer-1498"><span class="linenos">1498</span></a>                                    <span class="p">})</span>
</span><span id="Analyzer-1499"><a href="#Analyzer-1499"><span class="linenos">1499</span></a>            
</span><span id="Analyzer-1500"><a href="#Analyzer-1500"><span class="linenos">1500</span></a>            <span class="k">if</span> <span class="n">graph</span> <span class="o">==</span> <span class="s2">&quot;_all&quot;</span> <span class="ow">or</span> <span class="n">graph</span> <span class="o">==</span> <span class="n">key</span><span class="p">:</span>
</span><span id="Analyzer-1501"><a href="#Analyzer-1501"><span class="linenos">1501</span></a>                <span class="c1"># only calculate for the first office, the current office</span>
</span><span id="Analyzer-1502"><a href="#Analyzer-1502"><span class="linenos">1502</span></a>                <span class="c1">#office = offices.iloc[0].to_frame().T</span>
</span><span id="Analyzer-1503"><a href="#Analyzer-1503"><span class="linenos">1503</span></a>                <span class="n">office</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">to_frame</span><span class="p">()</span><span class="o">.</span><span class="n">T</span>
</span><span id="Analyzer-1504"><a href="#Analyzer-1504"><span class="linenos">1504</span></a>                <span class="n">values</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;m_morning_duration_in_traffic&#39;</span><span class="p">,</span><span class="s1">&#39;m_evening_duration_in_traffic&#39;</span><span class="p">,</span>
</span><span id="Analyzer-1505"><a href="#Analyzer-1505"><span class="linenos">1505</span></a>                        <span class="s1">&#39;t_morning_duration_in_traffic&#39;</span><span class="p">,</span><span class="s1">&#39;t_evening_duration_in_traffic&#39;</span><span class="p">,</span>
</span><span id="Analyzer-1506"><a href="#Analyzer-1506"><span class="linenos">1506</span></a>                        <span class="s1">&#39;w_morning_duration_in_traffic&#39;</span><span class="p">,</span><span class="s1">&#39;w_evening_duration_in_traffic&#39;</span><span class="p">,</span>
</span><span id="Analyzer-1507"><a href="#Analyzer-1507"><span class="linenos">1507</span></a>                        <span class="s1">&#39;h_morning_duration_in_traffic&#39;</span><span class="p">,</span><span class="s1">&#39;h_evening_duration_in_traffic&#39;</span><span class="p">,</span>
</span><span id="Analyzer-1508"><a href="#Analyzer-1508"><span class="linenos">1508</span></a>                        <span class="s1">&#39;f_morning_duration_in_traffic&#39;</span><span class="p">,</span><span class="s1">&#39;f_evening_duration_in_traffic&#39;</span><span class="p">]</span>
</span><span id="Analyzer-1509"><a href="#Analyzer-1509"><span class="linenos">1509</span></a>                <span class="n">cumulative_markers</span> <span class="o">=</span> <span class="p">{</span><span class="mi">50</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;purple&#39;</span><span class="p">,</span> <span class="s1">&#39;marker&#39;</span><span class="p">:</span> <span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="s1">&#39;Median (min)&#39;</span><span class="p">,</span> <span class="s1">&#39;linestyle&#39;</span><span class="p">:</span> <span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="s1">&#39;linewidth&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">}}</span>
</span><span id="Analyzer-1510"><a href="#Analyzer-1510"><span class="linenos">1510</span></a>                
</span><span id="Analyzer-1511"><a href="#Analyzer-1511"><span class="linenos">1511</span></a>                <span class="n">emp_within</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graphing</span><span class="o">.</span><span class="n">filter_drive_distance</span><span class="p">(</span><span class="n">emp</span><span class="p">,</span><span class="n">office</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">commute_range_cut_off</span><span class="p">,</span> <span class="n">commute_data</span><span class="o">=</span><span class="n">commute_data</span><span class="p">)</span>
</span><span id="Analyzer-1512"><a href="#Analyzer-1512"><span class="linenos">1512</span></a>                <span class="n">val_set</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graphing</span><span class="o">.</span><span class="n">get_commute_values</span><span class="p">(</span><span class="n">emp_within</span><span class="p">,</span> <span class="n">office</span><span class="p">,</span> <span class="n">commute_data</span><span class="p">,</span> <span class="n">values</span><span class="p">)</span>
</span><span id="Analyzer-1513"><a href="#Analyzer-1513"><span class="linenos">1513</span></a>                <span class="n">val_set_free</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graphing</span><span class="o">.</span><span class="n">get_commute_values</span><span class="p">(</span><span class="n">emp_within</span><span class="p">,</span> <span class="n">office</span><span class="p">,</span> <span class="n">commute_data</span><span class="p">,</span> <span class="s2">&quot;duration&quot;</span><span class="p">)</span>
</span><span id="Analyzer-1514"><a href="#Analyzer-1514"><span class="linenos">1514</span></a>                <span class="c1"># Normalize the values in val_set by dividing by the corresponding values in val_set_free, and multiplying by 100</span>
</span><span id="Analyzer-1515"><a href="#Analyzer-1515"><span class="linenos">1515</span></a>                <span class="k">for</span> <span class="n">each</span> <span class="ow">in</span> <span class="n">values</span><span class="p">:</span>
</span><span id="Analyzer-1516"><a href="#Analyzer-1516"><span class="linenos">1516</span></a>                    <span class="n">val_set</span><span class="p">[</span><span class="n">each</span><span class="p">]</span> <span class="o">=</span> <span class="n">val_set</span><span class="p">[</span><span class="n">each</span><span class="p">]</span> <span class="o">/</span> <span class="n">val_set_free</span><span class="p">[</span><span class="s1">&#39;duration&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">100</span>
</span><span id="Analyzer-1517"><a href="#Analyzer-1517"><span class="linenos">1517</span></a>                
</span><span id="Analyzer-1518"><a href="#Analyzer-1518"><span class="linenos">1518</span></a>                <span class="c1"># calculate teh bins based on the max value of the data</span>
</span><span id="Analyzer-1519"><a href="#Analyzer-1519"><span class="linenos">1519</span></a>                <span class="n">binmax</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Analyzer-1520"><a href="#Analyzer-1520"><span class="linenos">1520</span></a>                <span class="n">binmin</span> <span class="o">=</span> <span class="mi">100</span>
</span><span id="Analyzer-1521"><a href="#Analyzer-1521"><span class="linenos">1521</span></a>                <span class="k">for</span> <span class="n">each</span> <span class="ow">in</span> <span class="n">values</span><span class="p">:</span>
</span><span id="Analyzer-1522"><a href="#Analyzer-1522"><span class="linenos">1522</span></a>                    <span class="k">if</span> <span class="nb">max</span><span class="p">(</span><span class="n">val_set</span><span class="p">[</span><span class="n">each</span><span class="p">])</span> <span class="o">&gt;</span> <span class="n">binmax</span><span class="p">:</span>
</span><span id="Analyzer-1523"><a href="#Analyzer-1523"><span class="linenos">1523</span></a>                        <span class="n">binmax</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">val_set</span><span class="p">[</span><span class="n">each</span><span class="p">])</span>
</span><span id="Analyzer-1524"><a href="#Analyzer-1524"><span class="linenos">1524</span></a>                    <span class="k">if</span> <span class="nb">min</span><span class="p">(</span><span class="n">val_set</span><span class="p">[</span><span class="n">each</span><span class="p">])</span> <span class="o">&lt;</span> <span class="n">binmin</span><span class="p">:</span>
</span><span id="Analyzer-1525"><a href="#Analyzer-1525"><span class="linenos">1525</span></a>                        <span class="n">binmin</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">val_set</span><span class="p">[</span><span class="n">each</span><span class="p">])</span>            
</span><span id="Analyzer-1526"><a href="#Analyzer-1526"><span class="linenos">1526</span></a>                <span class="n">step</span> <span class="o">=</span> <span class="mi">5</span>
</span><span id="Analyzer-1527"><a href="#Analyzer-1527"><span class="linenos">1527</span></a>                <span class="c1"># round the binmax up to the nearest step, and binmin down to the nearest step</span>
</span><span id="Analyzer-1528"><a href="#Analyzer-1528"><span class="linenos">1528</span></a>                <span class="n">bins</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">binmin</span> <span class="o">-</span> <span class="p">(</span><span class="n">binmin</span> <span class="o">%</span> <span class="n">step</span><span class="p">)),</span> <span class="nb">int</span><span class="p">(</span><span class="n">binmax</span> <span class="o">+</span> <span class="n">step</span> <span class="o">-</span> <span class="p">(</span><span class="n">binmax</span> <span class="o">%</span> <span class="n">step</span><span class="p">)),</span> <span class="n">step</span><span class="p">)</span>
</span><span id="Analyzer-1529"><a href="#Analyzer-1529"><span class="linenos">1529</span></a>                
</span><span id="Analyzer-1530"><a href="#Analyzer-1530"><span class="linenos">1530</span></a>                <span class="n">plt</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graphing</span><span class="o">.</span><span class="n">get_histogram</span><span class="p">(</span><span class="n">emp</span><span class="p">,</span> <span class="n">office</span><span class="p">,</span> <span class="n">commute_data</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span> <span class="n">suptitle</span><span class="o">=</span><span class="s2">&quot;Normalized &#39;In Traffic&#39; Commute Analysis, </span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;address&#39;</span><span class="p">]),</span> 
</span><span id="Analyzer-1531"><a href="#Analyzer-1531"><span class="linenos">1531</span></a>                                                      <span class="n">x_label</span><span class="o">=</span><span class="s1">&#39;Normalized (In-Traffic / Traffic-Free) </span><span class="se">\n</span><span class="s1"> Commute Duration (%)&#39;</span><span class="p">,</span> <span class="n">y_label</span><span class="o">=</span><span class="s1">&#39;# Employees&#39;</span><span class="p">,</span>  
</span><span id="Analyzer-1532"><a href="#Analyzer-1532"><span class="linenos">1532</span></a>                            <span class="n">commute_radius</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">commute_range_cut_off</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="n">bins</span><span class="p">,</span> <span class="n">rows</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">cols</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">column_titles</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Morning Commute&#39;</span><span class="p">,</span><span class="s1">&#39;Evening Commute&#39;</span><span class="p">],</span> <span class="n">cumulative_line</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="Analyzer-1533"><a href="#Analyzer-1533"><span class="linenos">1533</span></a>                            <span class="n">cumulative_color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">cumulative_linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">cumulative_linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">cumulative_markers</span><span class="o">=</span><span class="n">cumulative_markers</span><span class="p">,</span> 
</span><span id="Analyzer-1534"><a href="#Analyzer-1534"><span class="linenos">1534</span></a>                            <span class="n">override_values</span><span class="o">=</span><span class="n">val_set</span><span class="p">,</span> <span class="n">font_mod</span><span class="o">=</span><span class="mf">1.5</span><span class="p">)</span>
</span><span id="Analyzer-1535"><a href="#Analyzer-1535"><span class="linenos">1535</span></a>                
</span><span id="Analyzer-1536"><a href="#Analyzer-1536"><span class="linenos">1536</span></a>                
</span><span id="Analyzer-1537"><a href="#Analyzer-1537"><span class="linenos">1537</span></a>                <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;center right&#39;</span><span class="p">)</span>
</span><span id="Analyzer-1538"><a href="#Analyzer-1538"><span class="linenos">1538</span></a>                <span class="k">for</span> <span class="n">each</span> <span class="ow">in</span> <span class="n">plt</span><span class="o">.</span><span class="n">gcf</span><span class="p">()</span><span class="o">.</span><span class="n">get_axes</span><span class="p">():</span>
</span><span id="Analyzer-1539"><a href="#Analyzer-1539"><span class="linenos">1539</span></a>                    <span class="c1"># Add monday through Friday labels on first column only</span>
</span><span id="Analyzer-1540"><a href="#Analyzer-1540"><span class="linenos">1540</span></a>                    <span class="k">if</span> <span class="n">each</span><span class="o">.</span><span class="n">get_subplotspec</span><span class="p">()</span><span class="o">.</span><span class="n">colspan</span><span class="o">.</span><span class="n">start</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Analyzer-1541"><a href="#Analyzer-1541"><span class="linenos">1541</span></a>                        <span class="c1"># first row is monday, second is tuesday, etc</span>
</span><span id="Analyzer-1542"><a href="#Analyzer-1542"><span class="linenos">1542</span></a>                        <span class="n">row</span> <span class="o">=</span> <span class="n">each</span><span class="o">.</span><span class="n">get_subplotspec</span><span class="p">()</span><span class="o">.</span><span class="n">rowspan</span><span class="o">.</span><span class="n">start</span>
</span><span id="Analyzer-1543"><a href="#Analyzer-1543"><span class="linenos">1543</span></a>                        <span class="k">if</span> <span class="n">row</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Analyzer-1544"><a href="#Analyzer-1544"><span class="linenos">1544</span></a>                            <span class="n">each</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.02</span><span class="p">,</span> <span class="mf">0.85</span><span class="p">,</span> <span class="s1">&#39;Monday&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">each</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;top&#39;</span><span class="p">)</span>
</span><span id="Analyzer-1545"><a href="#Analyzer-1545"><span class="linenos">1545</span></a>                        <span class="k">elif</span> <span class="n">row</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="Analyzer-1546"><a href="#Analyzer-1546"><span class="linenos">1546</span></a>                            <span class="n">each</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.02</span><span class="p">,</span> <span class="mf">0.85</span><span class="p">,</span> <span class="s1">&#39;Tuesday&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">each</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;top&#39;</span><span class="p">)</span>
</span><span id="Analyzer-1547"><a href="#Analyzer-1547"><span class="linenos">1547</span></a>                        <span class="k">elif</span> <span class="n">row</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
</span><span id="Analyzer-1548"><a href="#Analyzer-1548"><span class="linenos">1548</span></a>                            <span class="n">each</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.02</span><span class="p">,</span> <span class="mf">0.85</span><span class="p">,</span> <span class="s1">&#39;Wednesday&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">each</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;top&#39;</span><span class="p">)</span>
</span><span id="Analyzer-1549"><a href="#Analyzer-1549"><span class="linenos">1549</span></a>                        <span class="k">elif</span> <span class="n">row</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
</span><span id="Analyzer-1550"><a href="#Analyzer-1550"><span class="linenos">1550</span></a>                            <span class="n">each</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.02</span><span class="p">,</span> <span class="mf">0.85</span><span class="p">,</span> <span class="s1">&#39;Thursday&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">each</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;top&#39;</span><span class="p">)</span>
</span><span id="Analyzer-1551"><a href="#Analyzer-1551"><span class="linenos">1551</span></a>                        <span class="k">elif</span> <span class="n">row</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
</span><span id="Analyzer-1552"><a href="#Analyzer-1552"><span class="linenos">1552</span></a>                            <span class="n">each</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.02</span><span class="p">,</span> <span class="mf">0.85</span><span class="p">,</span> <span class="s1">&#39;Friday&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">each</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;top&#39;</span><span class="p">)</span>
</span><span id="Analyzer-1553"><a href="#Analyzer-1553"><span class="linenos">1553</span></a>                            
</span><span id="Analyzer-1554"><a href="#Analyzer-1554"><span class="linenos">1554</span></a>                <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">(</span><span class="n">pad</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
</span><span id="Analyzer-1555"><a href="#Analyzer-1555"><span class="linenos">1555</span></a>                <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">plots_dir</span><span class="o">+</span><span class="s2">&quot;/&quot;</span><span class="o">+</span><span class="n">key</span><span class="o">+</span><span class="s2">&quot;.png&quot;</span><span class="p">)</span>
</span><span id="Analyzer-1556"><a href="#Analyzer-1556"><span class="linenos">1556</span></a>                <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="Analyzer-1557"><a href="#Analyzer-1557"><span class="linenos">1557</span></a>
</span><span id="Analyzer-1558"><a href="#Analyzer-1558"><span class="linenos">1558</span></a>
</span><span id="Analyzer-1559"><a href="#Analyzer-1559"><span class="linenos">1559</span></a>
</span><span id="Analyzer-1560"><a href="#Analyzer-1560"><span class="linenos">1560</span></a>        <span class="c1">############################################################################################################</span>
</span><span id="Analyzer-1561"><a href="#Analyzer-1561"><span class="linenos">1561</span></a>        <span class="c1"># GRAPH:</span>
</span><span id="Analyzer-1562"><a href="#Analyzer-1562"><span class="linenos">1562</span></a>        <span class="c1">## Normalized Commute Distribution Analysis</span>
</span><span id="Analyzer-1563"><a href="#Analyzer-1563"><span class="linenos">1563</span></a>        <span class="n">key</span> <span class="o">=</span> <span class="s1">&#39;ncda&#39;</span>
</span><span id="Analyzer-1564"><a href="#Analyzer-1564"><span class="linenos">1564</span></a>        <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;Normalized Commute Distribution Analysis&quot;</span>
</span><span id="Analyzer-1565"><a href="#Analyzer-1565"><span class="linenos">1565</span></a>        <span class="n">short_title</span> <span class="o">=</span> <span class="n">title</span>
</span><span id="Analyzer-1566"><a href="#Analyzer-1566"><span class="linenos">1566</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">graph_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="p">{</span><span class="s2">&quot;GRAPH&quot;</span><span class="p">:</span> <span class="n">key</span><span class="p">,</span>
</span><span id="Analyzer-1567"><a href="#Analyzer-1567"><span class="linenos">1567</span></a>                                <span class="s2">&quot;TITLE&quot;</span><span class="p">:</span> <span class="n">short_title</span><span class="p">,</span>
</span><span id="Analyzer-1568"><a href="#Analyzer-1568"><span class="linenos">1568</span></a>                                <span class="s2">&quot;FILENAME&quot;</span><span class="p">:</span> <span class="n">key</span><span class="o">+</span><span class="s2">&quot;.png&quot;</span><span class="p">,</span>
</span><span id="Analyzer-1569"><a href="#Analyzer-1569"><span class="linenos">1569</span></a>                                <span class="s2">&quot;PLOT-DESCRIPTION&quot;</span><span class="p">:</span>  <span class="s2">&quot;This graph plots the the normalized commute durations against the distance of the commute. &quot;</span> <span class="o">+</span> \
</span><span id="Analyzer-1570"><a href="#Analyzer-1570"><span class="linenos">1570</span></a>                                                    <span class="s2">&quot;The objective is to affirm that the tails of the distribution are driven by shorter distance commutes &quot;</span> <span class="o">+</span> \
</span><span id="Analyzer-1571"><a href="#Analyzer-1571"><span class="linenos">1571</span></a>                                                    <span class="s2">&quot;and therefore present minimal risk of skewing the analysis when an average across days/employees is taken.&quot;</span>
</span><span id="Analyzer-1572"><a href="#Analyzer-1572"><span class="linenos">1572</span></a>                                <span class="p">})</span>
</span><span id="Analyzer-1573"><a href="#Analyzer-1573"><span class="linenos">1573</span></a>        
</span><span id="Analyzer-1574"><a href="#Analyzer-1574"><span class="linenos">1574</span></a>        <span class="k">if</span> <span class="n">graph</span> <span class="o">==</span> <span class="s2">&quot;_all&quot;</span> <span class="ow">or</span> <span class="n">graph</span> <span class="o">==</span> <span class="n">key</span><span class="p">:</span>
</span><span id="Analyzer-1575"><a href="#Analyzer-1575"><span class="linenos">1575</span></a>            <span class="n">office</span> <span class="o">=</span> <span class="n">offices</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">to_frame</span><span class="p">()</span><span class="o">.</span><span class="n">T</span>
</span><span id="Analyzer-1576"><a href="#Analyzer-1576"><span class="linenos">1576</span></a>            <span class="n">values</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;m_morning_duration_in_traffic&#39;</span><span class="p">,</span><span class="s1">&#39;m_evening_duration_in_traffic&#39;</span><span class="p">,</span>
</span><span id="Analyzer-1577"><a href="#Analyzer-1577"><span class="linenos">1577</span></a>                    <span class="s1">&#39;t_morning_duration_in_traffic&#39;</span><span class="p">,</span><span class="s1">&#39;t_evening_duration_in_traffic&#39;</span><span class="p">,</span>
</span><span id="Analyzer-1578"><a href="#Analyzer-1578"><span class="linenos">1578</span></a>                    <span class="s1">&#39;w_morning_duration_in_traffic&#39;</span><span class="p">,</span><span class="s1">&#39;w_evening_duration_in_traffic&#39;</span><span class="p">,</span>
</span><span id="Analyzer-1579"><a href="#Analyzer-1579"><span class="linenos">1579</span></a>                    <span class="s1">&#39;h_morning_duration_in_traffic&#39;</span><span class="p">,</span><span class="s1">&#39;h_evening_duration_in_traffic&#39;</span><span class="p">,</span>
</span><span id="Analyzer-1580"><a href="#Analyzer-1580"><span class="linenos">1580</span></a>                    <span class="s1">&#39;f_morning_duration_in_traffic&#39;</span><span class="p">,</span><span class="s1">&#39;f_evening_duration_in_traffic&#39;</span><span class="p">]</span>
</span><span id="Analyzer-1581"><a href="#Analyzer-1581"><span class="linenos">1581</span></a>            <span class="n">data_labels</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Monday Morning&#39;</span><span class="p">,</span><span class="s1">&#39;Monday Evening&#39;</span><span class="p">,</span>
</span><span id="Analyzer-1582"><a href="#Analyzer-1582"><span class="linenos">1582</span></a>                    <span class="s1">&#39;Tuesday Morning&#39;</span><span class="p">,</span><span class="s1">&#39;Tuesday Evening&#39;</span><span class="p">,</span>
</span><span id="Analyzer-1583"><a href="#Analyzer-1583"><span class="linenos">1583</span></a>                    <span class="s1">&#39;Wednesday Morning&#39;</span><span class="p">,</span><span class="s1">&#39;Wednesday Evening&#39;</span><span class="p">,</span>
</span><span id="Analyzer-1584"><a href="#Analyzer-1584"><span class="linenos">1584</span></a>                    <span class="s1">&#39;Thursday Morning&#39;</span><span class="p">,</span><span class="s1">&#39;Thursday Evening&#39;</span><span class="p">,</span>
</span><span id="Analyzer-1585"><a href="#Analyzer-1585"><span class="linenos">1585</span></a>                    <span class="s1">&#39;Friday Morning&#39;</span><span class="p">,</span><span class="s1">&#39;Friday Evening&#39;</span><span class="p">]</span>
</span><span id="Analyzer-1586"><a href="#Analyzer-1586"><span class="linenos">1586</span></a>            <span class="n">emp_within</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graphing</span><span class="o">.</span><span class="n">filter_drive_distance</span><span class="p">(</span><span class="n">emp</span><span class="p">,</span><span class="n">office</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">commute_range_cut_off</span><span class="p">,</span> <span class="n">commute_data</span><span class="o">=</span><span class="n">commute_data</span><span class="p">)</span>
</span><span id="Analyzer-1587"><a href="#Analyzer-1587"><span class="linenos">1587</span></a>            <span class="n">val_set</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graphing</span><span class="o">.</span><span class="n">get_commute_values</span><span class="p">(</span><span class="n">emp_within</span><span class="p">,</span> <span class="n">office</span><span class="p">,</span> <span class="n">commute_data</span><span class="p">,</span> <span class="n">values</span><span class="p">)</span>
</span><span id="Analyzer-1588"><a href="#Analyzer-1588"><span class="linenos">1588</span></a>            <span class="n">val_set_free</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graphing</span><span class="o">.</span><span class="n">get_commute_values</span><span class="p">(</span><span class="n">emp_within</span><span class="p">,</span> <span class="n">office</span><span class="p">,</span> <span class="n">commute_data</span><span class="p">,</span> <span class="s2">&quot;duration&quot;</span><span class="p">)</span>
</span><span id="Analyzer-1589"><a href="#Analyzer-1589"><span class="linenos">1589</span></a>            <span class="n">val_set_miles</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graphing</span><span class="o">.</span><span class="n">get_commute_values</span><span class="p">(</span><span class="n">emp_within</span><span class="p">,</span> <span class="n">office</span><span class="p">,</span> <span class="n">commute_data</span><span class="p">,</span> <span class="s2">&quot;miles&quot;</span><span class="p">)</span>
</span><span id="Analyzer-1590"><a href="#Analyzer-1590"><span class="linenos">1590</span></a>            <span class="c1"># Normalize the values in val_set by dividing by the corresponding values in val_set_free, and multiplying by 100</span>
</span><span id="Analyzer-1591"><a href="#Analyzer-1591"><span class="linenos">1591</span></a>            <span class="k">for</span> <span class="n">each</span> <span class="ow">in</span> <span class="n">values</span><span class="p">:</span>
</span><span id="Analyzer-1592"><a href="#Analyzer-1592"><span class="linenos">1592</span></a>                <span class="n">val_set</span><span class="p">[</span><span class="n">each</span><span class="p">]</span> <span class="o">=</span> <span class="n">val_set</span><span class="p">[</span><span class="n">each</span><span class="p">]</span> <span class="o">/</span> <span class="n">val_set_free</span><span class="p">[</span><span class="s1">&#39;duration&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">100</span>
</span><span id="Analyzer-1593"><a href="#Analyzer-1593"><span class="linenos">1593</span></a>
</span><span id="Analyzer-1594"><a href="#Analyzer-1594"><span class="linenos">1594</span></a>            <span class="n">plt</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graphing</span><span class="o">.</span><span class="n">get_scatterplot</span><span class="p">(</span><span class="n">emp</span><span class="p">,</span> <span class="n">office</span><span class="p">,</span> <span class="n">commute_data</span><span class="p">,</span> <span class="s2">&quot;miles&quot;</span><span class="p">,</span> <span class="s2">&quot;duration&quot;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span> <span class="n">x_label</span><span class="o">=</span><span class="s1">&#39;Normalized (In-Traffic / Traffic-Free) </span><span class="se">\n</span><span class="s1"> Commute Duration (%)&#39;</span><span class="p">,</span> 
</span><span id="Analyzer-1595"><a href="#Analyzer-1595"><span class="linenos">1595</span></a>                                                    <span class="n">y_label</span><span class="o">=</span><span class="s1">&#39;Commute Distance miles&#39;</span><span class="p">,</span>
</span><span id="Analyzer-1596"><a href="#Analyzer-1596"><span class="linenos">1596</span></a>                                                    <span class="n">cutoff_radius</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">commute_range_cut_off</span><span class="p">,</span> <span class="n">commute_radius</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">commute_range_cut_off</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">15</span><span class="p">),</span> <span class="n">manual_plot</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">font_mod</span><span class="o">=</span><span class="mf">1.5</span><span class="p">)</span>
</span><span id="Analyzer-1597"><a href="#Analyzer-1597"><span class="linenos">1597</span></a>            <span class="c1"># manually add scatter plots for each day</span>
</span><span id="Analyzer-1598"><a href="#Analyzer-1598"><span class="linenos">1598</span></a>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">)):</span>
</span><span id="Analyzer-1599"><a href="#Analyzer-1599"><span class="linenos">1599</span></a>                <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">val_set</span><span class="p">[</span><span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">]],</span> <span class="n">val_set_miles</span><span class="p">[</span><span class="s1">&#39;miles&#39;</span><span class="p">],</span>  <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;#555555&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> 
</span><span id="Analyzer-1600"><a href="#Analyzer-1600"><span class="linenos">1600</span></a>                           <span class="n">label</span><span class="o">=</span><span class="n">data_labels</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
</span><span id="Analyzer-1601"><a href="#Analyzer-1601"><span class="linenos">1601</span></a>                
</span><span id="Analyzer-1602"><a href="#Analyzer-1602"><span class="linenos">1602</span></a>                <span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;major&#39;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
</span><span id="Analyzer-1603"><a href="#Analyzer-1603"><span class="linenos">1603</span></a>              
</span><span id="Analyzer-1604"><a href="#Analyzer-1604"><span class="linenos">1604</span></a>                <span class="c1"># add a legend to show the office options</span>
</span><span id="Analyzer-1605"><a href="#Analyzer-1605"><span class="linenos">1605</span></a>                <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper right&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
</span><span id="Analyzer-1606"><a href="#Analyzer-1606"><span class="linenos">1606</span></a>
</span><span id="Analyzer-1607"><a href="#Analyzer-1607"><span class="linenos">1607</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">(</span><span class="n">pad</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
</span><span id="Analyzer-1608"><a href="#Analyzer-1608"><span class="linenos">1608</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">plots_dir</span><span class="o">+</span><span class="s2">&quot;/&quot;</span><span class="o">+</span><span class="n">key</span><span class="o">+</span><span class="s2">&quot;.png&quot;</span><span class="p">)</span>
</span><span id="Analyzer-1609"><a href="#Analyzer-1609"><span class="linenos">1609</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="Analyzer-1610"><a href="#Analyzer-1610"><span class="linenos">1610</span></a>
</span><span id="Analyzer-1611"><a href="#Analyzer-1611"><span class="linenos">1611</span></a>
</span><span id="Analyzer-1612"><a href="#Analyzer-1612"><span class="linenos">1612</span></a>        <span class="c1">############################################################################################################</span>
</span><span id="Analyzer-1613"><a href="#Analyzer-1613"><span class="linenos">1613</span></a>        <span class="c1"># GRAPH:</span>
</span><span id="Analyzer-1614"><a href="#Analyzer-1614"><span class="linenos">1614</span></a>        <span class="c1">## Normalized Commute Distribution Analysis Heat Map</span>
</span><span id="Analyzer-1615"><a href="#Analyzer-1615"><span class="linenos">1615</span></a>        <span class="n">key</span> <span class="o">=</span> <span class="s1">&#39;ncdahm&#39;</span>
</span><span id="Analyzer-1616"><a href="#Analyzer-1616"><span class="linenos">1616</span></a>        <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;Normalized Commute Distribution Analysis Heat Map&quot;</span>
</span><span id="Analyzer-1617"><a href="#Analyzer-1617"><span class="linenos">1617</span></a>        <span class="n">short_title</span> <span class="o">=</span> <span class="n">title</span>
</span><span id="Analyzer-1618"><a href="#Analyzer-1618"><span class="linenos">1618</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">graph_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="p">{</span><span class="s2">&quot;GRAPH&quot;</span><span class="p">:</span> <span class="n">key</span><span class="p">,</span>
</span><span id="Analyzer-1619"><a href="#Analyzer-1619"><span class="linenos">1619</span></a>                                <span class="s2">&quot;TITLE&quot;</span><span class="p">:</span> <span class="n">short_title</span><span class="p">,</span>
</span><span id="Analyzer-1620"><a href="#Analyzer-1620"><span class="linenos">1620</span></a>                                <span class="s2">&quot;FILENAME&quot;</span><span class="p">:</span> <span class="n">key</span><span class="o">+</span><span class="s2">&quot;.png&quot;</span><span class="p">,</span>
</span><span id="Analyzer-1621"><a href="#Analyzer-1621"><span class="linenos">1621</span></a>                                <span class="s2">&quot;PLOT-DESCRIPTION&quot;</span><span class="p">:</span>  <span class="s2">&quot;This graph plots the the normalized commute durations against the distance of the commute in a heat map. &quot;</span> <span class="o">+</span> \
</span><span id="Analyzer-1622"><a href="#Analyzer-1622"><span class="linenos">1622</span></a>                                                    <span class="s2">&quot;The objective is to understand the geography driving any strong departures from average or standard deviation.&quot;</span>
</span><span id="Analyzer-1623"><a href="#Analyzer-1623"><span class="linenos">1623</span></a>                                <span class="p">})</span>
</span><span id="Analyzer-1624"><a href="#Analyzer-1624"><span class="linenos">1624</span></a>        
</span><span id="Analyzer-1625"><a href="#Analyzer-1625"><span class="linenos">1625</span></a>        <span class="k">if</span> <span class="n">graph</span> <span class="o">==</span> <span class="s2">&quot;_all&quot;</span> <span class="ow">or</span> <span class="n">graph</span> <span class="o">==</span> <span class="n">key</span><span class="p">:</span>
</span><span id="Analyzer-1626"><a href="#Analyzer-1626"><span class="linenos">1626</span></a>            <span class="n">office</span> <span class="o">=</span> <span class="n">offices</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">to_frame</span><span class="p">()</span><span class="o">.</span><span class="n">T</span>
</span><span id="Analyzer-1627"><a href="#Analyzer-1627"><span class="linenos">1627</span></a>            <span class="n">values</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;m_morning_duration_in_traffic&#39;</span><span class="p">,</span><span class="s1">&#39;m_evening_duration_in_traffic&#39;</span><span class="p">,</span>
</span><span id="Analyzer-1628"><a href="#Analyzer-1628"><span class="linenos">1628</span></a>                    <span class="s1">&#39;t_morning_duration_in_traffic&#39;</span><span class="p">,</span><span class="s1">&#39;t_evening_duration_in_traffic&#39;</span><span class="p">,</span>
</span><span id="Analyzer-1629"><a href="#Analyzer-1629"><span class="linenos">1629</span></a>                    <span class="s1">&#39;w_morning_duration_in_traffic&#39;</span><span class="p">,</span><span class="s1">&#39;w_evening_duration_in_traffic&#39;</span><span class="p">,</span>
</span><span id="Analyzer-1630"><a href="#Analyzer-1630"><span class="linenos">1630</span></a>                    <span class="s1">&#39;h_morning_duration_in_traffic&#39;</span><span class="p">,</span><span class="s1">&#39;h_evening_duration_in_traffic&#39;</span><span class="p">,</span>
</span><span id="Analyzer-1631"><a href="#Analyzer-1631"><span class="linenos">1631</span></a>                    <span class="s1">&#39;f_morning_duration_in_traffic&#39;</span><span class="p">,</span><span class="s1">&#39;f_evening_duration_in_traffic&#39;</span><span class="p">]</span>
</span><span id="Analyzer-1632"><a href="#Analyzer-1632"><span class="linenos">1632</span></a>            <span class="n">data_labels</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Monday Morning&#39;</span><span class="p">,</span><span class="s1">&#39;Monday Evening&#39;</span><span class="p">,</span>
</span><span id="Analyzer-1633"><a href="#Analyzer-1633"><span class="linenos">1633</span></a>                    <span class="s1">&#39;Tuesday Morning&#39;</span><span class="p">,</span><span class="s1">&#39;Tuesday Evening&#39;</span><span class="p">,</span>
</span><span id="Analyzer-1634"><a href="#Analyzer-1634"><span class="linenos">1634</span></a>                    <span class="s1">&#39;Wednesday Morning&#39;</span><span class="p">,</span><span class="s1">&#39;Wednesday Evening&#39;</span><span class="p">,</span>
</span><span id="Analyzer-1635"><a href="#Analyzer-1635"><span class="linenos">1635</span></a>                    <span class="s1">&#39;Thursday Morning&#39;</span><span class="p">,</span><span class="s1">&#39;Thursday Evening&#39;</span><span class="p">,</span>
</span><span id="Analyzer-1636"><a href="#Analyzer-1636"><span class="linenos">1636</span></a>                    <span class="s1">&#39;Friday Morning&#39;</span><span class="p">,</span><span class="s1">&#39;Friday Evening&#39;</span><span class="p">]</span>
</span><span id="Analyzer-1637"><a href="#Analyzer-1637"><span class="linenos">1637</span></a>            
</span><span id="Analyzer-1638"><a href="#Analyzer-1638"><span class="linenos">1638</span></a>            <span class="n">emp_within</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graphing</span><span class="o">.</span><span class="n">filter_drive_distance</span><span class="p">(</span><span class="n">emp</span><span class="p">,</span><span class="n">office</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">commute_range_cut_off</span><span class="p">,</span> <span class="n">commute_data</span><span class="o">=</span><span class="n">commute_data</span><span class="p">)</span>
</span><span id="Analyzer-1639"><a href="#Analyzer-1639"><span class="linenos">1639</span></a>            <span class="n">val_set</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graphing</span><span class="o">.</span><span class="n">get_commute_values</span><span class="p">(</span><span class="n">emp_within</span><span class="p">,</span> <span class="n">office</span><span class="p">,</span> <span class="n">commute_data</span><span class="p">,</span> <span class="n">commute_data</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">to_list</span><span class="p">())</span>
</span><span id="Analyzer-1640"><a href="#Analyzer-1640"><span class="linenos">1640</span></a>            <span class="c1"># restore origin_lat and origin_long to the val_set</span>
</span><span id="Analyzer-1641"><a href="#Analyzer-1641"><span class="linenos">1641</span></a>            <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;origin_lat&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;latitude&#39;</span><span class="p">]</span>
</span><span id="Analyzer-1642"><a href="#Analyzer-1642"><span class="linenos">1642</span></a>            <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;origin_long&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;longitude&#39;</span><span class="p">]</span>
</span><span id="Analyzer-1643"><a href="#Analyzer-1643"><span class="linenos">1643</span></a>            <span class="n">val_set_free</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graphing</span><span class="o">.</span><span class="n">get_commute_values</span><span class="p">(</span><span class="n">emp_within</span><span class="p">,</span> <span class="n">office</span><span class="p">,</span> <span class="n">commute_data</span><span class="p">,</span> <span class="s2">&quot;duration&quot;</span><span class="p">)</span>
</span><span id="Analyzer-1644"><a href="#Analyzer-1644"><span class="linenos">1644</span></a>            <span class="c1"># Normalize the values in val_set by dividing by the corresponding values in val_set_free, and multiplying by 100</span>
</span><span id="Analyzer-1645"><a href="#Analyzer-1645"><span class="linenos">1645</span></a>            <span class="k">for</span> <span class="n">each</span> <span class="ow">in</span> <span class="n">values</span><span class="p">:</span>
</span><span id="Analyzer-1646"><a href="#Analyzer-1646"><span class="linenos">1646</span></a>                <span class="n">val_set</span><span class="p">[</span><span class="n">each</span><span class="p">]</span> <span class="o">=</span> <span class="n">val_set</span><span class="p">[</span><span class="n">each</span><span class="p">]</span> <span class="o">/</span> <span class="n">val_set_free</span><span class="p">[</span><span class="s1">&#39;duration&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">100</span>
</span><span id="Analyzer-1647"><a href="#Analyzer-1647"><span class="linenos">1647</span></a>            
</span><span id="Analyzer-1648"><a href="#Analyzer-1648"><span class="linenos">1648</span></a>            <span class="n">plt</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graphing</span><span class="o">.</span><span class="n">get_heatmap</span><span class="p">(</span><span class="n">emp_within</span><span class="p">,</span> <span class="n">office</span><span class="p">,</span> <span class="n">val_set</span><span class="p">,</span> <span class="n">values</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span> 
</span><span id="Analyzer-1649"><a href="#Analyzer-1649"><span class="linenos">1649</span></a>                                                <span class="n">value_label</span><span class="o">=</span><span class="s2">&quot;Normalized Commute in Traffic (% vs. Free)&quot;</span><span class="p">,</span> <span class="n">cutoff_distance</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">commute_range_cut_off</span><span class="p">,</span> <span class="n">commute_radius</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">commute_range_cut_off</span><span class="p">,</span>
</span><span id="Analyzer-1650"><a href="#Analyzer-1650"><span class="linenos">1650</span></a>                                                <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;jet&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">levels</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">font_mod</span><span class="o">=</span><span class="mf">1.5</span><span class="p">)</span>
</span><span id="Analyzer-1651"><a href="#Analyzer-1651"><span class="linenos">1651</span></a>
</span><span id="Analyzer-1652"><a href="#Analyzer-1652"><span class="linenos">1652</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">(</span><span class="n">pad</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
</span><span id="Analyzer-1653"><a href="#Analyzer-1653"><span class="linenos">1653</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">plots_dir</span><span class="o">+</span><span class="s2">&quot;/&quot;</span><span class="o">+</span><span class="n">key</span><span class="o">+</span><span class="s2">&quot;.png&quot;</span><span class="p">)</span>
</span><span id="Analyzer-1654"><a href="#Analyzer-1654"><span class="linenos">1654</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="Analyzer-1655"><a href="#Analyzer-1655"><span class="linenos">1655</span></a>            
</span><span id="Analyzer-1656"><a href="#Analyzer-1656"><span class="linenos">1656</span></a>        <span class="c1">################################################################################</span>
</span><span id="Analyzer-1657"><a href="#Analyzer-1657"><span class="linenos">1657</span></a>        <span class="c1">### GRAPH SET: Local Analysis for Office X</span>
</span><span id="Analyzer-1658"><a href="#Analyzer-1658"><span class="linenos">1658</span></a>        <span class="c1"># iterate through offices, generate a graph for each office</span>
</span><span id="Analyzer-1659"><a href="#Analyzer-1659"><span class="linenos">1659</span></a>        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">offices</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>    
</span><span id="Analyzer-1660"><a href="#Analyzer-1660"><span class="linenos">1660</span></a>        <span class="c1">############################################################################################################</span>
</span><span id="Analyzer-1661"><a href="#Analyzer-1661"><span class="linenos">1661</span></a>            <span class="c1"># GRAPH:</span>
</span><span id="Analyzer-1662"><a href="#Analyzer-1662"><span class="linenos">1662</span></a>            <span class="c1">## Normalized Commute Standard Deviation Analysis</span>
</span><span id="Analyzer-1663"><a href="#Analyzer-1663"><span class="linenos">1663</span></a>            <span class="n">key</span> <span class="o">=</span> <span class="s1">&#39;ncsda&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
</span><span id="Analyzer-1664"><a href="#Analyzer-1664"><span class="linenos">1664</span></a>            <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;Normalized Commute Standard Deviation Analysis&quot;</span> <span class="o">+</span> <span class="s2">&quot; for </span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;address&quot;</span><span class="p">]</span>
</span><span id="Analyzer-1665"><a href="#Analyzer-1665"><span class="linenos">1665</span></a>            <span class="n">short_title</span> <span class="o">=</span> <span class="n">title</span>
</span><span id="Analyzer-1666"><a href="#Analyzer-1666"><span class="linenos">1666</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">graph_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="p">{</span><span class="s2">&quot;GRAPH&quot;</span><span class="p">:</span> <span class="n">key</span><span class="p">,</span>
</span><span id="Analyzer-1667"><a href="#Analyzer-1667"><span class="linenos">1667</span></a>                                    <span class="s2">&quot;TITLE&quot;</span><span class="p">:</span> <span class="n">short_title</span><span class="p">,</span>
</span><span id="Analyzer-1668"><a href="#Analyzer-1668"><span class="linenos">1668</span></a>                                    <span class="s2">&quot;FILENAME&quot;</span><span class="p">:</span> <span class="n">key</span><span class="o">+</span><span class="s2">&quot;.png&quot;</span><span class="p">,</span>
</span><span id="Analyzer-1669"><a href="#Analyzer-1669"><span class="linenos">1669</span></a>                                    <span class="s2">&quot;PLOT-DESCRIPTION&quot;</span><span class="p">:</span>  <span class="s2">&quot;This graph shows the per-employee distribution of standard deviation to assess the &quot;</span> <span class="o">+</span> \
</span><span id="Analyzer-1670"><a href="#Analyzer-1670"><span class="linenos">1670</span></a>                                    <span class="s2">&quot;validity of using the average commute time as a metric for comparison.  This analysis is specific to the &quot;</span> <span class="o">+</span> \
</span><span id="Analyzer-1671"><a href="#Analyzer-1671"><span class="linenos">1671</span></a>                                    <span class="s2">&quot;office location at &quot;</span> <span class="o">+</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;address&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;.&quot;</span>
</span><span id="Analyzer-1672"><a href="#Analyzer-1672"><span class="linenos">1672</span></a>                                    <span class="p">})</span>
</span><span id="Analyzer-1673"><a href="#Analyzer-1673"><span class="linenos">1673</span></a>            
</span><span id="Analyzer-1674"><a href="#Analyzer-1674"><span class="linenos">1674</span></a>            <span class="k">if</span> <span class="n">graph</span> <span class="o">==</span> <span class="s2">&quot;_all&quot;</span> <span class="ow">or</span> <span class="n">graph</span> <span class="o">==</span> <span class="n">key</span><span class="p">:</span>
</span><span id="Analyzer-1675"><a href="#Analyzer-1675"><span class="linenos">1675</span></a>                <span class="n">office</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">to_frame</span><span class="p">()</span><span class="o">.</span><span class="n">T</span>
</span><span id="Analyzer-1676"><a href="#Analyzer-1676"><span class="linenos">1676</span></a>                <span class="n">values</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;m_morning_duration_in_traffic&#39;</span><span class="p">,</span><span class="s1">&#39;m_evening_duration_in_traffic&#39;</span><span class="p">,</span>
</span><span id="Analyzer-1677"><a href="#Analyzer-1677"><span class="linenos">1677</span></a>                        <span class="s1">&#39;t_morning_duration_in_traffic&#39;</span><span class="p">,</span><span class="s1">&#39;t_evening_duration_in_traffic&#39;</span><span class="p">,</span>
</span><span id="Analyzer-1678"><a href="#Analyzer-1678"><span class="linenos">1678</span></a>                        <span class="s1">&#39;w_morning_duration_in_traffic&#39;</span><span class="p">,</span><span class="s1">&#39;w_evening_duration_in_traffic&#39;</span><span class="p">,</span>
</span><span id="Analyzer-1679"><a href="#Analyzer-1679"><span class="linenos">1679</span></a>                        <span class="s1">&#39;h_morning_duration_in_traffic&#39;</span><span class="p">,</span><span class="s1">&#39;h_evening_duration_in_traffic&#39;</span><span class="p">,</span>
</span><span id="Analyzer-1680"><a href="#Analyzer-1680"><span class="linenos">1680</span></a>                        <span class="s1">&#39;f_morning_duration_in_traffic&#39;</span><span class="p">,</span><span class="s1">&#39;f_evening_duration_in_traffic&#39;</span><span class="p">]</span>
</span><span id="Analyzer-1681"><a href="#Analyzer-1681"><span class="linenos">1681</span></a>
</span><span id="Analyzer-1682"><a href="#Analyzer-1682"><span class="linenos">1682</span></a>                <span class="n">emp_within</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graphing</span><span class="o">.</span><span class="n">filter_drive_distance</span><span class="p">(</span><span class="n">emp</span><span class="p">,</span><span class="n">office</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">commute_range_cut_off</span><span class="p">,</span> <span class="n">commute_data</span><span class="o">=</span><span class="n">commute_data</span><span class="p">)</span>
</span><span id="Analyzer-1683"><a href="#Analyzer-1683"><span class="linenos">1683</span></a>                <span class="n">val_set</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graphing</span><span class="o">.</span><span class="n">get_commute_values</span><span class="p">(</span><span class="n">emp_within</span><span class="p">,</span> <span class="n">office</span><span class="p">,</span> <span class="n">commute_data</span><span class="p">,</span> <span class="n">values</span><span class="p">)</span>
</span><span id="Analyzer-1684"><a href="#Analyzer-1684"><span class="linenos">1684</span></a>                <span class="n">val_set_free</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graphing</span><span class="o">.</span><span class="n">get_commute_values</span><span class="p">(</span><span class="n">emp_within</span><span class="p">,</span> <span class="n">office</span><span class="p">,</span> <span class="n">commute_data</span><span class="p">,</span> <span class="s2">&quot;duration&quot;</span><span class="p">)</span>
</span><span id="Analyzer-1685"><a href="#Analyzer-1685"><span class="linenos">1685</span></a>                <span class="n">val_set_miles</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graphing</span><span class="o">.</span><span class="n">get_commute_values</span><span class="p">(</span><span class="n">emp_within</span><span class="p">,</span> <span class="n">office</span><span class="p">,</span> <span class="n">commute_data</span><span class="p">,</span> <span class="s2">&quot;miles&quot;</span><span class="p">)</span>
</span><span id="Analyzer-1686"><a href="#Analyzer-1686"><span class="linenos">1686</span></a>                
</span><span id="Analyzer-1687"><a href="#Analyzer-1687"><span class="linenos">1687</span></a>                <span class="n">mean</span> <span class="o">=</span> <span class="n">val_set</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="n">values</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="Analyzer-1688"><a href="#Analyzer-1688"><span class="linenos">1688</span></a>                <span class="n">std</span> <span class="o">=</span> <span class="n">val_set</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="n">values</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="Analyzer-1689"><a href="#Analyzer-1689"><span class="linenos">1689</span></a>                <span class="n">max_val</span> <span class="o">=</span> <span class="n">val_set</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="n">values</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="Analyzer-1690"><a href="#Analyzer-1690"><span class="linenos">1690</span></a>                <span class="n">min_val</span> <span class="o">=</span> <span class="n">val_set</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="n">values</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="Analyzer-1691"><a href="#Analyzer-1691"><span class="linenos">1691</span></a>                <span class="n">data_labels</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Mean&#39;</span><span class="p">,</span><span class="s1">&#39;Standard Deviation&#39;</span><span class="p">,</span><span class="s1">&#39;Max&#39;</span><span class="p">,</span><span class="s1">&#39;Min&#39;</span><span class="p">]</span>
</span><span id="Analyzer-1692"><a href="#Analyzer-1692"><span class="linenos">1692</span></a>                <span class="n">x</span> <span class="o">=</span> <span class="p">[</span><span class="n">mean</span><span class="p">,</span> <span class="n">std</span><span class="p">,</span> <span class="n">max_val</span><span class="p">,</span> <span class="n">min_val</span><span class="p">]</span>
</span><span id="Analyzer-1693"><a href="#Analyzer-1693"><span class="linenos">1693</span></a>                <span class="c1"># Normalize the values in val_set by dividing by the corresponding values in val_set_free, and multiplying by 100</span>
</span><span id="Analyzer-1694"><a href="#Analyzer-1694"><span class="linenos">1694</span></a>                <span class="c1">#for each in values:</span>
</span><span id="Analyzer-1695"><a href="#Analyzer-1695"><span class="linenos">1695</span></a>                <span class="c1">#   val_set[each] = val_set[each] / val_set_free[&#39;duration&#39;] * 100</span>
</span><span id="Analyzer-1696"><a href="#Analyzer-1696"><span class="linenos">1696</span></a>
</span><span id="Analyzer-1697"><a href="#Analyzer-1697"><span class="linenos">1697</span></a>                <span class="n">plt</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graphing</span><span class="o">.</span><span class="n">get_scatterplot</span><span class="p">(</span><span class="n">emp</span><span class="p">,</span> <span class="n">office</span><span class="p">,</span> <span class="n">commute_data</span><span class="p">,</span> <span class="s2">&quot;miles&quot;</span><span class="p">,</span> <span class="s2">&quot;duration&quot;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span> <span class="n">x_label</span><span class="o">=</span><span class="s1">&#39;Duration (min)&#39;</span><span class="p">,</span> 
</span><span id="Analyzer-1698"><a href="#Analyzer-1698"><span class="linenos">1698</span></a>                                                        <span class="n">y_label</span><span class="o">=</span><span class="s1">&#39;Commute Distance (miles)&#39;</span><span class="p">,</span>
</span><span id="Analyzer-1699"><a href="#Analyzer-1699"><span class="linenos">1699</span></a>                                                        <span class="n">cutoff_radius</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">commute_range_cut_off</span><span class="p">,</span> <span class="n">commute_radius</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">commute_range_cut_off</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">15</span><span class="p">),</span> <span class="n">manual_plot</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">font_mod</span><span class="o">=</span><span class="mf">1.5</span><span class="p">)</span>
</span><span id="Analyzer-1700"><a href="#Analyzer-1700"><span class="linenos">1700</span></a>                
</span><span id="Analyzer-1701"><a href="#Analyzer-1701"><span class="linenos">1701</span></a>                <span class="c1"># manually add scatter plots for each day</span>
</span><span id="Analyzer-1702"><a href="#Analyzer-1702"><span class="linenos">1702</span></a>                <span class="c1">#for i in range(len(data_labels)):</span>
</span><span id="Analyzer-1703"><a href="#Analyzer-1703"><span class="linenos">1703</span></a>                <span class="n">i</span><span class="o">=</span><span class="mi">1</span>
</span><span id="Analyzer-1704"><a href="#Analyzer-1704"><span class="linenos">1704</span></a>                <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">val_set_miles</span><span class="p">[</span><span class="s1">&#39;miles&#39;</span><span class="p">],</span>  <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;#555555&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
</span><span id="Analyzer-1705"><a href="#Analyzer-1705"><span class="linenos">1705</span></a>                            <span class="n">label</span><span class="o">=</span><span class="n">data_labels</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</span><span id="Analyzer-1706"><a href="#Analyzer-1706"><span class="linenos">1706</span></a>                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">val_set</span><span class="p">)):</span>
</span><span id="Analyzer-1707"><a href="#Analyzer-1707"><span class="linenos">1707</span></a>                    <span class="c1"># add end bars to the lines</span>
</span><span id="Analyzer-1708"><a href="#Analyzer-1708"><span class="linenos">1708</span></a>                    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">min_val</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">max_val</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span><span class="p">]],</span> <span class="p">[</span><span class="n">val_set_miles</span><span class="p">[</span><span class="s1">&#39;miles&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">val_set_miles</span><span class="p">[</span><span class="s1">&#39;miles&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span><span class="p">]],</span> <span class="s1">&#39;k-&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;|&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>   
</span><span id="Analyzer-1709"><a href="#Analyzer-1709"><span class="linenos">1709</span></a>
</span><span id="Analyzer-1710"><a href="#Analyzer-1710"><span class="linenos">1710</span></a>                <span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;major&#39;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
</span><span id="Analyzer-1711"><a href="#Analyzer-1711"><span class="linenos">1711</span></a>                
</span><span id="Analyzer-1712"><a href="#Analyzer-1712"><span class="linenos">1712</span></a>                <span class="c1"># add a legend to show the office options</span>
</span><span id="Analyzer-1713"><a href="#Analyzer-1713"><span class="linenos">1713</span></a>                <span class="c1"># add a legend entry for the label=&#39;Min/Max Spread&#39;</span>
</span><span id="Analyzer-1714"><a href="#Analyzer-1714"><span class="linenos">1714</span></a>                <span class="n">handles</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_legend_handles_labels</span><span class="p">()</span>
</span><span id="Analyzer-1715"><a href="#Analyzer-1715"><span class="linenos">1715</span></a>                <span class="n">new_handle</span> <span class="o">=</span> <span class="n">Line2D</span><span class="p">([],</span> <span class="p">[],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Min/Max Spread&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;|&#39;</span><span class="p">)</span>
</span><span id="Analyzer-1716"><a href="#Analyzer-1716"><span class="linenos">1716</span></a>                <span class="n">new_label</span> <span class="o">=</span> <span class="s1">&#39;In-Traffic Min/Max Spread for Week (miles)&#39;</span>
</span><span id="Analyzer-1717"><a href="#Analyzer-1717"><span class="linenos">1717</span></a>                <span class="n">handles</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_handle</span><span class="p">)</span>
</span><span id="Analyzer-1718"><a href="#Analyzer-1718"><span class="linenos">1718</span></a>                <span class="n">labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_label</span><span class="p">)</span>
</span><span id="Analyzer-1719"><a href="#Analyzer-1719"><span class="linenos">1719</span></a>            
</span><span id="Analyzer-1720"><a href="#Analyzer-1720"><span class="linenos">1720</span></a>                <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">handles</span><span class="o">=</span><span class="n">handles</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="n">labels</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;lower right&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
</span><span id="Analyzer-1721"><a href="#Analyzer-1721"><span class="linenos">1721</span></a>                
</span><span id="Analyzer-1722"><a href="#Analyzer-1722"><span class="linenos">1722</span></a>                <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">(</span><span class="n">pad</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
</span><span id="Analyzer-1723"><a href="#Analyzer-1723"><span class="linenos">1723</span></a>                <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">plots_dir</span><span class="o">+</span><span class="s2">&quot;/&quot;</span><span class="o">+</span><span class="n">key</span><span class="o">+</span><span class="s2">&quot;.png&quot;</span><span class="p">)</span>
</span><span id="Analyzer-1724"><a href="#Analyzer-1724"><span class="linenos">1724</span></a>                <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="Analyzer-1725"><a href="#Analyzer-1725"><span class="linenos">1725</span></a>            
</span><span id="Analyzer-1726"><a href="#Analyzer-1726"><span class="linenos">1726</span></a>
</span><span id="Analyzer-1727"><a href="#Analyzer-1727"><span class="linenos">1727</span></a>        <span class="c1">################################################################################</span>
</span><span id="Analyzer-1728"><a href="#Analyzer-1728"><span class="linenos">1728</span></a>        <span class="c1">### GRAPH SET: Local Analysis for Office X</span>
</span><span id="Analyzer-1729"><a href="#Analyzer-1729"><span class="linenos">1729</span></a>        <span class="c1"># iterate through offices, generate a graph for each office</span>
</span><span id="Analyzer-1730"><a href="#Analyzer-1730"><span class="linenos">1730</span></a>        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">offices</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>    
</span><span id="Analyzer-1731"><a href="#Analyzer-1731"><span class="linenos">1731</span></a>        <span class="c1">############################################################################################################</span>
</span><span id="Analyzer-1732"><a href="#Analyzer-1732"><span class="linenos">1732</span></a>            <span class="c1"># GRAPH:</span>
</span><span id="Analyzer-1733"><a href="#Analyzer-1733"><span class="linenos">1733</span></a>            <span class="c1">## Time-Based Commute Cost Analysis</span>
</span><span id="Analyzer-1734"><a href="#Analyzer-1734"><span class="linenos">1734</span></a>            <span class="n">key</span> <span class="o">=</span> <span class="s1">&#39;tbcca&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
</span><span id="Analyzer-1735"><a href="#Analyzer-1735"><span class="linenos">1735</span></a>            <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;Time-Based Commute Cost Analysis&quot;</span> <span class="o">+</span> <span class="s2">&quot; for </span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;address&quot;</span><span class="p">]</span>
</span><span id="Analyzer-1736"><a href="#Analyzer-1736"><span class="linenos">1736</span></a>            <span class="n">short_title</span> <span class="o">=</span> <span class="n">title</span>
</span><span id="Analyzer-1737"><a href="#Analyzer-1737"><span class="linenos">1737</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">graph_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="p">{</span><span class="s2">&quot;GRAPH&quot;</span><span class="p">:</span> <span class="n">key</span><span class="p">,</span>
</span><span id="Analyzer-1738"><a href="#Analyzer-1738"><span class="linenos">1738</span></a>                                    <span class="s2">&quot;TITLE&quot;</span><span class="p">:</span> <span class="n">short_title</span><span class="p">,</span>
</span><span id="Analyzer-1739"><a href="#Analyzer-1739"><span class="linenos">1739</span></a>                                    <span class="s2">&quot;FILENAME&quot;</span><span class="p">:</span> <span class="n">key</span><span class="o">+</span><span class="s2">&quot;.png&quot;</span><span class="p">,</span>
</span><span id="Analyzer-1740"><a href="#Analyzer-1740"><span class="linenos">1740</span></a>                                    <span class="s2">&quot;PLOT-DESCRIPTION&quot;</span><span class="p">:</span>  <span class="s2">&quot;This graph shows the average and high/conservative cost of employees commuting to &quot;</span> <span class="o">+</span> \
</span><span id="Analyzer-1741"><a href="#Analyzer-1741"><span class="linenos">1741</span></a>                                    <span class="s2">&quot;the office location at &quot;</span> <span class="o">+</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;address&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;. The average cost is based upon the morning average and evening &quot;</span> <span class="o">+</span> \
</span><span id="Analyzer-1742"><a href="#Analyzer-1742"><span class="linenos">1742</span></a>                                    <span class="s2">&quot;average commute times, while the high/conservative cost is based upon the highest morning maximum and evening values for &quot;</span> <span class="o">+</span> \
</span><span id="Analyzer-1743"><a href="#Analyzer-1743"><span class="linenos">1743</span></a>                                    <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">commute_days_per_week</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; days per week.&quot;</span>
</span><span id="Analyzer-1744"><a href="#Analyzer-1744"><span class="linenos">1744</span></a>                                    <span class="p">})</span>
</span><span id="Analyzer-1745"><a href="#Analyzer-1745"><span class="linenos">1745</span></a>            
</span><span id="Analyzer-1746"><a href="#Analyzer-1746"><span class="linenos">1746</span></a>            <span class="k">if</span> <span class="n">graph</span> <span class="o">==</span> <span class="s2">&quot;_all&quot;</span> <span class="ow">or</span> <span class="n">graph</span> <span class="o">==</span> <span class="n">key</span><span class="p">:</span>
</span><span id="Analyzer-1747"><a href="#Analyzer-1747"><span class="linenos">1747</span></a>                <span class="n">office</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">to_frame</span><span class="p">()</span><span class="o">.</span><span class="n">T</span>
</span><span id="Analyzer-1748"><a href="#Analyzer-1748"><span class="linenos">1748</span></a>
</span><span id="Analyzer-1749"><a href="#Analyzer-1749"><span class="linenos">1749</span></a>                <span class="c1"># get the needed commute values</span>
</span><span id="Analyzer-1750"><a href="#Analyzer-1750"><span class="linenos">1750</span></a>                <span class="n">values</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;m_morning_duration_in_traffic&#39;</span><span class="p">,</span><span class="s1">&#39;m_evening_duration_in_traffic&#39;</span><span class="p">,</span>
</span><span id="Analyzer-1751"><a href="#Analyzer-1751"><span class="linenos">1751</span></a>                        <span class="s1">&#39;t_morning_duration_in_traffic&#39;</span><span class="p">,</span><span class="s1">&#39;t_evening_duration_in_traffic&#39;</span><span class="p">,</span>
</span><span id="Analyzer-1752"><a href="#Analyzer-1752"><span class="linenos">1752</span></a>                        <span class="s1">&#39;w_morning_duration_in_traffic&#39;</span><span class="p">,</span><span class="s1">&#39;w_evening_duration_in_traffic&#39;</span><span class="p">,</span>
</span><span id="Analyzer-1753"><a href="#Analyzer-1753"><span class="linenos">1753</span></a>                        <span class="s1">&#39;h_morning_duration_in_traffic&#39;</span><span class="p">,</span><span class="s1">&#39;h_evening_duration_in_traffic&#39;</span><span class="p">,</span>
</span><span id="Analyzer-1754"><a href="#Analyzer-1754"><span class="linenos">1754</span></a>                        <span class="s1">&#39;f_morning_duration_in_traffic&#39;</span><span class="p">,</span><span class="s1">&#39;f_evening_duration_in_traffic&#39;</span><span class="p">]</span>
</span><span id="Analyzer-1755"><a href="#Analyzer-1755"><span class="linenos">1755</span></a>                
</span><span id="Analyzer-1756"><a href="#Analyzer-1756"><span class="linenos">1756</span></a>                <span class="n">mornings</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;m_morning_duration_in_traffic&#39;</span><span class="p">,</span><span class="s1">&#39;t_morning_duration_in_traffic&#39;</span><span class="p">,</span><span class="s1">&#39;w_morning_duration_in_traffic&#39;</span><span class="p">,</span><span class="s1">&#39;h_morning_duration_in_traffic&#39;</span><span class="p">,</span><span class="s1">&#39;f_morning_duration_in_traffic&#39;</span><span class="p">]</span>
</span><span id="Analyzer-1757"><a href="#Analyzer-1757"><span class="linenos">1757</span></a>                <span class="n">evenings</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;m_evening_duration_in_traffic&#39;</span><span class="p">,</span><span class="s1">&#39;t_evening_duration_in_traffic&#39;</span><span class="p">,</span><span class="s1">&#39;w_evening_duration_in_traffic&#39;</span><span class="p">,</span><span class="s1">&#39;h_evening_duration_in_traffic&#39;</span><span class="p">,</span><span class="s1">&#39;f_evening_duration_in_traffic&#39;</span><span class="p">]</span>
</span><span id="Analyzer-1758"><a href="#Analyzer-1758"><span class="linenos">1758</span></a>                <span class="n">cdpw</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">commute_days_per_week</span>
</span><span id="Analyzer-1759"><a href="#Analyzer-1759"><span class="linenos">1759</span></a>
</span><span id="Analyzer-1760"><a href="#Analyzer-1760"><span class="linenos">1760</span></a>                <span class="n">emp_within</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graphing</span><span class="o">.</span><span class="n">filter_drive_distance</span><span class="p">(</span><span class="n">emp</span><span class="p">,</span><span class="n">office</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">commute_range_cut_off</span><span class="p">,</span> <span class="n">commute_data</span><span class="o">=</span><span class="n">commute_data</span><span class="p">)</span>
</span><span id="Analyzer-1761"><a href="#Analyzer-1761"><span class="linenos">1761</span></a>                <span class="n">val_set</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graphing</span><span class="o">.</span><span class="n">get_commute_values</span><span class="p">(</span><span class="n">emp_within</span><span class="p">,</span> <span class="n">office</span><span class="p">,</span> <span class="n">commute_data</span><span class="p">,</span> <span class="n">values</span><span class="p">)</span>
</span><span id="Analyzer-1762"><a href="#Analyzer-1762"><span class="linenos">1762</span></a>                
</span><span id="Analyzer-1763"><a href="#Analyzer-1763"><span class="linenos">1763</span></a>                
</span><span id="Analyzer-1764"><a href="#Analyzer-1764"><span class="linenos">1764</span></a>
</span><span id="Analyzer-1765"><a href="#Analyzer-1765"><span class="linenos">1765</span></a>                <span class="c1"># Calculate and insert the average morning and evening commute times directly into val_set</span>
</span><span id="Analyzer-1766"><a href="#Analyzer-1766"><span class="linenos">1766</span></a>                <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;Morning Average&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">val_set</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">mornings</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="Analyzer-1767"><a href="#Analyzer-1767"><span class="linenos">1767</span></a>                <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;Evening Average&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">val_set</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">evenings</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="Analyzer-1768"><a href="#Analyzer-1768"><span class="linenos">1768</span></a>
</span><span id="Analyzer-1769"><a href="#Analyzer-1769"><span class="linenos">1769</span></a>                <span class="c1"># Calculate and insert the top &#39;cdpw&#39; maximum morning and evening commute times</span>
</span><span id="Analyzer-1770"><a href="#Analyzer-1770"><span class="linenos">1770</span></a>                <span class="c1"># Note: Adjust the code below to calculate the averages of the top &#39;cdpw&#39; as new columns directly</span>
</span><span id="Analyzer-1771"><a href="#Analyzer-1771"><span class="linenos">1771</span></a>                <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;Average Top CDPW Morning&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">val_set</span><span class="p">[</span><span class="n">mornings</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="n">row</span><span class="o">.</span><span class="n">nlargest</span><span class="p">(</span><span class="n">cdpw</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="Analyzer-1772"><a href="#Analyzer-1772"><span class="linenos">1772</span></a>                <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;Average Top CDPW Evening&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">val_set</span><span class="p">[</span><span class="n">evenings</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="n">row</span><span class="o">.</span><span class="n">nlargest</span><span class="p">(</span><span class="n">cdpw</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="Analyzer-1773"><a href="#Analyzer-1773"><span class="linenos">1773</span></a>
</span><span id="Analyzer-1774"><a href="#Analyzer-1774"><span class="linenos">1774</span></a>                <span class="c1"># Calculate a per-minute cost based on &quot;median_salary&quot; and &quot;hours_per_year&quot;</span>
</span><span id="Analyzer-1775"><a href="#Analyzer-1775"><span class="linenos">1775</span></a>                <span class="n">per_minute_cost</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">median_salary</span> <span class="o">/</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">hours_per_year</span> <span class="o">*</span> <span class="mi">60</span><span class="p">)</span>
</span><span id="Analyzer-1776"><a href="#Analyzer-1776"><span class="linenos">1776</span></a>
</span><span id="Analyzer-1777"><a href="#Analyzer-1777"><span class="linenos">1777</span></a>                <span class="c1"># Calculate and insert the average cost for the week directly into val_set</span>
</span><span id="Analyzer-1778"><a href="#Analyzer-1778"><span class="linenos">1778</span></a>                <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;Morning Average Cost&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;Morning Average&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">per_minute_cost</span>
</span><span id="Analyzer-1779"><a href="#Analyzer-1779"><span class="linenos">1779</span></a>                <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;Evening Average Cost&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;Evening Average&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">per_minute_cost</span>
</span><span id="Analyzer-1780"><a href="#Analyzer-1780"><span class="linenos">1780</span></a>
</span><span id="Analyzer-1781"><a href="#Analyzer-1781"><span class="linenos">1781</span></a>                <span class="c1"># Calculate and insert the high/conservative cost for the week directly into val_set</span>
</span><span id="Analyzer-1782"><a href="#Analyzer-1782"><span class="linenos">1782</span></a>                <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;Morning High Cost&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;Average Top CDPW Morning&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">per_minute_cost</span>
</span><span id="Analyzer-1783"><a href="#Analyzer-1783"><span class="linenos">1783</span></a>                <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;Evening High Cost&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;Average Top CDPW Evening&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">per_minute_cost</span>
</span><span id="Analyzer-1784"><a href="#Analyzer-1784"><span class="linenos">1784</span></a>
</span><span id="Analyzer-1785"><a href="#Analyzer-1785"><span class="linenos">1785</span></a>                <span class="c1"># create bins based on the max value of the data</span>
</span><span id="Analyzer-1786"><a href="#Analyzer-1786"><span class="linenos">1786</span></a>                <span class="n">binmax</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Analyzer-1787"><a href="#Analyzer-1787"><span class="linenos">1787</span></a>                <span class="k">for</span> <span class="n">each</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;Morning Average Cost&#39;</span><span class="p">,</span><span class="s1">&#39;Evening Average Cost&#39;</span><span class="p">,</span><span class="s1">&#39;Morning High Cost&#39;</span><span class="p">,</span><span class="s1">&#39;Evening High Cost&#39;</span><span class="p">]:</span>
</span><span id="Analyzer-1788"><a href="#Analyzer-1788"><span class="linenos">1788</span></a>                    <span class="k">if</span> <span class="nb">max</span><span class="p">(</span><span class="n">val_set</span><span class="p">[</span><span class="n">each</span><span class="p">])</span> <span class="o">&gt;</span> <span class="n">binmax</span><span class="p">:</span>
</span><span id="Analyzer-1789"><a href="#Analyzer-1789"><span class="linenos">1789</span></a>                        <span class="n">binmax</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">val_set</span><span class="p">[</span><span class="n">each</span><span class="p">])</span>
</span><span id="Analyzer-1790"><a href="#Analyzer-1790"><span class="linenos">1790</span></a>                <span class="n">step</span> <span class="o">=</span> <span class="mi">5</span>
</span><span id="Analyzer-1791"><a href="#Analyzer-1791"><span class="linenos">1791</span></a>                <span class="c1"># round the binmax up to the nearest step</span>
</span><span id="Analyzer-1792"><a href="#Analyzer-1792"><span class="linenos">1792</span></a>                <span class="n">bins</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">binmax</span> <span class="o">+</span> <span class="n">step</span> <span class="o">-</span> <span class="p">(</span><span class="n">binmax</span> <span class="o">%</span> <span class="n">step</span><span class="p">)),</span> <span class="n">step</span><span class="p">)</span>
</span><span id="Analyzer-1793"><a href="#Analyzer-1793"><span class="linenos">1793</span></a>                
</span><span id="Analyzer-1794"><a href="#Analyzer-1794"><span class="linenos">1794</span></a>                <span class="n">font_mod</span> <span class="o">=</span> <span class="mf">1.5</span>
</span><span id="Analyzer-1795"><a href="#Analyzer-1795"><span class="linenos">1795</span></a>                <span class="c1"># create histograms for the morning and evening average costs</span>
</span><span id="Analyzer-1796"><a href="#Analyzer-1796"><span class="linenos">1796</span></a>                <span class="n">plt</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graphing</span><span class="o">.</span><span class="n">get_histogram</span><span class="p">(</span><span class="n">emp</span><span class="p">,</span> <span class="n">office</span><span class="p">,</span> <span class="n">commute_data</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;m_morning_duration_in_traffic&#39;</span><span class="p">,</span><span class="s1">&#39;m_evening_duration_in_traffic&#39;</span><span class="p">],</span> 
</span><span id="Analyzer-1797"><a href="#Analyzer-1797"><span class="linenos">1797</span></a>                                                      <span class="n">suptitle</span><span class="o">=</span><span class="s2">&quot;Average and Maximum Time-in-Traffic Costs for </span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;address&#39;</span><span class="p">]),</span> 
</span><span id="Analyzer-1798"><a href="#Analyzer-1798"><span class="linenos">1798</span></a>                                                      <span class="n">cutoff_radius</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">commute_range_cut_off</span><span class="p">,</span>
</span><span id="Analyzer-1799"><a href="#Analyzer-1799"><span class="linenos">1799</span></a>                                      <span class="n">x_label</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="s1">&#39;\$ (USD) based on median salary (converted to per minute)&#39;</span><span class="p">),</span> <span class="n">y_label</span><span class="o">=</span><span class="s1">&#39;# Employees&#39;</span><span class="p">,</span>
</span><span id="Analyzer-1800"><a href="#Analyzer-1800"><span class="linenos">1800</span></a>                                      <span class="n">bins</span><span class="o">=</span><span class="n">bins</span><span class="p">,</span> <span class="n">rows</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">cols</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">column_titles</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Average&quot;</span><span class="p">,</span><span class="s2">&quot;High/Conservative&quot;</span><span class="p">],</span> 
</span><span id="Analyzer-1801"><a href="#Analyzer-1801"><span class="linenos">1801</span></a>                                      <span class="n">cumulative_line</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">font_mod</span><span class="o">=</span><span class="n">font_mod</span><span class="p">,</span> <span class="n">manual_plot</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">sharey</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="Analyzer-1802"><a href="#Analyzer-1802"><span class="linenos">1802</span></a>                <span class="n">plot_vals</span> <span class="o">=</span> <span class="p">[[</span><span class="s1">&#39;Morning Average Cost&#39;</span><span class="p">,</span><span class="s2">&quot;Morning High Cost&quot;</span><span class="p">],[</span><span class="s2">&quot;Evening Average Cost&quot;</span><span class="p">,</span><span class="s2">&quot;Evening High Cost&quot;</span><span class="p">]]</span>
</span><span id="Analyzer-1803"><a href="#Analyzer-1803"><span class="linenos">1803</span></a>                <span class="c1"># manually add histograms for each office option</span>
</span><span id="Analyzer-1804"><a href="#Analyzer-1804"><span class="linenos">1804</span></a>                <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
</span><span id="Analyzer-1805"><a href="#Analyzer-1805"><span class="linenos">1805</span></a>                    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
</span><span id="Analyzer-1806"><a href="#Analyzer-1806"><span class="linenos">1806</span></a>                        <span class="n">ax</span><span class="p">[</span><span class="n">r</span><span class="p">,</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">val_set</span><span class="p">[</span><span class="n">plot_vals</span><span class="p">[</span><span class="n">r</span><span class="p">][</span><span class="n">c</span><span class="p">]],</span> <span class="n">bins</span><span class="o">=</span><span class="n">bins</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;#555555&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">align</span><span class="o">=</span><span class="s1">&#39;mid&#39;</span><span class="p">,</span> 
</span><span id="Analyzer-1807"><a href="#Analyzer-1807"><span class="linenos">1807</span></a>                                <span class="n">rwidth</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">plot_vals</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">(</span><span class="n">r</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>
</span><span id="Analyzer-1808"><a href="#Analyzer-1808"><span class="linenos">1808</span></a>                        <span class="n">ax</span><span class="p">[</span><span class="n">r</span><span class="p">,</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;major&#39;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
</span><span id="Analyzer-1809"><a href="#Analyzer-1809"><span class="linenos">1809</span></a>
</span><span id="Analyzer-1810"><a href="#Analyzer-1810"><span class="linenos">1810</span></a>                        <span class="c1"># add a text box in the upper right corner with the stats</span>
</span><span id="Analyzer-1811"><a href="#Analyzer-1811"><span class="linenos">1811</span></a>                        <span class="n">t</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;me&#39;</span> <span class="p">:</span> <span class="s1">&#39;Median: |$</span><span class="si">{:,.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">val_set</span><span class="p">[</span><span class="n">plot_vals</span><span class="p">[</span><span class="n">r</span><span class="p">][</span><span class="n">c</span><span class="p">]])),</span>
</span><span id="Analyzer-1812"><a href="#Analyzer-1812"><span class="linenos">1812</span></a>                            <span class="s1">&#39;av&#39;</span> <span class="p">:</span> <span class="s1">&#39;Average: |$</span><span class="si">{:,.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">val_set</span><span class="p">[</span><span class="n">plot_vals</span><span class="p">[</span><span class="n">r</span><span class="p">][</span><span class="n">c</span><span class="p">]])),</span>
</span><span id="Analyzer-1813"><a href="#Analyzer-1813"><span class="linenos">1813</span></a>                            <span class="s1">&#39;mi&#39;</span> <span class="p">:</span> <span class="s1">&#39;Min: |$</span><span class="si">{:,.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">val_set</span><span class="p">[</span><span class="n">plot_vals</span><span class="p">[</span><span class="n">r</span><span class="p">][</span><span class="n">c</span><span class="p">]])),</span>
</span><span id="Analyzer-1814"><a href="#Analyzer-1814"><span class="linenos">1814</span></a>                            <span class="s1">&#39;ma&#39;</span> <span class="p">:</span> <span class="s1">&#39;Max: |$</span><span class="si">{:,.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">val_set</span><span class="p">[</span><span class="n">plot_vals</span><span class="p">[</span><span class="n">r</span><span class="p">][</span><span class="n">c</span><span class="p">]])),</span>
</span><span id="Analyzer-1815"><a href="#Analyzer-1815"><span class="linenos">1815</span></a>                            <span class="s1">&#39;to&#39;</span> <span class="p">:</span> <span class="s1">&#39;Total: |$</span><span class="si">{:,.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">val_set</span><span class="p">[</span><span class="n">plot_vals</span><span class="p">[</span><span class="n">r</span><span class="p">][</span><span class="n">c</span><span class="p">]]))</span>
</span><span id="Analyzer-1816"><a href="#Analyzer-1816"><span class="linenos">1816</span></a>                            <span class="p">}</span>
</span><span id="Analyzer-1817"><a href="#Analyzer-1817"><span class="linenos">1817</span></a>                        <span class="c1"># get the longest string value</span>
</span><span id="Analyzer-1818"><a href="#Analyzer-1818"><span class="linenos">1818</span></a>                        <span class="n">max_len</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="s1">&#39;me&#39;</span><span class="p">]),</span><span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="s1">&#39;av&#39;</span><span class="p">]),</span><span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="s1">&#39;to&#39;</span><span class="p">]),</span><span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="s1">&#39;mi&#39;</span><span class="p">]),</span><span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="s1">&#39;ma&#39;</span><span class="p">]))</span>
</span><span id="Analyzer-1819"><a href="#Analyzer-1819"><span class="linenos">1819</span></a>                        <span class="c1"># calculate additional space</span>
</span><span id="Analyzer-1820"><a href="#Analyzer-1820"><span class="linenos">1820</span></a>                        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">t</span><span class="p">:</span>
</span><span id="Analyzer-1821"><a href="#Analyzer-1821"><span class="linenos">1821</span></a>                            <span class="n">t</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">t</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">,</span><span class="s2">&quot; &quot;</span><span class="o">*</span><span class="p">(</span><span class="n">max_len</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="n">k</span><span class="p">])))</span>
</span><span id="Analyzer-1822"><a href="#Analyzer-1822"><span class="linenos">1822</span></a>                        <span class="c1"># add spaces to make all the same length, replacing |</span>
</span><span id="Analyzer-1823"><a href="#Analyzer-1823"><span class="linenos">1823</span></a>                        <span class="n">textstr</span> <span class="o">=</span> <span class="s2">&quot;Commute Time Cost: &quot;</span>
</span><span id="Analyzer-1824"><a href="#Analyzer-1824"><span class="linenos">1824</span></a>                        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">t</span><span class="p">:</span>
</span><span id="Analyzer-1825"><a href="#Analyzer-1825"><span class="linenos">1825</span></a>                            <span class="n">textstr</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">t</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
</span><span id="Analyzer-1826"><a href="#Analyzer-1826"><span class="linenos">1826</span></a>                        <span class="c1"># these are matplotlib.patch.Patch properties</span>
</span><span id="Analyzer-1827"><a href="#Analyzer-1827"><span class="linenos">1827</span></a>                        <span class="n">props</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">boxstyle</span><span class="o">=</span><span class="s1">&#39;round&#39;</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;wheat&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
</span><span id="Analyzer-1828"><a href="#Analyzer-1828"><span class="linenos">1828</span></a>                        <span class="c1"># place a text box in upper right in axes coords,</span>
</span><span id="Analyzer-1829"><a href="#Analyzer-1829"><span class="linenos">1829</span></a>                        <span class="n">ax</span><span class="p">[</span><span class="n">r</span><span class="p">,</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">.95</span><span class="p">,</span> <span class="mf">.75</span><span class="p">,</span> <span class="n">textstr</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="n">r</span><span class="p">,</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">,</span>
</span><span id="Analyzer-1830"><a href="#Analyzer-1830"><span class="linenos">1830</span></a>                                    <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">bbox</span><span class="o">=</span><span class="n">props</span><span class="p">,</span> <span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;family&#39;</span><span class="p">:</span> <span class="s1">&#39;monospace&#39;</span><span class="p">},</span> <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">)</span>
</span><span id="Analyzer-1831"><a href="#Analyzer-1831"><span class="linenos">1831</span></a>                        
</span><span id="Analyzer-1832"><a href="#Analyzer-1832"><span class="linenos">1832</span></a>
</span><span id="Analyzer-1833"><a href="#Analyzer-1833"><span class="linenos">1833</span></a>                        <span class="c1"># for the first column, add morning/evening text box the top left of the plot</span>
</span><span id="Analyzer-1834"><a href="#Analyzer-1834"><span class="linenos">1834</span></a>                        <span class="k">if</span> <span class="n">r</span><span class="o">==</span><span class="mi">0</span> <span class="ow">and</span> <span class="n">c</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Analyzer-1835"><a href="#Analyzer-1835"><span class="linenos">1835</span></a>                            <span class="n">ax</span><span class="p">[</span><span class="n">r</span><span class="p">,</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.85</span><span class="p">,</span> <span class="s1">&#39;Morning&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="o">*</span><span class="n">font_mod</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="n">r</span><span class="p">,</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;top&#39;</span><span class="p">)</span>
</span><span id="Analyzer-1836"><a href="#Analyzer-1836"><span class="linenos">1836</span></a>                        <span class="k">if</span> <span class="n">r</span><span class="o">==</span><span class="mi">1</span> <span class="ow">and</span> <span class="n">c</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Analyzer-1837"><a href="#Analyzer-1837"><span class="linenos">1837</span></a>                            <span class="n">ax</span><span class="p">[</span><span class="n">r</span><span class="p">,</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.85</span><span class="p">,</span> <span class="s1">&#39;Evening&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="o">*</span><span class="n">font_mod</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="n">r</span><span class="p">,</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;top&#39;</span><span class="p">)</span>
</span><span id="Analyzer-1838"><a href="#Analyzer-1838"><span class="linenos">1838</span></a>                            <span class="c1"># set a y axis label for the first column</span>
</span><span id="Analyzer-1839"><a href="#Analyzer-1839"><span class="linenos">1839</span></a>                            <span class="n">ax</span><span class="p">[</span><span class="n">r</span><span class="p">,</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;# Employees&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="o">*</span><span class="n">font_mod</span><span class="p">)</span>
</span><span id="Analyzer-1840"><a href="#Analyzer-1840"><span class="linenos">1840</span></a>                        <span class="k">if</span> <span class="n">r</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
</span><span id="Analyzer-1841"><a href="#Analyzer-1841"><span class="linenos">1841</span></a>                            <span class="n">ax</span><span class="p">[</span><span class="n">r</span><span class="p">,</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Employee Time Cost ($ USD)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="o">*</span><span class="n">font_mod</span><span class="p">)</span>
</span><span id="Analyzer-1842"><a href="#Analyzer-1842"><span class="linenos">1842</span></a>
</span><span id="Analyzer-1843"><a href="#Analyzer-1843"><span class="linenos">1843</span></a>                <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">(</span><span class="n">pad</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
</span><span id="Analyzer-1844"><a href="#Analyzer-1844"><span class="linenos">1844</span></a>                <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">plots_dir</span><span class="o">+</span><span class="s2">&quot;/&quot;</span><span class="o">+</span><span class="n">key</span><span class="o">+</span><span class="s2">&quot;.png&quot;</span><span class="p">)</span>
</span><span id="Analyzer-1845"><a href="#Analyzer-1845"><span class="linenos">1845</span></a>                <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>  
</span><span id="Analyzer-1846"><a href="#Analyzer-1846"><span class="linenos">1846</span></a>
</span><span id="Analyzer-1847"><a href="#Analyzer-1847"><span class="linenos">1847</span></a>
</span><span id="Analyzer-1848"><a href="#Analyzer-1848"><span class="linenos">1848</span></a>        <span class="c1">############################################################################################################</span>
</span><span id="Analyzer-1849"><a href="#Analyzer-1849"><span class="linenos">1849</span></a>        <span class="c1"># GRAPH:</span>
</span><span id="Analyzer-1850"><a href="#Analyzer-1850"><span class="linenos">1850</span></a>        <span class="c1">## Total Commute Cost Analysis</span>
</span><span id="Analyzer-1851"><a href="#Analyzer-1851"><span class="linenos">1851</span></a>        <span class="n">key</span> <span class="o">=</span> <span class="s1">&#39;tcca&#39;</span>
</span><span id="Analyzer-1852"><a href="#Analyzer-1852"><span class="linenos">1852</span></a>        <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;Total Commute Cost Analysis&quot;</span>
</span><span id="Analyzer-1853"><a href="#Analyzer-1853"><span class="linenos">1853</span></a>        <span class="n">short_title</span> <span class="o">=</span> <span class="n">title</span>
</span><span id="Analyzer-1854"><a href="#Analyzer-1854"><span class="linenos">1854</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">graph_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="p">{</span><span class="s2">&quot;GRAPH&quot;</span><span class="p">:</span> <span class="n">key</span><span class="p">,</span>
</span><span id="Analyzer-1855"><a href="#Analyzer-1855"><span class="linenos">1855</span></a>                                <span class="s2">&quot;TITLE&quot;</span><span class="p">:</span> <span class="n">short_title</span><span class="p">,</span>
</span><span id="Analyzer-1856"><a href="#Analyzer-1856"><span class="linenos">1856</span></a>                                <span class="s2">&quot;FILENAME&quot;</span><span class="p">:</span> <span class="n">key</span><span class="o">+</span><span class="s2">&quot;.png&quot;</span><span class="p">,</span>
</span><span id="Analyzer-1857"><a href="#Analyzer-1857"><span class="linenos">1857</span></a>                                <span class="s2">&quot;PLOT-DESCRIPTION&quot;</span><span class="p">:</span>  <span class="s2">&quot;This graph shows the total commute cost incurred by employees based upon mileage &quot;</span> <span class="o">+</span> \
</span><span id="Analyzer-1858"><a href="#Analyzer-1858"><span class="linenos">1858</span></a>                                <span class="s2">&quot; and the average and high/conservative cost of employee time commuting to each office.&quot;</span> <span class="o">+</span> \
</span><span id="Analyzer-1859"><a href="#Analyzer-1859"><span class="linenos">1859</span></a>                                <span class="s2">&quot;The average cost is based upon the morning average and evening &quot;</span> <span class="o">+</span> \
</span><span id="Analyzer-1860"><a href="#Analyzer-1860"><span class="linenos">1860</span></a>                                <span class="s2">&quot;average commute times, while the high/conservative cost is based upon the highest morning maximum and evening values for &quot;</span> <span class="o">+</span> \
</span><span id="Analyzer-1861"><a href="#Analyzer-1861"><span class="linenos">1861</span></a>                                <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">commute_days_per_week</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; days per week.&quot;</span>
</span><span id="Analyzer-1862"><a href="#Analyzer-1862"><span class="linenos">1862</span></a>                                <span class="p">})</span>
</span><span id="Analyzer-1863"><a href="#Analyzer-1863"><span class="linenos">1863</span></a>        <span class="k">if</span> <span class="n">graph</span> <span class="o">==</span> <span class="s2">&quot;_all&quot;</span> <span class="ow">or</span> <span class="n">graph</span> <span class="o">==</span> <span class="n">key</span><span class="p">:</span>
</span><span id="Analyzer-1864"><a href="#Analyzer-1864"><span class="linenos">1864</span></a>            <span class="n">employee_costs_to_office</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="Analyzer-1865"><a href="#Analyzer-1865"><span class="linenos">1865</span></a>
</span><span id="Analyzer-1866"><a href="#Analyzer-1866"><span class="linenos">1866</span></a>            <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">offices</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>    
</span><span id="Analyzer-1867"><a href="#Analyzer-1867"><span class="linenos">1867</span></a>                <span class="n">office</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">to_frame</span><span class="p">()</span><span class="o">.</span><span class="n">T</span>
</span><span id="Analyzer-1868"><a href="#Analyzer-1868"><span class="linenos">1868</span></a>            
</span><span id="Analyzer-1869"><a href="#Analyzer-1869"><span class="linenos">1869</span></a>                <span class="c1"># get the needed commute values</span>
</span><span id="Analyzer-1870"><a href="#Analyzer-1870"><span class="linenos">1870</span></a>                <span class="n">values</span> <span class="o">=</span> <span class="n">commute_data</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span>
</span><span id="Analyzer-1871"><a href="#Analyzer-1871"><span class="linenos">1871</span></a>                
</span><span id="Analyzer-1872"><a href="#Analyzer-1872"><span class="linenos">1872</span></a>                <span class="n">mornings</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;m_morning_duration_in_traffic&#39;</span><span class="p">,</span><span class="s1">&#39;t_morning_duration_in_traffic&#39;</span><span class="p">,</span><span class="s1">&#39;w_morning_duration_in_traffic&#39;</span><span class="p">,</span><span class="s1">&#39;h_morning_duration_in_traffic&#39;</span><span class="p">,</span><span class="s1">&#39;f_morning_duration_in_traffic&#39;</span><span class="p">]</span>
</span><span id="Analyzer-1873"><a href="#Analyzer-1873"><span class="linenos">1873</span></a>                <span class="n">evenings</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;m_evening_duration_in_traffic&#39;</span><span class="p">,</span><span class="s1">&#39;t_evening_duration_in_traffic&#39;</span><span class="p">,</span><span class="s1">&#39;w_evening_duration_in_traffic&#39;</span><span class="p">,</span><span class="s1">&#39;h_evening_duration_in_traffic&#39;</span><span class="p">,</span><span class="s1">&#39;f_evening_duration_in_traffic&#39;</span><span class="p">]</span>
</span><span id="Analyzer-1874"><a href="#Analyzer-1874"><span class="linenos">1874</span></a>                
</span><span id="Analyzer-1875"><a href="#Analyzer-1875"><span class="linenos">1875</span></a>                <span class="n">cdpw</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">commute_days_per_week</span>
</span><span id="Analyzer-1876"><a href="#Analyzer-1876"><span class="linenos">1876</span></a>
</span><span id="Analyzer-1877"><a href="#Analyzer-1877"><span class="linenos">1877</span></a>                <span class="n">emp_within</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graphing</span><span class="o">.</span><span class="n">filter_drive_distance</span><span class="p">(</span><span class="n">emp</span><span class="p">,</span><span class="n">office</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">commute_range_cut_off</span><span class="p">,</span> <span class="n">commute_data</span><span class="o">=</span><span class="n">commute_data</span><span class="p">)</span>
</span><span id="Analyzer-1878"><a href="#Analyzer-1878"><span class="linenos">1878</span></a>                <span class="n">val_set</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graphing</span><span class="o">.</span><span class="n">get_commute_values</span><span class="p">(</span><span class="n">emp_within</span><span class="p">,</span> <span class="n">office</span><span class="p">,</span> <span class="n">commute_data</span><span class="p">,</span> <span class="n">values</span><span class="p">)</span>
</span><span id="Analyzer-1879"><a href="#Analyzer-1879"><span class="linenos">1879</span></a>                
</span><span id="Analyzer-1880"><a href="#Analyzer-1880"><span class="linenos">1880</span></a>                
</span><span id="Analyzer-1881"><a href="#Analyzer-1881"><span class="linenos">1881</span></a>
</span><span id="Analyzer-1882"><a href="#Analyzer-1882"><span class="linenos">1882</span></a>                <span class="c1"># Calculate and insert the average morning and evening commute times directly into val_set</span>
</span><span id="Analyzer-1883"><a href="#Analyzer-1883"><span class="linenos">1883</span></a>                <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;Morning Average&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">val_set</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">mornings</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="Analyzer-1884"><a href="#Analyzer-1884"><span class="linenos">1884</span></a>                <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;Evening Average&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">val_set</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">evenings</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="Analyzer-1885"><a href="#Analyzer-1885"><span class="linenos">1885</span></a>
</span><span id="Analyzer-1886"><a href="#Analyzer-1886"><span class="linenos">1886</span></a>                <span class="c1"># Calculate and insert the top &#39;cdpw&#39; maximum morning and evening commute times</span>
</span><span id="Analyzer-1887"><a href="#Analyzer-1887"><span class="linenos">1887</span></a>                <span class="c1"># Note: Adjust the code below to calculate the averages of the top &#39;cdpw&#39; as new columns directly</span>
</span><span id="Analyzer-1888"><a href="#Analyzer-1888"><span class="linenos">1888</span></a>                <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;Average Top CDPW Morning&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">val_set</span><span class="p">[</span><span class="n">mornings</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="n">row</span><span class="o">.</span><span class="n">nlargest</span><span class="p">(</span><span class="n">cdpw</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="Analyzer-1889"><a href="#Analyzer-1889"><span class="linenos">1889</span></a>                <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;Average Top CDPW Evening&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">val_set</span><span class="p">[</span><span class="n">evenings</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="n">row</span><span class="o">.</span><span class="n">nlargest</span><span class="p">(</span><span class="n">cdpw</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="Analyzer-1890"><a href="#Analyzer-1890"><span class="linenos">1890</span></a>
</span><span id="Analyzer-1891"><a href="#Analyzer-1891"><span class="linenos">1891</span></a>                <span class="c1"># Calculate a per-minute cost based on &quot;median_salary&quot; and &quot;hours_per_year&quot;</span>
</span><span id="Analyzer-1892"><a href="#Analyzer-1892"><span class="linenos">1892</span></a>                <span class="n">per_minute_cost</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">median_salary</span> <span class="o">/</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">hours_per_year</span> <span class="o">*</span> <span class="mi">60</span><span class="p">)</span>
</span><span id="Analyzer-1893"><a href="#Analyzer-1893"><span class="linenos">1893</span></a>
</span><span id="Analyzer-1894"><a href="#Analyzer-1894"><span class="linenos">1894</span></a>                <span class="c1"># Calculate and insert the average cost for the week directly into val_set</span>
</span><span id="Analyzer-1895"><a href="#Analyzer-1895"><span class="linenos">1895</span></a>                <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;Morning Average Cost&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;Morning Average&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">per_minute_cost</span>
</span><span id="Analyzer-1896"><a href="#Analyzer-1896"><span class="linenos">1896</span></a>                <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;Evening Average Cost&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;Evening Average&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">per_minute_cost</span>
</span><span id="Analyzer-1897"><a href="#Analyzer-1897"><span class="linenos">1897</span></a>
</span><span id="Analyzer-1898"><a href="#Analyzer-1898"><span class="linenos">1898</span></a>                <span class="c1"># Calculate and insert the high/conservative cost for the week directly into val_set</span>
</span><span id="Analyzer-1899"><a href="#Analyzer-1899"><span class="linenos">1899</span></a>                <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;Morning High Cost&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;Average Top CDPW Morning&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">per_minute_cost</span>
</span><span id="Analyzer-1900"><a href="#Analyzer-1900"><span class="linenos">1900</span></a>                <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;Evening High Cost&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;Average Top CDPW Evening&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">per_minute_cost</span>
</span><span id="Analyzer-1901"><a href="#Analyzer-1901"><span class="linenos">1901</span></a>
</span><span id="Analyzer-1902"><a href="#Analyzer-1902"><span class="linenos">1902</span></a>                <span class="c1"># Calculate a Total Average Time and Total High Time cost</span>
</span><span id="Analyzer-1903"><a href="#Analyzer-1903"><span class="linenos">1903</span></a>                <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;Total Average Time Cost&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;Morning Average Cost&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;Evening Average Cost&#39;</span><span class="p">]</span>
</span><span id="Analyzer-1904"><a href="#Analyzer-1904"><span class="linenos">1904</span></a>                <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;Total High Time Cost&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;Morning High Cost&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;Evening High Cost&#39;</span><span class="p">]</span>
</span><span id="Analyzer-1905"><a href="#Analyzer-1905"><span class="linenos">1905</span></a>
</span><span id="Analyzer-1906"><a href="#Analyzer-1906"><span class="linenos">1906</span></a>                <span class="c1"># Calculate a Total Average Cost and Total High Cost</span>
</span><span id="Analyzer-1907"><a href="#Analyzer-1907"><span class="linenos">1907</span></a>                <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;Total Average Cost&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;Total Average Time Cost&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;commute_cost&#39;</span><span class="p">]</span>
</span><span id="Analyzer-1908"><a href="#Analyzer-1908"><span class="linenos">1908</span></a>                <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;Total High Cost&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;Total High Time Cost&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;commute_cost&#39;</span><span class="p">]</span>
</span><span id="Analyzer-1909"><a href="#Analyzer-1909"><span class="linenos">1909</span></a>                
</span><span id="Analyzer-1910"><a href="#Analyzer-1910"><span class="linenos">1910</span></a>                <span class="c1"># add the current val_set to the employee_costs_to_office dictionary</span>
</span><span id="Analyzer-1911"><a href="#Analyzer-1911"><span class="linenos">1911</span></a>                <span class="n">employee_costs_to_office</span><span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;address&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">val_set</span>
</span><span id="Analyzer-1912"><a href="#Analyzer-1912"><span class="linenos">1912</span></a>
</span><span id="Analyzer-1913"><a href="#Analyzer-1913"><span class="linenos">1913</span></a>            <span class="n">dvalues</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Total Average Cost&#39;</span><span class="p">,</span><span class="s1">&#39;Total High Cost&#39;</span><span class="p">]</span>
</span><span id="Analyzer-1914"><a href="#Analyzer-1914"><span class="linenos">1914</span></a>            <span class="n">bins</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Analyzer-1915"><a href="#Analyzer-1915"><span class="linenos">1915</span></a>
</span><span id="Analyzer-1916"><a href="#Analyzer-1916"><span class="linenos">1916</span></a>            <span class="c1"># now iterate through again to get bins</span>
</span><span id="Analyzer-1917"><a href="#Analyzer-1917"><span class="linenos">1917</span></a>            <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">offices</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
</span><span id="Analyzer-1918"><a href="#Analyzer-1918"><span class="linenos">1918</span></a>                <span class="c1"># create bins based on the max value of the Total Average Cost and Total High Cost data for each office, get the max value for bins</span>
</span><span id="Analyzer-1919"><a href="#Analyzer-1919"><span class="linenos">1919</span></a>                <span class="n">binmax</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Analyzer-1920"><a href="#Analyzer-1920"><span class="linenos">1920</span></a>                <span class="k">for</span> <span class="n">each</span> <span class="ow">in</span> <span class="n">dvalues</span><span class="p">:</span>
</span><span id="Analyzer-1921"><a href="#Analyzer-1921"><span class="linenos">1921</span></a>                    <span class="k">if</span> <span class="nb">max</span><span class="p">(</span><span class="n">employee_costs_to_office</span><span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;address&#39;</span><span class="p">]][</span><span class="n">each</span><span class="p">])</span> <span class="o">&gt;</span> <span class="n">binmax</span><span class="p">:</span>
</span><span id="Analyzer-1922"><a href="#Analyzer-1922"><span class="linenos">1922</span></a>                        <span class="n">binmax</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">employee_costs_to_office</span><span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;address&#39;</span><span class="p">]][</span><span class="n">each</span><span class="p">])</span>
</span><span id="Analyzer-1923"><a href="#Analyzer-1923"><span class="linenos">1923</span></a>                <span class="n">step</span> <span class="o">=</span> <span class="mi">5</span>
</span><span id="Analyzer-1924"><a href="#Analyzer-1924"><span class="linenos">1924</span></a>
</span><span id="Analyzer-1925"><a href="#Analyzer-1925"><span class="linenos">1925</span></a>            <span class="c1"># round the binmax up to the nearest step</span>
</span><span id="Analyzer-1926"><a href="#Analyzer-1926"><span class="linenos">1926</span></a>            <span class="n">bins</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">binmax</span> <span class="o">+</span> <span class="n">step</span> <span class="o">-</span> <span class="p">(</span><span class="n">binmax</span> <span class="o">%</span> <span class="n">step</span><span class="p">)),</span> <span class="n">step</span><span class="p">)</span>
</span><span id="Analyzer-1927"><a href="#Analyzer-1927"><span class="linenos">1927</span></a>            
</span><span id="Analyzer-1928"><a href="#Analyzer-1928"><span class="linenos">1928</span></a>            <span class="n">font_mod</span> <span class="o">=</span> <span class="mf">1.5</span>
</span><span id="Analyzer-1929"><a href="#Analyzer-1929"><span class="linenos">1929</span></a>            
</span><span id="Analyzer-1930"><a href="#Analyzer-1930"><span class="linenos">1930</span></a>            <span class="c1"># create histograms for the morning and evening average costs</span>
</span><span id="Analyzer-1931"><a href="#Analyzer-1931"><span class="linenos">1931</span></a>            <span class="n">plt</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graphing</span><span class="o">.</span><span class="n">get_histogram</span><span class="p">(</span><span class="n">emp</span><span class="p">,</span> <span class="n">office</span><span class="p">,</span> <span class="n">commute_data</span><span class="p">,</span> <span class="n">dvalues</span><span class="p">,</span> 
</span><span id="Analyzer-1932"><a href="#Analyzer-1932"><span class="linenos">1932</span></a>                                                    <span class="n">suptitle</span><span class="o">=</span><span class="s2">&quot;Total Employee Commute Costs per Day&quot;</span><span class="p">,</span><span class="n">cutoff_radius</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">commute_range_cut_off</span><span class="p">,</span>
</span><span id="Analyzer-1933"><a href="#Analyzer-1933"><span class="linenos">1933</span></a>                                    <span class="n">x_label</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="s1">&#39;\$ (USD)&#39;</span><span class="p">),</span> <span class="n">y_label</span><span class="o">=</span><span class="s1">&#39;# Employees&#39;</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="n">bins</span><span class="p">,</span> <span class="n">rows</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">employee_costs_to_office</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span> <span class="n">cols</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> 
</span><span id="Analyzer-1934"><a href="#Analyzer-1934"><span class="linenos">1934</span></a>                                    <span class="n">column_titles</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Average&quot;</span><span class="p">,</span><span class="s2">&quot;High/Conservative&quot;</span><span class="p">],</span> <span class="n">cumulative_line</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">font_mod</span><span class="o">=</span><span class="n">font_mod</span><span class="p">,</span> <span class="n">manual_plot</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> 
</span><span id="Analyzer-1935"><a href="#Analyzer-1935"><span class="linenos">1935</span></a>                                    <span class="n">sharey</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">override_values</span><span class="o">=</span><span class="n">employee_costs_to_office</span><span class="p">)</span>
</span><span id="Analyzer-1936"><a href="#Analyzer-1936"><span class="linenos">1936</span></a>            
</span><span id="Analyzer-1937"><a href="#Analyzer-1937"><span class="linenos">1937</span></a>            <span class="c1"># manually add histograms for each office option</span>
</span><span id="Analyzer-1938"><a href="#Analyzer-1938"><span class="linenos">1938</span></a>            <span class="n">keys</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">employee_costs_to_office</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
</span><span id="Analyzer-1939"><a href="#Analyzer-1939"><span class="linenos">1939</span></a>            <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">keys</span><span class="p">)):</span>
</span><span id="Analyzer-1940"><a href="#Analyzer-1940"><span class="linenos">1940</span></a>                <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dvalues</span><span class="p">)):</span>
</span><span id="Analyzer-1941"><a href="#Analyzer-1941"><span class="linenos">1941</span></a>                    <span class="n">ax</span><span class="p">[</span><span class="n">r</span><span class="p">,</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">employee_costs_to_office</span><span class="p">[</span><span class="n">keys</span><span class="p">[</span><span class="n">r</span><span class="p">]][</span><span class="n">dvalues</span><span class="p">[</span><span class="n">c</span><span class="p">]],</span> <span class="n">bins</span><span class="o">=</span><span class="n">bins</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;#555555&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> 
</span><span id="Analyzer-1942"><a href="#Analyzer-1942"><span class="linenos">1942</span></a>                                 <span class="n">zorder</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">align</span><span class="o">=</span><span class="s1">&#39;mid&#39;</span><span class="p">,</span> <span class="n">rwidth</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">dvalues</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">(</span><span class="n">r</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>
</span><span id="Analyzer-1943"><a href="#Analyzer-1943"><span class="linenos">1943</span></a>                    <span class="n">ax</span><span class="p">[</span><span class="n">r</span><span class="p">,</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;major&#39;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
</span><span id="Analyzer-1944"><a href="#Analyzer-1944"><span class="linenos">1944</span></a>
</span><span id="Analyzer-1945"><a href="#Analyzer-1945"><span class="linenos">1945</span></a>                    <span class="c1"># add a text box in the upper right corner with the stats</span>
</span><span id="Analyzer-1946"><a href="#Analyzer-1946"><span class="linenos">1946</span></a>                    <span class="n">t</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;me&#39;</span> <span class="p">:</span> <span class="s1">&#39;Median: |$</span><span class="si">{:,.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">employee_costs_to_office</span><span class="p">[</span><span class="n">keys</span><span class="p">[</span><span class="n">r</span><span class="p">]][</span><span class="n">dvalues</span><span class="p">[</span><span class="n">c</span><span class="p">]])),</span>
</span><span id="Analyzer-1947"><a href="#Analyzer-1947"><span class="linenos">1947</span></a>                        <span class="s1">&#39;av&#39;</span> <span class="p">:</span> <span class="s1">&#39;Average: |$</span><span class="si">{:,.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">employee_costs_to_office</span><span class="p">[</span><span class="n">keys</span><span class="p">[</span><span class="n">r</span><span class="p">]][</span><span class="n">dvalues</span><span class="p">[</span><span class="n">c</span><span class="p">]])),</span>
</span><span id="Analyzer-1948"><a href="#Analyzer-1948"><span class="linenos">1948</span></a>                        <span class="s1">&#39;mi&#39;</span> <span class="p">:</span> <span class="s1">&#39;Min: |$</span><span class="si">{:,.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">employee_costs_to_office</span><span class="p">[</span><span class="n">keys</span><span class="p">[</span><span class="n">r</span><span class="p">]][</span><span class="n">dvalues</span><span class="p">[</span><span class="n">c</span><span class="p">]])),</span>
</span><span id="Analyzer-1949"><a href="#Analyzer-1949"><span class="linenos">1949</span></a>                        <span class="s1">&#39;ma&#39;</span> <span class="p">:</span> <span class="s1">&#39;Max: |$</span><span class="si">{:,.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">employee_costs_to_office</span><span class="p">[</span><span class="n">keys</span><span class="p">[</span><span class="n">r</span><span class="p">]][</span><span class="n">dvalues</span><span class="p">[</span><span class="n">c</span><span class="p">]])),</span>
</span><span id="Analyzer-1950"><a href="#Analyzer-1950"><span class="linenos">1950</span></a>                        <span class="s1">&#39;to&#39;</span> <span class="p">:</span> <span class="s1">&#39;Total: |$</span><span class="si">{:,.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">employee_costs_to_office</span><span class="p">[</span><span class="n">keys</span><span class="p">[</span><span class="n">r</span><span class="p">]][</span><span class="n">dvalues</span><span class="p">[</span><span class="n">c</span><span class="p">]])),</span>
</span><span id="Analyzer-1951"><a href="#Analyzer-1951"><span class="linenos">1951</span></a>                        <span class="s1">&#39;co&#39;</span> <span class="p">:</span> <span class="s1">&#39;Count: |</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">employee_costs_to_office</span><span class="p">[</span><span class="n">keys</span><span class="p">[</span><span class="n">r</span><span class="p">]][</span><span class="n">dvalues</span><span class="p">[</span><span class="n">c</span><span class="p">]]))</span>
</span><span id="Analyzer-1952"><a href="#Analyzer-1952"><span class="linenos">1952</span></a>                        <span class="p">}</span>
</span><span id="Analyzer-1953"><a href="#Analyzer-1953"><span class="linenos">1953</span></a>                    <span class="c1"># get the longest string value</span>
</span><span id="Analyzer-1954"><a href="#Analyzer-1954"><span class="linenos">1954</span></a>                    <span class="n">max_len</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="s1">&#39;me&#39;</span><span class="p">]),</span><span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="s1">&#39;av&#39;</span><span class="p">]),</span><span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="s1">&#39;to&#39;</span><span class="p">]),</span><span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="s1">&#39;mi&#39;</span><span class="p">]),</span><span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="s1">&#39;ma&#39;</span><span class="p">]),</span><span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="s1">&#39;co&#39;</span><span class="p">]))</span>
</span><span id="Analyzer-1955"><a href="#Analyzer-1955"><span class="linenos">1955</span></a>                    <span class="c1"># calculate additional space</span>
</span><span id="Analyzer-1956"><a href="#Analyzer-1956"><span class="linenos">1956</span></a>                    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">t</span><span class="p">:</span>
</span><span id="Analyzer-1957"><a href="#Analyzer-1957"><span class="linenos">1957</span></a>                        <span class="n">t</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">t</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">,</span><span class="s2">&quot; &quot;</span><span class="o">*</span><span class="p">(</span><span class="n">max_len</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="n">k</span><span class="p">])))</span>
</span><span id="Analyzer-1958"><a href="#Analyzer-1958"><span class="linenos">1958</span></a>                    <span class="c1"># add spaces to make all the same length, replacing |</span>
</span><span id="Analyzer-1959"><a href="#Analyzer-1959"><span class="linenos">1959</span></a>                    <span class="n">textstr</span> <span class="o">=</span> <span class="s2">&quot;Employee Commute </span><span class="se">\n</span><span class="s2"> Cost per Day: &quot;</span>
</span><span id="Analyzer-1960"><a href="#Analyzer-1960"><span class="linenos">1960</span></a>                    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">t</span><span class="p">:</span>
</span><span id="Analyzer-1961"><a href="#Analyzer-1961"><span class="linenos">1961</span></a>                        <span class="n">textstr</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">t</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
</span><span id="Analyzer-1962"><a href="#Analyzer-1962"><span class="linenos">1962</span></a>                    <span class="c1"># these are matplotlib.patch.Patch properties</span>
</span><span id="Analyzer-1963"><a href="#Analyzer-1963"><span class="linenos">1963</span></a>                    <span class="n">props</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">boxstyle</span><span class="o">=</span><span class="s1">&#39;round&#39;</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;wheat&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
</span><span id="Analyzer-1964"><a href="#Analyzer-1964"><span class="linenos">1964</span></a>                    <span class="c1"># place a text box in upper right in axes coords,</span>
</span><span id="Analyzer-1965"><a href="#Analyzer-1965"><span class="linenos">1965</span></a>                    <span class="n">ax</span><span class="p">[</span><span class="n">r</span><span class="p">,</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">.95</span><span class="p">,</span> <span class="mf">.7</span><span class="p">,</span> <span class="n">textstr</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="n">r</span><span class="p">,</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">,</span>
</span><span id="Analyzer-1966"><a href="#Analyzer-1966"><span class="linenos">1966</span></a>                                <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">bbox</span><span class="o">=</span><span class="n">props</span><span class="p">,</span> <span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;family&#39;</span><span class="p">:</span> <span class="s1">&#39;monospace&#39;</span><span class="p">},</span> <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">)</span>
</span><span id="Analyzer-1967"><a href="#Analyzer-1967"><span class="linenos">1967</span></a>                    
</span><span id="Analyzer-1968"><a href="#Analyzer-1968"><span class="linenos">1968</span></a>                    <span class="c1"># add the address to the top left of the plot</span>
</span><span id="Analyzer-1969"><a href="#Analyzer-1969"><span class="linenos">1969</span></a>                    <span class="k">if</span> <span class="n">c</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
</span><span id="Analyzer-1970"><a href="#Analyzer-1970"><span class="linenos">1970</span></a>                        <span class="n">ax</span><span class="p">[</span><span class="n">r</span><span class="p">,</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.02</span><span class="p">,</span> <span class="mf">0.98</span><span class="p">,</span> <span class="n">keys</span><span class="p">[</span><span class="n">r</span><span class="p">],</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="o">*</span><span class="n">font_mod</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="n">r</span><span class="p">,</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;top&#39;</span><span class="p">)</span>
</span><span id="Analyzer-1971"><a href="#Analyzer-1971"><span class="linenos">1971</span></a>
</span><span id="Analyzer-1972"><a href="#Analyzer-1972"><span class="linenos">1972</span></a>                    <span class="c1"># for the first column, add morning/evening text box the top left of the plot</span>
</span><span id="Analyzer-1973"><a href="#Analyzer-1973"><span class="linenos">1973</span></a>                    <span class="k">if</span> <span class="n">r</span><span class="o">==</span><span class="nb">len</span><span class="p">(</span><span class="n">employee_costs_to_office</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span>
</span><span id="Analyzer-1974"><a href="#Analyzer-1974"><span class="linenos">1974</span></a>                        <span class="n">ax</span><span class="p">[</span><span class="n">r</span><span class="p">,</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Employee Total Cost ($ USD / Day)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="o">*</span><span class="n">font_mod</span><span class="p">)</span>                        
</span><span id="Analyzer-1975"><a href="#Analyzer-1975"><span class="linenos">1975</span></a>             
</span><span id="Analyzer-1976"><a href="#Analyzer-1976"><span class="linenos">1976</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">(</span><span class="n">pad</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
</span><span id="Analyzer-1977"><a href="#Analyzer-1977"><span class="linenos">1977</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">plots_dir</span><span class="o">+</span><span class="s2">&quot;/&quot;</span><span class="o">+</span><span class="n">key</span><span class="o">+</span><span class="s2">&quot;.png&quot;</span><span class="p">)</span>
</span><span id="Analyzer-1978"><a href="#Analyzer-1978"><span class="linenos">1978</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span> 
</span><span id="Analyzer-1979"><a href="#Analyzer-1979"><span class="linenos">1979</span></a>
</span><span id="Analyzer-1980"><a href="#Analyzer-1980"><span class="linenos">1980</span></a>        <span class="c1">################################################################################ </span>
</span><span id="Analyzer-1981"><a href="#Analyzer-1981"><span class="linenos">1981</span></a>        <span class="c1"># GRAPH: </span>
</span><span id="Analyzer-1982"><a href="#Analyzer-1982"><span class="linenos">1982</span></a>        <span class="c1">## Total Employee Commute Cost Differential Analysis</span>
</span><span id="Analyzer-1983"><a href="#Analyzer-1983"><span class="linenos">1983</span></a>        <span class="n">key</span> <span class="o">=</span> <span class="s1">&#39;teccda&#39;</span>
</span><span id="Analyzer-1984"><a href="#Analyzer-1984"><span class="linenos">1984</span></a>        <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;Total Employee Commute Cost Differential Analysis&quot;</span>
</span><span id="Analyzer-1985"><a href="#Analyzer-1985"><span class="linenos">1985</span></a>        <span class="n">short_title</span> <span class="o">=</span> <span class="n">title</span>
</span><span id="Analyzer-1986"><a href="#Analyzer-1986"><span class="linenos">1986</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">graph_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="p">{</span><span class="s2">&quot;GRAPH&quot;</span><span class="p">:</span> <span class="n">key</span><span class="p">,</span>
</span><span id="Analyzer-1987"><a href="#Analyzer-1987"><span class="linenos">1987</span></a>                                <span class="s2">&quot;TITLE&quot;</span><span class="p">:</span> <span class="n">short_title</span><span class="p">,</span>
</span><span id="Analyzer-1988"><a href="#Analyzer-1988"><span class="linenos">1988</span></a>                                <span class="s2">&quot;FILENAME&quot;</span><span class="p">:</span> <span class="n">key</span><span class="o">+</span><span class="s2">&quot;.png&quot;</span><span class="p">,</span>
</span><span id="Analyzer-1989"><a href="#Analyzer-1989"><span class="linenos">1989</span></a>                                <span class="s2">&quot;PLOT-DESCRIPTION&quot;</span><span class="p">:</span> <span class="s2">&quot;This graph displays the distribution of commute costs for employees within the &quot;</span> <span class="o">+</span> \
</span><span id="Analyzer-1990"><a href="#Analyzer-1990"><span class="linenos">1990</span></a>                                                    <span class="s2">&quot;cutoff distance of the office options. Changes in per-employee commute costs are shown for each office &quot;</span> <span class="o">+</span> \
</span><span id="Analyzer-1991"><a href="#Analyzer-1991"><span class="linenos">1991</span></a>                                                    <span class="s2">&quot;option relative to the existing office locaton.  This analysis inlcudes per mile costs (not including tolls, etc.) as well as  &quot;</span> <span class="o">+</span> \
</span><span id="Analyzer-1992"><a href="#Analyzer-1992"><span class="linenos">1992</span></a>                                                    <span class="s2">&quot;average and conservative costs due to cash equivalent for time.&quot;</span>
</span><span id="Analyzer-1993"><a href="#Analyzer-1993"><span class="linenos">1993</span></a>                                <span class="p">})</span>
</span><span id="Analyzer-1994"><a href="#Analyzer-1994"><span class="linenos">1994</span></a>        
</span><span id="Analyzer-1995"><a href="#Analyzer-1995"><span class="linenos">1995</span></a>        <span class="k">if</span> <span class="n">graph</span> <span class="o">==</span> <span class="s2">&quot;_all&quot;</span> <span class="ow">or</span> <span class="n">graph</span> <span class="o">==</span> <span class="n">key</span><span class="p">:</span>
</span><span id="Analyzer-1996"><a href="#Analyzer-1996"><span class="linenos">1996</span></a>            <span class="c1"># gather the data for the analysis</span>
</span><span id="Analyzer-1997"><a href="#Analyzer-1997"><span class="linenos">1997</span></a>            <span class="n">base_costs</span><span class="p">,</span> <span class="n">cost_values</span><span class="p">,</span> <span class="n">average_diffs</span><span class="p">,</span> <span class="n">conservative_diffs</span><span class="p">,</span> <span class="n">withins</span><span class="p">,</span> <span class="n">employee_costs_to_office</span><span class="p">,</span> <span class="n">current_office</span><span class="p">,</span> <span class="n">other_offices</span> <span class="o">=</span> \
</span><span id="Analyzer-1998"><a href="#Analyzer-1998"><span class="linenos">1998</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">get_attrition_analysis</span><span class="p">(</span><span class="n">emp</span><span class="p">,</span> <span class="n">offices</span><span class="p">,</span> <span class="n">commute_data</span><span class="p">)</span>
</span><span id="Analyzer-1999"><a href="#Analyzer-1999"><span class="linenos">1999</span></a>
</span><span id="Analyzer-2000"><a href="#Analyzer-2000"><span class="linenos">2000</span></a>
</span><span id="Analyzer-2001"><a href="#Analyzer-2001"><span class="linenos">2001</span></a>            <span class="c1"># now we have a list of dataframes with the differentials, we eliminate all rows with 0 cost differential to prevent skewing the histogram</span>
</span><span id="Analyzer-2002"><a href="#Analyzer-2002"><span class="linenos">2002</span></a>            <span class="c1"># calculate the bin list based upon a the min (negative) and max (positive) values of the data     </span>
</span><span id="Analyzer-2003"><a href="#Analyzer-2003"><span class="linenos">2003</span></a>            <span class="n">binmin</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Analyzer-2004"><a href="#Analyzer-2004"><span class="linenos">2004</span></a>            <span class="n">binmax</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Analyzer-2005"><a href="#Analyzer-2005"><span class="linenos">2005</span></a>            <span class="n">diffs</span> <span class="o">=</span> <span class="p">[</span><span class="n">average_diffs</span><span class="p">,</span> <span class="n">conservative_diffs</span><span class="p">]</span>
</span><span id="Analyzer-2006"><a href="#Analyzer-2006"><span class="linenos">2006</span></a>            <span class="k">for</span> <span class="n">diff</span> <span class="ow">in</span> <span class="n">diffs</span><span class="p">:</span>
</span><span id="Analyzer-2007"><a href="#Analyzer-2007"><span class="linenos">2007</span></a>                <span class="k">for</span> <span class="n">each</span> <span class="ow">in</span> <span class="n">diff</span><span class="p">:</span>
</span><span id="Analyzer-2008"><a href="#Analyzer-2008"><span class="linenos">2008</span></a>                    <span class="k">if</span> <span class="nb">min</span><span class="p">(</span><span class="n">each</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">binmin</span><span class="p">:</span>
</span><span id="Analyzer-2009"><a href="#Analyzer-2009"><span class="linenos">2009</span></a>                        <span class="n">binmin</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">each</span><span class="p">)</span>
</span><span id="Analyzer-2010"><a href="#Analyzer-2010"><span class="linenos">2010</span></a>                    <span class="k">if</span> <span class="nb">max</span><span class="p">(</span><span class="n">each</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">binmax</span><span class="p">:</span>
</span><span id="Analyzer-2011"><a href="#Analyzer-2011"><span class="linenos">2011</span></a>                        <span class="n">binmax</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">each</span><span class="p">)</span>
</span><span id="Analyzer-2012"><a href="#Analyzer-2012"><span class="linenos">2012</span></a>            <span class="n">step</span> <span class="o">=</span> <span class="mi">10</span> 
</span><span id="Analyzer-2013"><a href="#Analyzer-2013"><span class="linenos">2013</span></a>            <span class="c1"># round the binmin down to the nearest step, max up to the nearest step</span>
</span><span id="Analyzer-2014"><a href="#Analyzer-2014"><span class="linenos">2014</span></a>            <span class="n">bins</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">binmin</span> <span class="o">-</span> <span class="p">(</span><span class="n">binmin</span> <span class="o">%</span> <span class="n">step</span><span class="p">)),</span> <span class="nb">int</span><span class="p">(</span><span class="n">binmax</span> <span class="o">+</span> <span class="n">step</span> <span class="o">-</span> <span class="p">(</span><span class="n">binmax</span> <span class="o">%</span> <span class="n">step</span><span class="p">)),</span> <span class="n">step</span><span class="p">)</span>
</span><span id="Analyzer-2015"><a href="#Analyzer-2015"><span class="linenos">2015</span></a>            <span class="n">dvalues</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Total Average Cost&#39;</span><span class="p">,</span><span class="s1">&#39;Total High Cost&#39;</span><span class="p">]</span>
</span><span id="Analyzer-2016"><a href="#Analyzer-2016"><span class="linenos">2016</span></a>            
</span><span id="Analyzer-2017"><a href="#Analyzer-2017"><span class="linenos">2017</span></a>            <span class="n">plt</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graphing</span><span class="o">.</span><span class="n">get_histogram</span><span class="p">(</span><span class="n">emp</span><span class="p">,</span> <span class="n">other_offices</span><span class="p">,</span> <span class="n">cost_values</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="n">dvalues</span><span class="p">,</span> <span class="n">suptitle</span><span class="o">=</span><span class="s2">&quot;Total Employee Commute Cost Differential Analysis&quot;</span><span class="p">,</span> <span class="n">cutoff_radius</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">commute_range_cut_off</span><span class="p">,</span>
</span><span id="Analyzer-2018"><a href="#Analyzer-2018"><span class="linenos">2018</span></a>                                      <span class="n">x_label</span><span class="o">=</span><span class="s1">&#39;\$ (USD) based on time and mileage&#39;</span><span class="p">,</span> <span class="n">y_label</span><span class="o">=</span><span class="s1">&#39;# Employees (log scale)&#39;</span><span class="p">,</span>
</span><span id="Analyzer-2019"><a href="#Analyzer-2019"><span class="linenos">2019</span></a>                                      <span class="n">bins</span><span class="o">=</span><span class="n">bins</span><span class="p">,</span> <span class="n">rows</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">other_offices</span><span class="p">),</span> <span class="n">cols</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">column_titles</span><span class="o">=</span><span class="n">dvalues</span><span class="p">,</span> 
</span><span id="Analyzer-2020"><a href="#Analyzer-2020"><span class="linenos">2020</span></a>                                      <span class="n">cumulative_line</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">font_mod</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">manual_plot</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">override_values</span><span class="o">=</span><span class="n">cost_values</span><span class="p">)</span>
</span><span id="Analyzer-2021"><a href="#Analyzer-2021"><span class="linenos">2021</span></a>            
</span><span id="Analyzer-2022"><a href="#Analyzer-2022"><span class="linenos">2022</span></a>            <span class="c1"># calculate the $ value for turnover due to cost</span>
</span><span id="Analyzer-2023"><a href="#Analyzer-2023"><span class="linenos">2023</span></a>            <span class="n">median_salary</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">median_salary</span>
</span><span id="Analyzer-2024"><a href="#Analyzer-2024"><span class="linenos">2024</span></a>            <span class="n">threshold</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">turnover_threshold_due_to_cost</span><span class="o">*</span><span class="n">median_salary</span>
</span><span id="Analyzer-2025"><a href="#Analyzer-2025"><span class="linenos">2025</span></a>            <span class="n">daily_threshold</span> <span class="o">=</span> <span class="n">threshold</span><span class="o">/</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">commute_days_per_week</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">commute_weeks_per_year</span><span class="p">)</span>
</span><span id="Analyzer-2026"><a href="#Analyzer-2026"><span class="linenos">2026</span></a>                   
</span><span id="Analyzer-2027"><a href="#Analyzer-2027"><span class="linenos">2027</span></a>            <span class="c1"># manually add histograms for each office option</span>
</span><span id="Analyzer-2028"><a href="#Analyzer-2028"><span class="linenos">2028</span></a>            <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">other_offices</span><span class="p">)):</span>
</span><span id="Analyzer-2029"><a href="#Analyzer-2029"><span class="linenos">2029</span></a>                <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
</span><span id="Analyzer-2030"><a href="#Analyzer-2030"><span class="linenos">2030</span></a>                    <span class="n">ax</span><span class="p">[</span><span class="n">r</span><span class="p">,</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">average_diffs</span><span class="p">[</span><span class="n">r</span><span class="p">],</span> <span class="n">bins</span><span class="o">=</span><span class="n">bins</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;#555555&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">align</span><span class="o">=</span><span class="s1">&#39;mid&#39;</span><span class="p">,</span> 
</span><span id="Analyzer-2031"><a href="#Analyzer-2031"><span class="linenos">2031</span></a>                            <span class="n">rwidth</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">other_offices</span><span class="p">[</span><span class="s1">&#39;address&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="n">r</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">(</span><span class="n">r</span><span class="o">+</span><span class="mi">2</span><span class="p">),</span> <span class="n">log</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="Analyzer-2032"><a href="#Analyzer-2032"><span class="linenos">2032</span></a>                    <span class="n">ax</span><span class="p">[</span><span class="n">r</span><span class="p">,</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;major&#39;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
</span><span id="Analyzer-2033"><a href="#Analyzer-2033"><span class="linenos">2033</span></a>                    <span class="k">if</span> <span class="n">c</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Analyzer-2034"><a href="#Analyzer-2034"><span class="linenos">2034</span></a>                        <span class="n">ax</span><span class="p">[</span><span class="n">r</span><span class="p">,</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;# Employees (log scale)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
</span><span id="Analyzer-2035"><a href="#Analyzer-2035"><span class="linenos">2035</span></a>                        <span class="c1"># put office address top left of the plot</span>
</span><span id="Analyzer-2036"><a href="#Analyzer-2036"><span class="linenos">2036</span></a>                        <span class="n">ax</span><span class="p">[</span><span class="n">r</span><span class="p">,</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.03</span><span class="p">,</span> <span class="mf">0.99</span><span class="p">,</span> <span class="n">other_offices</span><span class="p">[</span><span class="s1">&#39;address&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="n">r</span><span class="p">],</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="n">r</span><span class="p">,</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;top&#39;</span><span class="p">)</span>
</span><span id="Analyzer-2037"><a href="#Analyzer-2037"><span class="linenos">2037</span></a>                    
</span><span id="Analyzer-2038"><a href="#Analyzer-2038"><span class="linenos">2038</span></a>                    <span class="k">if</span> <span class="n">r</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">other_offices</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span>
</span><span id="Analyzer-2039"><a href="#Analyzer-2039"><span class="linenos">2039</span></a>                        <span class="n">ax</span><span class="p">[</span><span class="n">r</span><span class="p">,</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Employee Total Cost Differential ($ USD)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
</span><span id="Analyzer-2040"><a href="#Analyzer-2040"><span class="linenos">2040</span></a>                    <span class="n">ax</span><span class="p">[</span><span class="n">r</span><span class="p">,</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;major&#39;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
</span><span id="Analyzer-2041"><a href="#Analyzer-2041"><span class="linenos">2041</span></a>                    <span class="c1"># draw a red box with alpha 0.1 over the plot from x=daily_threshold to x=binmax, and y=0 to y max</span>
</span><span id="Analyzer-2042"><a href="#Analyzer-2042"><span class="linenos">2042</span></a>                    <span class="n">ax</span><span class="p">[</span><span class="n">r</span><span class="p">,</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">fill_between</span><span class="p">([</span><span class="n">daily_threshold</span><span class="p">,</span><span class="n">binmax</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="o">**</span><span class="mi">3</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
</span><span id="Analyzer-2043"><a href="#Analyzer-2043"><span class="linenos">2043</span></a>                    <span class="n">ax</span><span class="p">[</span><span class="n">r</span><span class="p">,</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">fill_between</span><span class="p">([</span><span class="n">daily_threshold</span><span class="p">,</span><span class="n">binmax</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="o">**</span><span class="mi">3</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
</span><span id="Analyzer-2044"><a href="#Analyzer-2044"><span class="linenos">2044</span></a>                    
</span><span id="Analyzer-2045"><a href="#Analyzer-2045"><span class="linenos">2045</span></a>                    <span class="n">above_threshold</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Analyzer-2046"><a href="#Analyzer-2046"><span class="linenos">2046</span></a>                    <span class="n">cost_impact</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Analyzer-2047"><a href="#Analyzer-2047"><span class="linenos">2047</span></a>                    <span class="c1"># cycle through the average diffs and get a count of costs above the threshold</span>
</span><span id="Analyzer-2048"><a href="#Analyzer-2048"><span class="linenos">2048</span></a>                    <span class="k">if</span> <span class="n">c</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Analyzer-2049"><a href="#Analyzer-2049"><span class="linenos">2049</span></a>                        <span class="k">for</span> <span class="n">each</span> <span class="ow">in</span> <span class="n">average_diffs</span><span class="p">[</span><span class="n">r</span><span class="p">]:</span>
</span><span id="Analyzer-2050"><a href="#Analyzer-2050"><span class="linenos">2050</span></a>                            <span class="k">if</span> <span class="n">each</span> <span class="o">&gt;</span> <span class="n">daily_threshold</span><span class="p">:</span>
</span><span id="Analyzer-2051"><a href="#Analyzer-2051"><span class="linenos">2051</span></a>                                <span class="n">above_threshold</span> <span class="o">+=</span> <span class="mi">1</span>                        
</span><span id="Analyzer-2052"><a href="#Analyzer-2052"><span class="linenos">2052</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="Analyzer-2053"><a href="#Analyzer-2053"><span class="linenos">2053</span></a>                        <span class="k">for</span> <span class="n">each</span> <span class="ow">in</span> <span class="n">conservative_diffs</span><span class="p">[</span><span class="n">r</span><span class="p">]:</span>
</span><span id="Analyzer-2054"><a href="#Analyzer-2054"><span class="linenos">2054</span></a>                            <span class="k">if</span> <span class="n">each</span> <span class="o">&gt;</span> <span class="n">daily_threshold</span><span class="p">:</span>
</span><span id="Analyzer-2055"><a href="#Analyzer-2055"><span class="linenos">2055</span></a>                                <span class="n">above_threshold</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="Analyzer-2056"><a href="#Analyzer-2056"><span class="linenos">2056</span></a>
</span><span id="Analyzer-2057"><a href="#Analyzer-2057"><span class="linenos">2057</span></a>                    <span class="c1"># cost impact is the # above threshold * employee replacement cost * probability of turnover</span>
</span><span id="Analyzer-2058"><a href="#Analyzer-2058"><span class="linenos">2058</span></a>                    <span class="n">cost_impact</span> <span class="o">=</span> <span class="n">above_threshold</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">turnover_probability_time_cost</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">employee_replacement_cost</span>
</span><span id="Analyzer-2059"><a href="#Analyzer-2059"><span class="linenos">2059</span></a>                    <span class="c1"># add a text box with the count</span>
</span><span id="Analyzer-2060"><a href="#Analyzer-2060"><span class="linenos">2060</span></a>                    <span class="n">t</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;dt&#39;</span> <span class="p">:</span> <span class="s1">&#39;Cost Threshold (\$/day): |$</span><span class="si">{:,.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">daily_threshold</span><span class="p">),</span>
</span><span id="Analyzer-2061"><a href="#Analyzer-2061"><span class="linenos">2061</span></a>                         <span class="s1">&#39;co&#39;</span> <span class="p">:</span> <span class="s1">&#39;# &gt; Threshold (#): |</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">above_threshold</span><span class="p">),</span>
</span><span id="Analyzer-2062"><a href="#Analyzer-2062"><span class="linenos">2062</span></a>                         <span class="s1">&#39;ci&#39;</span> <span class="p">:</span> <span class="s1">&#39;Expected Cost (\$): |$</span><span class="si">{:,.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cost_impact</span><span class="p">)</span>                         
</span><span id="Analyzer-2063"><a href="#Analyzer-2063"><span class="linenos">2063</span></a>                        <span class="p">}</span>
</span><span id="Analyzer-2064"><a href="#Analyzer-2064"><span class="linenos">2064</span></a>                    <span class="c1"># get the longest string value</span>
</span><span id="Analyzer-2065"><a href="#Analyzer-2065"><span class="linenos">2065</span></a>                    <span class="n">max_len</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="s1">&#39;co&#39;</span><span class="p">]),</span><span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="s1">&#39;ci&#39;</span><span class="p">]),</span><span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="s1">&#39;dt&#39;</span><span class="p">]))</span>
</span><span id="Analyzer-2066"><a href="#Analyzer-2066"><span class="linenos">2066</span></a>                    <span class="c1"># calculate additional space</span>
</span><span id="Analyzer-2067"><a href="#Analyzer-2067"><span class="linenos">2067</span></a>                    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">t</span><span class="p">:</span>
</span><span id="Analyzer-2068"><a href="#Analyzer-2068"><span class="linenos">2068</span></a>                        <span class="n">t</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">t</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">,</span><span class="s2">&quot; &quot;</span><span class="o">*</span><span class="p">(</span><span class="n">max_len</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="n">k</span><span class="p">])))</span>
</span><span id="Analyzer-2069"><a href="#Analyzer-2069"><span class="linenos">2069</span></a>                        <span class="n">t</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">t</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;# &gt; Threshold (#): &quot;</span><span class="p">,</span><span class="s2">&quot;# &gt; Threshold (#):&quot;</span><span class="o">*</span><span class="p">(</span><span class="n">max_len</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="n">k</span><span class="p">])))</span>
</span><span id="Analyzer-2070"><a href="#Analyzer-2070"><span class="linenos">2070</span></a>                    <span class="c1"># add spaces to make all the same length, replacing |</span>
</span><span id="Analyzer-2071"><a href="#Analyzer-2071"><span class="linenos">2071</span></a>                    <span class="n">textstr</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="c1">#Employees above \n Threshold: &quot;</span>
</span><span id="Analyzer-2072"><a href="#Analyzer-2072"><span class="linenos">2072</span></a>                    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">t</span><span class="p">:</span>
</span><span id="Analyzer-2073"><a href="#Analyzer-2073"><span class="linenos">2073</span></a>                        <span class="n">textstr</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">t</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
</span><span id="Analyzer-2074"><a href="#Analyzer-2074"><span class="linenos">2074</span></a>                    <span class="c1"># these are matplotlib.patch.Patch properties</span>
</span><span id="Analyzer-2075"><a href="#Analyzer-2075"><span class="linenos">2075</span></a>                    <span class="n">props</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">boxstyle</span><span class="o">=</span><span class="s1">&#39;round&#39;</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;wheat&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
</span><span id="Analyzer-2076"><a href="#Analyzer-2076"><span class="linenos">2076</span></a>                    <span class="c1"># place a text box in upper right in axes coords,</span>
</span><span id="Analyzer-2077"><a href="#Analyzer-2077"><span class="linenos">2077</span></a>                    <span class="n">ax</span><span class="p">[</span><span class="n">r</span><span class="p">,</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">.03</span><span class="p">,</span> <span class="mf">.85</span><span class="p">,</span> <span class="n">textstr</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="n">r</span><span class="p">,</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">,</span>
</span><span id="Analyzer-2078"><a href="#Analyzer-2078"><span class="linenos">2078</span></a>                                <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">bbox</span><span class="o">=</span><span class="n">props</span><span class="p">,</span> <span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;family&#39;</span><span class="p">:</span> <span class="s1">&#39;monospace&#39;</span><span class="p">},</span> <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">)</span>
</span><span id="Analyzer-2079"><a href="#Analyzer-2079"><span class="linenos">2079</span></a>            
</span><span id="Analyzer-2080"><a href="#Analyzer-2080"><span class="linenos">2080</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">(</span><span class="n">pad</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
</span><span id="Analyzer-2081"><a href="#Analyzer-2081"><span class="linenos">2081</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">plots_dir</span><span class="o">+</span><span class="s2">&quot;/&quot;</span><span class="o">+</span><span class="n">key</span><span class="o">+</span><span class="s2">&quot;.png&quot;</span><span class="p">)</span>
</span><span id="Analyzer-2082"><a href="#Analyzer-2082"><span class="linenos">2082</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="Analyzer-2083"><a href="#Analyzer-2083"><span class="linenos">2083</span></a>
</span><span id="Analyzer-2084"><a href="#Analyzer-2084"><span class="linenos">2084</span></a>
</span><span id="Analyzer-2085"><a href="#Analyzer-2085"><span class="linenos">2085</span></a>        <span class="c1">################################################################################</span>
</span><span id="Analyzer-2086"><a href="#Analyzer-2086"><span class="linenos">2086</span></a>        <span class="c1">### GRAPH SET: Local Analysis for Office X</span>
</span><span id="Analyzer-2087"><a href="#Analyzer-2087"><span class="linenos">2087</span></a>        <span class="c1"># iterate through offices, generate a graph for each office</span>
</span><span id="Analyzer-2088"><a href="#Analyzer-2088"><span class="linenos">2088</span></a>        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">offices</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>    
</span><span id="Analyzer-2089"><a href="#Analyzer-2089"><span class="linenos">2089</span></a>            <span class="c1">################################################################################ </span>
</span><span id="Analyzer-2090"><a href="#Analyzer-2090"><span class="linenos">2090</span></a>            <span class="c1"># GRAPH: </span>
</span><span id="Analyzer-2091"><a href="#Analyzer-2091"><span class="linenos">2091</span></a>            <span class="c1">## Traffic Regime Analysis</span>
</span><span id="Analyzer-2092"><a href="#Analyzer-2092"><span class="linenos">2092</span></a>            <span class="n">key</span> <span class="o">=</span> <span class="s1">&#39;tra&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
</span><span id="Analyzer-2093"><a href="#Analyzer-2093"><span class="linenos">2093</span></a>            <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;Traffic Regime Analysis for &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;address&#39;</span><span class="p">])</span>
</span><span id="Analyzer-2094"><a href="#Analyzer-2094"><span class="linenos">2094</span></a>            <span class="n">short_title</span> <span class="o">=</span> <span class="n">title</span>
</span><span id="Analyzer-2095"><a href="#Analyzer-2095"><span class="linenos">2095</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">graph_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="p">{</span><span class="s2">&quot;GRAPH&quot;</span><span class="p">:</span> <span class="n">key</span><span class="p">,</span>
</span><span id="Analyzer-2096"><a href="#Analyzer-2096"><span class="linenos">2096</span></a>                                    <span class="s2">&quot;TITLE&quot;</span><span class="p">:</span> <span class="n">short_title</span><span class="p">,</span>
</span><span id="Analyzer-2097"><a href="#Analyzer-2097"><span class="linenos">2097</span></a>                                    <span class="s2">&quot;FILENAME&quot;</span><span class="p">:</span> <span class="n">key</span><span class="o">+</span><span class="s2">&quot;.png&quot;</span><span class="p">,</span>
</span><span id="Analyzer-2098"><a href="#Analyzer-2098"><span class="linenos">2098</span></a>                                    <span class="s2">&quot;PLOT-DESCRIPTION&quot;</span><span class="p">:</span> <span class="s2">&quot;This pie chart outlines the percentage of employees that are in each traffic regime for commute to &quot;</span> <span class="o">+</span> \
</span><span id="Analyzer-2099"><a href="#Analyzer-2099"><span class="linenos">2099</span></a>                                    <span class="nb">str</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;address&#39;</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot; for each day of the week.&quot;</span>
</span><span id="Analyzer-2100"><a href="#Analyzer-2100"><span class="linenos">2100</span></a>                                    <span class="p">})</span>
</span><span id="Analyzer-2101"><a href="#Analyzer-2101"><span class="linenos">2101</span></a>            
</span><span id="Analyzer-2102"><a href="#Analyzer-2102"><span class="linenos">2102</span></a>            <span class="k">if</span> <span class="n">graph</span> <span class="o">==</span> <span class="s2">&quot;_all&quot;</span> <span class="ow">or</span> <span class="n">graph</span> <span class="o">==</span> <span class="n">key</span><span class="p">:</span>
</span><span id="Analyzer-2103"><a href="#Analyzer-2103"><span class="linenos">2103</span></a>                
</span><span id="Analyzer-2104"><a href="#Analyzer-2104"><span class="linenos">2104</span></a>                <span class="n">office</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">to_frame</span><span class="p">()</span><span class="o">.</span><span class="n">T</span>
</span><span id="Analyzer-2105"><a href="#Analyzer-2105"><span class="linenos">2105</span></a>                
</span><span id="Analyzer-2106"><a href="#Analyzer-2106"><span class="linenos">2106</span></a>                <span class="c1"># get the needed commute values</span>
</span><span id="Analyzer-2107"><a href="#Analyzer-2107"><span class="linenos">2107</span></a>                <span class="n">values</span> <span class="o">=</span> <span class="n">commute_data</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span>
</span><span id="Analyzer-2108"><a href="#Analyzer-2108"><span class="linenos">2108</span></a>                <span class="c1"># filter teh employees to only those within the cutoff distance</span>
</span><span id="Analyzer-2109"><a href="#Analyzer-2109"><span class="linenos">2109</span></a>                <span class="n">emp_within</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graphing</span><span class="o">.</span><span class="n">filter_drive_distance</span><span class="p">(</span><span class="n">emp</span><span class="p">,</span><span class="n">office</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">commute_range_cut_off</span><span class="p">,</span> <span class="n">commute_data</span><span class="o">=</span><span class="n">commute_data</span><span class="p">)</span>
</span><span id="Analyzer-2110"><a href="#Analyzer-2110"><span class="linenos">2110</span></a>                <span class="n">val_set</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graphing</span><span class="o">.</span><span class="n">get_commute_values</span><span class="p">(</span><span class="n">emp_within</span><span class="p">,</span> <span class="n">office</span><span class="p">,</span> <span class="n">commute_data</span><span class="p">,</span> <span class="n">values</span><span class="p">)</span>
</span><span id="Analyzer-2111"><a href="#Analyzer-2111"><span class="linenos">2111</span></a>                <span class="c1"># restore val_set columns latitutde and longitude to origin_lat and origin_long</span>
</span><span id="Analyzer-2112"><a href="#Analyzer-2112"><span class="linenos">2112</span></a>                <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;origin_lat&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;latitude&#39;</span><span class="p">]</span>
</span><span id="Analyzer-2113"><a href="#Analyzer-2113"><span class="linenos">2113</span></a>                <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;origin_long&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;longitude&#39;</span><span class="p">]</span>
</span><span id="Analyzer-2114"><a href="#Analyzer-2114"><span class="linenos">2114</span></a>
</span><span id="Analyzer-2115"><a href="#Analyzer-2115"><span class="linenos">2115</span></a>                <span class="c1"># for each employee, for each day&#39;s morning and evening commute, get the traffic regime</span>
</span><span id="Analyzer-2116"><a href="#Analyzer-2116"><span class="linenos">2116</span></a>                <span class="c1"># add the traffic regime to the val_set dataframe</span>
</span><span id="Analyzer-2117"><a href="#Analyzer-2117"><span class="linenos">2117</span></a>                
</span><span id="Analyzer-2118"><a href="#Analyzer-2118"><span class="linenos">2118</span></a>                <span class="c1"># lambda to call get_traffic_regime(distance, duration_in_traffic) using distance and duration_in_traffic columns</span>
</span><span id="Analyzer-2119"><a href="#Analyzer-2119"><span class="linenos">2119</span></a>                <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;m_morning_traffic_regime&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">val_set</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_traffic_regime</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;miles&#39;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;m_morning_duration_in_traffic&#39;</span><span class="p">]),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="Analyzer-2120"><a href="#Analyzer-2120"><span class="linenos">2120</span></a>                <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;m_evening_traffic_regime&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">val_set</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_traffic_regime</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;miles&#39;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;m_evening_duration_in_traffic&#39;</span><span class="p">]),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="Analyzer-2121"><a href="#Analyzer-2121"><span class="linenos">2121</span></a>                <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;t_morning_traffic_regime&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">val_set</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_traffic_regime</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;miles&#39;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;t_morning_duration_in_traffic&#39;</span><span class="p">]),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="Analyzer-2122"><a href="#Analyzer-2122"><span class="linenos">2122</span></a>                <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;t_evening_traffic_regime&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">val_set</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_traffic_regime</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;miles&#39;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;t_evening_duration_in_traffic&#39;</span><span class="p">]),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="Analyzer-2123"><a href="#Analyzer-2123"><span class="linenos">2123</span></a>                <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;w_morning_traffic_regime&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">val_set</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_traffic_regime</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;miles&#39;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;w_morning_duration_in_traffic&#39;</span><span class="p">]),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="Analyzer-2124"><a href="#Analyzer-2124"><span class="linenos">2124</span></a>                <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;w_evening_traffic_regime&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">val_set</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_traffic_regime</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;miles&#39;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;w_evening_duration_in_traffic&#39;</span><span class="p">]),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="Analyzer-2125"><a href="#Analyzer-2125"><span class="linenos">2125</span></a>                <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;h_morning_traffic_regime&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">val_set</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_traffic_regime</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;miles&#39;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;h_morning_duration_in_traffic&#39;</span><span class="p">]),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="Analyzer-2126"><a href="#Analyzer-2126"><span class="linenos">2126</span></a>                <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;h_evening_traffic_regime&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">val_set</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_traffic_regime</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;miles&#39;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;h_evening_duration_in_traffic&#39;</span><span class="p">]),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="Analyzer-2127"><a href="#Analyzer-2127"><span class="linenos">2127</span></a>                <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;f_morning_traffic_regime&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">val_set</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_traffic_regime</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;miles&#39;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;f_morning_duration_in_traffic&#39;</span><span class="p">]),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="Analyzer-2128"><a href="#Analyzer-2128"><span class="linenos">2128</span></a>                <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;f_evening_traffic_regime&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">val_set</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_traffic_regime</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;miles&#39;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;f_evening_duration_in_traffic&#39;</span><span class="p">]),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="Analyzer-2129"><a href="#Analyzer-2129"><span class="linenos">2129</span></a>
</span><span id="Analyzer-2130"><a href="#Analyzer-2130"><span class="linenos">2130</span></a>                <span class="c1"># save val_set to file for debugging</span>
</span><span id="Analyzer-2131"><a href="#Analyzer-2131"><span class="linenos">2131</span></a>            
</span><span id="Analyzer-2132"><a href="#Analyzer-2132"><span class="linenos">2132</span></a>                <span class="c1"># get the counts of each traffic regime for each office</span>
</span><span id="Analyzer-2133"><a href="#Analyzer-2133"><span class="linenos">2133</span></a>                <span class="n">traffic_graph_keys</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;m_morning_traffic_regime&#39;</span><span class="p">,</span>
</span><span id="Analyzer-2134"><a href="#Analyzer-2134"><span class="linenos">2134</span></a>                                        <span class="s1">&#39;t_morning_traffic_regime&#39;</span><span class="p">,</span>
</span><span id="Analyzer-2135"><a href="#Analyzer-2135"><span class="linenos">2135</span></a>                                        <span class="s1">&#39;w_morning_traffic_regime&#39;</span><span class="p">,</span>
</span><span id="Analyzer-2136"><a href="#Analyzer-2136"><span class="linenos">2136</span></a>                                        <span class="s1">&#39;h_morning_traffic_regime&#39;</span><span class="p">,</span>
</span><span id="Analyzer-2137"><a href="#Analyzer-2137"><span class="linenos">2137</span></a>                                        <span class="s1">&#39;f_morning_traffic_regime&#39;</span><span class="p">,</span>
</span><span id="Analyzer-2138"><a href="#Analyzer-2138"><span class="linenos">2138</span></a>                                        <span class="s1">&#39;m_evening_traffic_regime&#39;</span><span class="p">,</span>
</span><span id="Analyzer-2139"><a href="#Analyzer-2139"><span class="linenos">2139</span></a>                                        <span class="s1">&#39;t_evening_traffic_regime&#39;</span><span class="p">,</span>
</span><span id="Analyzer-2140"><a href="#Analyzer-2140"><span class="linenos">2140</span></a>                                        <span class="s1">&#39;w_evening_traffic_regime&#39;</span><span class="p">,</span>
</span><span id="Analyzer-2141"><a href="#Analyzer-2141"><span class="linenos">2141</span></a>                                        <span class="s1">&#39;h_evening_traffic_regime&#39;</span><span class="p">,</span>
</span><span id="Analyzer-2142"><a href="#Analyzer-2142"><span class="linenos">2142</span></a>                                        <span class="s1">&#39;f_evening_traffic_regime&#39;</span><span class="p">]</span>
</span><span id="Analyzer-2143"><a href="#Analyzer-2143"><span class="linenos">2143</span></a>                
</span><span id="Analyzer-2144"><a href="#Analyzer-2144"><span class="linenos">2144</span></a>                <span class="n">traffic_graphs_nice_names</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;m_morning_traffic_regime&quot;</span><span class="p">:</span><span class="s2">&quot;Monday Morning&quot;</span><span class="p">,</span>
</span><span id="Analyzer-2145"><a href="#Analyzer-2145"><span class="linenos">2145</span></a>                                             <span class="s2">&quot;t_morning_traffic_regime&quot;</span><span class="p">:</span><span class="s2">&quot;Tuesday Morning&quot;</span><span class="p">,</span>
</span><span id="Analyzer-2146"><a href="#Analyzer-2146"><span class="linenos">2146</span></a>                                             <span class="s2">&quot;w_morning_traffic_regime&quot;</span><span class="p">:</span><span class="s2">&quot;Wednesday Morning&quot;</span><span class="p">,</span>
</span><span id="Analyzer-2147"><a href="#Analyzer-2147"><span class="linenos">2147</span></a>                                             <span class="s2">&quot;h_morning_traffic_regime&quot;</span><span class="p">:</span><span class="s2">&quot;Thursday Morning&quot;</span><span class="p">,</span>
</span><span id="Analyzer-2148"><a href="#Analyzer-2148"><span class="linenos">2148</span></a>                                             <span class="s2">&quot;f_morning_traffic_regime&quot;</span><span class="p">:</span><span class="s2">&quot;Friday Morning&quot;</span><span class="p">,</span>
</span><span id="Analyzer-2149"><a href="#Analyzer-2149"><span class="linenos">2149</span></a>                                             <span class="s2">&quot;m_evening_traffic_regime&quot;</span><span class="p">:</span><span class="s2">&quot;Monday Evening&quot;</span><span class="p">,</span>
</span><span id="Analyzer-2150"><a href="#Analyzer-2150"><span class="linenos">2150</span></a>                                             <span class="s2">&quot;t_evening_traffic_regime&quot;</span><span class="p">:</span><span class="s2">&quot;Tuesday Evening&quot;</span><span class="p">,</span>
</span><span id="Analyzer-2151"><a href="#Analyzer-2151"><span class="linenos">2151</span></a>                                             <span class="s2">&quot;w_evening_traffic_regime&quot;</span><span class="p">:</span><span class="s2">&quot;Wednesday Evening&quot;</span><span class="p">,</span>
</span><span id="Analyzer-2152"><a href="#Analyzer-2152"><span class="linenos">2152</span></a>                                             <span class="s2">&quot;h_evening_traffic_regime&quot;</span><span class="p">:</span><span class="s2">&quot;Thursday Evening&quot;</span><span class="p">,</span>
</span><span id="Analyzer-2153"><a href="#Analyzer-2153"><span class="linenos">2153</span></a>                                             <span class="s2">&quot;f_evening_traffic_regime&quot;</span><span class="p">:</span><span class="s2">&quot;Friday Evening&quot;</span><span class="p">}</span>
</span><span id="Analyzer-2154"><a href="#Analyzer-2154"><span class="linenos">2154</span></a>                
</span><span id="Analyzer-2155"><a href="#Analyzer-2155"><span class="linenos">2155</span></a>                <span class="n">traffic_regimes</span> <span class="o">=</span> <span class="p">{</span><span class="mi">1</span><span class="p">:</span><span class="s2">&quot;Congested&quot;</span><span class="p">,</span><span class="mi">2</span><span class="p">:</span><span class="s2">&quot;Bounded&quot;</span><span class="p">,</span><span class="mi">3</span><span class="p">:</span><span class="s2">&quot;Free Flow&quot;</span><span class="p">}</span>
</span><span id="Analyzer-2156"><a href="#Analyzer-2156"><span class="linenos">2156</span></a>
</span><span id="Analyzer-2157"><a href="#Analyzer-2157"><span class="linenos">2157</span></a>                <span class="c1"># create a dictionary to hold the traffic regime counts for each day and morning/evening</span>
</span><span id="Analyzer-2158"><a href="#Analyzer-2158"><span class="linenos">2158</span></a>                <span class="n">traffic_regime_counts</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="Analyzer-2159"><a href="#Analyzer-2159"><span class="linenos">2159</span></a>                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">traffic_graph_keys</span><span class="p">:</span>
</span><span id="Analyzer-2160"><a href="#Analyzer-2160"><span class="linenos">2160</span></a>                    <span class="n">traffic_regime_counts</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">val_set</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>
</span><span id="Analyzer-2161"><a href="#Analyzer-2161"><span class="linenos">2161</span></a>                    <span class="c1"># sort the dictionary by key</span>
</span><span id="Analyzer-2162"><a href="#Analyzer-2162"><span class="linenos">2162</span></a>                    <span class="n">traffic_regime_counts</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">traffic_regime_counts</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">()))</span>
</span><span id="Analyzer-2163"><a href="#Analyzer-2163"><span class="linenos">2163</span></a>
</span><span id="Analyzer-2164"><a href="#Analyzer-2164"><span class="linenos">2164</span></a>                <span class="c1"># traffic_regime_counts now holds: </span>
</span><span id="Analyzer-2165"><a href="#Analyzer-2165"><span class="linenos">2165</span></a>                <span class="c1"># {&#39;m_morning_traffic_regime&#39;: {1: 1539, 2: 424}, &#39;t_morning_traffic_regime&#39;: {1: 1863, 2: 100}, &#39;w_morning_traffic_regime&#39;: {1: 1874, 2: 89}, &#39;h_morning_traffic_regime&#39;: {1: 1824, 2: 139}, &#39;f_morning_traffic_regime&#39;: {1: 1348, 2: 615}, &#39;m_evening_traffic_regime&#39;: {1: 1711, 2: 252}, &#39;t_evening_traffic_regime&#39;: {1: 1826, 2: 137}, &#39;w_evening_traffic_regime&#39;: {1: 1888, 2: 75}, &#39;h_evening_traffic_regime&#39;: {1: 1878, 2: 85}, &#39;f_evening_traffic_regime&#39;: {1: 1704, 2: 259}}</span>
</span><span id="Analyzer-2166"><a href="#Analyzer-2166"><span class="linenos">2166</span></a>                
</span><span id="Analyzer-2167"><a href="#Analyzer-2167"><span class="linenos">2167</span></a>                <span class="c1"># create a values variable holding a list of the traffic regime counts for each day and morning/evening</span>
</span><span id="Analyzer-2168"><a href="#Analyzer-2168"><span class="linenos">2168</span></a>                <span class="n">values</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Analyzer-2169"><a href="#Analyzer-2169"><span class="linenos">2169</span></a>                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">traffic_graph_keys</span><span class="p">:</span>
</span><span id="Analyzer-2170"><a href="#Analyzer-2170"><span class="linenos">2170</span></a>                    <span class="n">values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">traffic_regime_counts</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span>
</span><span id="Analyzer-2171"><a href="#Analyzer-2171"><span class="linenos">2171</span></a>
</span><span id="Analyzer-2172"><a href="#Analyzer-2172"><span class="linenos">2172</span></a>                <span class="c1"># iterate through traffic regime counts and create a list of labels for each day and morning/evening for regimes where counts are present</span>
</span><span id="Analyzer-2173"><a href="#Analyzer-2173"><span class="linenos">2173</span></a>                <span class="n">labels</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Analyzer-2174"><a href="#Analyzer-2174"><span class="linenos">2174</span></a>                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">traffic_graph_keys</span><span class="p">:</span>
</span><span id="Analyzer-2175"><a href="#Analyzer-2175"><span class="linenos">2175</span></a>                    <span class="n">label</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Analyzer-2176"><a href="#Analyzer-2176"><span class="linenos">2176</span></a>                    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">traffic_regime_counts</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
</span><span id="Analyzer-2177"><a href="#Analyzer-2177"><span class="linenos">2177</span></a>                        <span class="n">label</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">traffic_regimes</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
</span><span id="Analyzer-2178"><a href="#Analyzer-2178"><span class="linenos">2178</span></a>                    <span class="n">labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>
</span><span id="Analyzer-2179"><a href="#Analyzer-2179"><span class="linenos">2179</span></a>                
</span><span id="Analyzer-2180"><a href="#Analyzer-2180"><span class="linenos">2180</span></a>                <span class="c1"># iterate through the labels and get the colors for each traffic regime colors(i+1) will return a color for each regime</span>
</span><span id="Analyzer-2181"><a href="#Analyzer-2181"><span class="linenos">2181</span></a>                <span class="n">colors_list</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Analyzer-2182"><a href="#Analyzer-2182"><span class="linenos">2182</span></a>                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">labels</span><span class="p">)):</span>
</span><span id="Analyzer-2183"><a href="#Analyzer-2183"><span class="linenos">2183</span></a>                    <span class="n">color_list</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Analyzer-2184"><a href="#Analyzer-2184"><span class="linenos">2184</span></a>                    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">labels</span><span class="p">[</span><span class="n">i</span><span class="p">])):</span>
</span><span id="Analyzer-2185"><a href="#Analyzer-2185"><span class="linenos">2185</span></a>                        <span class="n">color_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">colors</span><span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="mi">7</span><span class="p">))</span>
</span><span id="Analyzer-2186"><a href="#Analyzer-2186"><span class="linenos">2186</span></a>                    <span class="n">colors_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">color_list</span><span class="p">)</span>
</span><span id="Analyzer-2187"><a href="#Analyzer-2187"><span class="linenos">2187</span></a>                
</span><span id="Analyzer-2188"><a href="#Analyzer-2188"><span class="linenos">2188</span></a>                <span class="c1"># create a titles variable holding a list of the traffic graph nice names</span>
</span><span id="Analyzer-2189"><a href="#Analyzer-2189"><span class="linenos">2189</span></a>                <span class="n">titles</span> <span class="o">=</span> <span class="p">[</span><span class="n">traffic_graphs_nice_names</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">traffic_graph_keys</span><span class="p">]</span>
</span><span id="Analyzer-2190"><a href="#Analyzer-2190"><span class="linenos">2190</span></a>                <span class="n">rows</span> <span class="o">=</span> <span class="mi">2</span>
</span><span id="Analyzer-2191"><a href="#Analyzer-2191"><span class="linenos">2191</span></a>                <span class="n">cols</span> <span class="o">=</span> <span class="mi">5</span>
</span><span id="Analyzer-2192"><a href="#Analyzer-2192"><span class="linenos">2192</span></a>                <span class="c1"># create a composite pie chart, five wide, with rows for morning and evening.  Each pie chart will display three values, Congested, Bounded, Free Flow</span>
</span><span id="Analyzer-2193"><a href="#Analyzer-2193"><span class="linenos">2193</span></a>                <span class="n">plt</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graphing</span><span class="o">.</span><span class="n">get_piechart</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="n">titles</span><span class="o">=</span><span class="n">titles</span><span class="p">,</span> <span class="n">suptitle</span><span class="o">=</span><span class="n">title</span><span class="p">,</span> <span class="n">value_labels</span><span class="o">=</span><span class="n">labels</span><span class="p">,</span> 
</span><span id="Analyzer-2194"><a href="#Analyzer-2194"><span class="linenos">2194</span></a>                                                    <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">21</span><span class="p">,</span><span class="mi">7</span><span class="p">),</span> <span class="n">manual_plot</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">font_mod</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">rows</span><span class="o">=</span><span class="n">rows</span><span class="p">,</span> <span class="n">cols</span><span class="o">=</span><span class="n">cols</span><span class="p">,</span> <span class="n">startangle</span><span class="o">=</span><span class="mi">70</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="n">colors_list</span><span class="p">)</span>
</span><span id="Analyzer-2195"><a href="#Analyzer-2195"><span class="linenos">2195</span></a>                <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">(</span><span class="n">pad</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">w_pad</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">h_pad</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="Analyzer-2196"><a href="#Analyzer-2196"><span class="linenos">2196</span></a>                <span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">top</span><span class="o">=</span><span class="mf">0.85</span><span class="p">)</span>
</span><span id="Analyzer-2197"><a href="#Analyzer-2197"><span class="linenos">2197</span></a>                <span class="c1"># mauanlly adjust the font size of suptitle and plot titles</span>
</span><span id="Analyzer-2198"><a href="#Analyzer-2198"><span class="linenos">2198</span></a>                <span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">25</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">)</span>
</span><span id="Analyzer-2199"><a href="#Analyzer-2199"><span class="linenos">2199</span></a>                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">rows</span><span class="p">):</span>
</span><span id="Analyzer-2200"><a href="#Analyzer-2200"><span class="linenos">2200</span></a>                    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">cols</span><span class="p">):</span>
</span><span id="Analyzer-2201"><a href="#Analyzer-2201"><span class="linenos">2201</span></a>                        <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">title</span><span class="o">.</span><span class="n">set_fontsize</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>
</span><span id="Analyzer-2202"><a href="#Analyzer-2202"><span class="linenos">2202</span></a>                        <span class="c1"># set bold</span>
</span><span id="Analyzer-2203"><a href="#Analyzer-2203"><span class="linenos">2203</span></a>                        <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">title</span><span class="o">.</span><span class="n">set_fontweight</span><span class="p">(</span><span class="s1">&#39;bold&#39;</span><span class="p">)</span>
</span><span id="Analyzer-2204"><a href="#Analyzer-2204"><span class="linenos">2204</span></a>                
</span><span id="Analyzer-2205"><a href="#Analyzer-2205"><span class="linenos">2205</span></a>                <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">plots_dir</span><span class="o">+</span><span class="s2">&quot;/&quot;</span><span class="o">+</span><span class="n">key</span><span class="o">+</span><span class="s2">&quot;.png&quot;</span><span class="p">)</span>
</span><span id="Analyzer-2206"><a href="#Analyzer-2206"><span class="linenos">2206</span></a>                <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="Analyzer-2207"><a href="#Analyzer-2207"><span class="linenos">2207</span></a>                
</span><span id="Analyzer-2208"><a href="#Analyzer-2208"><span class="linenos">2208</span></a>
</span><span id="Analyzer-2209"><a href="#Analyzer-2209"><span class="linenos">2209</span></a>        <span class="c1">################################################################################</span>
</span><span id="Analyzer-2210"><a href="#Analyzer-2210"><span class="linenos">2210</span></a>        <span class="c1">### GRAPH SET: Local Analysis for Office X</span>
</span><span id="Analyzer-2211"><a href="#Analyzer-2211"><span class="linenos">2211</span></a>        <span class="c1"># iterate through offices, generate a graph for each office</span>
</span><span id="Analyzer-2212"><a href="#Analyzer-2212"><span class="linenos">2212</span></a>        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">offices</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>    
</span><span id="Analyzer-2213"><a href="#Analyzer-2213"><span class="linenos">2213</span></a>            <span class="c1">################################################################################ </span>
</span><span id="Analyzer-2214"><a href="#Analyzer-2214"><span class="linenos">2214</span></a>            <span class="c1"># GRAPH: </span>
</span><span id="Analyzer-2215"><a href="#Analyzer-2215"><span class="linenos">2215</span></a>            <span class="c1">## Worst Case Emissions Rate Heat Map Analysis</span>
</span><span id="Analyzer-2216"><a href="#Analyzer-2216"><span class="linenos">2216</span></a>            <span class="n">key</span> <span class="o">=</span> <span class="s1">&#39;wcerhma&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
</span><span id="Analyzer-2217"><a href="#Analyzer-2217"><span class="linenos">2217</span></a>            <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;Worst Case Emissions Rate Heat Map Analysis for &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;address&#39;</span><span class="p">])</span>
</span><span id="Analyzer-2218"><a href="#Analyzer-2218"><span class="linenos">2218</span></a>            <span class="n">short_title</span> <span class="o">=</span> <span class="n">title</span>
</span><span id="Analyzer-2219"><a href="#Analyzer-2219"><span class="linenos">2219</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">graph_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="p">{</span><span class="s2">&quot;GRAPH&quot;</span><span class="p">:</span> <span class="n">key</span><span class="p">,</span>
</span><span id="Analyzer-2220"><a href="#Analyzer-2220"><span class="linenos">2220</span></a>                                    <span class="s2">&quot;TITLE&quot;</span><span class="p">:</span> <span class="n">short_title</span><span class="p">,</span>
</span><span id="Analyzer-2221"><a href="#Analyzer-2221"><span class="linenos">2221</span></a>                                    <span class="s2">&quot;FILENAME&quot;</span><span class="p">:</span> <span class="n">key</span><span class="o">+</span><span class="s2">&quot;.png&quot;</span><span class="p">,</span>
</span><span id="Analyzer-2222"><a href="#Analyzer-2222"><span class="linenos">2222</span></a>                                    <span class="s2">&quot;PLOT-DESCRIPTION&quot;</span><span class="p">:</span> <span class="s2">&quot;This heat map displays the representative worst case emissions rates for each office option. &quot;</span>
</span><span id="Analyzer-2223"><a href="#Analyzer-2223"><span class="linenos">2223</span></a>                                    <span class="p">})</span>
</span><span id="Analyzer-2224"><a href="#Analyzer-2224"><span class="linenos">2224</span></a>            
</span><span id="Analyzer-2225"><a href="#Analyzer-2225"><span class="linenos">2225</span></a>            <span class="k">if</span> <span class="n">graph</span> <span class="o">==</span> <span class="s2">&quot;_all&quot;</span> <span class="ow">or</span> <span class="n">graph</span> <span class="o">==</span> <span class="n">key</span><span class="p">:</span>
</span><span id="Analyzer-2226"><a href="#Analyzer-2226"><span class="linenos">2226</span></a>                <span class="n">office</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">to_frame</span><span class="p">()</span><span class="o">.</span><span class="n">T</span>
</span><span id="Analyzer-2227"><a href="#Analyzer-2227"><span class="linenos">2227</span></a>                <span class="c1"># get the needed commute values</span>
</span><span id="Analyzer-2228"><a href="#Analyzer-2228"><span class="linenos">2228</span></a>                <span class="n">values</span> <span class="o">=</span> <span class="n">commute_data</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span>
</span><span id="Analyzer-2229"><a href="#Analyzer-2229"><span class="linenos">2229</span></a>                <span class="c1"># filter teh employees to only those within the cutoff distance</span>
</span><span id="Analyzer-2230"><a href="#Analyzer-2230"><span class="linenos">2230</span></a>                <span class="n">emp_within</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graphing</span><span class="o">.</span><span class="n">filter_drive_distance</span><span class="p">(</span><span class="n">emp</span><span class="p">,</span><span class="n">office</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">commute_range_cut_off</span><span class="p">,</span> <span class="n">commute_data</span><span class="o">=</span><span class="n">commute_data</span><span class="p">)</span>
</span><span id="Analyzer-2231"><a href="#Analyzer-2231"><span class="linenos">2231</span></a>                <span class="n">val_set</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graphing</span><span class="o">.</span><span class="n">get_commute_values</span><span class="p">(</span><span class="n">emp_within</span><span class="p">,</span> <span class="n">office</span><span class="p">,</span> <span class="n">commute_data</span><span class="p">,</span> <span class="n">values</span><span class="p">)</span>
</span><span id="Analyzer-2232"><a href="#Analyzer-2232"><span class="linenos">2232</span></a>                <span class="c1"># restore val_set columns latitutde and longitude to origin_lat and origin_long</span>
</span><span id="Analyzer-2233"><a href="#Analyzer-2233"><span class="linenos">2233</span></a>                <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;origin_lat&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;latitude&#39;</span><span class="p">]</span>
</span><span id="Analyzer-2234"><a href="#Analyzer-2234"><span class="linenos">2234</span></a>                <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;origin_long&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;longitude&#39;</span><span class="p">]</span>
</span><span id="Analyzer-2235"><a href="#Analyzer-2235"><span class="linenos">2235</span></a>
</span><span id="Analyzer-2236"><a href="#Analyzer-2236"><span class="linenos">2236</span></a>                <span class="n">traffic_graph_keys</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;m_morning_emissions&#39;</span><span class="p">,</span>
</span><span id="Analyzer-2237"><a href="#Analyzer-2237"><span class="linenos">2237</span></a>                                        <span class="s1">&#39;t_morning_emissions&#39;</span><span class="p">,</span>
</span><span id="Analyzer-2238"><a href="#Analyzer-2238"><span class="linenos">2238</span></a>                                        <span class="s1">&#39;w_morning_emissions&#39;</span><span class="p">,</span>
</span><span id="Analyzer-2239"><a href="#Analyzer-2239"><span class="linenos">2239</span></a>                                        <span class="s1">&#39;h_morning_emissions&#39;</span><span class="p">,</span>
</span><span id="Analyzer-2240"><a href="#Analyzer-2240"><span class="linenos">2240</span></a>                                        <span class="s1">&#39;f_morning_emissions&#39;</span><span class="p">,</span>
</span><span id="Analyzer-2241"><a href="#Analyzer-2241"><span class="linenos">2241</span></a>                                        <span class="s1">&#39;m_evening_emissions&#39;</span><span class="p">,</span>
</span><span id="Analyzer-2242"><a href="#Analyzer-2242"><span class="linenos">2242</span></a>                                        <span class="s1">&#39;t_evening_emissions&#39;</span><span class="p">,</span>
</span><span id="Analyzer-2243"><a href="#Analyzer-2243"><span class="linenos">2243</span></a>                                        <span class="s1">&#39;w_evening_emissions&#39;</span><span class="p">,</span>
</span><span id="Analyzer-2244"><a href="#Analyzer-2244"><span class="linenos">2244</span></a>                                        <span class="s1">&#39;h_evening_emissions&#39;</span><span class="p">,</span>
</span><span id="Analyzer-2245"><a href="#Analyzer-2245"><span class="linenos">2245</span></a>                                        <span class="s1">&#39;f_evening_emissions&#39;</span><span class="p">]</span>
</span><span id="Analyzer-2246"><a href="#Analyzer-2246"><span class="linenos">2246</span></a>                
</span><span id="Analyzer-2247"><a href="#Analyzer-2247"><span class="linenos">2247</span></a>                <span class="n">traffic_graphs_nice_names</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;m_morning_emissions&quot;</span><span class="p">:</span><span class="s2">&quot;Monday Morning&quot;</span><span class="p">,</span>
</span><span id="Analyzer-2248"><a href="#Analyzer-2248"><span class="linenos">2248</span></a>                                             <span class="s2">&quot;t_morning_emissions&quot;</span><span class="p">:</span><span class="s2">&quot;Tuesday Morning&quot;</span><span class="p">,</span>
</span><span id="Analyzer-2249"><a href="#Analyzer-2249"><span class="linenos">2249</span></a>                                             <span class="s2">&quot;w_morning_emissions&quot;</span><span class="p">:</span><span class="s2">&quot;Wednesday Morning&quot;</span><span class="p">,</span>
</span><span id="Analyzer-2250"><a href="#Analyzer-2250"><span class="linenos">2250</span></a>                                             <span class="s2">&quot;h_morning_emissions&quot;</span><span class="p">:</span><span class="s2">&quot;Thursday Morning&quot;</span><span class="p">,</span>
</span><span id="Analyzer-2251"><a href="#Analyzer-2251"><span class="linenos">2251</span></a>                                             <span class="s2">&quot;f_morning_emissions&quot;</span><span class="p">:</span><span class="s2">&quot;Friday Morning&quot;</span><span class="p">,</span>
</span><span id="Analyzer-2252"><a href="#Analyzer-2252"><span class="linenos">2252</span></a>                                             <span class="s2">&quot;m_evening_emissions&quot;</span><span class="p">:</span><span class="s2">&quot;Monday Evening&quot;</span><span class="p">,</span>
</span><span id="Analyzer-2253"><a href="#Analyzer-2253"><span class="linenos">2253</span></a>                                             <span class="s2">&quot;t_evening_emissions&quot;</span><span class="p">:</span><span class="s2">&quot;Tuesday Evening&quot;</span><span class="p">,</span>
</span><span id="Analyzer-2254"><a href="#Analyzer-2254"><span class="linenos">2254</span></a>                                             <span class="s2">&quot;w_evening_emissions&quot;</span><span class="p">:</span><span class="s2">&quot;Wednesday Evening&quot;</span><span class="p">,</span>
</span><span id="Analyzer-2255"><a href="#Analyzer-2255"><span class="linenos">2255</span></a>                                             <span class="s2">&quot;h_evening_emissions&quot;</span><span class="p">:</span><span class="s2">&quot;Thursday Evening&quot;</span><span class="p">,</span>
</span><span id="Analyzer-2256"><a href="#Analyzer-2256"><span class="linenos">2256</span></a>                                             <span class="s2">&quot;f_evening_emissions&quot;</span><span class="p">:</span><span class="s2">&quot;Friday Evening&quot;</span><span class="p">}</span>
</span><span id="Analyzer-2257"><a href="#Analyzer-2257"><span class="linenos">2257</span></a>                
</span><span id="Analyzer-2258"><a href="#Analyzer-2258"><span class="linenos">2258</span></a>                <span class="c1"># get the sum total emissions for each day and morning/evening</span>
</span><span id="Analyzer-2259"><a href="#Analyzer-2259"><span class="linenos">2259</span></a>                <span class="n">emissions</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Analyzer-2260"><a href="#Analyzer-2260"><span class="linenos">2260</span></a>                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">traffic_graph_keys</span><span class="p">:</span>
</span><span id="Analyzer-2261"><a href="#Analyzer-2261"><span class="linenos">2261</span></a>                    <span class="n">emissions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">val_set</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span>
</span><span id="Analyzer-2262"><a href="#Analyzer-2262"><span class="linenos">2262</span></a>
</span><span id="Analyzer-2263"><a href="#Analyzer-2263"><span class="linenos">2263</span></a>                <span class="c1"># create a dictionary to hold the emissions for each day and morning/evening</span>
</span><span id="Analyzer-2264"><a href="#Analyzer-2264"><span class="linenos">2264</span></a>                <span class="n">emissions_dict</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="Analyzer-2265"><a href="#Analyzer-2265"><span class="linenos">2265</span></a>                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">traffic_graph_keys</span><span class="p">)):</span>
</span><span id="Analyzer-2266"><a href="#Analyzer-2266"><span class="linenos">2266</span></a>                    <span class="n">emissions_dict</span><span class="p">[</span><span class="n">traffic_graph_keys</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">=</span> <span class="n">emissions</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</span><span id="Analyzer-2267"><a href="#Analyzer-2267"><span class="linenos">2267</span></a>                
</span><span id="Analyzer-2268"><a href="#Analyzer-2268"><span class="linenos">2268</span></a>
</span><span id="Analyzer-2269"><a href="#Analyzer-2269"><span class="linenos">2269</span></a>                <span class="n">plt</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graphing</span><span class="o">.</span><span class="n">get_heatmap</span><span class="p">(</span><span class="n">emp_within</span><span class="p">,</span> <span class="n">office</span><span class="p">,</span> <span class="n">val_set</span><span class="p">,</span> <span class="s2">&quot;w_evening_emissions&quot;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Worst Case Emissions Rate (Wed. Evening)) </span><span class="se">\n</span><span class="s2">for &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;address&#39;</span><span class="p">]),</span> 
</span><span id="Analyzer-2270"><a href="#Analyzer-2270"><span class="linenos">2270</span></a>                                                <span class="n">value_label</span><span class="o">=</span><span class="s2">&quot;CO2 Emissions in Traffic (kg/commute)&quot;</span><span class="p">,</span> <span class="n">cutoff_distance</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">commute_range_cut_off</span><span class="p">,</span> 
</span><span id="Analyzer-2271"><a href="#Analyzer-2271"><span class="linenos">2271</span></a>                                                <span class="n">commute_radius</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">commute_range_cut_off</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.4</span><span class="p">,</span> <span class="n">levels</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">font_mod</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span> 
</span><span id="Analyzer-2272"><a href="#Analyzer-2272"><span class="linenos">2272</span></a>                                                <span class="n">convex_hull</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">plot_points</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">imagery</span><span class="o">=</span><span class="s2">&quot;Google&quot;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gist_heat_r&#39;</span><span class="p">)</span>
</span><span id="Analyzer-2273"><a href="#Analyzer-2273"><span class="linenos">2273</span></a>                <span class="c1"># add a text label to the bottom right of the plot with the total emissions for the plotted value</span>
</span><span id="Analyzer-2274"><a href="#Analyzer-2274"><span class="linenos">2274</span></a>                <span class="n">t</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;em&#39;</span> <span class="p">:</span> <span class="s1">&#39;Total Emissions / Commute: </span><span class="si">{:.2f}</span><span class="s1"> kg&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">emissions_dict</span><span class="p">[</span><span class="s1">&#39;w_evening_emissions&#39;</span><span class="p">])}</span>    
</span><span id="Analyzer-2275"><a href="#Analyzer-2275"><span class="linenos">2275</span></a>                <span class="c1"># add to plot</span>
</span><span id="Analyzer-2276"><a href="#Analyzer-2276"><span class="linenos">2276</span></a>                <span class="n">textstr</span> <span class="o">=</span> <span class="n">t</span><span class="p">[</span><span class="s1">&#39;em&#39;</span><span class="p">]</span>                              
</span><span id="Analyzer-2277"><a href="#Analyzer-2277"><span class="linenos">2277</span></a>                <span class="c1"># these are matplotlib.patch.Patch properties</span>
</span><span id="Analyzer-2278"><a href="#Analyzer-2278"><span class="linenos">2278</span></a>                <span class="n">props</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">boxstyle</span><span class="o">=</span><span class="s1">&#39;round&#39;</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="Analyzer-2279"><a href="#Analyzer-2279"><span class="linenos">2279</span></a>                <span class="c1"># place a text box in lower right in axes coords,</span>
</span><span id="Analyzer-2280"><a href="#Analyzer-2280"><span class="linenos">2280</span></a>                <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">.985</span><span class="p">,</span> <span class="mf">.015</span><span class="p">,</span> <span class="n">textstr</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">,</span>
</span><span id="Analyzer-2281"><a href="#Analyzer-2281"><span class="linenos">2281</span></a>                            <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;bottom&#39;</span><span class="p">,</span> <span class="n">bbox</span><span class="o">=</span><span class="n">props</span><span class="p">,</span> <span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;family&#39;</span><span class="p">:</span> <span class="s1">&#39;monospace&#39;</span><span class="p">},</span> <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">)</span>
</span><span id="Analyzer-2282"><a href="#Analyzer-2282"><span class="linenos">2282</span></a>                <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">plots_dir</span><span class="o">+</span><span class="s2">&quot;/&quot;</span><span class="o">+</span><span class="n">key</span><span class="o">+</span><span class="s2">&quot;.png&quot;</span><span class="p">)</span>
</span><span id="Analyzer-2283"><a href="#Analyzer-2283"><span class="linenos">2283</span></a>                <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="Analyzer-2284"><a href="#Analyzer-2284"><span class="linenos">2284</span></a>                
</span><span id="Analyzer-2285"><a href="#Analyzer-2285"><span class="linenos">2285</span></a>        <span class="c1">#TODO : GRAPH THE EMISSIONS FOR EACH OFFICE</span>
</span><span id="Analyzer-2286"><a href="#Analyzer-2286"><span class="linenos">2286</span></a>
</span><span id="Analyzer-2287"><a href="#Analyzer-2287"><span class="linenos">2287</span></a>
</span><span id="Analyzer-2288"><a href="#Analyzer-2288"><span class="linenos">2288</span></a>        <span class="c1">################################################################################ </span>
</span><span id="Analyzer-2289"><a href="#Analyzer-2289"><span class="linenos">2289</span></a>        <span class="c1"># GRAPH: </span>
</span><span id="Analyzer-2290"><a href="#Analyzer-2290"><span class="linenos">2290</span></a>        <span class="c1">## Total Emissions Cost Differential Analysis</span>
</span><span id="Analyzer-2291"><a href="#Analyzer-2291"><span class="linenos">2291</span></a>        <span class="n">key</span> <span class="o">=</span> <span class="s1">&#39;tecdca&#39;</span>
</span><span id="Analyzer-2292"><a href="#Analyzer-2292"><span class="linenos">2292</span></a>        <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;Total Emissions Cost Differential Analysis&quot;</span>
</span><span id="Analyzer-2293"><a href="#Analyzer-2293"><span class="linenos">2293</span></a>        <span class="n">short_title</span> <span class="o">=</span> <span class="n">title</span>
</span><span id="Analyzer-2294"><a href="#Analyzer-2294"><span class="linenos">2294</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">graph_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="p">{</span><span class="s2">&quot;GRAPH&quot;</span><span class="p">:</span> <span class="n">key</span><span class="p">,</span>
</span><span id="Analyzer-2295"><a href="#Analyzer-2295"><span class="linenos">2295</span></a>                                <span class="s2">&quot;TITLE&quot;</span><span class="p">:</span> <span class="n">short_title</span><span class="p">,</span>
</span><span id="Analyzer-2296"><a href="#Analyzer-2296"><span class="linenos">2296</span></a>                                <span class="s2">&quot;FILENAME&quot;</span><span class="p">:</span> <span class="n">key</span><span class="o">+</span><span class="s2">&quot;.png&quot;</span><span class="p">,</span>
</span><span id="Analyzer-2297"><a href="#Analyzer-2297"><span class="linenos">2297</span></a>                                <span class="s2">&quot;PLOT-DESCRIPTION&quot;</span><span class="p">:</span> <span class="s2">&quot;This graph displays the differential cost associated with emissions based on the office options.&quot;</span>
</span><span id="Analyzer-2298"><a href="#Analyzer-2298"><span class="linenos">2298</span></a>                                <span class="p">})</span>
</span><span id="Analyzer-2299"><a href="#Analyzer-2299"><span class="linenos">2299</span></a>        
</span><span id="Analyzer-2300"><a href="#Analyzer-2300"><span class="linenos">2300</span></a>        <span class="k">if</span> <span class="n">graph</span> <span class="o">==</span> <span class="s2">&quot;_all&quot;</span> <span class="ow">or</span> <span class="n">graph</span> <span class="o">==</span> <span class="n">key</span><span class="p">:</span>
</span><span id="Analyzer-2301"><a href="#Analyzer-2301"><span class="linenos">2301</span></a>            <span class="c1"># gather the data for the analysis</span>
</span><span id="Analyzer-2302"><a href="#Analyzer-2302"><span class="linenos">2302</span></a>            <span class="n">base_costs</span><span class="p">,</span> <span class="n">cost_values</span><span class="p">,</span> <span class="n">average_diffs</span><span class="p">,</span> <span class="n">conservative_diffs</span><span class="p">,</span> <span class="n">withins</span><span class="p">,</span> <span class="n">employee_costs_to_office</span><span class="p">,</span> <span class="n">current_office</span><span class="p">,</span> <span class="n">other_offices</span> <span class="o">=</span> \
</span><span id="Analyzer-2303"><a href="#Analyzer-2303"><span class="linenos">2303</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">get_emissions_analysis</span><span class="p">(</span><span class="n">emp</span><span class="p">,</span> <span class="n">offices</span><span class="p">,</span> <span class="n">commute_data</span><span class="p">)</span>
</span><span id="Analyzer-2304"><a href="#Analyzer-2304"><span class="linenos">2304</span></a>
</span><span id="Analyzer-2305"><a href="#Analyzer-2305"><span class="linenos">2305</span></a>        
</span><span id="Analyzer-2306"><a href="#Analyzer-2306"><span class="linenos">2306</span></a>            <span class="c1"># now we have a list of dataframes with the differentials, we eliminate all rows with 0 cost differential to prevent skewing the histogram</span>
</span><span id="Analyzer-2307"><a href="#Analyzer-2307"><span class="linenos">2307</span></a>            <span class="c1"># calculate the bin list based upon a the min (negative) and max (positive) values of the data     </span>
</span><span id="Analyzer-2308"><a href="#Analyzer-2308"><span class="linenos">2308</span></a>            <span class="n">binmin</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Analyzer-2309"><a href="#Analyzer-2309"><span class="linenos">2309</span></a>            <span class="n">binmax</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Analyzer-2310"><a href="#Analyzer-2310"><span class="linenos">2310</span></a>            <span class="n">diffs</span> <span class="o">=</span> <span class="p">[</span><span class="n">average_diffs</span><span class="p">,</span> <span class="n">conservative_diffs</span><span class="p">]</span>
</span><span id="Analyzer-2311"><a href="#Analyzer-2311"><span class="linenos">2311</span></a>            <span class="k">for</span> <span class="n">diff</span> <span class="ow">in</span> <span class="n">diffs</span><span class="p">:</span>
</span><span id="Analyzer-2312"><a href="#Analyzer-2312"><span class="linenos">2312</span></a>                <span class="k">for</span> <span class="n">each</span> <span class="ow">in</span> <span class="n">diff</span><span class="p">:</span>
</span><span id="Analyzer-2313"><a href="#Analyzer-2313"><span class="linenos">2313</span></a>                    <span class="k">if</span> <span class="nb">min</span><span class="p">(</span><span class="n">each</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">binmin</span><span class="p">:</span>
</span><span id="Analyzer-2314"><a href="#Analyzer-2314"><span class="linenos">2314</span></a>                        <span class="n">binmin</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">each</span><span class="p">)</span>
</span><span id="Analyzer-2315"><a href="#Analyzer-2315"><span class="linenos">2315</span></a>                    <span class="k">if</span> <span class="nb">max</span><span class="p">(</span><span class="n">each</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">binmax</span><span class="p">:</span>
</span><span id="Analyzer-2316"><a href="#Analyzer-2316"><span class="linenos">2316</span></a>                        <span class="n">binmax</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">each</span><span class="p">)</span>
</span><span id="Analyzer-2317"><a href="#Analyzer-2317"><span class="linenos">2317</span></a>            <span class="n">step</span> <span class="o">=</span> <span class="mf">0.001</span>
</span><span id="Analyzer-2318"><a href="#Analyzer-2318"><span class="linenos">2318</span></a>            <span class="c1"># round the binmin down to the nearest step, max up to the nearest step</span>
</span><span id="Analyzer-2319"><a href="#Analyzer-2319"><span class="linenos">2319</span></a>            <span class="n">bins</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">binmin</span> <span class="o">-</span> <span class="p">(</span><span class="n">binmin</span> <span class="o">%</span> <span class="n">step</span><span class="p">),</span> <span class="n">binmax</span> <span class="o">+</span> <span class="n">step</span> <span class="o">-</span> <span class="p">(</span><span class="n">binmax</span> <span class="o">%</span> <span class="n">step</span><span class="p">),</span> <span class="n">step</span><span class="p">)</span>
</span><span id="Analyzer-2320"><a href="#Analyzer-2320"><span class="linenos">2320</span></a>
</span><span id="Analyzer-2321"><a href="#Analyzer-2321"><span class="linenos">2321</span></a>            <span class="n">dvalues</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Total Average Cost&#39;</span><span class="p">,</span><span class="s1">&#39;Total High Cost&#39;</span><span class="p">]</span>
</span><span id="Analyzer-2322"><a href="#Analyzer-2322"><span class="linenos">2322</span></a>            
</span><span id="Analyzer-2323"><a href="#Analyzer-2323"><span class="linenos">2323</span></a>            <span class="n">plt</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graphing</span><span class="o">.</span><span class="n">get_histogram</span><span class="p">(</span><span class="n">emp</span><span class="p">,</span> <span class="n">other_offices</span><span class="p">,</span> <span class="n">cost_values</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="n">dvalues</span><span class="p">,</span> <span class="n">suptitle</span><span class="o">=</span><span class="n">title</span><span class="p">,</span> <span class="n">cutoff_radius</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">commute_range_cut_off</span><span class="p">,</span>
</span><span id="Analyzer-2324"><a href="#Analyzer-2324"><span class="linenos">2324</span></a>                                      <span class="n">x_label</span><span class="o">=</span><span class="s1">&#39;\$ (USD) per commute&#39;</span><span class="p">,</span> <span class="n">y_label</span><span class="o">=</span><span class="s1">&#39;# Employees (log scale)&#39;</span><span class="p">,</span>
</span><span id="Analyzer-2325"><a href="#Analyzer-2325"><span class="linenos">2325</span></a>                                      <span class="n">bins</span><span class="o">=</span><span class="n">bins</span><span class="p">,</span> <span class="n">rows</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">other_offices</span><span class="p">),</span> <span class="n">cols</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">column_titles</span><span class="o">=</span><span class="n">dvalues</span><span class="p">,</span> 
</span><span id="Analyzer-2326"><a href="#Analyzer-2326"><span class="linenos">2326</span></a>                                      <span class="n">cumulative_line</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">font_mod</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">manual_plot</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">override_values</span><span class="o">=</span><span class="n">cost_values</span><span class="p">)</span>
</span><span id="Analyzer-2327"><a href="#Analyzer-2327"><span class="linenos">2327</span></a>            
</span><span id="Analyzer-2328"><a href="#Analyzer-2328"><span class="linenos">2328</span></a>                  
</span><span id="Analyzer-2329"><a href="#Analyzer-2329"><span class="linenos">2329</span></a>            <span class="c1"># manually add histograms for each office option</span>
</span><span id="Analyzer-2330"><a href="#Analyzer-2330"><span class="linenos">2330</span></a>            <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">other_offices</span><span class="p">)):</span>
</span><span id="Analyzer-2331"><a href="#Analyzer-2331"><span class="linenos">2331</span></a>                <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
</span><span id="Analyzer-2332"><a href="#Analyzer-2332"><span class="linenos">2332</span></a>                    <span class="n">ax</span><span class="p">[</span><span class="n">r</span><span class="p">,</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">average_diffs</span><span class="p">[</span><span class="n">r</span><span class="p">],</span> <span class="n">bins</span><span class="o">=</span><span class="n">bins</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;#555555&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">align</span><span class="o">=</span><span class="s1">&#39;mid&#39;</span><span class="p">,</span> 
</span><span id="Analyzer-2333"><a href="#Analyzer-2333"><span class="linenos">2333</span></a>                            <span class="n">rwidth</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">other_offices</span><span class="p">[</span><span class="s1">&#39;address&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="n">r</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">(</span><span class="n">r</span><span class="o">+</span><span class="mi">2</span><span class="p">),</span> <span class="n">log</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="Analyzer-2334"><a href="#Analyzer-2334"><span class="linenos">2334</span></a>                    <span class="n">ax</span><span class="p">[</span><span class="n">r</span><span class="p">,</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;major&#39;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
</span><span id="Analyzer-2335"><a href="#Analyzer-2335"><span class="linenos">2335</span></a>                    <span class="k">if</span> <span class="n">c</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Analyzer-2336"><a href="#Analyzer-2336"><span class="linenos">2336</span></a>                        <span class="n">ax</span><span class="p">[</span><span class="n">r</span><span class="p">,</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;# Employees (log scale)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
</span><span id="Analyzer-2337"><a href="#Analyzer-2337"><span class="linenos">2337</span></a>                        <span class="c1"># put office address top left of the plot</span>
</span><span id="Analyzer-2338"><a href="#Analyzer-2338"><span class="linenos">2338</span></a>                        <span class="n">ax</span><span class="p">[</span><span class="n">r</span><span class="p">,</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.03</span><span class="p">,</span> <span class="mf">0.99</span><span class="p">,</span> <span class="n">other_offices</span><span class="p">[</span><span class="s1">&#39;address&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="n">r</span><span class="p">],</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="n">r</span><span class="p">,</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;top&#39;</span><span class="p">)</span>
</span><span id="Analyzer-2339"><a href="#Analyzer-2339"><span class="linenos">2339</span></a>                    
</span><span id="Analyzer-2340"><a href="#Analyzer-2340"><span class="linenos">2340</span></a>                    <span class="k">if</span> <span class="n">r</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">other_offices</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span>
</span><span id="Analyzer-2341"><a href="#Analyzer-2341"><span class="linenos">2341</span></a>                        <span class="n">ax</span><span class="p">[</span><span class="n">r</span><span class="p">,</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Cost of C02 Emissions (\$USD/commuting day)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
</span><span id="Analyzer-2342"><a href="#Analyzer-2342"><span class="linenos">2342</span></a>                    <span class="n">ax</span><span class="p">[</span><span class="n">r</span><span class="p">,</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;major&#39;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
</span><span id="Analyzer-2343"><a href="#Analyzer-2343"><span class="linenos">2343</span></a>                    
</span><span id="Analyzer-2344"><a href="#Analyzer-2344"><span class="linenos">2344</span></a>                    <span class="c1"># cost impact is the summation of the cost of emissions for all employees</span>
</span><span id="Analyzer-2345"><a href="#Analyzer-2345"><span class="linenos">2345</span></a>                    <span class="n">cost_impact_avg</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">average_diffs</span><span class="p">[</span><span class="n">r</span><span class="p">])</span>
</span><span id="Analyzer-2346"><a href="#Analyzer-2346"><span class="linenos">2346</span></a>                    <span class="n">cost_impact_con</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">conservative_diffs</span><span class="p">[</span><span class="n">r</span><span class="p">])</span>
</span><span id="Analyzer-2347"><a href="#Analyzer-2347"><span class="linenos">2347</span></a>                    
</span><span id="Analyzer-2348"><a href="#Analyzer-2348"><span class="linenos">2348</span></a>                    <span class="c1"># add a text box with the count</span>
</span><span id="Analyzer-2349"><a href="#Analyzer-2349"><span class="linenos">2349</span></a>                    <span class="n">t</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;co&#39;</span> <span class="p">:</span> <span class="s1">&#39;Total Avg Emissions Cost Difference</span><span class="se">\n</span><span class="s1"> (\$/commuting day): $</span><span class="si">{:,.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cost_impact_avg</span><span class="p">),</span>
</span><span id="Analyzer-2350"><a href="#Analyzer-2350"><span class="linenos">2350</span></a>                            <span class="s1">&#39;ci&#39;</span> <span class="p">:</span> <span class="s1">&#39;Total Conservative Cost Difference</span><span class="se">\n</span><span class="s1"> (\$/commuting day): $</span><span class="si">{:,.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cost_impact_con</span><span class="p">)</span>                         
</span><span id="Analyzer-2351"><a href="#Analyzer-2351"><span class="linenos">2351</span></a>                            <span class="p">}</span>
</span><span id="Analyzer-2352"><a href="#Analyzer-2352"><span class="linenos">2352</span></a>                    
</span><span id="Analyzer-2353"><a href="#Analyzer-2353"><span class="linenos">2353</span></a>                    <span class="n">textstr</span> <span class="o">=</span> <span class="n">t</span><span class="p">[</span><span class="s1">&#39;co&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="n">c</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">t</span><span class="p">[</span><span class="s1">&#39;ci&#39;</span><span class="p">]</span>
</span><span id="Analyzer-2354"><a href="#Analyzer-2354"><span class="linenos">2354</span></a>                    <span class="c1"># these are matplotlib.patch.Patch properties</span>
</span><span id="Analyzer-2355"><a href="#Analyzer-2355"><span class="linenos">2355</span></a>                    <span class="n">props</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">boxstyle</span><span class="o">=</span><span class="s1">&#39;round&#39;</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;wheat&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
</span><span id="Analyzer-2356"><a href="#Analyzer-2356"><span class="linenos">2356</span></a>                    <span class="c1"># place a text box in upper right in axes coords,</span>
</span><span id="Analyzer-2357"><a href="#Analyzer-2357"><span class="linenos">2357</span></a>                    <span class="n">ax</span><span class="p">[</span><span class="n">r</span><span class="p">,</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">.03</span><span class="p">,</span> <span class="mf">.85</span><span class="p">,</span> <span class="n">textstr</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="n">r</span><span class="p">,</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">,</span>
</span><span id="Analyzer-2358"><a href="#Analyzer-2358"><span class="linenos">2358</span></a>                                <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">bbox</span><span class="o">=</span><span class="n">props</span><span class="p">,</span> <span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;family&#39;</span><span class="p">:</span> <span class="s1">&#39;monospace&#39;</span><span class="p">},</span> <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">)</span>
</span><span id="Analyzer-2359"><a href="#Analyzer-2359"><span class="linenos">2359</span></a>                    
</span><span id="Analyzer-2360"><a href="#Analyzer-2360"><span class="linenos">2360</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">(</span><span class="n">pad</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
</span><span id="Analyzer-2361"><a href="#Analyzer-2361"><span class="linenos">2361</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">plots_dir</span><span class="o">+</span><span class="s2">&quot;/&quot;</span><span class="o">+</span><span class="n">key</span><span class="o">+</span><span class="s2">&quot;.png&quot;</span><span class="p">)</span>
</span><span id="Analyzer-2362"><a href="#Analyzer-2362"><span class="linenos">2362</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="Analyzer-2363"><a href="#Analyzer-2363"><span class="linenos">2363</span></a>
</span><span id="Analyzer-2364"><a href="#Analyzer-2364"><span class="linenos">2364</span></a>
</span><span id="Analyzer-2365"><a href="#Analyzer-2365"><span class="linenos">2365</span></a>
</span><span id="Analyzer-2366"><a href="#Analyzer-2366"><span class="linenos">2366</span></a>
</span><span id="Analyzer-2367"><a href="#Analyzer-2367"><span class="linenos">2367</span></a>        <span class="c1"># write the graphs to graphs.json in the project plots directory</span>
</span><span id="Analyzer-2368"><a href="#Analyzer-2368"><span class="linenos">2368</span></a>        <span class="c1"># convert self.graphs_list to json</span>
</span><span id="Analyzer-2369"><a href="#Analyzer-2369"><span class="linenos">2369</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">plots_dir</span><span class="p">,</span> <span class="s2">&quot;graphs.json&quot;</span><span class="p">),</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="Analyzer-2370"><a href="#Analyzer-2370"><span class="linenos">2370</span></a>            <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">graph_list</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
</span><span id="Analyzer-2371"><a href="#Analyzer-2371"><span class="linenos">2371</span></a>
</span><span id="Analyzer-2372"><a href="#Analyzer-2372"><span class="linenos">2372</span></a>        <span class="c1"># update the analysis phase</span>
</span><span id="Analyzer-2373"><a href="#Analyzer-2373"><span class="linenos">2373</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">update_analysis_phase</span><span class="p">()</span>
</span><span id="Analyzer-2374"><a href="#Analyzer-2374"><span class="linenos">2374</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph_list</span>
</span><span id="Analyzer-2375"><a href="#Analyzer-2375"><span class="linenos">2375</span></a>    
</span><span id="Analyzer-2376"><a href="#Analyzer-2376"><span class="linenos">2376</span></a>
</span><span id="Analyzer-2377"><a href="#Analyzer-2377"><span class="linenos">2377</span></a>
</span><span id="Analyzer-2378"><a href="#Analyzer-2378"><span class="linenos">2378</span></a>
</span><span id="Analyzer-2379"><a href="#Analyzer-2379"><span class="linenos">2379</span></a>
</span><span id="Analyzer-2380"><a href="#Analyzer-2380"><span class="linenos">2380</span></a>    <span class="k">def</span> <span class="nf">generate_tables</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">table</span><span class="o">=</span><span class="s2">&quot;_all&quot;</span><span class="p">):</span>
</span><span id="Analyzer-2381"><a href="#Analyzer-2381"><span class="linenos">2381</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Analyzer-2382"><a href="#Analyzer-2382"><span class="linenos">2382</span></a><span class="sd">        Generates and saves tabular representations of analyzed commute data.</span>
</span><span id="Analyzer-2383"><a href="#Analyzer-2383"><span class="linenos">2383</span></a>
</span><span id="Analyzer-2384"><a href="#Analyzer-2384"><span class="linenos">2384</span></a><span class="sd">        Based on the available commute data, this method generates tables such as the overall cost comparison analytics.</span>
</span><span id="Analyzer-2385"><a href="#Analyzer-2385"><span class="linenos">2385</span></a>
</span><span id="Analyzer-2386"><a href="#Analyzer-2386"><span class="linenos">2386</span></a><span class="sd">        Args:</span>
</span><span id="Analyzer-2387"><a href="#Analyzer-2387"><span class="linenos">2387</span></a><span class="sd">            graph (str, optional): Specifies which table to generate. Use &quot;_all&quot; to generate all tables, or specify a </span>
</span><span id="Analyzer-2388"><a href="#Analyzer-2388"><span class="linenos">2388</span></a><span class="sd">            particular table&#39;s key. Defaults to &quot;_all&quot;.</span>
</span><span id="Analyzer-2389"><a href="#Analyzer-2389"><span class="linenos">2389</span></a>
</span><span id="Analyzer-2390"><a href="#Analyzer-2390"><span class="linenos">2390</span></a><span class="sd">        Returns:</span>
</span><span id="Analyzer-2391"><a href="#Analyzer-2391"><span class="linenos">2391</span></a><span class="sd">            list: A list of dictionaries, each containing details about the generated tables, including file paths and titles.</span>
</span><span id="Analyzer-2392"><a href="#Analyzer-2392"><span class="linenos">2392</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Analyzer-2393"><a href="#Analyzer-2393"><span class="linenos">2393</span></a>
</span><span id="Analyzer-2394"><a href="#Analyzer-2394"><span class="linenos">2394</span></a>        <span class="c1"># generate the tables for the project</span>
</span><span id="Analyzer-2395"><a href="#Analyzer-2395"><span class="linenos">2395</span></a>        <span class="c1"># if the commute data isn&#39;t already in the project, load it</span>
</span><span id="Analyzer-2396"><a href="#Analyzer-2396"><span class="linenos">2396</span></a>        <span class="k">if</span> <span class="s2">&quot;commute_data.csv&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">list_data_files</span><span class="p">():</span>
</span><span id="Analyzer-2397"><a href="#Analyzer-2397"><span class="linenos">2397</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;commute_data.csv&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Analyzer-2398"><a href="#Analyzer-2398"><span class="linenos">2398</span></a>                <span class="c1"># attempt to load the commute data</span>
</span><span id="Analyzer-2399"><a href="#Analyzer-2399"><span class="linenos">2399</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">load_data_file</span><span class="p">(</span><span class="s2">&quot;commute_data.csv&quot;</span><span class="p">):</span>
</span><span id="Analyzer-2400"><a href="#Analyzer-2400"><span class="linenos">2400</span></a>                    <span class="k">pass</span>
</span><span id="Analyzer-2401"><a href="#Analyzer-2401"><span class="linenos">2401</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="Analyzer-2402"><a href="#Analyzer-2402"><span class="linenos">2402</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Errors loading commute data from project.&quot;</span><span class="p">)</span>
</span><span id="Analyzer-2403"><a href="#Analyzer-2403"><span class="linenos">2403</span></a>                    <span class="k">return</span> <span class="kc">False</span>
</span><span id="Analyzer-2404"><a href="#Analyzer-2404"><span class="linenos">2404</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Analyzer-2405"><a href="#Analyzer-2405"><span class="linenos">2405</span></a>                <span class="k">pass</span>
</span><span id="Analyzer-2406"><a href="#Analyzer-2406"><span class="linenos">2406</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Analyzer-2407"><a href="#Analyzer-2407"><span class="linenos">2407</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Commute data missing from project.&quot;</span><span class="p">)</span>
</span><span id="Analyzer-2408"><a href="#Analyzer-2408"><span class="linenos">2408</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="Analyzer-2409"><a href="#Analyzer-2409"><span class="linenos">2409</span></a>        
</span><span id="Analyzer-2410"><a href="#Analyzer-2410"><span class="linenos">2410</span></a>        <span class="c1"># create a list of dicts to map the tables to return to UI, they will be plotted in the order they are listed</span>
</span><span id="Analyzer-2411"><a href="#Analyzer-2411"><span class="linenos">2411</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">table_list</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Analyzer-2412"><a href="#Analyzer-2412"><span class="linenos">2412</span></a> 
</span><span id="Analyzer-2413"><a href="#Analyzer-2413"><span class="linenos">2413</span></a>        <span class="c1">### generate the tables  ###</span>
</span><span id="Analyzer-2414"><a href="#Analyzer-2414"><span class="linenos">2414</span></a>        <span class="n">tables_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project_directory</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">project_name</span><span class="p">,</span> <span class="s2">&quot;tables&quot;</span><span class="p">)</span>
</span><span id="Analyzer-2415"><a href="#Analyzer-2415"><span class="linenos">2415</span></a>        <span class="c1"># if it doesn&#39;t exist, create it</span>
</span><span id="Analyzer-2416"><a href="#Analyzer-2416"><span class="linenos">2416</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">tables_dir</span><span class="p">):</span>
</span><span id="Analyzer-2417"><a href="#Analyzer-2417"><span class="linenos">2417</span></a>            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">tables_dir</span><span class="p">)</span>
</span><span id="Analyzer-2418"><a href="#Analyzer-2418"><span class="linenos">2418</span></a>
</span><span id="Analyzer-2419"><a href="#Analyzer-2419"><span class="linenos">2419</span></a>        <span class="c1"># get the baseline data</span>
</span><span id="Analyzer-2420"><a href="#Analyzer-2420"><span class="linenos">2420</span></a>        <span class="n">emp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">get_emp_gps</span><span class="p">()</span>
</span><span id="Analyzer-2421"><a href="#Analyzer-2421"><span class="linenos">2421</span></a>        <span class="n">offices</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">get_office_gps</span><span class="p">()</span>
</span><span id="Analyzer-2422"><a href="#Analyzer-2422"><span class="linenos">2422</span></a>        <span class="n">commute_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">get_commute_data</span><span class="p">()</span>
</span><span id="Analyzer-2423"><a href="#Analyzer-2423"><span class="linenos">2423</span></a>        
</span><span id="Analyzer-2424"><a href="#Analyzer-2424"><span class="linenos">2424</span></a>        <span class="c1"># helper function to save the table</span>
</span><span id="Analyzer-2425"><a href="#Analyzer-2425"><span class="linenos">2425</span></a>        <span class="k">def</span> <span class="nf">save_table</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">tables_dir</span><span class="o">=</span><span class="n">tables_dir</span><span class="p">):</span>
</span><span id="Analyzer-2426"><a href="#Analyzer-2426"><span class="linenos">2426</span></a>            <span class="c1"># write the table to a file</span>
</span><span id="Analyzer-2427"><a href="#Analyzer-2427"><span class="linenos">2427</span></a>            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tables_dir</span><span class="p">,</span> <span class="n">key</span><span class="o">+</span><span class="s2">&quot;.html&quot;</span><span class="p">),</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="Analyzer-2428"><a href="#Analyzer-2428"><span class="linenos">2428</span></a>                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
</span><span id="Analyzer-2429"><a href="#Analyzer-2429"><span class="linenos">2429</span></a>
</span><span id="Analyzer-2430"><a href="#Analyzer-2430"><span class="linenos">2430</span></a>        <span class="c1">################################################################################</span>
</span><span id="Analyzer-2431"><a href="#Analyzer-2431"><span class="linenos">2431</span></a>        <span class="c1">### TABLE SET: Office Addresses and Lat/Longs</span>
</span><span id="Analyzer-2432"><a href="#Analyzer-2432"><span class="linenos">2432</span></a>        <span class="c1"># iterate through offices and generate a table for each office</span>
</span><span id="Analyzer-2433"><a href="#Analyzer-2433"><span class="linenos">2433</span></a>        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">offices</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>    
</span><span id="Analyzer-2434"><a href="#Analyzer-2434"><span class="linenos">2434</span></a>            <span class="c1">################################################################################ </span>
</span><span id="Analyzer-2435"><a href="#Analyzer-2435"><span class="linenos">2435</span></a>            <span class="c1"># TABLE: </span>
</span><span id="Analyzer-2436"><a href="#Analyzer-2436"><span class="linenos">2436</span></a>            <span class="c1">## Location Information</span>
</span><span id="Analyzer-2437"><a href="#Analyzer-2437"><span class="linenos">2437</span></a>            <span class="n">key</span> <span class="o">=</span> <span class="s1">&#39;li&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
</span><span id="Analyzer-2438"><a href="#Analyzer-2438"><span class="linenos">2438</span></a>            <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;Location Information &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;address&#39;</span><span class="p">])</span>
</span><span id="Analyzer-2439"><a href="#Analyzer-2439"><span class="linenos">2439</span></a>            <span class="n">short_title</span> <span class="o">=</span> <span class="n">title</span>
</span><span id="Analyzer-2440"><a href="#Analyzer-2440"><span class="linenos">2440</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">table_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="p">{</span><span class="s2">&quot;TABLE&quot;</span><span class="p">:</span> <span class="n">key</span><span class="p">,</span>
</span><span id="Analyzer-2441"><a href="#Analyzer-2441"><span class="linenos">2441</span></a>                                    <span class="s2">&quot;TITLE&quot;</span><span class="p">:</span> <span class="n">short_title</span><span class="p">,</span>
</span><span id="Analyzer-2442"><a href="#Analyzer-2442"><span class="linenos">2442</span></a>                                    <span class="s2">&quot;FILENAME&quot;</span><span class="p">:</span> <span class="n">key</span><span class="o">+</span><span class="s2">&quot;.html&quot;</span><span class="p">,</span>
</span><span id="Analyzer-2443"><a href="#Analyzer-2443"><span class="linenos">2443</span></a>                                    <span class="s2">&quot;TABLE-DESCRIPTION&quot;</span><span class="p">:</span> <span class="s2">&quot;This table displays the location information for office option &quot;</span> <span class="o">+</span> \
</span><span id="Analyzer-2444"><a href="#Analyzer-2444"><span class="linenos">2444</span></a>                                    <span class="nb">str</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;address&#39;</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot;.&quot;</span>
</span><span id="Analyzer-2445"><a href="#Analyzer-2445"><span class="linenos">2445</span></a>                                    <span class="p">})</span>
</span><span id="Analyzer-2446"><a href="#Analyzer-2446"><span class="linenos">2446</span></a>            
</span><span id="Analyzer-2447"><a href="#Analyzer-2447"><span class="linenos">2447</span></a>            <span class="k">if</span> <span class="n">table</span> <span class="o">==</span> <span class="s2">&quot;_all&quot;</span> <span class="ow">or</span> <span class="n">table</span> <span class="o">==</span> <span class="n">key</span><span class="p">:</span>
</span><span id="Analyzer-2448"><a href="#Analyzer-2448"><span class="linenos">2448</span></a>                <span class="n">office</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">to_frame</span><span class="p">()</span><span class="o">.</span><span class="n">T</span>
</span><span id="Analyzer-2449"><a href="#Analyzer-2449"><span class="linenos">2449</span></a>                <span class="c1"># get the needed commute values</span>
</span><span id="Analyzer-2450"><a href="#Analyzer-2450"><span class="linenos">2450</span></a>
</span><span id="Analyzer-2451"><a href="#Analyzer-2451"><span class="linenos">2451</span></a>                <span class="c1"># create a dataframe with the office address and lat/long</span>
</span><span id="Analyzer-2452"><a href="#Analyzer-2452"><span class="linenos">2452</span></a>                <span class="n">location_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
</span><span id="Analyzer-2453"><a href="#Analyzer-2453"><span class="linenos">2453</span></a>                <span class="n">location_data</span><span class="p">[</span><span class="s1">&#39;Office Address&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;address&#39;</span><span class="p">]]</span>
</span><span id="Analyzer-2454"><a href="#Analyzer-2454"><span class="linenos">2454</span></a>                <span class="n">location_data</span><span class="p">[</span><span class="s1">&#39;Latitude&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;latitude&#39;</span><span class="p">]]</span>
</span><span id="Analyzer-2455"><a href="#Analyzer-2455"><span class="linenos">2455</span></a>                <span class="n">location_data</span><span class="p">[</span><span class="s1">&#39;Longitude&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;longitude&#39;</span><span class="p">]]</span>
</span><span id="Analyzer-2456"><a href="#Analyzer-2456"><span class="linenos">2456</span></a>                <span class="c1"># create a table</span>
</span><span id="Analyzer-2457"><a href="#Analyzer-2457"><span class="linenos">2457</span></a>                <span class="n">t</span> <span class="o">=</span> <span class="n">location_data</span><span class="o">.</span><span class="n">to_html</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="Analyzer-2458"><a href="#Analyzer-2458"><span class="linenos">2458</span></a>                <span class="c1"># write the table to a file</span>
</span><span id="Analyzer-2459"><a href="#Analyzer-2459"><span class="linenos">2459</span></a>                <span class="n">save_table</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>
</span><span id="Analyzer-2460"><a href="#Analyzer-2460"><span class="linenos">2460</span></a>
</span><span id="Analyzer-2461"><a href="#Analyzer-2461"><span class="linenos">2461</span></a>
</span><span id="Analyzer-2462"><a href="#Analyzer-2462"><span class="linenos">2462</span></a>        <span class="c1">################################################################################ </span>
</span><span id="Analyzer-2463"><a href="#Analyzer-2463"><span class="linenos">2463</span></a>        <span class="c1"># TABLE: </span>
</span><span id="Analyzer-2464"><a href="#Analyzer-2464"><span class="linenos">2464</span></a>        <span class="c1">## Overal Cost Comparison Table</span>
</span><span id="Analyzer-2465"><a href="#Analyzer-2465"><span class="linenos">2465</span></a>        <span class="n">key</span> <span class="o">=</span> <span class="s1">&#39;occt&#39;</span>
</span><span id="Analyzer-2466"><a href="#Analyzer-2466"><span class="linenos">2466</span></a>        <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;Overall Cost Comparison Table&quot;</span>
</span><span id="Analyzer-2467"><a href="#Analyzer-2467"><span class="linenos">2467</span></a>        <span class="n">short_title</span> <span class="o">=</span> <span class="n">title</span>
</span><span id="Analyzer-2468"><a href="#Analyzer-2468"><span class="linenos">2468</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">table_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="p">{</span><span class="s2">&quot;TABLE&quot;</span><span class="p">:</span> <span class="n">key</span><span class="p">,</span>
</span><span id="Analyzer-2469"><a href="#Analyzer-2469"><span class="linenos">2469</span></a>                                <span class="s2">&quot;TITLE&quot;</span><span class="p">:</span> <span class="n">short_title</span><span class="p">,</span>
</span><span id="Analyzer-2470"><a href="#Analyzer-2470"><span class="linenos">2470</span></a>                                <span class="s2">&quot;FILENAME&quot;</span><span class="p">:</span> <span class="n">key</span><span class="o">+</span><span class="s2">&quot;.html&quot;</span><span class="p">,</span>
</span><span id="Analyzer-2471"><a href="#Analyzer-2471"><span class="linenos">2471</span></a>                                <span class="s2">&quot;TABLE-DESCRIPTION&quot;</span><span class="p">:</span> <span class="s2">&quot;This table displays the overall cost comparison for each office option.&quot;</span>
</span><span id="Analyzer-2472"><a href="#Analyzer-2472"><span class="linenos">2472</span></a>                                <span class="p">})</span>
</span><span id="Analyzer-2473"><a href="#Analyzer-2473"><span class="linenos">2473</span></a>        
</span><span id="Analyzer-2474"><a href="#Analyzer-2474"><span class="linenos">2474</span></a>        <span class="k">if</span> <span class="n">table</span> <span class="o">==</span> <span class="s2">&quot;_all&quot;</span> <span class="ow">or</span> <span class="n">table</span> <span class="o">==</span> <span class="n">key</span><span class="p">:</span>
</span><span id="Analyzer-2475"><a href="#Analyzer-2475"><span class="linenos">2475</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Generating table for: &quot;</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">table</span><span class="p">)</span>
</span><span id="Analyzer-2476"><a href="#Analyzer-2476"><span class="linenos">2476</span></a>            <span class="n">office</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">to_frame</span><span class="p">()</span><span class="o">.</span><span class="n">T</span>
</span><span id="Analyzer-2477"><a href="#Analyzer-2477"><span class="linenos">2477</span></a>            <span class="c1"># gather the data for the analysis</span>
</span><span id="Analyzer-2478"><a href="#Analyzer-2478"><span class="linenos">2478</span></a>            <span class="n">val_set</span><span class="p">,</span> <span class="n">base_costs</span><span class="p">,</span> <span class="n">cost_values</span><span class="p">,</span> <span class="n">average_diffs</span><span class="p">,</span> <span class="n">conservative_diffs</span><span class="p">,</span> <span class="n">withins</span><span class="p">,</span> <span class="n">employee_costs_to_office</span><span class="p">,</span> <span class="n">current_office</span><span class="p">,</span> <span class="n">other_offices</span> <span class="o">=</span> \
</span><span id="Analyzer-2479"><a href="#Analyzer-2479"><span class="linenos">2479</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">get_attrition_analysis</span><span class="p">(</span><span class="n">emp</span><span class="p">,</span> <span class="n">offices</span><span class="p">,</span> <span class="n">commute_data</span><span class="p">)</span>
</span><span id="Analyzer-2480"><a href="#Analyzer-2480"><span class="linenos">2480</span></a>
</span><span id="Analyzer-2481"><a href="#Analyzer-2481"><span class="linenos">2481</span></a>            <span class="c1"># commute related costs</span>
</span><span id="Analyzer-2482"><a href="#Analyzer-2482"><span class="linenos">2482</span></a>                <span class="c1"># pass</span>
</span><span id="Analyzer-2483"><a href="#Analyzer-2483"><span class="linenos">2483</span></a>            
</span><span id="Analyzer-2484"><a href="#Analyzer-2484"><span class="linenos">2484</span></a>            <span class="c1"># ####### employee attrition related costs</span>
</span><span id="Analyzer-2485"><a href="#Analyzer-2485"><span class="linenos">2485</span></a>            <span class="c1"># turnover threshold due to cost</span>
</span><span id="Analyzer-2486"><a href="#Analyzer-2486"><span class="linenos">2486</span></a>            <span class="n">median_salary</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">median_salary</span>
</span><span id="Analyzer-2487"><a href="#Analyzer-2487"><span class="linenos">2487</span></a>            <span class="n">threshold</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">turnover_threshold_due_to_cost</span><span class="o">*</span><span class="n">median_salary</span>
</span><span id="Analyzer-2488"><a href="#Analyzer-2488"><span class="linenos">2488</span></a>            <span class="n">daily_threshold</span> <span class="o">=</span> <span class="n">threshold</span><span class="o">/</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">commute_days_per_week</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">commute_weeks_per_year</span><span class="p">)</span>
</span><span id="Analyzer-2489"><a href="#Analyzer-2489"><span class="linenos">2489</span></a>            <span class="c1"># turnover probability due to time cost</span>
</span><span id="Analyzer-2490"><a href="#Analyzer-2490"><span class="linenos">2490</span></a>            <span class="n">turnover_probability_time_cost</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">turnover_probability_time_cost</span>
</span><span id="Analyzer-2491"><a href="#Analyzer-2491"><span class="linenos">2491</span></a>            <span class="c1"># employee replacement cost</span>
</span><span id="Analyzer-2492"><a href="#Analyzer-2492"><span class="linenos">2492</span></a>            <span class="n">employee_replacement_cost</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">employee_replacement_cost</span>
</span><span id="Analyzer-2493"><a href="#Analyzer-2493"><span class="linenos">2493</span></a>
</span><span id="Analyzer-2494"><a href="#Analyzer-2494"><span class="linenos">2494</span></a>
</span><span id="Analyzer-2495"><a href="#Analyzer-2495"><span class="linenos">2495</span></a>
</span><span id="Analyzer-2496"><a href="#Analyzer-2496"><span class="linenos">2496</span></a>
</span><span id="Analyzer-2497"><a href="#Analyzer-2497"><span class="linenos">2497</span></a>            <span class="c1"># ######## emissions related costs</span>
</span><span id="Analyzer-2498"><a href="#Analyzer-2498"><span class="linenos">2498</span></a>
</span><span id="Analyzer-2499"><a href="#Analyzer-2499"><span class="linenos">2499</span></a>            <span class="c1"># discount rate</span>
</span><span id="Analyzer-2500"><a href="#Analyzer-2500"><span class="linenos">2500</span></a>
</span><span id="Analyzer-2501"><a href="#Analyzer-2501"><span class="linenos">2501</span></a>
</span><span id="Analyzer-2502"><a href="#Analyzer-2502"><span class="linenos">2502</span></a>
</span><span id="Analyzer-2503"><a href="#Analyzer-2503"><span class="linenos">2503</span></a>
</span><span id="Analyzer-2504"><a href="#Analyzer-2504"><span class="linenos">2504</span></a>            <span class="c1"># create a dataframe with the office address and lat/long</span>
</span><span id="Analyzer-2505"><a href="#Analyzer-2505"><span class="linenos">2505</span></a>            <span class="n">location_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
</span><span id="Analyzer-2506"><a href="#Analyzer-2506"><span class="linenos">2506</span></a>            <span class="n">location_data</span><span class="p">[</span><span class="s1">&#39;Office Address&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;address&#39;</span><span class="p">]]</span>
</span><span id="Analyzer-2507"><a href="#Analyzer-2507"><span class="linenos">2507</span></a>            <span class="n">location_data</span><span class="p">[</span><span class="s1">&#39;Latitude&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;latitude&#39;</span><span class="p">]]</span>
</span><span id="Analyzer-2508"><a href="#Analyzer-2508"><span class="linenos">2508</span></a>            <span class="n">location_data</span><span class="p">[</span><span class="s1">&#39;Longitude&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;longitude&#39;</span><span class="p">]]</span>
</span><span id="Analyzer-2509"><a href="#Analyzer-2509"><span class="linenos">2509</span></a>            <span class="c1"># create a table</span>
</span><span id="Analyzer-2510"><a href="#Analyzer-2510"><span class="linenos">2510</span></a>            <span class="n">t</span> <span class="o">=</span> <span class="n">location_data</span><span class="o">.</span><span class="n">to_html</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="Analyzer-2511"><a href="#Analyzer-2511"><span class="linenos">2511</span></a>            <span class="c1"># write the table to a file</span>
</span><span id="Analyzer-2512"><a href="#Analyzer-2512"><span class="linenos">2512</span></a>            <span class="n">save_table</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>
</span><span id="Analyzer-2513"><a href="#Analyzer-2513"><span class="linenos">2513</span></a>
</span><span id="Analyzer-2514"><a href="#Analyzer-2514"><span class="linenos">2514</span></a>
</span><span id="Analyzer-2515"><a href="#Analyzer-2515"><span class="linenos">2515</span></a>
</span><span id="Analyzer-2516"><a href="#Analyzer-2516"><span class="linenos">2516</span></a>
</span><span id="Analyzer-2517"><a href="#Analyzer-2517"><span class="linenos">2517</span></a>
</span><span id="Analyzer-2518"><a href="#Analyzer-2518"><span class="linenos">2518</span></a>
</span><span id="Analyzer-2519"><a href="#Analyzer-2519"><span class="linenos">2519</span></a>
</span><span id="Analyzer-2520"><a href="#Analyzer-2520"><span class="linenos">2520</span></a>
</span><span id="Analyzer-2521"><a href="#Analyzer-2521"><span class="linenos">2521</span></a>
</span><span id="Analyzer-2522"><a href="#Analyzer-2522"><span class="linenos">2522</span></a>
</span><span id="Analyzer-2523"><a href="#Analyzer-2523"><span class="linenos">2523</span></a>
</span><span id="Analyzer-2524"><a href="#Analyzer-2524"><span class="linenos">2524</span></a>        <span class="c1"># write the graphs to tables.json in the project tables directory</span>
</span><span id="Analyzer-2525"><a href="#Analyzer-2525"><span class="linenos">2525</span></a>        <span class="c1"># convert self.tables_list to json</span>
</span><span id="Analyzer-2526"><a href="#Analyzer-2526"><span class="linenos">2526</span></a>        <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">table_list</span><span class="p">)</span>
</span><span id="Analyzer-2527"><a href="#Analyzer-2527"><span class="linenos">2527</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tables_dir</span><span class="p">,</span> <span class="s2">&quot;tables.json&quot;</span><span class="p">),</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="Analyzer-2528"><a href="#Analyzer-2528"><span class="linenos">2528</span></a>            <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">table_list</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
</span><span id="Analyzer-2529"><a href="#Analyzer-2529"><span class="linenos">2529</span></a>        
</span><span id="Analyzer-2530"><a href="#Analyzer-2530"><span class="linenos">2530</span></a>        <span class="c1"># update the analysis phase</span>
</span><span id="Analyzer-2531"><a href="#Analyzer-2531"><span class="linenos">2531</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">update_analysis_phase</span><span class="p">()</span>
</span><span id="Analyzer-2532"><a href="#Analyzer-2532"><span class="linenos">2532</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">table_list</span>
</span><span id="Analyzer-2533"><a href="#Analyzer-2533"><span class="linenos">2533</span></a>        <span class="c1">################################################################################</span>
</span><span id="Analyzer-2534"><a href="#Analyzer-2534"><span class="linenos">2534</span></a><span class="w">    </span>
</span><span id="Analyzer-2535"><a href="#Analyzer-2535"><span class="linenos">2535</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Analyzer-2536"><a href="#Analyzer-2536"><span class="linenos">2536</span></a><span class="sd">        # Constants</span>
</span><span id="Analyzer-2537"><a href="#Analyzer-2537"><span class="linenos">2537</span></a><span class="sd">    annual_savings = 0.25  # in millions</span>
</span><span id="Analyzer-2538"><a href="#Analyzer-2538"><span class="linenos">2538</span></a><span class="sd">    attrition_costs_year_1 = 0.05  # in millions</span>
</span><span id="Analyzer-2539"><a href="#Analyzer-2539"><span class="linenos">2539</span></a><span class="sd">    annual_emissions_costs = 0.01  # in millions</span>
</span><span id="Analyzer-2540"><a href="#Analyzer-2540"><span class="linenos">2540</span></a><span class="sd">    discount_rate = 0.05</span>
</span><span id="Analyzer-2541"><a href="#Analyzer-2541"><span class="linenos">2541</span></a><span class="sd">    years = 5</span>
</span><span id="Analyzer-2542"><a href="#Analyzer-2542"><span class="linenos">2542</span></a>
</span><span id="Analyzer-2543"><a href="#Analyzer-2543"><span class="linenos">2543</span></a><span class="sd">    # Calculating NPV</span>
</span><span id="Analyzer-2544"><a href="#Analyzer-2544"><span class="linenos">2544</span></a><span class="sd">    npv = 0</span>
</span><span id="Analyzer-2545"><a href="#Analyzer-2545"><span class="linenos">2545</span></a>
</span><span id="Analyzer-2546"><a href="#Analyzer-2546"><span class="linenos">2546</span></a><span class="sd">    # Year 1 cash flow (including attrition cost)</span>
</span><span id="Analyzer-2547"><a href="#Analyzer-2547"><span class="linenos">2547</span></a><span class="sd">    year_1_net_savings = annual_savings - attrition_costs_year_1</span>
</span><span id="Analyzer-2548"><a href="#Analyzer-2548"><span class="linenos">2548</span></a><span class="sd">    npv += year_1_net_savings / (1 + discount_rate)**1</span>
</span><span id="Analyzer-2549"><a href="#Analyzer-2549"><span class="linenos">2549</span></a>
</span><span id="Analyzer-2550"><a href="#Analyzer-2550"><span class="linenos">2550</span></a><span class="sd">    # Years 2-5 cash flows (including emissions costs)</span>
</span><span id="Analyzer-2551"><a href="#Analyzer-2551"><span class="linenos">2551</span></a><span class="sd">    for year in range(2, years + 1):</span>
</span><span id="Analyzer-2552"><a href="#Analyzer-2552"><span class="linenos">2552</span></a><span class="sd">        annual_net_savings = annual_savings - annual_emissions_costs</span>
</span><span id="Analyzer-2553"><a href="#Analyzer-2553"><span class="linenos">2553</span></a><span class="sd">        npv += annual_net_savings / (1 + discount_rate)**year</span>
</span><span id="Analyzer-2554"><a href="#Analyzer-2554"><span class="linenos">2554</span></a>
</span><span id="Analyzer-2555"><a href="#Analyzer-2555"><span class="linenos">2555</span></a><span class="sd">    npv</span>
</span><span id="Analyzer-2556"><a href="#Analyzer-2556"><span class="linenos">2556</span></a>
</span><span id="Analyzer-2557"><a href="#Analyzer-2557"><span class="linenos">2557</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="Analyzer-2558"><a href="#Analyzer-2558"><span class="linenos">2558</span></a>    <span class="k">def</span> <span class="nf">get_attrition_analysis</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">emp</span><span class="p">,</span> <span class="n">offices</span><span class="p">,</span> <span class="n">commute_data</span><span class="p">):</span>
</span><span id="Analyzer-2559"><a href="#Analyzer-2559"><span class="linenos">2559</span></a>        <span class="c1"># helper function to get a base cost dataframe</span>
</span><span id="Analyzer-2560"><a href="#Analyzer-2560"><span class="linenos">2560</span></a>        <span class="k">def</span> <span class="nf">get_base_cost_df</span><span class="p">(</span><span class="n">emp</span><span class="p">,</span> <span class="n">officeaddr</span><span class="p">):</span>
</span><span id="Analyzer-2561"><a href="#Analyzer-2561"><span class="linenos">2561</span></a>            <span class="n">rows</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Analyzer-2562"><a href="#Analyzer-2562"><span class="linenos">2562</span></a>            <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">emp</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
</span><span id="Analyzer-2563"><a href="#Analyzer-2563"><span class="linenos">2563</span></a>                <span class="n">cost</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="Analyzer-2564"><a href="#Analyzer-2564"><span class="linenos">2564</span></a>                <span class="n">rows</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s1">&#39;latitude&#39;</span><span class="p">:</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;latitude&#39;</span><span class="p">],</span><span class="s1">&#39;longitude&#39;</span><span class="p">:</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;longitude&#39;</span><span class="p">],</span><span class="s1">&#39;office&#39;</span><span class="p">:</span><span class="n">officeaddr</span><span class="p">,</span><span class="s1">&#39;cost&#39;</span><span class="p">:</span><span class="n">cost</span><span class="p">})</span>
</span><span id="Analyzer-2565"><a href="#Analyzer-2565"><span class="linenos">2565</span></a>            <span class="c1">#cost_df = pd.DataFrame(rows)</span>
</span><span id="Analyzer-2566"><a href="#Analyzer-2566"><span class="linenos">2566</span></a>            <span class="k">return</span> <span class="n">rows</span>
</span><span id="Analyzer-2567"><a href="#Analyzer-2567"><span class="linenos">2567</span></a>        
</span><span id="Analyzer-2568"><a href="#Analyzer-2568"><span class="linenos">2568</span></a>        <span class="n">employee_costs_to_office</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="Analyzer-2569"><a href="#Analyzer-2569"><span class="linenos">2569</span></a>        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">offices</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>    
</span><span id="Analyzer-2570"><a href="#Analyzer-2570"><span class="linenos">2570</span></a>            <span class="n">office</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">to_frame</span><span class="p">()</span><span class="o">.</span><span class="n">T</span>
</span><span id="Analyzer-2571"><a href="#Analyzer-2571"><span class="linenos">2571</span></a>            
</span><span id="Analyzer-2572"><a href="#Analyzer-2572"><span class="linenos">2572</span></a>            <span class="c1"># get the needed commute values</span>
</span><span id="Analyzer-2573"><a href="#Analyzer-2573"><span class="linenos">2573</span></a>            <span class="n">values</span> <span class="o">=</span> <span class="n">commute_data</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span>
</span><span id="Analyzer-2574"><a href="#Analyzer-2574"><span class="linenos">2574</span></a>            
</span><span id="Analyzer-2575"><a href="#Analyzer-2575"><span class="linenos">2575</span></a>            <span class="n">mornings</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;m_morning_duration_in_traffic&#39;</span><span class="p">,</span><span class="s1">&#39;t_morning_duration_in_traffic&#39;</span><span class="p">,</span><span class="s1">&#39;w_morning_duration_in_traffic&#39;</span><span class="p">,</span><span class="s1">&#39;h_morning_duration_in_traffic&#39;</span><span class="p">,</span><span class="s1">&#39;f_morning_duration_in_traffic&#39;</span><span class="p">]</span>
</span><span id="Analyzer-2576"><a href="#Analyzer-2576"><span class="linenos">2576</span></a>            <span class="n">evenings</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;m_evening_duration_in_traffic&#39;</span><span class="p">,</span><span class="s1">&#39;t_evening_duration_in_traffic&#39;</span><span class="p">,</span><span class="s1">&#39;w_evening_duration_in_traffic&#39;</span><span class="p">,</span><span class="s1">&#39;h_evening_duration_in_traffic&#39;</span><span class="p">,</span><span class="s1">&#39;f_evening_duration_in_traffic&#39;</span><span class="p">]</span>
</span><span id="Analyzer-2577"><a href="#Analyzer-2577"><span class="linenos">2577</span></a>            
</span><span id="Analyzer-2578"><a href="#Analyzer-2578"><span class="linenos">2578</span></a>            <span class="n">cdpw</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">commute_days_per_week</span>
</span><span id="Analyzer-2579"><a href="#Analyzer-2579"><span class="linenos">2579</span></a>
</span><span id="Analyzer-2580"><a href="#Analyzer-2580"><span class="linenos">2580</span></a>            <span class="n">emp_within</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graphing</span><span class="o">.</span><span class="n">filter_drive_distance</span><span class="p">(</span><span class="n">emp</span><span class="p">,</span><span class="n">office</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">commute_range_cut_off</span><span class="p">,</span> <span class="n">commute_data</span><span class="o">=</span><span class="n">commute_data</span><span class="p">)</span>
</span><span id="Analyzer-2581"><a href="#Analyzer-2581"><span class="linenos">2581</span></a>            <span class="n">val_set</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graphing</span><span class="o">.</span><span class="n">get_commute_values</span><span class="p">(</span><span class="n">emp_within</span><span class="p">,</span> <span class="n">office</span><span class="p">,</span> <span class="n">commute_data</span><span class="p">,</span> <span class="n">values</span><span class="p">)</span>
</span><span id="Analyzer-2582"><a href="#Analyzer-2582"><span class="linenos">2582</span></a>            
</span><span id="Analyzer-2583"><a href="#Analyzer-2583"><span class="linenos">2583</span></a>            <span class="c1"># restore val_set columns latitutde and longitude to origin_lat and origin_long</span>
</span><span id="Analyzer-2584"><a href="#Analyzer-2584"><span class="linenos">2584</span></a>            <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;origin_lat&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;latitude&#39;</span><span class="p">]</span>
</span><span id="Analyzer-2585"><a href="#Analyzer-2585"><span class="linenos">2585</span></a>            <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;origin_long&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;longitude&#39;</span><span class="p">]</span>
</span><span id="Analyzer-2586"><a href="#Analyzer-2586"><span class="linenos">2586</span></a>
</span><span id="Analyzer-2587"><a href="#Analyzer-2587"><span class="linenos">2587</span></a>            
</span><span id="Analyzer-2588"><a href="#Analyzer-2588"><span class="linenos">2588</span></a>
</span><span id="Analyzer-2589"><a href="#Analyzer-2589"><span class="linenos">2589</span></a>            <span class="c1"># Calculate and insert the average morning and evening commute times directly into val_set</span>
</span><span id="Analyzer-2590"><a href="#Analyzer-2590"><span class="linenos">2590</span></a>            <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;Morning Average&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">val_set</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">mornings</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="Analyzer-2591"><a href="#Analyzer-2591"><span class="linenos">2591</span></a>            <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;Evening Average&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">val_set</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">evenings</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="Analyzer-2592"><a href="#Analyzer-2592"><span class="linenos">2592</span></a>
</span><span id="Analyzer-2593"><a href="#Analyzer-2593"><span class="linenos">2593</span></a>            <span class="c1"># Calculate and insert the top &#39;cdpw&#39; maximum morning and evening commute times</span>
</span><span id="Analyzer-2594"><a href="#Analyzer-2594"><span class="linenos">2594</span></a>            <span class="c1"># Note: Adjust the code below to calculate the averages of the top &#39;cdpw&#39; as new columns directly</span>
</span><span id="Analyzer-2595"><a href="#Analyzer-2595"><span class="linenos">2595</span></a>            <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;Average Top CDPW Morning&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">val_set</span><span class="p">[</span><span class="n">mornings</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="n">row</span><span class="o">.</span><span class="n">nlargest</span><span class="p">(</span><span class="n">cdpw</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="Analyzer-2596"><a href="#Analyzer-2596"><span class="linenos">2596</span></a>            <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;Average Top CDPW Evening&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">val_set</span><span class="p">[</span><span class="n">evenings</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="n">row</span><span class="o">.</span><span class="n">nlargest</span><span class="p">(</span><span class="n">cdpw</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="Analyzer-2597"><a href="#Analyzer-2597"><span class="linenos">2597</span></a>
</span><span id="Analyzer-2598"><a href="#Analyzer-2598"><span class="linenos">2598</span></a>            <span class="c1"># Calculate a per-minute cost based on &quot;median_salary&quot; and &quot;hours_per_year&quot;</span>
</span><span id="Analyzer-2599"><a href="#Analyzer-2599"><span class="linenos">2599</span></a>            <span class="n">per_minute_cost</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">median_salary</span> <span class="o">/</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">hours_per_year</span> <span class="o">*</span> <span class="mi">60</span><span class="p">)</span>
</span><span id="Analyzer-2600"><a href="#Analyzer-2600"><span class="linenos">2600</span></a>
</span><span id="Analyzer-2601"><a href="#Analyzer-2601"><span class="linenos">2601</span></a>            <span class="c1"># Calculate and insert the average cost for the week directly into val_set</span>
</span><span id="Analyzer-2602"><a href="#Analyzer-2602"><span class="linenos">2602</span></a>            <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;Morning Average Cost&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;Morning Average&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">per_minute_cost</span>
</span><span id="Analyzer-2603"><a href="#Analyzer-2603"><span class="linenos">2603</span></a>            <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;Evening Average Cost&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;Evening Average&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">per_minute_cost</span>
</span><span id="Analyzer-2604"><a href="#Analyzer-2604"><span class="linenos">2604</span></a>
</span><span id="Analyzer-2605"><a href="#Analyzer-2605"><span class="linenos">2605</span></a>            <span class="c1"># Calculate and insert the high/conservative cost for the week directly into val_set</span>
</span><span id="Analyzer-2606"><a href="#Analyzer-2606"><span class="linenos">2606</span></a>            <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;Morning High Cost&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;Average Top CDPW Morning&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">per_minute_cost</span>
</span><span id="Analyzer-2607"><a href="#Analyzer-2607"><span class="linenos">2607</span></a>            <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;Evening High Cost&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;Average Top CDPW Evening&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">per_minute_cost</span>
</span><span id="Analyzer-2608"><a href="#Analyzer-2608"><span class="linenos">2608</span></a>
</span><span id="Analyzer-2609"><a href="#Analyzer-2609"><span class="linenos">2609</span></a>            <span class="c1"># Calculate a Total Average Time and Total High Time cost</span>
</span><span id="Analyzer-2610"><a href="#Analyzer-2610"><span class="linenos">2610</span></a>            <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;Total Average Time Cost&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;Morning Average Cost&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;Evening Average Cost&#39;</span><span class="p">]</span>
</span><span id="Analyzer-2611"><a href="#Analyzer-2611"><span class="linenos">2611</span></a>            <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;Total High Time Cost&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;Morning High Cost&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;Evening High Cost&#39;</span><span class="p">]</span>
</span><span id="Analyzer-2612"><a href="#Analyzer-2612"><span class="linenos">2612</span></a>
</span><span id="Analyzer-2613"><a href="#Analyzer-2613"><span class="linenos">2613</span></a>            <span class="c1"># Calculate a Total Average Cost and Total High Cost</span>
</span><span id="Analyzer-2614"><a href="#Analyzer-2614"><span class="linenos">2614</span></a>            <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;Total Average Cost&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;Total Average Time Cost&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;commute_cost&#39;</span><span class="p">]</span>
</span><span id="Analyzer-2615"><a href="#Analyzer-2615"><span class="linenos">2615</span></a>            <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;Total High Cost&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;Total High Time Cost&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;commute_cost&#39;</span><span class="p">]</span>
</span><span id="Analyzer-2616"><a href="#Analyzer-2616"><span class="linenos">2616</span></a>            
</span><span id="Analyzer-2617"><a href="#Analyzer-2617"><span class="linenos">2617</span></a>            <span class="c1"># add the current val_set to the employee_costs_to_office dictionary</span>
</span><span id="Analyzer-2618"><a href="#Analyzer-2618"><span class="linenos">2618</span></a>            <span class="n">employee_costs_to_office</span><span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;address&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">val_set</span>
</span><span id="Analyzer-2619"><a href="#Analyzer-2619"><span class="linenos">2619</span></a>        
</span><span id="Analyzer-2620"><a href="#Analyzer-2620"><span class="linenos">2620</span></a>        <span class="c1"># employees to analyze are within the cutoff distance for this office</span>
</span><span id="Analyzer-2621"><a href="#Analyzer-2621"><span class="linenos">2621</span></a>        <span class="c1"># for this analysis, we need to iterate through options</span>
</span><span id="Analyzer-2622"><a href="#Analyzer-2622"><span class="linenos">2622</span></a>        <span class="n">current_office</span> <span class="o">=</span> <span class="n">offices</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">to_frame</span><span class="p">()</span><span class="o">.</span><span class="n">T</span>
</span><span id="Analyzer-2623"><a href="#Analyzer-2623"><span class="linenos">2623</span></a>        <span class="n">other_offices</span> <span class="o">=</span> <span class="n">offices</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="Analyzer-2624"><a href="#Analyzer-2624"><span class="linenos">2624</span></a>        <span class="n">cost_values</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Analyzer-2625"><a href="#Analyzer-2625"><span class="linenos">2625</span></a>        <span class="n">withins</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Analyzer-2626"><a href="#Analyzer-2626"><span class="linenos">2626</span></a>        <span class="n">commutes</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">commute_days_per_week</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">commute_weeks_per_year</span>
</span><span id="Analyzer-2627"><a href="#Analyzer-2627"><span class="linenos">2627</span></a>        
</span><span id="Analyzer-2628"><a href="#Analyzer-2628"><span class="linenos">2628</span></a>        <span class="c1"># for each employee, calculate the commute cost to the current office, place a new dataframe with lat, long, office, and cost</span>
</span><span id="Analyzer-2629"><a href="#Analyzer-2629"><span class="linenos">2629</span></a>        <span class="c1"># if the employee is within the cutoff distance, if outside the cutoff distance, the cost is 0</span>
</span><span id="Analyzer-2630"><a href="#Analyzer-2630"><span class="linenos">2630</span></a>        <span class="c1"># start by looping through ALL employees and adding a row with the current office, and cost = 0</span>
</span><span id="Analyzer-2631"><a href="#Analyzer-2631"><span class="linenos">2631</span></a>                
</span><span id="Analyzer-2632"><a href="#Analyzer-2632"><span class="linenos">2632</span></a>
</span><span id="Analyzer-2633"><a href="#Analyzer-2633"><span class="linenos">2633</span></a>        <span class="n">base_costs</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">get_base_cost_df</span><span class="p">(</span><span class="n">emp</span><span class="p">,</span> <span class="n">current_office</span><span class="p">[</span><span class="s1">&#39;address&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
</span><span id="Analyzer-2634"><a href="#Analyzer-2634"><span class="linenos">2634</span></a>        <span class="c1"># add columns for total average cost and total high cost</span>
</span><span id="Analyzer-2635"><a href="#Analyzer-2635"><span class="linenos">2635</span></a>        <span class="n">base_costs</span><span class="p">[</span><span class="s1">&#39;Total Average Cost&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="Analyzer-2636"><a href="#Analyzer-2636"><span class="linenos">2636</span></a>        <span class="n">base_costs</span><span class="p">[</span><span class="s1">&#39;Total High Cost&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="Analyzer-2637"><a href="#Analyzer-2637"><span class="linenos">2637</span></a>        <span class="c1"># now get emp_within for the current office, and update the relevant rows of base_costs with actual costs for those employees </span>
</span><span id="Analyzer-2638"><a href="#Analyzer-2638"><span class="linenos">2638</span></a>        <span class="c1"># using the commute_cost column in the commute_data dataframe where the employee lat long matches the commute_data lat long and office address</span>
</span><span id="Analyzer-2639"><a href="#Analyzer-2639"><span class="linenos">2639</span></a>        
</span><span id="Analyzer-2640"><a href="#Analyzer-2640"><span class="linenos">2640</span></a>        <span class="n">base_emp_within</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graphing</span><span class="o">.</span><span class="n">filter_drive_distance</span><span class="p">(</span><span class="n">emp</span><span class="p">,</span><span class="n">current_office</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">commute_range_cut_off</span><span class="p">,</span> <span class="n">commute_data</span><span class="o">=</span><span class="n">commute_data</span><span class="p">)</span>
</span><span id="Analyzer-2641"><a href="#Analyzer-2641"><span class="linenos">2641</span></a>
</span><span id="Analyzer-2642"><a href="#Analyzer-2642"><span class="linenos">2642</span></a>        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">base_emp_within</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
</span><span id="Analyzer-2643"><a href="#Analyzer-2643"><span class="linenos">2643</span></a>            <span class="c1"># set val_set from the employee_costs_to_office = {} dictionary</span>
</span><span id="Analyzer-2644"><a href="#Analyzer-2644"><span class="linenos">2644</span></a>            <span class="n">val_set</span> <span class="o">=</span> <span class="n">employee_costs_to_office</span><span class="p">[</span><span class="n">current_office</span><span class="p">[</span><span class="s1">&#39;address&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
</span><span id="Analyzer-2645"><a href="#Analyzer-2645"><span class="linenos">2645</span></a>            <span class="c1"># get the cost from the commute_data</span>
</span><span id="Analyzer-2646"><a href="#Analyzer-2646"><span class="linenos">2646</span></a>            <span class="n">avg_cost</span> <span class="o">=</span> <span class="n">val_set</span><span class="p">[(</span><span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;origin_lat&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;latitude&#39;</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;origin_long&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;longitude&#39;</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;office_address&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">current_office</span><span class="p">[</span><span class="s1">&#39;address&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">])][</span><span class="s1">&#39;Total Average Cost&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="Analyzer-2647"><a href="#Analyzer-2647"><span class="linenos">2647</span></a>            <span class="n">conservative_cost</span> <span class="o">=</span> <span class="n">val_set</span><span class="p">[(</span><span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;origin_lat&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;latitude&#39;</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;origin_long&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;longitude&#39;</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;office_address&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">current_office</span><span class="p">[</span><span class="s1">&#39;address&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">])][</span><span class="s1">&#39;Total High Cost&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="Analyzer-2648"><a href="#Analyzer-2648"><span class="linenos">2648</span></a>            <span class="n">base_costs</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">base_costs</span><span class="p">[</span><span class="s1">&#39;latitude&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;latitude&#39;</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">base_costs</span><span class="p">[</span><span class="s1">&#39;longitude&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;longitude&#39;</span><span class="p">]),</span><span class="s1">&#39;Total Average Cost&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">avg_cost</span>
</span><span id="Analyzer-2649"><a href="#Analyzer-2649"><span class="linenos">2649</span></a>            <span class="n">base_costs</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">base_costs</span><span class="p">[</span><span class="s1">&#39;latitude&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;latitude&#39;</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">base_costs</span><span class="p">[</span><span class="s1">&#39;longitude&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;longitude&#39;</span><span class="p">]),</span><span class="s1">&#39;Total High Cost&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">conservative_cost</span>
</span><span id="Analyzer-2650"><a href="#Analyzer-2650"><span class="linenos">2650</span></a>
</span><span id="Analyzer-2651"><a href="#Analyzer-2651"><span class="linenos">2651</span></a>        <span class="c1"># now we have a dataframe with all employees, and the cost to the current office</span>
</span><span id="Analyzer-2652"><a href="#Analyzer-2652"><span class="linenos">2652</span></a>    
</span><span id="Analyzer-2653"><a href="#Analyzer-2653"><span class="linenos">2653</span></a>        <span class="c1"># now iterate through the other offices, get a base cost dataframe, and then update the relevant rows with actual costs, place in cost_values</span>
</span><span id="Analyzer-2654"><a href="#Analyzer-2654"><span class="linenos">2654</span></a>        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">other_offices</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
</span><span id="Analyzer-2655"><a href="#Analyzer-2655"><span class="linenos">2655</span></a>            <span class="n">office</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">to_frame</span><span class="p">()</span><span class="o">.</span><span class="n">T</span>
</span><span id="Analyzer-2656"><a href="#Analyzer-2656"><span class="linenos">2656</span></a>            <span class="n">tmp_costs</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">get_base_cost_df</span><span class="p">(</span><span class="n">emp</span><span class="p">,</span> <span class="n">office</span><span class="p">[</span><span class="s1">&#39;address&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
</span><span id="Analyzer-2657"><a href="#Analyzer-2657"><span class="linenos">2657</span></a>            <span class="c1"># add columns for total average cost and total high cost</span>
</span><span id="Analyzer-2658"><a href="#Analyzer-2658"><span class="linenos">2658</span></a>            <span class="n">tmp_costs</span><span class="p">[</span><span class="s1">&#39;Total Average Cost&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="Analyzer-2659"><a href="#Analyzer-2659"><span class="linenos">2659</span></a>            <span class="n">tmp_costs</span><span class="p">[</span><span class="s1">&#39;Total High Cost&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="Analyzer-2660"><a href="#Analyzer-2660"><span class="linenos">2660</span></a>            <span class="n">emp_within</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graphing</span><span class="o">.</span><span class="n">filter_drive_distance</span><span class="p">(</span><span class="n">emp</span><span class="p">,</span><span class="n">office</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">commute_range_cut_off</span><span class="p">,</span> <span class="n">commute_data</span><span class="o">=</span><span class="n">commute_data</span><span class="p">)</span>
</span><span id="Analyzer-2661"><a href="#Analyzer-2661"><span class="linenos">2661</span></a>            <span class="c1"># we will use this later to get the differential for each employee, without the employees that aren&#39;t overlapping</span>
</span><span id="Analyzer-2662"><a href="#Analyzer-2662"><span class="linenos">2662</span></a>            <span class="n">withins</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">emp_within</span><span class="p">)</span>
</span><span id="Analyzer-2663"><a href="#Analyzer-2663"><span class="linenos">2663</span></a>
</span><span id="Analyzer-2664"><a href="#Analyzer-2664"><span class="linenos">2664</span></a>            <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">emp_within</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
</span><span id="Analyzer-2665"><a href="#Analyzer-2665"><span class="linenos">2665</span></a>                <span class="c1"># set val_set from the employee_costs_to_office = {} dictionary</span>
</span><span id="Analyzer-2666"><a href="#Analyzer-2666"><span class="linenos">2666</span></a>                <span class="n">val_set</span> <span class="o">=</span> <span class="n">employee_costs_to_office</span><span class="p">[</span><span class="n">office</span><span class="p">[</span><span class="s1">&#39;address&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
</span><span id="Analyzer-2667"><a href="#Analyzer-2667"><span class="linenos">2667</span></a>                <span class="c1"># get the cost from the commute_data</span>
</span><span id="Analyzer-2668"><a href="#Analyzer-2668"><span class="linenos">2668</span></a>                <span class="n">avg_cost</span> <span class="o">=</span> <span class="n">val_set</span><span class="p">[(</span><span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;origin_lat&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;latitude&#39;</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;origin_long&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;longitude&#39;</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;office_address&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">office</span><span class="p">[</span><span class="s1">&#39;address&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">])][</span><span class="s1">&#39;Total Average Cost&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="Analyzer-2669"><a href="#Analyzer-2669"><span class="linenos">2669</span></a>                <span class="n">conservative_cost</span> <span class="o">=</span> <span class="n">val_set</span><span class="p">[(</span><span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;origin_lat&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;latitude&#39;</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;origin_long&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;longitude&#39;</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;office_address&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">office</span><span class="p">[</span><span class="s1">&#39;address&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">])][</span><span class="s1">&#39;Total High Cost&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="Analyzer-2670"><a href="#Analyzer-2670"><span class="linenos">2670</span></a>                <span class="n">tmp_costs</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">tmp_costs</span><span class="p">[</span><span class="s1">&#39;latitude&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;latitude&#39;</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">tmp_costs</span><span class="p">[</span><span class="s1">&#39;longitude&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;longitude&#39;</span><span class="p">]),</span><span class="s1">&#39;Total Average Cost&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">avg_cost</span>
</span><span id="Analyzer-2671"><a href="#Analyzer-2671"><span class="linenos">2671</span></a>                <span class="n">tmp_costs</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">tmp_costs</span><span class="p">[</span><span class="s1">&#39;latitude&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;latitude&#39;</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">tmp_costs</span><span class="p">[</span><span class="s1">&#39;longitude&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;longitude&#39;</span><span class="p">]),</span><span class="s1">&#39;Total High Cost&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">conservative_cost</span>
</span><span id="Analyzer-2672"><a href="#Analyzer-2672"><span class="linenos">2672</span></a>            
</span><span id="Analyzer-2673"><a href="#Analyzer-2673"><span class="linenos">2673</span></a>            <span class="n">cost_values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tmp_costs</span><span class="p">)</span>
</span><span id="Analyzer-2674"><a href="#Analyzer-2674"><span class="linenos">2674</span></a>            
</span><span id="Analyzer-2675"><a href="#Analyzer-2675"><span class="linenos">2675</span></a>        <span class="c1"># now we have a full list of costs for each employee to each office, we can get the differentials</span>
</span><span id="Analyzer-2676"><a href="#Analyzer-2676"><span class="linenos">2676</span></a>        <span class="c1"># create a list to hold the differential dataframes</span>
</span><span id="Analyzer-2677"><a href="#Analyzer-2677"><span class="linenos">2677</span></a>        <span class="n">average_diffs</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Analyzer-2678"><a href="#Analyzer-2678"><span class="linenos">2678</span></a>        <span class="n">conservative_diffs</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Analyzer-2679"><a href="#Analyzer-2679"><span class="linenos">2679</span></a>        <span class="c1"># for each cost dataframe, calculate the differential from the base_costs dataframe into a new dataframe</span>
</span><span id="Analyzer-2680"><a href="#Analyzer-2680"><span class="linenos">2680</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">cost_values</span><span class="p">)):</span>
</span><span id="Analyzer-2681"><a href="#Analyzer-2681"><span class="linenos">2681</span></a>            <span class="c1"># get the differential</span>
</span><span id="Analyzer-2682"><a href="#Analyzer-2682"><span class="linenos">2682</span></a>            <span class="n">average_diffs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cost_values</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;Total Average Cost&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">base_costs</span><span class="p">[</span><span class="s1">&#39;Total Average Cost&#39;</span><span class="p">])</span>
</span><span id="Analyzer-2683"><a href="#Analyzer-2683"><span class="linenos">2683</span></a>            <span class="n">conservative_diffs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cost_values</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;Total High Cost&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">base_costs</span><span class="p">[</span><span class="s1">&#39;Total High Cost&#39;</span><span class="p">])</span>
</span><span id="Analyzer-2684"><a href="#Analyzer-2684"><span class="linenos">2684</span></a>
</span><span id="Analyzer-2685"><a href="#Analyzer-2685"><span class="linenos">2685</span></a>        <span class="k">return</span> <span class="n">base_costs</span><span class="p">,</span> <span class="n">cost_values</span><span class="p">,</span> <span class="n">average_diffs</span><span class="p">,</span> <span class="n">conservative_diffs</span><span class="p">,</span> <span class="n">withins</span><span class="p">,</span> <span class="n">employee_costs_to_office</span><span class="p">,</span> <span class="n">current_office</span><span class="p">,</span> <span class="n">other_offices</span>
</span><span id="Analyzer-2686"><a href="#Analyzer-2686"><span class="linenos">2686</span></a>    
</span><span id="Analyzer-2687"><a href="#Analyzer-2687"><span class="linenos">2687</span></a>
</span><span id="Analyzer-2688"><a href="#Analyzer-2688"><span class="linenos">2688</span></a>
</span><span id="Analyzer-2689"><a href="#Analyzer-2689"><span class="linenos">2689</span></a>
</span><span id="Analyzer-2690"><a href="#Analyzer-2690"><span class="linenos">2690</span></a>
</span><span id="Analyzer-2691"><a href="#Analyzer-2691"><span class="linenos">2691</span></a>    <span class="k">def</span> <span class="nf">get_emissions_analysis</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">emp</span><span class="p">,</span> <span class="n">offices</span><span class="p">,</span> <span class="n">commute_data</span><span class="p">):</span>
</span><span id="Analyzer-2692"><a href="#Analyzer-2692"><span class="linenos">2692</span></a>        <span class="c1"># helper function to get a base cost dataframe</span>
</span><span id="Analyzer-2693"><a href="#Analyzer-2693"><span class="linenos">2693</span></a>        <span class="k">def</span> <span class="nf">get_base_cost_df</span><span class="p">(</span><span class="n">emp</span><span class="p">,</span> <span class="n">officeaddr</span><span class="p">):</span>
</span><span id="Analyzer-2694"><a href="#Analyzer-2694"><span class="linenos">2694</span></a>            <span class="n">rows</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Analyzer-2695"><a href="#Analyzer-2695"><span class="linenos">2695</span></a>            <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">emp</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
</span><span id="Analyzer-2696"><a href="#Analyzer-2696"><span class="linenos">2696</span></a>                <span class="n">cost</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="Analyzer-2697"><a href="#Analyzer-2697"><span class="linenos">2697</span></a>                <span class="n">rows</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s1">&#39;latitude&#39;</span><span class="p">:</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;latitude&#39;</span><span class="p">],</span><span class="s1">&#39;longitude&#39;</span><span class="p">:</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;longitude&#39;</span><span class="p">],</span><span class="s1">&#39;office&#39;</span><span class="p">:</span><span class="n">officeaddr</span><span class="p">,</span><span class="s1">&#39;cost&#39;</span><span class="p">:</span><span class="n">cost</span><span class="p">})</span>
</span><span id="Analyzer-2698"><a href="#Analyzer-2698"><span class="linenos">2698</span></a>            <span class="c1">#cost_df = pd.DataFrame(rows)</span>
</span><span id="Analyzer-2699"><a href="#Analyzer-2699"><span class="linenos">2699</span></a>            <span class="k">return</span> <span class="n">rows</span>
</span><span id="Analyzer-2700"><a href="#Analyzer-2700"><span class="linenos">2700</span></a>        
</span><span id="Analyzer-2701"><a href="#Analyzer-2701"><span class="linenos">2701</span></a>        <span class="n">employee_costs_to_office</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="Analyzer-2702"><a href="#Analyzer-2702"><span class="linenos">2702</span></a>        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">offices</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>    
</span><span id="Analyzer-2703"><a href="#Analyzer-2703"><span class="linenos">2703</span></a>            <span class="n">office</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">to_frame</span><span class="p">()</span><span class="o">.</span><span class="n">T</span>
</span><span id="Analyzer-2704"><a href="#Analyzer-2704"><span class="linenos">2704</span></a>            
</span><span id="Analyzer-2705"><a href="#Analyzer-2705"><span class="linenos">2705</span></a>            <span class="c1"># get the needed commute values</span>
</span><span id="Analyzer-2706"><a href="#Analyzer-2706"><span class="linenos">2706</span></a>            <span class="n">values</span> <span class="o">=</span> <span class="n">commute_data</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span>
</span><span id="Analyzer-2707"><a href="#Analyzer-2707"><span class="linenos">2707</span></a>            
</span><span id="Analyzer-2708"><a href="#Analyzer-2708"><span class="linenos">2708</span></a>            <span class="n">mornings</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;m_morning_emissions&#39;</span><span class="p">,</span><span class="s1">&#39;t_morning_emissions&#39;</span><span class="p">,</span><span class="s1">&#39;w_morning_emissions&#39;</span><span class="p">,</span><span class="s1">&#39;h_morning_emissions&#39;</span><span class="p">,</span><span class="s1">&#39;f_morning_emissions&#39;</span><span class="p">]</span>
</span><span id="Analyzer-2709"><a href="#Analyzer-2709"><span class="linenos">2709</span></a>            <span class="n">evenings</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;m_evening_emissions&#39;</span><span class="p">,</span><span class="s1">&#39;t_evening_emissions&#39;</span><span class="p">,</span><span class="s1">&#39;w_evening_emissions&#39;</span><span class="p">,</span><span class="s1">&#39;h_evening_emissions&#39;</span><span class="p">,</span><span class="s1">&#39;f_evening_emissions&#39;</span><span class="p">]</span>
</span><span id="Analyzer-2710"><a href="#Analyzer-2710"><span class="linenos">2710</span></a>            
</span><span id="Analyzer-2711"><a href="#Analyzer-2711"><span class="linenos">2711</span></a>            <span class="n">cdpw</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">commute_days_per_week</span>
</span><span id="Analyzer-2712"><a href="#Analyzer-2712"><span class="linenos">2712</span></a>
</span><span id="Analyzer-2713"><a href="#Analyzer-2713"><span class="linenos">2713</span></a>            <span class="n">emp_within</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graphing</span><span class="o">.</span><span class="n">filter_drive_distance</span><span class="p">(</span><span class="n">emp</span><span class="p">,</span><span class="n">office</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">commute_range_cut_off</span><span class="p">,</span> <span class="n">commute_data</span><span class="o">=</span><span class="n">commute_data</span><span class="p">)</span>
</span><span id="Analyzer-2714"><a href="#Analyzer-2714"><span class="linenos">2714</span></a>            <span class="n">val_set</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graphing</span><span class="o">.</span><span class="n">get_commute_values</span><span class="p">(</span><span class="n">emp_within</span><span class="p">,</span> <span class="n">office</span><span class="p">,</span> <span class="n">commute_data</span><span class="p">,</span> <span class="n">values</span><span class="p">)</span>
</span><span id="Analyzer-2715"><a href="#Analyzer-2715"><span class="linenos">2715</span></a>            
</span><span id="Analyzer-2716"><a href="#Analyzer-2716"><span class="linenos">2716</span></a>            <span class="c1"># restore val_set columns latitutde and longitude to origin_lat and origin_long</span>
</span><span id="Analyzer-2717"><a href="#Analyzer-2717"><span class="linenos">2717</span></a>            <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;origin_lat&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;latitude&#39;</span><span class="p">]</span>
</span><span id="Analyzer-2718"><a href="#Analyzer-2718"><span class="linenos">2718</span></a>            <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;origin_long&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;longitude&#39;</span><span class="p">]</span>
</span><span id="Analyzer-2719"><a href="#Analyzer-2719"><span class="linenos">2719</span></a>
</span><span id="Analyzer-2720"><a href="#Analyzer-2720"><span class="linenos">2720</span></a>            <span class="c1"># Calculate and insert the average morning and evening commute times directly into val_set</span>
</span><span id="Analyzer-2721"><a href="#Analyzer-2721"><span class="linenos">2721</span></a>            <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;Morning Average&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">val_set</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">mornings</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="Analyzer-2722"><a href="#Analyzer-2722"><span class="linenos">2722</span></a>            <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;Evening Average&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">val_set</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">evenings</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="Analyzer-2723"><a href="#Analyzer-2723"><span class="linenos">2723</span></a>            
</span><span id="Analyzer-2724"><a href="#Analyzer-2724"><span class="linenos">2724</span></a>            <span class="c1"># Calculate and insert the top &#39;cdpw&#39; maximum morning and evening commute times</span>
</span><span id="Analyzer-2725"><a href="#Analyzer-2725"><span class="linenos">2725</span></a>            <span class="c1"># Note: Adjust the code below to calculate the averages of the top &#39;cdpw&#39; as new columns directly</span>
</span><span id="Analyzer-2726"><a href="#Analyzer-2726"><span class="linenos">2726</span></a>            <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;Average Top CDPW Morning&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">val_set</span><span class="p">[</span><span class="n">mornings</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="n">row</span><span class="o">.</span><span class="n">nlargest</span><span class="p">(</span><span class="n">cdpw</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="Analyzer-2727"><a href="#Analyzer-2727"><span class="linenos">2727</span></a>            <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;Average Top CDPW Evening&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">val_set</span><span class="p">[</span><span class="n">evenings</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="n">row</span><span class="o">.</span><span class="n">nlargest</span><span class="p">(</span><span class="n">cdpw</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="Analyzer-2728"><a href="#Analyzer-2728"><span class="linenos">2728</span></a>            
</span><span id="Analyzer-2729"><a href="#Analyzer-2729"><span class="linenos">2729</span></a>            <span class="c1"># emissions figure are in kg/commute. To get cost we need the CO2_credit_cost, which is $/metric ton</span>
</span><span id="Analyzer-2730"><a href="#Analyzer-2730"><span class="linenos">2730</span></a>            <span class="n">per_kg_CO2_cost</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">CO2_credit_cost</span> <span class="o">/</span> <span class="mi">1000</span>
</span><span id="Analyzer-2731"><a href="#Analyzer-2731"><span class="linenos">2731</span></a>
</span><span id="Analyzer-2732"><a href="#Analyzer-2732"><span class="linenos">2732</span></a>            <span class="c1"># Calculate and insert the average cost for the week directly into val_set</span>
</span><span id="Analyzer-2733"><a href="#Analyzer-2733"><span class="linenos">2733</span></a>            <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;Morning Average Cost&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;Morning Average&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">per_kg_CO2_cost</span>
</span><span id="Analyzer-2734"><a href="#Analyzer-2734"><span class="linenos">2734</span></a>            <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;Evening Average Cost&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;Evening Average&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">per_kg_CO2_cost</span>
</span><span id="Analyzer-2735"><a href="#Analyzer-2735"><span class="linenos">2735</span></a>            
</span><span id="Analyzer-2736"><a href="#Analyzer-2736"><span class="linenos">2736</span></a>            <span class="c1"># Calculate and insert the high/conservative cost for the week directly into val_set</span>
</span><span id="Analyzer-2737"><a href="#Analyzer-2737"><span class="linenos">2737</span></a>            <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;Morning High Cost&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;Average Top CDPW Morning&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">per_kg_CO2_cost</span>
</span><span id="Analyzer-2738"><a href="#Analyzer-2738"><span class="linenos">2738</span></a>            <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;Evening High Cost&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;Average Top CDPW Evening&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">per_kg_CO2_cost</span>
</span><span id="Analyzer-2739"><a href="#Analyzer-2739"><span class="linenos">2739</span></a>
</span><span id="Analyzer-2740"><a href="#Analyzer-2740"><span class="linenos">2740</span></a>            <span class="c1"># Calculate a Total Average Time and Total High Time cost</span>
</span><span id="Analyzer-2741"><a href="#Analyzer-2741"><span class="linenos">2741</span></a>            <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;Total Average Cost&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;Morning Average Cost&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;Evening Average Cost&#39;</span><span class="p">]</span>
</span><span id="Analyzer-2742"><a href="#Analyzer-2742"><span class="linenos">2742</span></a>            <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;Total High Cost&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;Morning High Cost&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;Evening High Cost&#39;</span><span class="p">]</span>
</span><span id="Analyzer-2743"><a href="#Analyzer-2743"><span class="linenos">2743</span></a>            
</span><span id="Analyzer-2744"><a href="#Analyzer-2744"><span class="linenos">2744</span></a>            <span class="c1"># add the current val_set to the employee_costs_to_office dictionary</span>
</span><span id="Analyzer-2745"><a href="#Analyzer-2745"><span class="linenos">2745</span></a>            <span class="n">employee_costs_to_office</span><span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;address&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">val_set</span>
</span><span id="Analyzer-2746"><a href="#Analyzer-2746"><span class="linenos">2746</span></a>        
</span><span id="Analyzer-2747"><a href="#Analyzer-2747"><span class="linenos">2747</span></a>        <span class="c1"># employees to analyze are within the cutoff distance for this office</span>
</span><span id="Analyzer-2748"><a href="#Analyzer-2748"><span class="linenos">2748</span></a>        <span class="c1"># for this analysis, we need to iterate through options</span>
</span><span id="Analyzer-2749"><a href="#Analyzer-2749"><span class="linenos">2749</span></a>        <span class="n">current_office</span> <span class="o">=</span> <span class="n">offices</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">to_frame</span><span class="p">()</span><span class="o">.</span><span class="n">T</span>
</span><span id="Analyzer-2750"><a href="#Analyzer-2750"><span class="linenos">2750</span></a>        <span class="n">other_offices</span> <span class="o">=</span> <span class="n">offices</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="Analyzer-2751"><a href="#Analyzer-2751"><span class="linenos">2751</span></a>        <span class="n">cost_values</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Analyzer-2752"><a href="#Analyzer-2752"><span class="linenos">2752</span></a>        <span class="n">withins</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Analyzer-2753"><a href="#Analyzer-2753"><span class="linenos">2753</span></a>        <span class="n">commutes</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">commute_days_per_week</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">commute_weeks_per_year</span>
</span><span id="Analyzer-2754"><a href="#Analyzer-2754"><span class="linenos">2754</span></a>        
</span><span id="Analyzer-2755"><a href="#Analyzer-2755"><span class="linenos">2755</span></a>        <span class="c1"># for each employee, calculate the commute cost to the current office, place a new dataframe with lat, long, office, and cost</span>
</span><span id="Analyzer-2756"><a href="#Analyzer-2756"><span class="linenos">2756</span></a>        <span class="c1"># if the employee is within the cutoff distance, if outside the cutoff distance, the cost is 0</span>
</span><span id="Analyzer-2757"><a href="#Analyzer-2757"><span class="linenos">2757</span></a>        <span class="c1"># start by looping through ALL employees and adding a row with the current office, and cost = 0</span>
</span><span id="Analyzer-2758"><a href="#Analyzer-2758"><span class="linenos">2758</span></a>                
</span><span id="Analyzer-2759"><a href="#Analyzer-2759"><span class="linenos">2759</span></a>
</span><span id="Analyzer-2760"><a href="#Analyzer-2760"><span class="linenos">2760</span></a>        <span class="n">base_costs</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">get_base_cost_df</span><span class="p">(</span><span class="n">emp</span><span class="p">,</span> <span class="n">current_office</span><span class="p">[</span><span class="s1">&#39;address&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
</span><span id="Analyzer-2761"><a href="#Analyzer-2761"><span class="linenos">2761</span></a>        <span class="c1"># add columns for total average cost and total high cost</span>
</span><span id="Analyzer-2762"><a href="#Analyzer-2762"><span class="linenos">2762</span></a>        <span class="n">base_costs</span><span class="p">[</span><span class="s1">&#39;Total Average Cost&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="Analyzer-2763"><a href="#Analyzer-2763"><span class="linenos">2763</span></a>        <span class="n">base_costs</span><span class="p">[</span><span class="s1">&#39;Total High Cost&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="Analyzer-2764"><a href="#Analyzer-2764"><span class="linenos">2764</span></a>        <span class="c1"># now get emp_within for the current office, and update the relevant rows of base_costs with actual costs for those employees </span>
</span><span id="Analyzer-2765"><a href="#Analyzer-2765"><span class="linenos">2765</span></a>        <span class="c1"># using the commute_cost column in the commute_data dataframe where the employee lat long matches the commute_data lat long and office address</span>
</span><span id="Analyzer-2766"><a href="#Analyzer-2766"><span class="linenos">2766</span></a>        
</span><span id="Analyzer-2767"><a href="#Analyzer-2767"><span class="linenos">2767</span></a>        <span class="n">base_emp_within</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graphing</span><span class="o">.</span><span class="n">filter_drive_distance</span><span class="p">(</span><span class="n">emp</span><span class="p">,</span><span class="n">current_office</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">commute_range_cut_off</span><span class="p">,</span> <span class="n">commute_data</span><span class="o">=</span><span class="n">commute_data</span><span class="p">)</span>
</span><span id="Analyzer-2768"><a href="#Analyzer-2768"><span class="linenos">2768</span></a>
</span><span id="Analyzer-2769"><a href="#Analyzer-2769"><span class="linenos">2769</span></a>        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">base_emp_within</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
</span><span id="Analyzer-2770"><a href="#Analyzer-2770"><span class="linenos">2770</span></a>            <span class="c1"># set val_set from the employee_costs_to_office = {} dictionary</span>
</span><span id="Analyzer-2771"><a href="#Analyzer-2771"><span class="linenos">2771</span></a>            <span class="n">val_set</span> <span class="o">=</span> <span class="n">employee_costs_to_office</span><span class="p">[</span><span class="n">current_office</span><span class="p">[</span><span class="s1">&#39;address&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
</span><span id="Analyzer-2772"><a href="#Analyzer-2772"><span class="linenos">2772</span></a>            <span class="c1"># get the cost from the commute_data</span>
</span><span id="Analyzer-2773"><a href="#Analyzer-2773"><span class="linenos">2773</span></a>            <span class="n">avg_cost</span> <span class="o">=</span> <span class="n">val_set</span><span class="p">[(</span><span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;origin_lat&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;latitude&#39;</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;origin_long&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;longitude&#39;</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;office_address&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">current_office</span><span class="p">[</span><span class="s1">&#39;address&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">])][</span><span class="s1">&#39;Total Average Cost&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="Analyzer-2774"><a href="#Analyzer-2774"><span class="linenos">2774</span></a>            <span class="n">conservative_cost</span> <span class="o">=</span> <span class="n">val_set</span><span class="p">[(</span><span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;origin_lat&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;latitude&#39;</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;origin_long&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;longitude&#39;</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;office_address&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">current_office</span><span class="p">[</span><span class="s1">&#39;address&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">])][</span><span class="s1">&#39;Total High Cost&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="Analyzer-2775"><a href="#Analyzer-2775"><span class="linenos">2775</span></a>            <span class="n">base_costs</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">base_costs</span><span class="p">[</span><span class="s1">&#39;latitude&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;latitude&#39;</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">base_costs</span><span class="p">[</span><span class="s1">&#39;longitude&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;longitude&#39;</span><span class="p">]),</span><span class="s1">&#39;Total Average Cost&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">avg_cost</span>
</span><span id="Analyzer-2776"><a href="#Analyzer-2776"><span class="linenos">2776</span></a>            <span class="n">base_costs</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">base_costs</span><span class="p">[</span><span class="s1">&#39;latitude&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;latitude&#39;</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">base_costs</span><span class="p">[</span><span class="s1">&#39;longitude&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;longitude&#39;</span><span class="p">]),</span><span class="s1">&#39;Total High Cost&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">conservative_cost</span>
</span><span id="Analyzer-2777"><a href="#Analyzer-2777"><span class="linenos">2777</span></a>
</span><span id="Analyzer-2778"><a href="#Analyzer-2778"><span class="linenos">2778</span></a>        <span class="c1"># now we have a dataframe with all employees, and the cost to the current office</span>
</span><span id="Analyzer-2779"><a href="#Analyzer-2779"><span class="linenos">2779</span></a>    
</span><span id="Analyzer-2780"><a href="#Analyzer-2780"><span class="linenos">2780</span></a>        <span class="c1"># now iterate through the other offices, get a base cost dataframe, and then update the relevant rows with actual costs, place in cost_values</span>
</span><span id="Analyzer-2781"><a href="#Analyzer-2781"><span class="linenos">2781</span></a>        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">other_offices</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
</span><span id="Analyzer-2782"><a href="#Analyzer-2782"><span class="linenos">2782</span></a>            <span class="n">office</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">to_frame</span><span class="p">()</span><span class="o">.</span><span class="n">T</span>
</span><span id="Analyzer-2783"><a href="#Analyzer-2783"><span class="linenos">2783</span></a>            <span class="n">tmp_costs</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">get_base_cost_df</span><span class="p">(</span><span class="n">emp</span><span class="p">,</span> <span class="n">office</span><span class="p">[</span><span class="s1">&#39;address&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
</span><span id="Analyzer-2784"><a href="#Analyzer-2784"><span class="linenos">2784</span></a>            <span class="c1"># add columns for total average cost and total high cost</span>
</span><span id="Analyzer-2785"><a href="#Analyzer-2785"><span class="linenos">2785</span></a>            <span class="n">tmp_costs</span><span class="p">[</span><span class="s1">&#39;Total Average Cost&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="Analyzer-2786"><a href="#Analyzer-2786"><span class="linenos">2786</span></a>            <span class="n">tmp_costs</span><span class="p">[</span><span class="s1">&#39;Total High Cost&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="Analyzer-2787"><a href="#Analyzer-2787"><span class="linenos">2787</span></a>            <span class="n">emp_within</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graphing</span><span class="o">.</span><span class="n">filter_drive_distance</span><span class="p">(</span><span class="n">emp</span><span class="p">,</span><span class="n">office</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">commute_range_cut_off</span><span class="p">,</span> <span class="n">commute_data</span><span class="o">=</span><span class="n">commute_data</span><span class="p">)</span>
</span><span id="Analyzer-2788"><a href="#Analyzer-2788"><span class="linenos">2788</span></a>            <span class="c1"># we will use this later to get the differential for each employee, without the employees that aren&#39;t overlapping</span>
</span><span id="Analyzer-2789"><a href="#Analyzer-2789"><span class="linenos">2789</span></a>            <span class="n">withins</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">emp_within</span><span class="p">)</span>
</span><span id="Analyzer-2790"><a href="#Analyzer-2790"><span class="linenos">2790</span></a>
</span><span id="Analyzer-2791"><a href="#Analyzer-2791"><span class="linenos">2791</span></a>            <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">emp_within</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
</span><span id="Analyzer-2792"><a href="#Analyzer-2792"><span class="linenos">2792</span></a>                <span class="c1"># set val_set from the employee_costs_to_office = {} dictionary</span>
</span><span id="Analyzer-2793"><a href="#Analyzer-2793"><span class="linenos">2793</span></a>                <span class="n">val_set</span> <span class="o">=</span> <span class="n">employee_costs_to_office</span><span class="p">[</span><span class="n">office</span><span class="p">[</span><span class="s1">&#39;address&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
</span><span id="Analyzer-2794"><a href="#Analyzer-2794"><span class="linenos">2794</span></a>                <span class="c1"># get the cost from the commute_data</span>
</span><span id="Analyzer-2795"><a href="#Analyzer-2795"><span class="linenos">2795</span></a>                <span class="n">avg_cost</span> <span class="o">=</span> <span class="n">val_set</span><span class="p">[(</span><span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;origin_lat&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;latitude&#39;</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;origin_long&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;longitude&#39;</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;office_address&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">office</span><span class="p">[</span><span class="s1">&#39;address&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">])][</span><span class="s1">&#39;Total Average Cost&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="Analyzer-2796"><a href="#Analyzer-2796"><span class="linenos">2796</span></a>                <span class="n">conservative_cost</span> <span class="o">=</span> <span class="n">val_set</span><span class="p">[(</span><span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;origin_lat&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;latitude&#39;</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;origin_long&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;longitude&#39;</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;office_address&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">office</span><span class="p">[</span><span class="s1">&#39;address&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">])][</span><span class="s1">&#39;Total High Cost&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="Analyzer-2797"><a href="#Analyzer-2797"><span class="linenos">2797</span></a>                <span class="n">tmp_costs</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">tmp_costs</span><span class="p">[</span><span class="s1">&#39;latitude&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;latitude&#39;</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">tmp_costs</span><span class="p">[</span><span class="s1">&#39;longitude&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;longitude&#39;</span><span class="p">]),</span><span class="s1">&#39;Total Average Cost&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">avg_cost</span>
</span><span id="Analyzer-2798"><a href="#Analyzer-2798"><span class="linenos">2798</span></a>                <span class="n">tmp_costs</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">tmp_costs</span><span class="p">[</span><span class="s1">&#39;latitude&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;latitude&#39;</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">tmp_costs</span><span class="p">[</span><span class="s1">&#39;longitude&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;longitude&#39;</span><span class="p">]),</span><span class="s1">&#39;Total High Cost&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">conservative_cost</span>
</span><span id="Analyzer-2799"><a href="#Analyzer-2799"><span class="linenos">2799</span></a>            
</span><span id="Analyzer-2800"><a href="#Analyzer-2800"><span class="linenos">2800</span></a>            <span class="n">cost_values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tmp_costs</span><span class="p">)</span>
</span><span id="Analyzer-2801"><a href="#Analyzer-2801"><span class="linenos">2801</span></a>            
</span><span id="Analyzer-2802"><a href="#Analyzer-2802"><span class="linenos">2802</span></a>        <span class="c1"># now we have a full list of costs for each employee to each office, we can get the differentials</span>
</span><span id="Analyzer-2803"><a href="#Analyzer-2803"><span class="linenos">2803</span></a>        <span class="c1"># create a list to hold the differential dataframes</span>
</span><span id="Analyzer-2804"><a href="#Analyzer-2804"><span class="linenos">2804</span></a>        <span class="n">average_diffs</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Analyzer-2805"><a href="#Analyzer-2805"><span class="linenos">2805</span></a>        <span class="n">conservative_diffs</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Analyzer-2806"><a href="#Analyzer-2806"><span class="linenos">2806</span></a>        <span class="c1"># for each cost dataframe, calculate the differential from the base_costs dataframe into a new dataframe</span>
</span><span id="Analyzer-2807"><a href="#Analyzer-2807"><span class="linenos">2807</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">cost_values</span><span class="p">)):</span>
</span><span id="Analyzer-2808"><a href="#Analyzer-2808"><span class="linenos">2808</span></a>            <span class="c1"># get the differential</span>
</span><span id="Analyzer-2809"><a href="#Analyzer-2809"><span class="linenos">2809</span></a>            <span class="n">average_diffs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cost_values</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;Total Average Cost&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">base_costs</span><span class="p">[</span><span class="s1">&#39;Total Average Cost&#39;</span><span class="p">])</span>
</span><span id="Analyzer-2810"><a href="#Analyzer-2810"><span class="linenos">2810</span></a>            <span class="n">conservative_diffs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cost_values</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;Total High Cost&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">base_costs</span><span class="p">[</span><span class="s1">&#39;Total High Cost&#39;</span><span class="p">])</span>
</span><span id="Analyzer-2811"><a href="#Analyzer-2811"><span class="linenos">2811</span></a>
</span><span id="Analyzer-2812"><a href="#Analyzer-2812"><span class="linenos">2812</span></a>        <span class="k">return</span> <span class="n">base_costs</span><span class="p">,</span> <span class="n">cost_values</span><span class="p">,</span> <span class="n">average_diffs</span><span class="p">,</span> <span class="n">conservative_diffs</span><span class="p">,</span> <span class="n">withins</span><span class="p">,</span> <span class="n">employee_costs_to_office</span><span class="p">,</span> <span class="n">current_office</span><span class="p">,</span> <span class="n">other_offices</span>
</span></pre></div>


    

                            <div id="Analyzer.__init__" class="classattr">
                                        <input id="Analyzer.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">Analyzer</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">proj</span><span class="o">=</span><span class="kc">None</span>, </span><span class="param"><span class="n">project_directory</span><span class="o">=</span><span class="kc">None</span>, </span><span class="param"><span class="n">env_file</span><span class="o">=</span><span class="s1">&#39;&#39;</span></span>)</span>

                <label class="view-source-button" for="Analyzer.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Analyzer.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Analyzer.__init__-38"><a href="#Analyzer.__init__-38"><span class="linenos">38</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">proj</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">project_directory</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">env_file</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
</span><span id="Analyzer.__init__-39"><a href="#Analyzer.__init__-39"><span class="linenos">39</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Analyzer.__init__-40"><a href="#Analyzer.__init__-40"><span class="linenos">40</span></a><span class="sd">        Initializes the Analyzer with specified project details and configuration.</span>
</span><span id="Analyzer.__init__-41"><a href="#Analyzer.__init__-41"><span class="linenos">41</span></a>
</span><span id="Analyzer.__init__-42"><a href="#Analyzer.__init__-42"><span class="linenos">42</span></a><span class="sd">        Args:</span>
</span><span id="Analyzer.__init__-43"><a href="#Analyzer.__init__-43"><span class="linenos">43</span></a><span class="sd">            proj (str, optional): The name of the project to load or create. Defaults to None.</span>
</span><span id="Analyzer.__init__-44"><a href="#Analyzer.__init__-44"><span class="linenos">44</span></a><span class="sd">            project_directory (str, optional): The directory where project files are stored. Defaults to None.</span>
</span><span id="Analyzer.__init__-45"><a href="#Analyzer.__init__-45"><span class="linenos">45</span></a><span class="sd">            env_file (str, optional): Path to a .env file for loading configuration variables. Defaults to an empty string.</span>
</span><span id="Analyzer.__init__-46"><a href="#Analyzer.__init__-46"><span class="linenos">46</span></a>
</span><span id="Analyzer.__init__-47"><a href="#Analyzer.__init__-47"><span class="linenos">47</span></a><span class="sd">        Raises:</span>
</span><span id="Analyzer.__init__-48"><a href="#Analyzer.__init__-48"><span class="linenos">48</span></a><span class="sd">            ValueError: If the specified project directory does not exist or no .env file is provided when expected.</span>
</span><span id="Analyzer.__init__-49"><a href="#Analyzer.__init__-49"><span class="linenos">49</span></a><span class="sd">        </span>
</span><span id="Analyzer.__init__-50"><a href="#Analyzer.__init__-50"><span class="linenos">50</span></a><span class="sd">        This constructor sets up the API rate limiting, loads the .env configuration, initializes the Google API client,</span>
</span><span id="Analyzer.__init__-51"><a href="#Analyzer.__init__-51"><span class="linenos">51</span></a><span class="sd">        and prepares the project directory and graphs subdirectory as needed.</span>
</span><span id="Analyzer.__init__-52"><a href="#Analyzer.__init__-52"><span class="linenos">52</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Analyzer.__init__-53"><a href="#Analyzer.__init__-53"><span class="linenos">53</span></a>
</span><span id="Analyzer.__init__-54"><a href="#Analyzer.__init__-54"><span class="linenos">54</span></a>        <span class="c1"># api rate limit is 3000 requests per minute, we see errors at 1000 requests per minute, so we limit to 300 per minute</span>
</span><span id="Analyzer.__init__-55"><a href="#Analyzer.__init__-55"><span class="linenos">55</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">api_rate_limit</span> <span class="o">=</span> <span class="mi">300</span>
</span><span id="Analyzer.__init__-56"><a href="#Analyzer.__init__-56"><span class="linenos">56</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">sleep_time</span> <span class="o">=</span> <span class="mi">60</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">api_rate_limit</span>
</span><span id="Analyzer.__init__-57"><a href="#Analyzer.__init__-57"><span class="linenos">57</span></a>        <span class="c1"># create a last call variable, set it to a time in the past</span>
</span><span id="Analyzer.__init__-58"><a href="#Analyzer.__init__-58"><span class="linenos">58</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">last_call</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span> <span class="o">-</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">seconds</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sleep_time</span><span class="p">)</span>
</span><span id="Analyzer.__init__-59"><a href="#Analyzer.__init__-59"><span class="linenos">59</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gAPI</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Analyzer.__init__-60"><a href="#Analyzer.__init__-60"><span class="linenos">60</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gAPI_key</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="Analyzer.__init__-61"><a href="#Analyzer.__init__-61"><span class="linenos">61</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">analysis_phase</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Analyzer.__init__-62"><a href="#Analyzer.__init__-62"><span class="linenos">62</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">env_file</span> <span class="o">=</span> <span class="n">env_file</span>
</span><span id="Analyzer.__init__-63"><a href="#Analyzer.__init__-63"><span class="linenos">63</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">project_directory</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Analyzer.__init__-64"><a href="#Analyzer.__init__-64"><span class="linenos">64</span></a>        <span class="c1"># load the .env file if it exists</span>
</span><span id="Analyzer.__init__-65"><a href="#Analyzer.__init__-65"><span class="linenos">65</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">env_file</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">env_file</span><span class="p">):</span>
</span><span id="Analyzer.__init__-66"><a href="#Analyzer.__init__-66"><span class="linenos">66</span></a>            <span class="n">load_dotenv</span><span class="p">(</span><span class="n">env_file</span><span class="p">,</span><span class="n">override</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="Analyzer.__init__-67"><a href="#Analyzer.__init__-67"><span class="linenos">67</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Analyzer.__init__-68"><a href="#Analyzer.__init__-68"><span class="linenos">68</span></a>            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">env_file</span><span class="p">):</span>
</span><span id="Analyzer.__init__-69"><a href="#Analyzer.__init__-69"><span class="linenos">69</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;No .env file provided.&quot;</span><span class="p">)</span>
</span><span id="Analyzer.__init__-70"><a href="#Analyzer.__init__-70"><span class="linenos">70</span></a>            <span class="c1"># attempt to load the .env file from the CWD</span>
</span><span id="Analyzer.__init__-71"><a href="#Analyzer.__init__-71"><span class="linenos">71</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">env_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">(),</span> <span class="s2">&quot;.env&quot;</span><span class="p">)</span>
</span><span id="Analyzer.__init__-72"><a href="#Analyzer.__init__-72"><span class="linenos">72</span></a>            <span class="n">load_dotenv</span><span class="p">(</span><span class="n">override</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="Analyzer.__init__-73"><a href="#Analyzer.__init__-73"><span class="linenos">73</span></a>        <span class="c1"># if the .env has keys, use them, otherwise use the defaults</span>
</span><span id="Analyzer.__init__-74"><a href="#Analyzer.__init__-74"><span class="linenos">74</span></a>        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;GMAPS_API_KEY&quot;</span><span class="p">):</span>
</span><span id="Analyzer.__init__-75"><a href="#Analyzer.__init__-75"><span class="linenos">75</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">gAPI_key</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;GMAPS_API_KEY&quot;</span><span class="p">)</span>
</span><span id="Analyzer.__init__-76"><a href="#Analyzer.__init__-76"><span class="linenos">76</span></a>        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;DEFAULT_PROJECT_DIRECTORY&quot;</span><span class="p">):</span>
</span><span id="Analyzer.__init__-77"><a href="#Analyzer.__init__-77"><span class="linenos">77</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">project_directory</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;DEFAULT_PROJECT_DIRECTORY&quot;</span><span class="p">)</span>
</span><span id="Analyzer.__init__-78"><a href="#Analyzer.__init__-78"><span class="linenos">78</span></a>        <span class="c1"># if a project directory is provided, override .env and use it, otherwise use the default</span>
</span><span id="Analyzer.__init__-79"><a href="#Analyzer.__init__-79"><span class="linenos">79</span></a>        <span class="k">if</span> <span class="n">project_directory</span><span class="p">:</span>
</span><span id="Analyzer.__init__-80"><a href="#Analyzer.__init__-80"><span class="linenos">80</span></a>            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">project_directory</span><span class="p">):</span>
</span><span id="Analyzer.__init__-81"><a href="#Analyzer.__init__-81"><span class="linenos">81</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">project_directory</span> <span class="o">=</span> <span class="n">project_directory</span>
</span><span id="Analyzer.__init__-82"><a href="#Analyzer.__init__-82"><span class="linenos">82</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Analyzer.__init__-83"><a href="#Analyzer.__init__-83"><span class="linenos">83</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Project directory does not exist.&quot;</span><span class="p">)</span>
</span><span id="Analyzer.__init__-84"><a href="#Analyzer.__init__-84"><span class="linenos">84</span></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">project_directory</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Analyzer.__init__-85"><a href="#Analyzer.__init__-85"><span class="linenos">85</span></a>            <span class="c1"># use the CWD for now</span>
</span><span id="Analyzer.__init__-86"><a href="#Analyzer.__init__-86"><span class="linenos">86</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">project_directory</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="vm">__file__</span><span class="p">),</span> <span class="s2">&quot;projects&quot;</span><span class="p">)</span>
</span><span id="Analyzer.__init__-87"><a href="#Analyzer.__init__-87"><span class="linenos">87</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">project</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Analyzer.__init__-88"><a href="#Analyzer.__init__-88"><span class="linenos">88</span></a>        <span class="c1"># if a project called for, load or create it        </span>
</span><span id="Analyzer.__init__-89"><a href="#Analyzer.__init__-89"><span class="linenos">89</span></a>        <span class="k">if</span> <span class="n">proj</span><span class="p">:</span>
</span><span id="Analyzer.__init__-90"><a href="#Analyzer.__init__-90"><span class="linenos">90</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">project</span> <span class="o">=</span> <span class="n">Project</span><span class="p">(</span><span class="n">proj</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">project_directory</span><span class="p">)</span>
</span><span id="Analyzer.__init__-91"><a href="#Analyzer.__init__-91"><span class="linenos">91</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Analyzer.__init__-92"><a href="#Analyzer.__init__-92"><span class="linenos">92</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">project</span> <span class="o">=</span> <span class="n">Project</span><span class="p">(</span> <span class="kc">None</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">project_directory</span><span class="p">)</span>
</span><span id="Analyzer.__init__-93"><a href="#Analyzer.__init__-93"><span class="linenos">93</span></a>        <span class="c1"># if a project is loaded, check for a subdirectory called &quot;plots&quot; in the project folder, </span>
</span><span id="Analyzer.__init__-94"><a href="#Analyzer.__init__-94"><span class="linenos">94</span></a>            <span class="c1"># create it if it doesn&#39;t exist, then list the plot .png filenames</span>
</span><span id="Analyzer.__init__-95"><a href="#Analyzer.__init__-95"><span class="linenos">95</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">load_graphs</span><span class="p">()</span>
</span><span id="Analyzer.__init__-96"><a href="#Analyzer.__init__-96"><span class="linenos">96</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">graphing</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Analyzer.__init__-97"><a href="#Analyzer.__init__-97"><span class="linenos">97</span></a>        <span class="c1"># update the analysis phase</span>
</span><span id="Analyzer.__init__-98"><a href="#Analyzer.__init__-98"><span class="linenos">98</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">update_analysis_phase</span><span class="p">()</span>
</span><span id="Analyzer.__init__-99"><a href="#Analyzer.__init__-99"><span class="linenos">99</span></a>        <span class="k">return</span> <span class="kc">None</span>
</span></pre></div>


            <div class="docstring"><p>Initializes the Analyzer with specified project details and configuration.</p>

<p>Args:
    proj (str, optional): The name of the project to load or create. Defaults to None.
    project_directory (str, optional): The directory where project files are stored. Defaults to None.
    env_file (str, optional): Path to a .env file for loading configuration variables. Defaults to an empty string.</p>

<p>Raises:
    ValueError: If the specified project directory does not exist or no .env file is provided when expected.</p>

<p>This constructor sets up the API rate limiting, loads the .env configuration, initializes the Google API client,
and prepares the project directory and graphs subdirectory as needed.</p>
</div>


                            </div>
                            <div id="Analyzer.api_rate_limit" class="classattr">
                                <div class="attr variable">
            <span class="name">api_rate_limit</span>

        
    </div>
    <a class="headerlink" href="#Analyzer.api_rate_limit"></a>
    
    

                            </div>
                            <div id="Analyzer.sleep_time" class="classattr">
                                <div class="attr variable">
            <span class="name">sleep_time</span>

        
    </div>
    <a class="headerlink" href="#Analyzer.sleep_time"></a>
    
    

                            </div>
                            <div id="Analyzer.last_call" class="classattr">
                                <div class="attr variable">
            <span class="name">last_call</span>

        
    </div>
    <a class="headerlink" href="#Analyzer.last_call"></a>
    
    

                            </div>
                            <div id="Analyzer.gAPI" class="classattr">
                                <div class="attr variable">
            <span class="name">gAPI</span>

        
    </div>
    <a class="headerlink" href="#Analyzer.gAPI"></a>
    
    

                            </div>
                            <div id="Analyzer.gAPI_key" class="classattr">
                                <div class="attr variable">
            <span class="name">gAPI_key</span>

        
    </div>
    <a class="headerlink" href="#Analyzer.gAPI_key"></a>
    
    

                            </div>
                            <div id="Analyzer.analysis_phase" class="classattr">
                                <div class="attr variable">
            <span class="name">analysis_phase</span>

        
    </div>
    <a class="headerlink" href="#Analyzer.analysis_phase"></a>
    
    

                            </div>
                            <div id="Analyzer.env_file" class="classattr">
                                <div class="attr variable">
            <span class="name">env_file</span>

        
    </div>
    <a class="headerlink" href="#Analyzer.env_file"></a>
    
    

                            </div>
                            <div id="Analyzer.project_directory" class="classattr">
                                <div class="attr variable">
            <span class="name">project_directory</span>

        
    </div>
    <a class="headerlink" href="#Analyzer.project_directory"></a>
    
    

                            </div>
                            <div id="Analyzer.project" class="classattr">
                                <div class="attr variable">
            <span class="name">project</span>

        
    </div>
    <a class="headerlink" href="#Analyzer.project"></a>
    
    

                            </div>
                            <div id="Analyzer.graphing" class="classattr">
                                <div class="attr variable">
            <span class="name">graphing</span>

        
    </div>
    <a class="headerlink" href="#Analyzer.graphing"></a>
    
    

                            </div>
                            <div id="Analyzer.load_graphs" class="classattr">
                                        <input id="Analyzer.load_graphs-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">load_graphs</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Analyzer.load_graphs-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Analyzer.load_graphs"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Analyzer.load_graphs-101"><a href="#Analyzer.load_graphs-101"><span class="linenos">101</span></a>    <span class="k">def</span> <span class="nf">load_graphs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Analyzer.load_graphs-102"><a href="#Analyzer.load_graphs-102"><span class="linenos">102</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Analyzer.load_graphs-103"><a href="#Analyzer.load_graphs-103"><span class="linenos">103</span></a><span class="sd">        Loads the list of graph filenames from the project&#39;s &#39;plots&#39; directory.</span>
</span><span id="Analyzer.load_graphs-104"><a href="#Analyzer.load_graphs-104"><span class="linenos">104</span></a>
</span><span id="Analyzer.load_graphs-105"><a href="#Analyzer.load_graphs-105"><span class="linenos">105</span></a><span class="sd">        This method checks if the &#39;plots&#39; subdirectory exists within the current project directory. </span>
</span><span id="Analyzer.load_graphs-106"><a href="#Analyzer.load_graphs-106"><span class="linenos">106</span></a><span class="sd">        If it doesn&#39;t exist, it creates the directory. It then updates the instance variable with a list of .png filenames </span>
</span><span id="Analyzer.load_graphs-107"><a href="#Analyzer.load_graphs-107"><span class="linenos">107</span></a><span class="sd">        found in the &#39;plots&#39; directory.</span>
</span><span id="Analyzer.load_graphs-108"><a href="#Analyzer.load_graphs-108"><span class="linenos">108</span></a>
</span><span id="Analyzer.load_graphs-109"><a href="#Analyzer.load_graphs-109"><span class="linenos">109</span></a><span class="sd">        Returns:</span>
</span><span id="Analyzer.load_graphs-110"><a href="#Analyzer.load_graphs-110"><span class="linenos">110</span></a><span class="sd">            bool: True if the project has a &#39;plots&#39; directory, False otherwise.</span>
</span><span id="Analyzer.load_graphs-111"><a href="#Analyzer.load_graphs-111"><span class="linenos">111</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Analyzer.load_graphs-112"><a href="#Analyzer.load_graphs-112"><span class="linenos">112</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">project_name</span> <span class="o">!=</span><span class="s2">&quot;&quot;</span><span class="p">:</span>
</span><span id="Analyzer.load_graphs-113"><a href="#Analyzer.load_graphs-113"><span class="linenos">113</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project_directory</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">project_name</span><span class="p">,</span> <span class="s2">&quot;plots&quot;</span><span class="p">)):</span>
</span><span id="Analyzer.load_graphs-114"><a href="#Analyzer.load_graphs-114"><span class="linenos">114</span></a>                <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project_directory</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">project_name</span><span class="p">,</span> <span class="s2">&quot;plots&quot;</span><span class="p">))</span>
</span><span id="Analyzer.load_graphs-115"><a href="#Analyzer.load_graphs-115"><span class="linenos">115</span></a>            <span class="c1"># load the list of .png filenames into a self.graphs attribute only if they are .png files</span>
</span><span id="Analyzer.load_graphs-116"><a href="#Analyzer.load_graphs-116"><span class="linenos">116</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">graphs</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project_directory</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">project_name</span><span class="p">,</span> <span class="s2">&quot;plots&quot;</span><span class="p">))</span> <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.png&#39;</span><span class="p">)]</span>
</span><span id="Analyzer.load_graphs-117"><a href="#Analyzer.load_graphs-117"><span class="linenos">117</span></a>            <span class="k">return</span> <span class="kc">True</span>
</span><span id="Analyzer.load_graphs-118"><a href="#Analyzer.load_graphs-118"><span class="linenos">118</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Analyzer.load_graphs-119"><a href="#Analyzer.load_graphs-119"><span class="linenos">119</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">graphs</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Analyzer.load_graphs-120"><a href="#Analyzer.load_graphs-120"><span class="linenos">120</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span></pre></div>


            <div class="docstring"><p>Loads the list of graph filenames from the project's 'plots' directory.</p>

<p>This method checks if the 'plots' subdirectory exists within the current project directory. 
If it doesn't exist, it creates the directory. It then updates the instance variable with a list of .png filenames 
found in the 'plots' directory.</p>

<p>Returns:
    bool: True if the project has a 'plots' directory, False otherwise.</p>
</div>


                            </div>
                            <div id="Analyzer.sleepif" class="classattr">
                                        <input id="Analyzer.sleepif-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">sleepif</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Analyzer.sleepif-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Analyzer.sleepif"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Analyzer.sleepif-122"><a href="#Analyzer.sleepif-122"><span class="linenos">122</span></a>    <span class="k">def</span> <span class="nf">sleepif</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Analyzer.sleepif-123"><a href="#Analyzer.sleepif-123"><span class="linenos">123</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Analyzer.sleepif-124"><a href="#Analyzer.sleepif-124"><span class="linenos">124</span></a><span class="sd">        Ensures adherence to the API rate limit by sleeping if the time since the last API call is less than the required wait time.</span>
</span><span id="Analyzer.sleepif-125"><a href="#Analyzer.sleepif-125"><span class="linenos">125</span></a>
</span><span id="Analyzer.sleepif-126"><a href="#Analyzer.sleepif-126"><span class="linenos">126</span></a><span class="sd">        This method calculates the time elapsed since the last API call and pauses execution for the remainder of the time needed to </span>
</span><span id="Analyzer.sleepif-127"><a href="#Analyzer.sleepif-127"><span class="linenos">127</span></a><span class="sd">        comply with the set rate limit, ensuring that API requests do not exceed the prescribed rate.</span>
</span><span id="Analyzer.sleepif-128"><a href="#Analyzer.sleepif-128"><span class="linenos">128</span></a>
</span><span id="Analyzer.sleepif-129"><a href="#Analyzer.sleepif-129"><span class="linenos">129</span></a><span class="sd">        Returns:</span>
</span><span id="Analyzer.sleepif-130"><a href="#Analyzer.sleepif-130"><span class="linenos">130</span></a><span class="sd">            None</span>
</span><span id="Analyzer.sleepif-131"><a href="#Analyzer.sleepif-131"><span class="linenos">131</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Analyzer.sleepif-132"><a href="#Analyzer.sleepif-132"><span class="linenos">132</span></a>        <span class="c1"># if the delta between the current time and the last call is less than the sleep time, sleep for the difference</span>
</span><span id="Analyzer.sleepif-133"><a href="#Analyzer.sleepif-133"><span class="linenos">133</span></a>        <span class="k">if</span> <span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_call</span><span class="p">)</span><span class="o">.</span><span class="n">seconds</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">sleep_time</span><span class="p">:</span>
</span><span id="Analyzer.sleepif-134"><a href="#Analyzer.sleepif-134"><span class="linenos">134</span></a>            <span class="n">sleep</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sleep_time</span> <span class="o">-</span> <span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_call</span><span class="p">)</span><span class="o">.</span><span class="n">seconds</span><span class="p">)</span>
</span><span id="Analyzer.sleepif-135"><a href="#Analyzer.sleepif-135"><span class="linenos">135</span></a>        <span class="k">return</span> <span class="kc">None</span>
</span></pre></div>


            <div class="docstring"><p>Ensures adherence to the API rate limit by sleeping if the time since the last API call is less than the required wait time.</p>

<p>This method calculates the time elapsed since the last API call and pauses execution for the remainder of the time needed to 
comply with the set rate limit, ensuring that API requests do not exceed the prescribed rate.</p>

<p>Returns:
    None</p>
</div>


                            </div>
                            <div id="Analyzer.log_error" class="classattr">
                                        <input id="Analyzer.log_error-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">log_error</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">message</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Analyzer.log_error-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Analyzer.log_error"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Analyzer.log_error-137"><a href="#Analyzer.log_error-137"><span class="linenos">137</span></a>    <span class="k">def</span> <span class="nf">log_error</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">):</span>
</span><span id="Analyzer.log_error-138"><a href="#Analyzer.log_error-138"><span class="linenos">138</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Analyzer.log_error-139"><a href="#Analyzer.log_error-139"><span class="linenos">139</span></a><span class="sd">        Logs an error message to the &#39;error_log.txt&#39; file.</span>
</span><span id="Analyzer.log_error-140"><a href="#Analyzer.log_error-140"><span class="linenos">140</span></a>
</span><span id="Analyzer.log_error-141"><a href="#Analyzer.log_error-141"><span class="linenos">141</span></a><span class="sd">        Appends the provided message to a log file dedicated to errors, facilitating debugging and error tracking over time.</span>
</span><span id="Analyzer.log_error-142"><a href="#Analyzer.log_error-142"><span class="linenos">142</span></a>
</span><span id="Analyzer.log_error-143"><a href="#Analyzer.log_error-143"><span class="linenos">143</span></a><span class="sd">        Args:</span>
</span><span id="Analyzer.log_error-144"><a href="#Analyzer.log_error-144"><span class="linenos">144</span></a><span class="sd">            message (str): The error message to log.</span>
</span><span id="Analyzer.log_error-145"><a href="#Analyzer.log_error-145"><span class="linenos">145</span></a>
</span><span id="Analyzer.log_error-146"><a href="#Analyzer.log_error-146"><span class="linenos">146</span></a><span class="sd">        Returns:</span>
</span><span id="Analyzer.log_error-147"><a href="#Analyzer.log_error-147"><span class="linenos">147</span></a><span class="sd">            None</span>
</span><span id="Analyzer.log_error-148"><a href="#Analyzer.log_error-148"><span class="linenos">148</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Analyzer.log_error-149"><a href="#Analyzer.log_error-149"><span class="linenos">149</span></a>        <span class="c1"># append the message to the error.txt log</span>
</span><span id="Analyzer.log_error-150"><a href="#Analyzer.log_error-150"><span class="linenos">150</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;error_log.txt&quot;</span><span class="p">,</span> <span class="s2">&quot;a&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="Analyzer.log_error-151"><a href="#Analyzer.log_error-151"><span class="linenos">151</span></a>            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
</span><span id="Analyzer.log_error-152"><a href="#Analyzer.log_error-152"><span class="linenos">152</span></a>        <span class="k">return</span> <span class="kc">None</span>
</span></pre></div>


            <div class="docstring"><p>Logs an error message to the 'error_log.txt' file.</p>

<p>Appends the provided message to a log file dedicated to errors, facilitating debugging and error tracking over time.</p>

<p>Args:
    message (str): The error message to log.</p>

<p>Returns:
    None</p>
</div>


                            </div>
                            <div id="Analyzer.save_env" class="classattr">
                                        <input id="Analyzer.save_env-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">save_env</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">project_directory</span><span class="o">=</span><span class="kc">None</span>, </span><span class="param"><span class="n">gAPI_key</span><span class="o">=</span><span class="kc">None</span>, </span><span class="param"><span class="n">env_file</span><span class="o">=</span><span class="kc">None</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Analyzer.save_env-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Analyzer.save_env"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Analyzer.save_env-154"><a href="#Analyzer.save_env-154"><span class="linenos">154</span></a>    <span class="k">def</span> <span class="nf">save_env</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">project_directory</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">gAPI_key</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">env_file</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="Analyzer.save_env-155"><a href="#Analyzer.save_env-155"><span class="linenos">155</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Analyzer.save_env-156"><a href="#Analyzer.save_env-156"><span class="linenos">156</span></a><span class="sd">        Saves the specified environment variables to the .env file and updates the runtime environment.</span>
</span><span id="Analyzer.save_env-157"><a href="#Analyzer.save_env-157"><span class="linenos">157</span></a>
</span><span id="Analyzer.save_env-158"><a href="#Analyzer.save_env-158"><span class="linenos">158</span></a><span class="sd">        This method allows dynamic updating of critical environment variables, including the Google Maps API key and the default project directory. </span>
</span><span id="Analyzer.save_env-159"><a href="#Analyzer.save_env-159"><span class="linenos">159</span></a><span class="sd">        If any arguments are provided, they override the corresponding instance variables before saving.</span>
</span><span id="Analyzer.save_env-160"><a href="#Analyzer.save_env-160"><span class="linenos">160</span></a>
</span><span id="Analyzer.save_env-161"><a href="#Analyzer.save_env-161"><span class="linenos">161</span></a><span class="sd">        Args:</span>
</span><span id="Analyzer.save_env-162"><a href="#Analyzer.save_env-162"><span class="linenos">162</span></a><span class="sd">            project_directory (str, optional): The directory where project files are stored. If specified, overrides the existing value.</span>
</span><span id="Analyzer.save_env-163"><a href="#Analyzer.save_env-163"><span class="linenos">163</span></a><span class="sd">            gAPI_key (str, optional): The Google Maps API key. If specified, overrides the existing value.</span>
</span><span id="Analyzer.save_env-164"><a href="#Analyzer.save_env-164"><span class="linenos">164</span></a><span class="sd">            env_file (str, optional): Path to the .env file. If specified, overrides the existing value.</span>
</span><span id="Analyzer.save_env-165"><a href="#Analyzer.save_env-165"><span class="linenos">165</span></a>
</span><span id="Analyzer.save_env-166"><a href="#Analyzer.save_env-166"><span class="linenos">166</span></a><span class="sd">        Raises:</span>
</span><span id="Analyzer.save_env-167"><a href="#Analyzer.save_env-167"><span class="linenos">167</span></a><span class="sd">            ValueError: If no .env file path is provided.</span>
</span><span id="Analyzer.save_env-168"><a href="#Analyzer.save_env-168"><span class="linenos">168</span></a>
</span><span id="Analyzer.save_env-169"><a href="#Analyzer.save_env-169"><span class="linenos">169</span></a><span class="sd">        Returns:</span>
</span><span id="Analyzer.save_env-170"><a href="#Analyzer.save_env-170"><span class="linenos">170</span></a><span class="sd">            None</span>
</span><span id="Analyzer.save_env-171"><a href="#Analyzer.save_env-171"><span class="linenos">171</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Analyzer.save_env-172"><a href="#Analyzer.save_env-172"><span class="linenos">172</span></a>        <span class="c1"># if variables specified, override self and then save to .env</span>
</span><span id="Analyzer.save_env-173"><a href="#Analyzer.save_env-173"><span class="linenos">173</span></a>        <span class="k">if</span> <span class="n">project_directory</span><span class="p">:</span>
</span><span id="Analyzer.save_env-174"><a href="#Analyzer.save_env-174"><span class="linenos">174</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">project_directory</span> <span class="o">=</span> <span class="n">project_directory</span>
</span><span id="Analyzer.save_env-175"><a href="#Analyzer.save_env-175"><span class="linenos">175</span></a>        <span class="k">if</span> <span class="n">gAPI_key</span><span class="p">:</span>
</span><span id="Analyzer.save_env-176"><a href="#Analyzer.save_env-176"><span class="linenos">176</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">gAPI_key</span> <span class="o">=</span> <span class="n">gAPI_key</span>
</span><span id="Analyzer.save_env-177"><a href="#Analyzer.save_env-177"><span class="linenos">177</span></a>        <span class="k">if</span> <span class="n">env_file</span><span class="p">:</span>
</span><span id="Analyzer.save_env-178"><a href="#Analyzer.save_env-178"><span class="linenos">178</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">env_file</span> <span class="o">=</span> <span class="n">env_file</span>
</span><span id="Analyzer.save_env-179"><a href="#Analyzer.save_env-179"><span class="linenos">179</span></a>        <span class="c1"># save the .env file</span>
</span><span id="Analyzer.save_env-180"><a href="#Analyzer.save_env-180"><span class="linenos">180</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">env_file</span><span class="p">:</span>
</span><span id="Analyzer.save_env-181"><a href="#Analyzer.save_env-181"><span class="linenos">181</span></a>            <span class="n">set_key</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">env_file</span><span class="p">,</span> <span class="s2">&quot;GMAPS_API_KEY&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gAPI_key</span><span class="p">)</span>
</span><span id="Analyzer.save_env-182"><a href="#Analyzer.save_env-182"><span class="linenos">182</span></a>            <span class="n">set_key</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">env_file</span><span class="p">,</span> <span class="s2">&quot;DEFAULT_PROJECT_DIRECTORY&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">project_directory</span><span class="p">)</span>
</span><span id="Analyzer.save_env-183"><a href="#Analyzer.save_env-183"><span class="linenos">183</span></a>
</span><span id="Analyzer.save_env-184"><a href="#Analyzer.save_env-184"><span class="linenos">184</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Analyzer.save_env-185"><a href="#Analyzer.save_env-185"><span class="linenos">185</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;No .env file provided.&quot;</span><span class="p">)</span>
</span><span id="Analyzer.save_env-186"><a href="#Analyzer.save_env-186"><span class="linenos">186</span></a>
</span><span id="Analyzer.save_env-187"><a href="#Analyzer.save_env-187"><span class="linenos">187</span></a>        <span class="c1"># update the current runtime environment</span>
</span><span id="Analyzer.save_env-188"><a href="#Analyzer.save_env-188"><span class="linenos">188</span></a>        <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;GMAPS_API_KEY&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gAPI_key</span>
</span><span id="Analyzer.save_env-189"><a href="#Analyzer.save_env-189"><span class="linenos">189</span></a>        <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;DEFAULT_PROJECT_DIRECTORY&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">project_directory</span>
</span></pre></div>


            <div class="docstring"><p>Saves the specified environment variables to the .env file and updates the runtime environment.</p>

<p>This method allows dynamic updating of critical environment variables, including the Google Maps API key and the default project directory. 
If any arguments are provided, they override the corresponding instance variables before saving.</p>

<p>Args:
    project_directory (str, optional): The directory where project files are stored. If specified, overrides the existing value.
    gAPI_key (str, optional): The Google Maps API key. If specified, overrides the existing value.
    env_file (str, optional): Path to the .env file. If specified, overrides the existing value.</p>

<p>Raises:
    ValueError: If no .env file path is provided.</p>

<p>Returns:
    None</p>
</div>


                            </div>
                            <div id="Analyzer.list_projects" class="classattr">
                                        <input id="Analyzer.list_projects-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">list_projects</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Analyzer.list_projects-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Analyzer.list_projects"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Analyzer.list_projects-191"><a href="#Analyzer.list_projects-191"><span class="linenos">191</span></a>    <span class="k">def</span> <span class="nf">list_projects</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Analyzer.list_projects-192"><a href="#Analyzer.list_projects-192"><span class="linenos">192</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Analyzer.list_projects-193"><a href="#Analyzer.list_projects-193"><span class="linenos">193</span></a><span class="sd">        Lists all projects within the project directory.</span>
</span><span id="Analyzer.list_projects-194"><a href="#Analyzer.list_projects-194"><span class="linenos">194</span></a>
</span><span id="Analyzer.list_projects-195"><a href="#Analyzer.list_projects-195"><span class="linenos">195</span></a><span class="sd">        Retrieves the names of all subdirectories within the project directory, treating each as a separate project. </span>
</span><span id="Analyzer.list_projects-196"><a href="#Analyzer.list_projects-196"><span class="linenos">196</span></a><span class="sd">        This method is useful for enumerating all available projects for selection or analysis.</span>
</span><span id="Analyzer.list_projects-197"><a href="#Analyzer.list_projects-197"><span class="linenos">197</span></a>
</span><span id="Analyzer.list_projects-198"><a href="#Analyzer.list_projects-198"><span class="linenos">198</span></a><span class="sd">        Returns:</span>
</span><span id="Analyzer.list_projects-199"><a href="#Analyzer.list_projects-199"><span class="linenos">199</span></a><span class="sd">            list: A list of project names (subdirectory names) within the project directory.</span>
</span><span id="Analyzer.list_projects-200"><a href="#Analyzer.list_projects-200"><span class="linenos">200</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Analyzer.list_projects-201"><a href="#Analyzer.list_projects-201"><span class="linenos">201</span></a>        <span class="c1"># list all projects in the project directory</span>
</span><span id="Analyzer.list_projects-202"><a href="#Analyzer.list_projects-202"><span class="linenos">202</span></a>        <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project_directory</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Lists all projects within the project directory.</p>

<p>Retrieves the names of all subdirectories within the project directory, treating each as a separate project. 
This method is useful for enumerating all available projects for selection or analysis.</p>

<p>Returns:
    list: A list of project names (subdirectory names) within the project directory.</p>
</div>


                            </div>
                            <div id="Analyzer.create_project" class="classattr">
                                        <input id="Analyzer.create_project-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">create_project</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">project_name</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Analyzer.create_project-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Analyzer.create_project"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Analyzer.create_project-204"><a href="#Analyzer.create_project-204"><span class="linenos">204</span></a>    <span class="k">def</span> <span class="nf">create_project</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">project_name</span><span class="p">):</span>
</span><span id="Analyzer.create_project-205"><a href="#Analyzer.create_project-205"><span class="linenos">205</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Analyzer.create_project-206"><a href="#Analyzer.create_project-206"><span class="linenos">206</span></a><span class="sd">        Creates a new project with the specified name.</span>
</span><span id="Analyzer.create_project-207"><a href="#Analyzer.create_project-207"><span class="linenos">207</span></a>
</span><span id="Analyzer.create_project-208"><a href="#Analyzer.create_project-208"><span class="linenos">208</span></a><span class="sd">        This method initializes a new `Project` instance and sets it as the current project. It updates the analysis phase </span>
</span><span id="Analyzer.create_project-209"><a href="#Analyzer.create_project-209"><span class="linenos">209</span></a><span class="sd">        based on the new project&#39;s status.</span>
</span><span id="Analyzer.create_project-210"><a href="#Analyzer.create_project-210"><span class="linenos">210</span></a>
</span><span id="Analyzer.create_project-211"><a href="#Analyzer.create_project-211"><span class="linenos">211</span></a><span class="sd">        Args:</span>
</span><span id="Analyzer.create_project-212"><a href="#Analyzer.create_project-212"><span class="linenos">212</span></a><span class="sd">            project_name (str): The name of the new project to create.</span>
</span><span id="Analyzer.create_project-213"><a href="#Analyzer.create_project-213"><span class="linenos">213</span></a>
</span><span id="Analyzer.create_project-214"><a href="#Analyzer.create_project-214"><span class="linenos">214</span></a><span class="sd">        Returns:</span>
</span><span id="Analyzer.create_project-215"><a href="#Analyzer.create_project-215"><span class="linenos">215</span></a><span class="sd">            bool: True if the project is successfully created, False otherwise.</span>
</span><span id="Analyzer.create_project-216"><a href="#Analyzer.create_project-216"><span class="linenos">216</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Analyzer.create_project-217"><a href="#Analyzer.create_project-217"><span class="linenos">217</span></a>        <span class="c1"># create a new project</span>
</span><span id="Analyzer.create_project-218"><a href="#Analyzer.create_project-218"><span class="linenos">218</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">project</span> <span class="o">=</span> <span class="n">Project</span><span class="p">(</span><span class="n">project_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">project_directory</span><span class="p">)</span>
</span><span id="Analyzer.create_project-219"><a href="#Analyzer.create_project-219"><span class="linenos">219</span></a>        <span class="c1"># update the analysis phase</span>
</span><span id="Analyzer.create_project-220"><a href="#Analyzer.create_project-220"><span class="linenos">220</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">update_analysis_phase</span><span class="p">()</span>
</span><span id="Analyzer.create_project-221"><a href="#Analyzer.create_project-221"><span class="linenos">221</span></a>        <span class="k">return</span> <span class="kc">True</span>
</span></pre></div>


            <div class="docstring"><p>Creates a new project with the specified name.</p>

<p>This method initializes a new <code>Project</code> instance and sets it as the current project. It updates the analysis phase 
based on the new project's status.</p>

<p>Args:
    project_name (str): The name of the new project to create.</p>

<p>Returns:
    bool: True if the project is successfully created, False otherwise.</p>
</div>


                            </div>
                            <div id="Analyzer.load_project" class="classattr">
                                        <input id="Analyzer.load_project-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">load_project</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">project_name</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Analyzer.load_project-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Analyzer.load_project"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Analyzer.load_project-223"><a href="#Analyzer.load_project-223"><span class="linenos">223</span></a>    <span class="k">def</span> <span class="nf">load_project</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">project_name</span><span class="p">):</span>
</span><span id="Analyzer.load_project-224"><a href="#Analyzer.load_project-224"><span class="linenos">224</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Analyzer.load_project-225"><a href="#Analyzer.load_project-225"><span class="linenos">225</span></a><span class="sd">        Loads an existing project by name.</span>
</span><span id="Analyzer.load_project-226"><a href="#Analyzer.load_project-226"><span class="linenos">226</span></a>
</span><span id="Analyzer.load_project-227"><a href="#Analyzer.load_project-227"><span class="linenos">227</span></a><span class="sd">        Sets the specified project as the current project, loads any associated graphs, and updates the analysis phase </span>
</span><span id="Analyzer.load_project-228"><a href="#Analyzer.load_project-228"><span class="linenos">228</span></a><span class="sd">        based on the loaded project&#39;s status.</span>
</span><span id="Analyzer.load_project-229"><a href="#Analyzer.load_project-229"><span class="linenos">229</span></a>
</span><span id="Analyzer.load_project-230"><a href="#Analyzer.load_project-230"><span class="linenos">230</span></a><span class="sd">        Args:</span>
</span><span id="Analyzer.load_project-231"><a href="#Analyzer.load_project-231"><span class="linenos">231</span></a><span class="sd">            project_name (str): The name of the project to load.</span>
</span><span id="Analyzer.load_project-232"><a href="#Analyzer.load_project-232"><span class="linenos">232</span></a>
</span><span id="Analyzer.load_project-233"><a href="#Analyzer.load_project-233"><span class="linenos">233</span></a><span class="sd">        Returns:</span>
</span><span id="Analyzer.load_project-234"><a href="#Analyzer.load_project-234"><span class="linenos">234</span></a><span class="sd">            bool: True if the project is successfully loaded, False otherwise.</span>
</span><span id="Analyzer.load_project-235"><a href="#Analyzer.load_project-235"><span class="linenos">235</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Analyzer.load_project-236"><a href="#Analyzer.load_project-236"><span class="linenos">236</span></a>     <span class="c1"># load an existing project</span>
</span><span id="Analyzer.load_project-237"><a href="#Analyzer.load_project-237"><span class="linenos">237</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">project</span> <span class="o">=</span> <span class="n">Project</span><span class="p">(</span><span class="n">project_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">project_directory</span><span class="p">)</span>
</span><span id="Analyzer.load_project-238"><a href="#Analyzer.load_project-238"><span class="linenos">238</span></a>        <span class="c1"># load the graphs if any</span>
</span><span id="Analyzer.load_project-239"><a href="#Analyzer.load_project-239"><span class="linenos">239</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">load_graphs</span><span class="p">()</span>
</span><span id="Analyzer.load_project-240"><a href="#Analyzer.load_project-240"><span class="linenos">240</span></a>        <span class="c1"># update the analysis phase</span>
</span><span id="Analyzer.load_project-241"><a href="#Analyzer.load_project-241"><span class="linenos">241</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">update_analysis_phase</span><span class="p">()</span>
</span><span id="Analyzer.load_project-242"><a href="#Analyzer.load_project-242"><span class="linenos">242</span></a>        <span class="k">return</span> <span class="kc">True</span>
</span></pre></div>


            <div class="docstring"><p>Loads an existing project by name.</p>

<p>Sets the specified project as the current project, loads any associated graphs, and updates the analysis phase 
based on the loaded project's status.</p>

<p>Args:
    project_name (str): The name of the project to load.</p>

<p>Returns:
    bool: True if the project is successfully loaded, False otherwise.</p>
</div>


                            </div>
                            <div id="Analyzer.update_analysis_phase" class="classattr">
                                        <input id="Analyzer.update_analysis_phase-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">update_analysis_phase</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Analyzer.update_analysis_phase-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Analyzer.update_analysis_phase"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Analyzer.update_analysis_phase-244"><a href="#Analyzer.update_analysis_phase-244"><span class="linenos">244</span></a>    <span class="k">def</span> <span class="nf">update_analysis_phase</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Analyzer.update_analysis_phase-245"><a href="#Analyzer.update_analysis_phase-245"><span class="linenos">245</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Analyzer.update_analysis_phase-246"><a href="#Analyzer.update_analysis_phase-246"><span class="linenos">246</span></a><span class="sd">        Updates the analysis phase based on the current state of the project data.</span>
</span><span id="Analyzer.update_analysis_phase-247"><a href="#Analyzer.update_analysis_phase-247"><span class="linenos">247</span></a>
</span><span id="Analyzer.update_analysis_phase-248"><a href="#Analyzer.update_analysis_phase-248"><span class="linenos">248</span></a><span class="sd">        This method determines the current phase of analysis by checking the availability of specific data files within the project. </span>
</span><span id="Analyzer.update_analysis_phase-249"><a href="#Analyzer.update_analysis_phase-249"><span class="linenos">249</span></a><span class="sd">        The analysis phase is a critical component that guides the workflow and available actions within the current project context.</span>
</span><span id="Analyzer.update_analysis_phase-250"><a href="#Analyzer.update_analysis_phase-250"><span class="linenos">250</span></a>
</span><span id="Analyzer.update_analysis_phase-251"><a href="#Analyzer.update_analysis_phase-251"><span class="linenos">251</span></a><span class="sd">        Returns:</span>
</span><span id="Analyzer.update_analysis_phase-252"><a href="#Analyzer.update_analysis_phase-252"><span class="linenos">252</span></a><span class="sd">            int: The updated analysis phase.</span>
</span><span id="Analyzer.update_analysis_phase-253"><a href="#Analyzer.update_analysis_phase-253"><span class="linenos">253</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Analyzer.update_analysis_phase-254"><a href="#Analyzer.update_analysis_phase-254"><span class="linenos">254</span></a>
</span><span id="Analyzer.update_analysis_phase-255"><a href="#Analyzer.update_analysis_phase-255"><span class="linenos">255</span></a>        <span class="c1"># if project is none, phase is zero</span>
</span><span id="Analyzer.update_analysis_phase-256"><a href="#Analyzer.update_analysis_phase-256"><span class="linenos">256</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Analyzer.update_analysis_phase-257"><a href="#Analyzer.update_analysis_phase-257"><span class="linenos">257</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">analysis_phase</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Analyzer.update_analysis_phase-258"><a href="#Analyzer.update_analysis_phase-258"><span class="linenos">258</span></a>            <span class="k">return</span> <span class="mi">0</span>
</span><span id="Analyzer.update_analysis_phase-259"><a href="#Analyzer.update_analysis_phase-259"><span class="linenos">259</span></a>        <span class="c1"># if there is a project and there is no employee_addresses.csv in the project, phase is 1</span>
</span><span id="Analyzer.update_analysis_phase-260"><a href="#Analyzer.update_analysis_phase-260"><span class="linenos">260</span></a>        <span class="k">if</span> <span class="s2">&quot;employee_addresses.csv&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">list_data_files</span><span class="p">():</span>
</span><span id="Analyzer.update_analysis_phase-261"><a href="#Analyzer.update_analysis_phase-261"><span class="linenos">261</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">analysis_phase</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="Analyzer.update_analysis_phase-262"><a href="#Analyzer.update_analysis_phase-262"><span class="linenos">262</span></a>            <span class="k">return</span> <span class="mi">1</span>
</span><span id="Analyzer.update_analysis_phase-263"><a href="#Analyzer.update_analysis_phase-263"><span class="linenos">263</span></a>        <span class="c1"># if there is a project and there is a employee_addresses.csv in the project, phase is 2</span>
</span><span id="Analyzer.update_analysis_phase-264"><a href="#Analyzer.update_analysis_phase-264"><span class="linenos">264</span></a>        <span class="k">if</span> <span class="s2">&quot;employee_addresses.csv&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">list_data_files</span><span class="p">()</span> <span class="ow">and</span> <span class="s2">&quot;office_addresses.csv&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">list_data_files</span><span class="p">():</span>
</span><span id="Analyzer.update_analysis_phase-265"><a href="#Analyzer.update_analysis_phase-265"><span class="linenos">265</span></a>            <span class="c1"># if there is also a employee_gps.csv in the project, phase is 3</span>
</span><span id="Analyzer.update_analysis_phase-266"><a href="#Analyzer.update_analysis_phase-266"><span class="linenos">266</span></a>            <span class="k">if</span> <span class="s2">&quot;employee_gps.csv&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">list_data_files</span><span class="p">()</span> <span class="ow">and</span> <span class="s2">&quot;office_gps.csv&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">list_data_files</span><span class="p">():</span>
</span><span id="Analyzer.update_analysis_phase-267"><a href="#Analyzer.update_analysis_phase-267"><span class="linenos">267</span></a>                <span class="c1"># if there is also a gps_fuzz.csv in the project, or if using GPS fuzz is set to fals, we are at phase is 4</span>
</span><span id="Analyzer.update_analysis_phase-268"><a href="#Analyzer.update_analysis_phase-268"><span class="linenos">268</span></a>                <span class="k">if</span> <span class="s2">&quot;gps_fuzz.csv&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">list_data_files</span><span class="p">()</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">use_gps_fuzzing</span><span class="o">==</span><span class="kc">False</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">use_gps_fuzzing</span><span class="o">==</span><span class="s2">&quot;False&quot;</span><span class="p">:</span>
</span><span id="Analyzer.update_analysis_phase-269"><a href="#Analyzer.update_analysis_phase-269"><span class="linenos">269</span></a>                    <span class="c1"># if there is also a commute_data.csv in the project, phase is 5</span>
</span><span id="Analyzer.update_analysis_phase-270"><a href="#Analyzer.update_analysis_phase-270"><span class="linenos">270</span></a>                    <span class="k">if</span> <span class="s2">&quot;commute_data.csv&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">list_data_files</span><span class="p">():</span>
</span><span id="Analyzer.update_analysis_phase-271"><a href="#Analyzer.update_analysis_phase-271"><span class="linenos">271</span></a>                        <span class="c1"># if graphs.json is present in the plots dir, we&#39;ve graphed, phase is 6</span>
</span><span id="Analyzer.update_analysis_phase-272"><a href="#Analyzer.update_analysis_phase-272"><span class="linenos">272</span></a>                        <span class="k">if</span> <span class="s2">&quot;plots&quot;</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project_directory</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">project_name</span><span class="p">))</span> <span class="ow">and</span> <span class="s2">&quot;graphs.json&quot;</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project_directory</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">project_name</span><span class="p">,</span> <span class="s2">&quot;plots&quot;</span><span class="p">)):</span>
</span><span id="Analyzer.update_analysis_phase-273"><a href="#Analyzer.update_analysis_phase-273"><span class="linenos">273</span></a>                            <span class="c1"># if tables dir exists and tables.json is present, we&#39;ve tabled, phase is 7</span>
</span><span id="Analyzer.update_analysis_phase-274"><a href="#Analyzer.update_analysis_phase-274"><span class="linenos">274</span></a>                            <span class="k">if</span> <span class="s2">&quot;tables&quot;</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project_directory</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">project_name</span><span class="p">))</span> <span class="ow">and</span> <span class="s2">&quot;tables.json&quot;</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project_directory</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">project_name</span><span class="p">,</span> <span class="s2">&quot;tables&quot;</span><span class="p">)):</span>
</span><span id="Analyzer.update_analysis_phase-275"><a href="#Analyzer.update_analysis_phase-275"><span class="linenos">275</span></a>                                <span class="bp">self</span><span class="o">.</span><span class="n">analysis_phase</span> <span class="o">=</span> <span class="mi">7</span>
</span><span id="Analyzer.update_analysis_phase-276"><a href="#Analyzer.update_analysis_phase-276"><span class="linenos">276</span></a>                                <span class="k">return</span> <span class="mi">7</span>
</span><span id="Analyzer.update_analysis_phase-277"><a href="#Analyzer.update_analysis_phase-277"><span class="linenos">277</span></a>                            <span class="bp">self</span><span class="o">.</span><span class="n">analysis_phase</span> <span class="o">=</span> <span class="mi">7</span>
</span><span id="Analyzer.update_analysis_phase-278"><a href="#Analyzer.update_analysis_phase-278"><span class="linenos">278</span></a>                            <span class="k">return</span> <span class="mi">7</span>
</span><span id="Analyzer.update_analysis_phase-279"><a href="#Analyzer.update_analysis_phase-279"><span class="linenos">279</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">analysis_phase</span> <span class="o">=</span> <span class="mi">5</span>
</span><span id="Analyzer.update_analysis_phase-280"><a href="#Analyzer.update_analysis_phase-280"><span class="linenos">280</span></a>                        <span class="k">return</span> <span class="mi">5</span>
</span><span id="Analyzer.update_analysis_phase-281"><a href="#Analyzer.update_analysis_phase-281"><span class="linenos">281</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="Analyzer.update_analysis_phase-282"><a href="#Analyzer.update_analysis_phase-282"><span class="linenos">282</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">analysis_phase</span> <span class="o">=</span> <span class="mi">4</span>
</span><span id="Analyzer.update_analysis_phase-283"><a href="#Analyzer.update_analysis_phase-283"><span class="linenos">283</span></a>                        <span class="k">return</span> <span class="mi">4</span>
</span><span id="Analyzer.update_analysis_phase-284"><a href="#Analyzer.update_analysis_phase-284"><span class="linenos">284</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="Analyzer.update_analysis_phase-285"><a href="#Analyzer.update_analysis_phase-285"><span class="linenos">285</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">analysis_phase</span> <span class="o">=</span> <span class="mi">3</span>
</span><span id="Analyzer.update_analysis_phase-286"><a href="#Analyzer.update_analysis_phase-286"><span class="linenos">286</span></a>                    <span class="k">return</span> <span class="mi">3</span>
</span><span id="Analyzer.update_analysis_phase-287"><a href="#Analyzer.update_analysis_phase-287"><span class="linenos">287</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Analyzer.update_analysis_phase-288"><a href="#Analyzer.update_analysis_phase-288"><span class="linenos">288</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">analysis_phase</span> <span class="o">=</span> <span class="mi">2</span>
</span><span id="Analyzer.update_analysis_phase-289"><a href="#Analyzer.update_analysis_phase-289"><span class="linenos">289</span></a>                <span class="k">return</span> <span class="mi">2</span>
</span></pre></div>


            <div class="docstring"><p>Updates the analysis phase based on the current state of the project data.</p>

<p>This method determines the current phase of analysis by checking the availability of specific data files within the project. 
The analysis phase is a critical component that guides the workflow and available actions within the current project context.</p>

<p>Returns:
    int: The updated analysis phase.</p>
</div>


                            </div>
                            <div id="Analyzer.convert_addresses_to_gps" class="classattr">
                                        <input id="Analyzer.convert_addresses_to_gps-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">convert_addresses_to_gps</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">force</span><span class="o">=</span><span class="kc">False</span>, </span><span class="param"><span class="n">log_csv</span><span class="o">=</span><span class="kc">None</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Analyzer.convert_addresses_to_gps-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Analyzer.convert_addresses_to_gps"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Analyzer.convert_addresses_to_gps-291"><a href="#Analyzer.convert_addresses_to_gps-291"><span class="linenos">291</span></a>    <span class="k">def</span> <span class="nf">convert_addresses_to_gps</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">log_csv</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="Analyzer.convert_addresses_to_gps-292"><a href="#Analyzer.convert_addresses_to_gps-292"><span class="linenos">292</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Analyzer.convert_addresses_to_gps-293"><a href="#Analyzer.convert_addresses_to_gps-293"><span class="linenos">293</span></a><span class="sd">        Converts addresses from specified CSV files to GPS coordinates using the Google Maps API.</span>
</span><span id="Analyzer.convert_addresses_to_gps-294"><a href="#Analyzer.convert_addresses_to_gps-294"><span class="linenos">294</span></a>
</span><span id="Analyzer.convert_addresses_to_gps-295"><a href="#Analyzer.convert_addresses_to_gps-295"><span class="linenos">295</span></a><span class="sd">        This method processes both employee and office address data, converting each address to latitude and longitude coordinates. </span>
</span><span id="Analyzer.convert_addresses_to_gps-296"><a href="#Analyzer.convert_addresses_to_gps-296"><span class="linenos">296</span></a><span class="sd">        The results are saved to corresponding GPS data files. If logging is enabled, the process details are recorded in a specified log CSV file.</span>
</span><span id="Analyzer.convert_addresses_to_gps-297"><a href="#Analyzer.convert_addresses_to_gps-297"><span class="linenos">297</span></a>
</span><span id="Analyzer.convert_addresses_to_gps-298"><a href="#Analyzer.convert_addresses_to_gps-298"><span class="linenos">298</span></a><span class="sd">        Args:</span>
</span><span id="Analyzer.convert_addresses_to_gps-299"><a href="#Analyzer.convert_addresses_to_gps-299"><span class="linenos">299</span></a><span class="sd">            force (bool, optional): If True, forces re-conversion of addresses even if GPS data already exists. Defaults to False.</span>
</span><span id="Analyzer.convert_addresses_to_gps-300"><a href="#Analyzer.convert_addresses_to_gps-300"><span class="linenos">300</span></a><span class="sd">            log_csv (str, optional): Path to a log CSV file where operation details are recorded. Defaults to None.</span>
</span><span id="Analyzer.convert_addresses_to_gps-301"><a href="#Analyzer.convert_addresses_to_gps-301"><span class="linenos">301</span></a>
</span><span id="Analyzer.convert_addresses_to_gps-302"><a href="#Analyzer.convert_addresses_to_gps-302"><span class="linenos">302</span></a><span class="sd">        Returns:</span>
</span><span id="Analyzer.convert_addresses_to_gps-303"><a href="#Analyzer.convert_addresses_to_gps-303"><span class="linenos">303</span></a><span class="sd">            bool: True if the conversion process is completed successfully for all addresses; False otherwise.</span>
</span><span id="Analyzer.convert_addresses_to_gps-304"><a href="#Analyzer.convert_addresses_to_gps-304"><span class="linenos">304</span></a><span class="sd">        </span>
</span><span id="Analyzer.convert_addresses_to_gps-305"><a href="#Analyzer.convert_addresses_to_gps-305"><span class="linenos">305</span></a><span class="sd">        This method handles geocoding of addresses using the Google Maps API, respecting API rate limits</span>
</span><span id="Analyzer.convert_addresses_to_gps-306"><a href="#Analyzer.convert_addresses_to_gps-306"><span class="linenos">306</span></a><span class="sd">        and optionally logging the process. If `force` is True, existing GPS data is ignored, and addresses are re-geocoded.</span>
</span><span id="Analyzer.convert_addresses_to_gps-307"><a href="#Analyzer.convert_addresses_to_gps-307"><span class="linenos">307</span></a><span class="sd">            </span>
</span><span id="Analyzer.convert_addresses_to_gps-308"><a href="#Analyzer.convert_addresses_to_gps-308"><span class="linenos">308</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Analyzer.convert_addresses_to_gps-309"><a href="#Analyzer.convert_addresses_to_gps-309"><span class="linenos">309</span></a>
</span><span id="Analyzer.convert_addresses_to_gps-310"><a href="#Analyzer.convert_addresses_to_gps-310"><span class="linenos">310</span></a>        <span class="c1"># start logfile if logging</span>
</span><span id="Analyzer.convert_addresses_to_gps-311"><a href="#Analyzer.convert_addresses_to_gps-311"><span class="linenos">311</span></a>        <span class="k">if</span> <span class="n">log_csv</span><span class="p">:</span>
</span><span id="Analyzer.convert_addresses_to_gps-312"><a href="#Analyzer.convert_addresses_to_gps-312"><span class="linenos">312</span></a>            <span class="n">log</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">log_csv</span><span class="p">,</span> <span class="s2">&quot;a+&quot;</span><span class="p">)</span>
</span><span id="Analyzer.convert_addresses_to_gps-313"><a href="#Analyzer.convert_addresses_to_gps-313"><span class="linenos">313</span></a>            <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Beginning the geocoding of addresses</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Analyzer.convert_addresses_to_gps-314"><a href="#Analyzer.convert_addresses_to_gps-314"><span class="linenos">314</span></a>            <span class="c1"># dump the project data including the file system location of all data files to the log</span>
</span><span id="Analyzer.convert_addresses_to_gps-315"><a href="#Analyzer.convert_addresses_to_gps-315"><span class="linenos">315</span></a>            <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;project data&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Analyzer.convert_addresses_to_gps-316"><a href="#Analyzer.convert_addresses_to_gps-316"><span class="linenos">316</span></a>            <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">project_directory</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Analyzer.convert_addresses_to_gps-317"><a href="#Analyzer.convert_addresses_to_gps-317"><span class="linenos">317</span></a>
</span><span id="Analyzer.convert_addresses_to_gps-318"><a href="#Analyzer.convert_addresses_to_gps-318"><span class="linenos">318</span></a>            <span class="n">log</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
</span><span id="Analyzer.convert_addresses_to_gps-319"><a href="#Analyzer.convert_addresses_to_gps-319"><span class="linenos">319</span></a>        <span class="c1"># create a google API object if it doesn&#39;t exist</span>
</span><span id="Analyzer.convert_addresses_to_gps-320"><a href="#Analyzer.convert_addresses_to_gps-320"><span class="linenos">320</span></a>        <span class="c1"># if the project has an API key, use it, otherwise use the default .env key</span>
</span><span id="Analyzer.convert_addresses_to_gps-321"><a href="#Analyzer.convert_addresses_to_gps-321"><span class="linenos">321</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">GMAPS_API_KEY</span><span class="p">:</span>
</span><span id="Analyzer.convert_addresses_to_gps-322"><a href="#Analyzer.convert_addresses_to_gps-322"><span class="linenos">322</span></a>            <span class="n">api_key</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">GMAPS_API_KEY</span>
</span><span id="Analyzer.convert_addresses_to_gps-323"><a href="#Analyzer.convert_addresses_to_gps-323"><span class="linenos">323</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Analyzer.convert_addresses_to_gps-324"><a href="#Analyzer.convert_addresses_to_gps-324"><span class="linenos">324</span></a>            <span class="n">api_key</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gAPI_key</span>
</span><span id="Analyzer.convert_addresses_to_gps-325"><a href="#Analyzer.convert_addresses_to_gps-325"><span class="linenos">325</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">gAPI</span><span class="p">:</span>
</span><span id="Analyzer.convert_addresses_to_gps-326"><a href="#Analyzer.convert_addresses_to_gps-326"><span class="linenos">326</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">gAPI</span> <span class="o">=</span> <span class="n">GAPI</span><span class="p">(</span><span class="n">api_key</span><span class="p">)</span>  
</span><span id="Analyzer.convert_addresses_to_gps-327"><a href="#Analyzer.convert_addresses_to_gps-327"><span class="linenos">327</span></a>        <span class="c1"># same action for both files</span>
</span><span id="Analyzer.convert_addresses_to_gps-328"><a href="#Analyzer.convert_addresses_to_gps-328"><span class="linenos">328</span></a>        <span class="n">out</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;employee_addresses.csv&quot;</span><span class="p">:</span> <span class="s2">&quot;employee_gps.csv&quot;</span><span class="p">,</span> <span class="s2">&quot;office_addresses.csv&quot;</span><span class="p">:</span> <span class="s2">&quot;office_gps.csv&quot;</span><span class="p">}</span>
</span><span id="Analyzer.convert_addresses_to_gps-329"><a href="#Analyzer.convert_addresses_to_gps-329"><span class="linenos">329</span></a>        <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">out</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
</span><span id="Analyzer.convert_addresses_to_gps-330"><a href="#Analyzer.convert_addresses_to_gps-330"><span class="linenos">330</span></a>            <span class="c1"># check to see if addresses are already in the project</span>
</span><span id="Analyzer.convert_addresses_to_gps-331"><a href="#Analyzer.convert_addresses_to_gps-331"><span class="linenos">331</span></a>            <span class="k">if</span> <span class="n">file</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">list_data_files</span><span class="p">():</span>
</span><span id="Analyzer.convert_addresses_to_gps-332"><a href="#Analyzer.convert_addresses_to_gps-332"><span class="linenos">332</span></a>                <span class="c1"># if the address data isn&#39;t already in the project, load it</span>
</span><span id="Analyzer.convert_addresses_to_gps-333"><a href="#Analyzer.convert_addresses_to_gps-333"><span class="linenos">333</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">file</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">force</span><span class="p">:</span>
</span><span id="Analyzer.convert_addresses_to_gps-334"><a href="#Analyzer.convert_addresses_to_gps-334"><span class="linenos">334</span></a>                    <span class="c1"># attempt to load the address data</span>
</span><span id="Analyzer.convert_addresses_to_gps-335"><a href="#Analyzer.convert_addresses_to_gps-335"><span class="linenos">335</span></a>                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">load_data_file</span><span class="p">(</span><span class="n">file</span><span class="p">):</span>
</span><span id="Analyzer.convert_addresses_to_gps-336"><a href="#Analyzer.convert_addresses_to_gps-336"><span class="linenos">336</span></a>                        <span class="k">pass</span> <span class="c1"># valid data loaded</span>
</span><span id="Analyzer.convert_addresses_to_gps-337"><a href="#Analyzer.convert_addresses_to_gps-337"><span class="linenos">337</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="Analyzer.convert_addresses_to_gps-338"><a href="#Analyzer.convert_addresses_to_gps-338"><span class="linenos">338</span></a>                        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Errors loading address data from project.&quot;</span><span class="p">)</span>
</span><span id="Analyzer.convert_addresses_to_gps-339"><a href="#Analyzer.convert_addresses_to_gps-339"><span class="linenos">339</span></a>                        <span class="k">return</span> <span class="kc">False</span>
</span><span id="Analyzer.convert_addresses_to_gps-340"><a href="#Analyzer.convert_addresses_to_gps-340"><span class="linenos">340</span></a>                <span class="c1"># if the address data is already in the project, use it</span>
</span><span id="Analyzer.convert_addresses_to_gps-341"><a href="#Analyzer.convert_addresses_to_gps-341"><span class="linenos">341</span></a>                <span class="c1"># create the project data object to hold the gps data</span>
</span><span id="Analyzer.convert_addresses_to_gps-342"><a href="#Analyzer.convert_addresses_to_gps-342"><span class="linenos">342</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">start_dataframe</span><span class="p">(</span><span class="n">out</span><span class="p">[</span><span class="n">file</span><span class="p">])</span>
</span><span id="Analyzer.convert_addresses_to_gps-343"><a href="#Analyzer.convert_addresses_to_gps-343"><span class="linenos">343</span></a>                <span class="c1"># iterate through the address data and convert each address to gps lat long in the project data object</span>
</span><span id="Analyzer.convert_addresses_to_gps-344"><a href="#Analyzer.convert_addresses_to_gps-344"><span class="linenos">344</span></a>                <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">file</span><span class="p">]</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
</span><span id="Analyzer.convert_addresses_to_gps-345"><a href="#Analyzer.convert_addresses_to_gps-345"><span class="linenos">345</span></a>                    <span class="c1"># get the geocoded address lat and long</span>
</span><span id="Analyzer.convert_addresses_to_gps-346"><a href="#Analyzer.convert_addresses_to_gps-346"><span class="linenos">346</span></a>                    <span class="k">try</span><span class="p">:</span>
</span><span id="Analyzer.convert_addresses_to_gps-347"><a href="#Analyzer.convert_addresses_to_gps-347"><span class="linenos">347</span></a>                        <span class="k">if</span> <span class="n">log_csv</span><span class="p">:</span> 
</span><span id="Analyzer.convert_addresses_to_gps-348"><a href="#Analyzer.convert_addresses_to_gps-348"><span class="linenos">348</span></a>                            <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Geocoding address: &quot;</span><span class="o">+</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;address&quot;</span><span class="p">]</span><span class="o">+</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Analyzer.convert_addresses_to_gps-349"><a href="#Analyzer.convert_addresses_to_gps-349"><span class="linenos">349</span></a>                            <span class="n">log</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
</span><span id="Analyzer.convert_addresses_to_gps-350"><a href="#Analyzer.convert_addresses_to_gps-350"><span class="linenos">350</span></a>                            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Geocoding address: &quot;</span><span class="o">+</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;address&quot;</span><span class="p">]</span><span class="o">+</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Analyzer.convert_addresses_to_gps-351"><a href="#Analyzer.convert_addresses_to_gps-351"><span class="linenos">351</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">sleepif</span><span class="p">()</span>
</span><span id="Analyzer.convert_addresses_to_gps-352"><a href="#Analyzer.convert_addresses_to_gps-352"><span class="linenos">352</span></a>                        <span class="k">try</span><span class="p">:</span>
</span><span id="Analyzer.convert_addresses_to_gps-353"><a href="#Analyzer.convert_addresses_to_gps-353"><span class="linenos">353</span></a>                            <span class="n">latlong</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gAPI</span><span class="o">.</span><span class="n">geocode</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;address&quot;</span><span class="p">])</span>
</span><span id="Analyzer.convert_addresses_to_gps-354"><a href="#Analyzer.convert_addresses_to_gps-354"><span class="linenos">354</span></a>                        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="Analyzer.convert_addresses_to_gps-355"><a href="#Analyzer.convert_addresses_to_gps-355"><span class="linenos">355</span></a>                            <span class="c1"># if logging, write the exception event to the logfile</span>
</span><span id="Analyzer.convert_addresses_to_gps-356"><a href="#Analyzer.convert_addresses_to_gps-356"><span class="linenos">356</span></a>                            <span class="bp">self</span><span class="o">.</span><span class="n">log_error</span><span class="p">(</span><span class="s2">&quot;Exception calling geocode function: &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Analyzer.convert_addresses_to_gps-357"><a href="#Analyzer.convert_addresses_to_gps-357"><span class="linenos">357</span></a>                            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Exception calling geocode function: &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Analyzer.convert_addresses_to_gps-358"><a href="#Analyzer.convert_addresses_to_gps-358"><span class="linenos">358</span></a>                            <span class="c1"># if the excetion is a recoverable one, retry after a delay, else raise the exception</span>
</span><span id="Analyzer.convert_addresses_to_gps-359"><a href="#Analyzer.convert_addresses_to_gps-359"><span class="linenos">359</span></a>                            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">handle_GAPI_exception</span><span class="p">(</span><span class="n">e</span><span class="p">):</span>
</span><span id="Analyzer.convert_addresses_to_gps-360"><a href="#Analyzer.convert_addresses_to_gps-360"><span class="linenos">360</span></a>                                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;recoverable exception, waiting to retry once&quot;</span><span class="p">)</span>
</span><span id="Analyzer.convert_addresses_to_gps-361"><a href="#Analyzer.convert_addresses_to_gps-361"><span class="linenos">361</span></a>                                <span class="n">sleep</span><span class="p">(</span><span class="mi">10000</span><span class="p">)</span>
</span><span id="Analyzer.convert_addresses_to_gps-362"><a href="#Analyzer.convert_addresses_to_gps-362"><span class="linenos">362</span></a>                                <span class="k">try</span><span class="p">:</span>
</span><span id="Analyzer.convert_addresses_to_gps-363"><a href="#Analyzer.convert_addresses_to_gps-363"><span class="linenos">363</span></a>                                    <span class="n">latlong</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gAPI</span><span class="o">.</span><span class="n">geocode</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;address&quot;</span><span class="p">])</span>
</span><span id="Analyzer.convert_addresses_to_gps-364"><a href="#Analyzer.convert_addresses_to_gps-364"><span class="linenos">364</span></a>                                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="Analyzer.convert_addresses_to_gps-365"><a href="#Analyzer.convert_addresses_to_gps-365"><span class="linenos">365</span></a>                                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Unrecoverable exception, tried twice skipping address&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Analyzer.convert_addresses_to_gps-366"><a href="#Analyzer.convert_addresses_to_gps-366"><span class="linenos">366</span></a>                                    <span class="c1"># if logging, write the exception event to the logfile</span>
</span><span id="Analyzer.convert_addresses_to_gps-367"><a href="#Analyzer.convert_addresses_to_gps-367"><span class="linenos">367</span></a>                                    <span class="bp">self</span><span class="o">.</span><span class="n">log_error</span><span class="p">(</span><span class="s2">&quot;Recoverable error calling geocode function, failed twice. Deemed unrecoverable. Exception: &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Analyzer.convert_addresses_to_gps-368"><a href="#Analyzer.convert_addresses_to_gps-368"><span class="linenos">368</span></a>                                    <span class="n">e</span><span class="o">.</span><span class="n">add_note</span> <span class="o">=</span> <span class="s2">&quot;Recoverable error calling geocode function, failed twice. Deemed unrecoverable&quot;</span>
</span><span id="Analyzer.convert_addresses_to_gps-369"><a href="#Analyzer.convert_addresses_to_gps-369"><span class="linenos">369</span></a>                                    <span class="k">raise</span> <span class="n">e</span>
</span><span id="Analyzer.convert_addresses_to_gps-370"><a href="#Analyzer.convert_addresses_to_gps-370"><span class="linenos">370</span></a>                            <span class="k">else</span><span class="p">:</span>
</span><span id="Analyzer.convert_addresses_to_gps-371"><a href="#Analyzer.convert_addresses_to_gps-371"><span class="linenos">371</span></a>                                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Recoverable exception calling geocode, skipping address. </span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Analyzer.convert_addresses_to_gps-372"><a href="#Analyzer.convert_addresses_to_gps-372"><span class="linenos">372</span></a>                                <span class="bp">self</span><span class="o">.</span><span class="n">log_error</span><span class="p">(</span><span class="s2">&quot;Unrecoverable error calling geocode, failed once. Exception: &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Analyzer.convert_addresses_to_gps-373"><a href="#Analyzer.convert_addresses_to_gps-373"><span class="linenos">373</span></a>                                <span class="n">e</span><span class="o">.</span><span class="n">add_note</span> <span class="o">=</span> <span class="s2">&quot;Unrecoverable error calling geocode, failed once&quot;</span>
</span><span id="Analyzer.convert_addresses_to_gps-374"><a href="#Analyzer.convert_addresses_to_gps-374"><span class="linenos">374</span></a>                                <span class="k">raise</span> <span class="n">e</span>
</span><span id="Analyzer.convert_addresses_to_gps-375"><a href="#Analyzer.convert_addresses_to_gps-375"><span class="linenos">375</span></a>                            
</span><span id="Analyzer.convert_addresses_to_gps-376"><a href="#Analyzer.convert_addresses_to_gps-376"><span class="linenos">376</span></a>
</span><span id="Analyzer.convert_addresses_to_gps-377"><a href="#Analyzer.convert_addresses_to_gps-377"><span class="linenos">377</span></a>                        <span class="c1"># insert the lat and long into a new row in the project data object</span>
</span><span id="Analyzer.convert_addresses_to_gps-378"><a href="#Analyzer.convert_addresses_to_gps-378"><span class="linenos">378</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">out</span><span class="p">[</span><span class="n">file</span><span class="p">]]</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;address&quot;</span><span class="p">:</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;address&quot;</span><span class="p">],</span><span class="s2">&quot;latitude&quot;</span><span class="p">:</span> <span class="n">latlong</span><span class="p">[</span><span class="s1">&#39;lat&#39;</span><span class="p">],</span> <span class="s2">&quot;longitude&quot;</span><span class="p">:</span> <span class="n">latlong</span><span class="p">[</span><span class="s1">&#39;lng&#39;</span><span class="p">]}</span>
</span><span id="Analyzer.convert_addresses_to_gps-379"><a href="#Analyzer.convert_addresses_to_gps-379"><span class="linenos">379</span></a>                    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="Analyzer.convert_addresses_to_gps-380"><a href="#Analyzer.convert_addresses_to_gps-380"><span class="linenos">380</span></a>                        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Error saving geocode address result: &quot;</span><span class="o">+</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;address&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> Got exception: &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
</span><span id="Analyzer.convert_addresses_to_gps-381"><a href="#Analyzer.convert_addresses_to_gps-381"><span class="linenos">381</span></a>                        <span class="k">if</span> <span class="n">log_csv</span><span class="p">:</span> <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Error saving geocode result address: &quot;</span><span class="o">+</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;address&quot;</span><span class="p">]</span><span class="o">+</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Analyzer.convert_addresses_to_gps-382"><a href="#Analyzer.convert_addresses_to_gps-382"><span class="linenos">382</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">log_error</span><span class="p">(</span><span class="s2">&quot;Error saving geocode result address: &quot;</span><span class="o">+</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;address&quot;</span><span class="p">]</span><span class="o">+</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;Got exception: &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
</span><span id="Analyzer.convert_addresses_to_gps-383"><a href="#Analyzer.convert_addresses_to_gps-383"><span class="linenos">383</span></a>                        <span class="k">raise</span> <span class="n">e</span>
</span><span id="Analyzer.convert_addresses_to_gps-384"><a href="#Analyzer.convert_addresses_to_gps-384"><span class="linenos">384</span></a>                                            
</span><span id="Analyzer.convert_addresses_to_gps-385"><a href="#Analyzer.convert_addresses_to_gps-385"><span class="linenos">385</span></a>                <span class="c1"># save the project data object to the csv file</span>
</span><span id="Analyzer.convert_addresses_to_gps-386"><a href="#Analyzer.convert_addresses_to_gps-386"><span class="linenos">386</span></a>                <span class="k">if</span> <span class="n">file</span> <span class="o">==</span> <span class="s2">&quot;employee_addresses.csv&quot;</span><span class="p">:</span>
</span><span id="Analyzer.convert_addresses_to_gps-387"><a href="#Analyzer.convert_addresses_to_gps-387"><span class="linenos">387</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">save_data_file</span><span class="p">(</span><span class="n">out</span><span class="p">[</span><span class="n">file</span><span class="p">])</span>
</span><span id="Analyzer.convert_addresses_to_gps-388"><a href="#Analyzer.convert_addresses_to_gps-388"><span class="linenos">388</span></a>                <span class="k">elif</span> <span class="n">file</span> <span class="o">==</span> <span class="s2">&quot;office_addresses.csv&quot;</span><span class="p">:</span>
</span><span id="Analyzer.convert_addresses_to_gps-389"><a href="#Analyzer.convert_addresses_to_gps-389"><span class="linenos">389</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">save_data_file</span><span class="p">(</span><span class="n">out</span><span class="p">[</span><span class="n">file</span><span class="p">])</span>
</span><span id="Analyzer.convert_addresses_to_gps-390"><a href="#Analyzer.convert_addresses_to_gps-390"><span class="linenos">390</span></a>                <span class="c1"># update the analysis phase</span>
</span><span id="Analyzer.convert_addresses_to_gps-391"><a href="#Analyzer.convert_addresses_to_gps-391"><span class="linenos">391</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">update_analysis_phase</span><span class="p">()</span>
</span><span id="Analyzer.convert_addresses_to_gps-392"><a href="#Analyzer.convert_addresses_to_gps-392"><span class="linenos">392</span></a>                <span class="k">if</span> <span class="n">log_csv</span><span class="p">:</span> <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Geocoding complete</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Analyzer.convert_addresses_to_gps-393"><a href="#Analyzer.convert_addresses_to_gps-393"><span class="linenos">393</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Analyzer.convert_addresses_to_gps-394"><a href="#Analyzer.convert_addresses_to_gps-394"><span class="linenos">394</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Address data &quot;</span><span class="o">+</span><span class="n">file</span><span class="o">+</span><span class="s2">&quot; missing from project.&quot;</span><span class="p">)</span>
</span><span id="Analyzer.convert_addresses_to_gps-395"><a href="#Analyzer.convert_addresses_to_gps-395"><span class="linenos">395</span></a>                <span class="k">return</span> <span class="kc">False</span>   
</span><span id="Analyzer.convert_addresses_to_gps-396"><a href="#Analyzer.convert_addresses_to_gps-396"><span class="linenos">396</span></a>        <span class="k">if</span> <span class="n">log_csv</span><span class="p">:</span> <span class="n">log</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>             
</span><span id="Analyzer.convert_addresses_to_gps-397"><a href="#Analyzer.convert_addresses_to_gps-397"><span class="linenos">397</span></a>        <span class="k">return</span> <span class="kc">True</span>
</span></pre></div>


            <div class="docstring"><p>Converts addresses from specified CSV files to GPS coordinates using the Google Maps API.</p>

<p>This method processes both employee and office address data, converting each address to latitude and longitude coordinates. 
The results are saved to corresponding GPS data files. If logging is enabled, the process details are recorded in a specified log CSV file.</p>

<p>Args:
    force (bool, optional): If True, forces re-conversion of addresses even if GPS data already exists. Defaults to False.
    log_csv (str, optional): Path to a log CSV file where operation details are recorded. Defaults to None.</p>

<p>Returns:
    bool: True if the conversion process is completed successfully for all addresses; False otherwise.</p>

<p>This method handles geocoding of addresses using the Google Maps API, respecting API rate limits
and optionally logging the process. If <code>force</code> is True, existing GPS data is ignored, and addresses are re-geocoded.</p>
</div>


                            </div>
                            <div id="Analyzer.fuzz_employee_gps" class="classattr">
                                        <input id="Analyzer.fuzz_employee_gps-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">fuzz_employee_gps</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">force</span><span class="o">=</span><span class="kc">False</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Analyzer.fuzz_employee_gps-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Analyzer.fuzz_employee_gps"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Analyzer.fuzz_employee_gps-399"><a href="#Analyzer.fuzz_employee_gps-399"><span class="linenos">399</span></a>    <span class="k">def</span> <span class="nf">fuzz_employee_gps</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="Analyzer.fuzz_employee_gps-400"><a href="#Analyzer.fuzz_employee_gps-400"><span class="linenos">400</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Analyzer.fuzz_employee_gps-401"><a href="#Analyzer.fuzz_employee_gps-401"><span class="linenos">401</span></a><span class="sd">        Applies a fuzzing process to employee GPS coordinates to anonymize locations.</span>
</span><span id="Analyzer.fuzz_employee_gps-402"><a href="#Analyzer.fuzz_employee_gps-402"><span class="linenos">402</span></a>
</span><span id="Analyzer.fuzz_employee_gps-403"><a href="#Analyzer.fuzz_employee_gps-403"><span class="linenos">403</span></a><span class="sd">        This method adds a small, random displacement to the latitude and longitude of employee addresses. </span>
</span><span id="Analyzer.fuzz_employee_gps-404"><a href="#Analyzer.fuzz_employee_gps-404"><span class="linenos">404</span></a><span class="sd">        This process is intended to protect privacy by preventing the exact identification of employee home locations.</span>
</span><span id="Analyzer.fuzz_employee_gps-405"><a href="#Analyzer.fuzz_employee_gps-405"><span class="linenos">405</span></a>
</span><span id="Analyzer.fuzz_employee_gps-406"><a href="#Analyzer.fuzz_employee_gps-406"><span class="linenos">406</span></a><span class="sd">        Args:</span>
</span><span id="Analyzer.fuzz_employee_gps-407"><a href="#Analyzer.fuzz_employee_gps-407"><span class="linenos">407</span></a><span class="sd">            force (bool, optional): If True, forces re-fuzzing of GPS coordinates even if fuzzed data already exists. Defaults to False.</span>
</span><span id="Analyzer.fuzz_employee_gps-408"><a href="#Analyzer.fuzz_employee_gps-408"><span class="linenos">408</span></a>
</span><span id="Analyzer.fuzz_employee_gps-409"><a href="#Analyzer.fuzz_employee_gps-409"><span class="linenos">409</span></a><span class="sd">        Returns:</span>
</span><span id="Analyzer.fuzz_employee_gps-410"><a href="#Analyzer.fuzz_employee_gps-410"><span class="linenos">410</span></a><span class="sd">            bool: True if fuzzing is successfully applied to all employee GPS coordinates; False otherwise.</span>
</span><span id="Analyzer.fuzz_employee_gps-411"><a href="#Analyzer.fuzz_employee_gps-411"><span class="linenos">411</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Analyzer.fuzz_employee_gps-412"><a href="#Analyzer.fuzz_employee_gps-412"><span class="linenos">412</span></a>        <span class="c1"># if the google API object doesn&#39;t exist, create it</span>
</span><span id="Analyzer.fuzz_employee_gps-413"><a href="#Analyzer.fuzz_employee_gps-413"><span class="linenos">413</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">gAPI</span><span class="p">:</span>
</span><span id="Analyzer.fuzz_employee_gps-414"><a href="#Analyzer.fuzz_employee_gps-414"><span class="linenos">414</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">gAPI</span> <span class="o">=</span> <span class="n">GAPI</span><span class="p">()</span>
</span><span id="Analyzer.fuzz_employee_gps-415"><a href="#Analyzer.fuzz_employee_gps-415"><span class="linenos">415</span></a>        <span class="c1"># add a small amount of fuzz to the employee gps coordinates</span>
</span><span id="Analyzer.fuzz_employee_gps-416"><a href="#Analyzer.fuzz_employee_gps-416"><span class="linenos">416</span></a>        <span class="c1"># if the gps data isn&#39;t already in the project, load it</span>
</span><span id="Analyzer.fuzz_employee_gps-417"><a href="#Analyzer.fuzz_employee_gps-417"><span class="linenos">417</span></a>        <span class="k">if</span> <span class="s2">&quot;employee_gps.csv&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">list_data_files</span><span class="p">():</span>
</span><span id="Analyzer.fuzz_employee_gps-418"><a href="#Analyzer.fuzz_employee_gps-418"><span class="linenos">418</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;employee_gps.csv&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">force</span><span class="p">:</span>
</span><span id="Analyzer.fuzz_employee_gps-419"><a href="#Analyzer.fuzz_employee_gps-419"><span class="linenos">419</span></a>                <span class="c1"># attempt to load the gps data</span>
</span><span id="Analyzer.fuzz_employee_gps-420"><a href="#Analyzer.fuzz_employee_gps-420"><span class="linenos">420</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">load_data_file</span><span class="p">(</span><span class="s2">&quot;employee_gps.csv&quot;</span><span class="p">):</span>
</span><span id="Analyzer.fuzz_employee_gps-421"><a href="#Analyzer.fuzz_employee_gps-421"><span class="linenos">421</span></a>                    <span class="k">pass</span>
</span><span id="Analyzer.fuzz_employee_gps-422"><a href="#Analyzer.fuzz_employee_gps-422"><span class="linenos">422</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="Analyzer.fuzz_employee_gps-423"><a href="#Analyzer.fuzz_employee_gps-423"><span class="linenos">423</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Errors loading gps data from project.&quot;</span><span class="p">)</span>
</span><span id="Analyzer.fuzz_employee_gps-424"><a href="#Analyzer.fuzz_employee_gps-424"><span class="linenos">424</span></a>                    <span class="k">return</span> <span class="kc">False</span>
</span><span id="Analyzer.fuzz_employee_gps-425"><a href="#Analyzer.fuzz_employee_gps-425"><span class="linenos">425</span></a>            <span class="c1"># if the gps data is already in the project, use it</span>
</span><span id="Analyzer.fuzz_employee_gps-426"><a href="#Analyzer.fuzz_employee_gps-426"><span class="linenos">426</span></a>            <span class="c1"># create the project data object to hold the fuzzed gps data</span>
</span><span id="Analyzer.fuzz_employee_gps-427"><a href="#Analyzer.fuzz_employee_gps-427"><span class="linenos">427</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">start_dataframe</span><span class="p">(</span><span class="s2">&quot;gps_fuzz.csv&quot;</span><span class="p">)</span>
</span><span id="Analyzer.fuzz_employee_gps-428"><a href="#Analyzer.fuzz_employee_gps-428"><span class="linenos">428</span></a>            <span class="c1"># iterate through the gps data and fuzz each set of coordinates</span>
</span><span id="Analyzer.fuzz_employee_gps-429"><a href="#Analyzer.fuzz_employee_gps-429"><span class="linenos">429</span></a>            <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;employee_gps.csv&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
</span><span id="Analyzer.fuzz_employee_gps-430"><a href="#Analyzer.fuzz_employee_gps-430"><span class="linenos">430</span></a>                <span class="c1"># fuzz the lat and long</span>
</span><span id="Analyzer.fuzz_employee_gps-431"><a href="#Analyzer.fuzz_employee_gps-431"><span class="linenos">431</span></a>                <span class="n">latlong</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gAPI</span><span class="o">.</span><span class="n">fuzz_latlong</span><span class="p">({</span><span class="s2">&quot;lat&quot;</span><span class="p">:</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;latitude&quot;</span><span class="p">],</span> <span class="s2">&quot;lng&quot;</span><span class="p">:</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;longitude&quot;</span><span class="p">]},</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">gps_fuzz_factor</span><span class="p">)</span>
</span><span id="Analyzer.fuzz_employee_gps-432"><a href="#Analyzer.fuzz_employee_gps-432"><span class="linenos">432</span></a>                <span class="c1"># insert the fuzzed lat and long into a new row in the project data object</span>
</span><span id="Analyzer.fuzz_employee_gps-433"><a href="#Analyzer.fuzz_employee_gps-433"><span class="linenos">433</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;gps_fuzz.csv&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;latitude&quot;</span><span class="p">:</span> <span class="n">latlong</span><span class="p">[</span><span class="s1">&#39;lat&#39;</span><span class="p">],</span> <span class="s2">&quot;longitude&quot;</span><span class="p">:</span> <span class="n">latlong</span><span class="p">[</span><span class="s1">&#39;lng&#39;</span><span class="p">]}</span>
</span><span id="Analyzer.fuzz_employee_gps-434"><a href="#Analyzer.fuzz_employee_gps-434"><span class="linenos">434</span></a>            <span class="c1"># save the project data object to the csv file</span>
</span><span id="Analyzer.fuzz_employee_gps-435"><a href="#Analyzer.fuzz_employee_gps-435"><span class="linenos">435</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">save_data_file</span><span class="p">(</span><span class="s2">&quot;gps_fuzz.csv&quot;</span><span class="p">)</span>
</span><span id="Analyzer.fuzz_employee_gps-436"><a href="#Analyzer.fuzz_employee_gps-436"><span class="linenos">436</span></a>            <span class="c1"># update the analysis phase</span>
</span><span id="Analyzer.fuzz_employee_gps-437"><a href="#Analyzer.fuzz_employee_gps-437"><span class="linenos">437</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">update_analysis_phase</span><span class="p">()</span>
</span><span id="Analyzer.fuzz_employee_gps-438"><a href="#Analyzer.fuzz_employee_gps-438"><span class="linenos">438</span></a>        <span class="k">else</span><span class="p">:</span>    
</span><span id="Analyzer.fuzz_employee_gps-439"><a href="#Analyzer.fuzz_employee_gps-439"><span class="linenos">439</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;GPS data missing from project.&quot;</span><span class="p">)</span>
</span><span id="Analyzer.fuzz_employee_gps-440"><a href="#Analyzer.fuzz_employee_gps-440"><span class="linenos">440</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span></pre></div>


            <div class="docstring"><p>Applies a fuzzing process to employee GPS coordinates to anonymize locations.</p>

<p>This method adds a small, random displacement to the latitude and longitude of employee addresses. 
This process is intended to protect privacy by preventing the exact identification of employee home locations.</p>

<p>Args:
    force (bool, optional): If True, forces re-fuzzing of GPS coordinates even if fuzzed data already exists. Defaults to False.</p>

<p>Returns:
    bool: True if fuzzing is successfully applied to all employee GPS coordinates; False otherwise.</p>
</div>


                            </div>
                            <div id="Analyzer.get_commute_data" class="classattr">
                                        <input id="Analyzer.get_commute_data-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_commute_data</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">force</span><span class="o">=</span><span class="kc">False</span>, </span><span class="param"><span class="n">log_csv</span><span class="o">=</span><span class="kc">None</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Analyzer.get_commute_data-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Analyzer.get_commute_data"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Analyzer.get_commute_data-442"><a href="#Analyzer.get_commute_data-442"><span class="linenos">442</span></a>    <span class="k">def</span> <span class="nf">get_commute_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">log_csv</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="Analyzer.get_commute_data-443"><a href="#Analyzer.get_commute_data-443"><span class="linenos">443</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Analyzer.get_commute_data-444"><a href="#Analyzer.get_commute_data-444"><span class="linenos">444</span></a><span class="sd">        Generates commute data for employees based on their GPS coordinates and the office locations.</span>
</span><span id="Analyzer.get_commute_data-445"><a href="#Analyzer.get_commute_data-445"><span class="linenos">445</span></a>
</span><span id="Analyzer.get_commute_data-446"><a href="#Analyzer.get_commute_data-446"><span class="linenos">446</span></a><span class="sd">        This method calculates commute times and distances from employees&#39; locations to the office, accounting for specified commute times. </span>
</span><span id="Analyzer.get_commute_data-447"><a href="#Analyzer.get_commute_data-447"><span class="linenos">447</span></a><span class="sd">        Optionally logs the operation details if a log CSV file path is provided.</span>
</span><span id="Analyzer.get_commute_data-448"><a href="#Analyzer.get_commute_data-448"><span class="linenos">448</span></a>
</span><span id="Analyzer.get_commute_data-449"><a href="#Analyzer.get_commute_data-449"><span class="linenos">449</span></a><span class="sd">        Args:</span>
</span><span id="Analyzer.get_commute_data-450"><a href="#Analyzer.get_commute_data-450"><span class="linenos">450</span></a><span class="sd">            force (bool, optional): If True, forces regeneration of commute data even if it already exists. Defaults to False.</span>
</span><span id="Analyzer.get_commute_data-451"><a href="#Analyzer.get_commute_data-451"><span class="linenos">451</span></a><span class="sd">            log_csv (str, optional): Path to a log CSV file where operation details are recorded. Defaults to None.</span>
</span><span id="Analyzer.get_commute_data-452"><a href="#Analyzer.get_commute_data-452"><span class="linenos">452</span></a>
</span><span id="Analyzer.get_commute_data-453"><a href="#Analyzer.get_commute_data-453"><span class="linenos">453</span></a><span class="sd">        Returns:</span>
</span><span id="Analyzer.get_commute_data-454"><a href="#Analyzer.get_commute_data-454"><span class="linenos">454</span></a><span class="sd">            bool: True if commute data is successfully generated; False otherwise.</span>
</span><span id="Analyzer.get_commute_data-455"><a href="#Analyzer.get_commute_data-455"><span class="linenos">455</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Analyzer.get_commute_data-456"><a href="#Analyzer.get_commute_data-456"><span class="linenos">456</span></a>
</span><span id="Analyzer.get_commute_data-457"><a href="#Analyzer.get_commute_data-457"><span class="linenos">457</span></a>        <span class="c1"># if the use fuzzed data flag is set, use the fuzzed data, otherwise use the original data</span>
</span><span id="Analyzer.get_commute_data-458"><a href="#Analyzer.get_commute_data-458"><span class="linenos">458</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">use_gps_fuzzing</span><span class="o">==</span><span class="kc">True</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">use_gps_fuzzing</span><span class="o">==</span><span class="s2">&quot;True&quot;</span><span class="p">:</span>
</span><span id="Analyzer.get_commute_data-459"><a href="#Analyzer.get_commute_data-459"><span class="linenos">459</span></a>            <span class="c1"># if the fuzzed gps data isn&#39;t already in the project, load it</span>
</span><span id="Analyzer.get_commute_data-460"><a href="#Analyzer.get_commute_data-460"><span class="linenos">460</span></a>            <span class="k">if</span> <span class="s2">&quot;gps_fuzz.csv&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">list_data_files</span><span class="p">():</span>
</span><span id="Analyzer.get_commute_data-461"><a href="#Analyzer.get_commute_data-461"><span class="linenos">461</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;gps_fuzz.csv&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">force</span><span class="p">:</span>
</span><span id="Analyzer.get_commute_data-462"><a href="#Analyzer.get_commute_data-462"><span class="linenos">462</span></a>                    <span class="c1"># attempt to load the fuzzed gps data</span>
</span><span id="Analyzer.get_commute_data-463"><a href="#Analyzer.get_commute_data-463"><span class="linenos">463</span></a>                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">load_data_file</span><span class="p">(</span><span class="s2">&quot;gps_fuzz.csv&quot;</span><span class="p">):</span>
</span><span id="Analyzer.get_commute_data-464"><a href="#Analyzer.get_commute_data-464"><span class="linenos">464</span></a>                        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Using fuzzed GPS data.&quot;</span><span class="p">)</span>
</span><span id="Analyzer.get_commute_data-465"><a href="#Analyzer.get_commute_data-465"><span class="linenos">465</span></a>                        <span class="k">pass</span>
</span><span id="Analyzer.get_commute_data-466"><a href="#Analyzer.get_commute_data-466"><span class="linenos">466</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="Analyzer.get_commute_data-467"><a href="#Analyzer.get_commute_data-467"><span class="linenos">467</span></a>                        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Errors loading fuzzed gps data from project.&quot;</span><span class="p">)</span>
</span><span id="Analyzer.get_commute_data-468"><a href="#Analyzer.get_commute_data-468"><span class="linenos">468</span></a>                        <span class="k">return</span> <span class="kc">False</span>
</span><span id="Analyzer.get_commute_data-469"><a href="#Analyzer.get_commute_data-469"><span class="linenos">469</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Analyzer.get_commute_data-470"><a href="#Analyzer.get_commute_data-470"><span class="linenos">470</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Fuzzed GPS data missing from project.&quot;</span><span class="p">)</span>
</span><span id="Analyzer.get_commute_data-471"><a href="#Analyzer.get_commute_data-471"><span class="linenos">471</span></a>                <span class="k">return</span> <span class="kc">False</span>
</span><span id="Analyzer.get_commute_data-472"><a href="#Analyzer.get_commute_data-472"><span class="linenos">472</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Analyzer.get_commute_data-473"><a href="#Analyzer.get_commute_data-473"><span class="linenos">473</span></a>            <span class="c1"># use the un fuzzed data</span>
</span><span id="Analyzer.get_commute_data-474"><a href="#Analyzer.get_commute_data-474"><span class="linenos">474</span></a>            <span class="c1"># if the gps data isn&#39;t already in the project, load it</span>
</span><span id="Analyzer.get_commute_data-475"><a href="#Analyzer.get_commute_data-475"><span class="linenos">475</span></a>            <span class="k">if</span> <span class="s2">&quot;employee_gps.csv&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">list_data_files</span><span class="p">():</span>
</span><span id="Analyzer.get_commute_data-476"><a href="#Analyzer.get_commute_data-476"><span class="linenos">476</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;employee_gps.csv&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">force</span><span class="p">:</span>
</span><span id="Analyzer.get_commute_data-477"><a href="#Analyzer.get_commute_data-477"><span class="linenos">477</span></a>                    <span class="c1"># attempt to load the gps data</span>
</span><span id="Analyzer.get_commute_data-478"><a href="#Analyzer.get_commute_data-478"><span class="linenos">478</span></a>                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">load_data_file</span><span class="p">(</span><span class="s2">&quot;employee_gps.csv&quot;</span><span class="p">):</span>
</span><span id="Analyzer.get_commute_data-479"><a href="#Analyzer.get_commute_data-479"><span class="linenos">479</span></a>                        <span class="k">pass</span>
</span><span id="Analyzer.get_commute_data-480"><a href="#Analyzer.get_commute_data-480"><span class="linenos">480</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="Analyzer.get_commute_data-481"><a href="#Analyzer.get_commute_data-481"><span class="linenos">481</span></a>                        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Errors loading gps data from project.&quot;</span><span class="p">)</span>
</span><span id="Analyzer.get_commute_data-482"><a href="#Analyzer.get_commute_data-482"><span class="linenos">482</span></a>                        <span class="k">return</span> <span class="kc">False</span>
</span><span id="Analyzer.get_commute_data-483"><a href="#Analyzer.get_commute_data-483"><span class="linenos">483</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="Analyzer.get_commute_data-484"><a href="#Analyzer.get_commute_data-484"><span class="linenos">484</span></a>                    <span class="k">pass</span>
</span><span id="Analyzer.get_commute_data-485"><a href="#Analyzer.get_commute_data-485"><span class="linenos">485</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Analyzer.get_commute_data-486"><a href="#Analyzer.get_commute_data-486"><span class="linenos">486</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;GPS data missing from project.&quot;</span><span class="p">)</span>
</span><span id="Analyzer.get_commute_data-487"><a href="#Analyzer.get_commute_data-487"><span class="linenos">487</span></a>                <span class="k">return</span> <span class="kc">False</span>
</span><span id="Analyzer.get_commute_data-488"><a href="#Analyzer.get_commute_data-488"><span class="linenos">488</span></a>        <span class="c1"># attempt to load the office gps data</span>
</span><span id="Analyzer.get_commute_data-489"><a href="#Analyzer.get_commute_data-489"><span class="linenos">489</span></a>        <span class="k">if</span> <span class="s2">&quot;office_gps.csv&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">list_data_files</span><span class="p">():</span>
</span><span id="Analyzer.get_commute_data-490"><a href="#Analyzer.get_commute_data-490"><span class="linenos">490</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;office_gps.csv&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">force</span><span class="p">:</span>
</span><span id="Analyzer.get_commute_data-491"><a href="#Analyzer.get_commute_data-491"><span class="linenos">491</span></a>                <span class="c1"># attempt to load the office gps data</span>
</span><span id="Analyzer.get_commute_data-492"><a href="#Analyzer.get_commute_data-492"><span class="linenos">492</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">load_data_file</span><span class="p">(</span><span class="s2">&quot;office_gps.csv&quot;</span><span class="p">):</span>
</span><span id="Analyzer.get_commute_data-493"><a href="#Analyzer.get_commute_data-493"><span class="linenos">493</span></a>                    <span class="k">pass</span>
</span><span id="Analyzer.get_commute_data-494"><a href="#Analyzer.get_commute_data-494"><span class="linenos">494</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="Analyzer.get_commute_data-495"><a href="#Analyzer.get_commute_data-495"><span class="linenos">495</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Errors loading office gps data from project.&quot;</span><span class="p">)</span>
</span><span id="Analyzer.get_commute_data-496"><a href="#Analyzer.get_commute_data-496"><span class="linenos">496</span></a>                    <span class="k">return</span> <span class="kc">False</span>
</span><span id="Analyzer.get_commute_data-497"><a href="#Analyzer.get_commute_data-497"><span class="linenos">497</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Analyzer.get_commute_data-498"><a href="#Analyzer.get_commute_data-498"><span class="linenos">498</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Office GPS data missing from project.&quot;</span><span class="p">)</span>
</span><span id="Analyzer.get_commute_data-499"><a href="#Analyzer.get_commute_data-499"><span class="linenos">499</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="Analyzer.get_commute_data-500"><a href="#Analyzer.get_commute_data-500"><span class="linenos">500</span></a>        
</span><span id="Analyzer.get_commute_data-501"><a href="#Analyzer.get_commute_data-501"><span class="linenos">501</span></a>        <span class="c1"># touch the logfile to lock</span>
</span><span id="Analyzer.get_commute_data-502"><a href="#Analyzer.get_commute_data-502"><span class="linenos">502</span></a>        <span class="k">if</span> <span class="n">log_csv</span><span class="p">:</span>
</span><span id="Analyzer.get_commute_data-503"><a href="#Analyzer.get_commute_data-503"><span class="linenos">503</span></a>            <span class="n">log</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">log_csv</span><span class="p">,</span> <span class="s2">&quot;a+&quot;</span><span class="p">)</span>
</span><span id="Analyzer.get_commute_data-504"><a href="#Analyzer.get_commute_data-504"><span class="linenos">504</span></a>            <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Beginning the generation of commute data</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Analyzer.get_commute_data-505"><a href="#Analyzer.get_commute_data-505"><span class="linenos">505</span></a>            <span class="n">log</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
</span><span id="Analyzer.get_commute_data-506"><a href="#Analyzer.get_commute_data-506"><span class="linenos">506</span></a>        <span class="c1"># if the google API object doesn&#39;t exist, create it</span>
</span><span id="Analyzer.get_commute_data-507"><a href="#Analyzer.get_commute_data-507"><span class="linenos">507</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">gAPI</span><span class="p">:</span>
</span><span id="Analyzer.get_commute_data-508"><a href="#Analyzer.get_commute_data-508"><span class="linenos">508</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">gAPI</span> <span class="o">=</span> <span class="n">GAPI</span><span class="p">()</span>
</span><span id="Analyzer.get_commute_data-509"><a href="#Analyzer.get_commute_data-509"><span class="linenos">509</span></a>        <span class="c1"># create a new dataframe to hold the commute data</span>
</span><span id="Analyzer.get_commute_data-510"><a href="#Analyzer.get_commute_data-510"><span class="linenos">510</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">start_dataframe</span><span class="p">(</span><span class="s2">&quot;commute_data.csv&quot;</span><span class="p">)</span>
</span><span id="Analyzer.get_commute_data-511"><a href="#Analyzer.get_commute_data-511"><span class="linenos">511</span></a>        <span class="c1"># create preparatory helper variables</span>
</span><span id="Analyzer.get_commute_data-512"><a href="#Analyzer.get_commute_data-512"><span class="linenos">512</span></a>        <span class="c1"># create datetime objects for the morning commute times</span>
</span><span id="Analyzer.get_commute_data-513"><a href="#Analyzer.get_commute_data-513"><span class="linenos">513</span></a>        <span class="n">morning_departure</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">morning_commute_start</span><span class="p">,</span> <span class="s2">&quot;%H:%M&quot;</span><span class="p">)</span>
</span><span id="Analyzer.get_commute_data-514"><a href="#Analyzer.get_commute_data-514"><span class="linenos">514</span></a>        <span class="n">evening_departure</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">evening_commute_start</span><span class="p">,</span> <span class="s2">&quot;%H:%M&quot;</span><span class="p">)</span>
</span><span id="Analyzer.get_commute_data-515"><a href="#Analyzer.get_commute_data-515"><span class="linenos">515</span></a>        <span class="n">days</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;m&quot;</span><span class="p">,</span><span class="s2">&quot;t&quot;</span><span class="p">,</span><span class="s2">&quot;w&quot;</span><span class="p">,</span><span class="s2">&quot;h&quot;</span><span class="p">,</span><span class="s2">&quot;f&quot;</span><span class="p">]</span>
</span><span id="Analyzer.get_commute_data-516"><a href="#Analyzer.get_commute_data-516"><span class="linenos">516</span></a>        <span class="n">times</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;morning&quot;</span><span class="p">,</span><span class="s2">&quot;evening&quot;</span><span class="p">]</span>
</span><span id="Analyzer.get_commute_data-517"><a href="#Analyzer.get_commute_data-517"><span class="linenos">517</span></a>        <span class="n">values</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;duration_in_traffic&quot;</span><span class="p">]</span>
</span><span id="Analyzer.get_commute_data-518"><a href="#Analyzer.get_commute_data-518"><span class="linenos">518</span></a>        <span class="c1"># get today&#39;s data and calculate days until NEXT monday</span>
</span><span id="Analyzer.get_commute_data-519"><a href="#Analyzer.get_commute_data-519"><span class="linenos">519</span></a>        <span class="n">today</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">today</span><span class="p">()</span>
</span><span id="Analyzer.get_commute_data-520"><a href="#Analyzer.get_commute_data-520"><span class="linenos">520</span></a>        <span class="n">days_until_monday</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="o">-</span><span class="n">today</span><span class="o">.</span><span class="n">weekday</span><span class="p">())</span> <span class="o">%</span> <span class="mi">7</span>
</span><span id="Analyzer.get_commute_data-521"><a href="#Analyzer.get_commute_data-521"><span class="linenos">521</span></a>        <span class="k">if</span> <span class="n">days_until_monday</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> <span class="c1"># today is a monday, we want the next one</span>
</span><span id="Analyzer.get_commute_data-522"><a href="#Analyzer.get_commute_data-522"><span class="linenos">522</span></a>            <span class="c1"># get the date of next monday</span>
</span><span id="Analyzer.get_commute_data-523"><a href="#Analyzer.get_commute_data-523"><span class="linenos">523</span></a>            <span class="n">days_until_monday</span> <span class="o">=</span> <span class="mi">7</span>
</span><span id="Analyzer.get_commute_data-524"><a href="#Analyzer.get_commute_data-524"><span class="linenos">524</span></a>        <span class="c1"># get the calendar date seven days from today</span>
</span><span id="Analyzer.get_commute_data-525"><a href="#Analyzer.get_commute_data-525"><span class="linenos">525</span></a>        <span class="n">next_monday</span> <span class="o">=</span> <span class="n">today</span> <span class="o">+</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="n">days_until_monday</span><span class="p">)</span>
</span><span id="Analyzer.get_commute_data-526"><a href="#Analyzer.get_commute_data-526"><span class="linenos">526</span></a>        <span class="c1">#next_monday = today.replace(day=today.day+days_until_monday)</span>
</span><span id="Analyzer.get_commute_data-527"><a href="#Analyzer.get_commute_data-527"><span class="linenos">527</span></a>        <span class="c1"># based off of next_monday, create morning and evening date time objects for commute departure times in project attributes</span>
</span><span id="Analyzer.get_commute_data-528"><a href="#Analyzer.get_commute_data-528"><span class="linenos">528</span></a>        <span class="n">commutes</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;m_morning&#39;</span><span class="p">:</span><span class="n">datetime</span><span class="o">.</span><span class="n">combine</span><span class="p">(</span><span class="n">next_monday</span><span class="p">,</span> <span class="n">morning_departure</span><span class="o">.</span><span class="n">time</span><span class="p">()),</span>
</span><span id="Analyzer.get_commute_data-529"><a href="#Analyzer.get_commute_data-529"><span class="linenos">529</span></a>                    <span class="s1">&#39;m_evening&#39;</span><span class="p">:</span><span class="n">datetime</span><span class="o">.</span><span class="n">combine</span><span class="p">(</span><span class="n">next_monday</span><span class="p">,</span> <span class="n">evening_departure</span><span class="o">.</span><span class="n">time</span><span class="p">()),</span>
</span><span id="Analyzer.get_commute_data-530"><a href="#Analyzer.get_commute_data-530"><span class="linenos">530</span></a>                    <span class="s1">&#39;t_morning&#39;</span><span class="p">:</span><span class="n">datetime</span><span class="o">.</span><span class="n">combine</span><span class="p">(</span><span class="n">next_monday</span><span class="o">+</span><span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span> <span class="n">morning_departure</span><span class="o">.</span><span class="n">time</span><span class="p">()),</span>
</span><span id="Analyzer.get_commute_data-531"><a href="#Analyzer.get_commute_data-531"><span class="linenos">531</span></a>                    <span class="s1">&#39;t_evening&#39;</span><span class="p">:</span><span class="n">datetime</span><span class="o">.</span><span class="n">combine</span><span class="p">(</span><span class="n">next_monday</span><span class="o">+</span><span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span> <span class="n">evening_departure</span><span class="o">.</span><span class="n">time</span><span class="p">()),</span>
</span><span id="Analyzer.get_commute_data-532"><a href="#Analyzer.get_commute_data-532"><span class="linenos">532</span></a>                    <span class="s1">&#39;w_morning&#39;</span><span class="p">:</span><span class="n">datetime</span><span class="o">.</span><span class="n">combine</span><span class="p">(</span><span class="n">next_monday</span><span class="o">+</span><span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">2</span><span class="p">),</span> <span class="n">morning_departure</span><span class="o">.</span><span class="n">time</span><span class="p">()),</span>
</span><span id="Analyzer.get_commute_data-533"><a href="#Analyzer.get_commute_data-533"><span class="linenos">533</span></a>                    <span class="s1">&#39;w_evening&#39;</span><span class="p">:</span><span class="n">datetime</span><span class="o">.</span><span class="n">combine</span><span class="p">(</span><span class="n">next_monday</span><span class="o">+</span><span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">2</span><span class="p">),</span> <span class="n">evening_departure</span><span class="o">.</span><span class="n">time</span><span class="p">()),</span>
</span><span id="Analyzer.get_commute_data-534"><a href="#Analyzer.get_commute_data-534"><span class="linenos">534</span></a>                    <span class="s1">&#39;h_morning&#39;</span><span class="p">:</span><span class="n">datetime</span><span class="o">.</span><span class="n">combine</span><span class="p">(</span><span class="n">next_monday</span><span class="o">+</span><span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">3</span><span class="p">),</span> <span class="n">morning_departure</span><span class="o">.</span><span class="n">time</span><span class="p">()),</span>
</span><span id="Analyzer.get_commute_data-535"><a href="#Analyzer.get_commute_data-535"><span class="linenos">535</span></a>                    <span class="s1">&#39;h_evening&#39;</span><span class="p">:</span><span class="n">datetime</span><span class="o">.</span><span class="n">combine</span><span class="p">(</span><span class="n">next_monday</span><span class="o">+</span><span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">3</span><span class="p">),</span> <span class="n">evening_departure</span><span class="o">.</span><span class="n">time</span><span class="p">()),</span>
</span><span id="Analyzer.get_commute_data-536"><a href="#Analyzer.get_commute_data-536"><span class="linenos">536</span></a>                    <span class="s1">&#39;f_morning&#39;</span><span class="p">:</span><span class="n">datetime</span><span class="o">.</span><span class="n">combine</span><span class="p">(</span><span class="n">next_monday</span><span class="o">+</span><span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">4</span><span class="p">),</span> <span class="n">morning_departure</span><span class="o">.</span><span class="n">time</span><span class="p">()),</span>
</span><span id="Analyzer.get_commute_data-537"><a href="#Analyzer.get_commute_data-537"><span class="linenos">537</span></a>                    <span class="s1">&#39;f_evening&#39;</span><span class="p">:</span><span class="n">datetime</span><span class="o">.</span><span class="n">combine</span><span class="p">(</span><span class="n">next_monday</span><span class="o">+</span><span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">4</span><span class="p">),</span> <span class="n">evening_departure</span><span class="o">.</span><span class="n">time</span><span class="p">())</span>
</span><span id="Analyzer.get_commute_data-538"><a href="#Analyzer.get_commute_data-538"><span class="linenos">538</span></a>                    <span class="p">}</span>
</span><span id="Analyzer.get_commute_data-539"><a href="#Analyzer.get_commute_data-539"><span class="linenos">539</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Analyzer.get_commute_data-540"><a href="#Analyzer.get_commute_data-540"><span class="linenos">540</span></a><span class="sd">        &quot;commute_data.csv&quot;: [&quot;office_address&quot;,&quot;origin_lat&quot;, &quot;origin_long&quot;, &quot;destination_lat&quot;, &quot;destination_long&quot;, </span>
</span><span id="Analyzer.get_commute_data-541"><a href="#Analyzer.get_commute_data-541"><span class="linenos">541</span></a><span class="sd">                                 &quot;miles&quot;, &quot;duration&quot;, &quot;emissions&quot;, &quot;commute_cost&quot;,</span>
</span><span id="Analyzer.get_commute_data-542"><a href="#Analyzer.get_commute_data-542"><span class="linenos">542</span></a><span class="sd">                                 &quot;m_morning_duration_in_traffic&quot;, </span>
</span><span id="Analyzer.get_commute_data-543"><a href="#Analyzer.get_commute_data-543"><span class="linenos">543</span></a><span class="sd">                                 &quot;m_morning_emissions&quot;, </span>
</span><span id="Analyzer.get_commute_data-544"><a href="#Analyzer.get_commute_data-544"><span class="linenos">544</span></a><span class="sd">                                 &quot;m_evening_duration_in_traffic&quot;, </span>
</span><span id="Analyzer.get_commute_data-545"><a href="#Analyzer.get_commute_data-545"><span class="linenos">545</span></a><span class="sd">                                 &quot;m_evening_emissions&quot;,</span>
</span><span id="Analyzer.get_commute_data-546"><a href="#Analyzer.get_commute_data-546"><span class="linenos">546</span></a><span class="sd">                                 &quot;t_morning_duration_in_traffic&quot;, </span>
</span><span id="Analyzer.get_commute_data-547"><a href="#Analyzer.get_commute_data-547"><span class="linenos">547</span></a><span class="sd">                                 &quot;t_morning_emissions&quot;, </span>
</span><span id="Analyzer.get_commute_data-548"><a href="#Analyzer.get_commute_data-548"><span class="linenos">548</span></a><span class="sd">                                 &quot;t_evening_duration_in_traffic&quot;, </span>
</span><span id="Analyzer.get_commute_data-549"><a href="#Analyzer.get_commute_data-549"><span class="linenos">549</span></a><span class="sd">                                 &quot;t_evening_emissions&quot;,</span>
</span><span id="Analyzer.get_commute_data-550"><a href="#Analyzer.get_commute_data-550"><span class="linenos">550</span></a><span class="sd">                                 &quot;w_morning_duration_in_traffic&quot;, </span>
</span><span id="Analyzer.get_commute_data-551"><a href="#Analyzer.get_commute_data-551"><span class="linenos">551</span></a><span class="sd">                                 &quot;w_morning_emissions&quot;, </span>
</span><span id="Analyzer.get_commute_data-552"><a href="#Analyzer.get_commute_data-552"><span class="linenos">552</span></a><span class="sd">                                 &quot;w_evening_duration_in_traffic&quot;, </span>
</span><span id="Analyzer.get_commute_data-553"><a href="#Analyzer.get_commute_data-553"><span class="linenos">553</span></a><span class="sd">                                 &quot;w_evening_emissions&quot;,</span>
</span><span id="Analyzer.get_commute_data-554"><a href="#Analyzer.get_commute_data-554"><span class="linenos">554</span></a><span class="sd">                                 &quot;h_morning_duration_in_traffic&quot;, </span>
</span><span id="Analyzer.get_commute_data-555"><a href="#Analyzer.get_commute_data-555"><span class="linenos">555</span></a><span class="sd">                                 &quot;h_morning_emissions&quot;, </span>
</span><span id="Analyzer.get_commute_data-556"><a href="#Analyzer.get_commute_data-556"><span class="linenos">556</span></a><span class="sd">                                 &quot;h_evening_duration_in_traffic&quot;, </span>
</span><span id="Analyzer.get_commute_data-557"><a href="#Analyzer.get_commute_data-557"><span class="linenos">557</span></a><span class="sd">                                 &quot;h_evening_emissions&quot;,</span>
</span><span id="Analyzer.get_commute_data-558"><a href="#Analyzer.get_commute_data-558"><span class="linenos">558</span></a><span class="sd">                                 &quot;f_morning_duration_in_traffic&quot;, </span>
</span><span id="Analyzer.get_commute_data-559"><a href="#Analyzer.get_commute_data-559"><span class="linenos">559</span></a><span class="sd">                                 &quot;f_morning_emissions&quot;, </span>
</span><span id="Analyzer.get_commute_data-560"><a href="#Analyzer.get_commute_data-560"><span class="linenos">560</span></a><span class="sd">                                 &quot;f_evening_duration_in_traffic&quot;, </span>
</span><span id="Analyzer.get_commute_data-561"><a href="#Analyzer.get_commute_data-561"><span class="linenos">561</span></a><span class="sd">                                 &quot;f_evening_emissions&quot;]</span>
</span><span id="Analyzer.get_commute_data-562"><a href="#Analyzer.get_commute_data-562"><span class="linenos">562</span></a><span class="sd">        &quot;&quot;&quot;</span>       
</span><span id="Analyzer.get_commute_data-563"><a href="#Analyzer.get_commute_data-563"><span class="linenos">563</span></a>        <span class="c1"># for each office location</span>
</span><span id="Analyzer.get_commute_data-564"><a href="#Analyzer.get_commute_data-564"><span class="linenos">564</span></a>        <span class="n">data_key</span> <span class="o">=</span> <span class="s2">&quot;employee_gps.csv&quot;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">use_gps_fuzzing</span><span class="o">==</span><span class="kc">False</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">use_gps_fuzzing</span><span class="o">==</span><span class="kc">False</span> <span class="k">else</span> <span class="s2">&quot;gps_fuzz.csv&quot;</span>
</span><span id="Analyzer.get_commute_data-565"><a href="#Analyzer.get_commute_data-565"><span class="linenos">565</span></a>        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;office_gps.csv&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
</span><span id="Analyzer.get_commute_data-566"><a href="#Analyzer.get_commute_data-566"><span class="linenos">566</span></a>            <span class="c1"># for each employee+</span>
</span><span id="Analyzer.get_commute_data-567"><a href="#Analyzer.get_commute_data-567"><span class="linenos">567</span></a>            <span class="k">for</span> <span class="n">index2</span><span class="p">,</span> <span class="n">row2</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">data_key</span><span class="p">]</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
</span><span id="Analyzer.get_commute_data-568"><a href="#Analyzer.get_commute_data-568"><span class="linenos">568</span></a>                <span class="n">data_row</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;commute_data.csv&quot;</span><span class="p">])</span>
</span><span id="Analyzer.get_commute_data-569"><a href="#Analyzer.get_commute_data-569"><span class="linenos">569</span></a>                <span class="c1"># create a row in the dataframe for this employee to this office, add initial data, use -1 for all incomplete calculations</span>
</span><span id="Analyzer.get_commute_data-570"><a href="#Analyzer.get_commute_data-570"><span class="linenos">570</span></a>                <span class="n">val</span><span class="o">=</span> <span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;address&quot;</span><span class="p">],</span><span class="n">row2</span><span class="p">[</span><span class="s2">&quot;latitude&quot;</span><span class="p">],</span> <span class="n">row2</span><span class="p">[</span><span class="s2">&quot;longitude&quot;</span><span class="p">],</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;latitude&quot;</span><span class="p">],</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;longitude&quot;</span><span class="p">]]</span> <span class="o">+</span> <span class="p">[</span><span class="o">-</span><span class="mf">1.0</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">24</span><span class="p">)]</span>
</span><span id="Analyzer.get_commute_data-571"><a href="#Analyzer.get_commute_data-571"><span class="linenos">571</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;commute_data.csv&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">data_row</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span>
</span><span id="Analyzer.get_commute_data-572"><a href="#Analyzer.get_commute_data-572"><span class="linenos">572</span></a>                <span class="c1"># calculate the commute time for this employee to this office</span>
</span><span id="Analyzer.get_commute_data-573"><a href="#Analyzer.get_commute_data-573"><span class="linenos">573</span></a>                <span class="k">for</span> <span class="n">day</span> <span class="ow">in</span> <span class="n">days</span><span class="p">:</span>
</span><span id="Analyzer.get_commute_data-574"><a href="#Analyzer.get_commute_data-574"><span class="linenos">574</span></a>                    <span class="k">for</span> <span class="n">time</span> <span class="ow">in</span> <span class="n">times</span><span class="p">:</span>
</span><span id="Analyzer.get_commute_data-575"><a href="#Analyzer.get_commute_data-575"><span class="linenos">575</span></a>                        <span class="c1"># log iff logging</span>
</span><span id="Analyzer.get_commute_data-576"><a href="#Analyzer.get_commute_data-576"><span class="linenos">576</span></a>                        <span class="c1"># create source and destination placeholders</span>
</span><span id="Analyzer.get_commute_data-577"><a href="#Analyzer.get_commute_data-577"><span class="linenos">577</span></a>                        <span class="k">if</span> <span class="s2">&quot;evening&quot;</span> <span class="ow">in</span> <span class="n">time</span><span class="p">:</span>
</span><span id="Analyzer.get_commute_data-578"><a href="#Analyzer.get_commute_data-578"><span class="linenos">578</span></a>                            <span class="n">source</span> <span class="o">=</span> <span class="p">(</span><span class="n">row2</span><span class="p">[</span><span class="s2">&quot;latitude&quot;</span><span class="p">],</span><span class="n">row2</span><span class="p">[</span><span class="s2">&quot;longitude&quot;</span><span class="p">])</span>
</span><span id="Analyzer.get_commute_data-579"><a href="#Analyzer.get_commute_data-579"><span class="linenos">579</span></a>                            <span class="n">destination</span> <span class="o">=</span> <span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;latitude&quot;</span><span class="p">],</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;longitude&quot;</span><span class="p">])</span>
</span><span id="Analyzer.get_commute_data-580"><a href="#Analyzer.get_commute_data-580"><span class="linenos">580</span></a>                        <span class="k">else</span><span class="p">:</span>
</span><span id="Analyzer.get_commute_data-581"><a href="#Analyzer.get_commute_data-581"><span class="linenos">581</span></a>                            <span class="n">source</span> <span class="o">=</span> <span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;latitude&quot;</span><span class="p">],</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;longitude&quot;</span><span class="p">])</span>
</span><span id="Analyzer.get_commute_data-582"><a href="#Analyzer.get_commute_data-582"><span class="linenos">582</span></a>                            <span class="n">destination</span> <span class="o">=</span> <span class="p">(</span><span class="n">row2</span><span class="p">[</span><span class="s2">&quot;latitude&quot;</span><span class="p">],</span><span class="n">row2</span><span class="p">[</span><span class="s2">&quot;longitude&quot;</span><span class="p">])</span>
</span><span id="Analyzer.get_commute_data-583"><a href="#Analyzer.get_commute_data-583"><span class="linenos">583</span></a>                        <span class="k">if</span> <span class="n">log_csv</span><span class="p">:</span> 
</span><span id="Analyzer.get_commute_data-584"><a href="#Analyzer.get_commute_data-584"><span class="linenos">584</span></a>                            <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Calculating commute time for &quot;</span> <span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">source</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">+</span><span class="s2">&quot;,&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">source</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">+</span><span class="s2">&quot; to &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">destination</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">+</span><span class="s2">&quot;,&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">destination</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">+</span><span class="s2">&quot; at &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">commutes</span><span class="p">[</span><span class="n">day</span><span class="o">+</span><span class="s2">&quot;_&quot;</span><span class="o">+</span><span class="n">time</span><span class="p">])</span><span class="o">+</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Analyzer.get_commute_data-585"><a href="#Analyzer.get_commute_data-585"><span class="linenos">585</span></a>                            <span class="n">log</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
</span><span id="Analyzer.get_commute_data-586"><a href="#Analyzer.get_commute_data-586"><span class="linenos">586</span></a>                        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Calculating commute time for &quot;</span> <span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">source</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">+</span><span class="s2">&quot;,&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">source</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">+</span><span class="s2">&quot; to &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">destination</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">+</span><span class="s2">&quot;,&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">destination</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">+</span><span class="s2">&quot; at &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">commutes</span><span class="p">[</span><span class="n">day</span><span class="o">+</span><span class="s2">&quot;_&quot;</span><span class="o">+</span><span class="n">time</span><span class="p">])</span><span class="o">+</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Analyzer.get_commute_data-587"><a href="#Analyzer.get_commute_data-587"><span class="linenos">587</span></a>                        <span class="c1"># sleep if necessary for rate limit</span>
</span><span id="Analyzer.get_commute_data-588"><a href="#Analyzer.get_commute_data-588"><span class="linenos">588</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">sleepif</span><span class="p">()</span>
</span><span id="Analyzer.get_commute_data-589"><a href="#Analyzer.get_commute_data-589"><span class="linenos">589</span></a>                        <span class="k">try</span><span class="p">:</span>
</span><span id="Analyzer.get_commute_data-590"><a href="#Analyzer.get_commute_data-590"><span class="linenos">590</span></a>                            <span class="c1"># get the commute time</span>
</span><span id="Analyzer.get_commute_data-591"><a href="#Analyzer.get_commute_data-591"><span class="linenos">591</span></a>                            <span class="n">commute</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gAPI</span><span class="o">.</span><span class="n">commute</span><span class="p">((</span><span class="n">source</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">source</span><span class="p">[</span><span class="mi">1</span><span class="p">]),(</span><span class="n">destination</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">destination</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span><span class="n">commutes</span><span class="p">[</span><span class="n">day</span><span class="o">+</span><span class="s2">&quot;_&quot;</span><span class="o">+</span><span class="n">time</span><span class="p">])</span>
</span><span id="Analyzer.get_commute_data-592"><a href="#Analyzer.get_commute_data-592"><span class="linenos">592</span></a>                        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="Analyzer.get_commute_data-593"><a href="#Analyzer.get_commute_data-593"><span class="linenos">593</span></a>                            <span class="c1"># if logging, write the exception event to the logfile</span>
</span><span id="Analyzer.get_commute_data-594"><a href="#Analyzer.get_commute_data-594"><span class="linenos">594</span></a>                            <span class="k">if</span> <span class="n">log_csv</span><span class="p">:</span>
</span><span id="Analyzer.get_commute_data-595"><a href="#Analyzer.get_commute_data-595"><span class="linenos">595</span></a>                                <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Exception calling commute function: &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Analyzer.get_commute_data-596"><a href="#Analyzer.get_commute_data-596"><span class="linenos">596</span></a>                                <span class="n">log</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
</span><span id="Analyzer.get_commute_data-597"><a href="#Analyzer.get_commute_data-597"><span class="linenos">597</span></a>                            <span class="bp">self</span><span class="o">.</span><span class="n">log_error</span><span class="p">(</span><span class="s2">&quot;Exception calling commute function: &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Analyzer.get_commute_data-598"><a href="#Analyzer.get_commute_data-598"><span class="linenos">598</span></a>                            <span class="c1"># if the excetion is a recoverable one, retry after a delay, else raise the exception</span>
</span><span id="Analyzer.get_commute_data-599"><a href="#Analyzer.get_commute_data-599"><span class="linenos">599</span></a>                            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">handle_GAPI_exception</span><span class="p">(</span><span class="n">e</span><span class="p">):</span>
</span><span id="Analyzer.get_commute_data-600"><a href="#Analyzer.get_commute_data-600"><span class="linenos">600</span></a>                                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;recoverable exception, waiting to retry once&quot;</span><span class="p">)</span>
</span><span id="Analyzer.get_commute_data-601"><a href="#Analyzer.get_commute_data-601"><span class="linenos">601</span></a>                                <span class="n">sleep</span><span class="p">(</span><span class="mi">10000</span><span class="p">)</span>
</span><span id="Analyzer.get_commute_data-602"><a href="#Analyzer.get_commute_data-602"><span class="linenos">602</span></a>                                <span class="k">try</span><span class="p">:</span>
</span><span id="Analyzer.get_commute_data-603"><a href="#Analyzer.get_commute_data-603"><span class="linenos">603</span></a>                                    <span class="n">commute</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gAPI</span><span class="o">.</span><span class="n">commute</span><span class="p">((</span><span class="n">source</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">source</span><span class="p">[</span><span class="mi">1</span><span class="p">]),(</span><span class="n">destination</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span><span class="n">destination</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span><span class="n">commutes</span><span class="p">[</span><span class="n">day</span><span class="o">+</span><span class="s2">&quot;_&quot;</span><span class="o">+</span><span class="n">time</span><span class="p">])</span>
</span><span id="Analyzer.get_commute_data-604"><a href="#Analyzer.get_commute_data-604"><span class="linenos">604</span></a>                                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="Analyzer.get_commute_data-605"><a href="#Analyzer.get_commute_data-605"><span class="linenos">605</span></a>                                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Recoverable exception, tried twice skipping address, deemed unrecoverable. &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Analyzer.get_commute_data-606"><a href="#Analyzer.get_commute_data-606"><span class="linenos">606</span></a>                                    <span class="c1"># if logging, write the exception event to the logfile</span>
</span><span id="Analyzer.get_commute_data-607"><a href="#Analyzer.get_commute_data-607"><span class="linenos">607</span></a>                                    <span class="bp">self</span><span class="o">.</span><span class="n">log_error</span><span class="p">(</span><span class="s2">&quot;Recoverable error calling commute function, failed twice. Deemed unrecoverable. Exception: &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Analyzer.get_commute_data-608"><a href="#Analyzer.get_commute_data-608"><span class="linenos">608</span></a>                                    <span class="n">e</span><span class="o">.</span><span class="n">add_note</span> <span class="o">=</span> <span class="s2">&quot;Recoverable error calling commute function, failed twice. Deemed unrecoverable&quot;</span>
</span><span id="Analyzer.get_commute_data-609"><a href="#Analyzer.get_commute_data-609"><span class="linenos">609</span></a>                                    <span class="k">raise</span> <span class="n">e</span>
</span><span id="Analyzer.get_commute_data-610"><a href="#Analyzer.get_commute_data-610"><span class="linenos">610</span></a>                            <span class="k">else</span><span class="p">:</span>
</span><span id="Analyzer.get_commute_data-611"><a href="#Analyzer.get_commute_data-611"><span class="linenos">611</span></a>                                <span class="c1"># print the full stack trace and raise e</span>
</span><span id="Analyzer.get_commute_data-612"><a href="#Analyzer.get_commute_data-612"><span class="linenos">612</span></a>                                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Unrecoverable unknown exception, tried once. &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Analyzer.get_commute_data-613"><a href="#Analyzer.get_commute_data-613"><span class="linenos">613</span></a>                                <span class="c1"># if logging, write the exception event to the logfile</span>
</span><span id="Analyzer.get_commute_data-614"><a href="#Analyzer.get_commute_data-614"><span class="linenos">614</span></a>                                <span class="bp">self</span><span class="o">.</span><span class="n">log_error</span><span class="p">(</span><span class="s2">&quot;Unrecoverable error calling commute function, failed once. Exception: &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Analyzer.get_commute_data-615"><a href="#Analyzer.get_commute_data-615"><span class="linenos">615</span></a>                                <span class="n">e</span><span class="o">.</span><span class="n">add_note</span> <span class="o">=</span> <span class="s2">&quot;Unrecoverable error calling commute function, failed once&quot;</span>
</span><span id="Analyzer.get_commute_data-616"><a href="#Analyzer.get_commute_data-616"><span class="linenos">616</span></a>                                <span class="k">raise</span> <span class="n">e</span>
</span><span id="Analyzer.get_commute_data-617"><a href="#Analyzer.get_commute_data-617"><span class="linenos">617</span></a>                        <span class="k">try</span><span class="p">:</span>
</span><span id="Analyzer.get_commute_data-618"><a href="#Analyzer.get_commute_data-618"><span class="linenos">618</span></a>                            <span class="c1"># Update the row in the dataframe with the commute time</span>
</span><span id="Analyzer.get_commute_data-619"><a href="#Analyzer.get_commute_data-619"><span class="linenos">619</span></a>                            <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;commute_data.csv&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">data_row</span><span class="p">,</span><span class="n">day</span><span class="o">+</span><span class="s2">&quot;_&quot;</span><span class="o">+</span><span class="n">time</span><span class="o">+</span><span class="s2">&quot;_duration_in_traffic&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">convert_stringtime_to_minutes</span><span class="p">(</span><span class="n">commute</span><span class="p">[</span><span class="s2">&quot;duration_in_traffic&quot;</span><span class="p">]))</span>
</span><span id="Analyzer.get_commute_data-620"><a href="#Analyzer.get_commute_data-620"><span class="linenos">620</span></a>                            <span class="c1"># if this is the first time through, insert the distance and duration into the dataframe</span>
</span><span id="Analyzer.get_commute_data-621"><a href="#Analyzer.get_commute_data-621"><span class="linenos">621</span></a>                            <span class="k">if</span> <span class="n">day</span> <span class="o">==</span> <span class="s2">&quot;m&quot;</span> <span class="ow">and</span> <span class="n">time</span> <span class="o">==</span> <span class="s2">&quot;morning&quot;</span><span class="p">:</span>
</span><span id="Analyzer.get_commute_data-622"><a href="#Analyzer.get_commute_data-622"><span class="linenos">622</span></a>                                <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;commute_data.csv&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">data_row</span><span class="p">,</span><span class="s2">&quot;miles&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">convert_stringdistance_to_d</span><span class="p">(</span><span class="n">commute</span><span class="p">[</span><span class="s2">&quot;distance&quot;</span><span class="p">]))</span>
</span><span id="Analyzer.get_commute_data-623"><a href="#Analyzer.get_commute_data-623"><span class="linenos">623</span></a>                                <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;commute_data.csv&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">data_row</span><span class="p">,</span><span class="s2">&quot;duration&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">convert_stringtime_to_minutes</span><span class="p">(</span><span class="n">commute</span><span class="p">[</span><span class="s2">&quot;duration&quot;</span><span class="p">]))</span>
</span><span id="Analyzer.get_commute_data-624"><a href="#Analyzer.get_commute_data-624"><span class="linenos">624</span></a>                        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="Analyzer.get_commute_data-625"><a href="#Analyzer.get_commute_data-625"><span class="linenos">625</span></a>                            <span class="c1"># if logging, write the exception event to the logfile</span>
</span><span id="Analyzer.get_commute_data-626"><a href="#Analyzer.get_commute_data-626"><span class="linenos">626</span></a>                            <span class="k">if</span> <span class="n">log_csv</span><span class="p">:</span>
</span><span id="Analyzer.get_commute_data-627"><a href="#Analyzer.get_commute_data-627"><span class="linenos">627</span></a>                                <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Exception updating commute data: &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Analyzer.get_commute_data-628"><a href="#Analyzer.get_commute_data-628"><span class="linenos">628</span></a>                                <span class="n">log</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
</span><span id="Analyzer.get_commute_data-629"><a href="#Analyzer.get_commute_data-629"><span class="linenos">629</span></a>                            <span class="bp">self</span><span class="o">.</span><span class="n">log_error</span><span class="p">(</span><span class="s2">&quot;Exception updating commute data: &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Analyzer.get_commute_data-630"><a href="#Analyzer.get_commute_data-630"><span class="linenos">630</span></a>                            <span class="n">e</span><span class="o">.</span><span class="n">add_note</span> <span class="o">=</span> <span class="s2">&quot;Exception updating commute data after calling commute function.&quot;</span>
</span><span id="Analyzer.get_commute_data-631"><a href="#Analyzer.get_commute_data-631"><span class="linenos">631</span></a>                            <span class="k">raise</span> <span class="n">e</span>
</span><span id="Analyzer.get_commute_data-632"><a href="#Analyzer.get_commute_data-632"><span class="linenos">632</span></a>                        
</span><span id="Analyzer.get_commute_data-633"><a href="#Analyzer.get_commute_data-633"><span class="linenos">633</span></a>        <span class="c1"># save the project data object to the csv file</span>
</span><span id="Analyzer.get_commute_data-634"><a href="#Analyzer.get_commute_data-634"><span class="linenos">634</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">save_data_file</span><span class="p">(</span><span class="s2">&quot;commute_data.csv&quot;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Generates commute data for employees based on their GPS coordinates and the office locations.</p>

<p>This method calculates commute times and distances from employees' locations to the office, accounting for specified commute times. 
Optionally logs the operation details if a log CSV file path is provided.</p>

<p>Args:
    force (bool, optional): If True, forces regeneration of commute data even if it already exists. Defaults to False.
    log_csv (str, optional): Path to a log CSV file where operation details are recorded. Defaults to None.</p>

<p>Returns:
    bool: True if commute data is successfully generated; False otherwise.</p>
</div>


                            </div>
                            <div id="Analyzer.convert_stringtime_to_minutes" class="classattr">
                                        <input id="Analyzer.convert_stringtime_to_minutes-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">convert_stringtime_to_minutes</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">time_string</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Analyzer.convert_stringtime_to_minutes-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Analyzer.convert_stringtime_to_minutes"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Analyzer.convert_stringtime_to_minutes-637"><a href="#Analyzer.convert_stringtime_to_minutes-637"><span class="linenos">637</span></a>    <span class="k">def</span> <span class="nf">convert_stringtime_to_minutes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">time_string</span><span class="p">):</span>
</span><span id="Analyzer.convert_stringtime_to_minutes-638"><a href="#Analyzer.convert_stringtime_to_minutes-638"><span class="linenos">638</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Analyzer.convert_stringtime_to_minutes-639"><a href="#Analyzer.convert_stringtime_to_minutes-639"><span class="linenos">639</span></a><span class="sd">        Converts a string representing distance into miles.</span>
</span><span id="Analyzer.convert_stringtime_to_minutes-640"><a href="#Analyzer.convert_stringtime_to_minutes-640"><span class="linenos">640</span></a>
</span><span id="Analyzer.convert_stringtime_to_minutes-641"><a href="#Analyzer.convert_stringtime_to_minutes-641"><span class="linenos">641</span></a><span class="sd">        Parses a string for distance measurements expressed in various units (miles, kilometers, meters, etc.) and converts </span>
</span><span id="Analyzer.convert_stringtime_to_minutes-642"><a href="#Analyzer.convert_stringtime_to_minutes-642"><span class="linenos">642</span></a><span class="sd">        the total distance into miles.</span>
</span><span id="Analyzer.convert_stringtime_to_minutes-643"><a href="#Analyzer.convert_stringtime_to_minutes-643"><span class="linenos">643</span></a>
</span><span id="Analyzer.convert_stringtime_to_minutes-644"><a href="#Analyzer.convert_stringtime_to_minutes-644"><span class="linenos">644</span></a><span class="sd">        Args:</span>
</span><span id="Analyzer.convert_stringtime_to_minutes-645"><a href="#Analyzer.convert_stringtime_to_minutes-645"><span class="linenos">645</span></a><span class="sd">            distance_string (str): The distance string to convert.</span>
</span><span id="Analyzer.convert_stringtime_to_minutes-646"><a href="#Analyzer.convert_stringtime_to_minutes-646"><span class="linenos">646</span></a>
</span><span id="Analyzer.convert_stringtime_to_minutes-647"><a href="#Analyzer.convert_stringtime_to_minutes-647"><span class="linenos">647</span></a><span class="sd">        Returns:</span>
</span><span id="Analyzer.convert_stringtime_to_minutes-648"><a href="#Analyzer.convert_stringtime_to_minutes-648"><span class="linenos">648</span></a><span class="sd">            float: The total distance in miles.</span>
</span><span id="Analyzer.convert_stringtime_to_minutes-649"><a href="#Analyzer.convert_stringtime_to_minutes-649"><span class="linenos">649</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Analyzer.convert_stringtime_to_minutes-650"><a href="#Analyzer.convert_stringtime_to_minutes-650"><span class="linenos">650</span></a>
</span><span id="Analyzer.convert_stringtime_to_minutes-651"><a href="#Analyzer.convert_stringtime_to_minutes-651"><span class="linenos">651</span></a>        <span class="c1"># Regular expression to find all occurrences of numbers followed by time units</span>
</span><span id="Analyzer.convert_stringtime_to_minutes-652"><a href="#Analyzer.convert_stringtime_to_minutes-652"><span class="linenos">652</span></a>        <span class="n">matches</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;(\d+)\s*(hour|minute|second|min|sec|hrs|hours|minutes|mins|seconds)s?&#39;</span><span class="p">,</span> <span class="n">time_string</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">)</span>
</span><span id="Analyzer.convert_stringtime_to_minutes-653"><a href="#Analyzer.convert_stringtime_to_minutes-653"><span class="linenos">653</span></a>        
</span><span id="Analyzer.convert_stringtime_to_minutes-654"><a href="#Analyzer.convert_stringtime_to_minutes-654"><span class="linenos">654</span></a>        <span class="c1"># Initialize a dictionary to hold our time values</span>
</span><span id="Analyzer.convert_stringtime_to_minutes-655"><a href="#Analyzer.convert_stringtime_to_minutes-655"><span class="linenos">655</span></a>        <span class="n">time_values</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;hours&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;minutes&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;seconds&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>
</span><span id="Analyzer.convert_stringtime_to_minutes-656"><a href="#Analyzer.convert_stringtime_to_minutes-656"><span class="linenos">656</span></a>        
</span><span id="Analyzer.convert_stringtime_to_minutes-657"><a href="#Analyzer.convert_stringtime_to_minutes-657"><span class="linenos">657</span></a>        <span class="c1"># Loop through all matches and update the time_values dictionary accordingly</span>
</span><span id="Analyzer.convert_stringtime_to_minutes-658"><a href="#Analyzer.convert_stringtime_to_minutes-658"><span class="linenos">658</span></a>        <span class="k">for</span> <span class="n">amount</span><span class="p">,</span> <span class="n">unit</span> <span class="ow">in</span> <span class="n">matches</span><span class="p">:</span>
</span><span id="Analyzer.convert_stringtime_to_minutes-659"><a href="#Analyzer.convert_stringtime_to_minutes-659"><span class="linenos">659</span></a>            <span class="k">if</span> <span class="n">unit</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;hour&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">unit</span> <span class="o">==</span> <span class="s1">&#39;hrs&#39;</span><span class="p">:</span>
</span><span id="Analyzer.convert_stringtime_to_minutes-660"><a href="#Analyzer.convert_stringtime_to_minutes-660"><span class="linenos">660</span></a>                <span class="n">time_values</span><span class="p">[</span><span class="s1">&#39;hours&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="nb">int</span><span class="p">(</span><span class="n">amount</span><span class="p">)</span>
</span><span id="Analyzer.convert_stringtime_to_minutes-661"><a href="#Analyzer.convert_stringtime_to_minutes-661"><span class="linenos">661</span></a>            <span class="k">elif</span> <span class="n">unit</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;min&#39;</span><span class="p">):</span>
</span><span id="Analyzer.convert_stringtime_to_minutes-662"><a href="#Analyzer.convert_stringtime_to_minutes-662"><span class="linenos">662</span></a>                <span class="n">time_values</span><span class="p">[</span><span class="s1">&#39;minutes&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="nb">int</span><span class="p">(</span><span class="n">amount</span><span class="p">)</span>
</span><span id="Analyzer.convert_stringtime_to_minutes-663"><a href="#Analyzer.convert_stringtime_to_minutes-663"><span class="linenos">663</span></a>            <span class="k">elif</span> <span class="n">unit</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;sec&#39;</span><span class="p">):</span>
</span><span id="Analyzer.convert_stringtime_to_minutes-664"><a href="#Analyzer.convert_stringtime_to_minutes-664"><span class="linenos">664</span></a>                <span class="n">time_values</span><span class="p">[</span><span class="s1">&#39;seconds&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="nb">int</span><span class="p">(</span><span class="n">amount</span><span class="p">)</span>
</span><span id="Analyzer.convert_stringtime_to_minutes-665"><a href="#Analyzer.convert_stringtime_to_minutes-665"><span class="linenos">665</span></a>        
</span><span id="Analyzer.convert_stringtime_to_minutes-666"><a href="#Analyzer.convert_stringtime_to_minutes-666"><span class="linenos">666</span></a>        <span class="c1"># create an integer to hold the total minutes</span>
</span><span id="Analyzer.convert_stringtime_to_minutes-667"><a href="#Analyzer.convert_stringtime_to_minutes-667"><span class="linenos">667</span></a>        <span class="n">total_minutes</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Analyzer.convert_stringtime_to_minutes-668"><a href="#Analyzer.convert_stringtime_to_minutes-668"><span class="linenos">668</span></a>        <span class="c1"># sum the hours and minutes into total minutes</span>
</span><span id="Analyzer.convert_stringtime_to_minutes-669"><a href="#Analyzer.convert_stringtime_to_minutes-669"><span class="linenos">669</span></a>        <span class="n">total_minutes</span> <span class="o">+=</span> <span class="n">time_values</span><span class="p">[</span><span class="s1">&#39;hours&#39;</span><span class="p">]</span><span class="o">*</span><span class="mi">60</span>
</span><span id="Analyzer.convert_stringtime_to_minutes-670"><a href="#Analyzer.convert_stringtime_to_minutes-670"><span class="linenos">670</span></a>        <span class="n">total_minutes</span> <span class="o">+=</span> <span class="n">time_values</span><span class="p">[</span><span class="s1">&#39;minutes&#39;</span><span class="p">]</span>
</span><span id="Analyzer.convert_stringtime_to_minutes-671"><a href="#Analyzer.convert_stringtime_to_minutes-671"><span class="linenos">671</span></a>        <span class="k">return</span> <span class="n">total_minutes</span>
</span></pre></div>


            <div class="docstring"><p>Converts a string representing distance into miles.</p>

<p>Parses a string for distance measurements expressed in various units (miles, kilometers, meters, etc.) and converts 
the total distance into miles.</p>

<p>Args:
    distance_string (str): The distance string to convert.</p>

<p>Returns:
    float: The total distance in miles.</p>
</div>


                            </div>
                            <div id="Analyzer.convert_stringdistance_to_d" class="classattr">
                                        <input id="Analyzer.convert_stringdistance_to_d-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">convert_stringdistance_to_d</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">distance_string</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Analyzer.convert_stringdistance_to_d-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Analyzer.convert_stringdistance_to_d"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Analyzer.convert_stringdistance_to_d-674"><a href="#Analyzer.convert_stringdistance_to_d-674"><span class="linenos">674</span></a>    <span class="k">def</span> <span class="nf">convert_stringdistance_to_d</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">distance_string</span><span class="p">):</span>
</span><span id="Analyzer.convert_stringdistance_to_d-675"><a href="#Analyzer.convert_stringdistance_to_d-675"><span class="linenos">675</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Analyzer.convert_stringdistance_to_d-676"><a href="#Analyzer.convert_stringdistance_to_d-676"><span class="linenos">676</span></a><span class="sd">        Converts a string representing distance into miles.</span>
</span><span id="Analyzer.convert_stringdistance_to_d-677"><a href="#Analyzer.convert_stringdistance_to_d-677"><span class="linenos">677</span></a>
</span><span id="Analyzer.convert_stringdistance_to_d-678"><a href="#Analyzer.convert_stringdistance_to_d-678"><span class="linenos">678</span></a><span class="sd">        Parses a string for distance measurements expressed in various units (miles, kilometers, meters, etc.) and converts </span>
</span><span id="Analyzer.convert_stringdistance_to_d-679"><a href="#Analyzer.convert_stringdistance_to_d-679"><span class="linenos">679</span></a><span class="sd">        the total distance into miles.</span>
</span><span id="Analyzer.convert_stringdistance_to_d-680"><a href="#Analyzer.convert_stringdistance_to_d-680"><span class="linenos">680</span></a>
</span><span id="Analyzer.convert_stringdistance_to_d-681"><a href="#Analyzer.convert_stringdistance_to_d-681"><span class="linenos">681</span></a><span class="sd">        Args:</span>
</span><span id="Analyzer.convert_stringdistance_to_d-682"><a href="#Analyzer.convert_stringdistance_to_d-682"><span class="linenos">682</span></a><span class="sd">            distance_string (str): The distance string to convert.</span>
</span><span id="Analyzer.convert_stringdistance_to_d-683"><a href="#Analyzer.convert_stringdistance_to_d-683"><span class="linenos">683</span></a>
</span><span id="Analyzer.convert_stringdistance_to_d-684"><a href="#Analyzer.convert_stringdistance_to_d-684"><span class="linenos">684</span></a><span class="sd">        Returns:</span>
</span><span id="Analyzer.convert_stringdistance_to_d-685"><a href="#Analyzer.convert_stringdistance_to_d-685"><span class="linenos">685</span></a><span class="sd">            float: The total distance in miles.</span>
</span><span id="Analyzer.convert_stringdistance_to_d-686"><a href="#Analyzer.convert_stringdistance_to_d-686"><span class="linenos">686</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Analyzer.convert_stringdistance_to_d-687"><a href="#Analyzer.convert_stringdistance_to_d-687"><span class="linenos">687</span></a>
</span><span id="Analyzer.convert_stringdistance_to_d-688"><a href="#Analyzer.convert_stringdistance_to_d-688"><span class="linenos">688</span></a>        <span class="c1"># Regular expression to find all occurrences of numbers followed by distance units</span>
</span><span id="Analyzer.convert_stringdistance_to_d-689"><a href="#Analyzer.convert_stringdistance_to_d-689"><span class="linenos">689</span></a>        <span class="n">matches</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;(\b\d+(?:\.\d+)?)\s*(mile|kilometer|meter|foot|yard|inch|mi|km|m|ft|yd|in)s?&#39;</span><span class="p">,</span> <span class="n">distance_string</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">)</span>
</span><span id="Analyzer.convert_stringdistance_to_d-690"><a href="#Analyzer.convert_stringdistance_to_d-690"><span class="linenos">690</span></a>        
</span><span id="Analyzer.convert_stringdistance_to_d-691"><a href="#Analyzer.convert_stringdistance_to_d-691"><span class="linenos">691</span></a>        <span class="c1"># Initialize a dictionary to hold our distance values</span>
</span><span id="Analyzer.convert_stringdistance_to_d-692"><a href="#Analyzer.convert_stringdistance_to_d-692"><span class="linenos">692</span></a>        <span class="n">distance_values</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;miles&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;kilometers&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;meters&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;feet&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;yards&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;inches&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>
</span><span id="Analyzer.convert_stringdistance_to_d-693"><a href="#Analyzer.convert_stringdistance_to_d-693"><span class="linenos">693</span></a>        <span class="c1"># Loop through all matches and update the distance_values dictionary accordingly</span>
</span><span id="Analyzer.convert_stringdistance_to_d-694"><a href="#Analyzer.convert_stringdistance_to_d-694"><span class="linenos">694</span></a>        <span class="k">for</span> <span class="n">amount</span><span class="p">,</span> <span class="n">unit</span> <span class="ow">in</span> <span class="n">matches</span><span class="p">:</span>
</span><span id="Analyzer.convert_stringdistance_to_d-695"><a href="#Analyzer.convert_stringdistance_to_d-695"><span class="linenos">695</span></a>            <span class="k">if</span> <span class="n">unit</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;mile&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">unit</span> <span class="o">==</span> <span class="s1">&#39;mi&#39;</span><span class="p">:</span>
</span><span id="Analyzer.convert_stringdistance_to_d-696"><a href="#Analyzer.convert_stringdistance_to_d-696"><span class="linenos">696</span></a>                <span class="n">distance_values</span><span class="p">[</span><span class="s1">&#39;miles&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="nb">float</span><span class="p">(</span><span class="n">amount</span><span class="p">)</span>
</span><span id="Analyzer.convert_stringdistance_to_d-697"><a href="#Analyzer.convert_stringdistance_to_d-697"><span class="linenos">697</span></a>            <span class="k">elif</span> <span class="n">unit</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;kilometer&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">unit</span> <span class="o">==</span> <span class="s1">&#39;km&#39;</span><span class="p">:</span>
</span><span id="Analyzer.convert_stringdistance_to_d-698"><a href="#Analyzer.convert_stringdistance_to_d-698"><span class="linenos">698</span></a>                <span class="n">distance_values</span><span class="p">[</span><span class="s1">&#39;kilometers&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="nb">float</span><span class="p">(</span><span class="n">amount</span><span class="p">)</span>
</span><span id="Analyzer.convert_stringdistance_to_d-699"><a href="#Analyzer.convert_stringdistance_to_d-699"><span class="linenos">699</span></a>            <span class="k">elif</span> <span class="n">unit</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;meter&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">unit</span> <span class="o">==</span> <span class="s1">&#39;m&#39;</span><span class="p">:</span>
</span><span id="Analyzer.convert_stringdistance_to_d-700"><a href="#Analyzer.convert_stringdistance_to_d-700"><span class="linenos">700</span></a>                <span class="n">distance_values</span><span class="p">[</span><span class="s1">&#39;meters&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="nb">float</span><span class="p">(</span><span class="n">amount</span><span class="p">)</span>
</span><span id="Analyzer.convert_stringdistance_to_d-701"><a href="#Analyzer.convert_stringdistance_to_d-701"><span class="linenos">701</span></a>            <span class="k">elif</span> <span class="n">unit</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;foot&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">unit</span> <span class="o">==</span> <span class="s1">&#39;ft&#39;</span><span class="p">:</span>
</span><span id="Analyzer.convert_stringdistance_to_d-702"><a href="#Analyzer.convert_stringdistance_to_d-702"><span class="linenos">702</span></a>                <span class="n">distance_values</span><span class="p">[</span><span class="s1">&#39;feet&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="nb">float</span><span class="p">(</span><span class="n">amount</span><span class="p">)</span>
</span><span id="Analyzer.convert_stringdistance_to_d-703"><a href="#Analyzer.convert_stringdistance_to_d-703"><span class="linenos">703</span></a>            <span class="k">elif</span> <span class="n">unit</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;yard&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">unit</span> <span class="o">==</span> <span class="s1">&#39;yd&#39;</span><span class="p">:</span>
</span><span id="Analyzer.convert_stringdistance_to_d-704"><a href="#Analyzer.convert_stringdistance_to_d-704"><span class="linenos">704</span></a>                <span class="n">distance_values</span><span class="p">[</span><span class="s1">&#39;yards&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="nb">float</span><span class="p">(</span><span class="n">amount</span><span class="p">)</span>
</span><span id="Analyzer.convert_stringdistance_to_d-705"><a href="#Analyzer.convert_stringdistance_to_d-705"><span class="linenos">705</span></a>            <span class="k">elif</span> <span class="n">unit</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;inch&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">unit</span> <span class="o">==</span> <span class="s1">&#39;in&#39;</span><span class="p">:</span>
</span><span id="Analyzer.convert_stringdistance_to_d-706"><a href="#Analyzer.convert_stringdistance_to_d-706"><span class="linenos">706</span></a>                <span class="n">distance_values</span><span class="p">[</span><span class="s1">&#39;inches&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="nb">float</span><span class="p">(</span><span class="n">amount</span><span class="p">)</span>
</span><span id="Analyzer.convert_stringdistance_to_d-707"><a href="#Analyzer.convert_stringdistance_to_d-707"><span class="linenos">707</span></a>        
</span><span id="Analyzer.convert_stringdistance_to_d-708"><a href="#Analyzer.convert_stringdistance_to_d-708"><span class="linenos">708</span></a>        <span class="c1"># create an integer to hold the total miles</span>
</span><span id="Analyzer.convert_stringdistance_to_d-709"><a href="#Analyzer.convert_stringdistance_to_d-709"><span class="linenos">709</span></a>        <span class="n">total_miles</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Analyzer.convert_stringdistance_to_d-710"><a href="#Analyzer.convert_stringdistance_to_d-710"><span class="linenos">710</span></a>        <span class="c1"># sum the miles into total miles</span>
</span><span id="Analyzer.convert_stringdistance_to_d-711"><a href="#Analyzer.convert_stringdistance_to_d-711"><span class="linenos">711</span></a>        <span class="n">total_miles</span> <span class="o">+=</span> <span class="n">distance_values</span><span class="p">[</span><span class="s1">&#39;miles&#39;</span><span class="p">]</span>
</span><span id="Analyzer.convert_stringdistance_to_d-712"><a href="#Analyzer.convert_stringdistance_to_d-712"><span class="linenos">712</span></a>        <span class="k">return</span> <span class="n">total_miles</span>
</span></pre></div>


            <div class="docstring"><p>Converts a string representing distance into miles.</p>

<p>Parses a string for distance measurements expressed in various units (miles, kilometers, meters, etc.) and converts 
the total distance into miles.</p>

<p>Args:
    distance_string (str): The distance string to convert.</p>

<p>Returns:
    float: The total distance in miles.</p>
</div>


                            </div>
                            <div id="Analyzer.get_commute_cost" class="classattr">
                                        <input id="Analyzer.get_commute_cost-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_commute_cost</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">force</span><span class="o">=</span><span class="kc">False</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Analyzer.get_commute_cost-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Analyzer.get_commute_cost"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Analyzer.get_commute_cost-714"><a href="#Analyzer.get_commute_cost-714"><span class="linenos">714</span></a>    <span class="k">def</span> <span class="nf">get_commute_cost</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="Analyzer.get_commute_cost-715"><a href="#Analyzer.get_commute_cost-715"><span class="linenos">715</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Analyzer.get_commute_cost-716"><a href="#Analyzer.get_commute_cost-716"><span class="linenos">716</span></a><span class="sd">        Updates the commute data with calculated commute costs based on distances.</span>
</span><span id="Analyzer.get_commute_cost-717"><a href="#Analyzer.get_commute_cost-717"><span class="linenos">717</span></a>
</span><span id="Analyzer.get_commute_cost-718"><a href="#Analyzer.get_commute_cost-718"><span class="linenos">718</span></a><span class="sd">        Commute costs are calculated using the project&#39;s specified mileage rate applied to the commute distances for each employee.</span>
</span><span id="Analyzer.get_commute_cost-719"><a href="#Analyzer.get_commute_cost-719"><span class="linenos">719</span></a>
</span><span id="Analyzer.get_commute_cost-720"><a href="#Analyzer.get_commute_cost-720"><span class="linenos">720</span></a><span class="sd">        Args:</span>
</span><span id="Analyzer.get_commute_cost-721"><a href="#Analyzer.get_commute_cost-721"><span class="linenos">721</span></a><span class="sd">            force (bool, optional): If True, forces recalculation of commute costs even if they are already calculated. Defaults to False.</span>
</span><span id="Analyzer.get_commute_cost-722"><a href="#Analyzer.get_commute_cost-722"><span class="linenos">722</span></a>
</span><span id="Analyzer.get_commute_cost-723"><a href="#Analyzer.get_commute_cost-723"><span class="linenos">723</span></a><span class="sd">        Returns:</span>
</span><span id="Analyzer.get_commute_cost-724"><a href="#Analyzer.get_commute_cost-724"><span class="linenos">724</span></a><span class="sd">            bool: True if commute costs are successfully calculated; False otherwise.</span>
</span><span id="Analyzer.get_commute_cost-725"><a href="#Analyzer.get_commute_cost-725"><span class="linenos">725</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Analyzer.get_commute_cost-726"><a href="#Analyzer.get_commute_cost-726"><span class="linenos">726</span></a>        <span class="c1"># update the commute data to calculate the commute cost</span>
</span><span id="Analyzer.get_commute_cost-727"><a href="#Analyzer.get_commute_cost-727"><span class="linenos">727</span></a>        <span class="k">if</span> <span class="s2">&quot;commute_data.csv&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">list_data_files</span><span class="p">():</span>
</span><span id="Analyzer.get_commute_cost-728"><a href="#Analyzer.get_commute_cost-728"><span class="linenos">728</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;commute_data.csv&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">force</span><span class="p">:</span>
</span><span id="Analyzer.get_commute_cost-729"><a href="#Analyzer.get_commute_cost-729"><span class="linenos">729</span></a>                <span class="c1"># attempt to load the commute data</span>
</span><span id="Analyzer.get_commute_cost-730"><a href="#Analyzer.get_commute_cost-730"><span class="linenos">730</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">load_data_file</span><span class="p">(</span><span class="s2">&quot;commute_data.csv&quot;</span><span class="p">):</span>
</span><span id="Analyzer.get_commute_cost-731"><a href="#Analyzer.get_commute_cost-731"><span class="linenos">731</span></a>                    <span class="k">pass</span>
</span><span id="Analyzer.get_commute_cost-732"><a href="#Analyzer.get_commute_cost-732"><span class="linenos">732</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="Analyzer.get_commute_cost-733"><a href="#Analyzer.get_commute_cost-733"><span class="linenos">733</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Errors loading commute data from project.&quot;</span><span class="p">)</span>
</span><span id="Analyzer.get_commute_cost-734"><a href="#Analyzer.get_commute_cost-734"><span class="linenos">734</span></a>                    <span class="k">return</span> <span class="kc">False</span>
</span><span id="Analyzer.get_commute_cost-735"><a href="#Analyzer.get_commute_cost-735"><span class="linenos">735</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Analyzer.get_commute_cost-736"><a href="#Analyzer.get_commute_cost-736"><span class="linenos">736</span></a>                <span class="k">pass</span>
</span><span id="Analyzer.get_commute_cost-737"><a href="#Analyzer.get_commute_cost-737"><span class="linenos">737</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Analyzer.get_commute_cost-738"><a href="#Analyzer.get_commute_cost-738"><span class="linenos">738</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Commute data missing from project.&quot;</span><span class="p">)</span>
</span><span id="Analyzer.get_commute_cost-739"><a href="#Analyzer.get_commute_cost-739"><span class="linenos">739</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="Analyzer.get_commute_cost-740"><a href="#Analyzer.get_commute_cost-740"><span class="linenos">740</span></a>        <span class="c1"># calculate the commute cost for each employee</span>
</span><span id="Analyzer.get_commute_cost-741"><a href="#Analyzer.get_commute_cost-741"><span class="linenos">741</span></a>        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;commute_data.csv&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
</span><span id="Analyzer.get_commute_cost-742"><a href="#Analyzer.get_commute_cost-742"><span class="linenos">742</span></a>            <span class="c1"># calculate the commute cost</span>
</span><span id="Analyzer.get_commute_cost-743"><a href="#Analyzer.get_commute_cost-743"><span class="linenos">743</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;commute_data.csv&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">index</span><span class="p">,</span><span class="s2">&quot;commute_cost&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;miles&quot;</span><span class="p">])</span> <span class="o">*</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">mileage_rate</span><span class="p">)</span>
</span><span id="Analyzer.get_commute_cost-744"><a href="#Analyzer.get_commute_cost-744"><span class="linenos">744</span></a>        <span class="c1"># save the project data object to the csv file</span>
</span><span id="Analyzer.get_commute_cost-745"><a href="#Analyzer.get_commute_cost-745"><span class="linenos">745</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">save_data_file</span><span class="p">(</span><span class="s2">&quot;commute_data.csv&quot;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Updates the commute data with calculated commute costs based on distances.</p>

<p>Commute costs are calculated using the project's specified mileage rate applied to the commute distances for each employee.</p>

<p>Args:
    force (bool, optional): If True, forces recalculation of commute costs even if they are already calculated. Defaults to False.</p>

<p>Returns:
    bool: True if commute costs are successfully calculated; False otherwise.</p>
</div>


                            </div>
                            <div id="Analyzer.get_commute_emissions" class="classattr">
                                        <input id="Analyzer.get_commute_emissions-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_commute_emissions</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">force</span><span class="o">=</span><span class="kc">False</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Analyzer.get_commute_emissions-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Analyzer.get_commute_emissions"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Analyzer.get_commute_emissions-747"><a href="#Analyzer.get_commute_emissions-747"><span class="linenos">747</span></a>    <span class="k">def</span> <span class="nf">get_commute_emissions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="Analyzer.get_commute_emissions-748"><a href="#Analyzer.get_commute_emissions-748"><span class="linenos">748</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Analyzer.get_commute_emissions-749"><a href="#Analyzer.get_commute_emissions-749"><span class="linenos">749</span></a><span class="sd">        Calculates and updates commute data with emissions estimates based on commute distances.</span>
</span><span id="Analyzer.get_commute_emissions-750"><a href="#Analyzer.get_commute_emissions-750"><span class="linenos">750</span></a>
</span><span id="Analyzer.get_commute_emissions-751"><a href="#Analyzer.get_commute_emissions-751"><span class="linenos">751</span></a><span class="sd">        Commute emissions are calculated using the project&#39;s specified CO2 emissions per mile, applied to the commute distances </span>
</span><span id="Analyzer.get_commute_emissions-752"><a href="#Analyzer.get_commute_emissions-752"><span class="linenos">752</span></a><span class="sd">        for each employee. Optionally adjusts emissions based on traffic conditions.</span>
</span><span id="Analyzer.get_commute_emissions-753"><a href="#Analyzer.get_commute_emissions-753"><span class="linenos">753</span></a>
</span><span id="Analyzer.get_commute_emissions-754"><a href="#Analyzer.get_commute_emissions-754"><span class="linenos">754</span></a><span class="sd">        Args:</span>
</span><span id="Analyzer.get_commute_emissions-755"><a href="#Analyzer.get_commute_emissions-755"><span class="linenos">755</span></a><span class="sd">            force (bool, optional): If True, forces recalculation of commute emissions even if they are already calculated. Defaults to False.</span>
</span><span id="Analyzer.get_commute_emissions-756"><a href="#Analyzer.get_commute_emissions-756"><span class="linenos">756</span></a>
</span><span id="Analyzer.get_commute_emissions-757"><a href="#Analyzer.get_commute_emissions-757"><span class="linenos">757</span></a><span class="sd">        Returns:</span>
</span><span id="Analyzer.get_commute_emissions-758"><a href="#Analyzer.get_commute_emissions-758"><span class="linenos">758</span></a><span class="sd">            bool: True if commute emissions are successfully calculated; False otherwise.</span>
</span><span id="Analyzer.get_commute_emissions-759"><a href="#Analyzer.get_commute_emissions-759"><span class="linenos">759</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Analyzer.get_commute_emissions-760"><a href="#Analyzer.get_commute_emissions-760"><span class="linenos">760</span></a>
</span><span id="Analyzer.get_commute_emissions-761"><a href="#Analyzer.get_commute_emissions-761"><span class="linenos">761</span></a>        <span class="c1"># update the commute data to calculate the commute emissions</span>
</span><span id="Analyzer.get_commute_emissions-762"><a href="#Analyzer.get_commute_emissions-762"><span class="linenos">762</span></a>        <span class="k">if</span> <span class="s2">&quot;commute_data.csv&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">list_data_files</span><span class="p">():</span>
</span><span id="Analyzer.get_commute_emissions-763"><a href="#Analyzer.get_commute_emissions-763"><span class="linenos">763</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;commute_data.csv&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">force</span><span class="p">:</span>
</span><span id="Analyzer.get_commute_emissions-764"><a href="#Analyzer.get_commute_emissions-764"><span class="linenos">764</span></a>                <span class="c1"># attempt to load the commute data</span>
</span><span id="Analyzer.get_commute_emissions-765"><a href="#Analyzer.get_commute_emissions-765"><span class="linenos">765</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">load_data_file</span><span class="p">(</span><span class="s2">&quot;commute_data.csv&quot;</span><span class="p">):</span>
</span><span id="Analyzer.get_commute_emissions-766"><a href="#Analyzer.get_commute_emissions-766"><span class="linenos">766</span></a>                    <span class="k">pass</span>
</span><span id="Analyzer.get_commute_emissions-767"><a href="#Analyzer.get_commute_emissions-767"><span class="linenos">767</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="Analyzer.get_commute_emissions-768"><a href="#Analyzer.get_commute_emissions-768"><span class="linenos">768</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Errors loading commute data from project.&quot;</span><span class="p">)</span>
</span><span id="Analyzer.get_commute_emissions-769"><a href="#Analyzer.get_commute_emissions-769"><span class="linenos">769</span></a>                    <span class="k">return</span> <span class="kc">False</span>
</span><span id="Analyzer.get_commute_emissions-770"><a href="#Analyzer.get_commute_emissions-770"><span class="linenos">770</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Analyzer.get_commute_emissions-771"><a href="#Analyzer.get_commute_emissions-771"><span class="linenos">771</span></a>                <span class="k">pass</span>
</span><span id="Analyzer.get_commute_emissions-772"><a href="#Analyzer.get_commute_emissions-772"><span class="linenos">772</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Analyzer.get_commute_emissions-773"><a href="#Analyzer.get_commute_emissions-773"><span class="linenos">773</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Commute data missing from project.&quot;</span><span class="p">)</span>
</span><span id="Analyzer.get_commute_emissions-774"><a href="#Analyzer.get_commute_emissions-774"><span class="linenos">774</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="Analyzer.get_commute_emissions-775"><a href="#Analyzer.get_commute_emissions-775"><span class="linenos">775</span></a>        <span class="c1"># calculate the commute emissions for each row in the commute data</span>
</span><span id="Analyzer.get_commute_emissions-776"><a href="#Analyzer.get_commute_emissions-776"><span class="linenos">776</span></a>        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;commute_data.csv&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
</span><span id="Analyzer.get_commute_emissions-777"><a href="#Analyzer.get_commute_emissions-777"><span class="linenos">777</span></a>            <span class="c1"># calculate the commute emissions</span>
</span><span id="Analyzer.get_commute_emissions-778"><a href="#Analyzer.get_commute_emissions-778"><span class="linenos">778</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;commute_data.csv&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">index</span><span class="p">,</span><span class="s2">&quot;emissions&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;miles&quot;</span><span class="p">])</span> <span class="o">*</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">CO2_per_mile</span><span class="p">)</span>
</span><span id="Analyzer.get_commute_emissions-779"><a href="#Analyzer.get_commute_emissions-779"><span class="linenos">779</span></a>            <span class="c1"># calcualte the emissions for each day and time</span>
</span><span id="Analyzer.get_commute_emissions-780"><a href="#Analyzer.get_commute_emissions-780"><span class="linenos">780</span></a>            <span class="k">for</span> <span class="n">day</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;m&quot;</span><span class="p">,</span><span class="s2">&quot;t&quot;</span><span class="p">,</span><span class="s2">&quot;w&quot;</span><span class="p">,</span><span class="s2">&quot;h&quot;</span><span class="p">,</span><span class="s2">&quot;f&quot;</span><span class="p">]:</span>
</span><span id="Analyzer.get_commute_emissions-781"><a href="#Analyzer.get_commute_emissions-781"><span class="linenos">781</span></a>                <span class="k">for</span> <span class="n">time</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;morning&quot;</span><span class="p">,</span><span class="s2">&quot;evening&quot;</span><span class="p">]:</span>
</span><span id="Analyzer.get_commute_emissions-782"><a href="#Analyzer.get_commute_emissions-782"><span class="linenos">782</span></a>                    <span class="c1"># get the traffic regime for this commute</span>
</span><span id="Analyzer.get_commute_emissions-783"><a href="#Analyzer.get_commute_emissions-783"><span class="linenos">783</span></a>                    <span class="n">emissions_factor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_traffic_emissions_factor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_traffic_regime</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;miles&quot;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="n">day</span><span class="o">+</span><span class="s2">&quot;_&quot;</span><span class="o">+</span><span class="n">time</span><span class="o">+</span><span class="s2">&quot;_duration_in_traffic&quot;</span><span class="p">]))</span>
</span><span id="Analyzer.get_commute_emissions-784"><a href="#Analyzer.get_commute_emissions-784"><span class="linenos">784</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;commute_data.csv&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">index</span><span class="p">,</span><span class="n">day</span><span class="o">+</span><span class="s2">&quot;_&quot;</span><span class="o">+</span><span class="n">time</span><span class="o">+</span><span class="s2">&quot;_emissions&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;miles&quot;</span><span class="p">])</span> <span class="o">*</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">CO2_per_mile</span><span class="p">)</span> <span class="o">*</span> <span class="n">emissions_factor</span>
</span><span id="Analyzer.get_commute_emissions-785"><a href="#Analyzer.get_commute_emissions-785"><span class="linenos">785</span></a>                    
</span><span id="Analyzer.get_commute_emissions-786"><a href="#Analyzer.get_commute_emissions-786"><span class="linenos">786</span></a>        <span class="c1"># save the project data object to the csv file</span>
</span><span id="Analyzer.get_commute_emissions-787"><a href="#Analyzer.get_commute_emissions-787"><span class="linenos">787</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">save_data_file</span><span class="p">(</span><span class="s2">&quot;commute_data.csv&quot;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Calculates and updates commute data with emissions estimates based on commute distances.</p>

<p>Commute emissions are calculated using the project's specified CO2 emissions per mile, applied to the commute distances 
for each employee. Optionally adjusts emissions based on traffic conditions.</p>

<p>Args:
    force (bool, optional): If True, forces recalculation of commute emissions even if they are already calculated. Defaults to False.</p>

<p>Returns:
    bool: True if commute emissions are successfully calculated; False otherwise.</p>
</div>


                            </div>
                            <div id="Analyzer.get_traffic_regime" class="classattr">
                                        <input id="Analyzer.get_traffic_regime-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_traffic_regime</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">distance</span>, </span><span class="param"><span class="n">duration_in_traffic</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Analyzer.get_traffic_regime-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Analyzer.get_traffic_regime"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Analyzer.get_traffic_regime-790"><a href="#Analyzer.get_traffic_regime-790"><span class="linenos">790</span></a>    <span class="k">def</span> <span class="nf">get_traffic_regime</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">distance</span><span class="p">,</span> <span class="n">duration_in_traffic</span><span class="p">):</span>
</span><span id="Analyzer.get_traffic_regime-791"><a href="#Analyzer.get_traffic_regime-791"><span class="linenos">791</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Analyzer.get_traffic_regime-792"><a href="#Analyzer.get_traffic_regime-792"><span class="linenos">792</span></a><span class="sd">        Determines the traffic regime based on the commute distance and duration in traffic.</span>
</span><span id="Analyzer.get_traffic_regime-793"><a href="#Analyzer.get_traffic_regime-793"><span class="linenos">793</span></a>
</span><span id="Analyzer.get_traffic_regime-794"><a href="#Analyzer.get_traffic_regime-794"><span class="linenos">794</span></a><span class="sd">        The traffic regime is an estimation of traffic conditions affecting the commute, categorized into levels based on the </span>
</span><span id="Analyzer.get_traffic_regime-795"><a href="#Analyzer.get_traffic_regime-795"><span class="linenos">795</span></a><span class="sd">        relationship between the expected duration and the actual duration in traffic.</span>
</span><span id="Analyzer.get_traffic_regime-796"><a href="#Analyzer.get_traffic_regime-796"><span class="linenos">796</span></a>
</span><span id="Analyzer.get_traffic_regime-797"><a href="#Analyzer.get_traffic_regime-797"><span class="linenos">797</span></a><span class="sd">        Args:</span>
</span><span id="Analyzer.get_traffic_regime-798"><a href="#Analyzer.get_traffic_regime-798"><span class="linenos">798</span></a><span class="sd">            distance (float): The distance of the commute.</span>
</span><span id="Analyzer.get_traffic_regime-799"><a href="#Analyzer.get_traffic_regime-799"><span class="linenos">799</span></a><span class="sd">            duration_in_traffic (int): The duration of the commute in traffic in minutes.</span>
</span><span id="Analyzer.get_traffic_regime-800"><a href="#Analyzer.get_traffic_regime-800"><span class="linenos">800</span></a>
</span><span id="Analyzer.get_traffic_regime-801"><a href="#Analyzer.get_traffic_regime-801"><span class="linenos">801</span></a><span class="sd">        Returns:</span>
</span><span id="Analyzer.get_traffic_regime-802"><a href="#Analyzer.get_traffic_regime-802"><span class="linenos">802</span></a><span class="sd">            int: The traffic regime level, indicating the severity of traffic conditions.</span>
</span><span id="Analyzer.get_traffic_regime-803"><a href="#Analyzer.get_traffic_regime-803"><span class="linenos">803</span></a><span class="sd">    </span>
</span><span id="Analyzer.get_traffic_regime-804"><a href="#Analyzer.get_traffic_regime-804"><span class="linenos">804</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Analyzer.get_traffic_regime-805"><a href="#Analyzer.get_traffic_regime-805"><span class="linenos">805</span></a>        <span class="c1"># get the average speed</span>
</span><span id="Analyzer.get_traffic_regime-806"><a href="#Analyzer.get_traffic_regime-806"><span class="linenos">806</span></a>        <span class="n">average_speed</span> <span class="o">=</span> <span class="n">distance</span> <span class="o">/</span> <span class="p">(</span><span class="n">duration_in_traffic</span><span class="o">/</span><span class="mi">60</span><span class="p">)</span>
</span><span id="Analyzer.get_traffic_regime-807"><a href="#Analyzer.get_traffic_regime-807"><span class="linenos">807</span></a>        <span class="c1"># if the average speed is less than the lower bound of regime 2, return regime 1</span>
</span><span id="Analyzer.get_traffic_regime-808"><a href="#Analyzer.get_traffic_regime-808"><span class="linenos">808</span></a>        <span class="k">if</span> <span class="n">average_speed</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">traffic_regime_2</span><span class="p">:</span>
</span><span id="Analyzer.get_traffic_regime-809"><a href="#Analyzer.get_traffic_regime-809"><span class="linenos">809</span></a>            <span class="k">return</span> <span class="mi">1</span>
</span><span id="Analyzer.get_traffic_regime-810"><a href="#Analyzer.get_traffic_regime-810"><span class="linenos">810</span></a>        <span class="c1"># if the average speed is less than the lower bound of regime 3, return regime 2</span>
</span><span id="Analyzer.get_traffic_regime-811"><a href="#Analyzer.get_traffic_regime-811"><span class="linenos">811</span></a>        <span class="k">if</span> <span class="n">average_speed</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">traffic_regime_3</span><span class="p">:</span>
</span><span id="Analyzer.get_traffic_regime-812"><a href="#Analyzer.get_traffic_regime-812"><span class="linenos">812</span></a>            <span class="k">return</span> <span class="mi">2</span>
</span><span id="Analyzer.get_traffic_regime-813"><a href="#Analyzer.get_traffic_regime-813"><span class="linenos">813</span></a>        <span class="c1"># if the average speed is greater than or equal to the lower bound of regime 3, return regime 3</span>
</span><span id="Analyzer.get_traffic_regime-814"><a href="#Analyzer.get_traffic_regime-814"><span class="linenos">814</span></a>        <span class="k">return</span> <span class="mi">3</span>
</span></pre></div>


            <div class="docstring"><p>Determines the traffic regime based on the commute distance and duration in traffic.</p>

<p>The traffic regime is an estimation of traffic conditions affecting the commute, categorized into levels based on the 
relationship between the expected duration and the actual duration in traffic.</p>

<p>Args:
    distance (float): The distance of the commute.
    duration_in_traffic (int): The duration of the commute in traffic in minutes.</p>

<p>Returns:
    int: The traffic regime level, indicating the severity of traffic conditions.</p>
</div>


                            </div>
                            <div id="Analyzer.get_traffic_emissions_factor" class="classattr">
                                        <input id="Analyzer.get_traffic_emissions_factor-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_traffic_emissions_factor</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">regime</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Analyzer.get_traffic_emissions_factor-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Analyzer.get_traffic_emissions_factor"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Analyzer.get_traffic_emissions_factor-816"><a href="#Analyzer.get_traffic_emissions_factor-816"><span class="linenos">816</span></a>    <span class="k">def</span> <span class="nf">get_traffic_emissions_factor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">regime</span><span class="p">):</span>
</span><span id="Analyzer.get_traffic_emissions_factor-817"><a href="#Analyzer.get_traffic_emissions_factor-817"><span class="linenos">817</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Analyzer.get_traffic_emissions_factor-818"><a href="#Analyzer.get_traffic_emissions_factor-818"><span class="linenos">818</span></a><span class="sd">        Retrieves the emissions factor associated with a given traffic regime.</span>
</span><span id="Analyzer.get_traffic_emissions_factor-819"><a href="#Analyzer.get_traffic_emissions_factor-819"><span class="linenos">819</span></a>
</span><span id="Analyzer.get_traffic_emissions_factor-820"><a href="#Analyzer.get_traffic_emissions_factor-820"><span class="linenos">820</span></a><span class="sd">        This method returns a multiplier that adjusts the calculated emissions based on the traffic regime, </span>
</span><span id="Analyzer.get_traffic_emissions_factor-821"><a href="#Analyzer.get_traffic_emissions_factor-821"><span class="linenos">821</span></a><span class="sd">        with different factors indicating varying levels of traffic congestion.</span>
</span><span id="Analyzer.get_traffic_emissions_factor-822"><a href="#Analyzer.get_traffic_emissions_factor-822"><span class="linenos">822</span></a>
</span><span id="Analyzer.get_traffic_emissions_factor-823"><a href="#Analyzer.get_traffic_emissions_factor-823"><span class="linenos">823</span></a><span class="sd">        Args:</span>
</span><span id="Analyzer.get_traffic_emissions_factor-824"><a href="#Analyzer.get_traffic_emissions_factor-824"><span class="linenos">824</span></a><span class="sd">            regime (int): The traffic regime level as determined by get_traffic_regime method.</span>
</span><span id="Analyzer.get_traffic_emissions_factor-825"><a href="#Analyzer.get_traffic_emissions_factor-825"><span class="linenos">825</span></a>
</span><span id="Analyzer.get_traffic_emissions_factor-826"><a href="#Analyzer.get_traffic_emissions_factor-826"><span class="linenos">826</span></a><span class="sd">        Returns:</span>
</span><span id="Analyzer.get_traffic_emissions_factor-827"><a href="#Analyzer.get_traffic_emissions_factor-827"><span class="linenos">827</span></a><span class="sd">            float: The emissions factor corresponding to the specified traffic regime.</span>
</span><span id="Analyzer.get_traffic_emissions_factor-828"><a href="#Analyzer.get_traffic_emissions_factor-828"><span class="linenos">828</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Analyzer.get_traffic_emissions_factor-829"><a href="#Analyzer.get_traffic_emissions_factor-829"><span class="linenos">829</span></a>
</span><span id="Analyzer.get_traffic_emissions_factor-830"><a href="#Analyzer.get_traffic_emissions_factor-830"><span class="linenos">830</span></a>        <span class="c1"># return the emissions factor for the traffic regime</span>
</span><span id="Analyzer.get_traffic_emissions_factor-831"><a href="#Analyzer.get_traffic_emissions_factor-831"><span class="linenos">831</span></a>        <span class="k">if</span> <span class="n">regime</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="Analyzer.get_traffic_emissions_factor-832"><a href="#Analyzer.get_traffic_emissions_factor-832"><span class="linenos">832</span></a>            <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">traffic_regime_1_coeff</span><span class="p">)</span>
</span><span id="Analyzer.get_traffic_emissions_factor-833"><a href="#Analyzer.get_traffic_emissions_factor-833"><span class="linenos">833</span></a>        <span class="k">if</span> <span class="n">regime</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
</span><span id="Analyzer.get_traffic_emissions_factor-834"><a href="#Analyzer.get_traffic_emissions_factor-834"><span class="linenos">834</span></a>            <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">traffic_regime_2_coeff</span><span class="p">)</span>
</span><span id="Analyzer.get_traffic_emissions_factor-835"><a href="#Analyzer.get_traffic_emissions_factor-835"><span class="linenos">835</span></a>        <span class="k">if</span> <span class="n">regime</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
</span><span id="Analyzer.get_traffic_emissions_factor-836"><a href="#Analyzer.get_traffic_emissions_factor-836"><span class="linenos">836</span></a>            <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">traffic_regime_3_coeff</span><span class="p">)</span>
</span><span id="Analyzer.get_traffic_emissions_factor-837"><a href="#Analyzer.get_traffic_emissions_factor-837"><span class="linenos">837</span></a>        <span class="k">return</span> <span class="mf">1.0</span>
</span></pre></div>


            <div class="docstring"><p>Retrieves the emissions factor associated with a given traffic regime.</p>

<p>This method returns a multiplier that adjusts the calculated emissions based on the traffic regime, 
with different factors indicating varying levels of traffic congestion.</p>

<p>Args:
    regime (int): The traffic regime level as determined by get_traffic_regime method.</p>

<p>Returns:
    float: The emissions factor corresponding to the specified traffic regime.</p>
</div>


                            </div>
                            <div id="Analyzer.handle_GAPI_exception" class="classattr">
                                        <input id="Analyzer.handle_GAPI_exception-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">handle_GAPI_exception</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">exception</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Analyzer.handle_GAPI_exception-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Analyzer.handle_GAPI_exception"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Analyzer.handle_GAPI_exception-839"><a href="#Analyzer.handle_GAPI_exception-839"><span class="linenos">839</span></a>    <span class="k">def</span> <span class="nf">handle_GAPI_exception</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exception</span><span class="p">):</span>
</span><span id="Analyzer.handle_GAPI_exception-840"><a href="#Analyzer.handle_GAPI_exception-840"><span class="linenos">840</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Analyzer.handle_GAPI_exception-841"><a href="#Analyzer.handle_GAPI_exception-841"><span class="linenos">841</span></a><span class="sd">        Determines the course of action for a given Google API exception.</span>
</span><span id="Analyzer.handle_GAPI_exception-842"><a href="#Analyzer.handle_GAPI_exception-842"><span class="linenos">842</span></a>
</span><span id="Analyzer.handle_GAPI_exception-843"><a href="#Analyzer.handle_GAPI_exception-843"><span class="linenos">843</span></a><span class="sd">        Based on the type of exception encountered during API calls, this method decides whether the exception is recoverable </span>
</span><span id="Analyzer.handle_GAPI_exception-844"><a href="#Analyzer.handle_GAPI_exception-844"><span class="linenos">844</span></a><span class="sd">        (suggesting a retry might succeed) or if it&#39;s unrecoverable, necessitating alternate handling.</span>
</span><span id="Analyzer.handle_GAPI_exception-845"><a href="#Analyzer.handle_GAPI_exception-845"><span class="linenos">845</span></a>
</span><span id="Analyzer.handle_GAPI_exception-846"><a href="#Analyzer.handle_GAPI_exception-846"><span class="linenos">846</span></a><span class="sd">        Args:</span>
</span><span id="Analyzer.handle_GAPI_exception-847"><a href="#Analyzer.handle_GAPI_exception-847"><span class="linenos">847</span></a><span class="sd">            exception (Exception): The exception encountered during a Google API call.</span>
</span><span id="Analyzer.handle_GAPI_exception-848"><a href="#Analyzer.handle_GAPI_exception-848"><span class="linenos">848</span></a>
</span><span id="Analyzer.handle_GAPI_exception-849"><a href="#Analyzer.handle_GAPI_exception-849"><span class="linenos">849</span></a><span class="sd">        Returns:</span>
</span><span id="Analyzer.handle_GAPI_exception-850"><a href="#Analyzer.handle_GAPI_exception-850"><span class="linenos">850</span></a><span class="sd">            bool: True if the exception is considered recoverable, False otherwise.</span>
</span><span id="Analyzer.handle_GAPI_exception-851"><a href="#Analyzer.handle_GAPI_exception-851"><span class="linenos">851</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Analyzer.handle_GAPI_exception-852"><a href="#Analyzer.handle_GAPI_exception-852"><span class="linenos">852</span></a>
</span><span id="Analyzer.handle_GAPI_exception-853"><a href="#Analyzer.handle_GAPI_exception-853"><span class="linenos">853</span></a>        <span class="c1"># Extract the type of the exception as a string</span>
</span><span id="Analyzer.handle_GAPI_exception-854"><a href="#Analyzer.handle_GAPI_exception-854"><span class="linenos">854</span></a>        <span class="n">exception_type</span> <span class="o">=</span> <span class="n">exception</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span>
</span><span id="Analyzer.handle_GAPI_exception-855"><a href="#Analyzer.handle_GAPI_exception-855"><span class="linenos">855</span></a>        
</span><span id="Analyzer.handle_GAPI_exception-856"><a href="#Analyzer.handle_GAPI_exception-856"><span class="linenos">856</span></a>        <span class="c1"># Check if the exception type is in our predefined dictionary</span>
</span><span id="Analyzer.handle_GAPI_exception-857"><a href="#Analyzer.handle_GAPI_exception-857"><span class="linenos">857</span></a>        <span class="k">if</span> <span class="n">exception_type</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">gAPI</span><span class="o">.</span><span class="n">google_api_exceptions</span><span class="p">:</span>
</span><span id="Analyzer.handle_GAPI_exception-858"><a href="#Analyzer.handle_GAPI_exception-858"><span class="linenos">858</span></a>            <span class="n">action</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gAPI</span><span class="o">.</span><span class="n">google_api_exceptions</span><span class="p">[</span><span class="n">exception_type</span><span class="p">]</span>
</span><span id="Analyzer.handle_GAPI_exception-859"><a href="#Analyzer.handle_GAPI_exception-859"><span class="linenos">859</span></a>            <span class="k">if</span> <span class="n">action</span> <span class="o">==</span> <span class="s1">&#39;recoverable&#39;</span><span class="p">:</span>
</span><span id="Analyzer.handle_GAPI_exception-860"><a href="#Analyzer.handle_GAPI_exception-860"><span class="linenos">860</span></a>                <span class="k">return</span> <span class="kc">True</span>
</span><span id="Analyzer.handle_GAPI_exception-861"><a href="#Analyzer.handle_GAPI_exception-861"><span class="linenos">861</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Analyzer.handle_GAPI_exception-862"><a href="#Analyzer.handle_GAPI_exception-862"><span class="linenos">862</span></a>                <span class="k">return</span> <span class="kc">False</span>
</span><span id="Analyzer.handle_GAPI_exception-863"><a href="#Analyzer.handle_GAPI_exception-863"><span class="linenos">863</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Analyzer.handle_GAPI_exception-864"><a href="#Analyzer.handle_GAPI_exception-864"><span class="linenos">864</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Encountered an undefined exception type (&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">exception</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;). Raising the exception...&quot;</span><span class="p">)</span>
</span><span id="Analyzer.handle_GAPI_exception-865"><a href="#Analyzer.handle_GAPI_exception-865"><span class="linenos">865</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span></pre></div>


            <div class="docstring"><p>Determines the course of action for a given Google API exception.</p>

<p>Based on the type of exception encountered during API calls, this method decides whether the exception is recoverable 
(suggesting a retry might succeed) or if it's unrecoverable, necessitating alternate handling.</p>

<p>Args:
    exception (Exception): The exception encountered during a Google API call.</p>

<p>Returns:
    bool: True if the exception is considered recoverable, False otherwise.</p>
</div>


                            </div>
                            <div id="Analyzer.generate_graphs" class="classattr">
                                        <input id="Analyzer.generate_graphs-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">generate_graphs</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">graph</span><span class="o">=</span><span class="s1">&#39;_all&#39;</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Analyzer.generate_graphs-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Analyzer.generate_graphs"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Analyzer.generate_graphs-867"><a href="#Analyzer.generate_graphs-867"><span class="linenos"> 867</span></a>    <span class="k">def</span> <span class="nf">generate_graphs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">graph</span><span class="o">=</span><span class="s2">&quot;_all&quot;</span><span class="p">):</span>
</span><span id="Analyzer.generate_graphs-868"><a href="#Analyzer.generate_graphs-868"><span class="linenos"> 868</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Analyzer.generate_graphs-869"><a href="#Analyzer.generate_graphs-869"><span class="linenos"> 869</span></a><span class="sd">        Generates and saves graphical representations of analyzed commute data.</span>
</span><span id="Analyzer.generate_graphs-870"><a href="#Analyzer.generate_graphs-870"><span class="linenos"> 870</span></a>
</span><span id="Analyzer.generate_graphs-871"><a href="#Analyzer.generate_graphs-871"><span class="linenos"> 871</span></a><span class="sd">        Based on the available commute data, this method generates graphs such as the geographical distribution </span>
</span><span id="Analyzer.generate_graphs-872"><a href="#Analyzer.generate_graphs-872"><span class="linenos"> 872</span></a><span class="sd">        of analyzed locations and the local analysis of commute geography. It supports generating all graphs or </span>
</span><span id="Analyzer.generate_graphs-873"><a href="#Analyzer.generate_graphs-873"><span class="linenos"> 873</span></a><span class="sd">        a specific one based on the `graph` parameter.</span>
</span><span id="Analyzer.generate_graphs-874"><a href="#Analyzer.generate_graphs-874"><span class="linenos"> 874</span></a>
</span><span id="Analyzer.generate_graphs-875"><a href="#Analyzer.generate_graphs-875"><span class="linenos"> 875</span></a><span class="sd">        Args:</span>
</span><span id="Analyzer.generate_graphs-876"><a href="#Analyzer.generate_graphs-876"><span class="linenos"> 876</span></a><span class="sd">            graph (str, optional): Specifies which graph to generate. Use &quot;_all&quot; to generate all graphs, or specify a </span>
</span><span id="Analyzer.generate_graphs-877"><a href="#Analyzer.generate_graphs-877"><span class="linenos"> 877</span></a><span class="sd">            particular graph&#39;s key. Defaults to &quot;_all&quot;.</span>
</span><span id="Analyzer.generate_graphs-878"><a href="#Analyzer.generate_graphs-878"><span class="linenos"> 878</span></a>
</span><span id="Analyzer.generate_graphs-879"><a href="#Analyzer.generate_graphs-879"><span class="linenos"> 879</span></a><span class="sd">        Returns:</span>
</span><span id="Analyzer.generate_graphs-880"><a href="#Analyzer.generate_graphs-880"><span class="linenos"> 880</span></a><span class="sd">            list: A list of dictionaries, each containing details about the generated graphs, including file paths and titles.</span>
</span><span id="Analyzer.generate_graphs-881"><a href="#Analyzer.generate_graphs-881"><span class="linenos"> 881</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Analyzer.generate_graphs-882"><a href="#Analyzer.generate_graphs-882"><span class="linenos"> 882</span></a>
</span><span id="Analyzer.generate_graphs-883"><a href="#Analyzer.generate_graphs-883"><span class="linenos"> 883</span></a>        <span class="c1"># define a color palette supporting up to 10 unique colors</span>
</span><span id="Analyzer.generate_graphs-884"><a href="#Analyzer.generate_graphs-884"><span class="linenos"> 884</span></a>        <span class="n">color_palette</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;#6e7c8a&#39;</span><span class="p">,</span> <span class="s1">&#39;#90a08f&#39;</span><span class="p">,</span> <span class="s1">&#39;#c3a3a9&#39;</span><span class="p">,</span> <span class="s1">&#39;#b1c5c3&#39;</span><span class="p">,</span> <span class="s1">&#39;#e1c08b&#39;</span><span class="p">,</span> <span class="s1">&#39;#a592ba&#39;</span><span class="p">,</span> <span class="s1">&#39;#a8b1d5&#39;</span><span class="p">,</span> <span class="s1">&#39;#d4abad&#39;</span><span class="p">,</span> <span class="s1">&#39;#c4c38a&#39;</span><span class="p">,</span> <span class="s1">&#39;#ceb2ab&#39;</span><span class="p">]</span>
</span><span id="Analyzer.generate_graphs-885"><a href="#Analyzer.generate_graphs-885"><span class="linenos"> 885</span></a>                        <span class="c1"># lighter pastel [&#39;#7D8A97&#39;, &#39;#A3B0A2&#39;, &#39;#D3BCC0&#39;, &#39;#C9D7D6&#39;, &#39;#EAD2AC&#39;, &#39;#B8A9C9&#39;, &#39;#C5CBE3&#39;, &#39;#E3C8C9&#39;, &#39;#D1D0A3&#39;, &#39;#DECBC6&#39;]</span>
</span><span id="Analyzer.generate_graphs-886"><a href="#Analyzer.generate_graphs-886"><span class="linenos"> 886</span></a>
</span><span id="Analyzer.generate_graphs-887"><a href="#Analyzer.generate_graphs-887"><span class="linenos"> 887</span></a>        <span class="c1"># Create a new list of colors &quot;i&quot; long, recycling colors as needed</span>
</span><span id="Analyzer.generate_graphs-888"><a href="#Analyzer.generate_graphs-888"><span class="linenos"> 888</span></a>        <span class="k">def</span> <span class="nf">colors</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
</span><span id="Analyzer.generate_graphs-889"><a href="#Analyzer.generate_graphs-889"><span class="linenos"> 889</span></a>            <span class="k">return</span> <span class="n">color_palette</span><span class="p">[</span><span class="n">i</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">color_palette</span><span class="p">)]</span>
</span><span id="Analyzer.generate_graphs-890"><a href="#Analyzer.generate_graphs-890"><span class="linenos"> 890</span></a>
</span><span id="Analyzer.generate_graphs-891"><a href="#Analyzer.generate_graphs-891"><span class="linenos"> 891</span></a>        <span class="c1"># generate the graphs for the project</span>
</span><span id="Analyzer.generate_graphs-892"><a href="#Analyzer.generate_graphs-892"><span class="linenos"> 892</span></a>        <span class="c1"># if the commute data isn&#39;t already in the project, load it</span>
</span><span id="Analyzer.generate_graphs-893"><a href="#Analyzer.generate_graphs-893"><span class="linenos"> 893</span></a>        <span class="k">if</span> <span class="s2">&quot;commute_data.csv&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">list_data_files</span><span class="p">():</span>
</span><span id="Analyzer.generate_graphs-894"><a href="#Analyzer.generate_graphs-894"><span class="linenos"> 894</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;commute_data.csv&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Analyzer.generate_graphs-895"><a href="#Analyzer.generate_graphs-895"><span class="linenos"> 895</span></a>                <span class="c1"># attempt to load the commute data</span>
</span><span id="Analyzer.generate_graphs-896"><a href="#Analyzer.generate_graphs-896"><span class="linenos"> 896</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">load_data_file</span><span class="p">(</span><span class="s2">&quot;commute_data.csv&quot;</span><span class="p">):</span>
</span><span id="Analyzer.generate_graphs-897"><a href="#Analyzer.generate_graphs-897"><span class="linenos"> 897</span></a>                    <span class="k">pass</span>
</span><span id="Analyzer.generate_graphs-898"><a href="#Analyzer.generate_graphs-898"><span class="linenos"> 898</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="Analyzer.generate_graphs-899"><a href="#Analyzer.generate_graphs-899"><span class="linenos"> 899</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Errors loading commute data from project.&quot;</span><span class="p">)</span>
</span><span id="Analyzer.generate_graphs-900"><a href="#Analyzer.generate_graphs-900"><span class="linenos"> 900</span></a>                    <span class="k">return</span> <span class="kc">False</span>
</span><span id="Analyzer.generate_graphs-901"><a href="#Analyzer.generate_graphs-901"><span class="linenos"> 901</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Analyzer.generate_graphs-902"><a href="#Analyzer.generate_graphs-902"><span class="linenos"> 902</span></a>                <span class="k">pass</span>
</span><span id="Analyzer.generate_graphs-903"><a href="#Analyzer.generate_graphs-903"><span class="linenos"> 903</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Analyzer.generate_graphs-904"><a href="#Analyzer.generate_graphs-904"><span class="linenos"> 904</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Commute data missing from project.&quot;</span><span class="p">)</span>
</span><span id="Analyzer.generate_graphs-905"><a href="#Analyzer.generate_graphs-905"><span class="linenos"> 905</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="Analyzer.generate_graphs-906"><a href="#Analyzer.generate_graphs-906"><span class="linenos"> 906</span></a>        
</span><span id="Analyzer.generate_graphs-907"><a href="#Analyzer.generate_graphs-907"><span class="linenos"> 907</span></a>        <span class="c1"># create the graphing object</span>
</span><span id="Analyzer.generate_graphs-908"><a href="#Analyzer.generate_graphs-908"><span class="linenos"> 908</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">graphing</span> <span class="o">=</span> <span class="n">Graphing</span><span class="p">()</span>
</span><span id="Analyzer.generate_graphs-909"><a href="#Analyzer.generate_graphs-909"><span class="linenos"> 909</span></a>        
</span><span id="Analyzer.generate_graphs-910"><a href="#Analyzer.generate_graphs-910"><span class="linenos"> 910</span></a>        <span class="c1"># create a list of dicts to map the graphs to return to UI, they will be plotted in the order they are listed</span>
</span><span id="Analyzer.generate_graphs-911"><a href="#Analyzer.generate_graphs-911"><span class="linenos"> 911</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">graph_list</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Analyzer.generate_graphs-912"><a href="#Analyzer.generate_graphs-912"><span class="linenos"> 912</span></a> 
</span><span id="Analyzer.generate_graphs-913"><a href="#Analyzer.generate_graphs-913"><span class="linenos"> 913</span></a>        <span class="c1">### generate the graphs  ###</span>
</span><span id="Analyzer.generate_graphs-914"><a href="#Analyzer.generate_graphs-914"><span class="linenos"> 914</span></a>        <span class="n">plots_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project_directory</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">project_name</span><span class="p">,</span> <span class="s2">&quot;plots&quot;</span><span class="p">)</span>
</span><span id="Analyzer.generate_graphs-915"><a href="#Analyzer.generate_graphs-915"><span class="linenos"> 915</span></a>        <span class="c1"># get the baseline data</span>
</span><span id="Analyzer.generate_graphs-916"><a href="#Analyzer.generate_graphs-916"><span class="linenos"> 916</span></a>        <span class="n">emp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">get_emp_gps</span><span class="p">()</span>
</span><span id="Analyzer.generate_graphs-917"><a href="#Analyzer.generate_graphs-917"><span class="linenos"> 917</span></a>        
</span><span id="Analyzer.generate_graphs-918"><a href="#Analyzer.generate_graphs-918"><span class="linenos"> 918</span></a>        <span class="n">offices</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">get_office_gps</span><span class="p">()</span>
</span><span id="Analyzer.generate_graphs-919"><a href="#Analyzer.generate_graphs-919"><span class="linenos"> 919</span></a>        <span class="n">commute_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">get_commute_data</span><span class="p">()</span>
</span><span id="Analyzer.generate_graphs-920"><a href="#Analyzer.generate_graphs-920"><span class="linenos"> 920</span></a>        
</span><span id="Analyzer.generate_graphs-921"><a href="#Analyzer.generate_graphs-921"><span class="linenos"> 921</span></a>        <span class="c1"># helper function to get a base cost dataframe</span>
</span><span id="Analyzer.generate_graphs-922"><a href="#Analyzer.generate_graphs-922"><span class="linenos"> 922</span></a>        <span class="k">def</span> <span class="nf">get_base_cost_df</span><span class="p">(</span><span class="n">emp</span><span class="p">,</span> <span class="n">officeaddr</span><span class="p">):</span>
</span><span id="Analyzer.generate_graphs-923"><a href="#Analyzer.generate_graphs-923"><span class="linenos"> 923</span></a>            <span class="n">rows</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Analyzer.generate_graphs-924"><a href="#Analyzer.generate_graphs-924"><span class="linenos"> 924</span></a>            <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">emp</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
</span><span id="Analyzer.generate_graphs-925"><a href="#Analyzer.generate_graphs-925"><span class="linenos"> 925</span></a>                <span class="n">cost</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="Analyzer.generate_graphs-926"><a href="#Analyzer.generate_graphs-926"><span class="linenos"> 926</span></a>                <span class="n">rows</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s1">&#39;latitude&#39;</span><span class="p">:</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;latitude&#39;</span><span class="p">],</span><span class="s1">&#39;longitude&#39;</span><span class="p">:</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;longitude&#39;</span><span class="p">],</span><span class="s1">&#39;office&#39;</span><span class="p">:</span><span class="n">officeaddr</span><span class="p">,</span><span class="s1">&#39;cost&#39;</span><span class="p">:</span><span class="n">cost</span><span class="p">})</span>
</span><span id="Analyzer.generate_graphs-927"><a href="#Analyzer.generate_graphs-927"><span class="linenos"> 927</span></a>            <span class="c1">#cost_df = pd.DataFrame(rows)</span>
</span><span id="Analyzer.generate_graphs-928"><a href="#Analyzer.generate_graphs-928"><span class="linenos"> 928</span></a>            <span class="k">return</span> <span class="n">rows</span>
</span><span id="Analyzer.generate_graphs-929"><a href="#Analyzer.generate_graphs-929"><span class="linenos"> 929</span></a>            
</span><span id="Analyzer.generate_graphs-930"><a href="#Analyzer.generate_graphs-930"><span class="linenos"> 930</span></a>        <span class="c1">################################################################################ </span>
</span><span id="Analyzer.generate_graphs-931"><a href="#Analyzer.generate_graphs-931"><span class="linenos"> 931</span></a>        <span class="c1"># GRAPH: </span>
</span><span id="Analyzer.generate_graphs-932"><a href="#Analyzer.generate_graphs-932"><span class="linenos"> 932</span></a>        <span class="c1">## Geographical Distribution of Analyzed Locations</span>
</span><span id="Analyzer.generate_graphs-933"><a href="#Analyzer.generate_graphs-933"><span class="linenos"> 933</span></a>        <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Geographical Distribution of Analyzed Locations&quot;</span>
</span><span id="Analyzer.generate_graphs-934"><a href="#Analyzer.generate_graphs-934"><span class="linenos"> 934</span></a>        <span class="n">key</span> <span class="o">=</span> <span class="s2">&quot;gdal&quot;</span>
</span><span id="Analyzer.generate_graphs-935"><a href="#Analyzer.generate_graphs-935"><span class="linenos"> 935</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">graph_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="p">{</span><span class="s2">&quot;GRAPH&quot;</span><span class="p">:</span> <span class="n">key</span><span class="p">,</span>
</span><span id="Analyzer.generate_graphs-936"><a href="#Analyzer.generate_graphs-936"><span class="linenos"> 936</span></a>                                 <span class="s2">&quot;TITLE&quot;</span><span class="p">:</span> <span class="n">title</span><span class="p">,</span>
</span><span id="Analyzer.generate_graphs-937"><a href="#Analyzer.generate_graphs-937"><span class="linenos"> 937</span></a>                                 <span class="s2">&quot;FILENAME&quot;</span><span class="p">:</span> <span class="n">key</span><span class="o">+</span><span class="s2">&quot;.png&quot;</span><span class="p">,</span>
</span><span id="Analyzer.generate_graphs-938"><a href="#Analyzer.generate_graphs-938"><span class="linenos"> 938</span></a>                                <span class="s2">&quot;PLOT-DESCRIPTION&quot;</span><span class="p">:</span> <span class="s2">&quot;Employee addresses and potential office locations are visualized on a map, &quot;</span> <span class="o">+</span> \
</span><span id="Analyzer.generate_graphs-939"><a href="#Analyzer.generate_graphs-939"><span class="linenos"> 939</span></a>                                    <span class="s2">&quot;including those which may be outside of the commuting radius.  A total of &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">emp</span><span class="p">))</span><span class="o">+</span><span class="s2">&quot; employee addresses &quot;</span> <span class="o">+</span> \
</span><span id="Analyzer.generate_graphs-940"><a href="#Analyzer.generate_graphs-940"><span class="linenos"> 940</span></a>                                    <span class="s2">&quot;and &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">offices</span><span class="p">))</span><span class="o">+</span><span class="s2">&quot; office locations are included in the analysis.&quot;</span>               
</span><span id="Analyzer.generate_graphs-941"><a href="#Analyzer.generate_graphs-941"><span class="linenos"> 941</span></a>                                <span class="p">})</span>
</span><span id="Analyzer.generate_graphs-942"><a href="#Analyzer.generate_graphs-942"><span class="linenos"> 942</span></a>        <span class="k">if</span> <span class="n">graph</span> <span class="o">==</span> <span class="s2">&quot;_all&quot;</span> <span class="ow">or</span> <span class="n">graph</span> <span class="o">==</span> <span class="n">key</span><span class="p">:</span>
</span><span id="Analyzer.generate_graphs-943"><a href="#Analyzer.generate_graphs-943"><span class="linenos"> 943</span></a>            <span class="n">plt</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graphing</span><span class="o">.</span><span class="n">get_map_view</span><span class="p">(</span><span class="n">emp</span><span class="p">,</span> <span class="n">offices</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span> <span class="n">font_mod</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span>
</span><span id="Analyzer.generate_graphs-944"><a href="#Analyzer.generate_graphs-944"><span class="linenos"> 944</span></a>                                                 <span class="n">commute_color</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">commute_data</span><span class="o">=</span><span class="n">commute_data</span><span class="p">,</span> <span class="n">convex_hull</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">size_o</span><span class="o">=</span><span class="mi">400</span><span class="p">,</span> <span class="n">size_e</span><span class="o">=</span><span class="mi">40</span><span class="p">)</span>
</span><span id="Analyzer.generate_graphs-945"><a href="#Analyzer.generate_graphs-945"><span class="linenos"> 945</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">(</span><span class="n">pad</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
</span><span id="Analyzer.generate_graphs-946"><a href="#Analyzer.generate_graphs-946"><span class="linenos"> 946</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">plots_dir</span><span class="o">+</span><span class="s2">&quot;/gdal.png&quot;</span><span class="p">)</span>
</span><span id="Analyzer.generate_graphs-947"><a href="#Analyzer.generate_graphs-947"><span class="linenos"> 947</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="Analyzer.generate_graphs-948"><a href="#Analyzer.generate_graphs-948"><span class="linenos"> 948</span></a>
</span><span id="Analyzer.generate_graphs-949"><a href="#Analyzer.generate_graphs-949"><span class="linenos"> 949</span></a>        <span class="c1">################################################################################</span>
</span><span id="Analyzer.generate_graphs-950"><a href="#Analyzer.generate_graphs-950"><span class="linenos"> 950</span></a>        <span class="c1">### GRAPH SET: Local Analysis for Office X</span>
</span><span id="Analyzer.generate_graphs-951"><a href="#Analyzer.generate_graphs-951"><span class="linenos"> 951</span></a>        <span class="c1"># iterate through offices, generate a graph for each office</span>
</span><span id="Analyzer.generate_graphs-952"><a href="#Analyzer.generate_graphs-952"><span class="linenos"> 952</span></a>        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">offices</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
</span><span id="Analyzer.generate_graphs-953"><a href="#Analyzer.generate_graphs-953"><span class="linenos"> 953</span></a>            <span class="c1">################################################################################ </span>
</span><span id="Analyzer.generate_graphs-954"><a href="#Analyzer.generate_graphs-954"><span class="linenos"> 954</span></a>            <span class="c1"># GRAPH: </span>
</span><span id="Analyzer.generate_graphs-955"><a href="#Analyzer.generate_graphs-955"><span class="linenos"> 955</span></a>            <span class="c1">## Local Analysis for Office X</span>
</span><span id="Analyzer.generate_graphs-956"><a href="#Analyzer.generate_graphs-956"><span class="linenos"> 956</span></a>            <span class="n">key</span> <span class="o">=</span> <span class="s1">&#39;lafo&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
</span><span id="Analyzer.generate_graphs-957"><a href="#Analyzer.generate_graphs-957"><span class="linenos"> 957</span></a>            <span class="n">OfficeAddr</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;address&quot;</span><span class="p">]</span>
</span><span id="Analyzer.generate_graphs-958"><a href="#Analyzer.generate_graphs-958"><span class="linenos"> 958</span></a>            <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;Employee Distribution for &quot;</span><span class="o">+</span><span class="n">OfficeAddr</span>
</span><span id="Analyzer.generate_graphs-959"><a href="#Analyzer.generate_graphs-959"><span class="linenos"> 959</span></a>            <span class="n">short_title</span> <span class="o">=</span> <span class="s2">&quot;Employee Distribution for Office &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">index</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
</span><span id="Analyzer.generate_graphs-960"><a href="#Analyzer.generate_graphs-960"><span class="linenos"> 960</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">graph_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="p">{</span><span class="s2">&quot;GRAPH&quot;</span><span class="p">:</span> <span class="n">key</span><span class="p">,</span>
</span><span id="Analyzer.generate_graphs-961"><a href="#Analyzer.generate_graphs-961"><span class="linenos"> 961</span></a>                                    <span class="s2">&quot;TITLE&quot;</span><span class="p">:</span> <span class="n">short_title</span><span class="p">,</span>
</span><span id="Analyzer.generate_graphs-962"><a href="#Analyzer.generate_graphs-962"><span class="linenos"> 962</span></a>                                    <span class="s2">&quot;FILENAME&quot;</span><span class="p">:</span> <span class="n">key</span><span class="o">+</span><span class="s2">&quot;.png&quot;</span><span class="p">,</span>
</span><span id="Analyzer.generate_graphs-963"><a href="#Analyzer.generate_graphs-963"><span class="linenos"> 963</span></a>                                    <span class="s2">&quot;PLOT-DESCRIPTION&quot;</span><span class="p">:</span> <span class="s2">&quot;This graph displays the commute cutoff distribution for employees relative to the office at &quot;</span><span class="o">+</span><span class="n">OfficeAddr</span><span class="o">+</span><span class="s2">&quot;. &quot;</span> <span class="o">+</span> \
</span><span id="Analyzer.generate_graphs-964"><a href="#Analyzer.generate_graphs-964"><span class="linenos"> 964</span></a>                                                        <span class="s2">&quot;The cutoff distance is &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">commute_range_cut_off</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot; miles. The circle represents the linear distance &quot;</span> <span class="o">+</span> \
</span><span id="Analyzer.generate_graphs-965"><a href="#Analyzer.generate_graphs-965"><span class="linenos"> 965</span></a>                                                        <span class="s2">&quot;but more importantly is the actual driving distance represented by the convex hull, the shape of which is a result of &quot;</span> <span class="o">+</span> \
</span><span id="Analyzer.generate_graphs-966"><a href="#Analyzer.generate_graphs-966"><span class="linenos"> 966</span></a>                                                        <span class="s2">&quot;roadway complexities.  The bounded region will vary widely between offices analyzed.&quot;</span>
</span><span id="Analyzer.generate_graphs-967"><a href="#Analyzer.generate_graphs-967"><span class="linenos"> 967</span></a>                                                        
</span><span id="Analyzer.generate_graphs-968"><a href="#Analyzer.generate_graphs-968"><span class="linenos"> 968</span></a>                                    <span class="p">})</span>
</span><span id="Analyzer.generate_graphs-969"><a href="#Analyzer.generate_graphs-969"><span class="linenos"> 969</span></a>            <span class="k">if</span> <span class="n">graph</span> <span class="o">==</span> <span class="s2">&quot;_all&quot;</span> <span class="ow">or</span> <span class="n">graph</span> <span class="o">==</span> <span class="n">key</span><span class="p">:</span>
</span><span id="Analyzer.generate_graphs-970"><a href="#Analyzer.generate_graphs-970"><span class="linenos"> 970</span></a>                <span class="c1">#just get the first office row</span>
</span><span id="Analyzer.generate_graphs-971"><a href="#Analyzer.generate_graphs-971"><span class="linenos"> 971</span></a>                <span class="c1">#offices = pd.DataFrame(offices.iloc[0],offices.columns).reset_index(drop=True)</span>
</span><span id="Analyzer.generate_graphs-972"><a href="#Analyzer.generate_graphs-972"><span class="linenos"> 972</span></a>                <span class="n">office</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">to_frame</span><span class="p">()</span><span class="o">.</span><span class="n">T</span>
</span><span id="Analyzer.generate_graphs-973"><a href="#Analyzer.generate_graphs-973"><span class="linenos"> 973</span></a>                <span class="n">plt</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graphing</span><span class="o">.</span><span class="n">get_map_view</span><span class="p">(</span><span class="n">emp</span><span class="p">,</span> <span class="n">office</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Employee Distribution for </span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">+</span><span class="n">OfficeAddr</span><span class="p">,</span> 
</span><span id="Analyzer.generate_graphs-974"><a href="#Analyzer.generate_graphs-974"><span class="linenos"> 974</span></a>                                                    <span class="n">cutoff_distance</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">commute_range_cut_off</span><span class="o">*</span><span class="mi">2</span><span class="p">,</span>
</span><span id="Analyzer.generate_graphs-975"><a href="#Analyzer.generate_graphs-975"><span class="linenos"> 975</span></a>                                                    <span class="n">commute_radius</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">commute_range_cut_off</span><span class="p">,</span> <span class="n">font_mod</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span>
</span><span id="Analyzer.generate_graphs-976"><a href="#Analyzer.generate_graphs-976"><span class="linenos"> 976</span></a>                                                    <span class="n">commute_color</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">commute_data</span><span class="o">=</span><span class="n">commute_data</span><span class="p">,</span> <span class="n">convex_hull</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">legend_loc</span><span class="o">=</span><span class="s1">&#39;lower right&#39;</span><span class="p">)</span>
</span><span id="Analyzer.generate_graphs-977"><a href="#Analyzer.generate_graphs-977"><span class="linenos"> 977</span></a>                <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">(</span><span class="n">pad</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
</span><span id="Analyzer.generate_graphs-978"><a href="#Analyzer.generate_graphs-978"><span class="linenos"> 978</span></a>                <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">plots_dir</span><span class="o">+</span><span class="s2">&quot;/&quot;</span><span class="o">+</span><span class="n">key</span><span class="o">+</span><span class="s2">&quot;.png&quot;</span><span class="p">)</span>
</span><span id="Analyzer.generate_graphs-979"><a href="#Analyzer.generate_graphs-979"><span class="linenos"> 979</span></a>                <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="Analyzer.generate_graphs-980"><a href="#Analyzer.generate_graphs-980"><span class="linenos"> 980</span></a>
</span><span id="Analyzer.generate_graphs-981"><a href="#Analyzer.generate_graphs-981"><span class="linenos"> 981</span></a>                <span class="c1"># get the employees within the cutoff distance by driving distance, then add the count to the plot description</span>
</span><span id="Analyzer.generate_graphs-982"><a href="#Analyzer.generate_graphs-982"><span class="linenos"> 982</span></a>                <span class="n">emp_within</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graphing</span><span class="o">.</span><span class="n">filter_drive_distance</span><span class="p">(</span><span class="n">emp</span><span class="p">,</span><span class="n">office</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">commute_range_cut_off</span><span class="p">,</span> <span class="n">commute_data</span><span class="o">=</span><span class="n">commute_data</span><span class="p">)</span>
</span><span id="Analyzer.generate_graphs-983"><a href="#Analyzer.generate_graphs-983"><span class="linenos"> 983</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">graph_list</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;PLOT-DESCRIPTION&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph_list</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;PLOT-DESCRIPTION&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot; There are &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">emp_within</span><span class="p">))</span> <span class="o">+</span> \
</span><span id="Analyzer.generate_graphs-984"><a href="#Analyzer.generate_graphs-984"><span class="linenos"> 984</span></a>                                                                <span class="s2">&quot; of the total &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">emp</span><span class="p">))</span> <span class="o">+</span> <span class="s2">&quot; employees within the cutoff distance, a total of &quot;</span> <span class="o">+</span> \
</span><span id="Analyzer.generate_graphs-985"><a href="#Analyzer.generate_graphs-985"><span class="linenos"> 985</span></a>                                                                <span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">emp_within</span><span class="p">)</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">emp</span><span class="p">)</span><span class="o">*</span><span class="mi">100</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="si">% o</span><span class="s2">f the total employees.&quot;</span>
</span><span id="Analyzer.generate_graphs-986"><a href="#Analyzer.generate_graphs-986"><span class="linenos"> 986</span></a>
</span><span id="Analyzer.generate_graphs-987"><a href="#Analyzer.generate_graphs-987"><span class="linenos"> 987</span></a>        <span class="c1">################################################################################ </span>
</span><span id="Analyzer.generate_graphs-988"><a href="#Analyzer.generate_graphs-988"><span class="linenos"> 988</span></a>        <span class="c1"># GRAPH: </span>
</span><span id="Analyzer.generate_graphs-989"><a href="#Analyzer.generate_graphs-989"><span class="linenos"> 989</span></a>        <span class="c1">## Local Analysis of Commute Geography</span>
</span><span id="Analyzer.generate_graphs-990"><a href="#Analyzer.generate_graphs-990"><span class="linenos"> 990</span></a>        <span class="n">key</span> <span class="o">=</span> <span class="s1">&#39;lacg&#39;</span>
</span><span id="Analyzer.generate_graphs-991"><a href="#Analyzer.generate_graphs-991"><span class="linenos"> 991</span></a>        <span class="c1">#OfficeAddr = row[&quot;address&quot;]</span>
</span><span id="Analyzer.generate_graphs-992"><a href="#Analyzer.generate_graphs-992"><span class="linenos"> 992</span></a>        <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;Local Analysis of Commute Geography&quot;</span>
</span><span id="Analyzer.generate_graphs-993"><a href="#Analyzer.generate_graphs-993"><span class="linenos"> 993</span></a>        <span class="n">short_title</span> <span class="o">=</span> <span class="n">title</span>
</span><span id="Analyzer.generate_graphs-994"><a href="#Analyzer.generate_graphs-994"><span class="linenos"> 994</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">graph_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="p">{</span><span class="s2">&quot;GRAPH&quot;</span><span class="p">:</span> <span class="n">key</span><span class="p">,</span>
</span><span id="Analyzer.generate_graphs-995"><a href="#Analyzer.generate_graphs-995"><span class="linenos"> 995</span></a>                                <span class="s2">&quot;TITLE&quot;</span><span class="p">:</span> <span class="n">short_title</span><span class="p">,</span>
</span><span id="Analyzer.generate_graphs-996"><a href="#Analyzer.generate_graphs-996"><span class="linenos"> 996</span></a>                                <span class="s2">&quot;FILENAME&quot;</span><span class="p">:</span> <span class="n">key</span><span class="o">+</span><span class="s2">&quot;.png&quot;</span><span class="p">,</span>
</span><span id="Analyzer.generate_graphs-997"><a href="#Analyzer.generate_graphs-997"><span class="linenos"> 997</span></a>                                <span class="s2">&quot;PLOT-DESCRIPTION&quot;</span><span class="p">:</span> <span class="s2">&quot;The graph displays several key observations.  Firstly, the green points are employees whose remote work &quot;</span> <span class="o">+</span> \
</span><span id="Analyzer.generate_graphs-998"><a href="#Analyzer.generate_graphs-998"><span class="linenos"> 998</span></a>                                                    <span class="s2">&quot;status will be unaffected by the relocation. The red points within the green convex hull will have remote &quot;</span> <span class="o">+</span> \
</span><span id="Analyzer.generate_graphs-999"><a href="#Analyzer.generate_graphs-999"><span class="linenos"> 999</span></a>                                                    <span class="s2">&quot;work status affected by the relocation while those outside the green convex hull remain unaffected by all scenarios. &quot;</span> <span class="o">+</span> \
</span><span id="Analyzer.generate_graphs-1000"><a href="#Analyzer.generate_graphs-1000"><span class="linenos">1000</span></a>                                                    <span class="s2">&quot;Black circles represent a bounding linear distance of &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">commute_range_cut_off</span><span class="p">)</span> <span class="o">+</span><span class="s2">&quot; miles from each office options for perspective.&quot;</span>
</span><span id="Analyzer.generate_graphs-1001"><a href="#Analyzer.generate_graphs-1001"><span class="linenos">1001</span></a>                                <span class="p">})</span>
</span><span id="Analyzer.generate_graphs-1002"><a href="#Analyzer.generate_graphs-1002"><span class="linenos">1002</span></a>        <span class="k">if</span> <span class="n">graph</span> <span class="o">==</span> <span class="s2">&quot;_all&quot;</span> <span class="ow">or</span> <span class="n">graph</span> <span class="o">==</span> <span class="n">key</span><span class="p">:</span>
</span><span id="Analyzer.generate_graphs-1003"><a href="#Analyzer.generate_graphs-1003"><span class="linenos">1003</span></a>            <span class="n">plt</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graphing</span><span class="o">.</span><span class="n">get_map_view</span><span class="p">(</span><span class="n">emp</span><span class="p">,</span> <span class="n">offices</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span> 
</span><span id="Analyzer.generate_graphs-1004"><a href="#Analyzer.generate_graphs-1004"><span class="linenos">1004</span></a>                                                 <span class="n">cutoff_radius</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">commute_range_cut_off</span><span class="o">*</span><span class="mi">2</span><span class="p">,</span>
</span><span id="Analyzer.generate_graphs-1005"><a href="#Analyzer.generate_graphs-1005"><span class="linenos">1005</span></a>                                                 <span class="n">commute_radius</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">commute_range_cut_off</span><span class="p">,</span> <span class="n">legend_loc</span><span class="o">=</span><span class="s1">&#39;lower left&#39;</span><span class="p">,</span> <span class="n">font_mod</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span>
</span><span id="Analyzer.generate_graphs-1006"><a href="#Analyzer.generate_graphs-1006"><span class="linenos">1006</span></a>                                                 <span class="n">commute_color</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">commute_data</span><span class="o">=</span><span class="n">commute_data</span><span class="p">,</span> <span class="n">convex_hull</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">size_o</span><span class="o">=</span><span class="mi">500</span><span class="p">)</span>
</span><span id="Analyzer.generate_graphs-1007"><a href="#Analyzer.generate_graphs-1007"><span class="linenos">1007</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">(</span><span class="n">pad</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
</span><span id="Analyzer.generate_graphs-1008"><a href="#Analyzer.generate_graphs-1008"><span class="linenos">1008</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">plots_dir</span><span class="o">+</span><span class="s2">&quot;/&quot;</span><span class="o">+</span><span class="n">key</span><span class="o">+</span><span class="s2">&quot;.png&quot;</span><span class="p">)</span>
</span><span id="Analyzer.generate_graphs-1009"><a href="#Analyzer.generate_graphs-1009"><span class="linenos">1009</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="Analyzer.generate_graphs-1010"><a href="#Analyzer.generate_graphs-1010"><span class="linenos">1010</span></a>
</span><span id="Analyzer.generate_graphs-1011"><a href="#Analyzer.generate_graphs-1011"><span class="linenos">1011</span></a>
</span><span id="Analyzer.generate_graphs-1012"><a href="#Analyzer.generate_graphs-1012"><span class="linenos">1012</span></a>        <span class="c1">################################################################################ </span>
</span><span id="Analyzer.generate_graphs-1013"><a href="#Analyzer.generate_graphs-1013"><span class="linenos">1013</span></a>        <span class="c1"># GRAPH: </span>
</span><span id="Analyzer.generate_graphs-1014"><a href="#Analyzer.generate_graphs-1014"><span class="linenos">1014</span></a>        <span class="c1">## Employees Impacted by Remote Work Policy &amp; Relocation</span>
</span><span id="Analyzer.generate_graphs-1015"><a href="#Analyzer.generate_graphs-1015"><span class="linenos">1015</span></a>        <span class="n">key</span> <span class="o">=</span> <span class="s1">&#39;lacg2&#39;</span>
</span><span id="Analyzer.generate_graphs-1016"><a href="#Analyzer.generate_graphs-1016"><span class="linenos">1016</span></a>        <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;Employees Impacted by Remote Work Policy &amp; Relocation&quot;</span>
</span><span id="Analyzer.generate_graphs-1017"><a href="#Analyzer.generate_graphs-1017"><span class="linenos">1017</span></a>        <span class="n">short_title</span> <span class="o">=</span> <span class="n">title</span>
</span><span id="Analyzer.generate_graphs-1018"><a href="#Analyzer.generate_graphs-1018"><span class="linenos">1018</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">graph_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="p">{</span><span class="s2">&quot;GRAPH&quot;</span><span class="p">:</span> <span class="n">key</span><span class="p">,</span>
</span><span id="Analyzer.generate_graphs-1019"><a href="#Analyzer.generate_graphs-1019"><span class="linenos">1019</span></a>                                <span class="s2">&quot;TITLE&quot;</span><span class="p">:</span> <span class="n">short_title</span><span class="p">,</span>
</span><span id="Analyzer.generate_graphs-1020"><a href="#Analyzer.generate_graphs-1020"><span class="linenos">1020</span></a>                                <span class="s2">&quot;FILENAME&quot;</span><span class="p">:</span> <span class="n">key</span><span class="o">+</span><span class="s2">&quot;.png&quot;</span><span class="p">,</span>
</span><span id="Analyzer.generate_graphs-1021"><a href="#Analyzer.generate_graphs-1021"><span class="linenos">1021</span></a>                                <span class="s2">&quot;PLOT-DESCRIPTION&quot;</span><span class="p">:</span> <span class="s2">&quot;deferred&quot;</span>                                
</span><span id="Analyzer.generate_graphs-1022"><a href="#Analyzer.generate_graphs-1022"><span class="linenos">1022</span></a>                                <span class="p">})</span>
</span><span id="Analyzer.generate_graphs-1023"><a href="#Analyzer.generate_graphs-1023"><span class="linenos">1023</span></a>        
</span><span id="Analyzer.generate_graphs-1024"><a href="#Analyzer.generate_graphs-1024"><span class="linenos">1024</span></a>        <span class="k">if</span> <span class="n">graph</span> <span class="o">==</span> <span class="s2">&quot;_all&quot;</span> <span class="ow">or</span> <span class="n">graph</span> <span class="o">==</span> <span class="n">key</span><span class="p">:</span>
</span><span id="Analyzer.generate_graphs-1025"><a href="#Analyzer.generate_graphs-1025"><span class="linenos">1025</span></a>            <span class="n">plt</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graphing</span><span class="o">.</span><span class="n">get_map_view</span><span class="p">(</span><span class="n">emp</span><span class="p">,</span> <span class="n">offices</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span> <span class="n">font_mod</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span>
</span><span id="Analyzer.generate_graphs-1026"><a href="#Analyzer.generate_graphs-1026"><span class="linenos">1026</span></a>                                                 <span class="n">cutoff_radius</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">commute_range_cut_off</span><span class="o">*</span><span class="mf">1.2</span><span class="p">,</span>
</span><span id="Analyzer.generate_graphs-1027"><a href="#Analyzer.generate_graphs-1027"><span class="linenos">1027</span></a>                                                 <span class="n">commute_radius</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">commute_range_cut_off</span><span class="p">,</span> 
</span><span id="Analyzer.generate_graphs-1028"><a href="#Analyzer.generate_graphs-1028"><span class="linenos">1028</span></a>                                                 <span class="n">commute_color</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">commute_data</span><span class="o">=</span><span class="n">commute_data</span><span class="p">,</span> <span class="n">convex_hull</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">size_o</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span> <span class="n">manual_plot</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="Analyzer.generate_graphs-1029"><a href="#Analyzer.generate_graphs-1029"><span class="linenos">1029</span></a>            
</span><span id="Analyzer.generate_graphs-1030"><a href="#Analyzer.generate_graphs-1030"><span class="linenos">1030</span></a>            <span class="n">emp_within</span><span class="p">,</span> <span class="n">emp_outside</span><span class="p">,</span> <span class="n">emp_overlap</span><span class="p">,</span> <span class="n">emp_within_all</span><span class="p">,</span> <span class="n">emp_outside_all</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
</span><span id="Analyzer.generate_graphs-1031"><a href="#Analyzer.generate_graphs-1031"><span class="linenos">1031</span></a>            
</span><span id="Analyzer.generate_graphs-1032"><a href="#Analyzer.generate_graphs-1032"><span class="linenos">1032</span></a>            <span class="n">emp_within</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graphing</span><span class="o">.</span><span class="n">filter_drive_distance</span><span class="p">(</span><span class="n">emp</span><span class="p">,</span><span class="n">offices</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">commute_range_cut_off</span><span class="p">,</span> <span class="n">commute_data</span><span class="o">=</span><span class="n">commute_data</span><span class="p">,</span> <span class="n">inside</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="Analyzer.generate_graphs-1033"><a href="#Analyzer.generate_graphs-1033"><span class="linenos">1033</span></a>            <span class="n">emp_outside</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graphing</span><span class="o">.</span><span class="n">filter_drive_distance</span><span class="p">(</span><span class="n">emp</span><span class="p">,</span><span class="n">offices</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">commute_range_cut_off</span><span class="p">,</span> <span class="n">commute_data</span><span class="o">=</span><span class="n">commute_data</span><span class="p">,</span> <span class="n">inside</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="Analyzer.generate_graphs-1034"><a href="#Analyzer.generate_graphs-1034"><span class="linenos">1034</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">emp_within</span><span class="o">.</span><span class="n">empty</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">emp_outside</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>                
</span><span id="Analyzer.generate_graphs-1035"><a href="#Analyzer.generate_graphs-1035"><span class="linenos">1035</span></a>                <span class="n">emp_overlap</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graphing</span><span class="o">.</span><span class="n">get_common_points</span><span class="p">(</span><span class="n">emp_within</span><span class="p">,</span><span class="n">emp_outside</span><span class="p">)</span>
</span><span id="Analyzer.generate_graphs-1036"><a href="#Analyzer.generate_graphs-1036"><span class="linenos">1036</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">emp_within</span><span class="o">.</span><span class="n">empty</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">emp_outside</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
</span><span id="Analyzer.generate_graphs-1037"><a href="#Analyzer.generate_graphs-1037"><span class="linenos">1037</span></a>                <span class="n">emp_outside_all</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graphing</span><span class="o">.</span><span class="n">get_unique_points</span><span class="p">(</span><span class="n">emp_outside</span><span class="p">,</span><span class="n">emp_overlap</span><span class="p">)</span>
</span><span id="Analyzer.generate_graphs-1038"><a href="#Analyzer.generate_graphs-1038"><span class="linenos">1038</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">emp_within</span><span class="o">.</span><span class="n">empty</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">emp_outside</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
</span><span id="Analyzer.generate_graphs-1039"><a href="#Analyzer.generate_graphs-1039"><span class="linenos">1039</span></a>                <span class="n">emp_within_all</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graphing</span><span class="o">.</span><span class="n">get_unique_points</span><span class="p">(</span><span class="n">emp_within</span><span class="p">,</span><span class="n">emp_overlap</span><span class="p">)</span>
</span><span id="Analyzer.generate_graphs-1040"><a href="#Analyzer.generate_graphs-1040"><span class="linenos">1040</span></a>            <span class="n">emp_within_list</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Analyzer.generate_graphs-1041"><a href="#Analyzer.generate_graphs-1041"><span class="linenos">1041</span></a>            <span class="n">hullvars</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;color&quot;</span><span class="p">:</span><span class="s2">&quot;red&quot;</span><span class="p">,</span><span class="s2">&quot;linewidth&quot;</span><span class="p">:</span><span class="mi">50</span><span class="p">,</span><span class="s2">&quot;alpha&quot;</span><span class="p">:</span><span class="mf">0.07</span><span class="p">}</span>
</span><span id="Analyzer.generate_graphs-1042"><a href="#Analyzer.generate_graphs-1042"><span class="linenos">1042</span></a>            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">offices</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
</span><span id="Analyzer.generate_graphs-1043"><a href="#Analyzer.generate_graphs-1043"><span class="linenos">1043</span></a>                <span class="n">office</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">to_frame</span><span class="p">()</span><span class="o">.</span><span class="n">T</span>
</span><span id="Analyzer.generate_graphs-1044"><a href="#Analyzer.generate_graphs-1044"><span class="linenos">1044</span></a>                <span class="n">emp_within_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">graphing</span><span class="o">.</span><span class="n">filter_drive_distance</span><span class="p">(</span><span class="n">emp</span><span class="p">,</span><span class="n">office</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">commute_range_cut_off</span><span class="p">,</span> <span class="n">commute_data</span><span class="o">=</span><span class="n">commute_data</span><span class="p">,</span> <span class="n">inside</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
</span><span id="Analyzer.generate_graphs-1045"><a href="#Analyzer.generate_graphs-1045"><span class="linenos">1045</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">graphing</span><span class="o">.</span><span class="n">plot_convex_hull</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">emp_within_list</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="o">**</span><span class="n">hullvars</span><span class="p">)</span>
</span><span id="Analyzer.generate_graphs-1046"><a href="#Analyzer.generate_graphs-1046"><span class="linenos">1046</span></a>
</span><span id="Analyzer.generate_graphs-1047"><a href="#Analyzer.generate_graphs-1047"><span class="linenos">1047</span></a>            <span class="c1"># plot the points</span>
</span><span id="Analyzer.generate_graphs-1048"><a href="#Analyzer.generate_graphs-1048"><span class="linenos">1048</span></a>            <span class="k">if</span> <span class="n">emp_within_all</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">emp_within_all</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
</span><span id="Analyzer.generate_graphs-1049"><a href="#Analyzer.generate_graphs-1049"><span class="linenos">1049</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">graphing</span><span class="o">.</span><span class="n">plot_addresses</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">emp_within_all</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Unaffected by </span><span class="se">\n</span><span class="s2">Relocation Decision&quot;</span><span class="p">)</span>
</span><span id="Analyzer.generate_graphs-1050"><a href="#Analyzer.generate_graphs-1050"><span class="linenos">1050</span></a>            <span class="c1">#if emp_outside_all is not None and not emp_outside_all.empty:</span>
</span><span id="Analyzer.generate_graphs-1051"><a href="#Analyzer.generate_graphs-1051"><span class="linenos">1051</span></a>                <span class="c1">#self.graphing.plot_addresses(ax, emp_outside_all,color=&#39;gray&#39;,label=&quot;Outside Commute \nRadius for Offices&quot;)</span>
</span><span id="Analyzer.generate_graphs-1052"><a href="#Analyzer.generate_graphs-1052"><span class="linenos">1052</span></a>            <span class="k">if</span> <span class="n">emp_overlap</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">emp_overlap</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
</span><span id="Analyzer.generate_graphs-1053"><a href="#Analyzer.generate_graphs-1053"><span class="linenos">1053</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">graphing</span><span class="o">.</span><span class="n">plot_addresses</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">emp_overlap</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span><span class="n">s</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Impacted by </span><span class="se">\n</span><span class="s2">Relocation Decision&quot;</span><span class="p">)</span>
</span><span id="Analyzer.generate_graphs-1054"><a href="#Analyzer.generate_graphs-1054"><span class="linenos">1054</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">graphing</span><span class="o">.</span><span class="n">plot_offices</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">offices</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">400</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Potential Office Locations&quot;</span><span class="p">)</span>
</span><span id="Analyzer.generate_graphs-1055"><a href="#Analyzer.generate_graphs-1055"><span class="linenos">1055</span></a>            <span class="k">if</span> <span class="n">emp_within_all</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">emp_within_all</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
</span><span id="Analyzer.generate_graphs-1056"><a href="#Analyzer.generate_graphs-1056"><span class="linenos">1056</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">graphing</span><span class="o">.</span><span class="n">plot_convex_hull</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">emp_within_all</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>
</span><span id="Analyzer.generate_graphs-1057"><a href="#Analyzer.generate_graphs-1057"><span class="linenos">1057</span></a>            <span class="k">if</span> <span class="n">emp_overlap</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">emp_overlap</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
</span><span id="Analyzer.generate_graphs-1058"><a href="#Analyzer.generate_graphs-1058"><span class="linenos">1058</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">graphing</span><span class="o">.</span><span class="n">plot_convex_hull</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">emp_overlap</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">)</span>
</span><span id="Analyzer.generate_graphs-1059"><a href="#Analyzer.generate_graphs-1059"><span class="linenos">1059</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">graphing</span><span class="o">.</span><span class="n">add_scalebar</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span><span class="n">font_mod</span><span class="o">=</span><span class="mf">1.5</span><span class="p">)</span>
</span><span id="Analyzer.generate_graphs-1060"><a href="#Analyzer.generate_graphs-1060"><span class="linenos">1060</span></a>            <span class="c1"># add legend</span>
</span><span id="Analyzer.generate_graphs-1061"><a href="#Analyzer.generate_graphs-1061"><span class="linenos">1061</span></a>            <span class="n">handles</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">get_legend_handles_labels</span><span class="p">()</span>
</span><span id="Analyzer.generate_graphs-1062"><a href="#Analyzer.generate_graphs-1062"><span class="linenos">1062</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">graphing</span><span class="o">.</span><span class="n">map_view_standard_legend</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">handles</span><span class="p">,</span> <span class="n">labels</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
</span><span id="Analyzer.generate_graphs-1063"><a href="#Analyzer.generate_graphs-1063"><span class="linenos">1063</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">25</span><span class="p">)</span>
</span><span id="Analyzer.generate_graphs-1064"><a href="#Analyzer.generate_graphs-1064"><span class="linenos">1064</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">(</span><span class="n">pad</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
</span><span id="Analyzer.generate_graphs-1065"><a href="#Analyzer.generate_graphs-1065"><span class="linenos">1065</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">plots_dir</span><span class="o">+</span><span class="s2">&quot;/&quot;</span><span class="o">+</span><span class="n">key</span><span class="o">+</span><span class="s2">&quot;.png&quot;</span><span class="p">)</span>
</span><span id="Analyzer.generate_graphs-1066"><a href="#Analyzer.generate_graphs-1066"><span class="linenos">1066</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="Analyzer.generate_graphs-1067"><a href="#Analyzer.generate_graphs-1067"><span class="linenos">1067</span></a>            
</span><span id="Analyzer.generate_graphs-1068"><a href="#Analyzer.generate_graphs-1068"><span class="linenos">1068</span></a>
</span><span id="Analyzer.generate_graphs-1069"><a href="#Analyzer.generate_graphs-1069"><span class="linenos">1069</span></a>            <span class="c1"># udpate the plot description</span>
</span><span id="Analyzer.generate_graphs-1070"><a href="#Analyzer.generate_graphs-1070"><span class="linenos">1070</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">graph_list</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;PLOT-DESCRIPTION&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;This graph displays the &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="mi">0</span> <span class="k">if</span> <span class="n">emp_overlap</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">emp_overlap</span><span class="o">.</span><span class="n">empty</span> <span class="k">else</span> <span class="nb">len</span><span class="p">(</span><span class="n">emp_overlap</span><span class="p">))</span> <span class="o">+</span> <span class="s2">&quot; employees that are impacted by the relocaiton.  &quot;</span> <span class="o">+</span> \
</span><span id="Analyzer.generate_graphs-1071"><a href="#Analyzer.generate_graphs-1071"><span class="linenos">1071</span></a>                                <span class="s2">&quot;Specifically, the red indicates employees that either rotate into, or out of the remote work policy by cutoff-distance. This is &quot;</span> <span class="o">+</span> \
</span><span id="Analyzer.generate_graphs-1072"><a href="#Analyzer.generate_graphs-1072"><span class="linenos">1072</span></a>                                <span class="nb">str</span><span class="p">(</span><span class="mi">0</span> <span class="k">if</span> <span class="n">emp_overlap</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">emp_overlap</span><span class="o">.</span><span class="n">empty</span> <span class="k">else</span> <span class="nb">round</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">emp_overlap</span><span class="p">)</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">emp</span><span class="p">)</span><span class="o">*</span><span class="mi">100</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="si">% o</span><span class="s2">f the total employees.  &quot;</span>
</span><span id="Analyzer.generate_graphs-1073"><a href="#Analyzer.generate_graphs-1073"><span class="linenos">1073</span></a>        
</span><span id="Analyzer.generate_graphs-1074"><a href="#Analyzer.generate_graphs-1074"><span class="linenos">1074</span></a>
</span><span id="Analyzer.generate_graphs-1075"><a href="#Analyzer.generate_graphs-1075"><span class="linenos">1075</span></a>        <span class="c1">################################################################################ </span>
</span><span id="Analyzer.generate_graphs-1076"><a href="#Analyzer.generate_graphs-1076"><span class="linenos">1076</span></a>        <span class="c1"># GRAPH: </span>
</span><span id="Analyzer.generate_graphs-1077"><a href="#Analyzer.generate_graphs-1077"><span class="linenos">1077</span></a>        <span class="c1">## Baseline Commute Cost Analysis</span>
</span><span id="Analyzer.generate_graphs-1078"><a href="#Analyzer.generate_graphs-1078"><span class="linenos">1078</span></a>        <span class="n">key</span> <span class="o">=</span> <span class="s1">&#39;bcca&#39;</span>
</span><span id="Analyzer.generate_graphs-1079"><a href="#Analyzer.generate_graphs-1079"><span class="linenos">1079</span></a>        <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;Baseline Commute Cost Analysis&quot;</span>
</span><span id="Analyzer.generate_graphs-1080"><a href="#Analyzer.generate_graphs-1080"><span class="linenos">1080</span></a>        <span class="n">short_title</span> <span class="o">=</span> <span class="n">title</span>
</span><span id="Analyzer.generate_graphs-1081"><a href="#Analyzer.generate_graphs-1081"><span class="linenos">1081</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">graph_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="p">{</span><span class="s2">&quot;GRAPH&quot;</span><span class="p">:</span> <span class="n">key</span><span class="p">,</span>
</span><span id="Analyzer.generate_graphs-1082"><a href="#Analyzer.generate_graphs-1082"><span class="linenos">1082</span></a>                                <span class="s2">&quot;TITLE&quot;</span><span class="p">:</span> <span class="n">short_title</span><span class="p">,</span>
</span><span id="Analyzer.generate_graphs-1083"><a href="#Analyzer.generate_graphs-1083"><span class="linenos">1083</span></a>                                <span class="s2">&quot;FILENAME&quot;</span><span class="p">:</span> <span class="n">key</span><span class="o">+</span><span class="s2">&quot;.png&quot;</span><span class="p">,</span>
</span><span id="Analyzer.generate_graphs-1084"><a href="#Analyzer.generate_graphs-1084"><span class="linenos">1084</span></a>                                <span class="s2">&quot;PLOT-DESCRIPTION&quot;</span><span class="p">:</span> <span class="s2">&quot;deferred&quot;</span>
</span><span id="Analyzer.generate_graphs-1085"><a href="#Analyzer.generate_graphs-1085"><span class="linenos">1085</span></a>                                <span class="p">})</span>
</span><span id="Analyzer.generate_graphs-1086"><a href="#Analyzer.generate_graphs-1086"><span class="linenos">1086</span></a>        
</span><span id="Analyzer.generate_graphs-1087"><a href="#Analyzer.generate_graphs-1087"><span class="linenos">1087</span></a>        <span class="k">if</span> <span class="n">graph</span> <span class="o">==</span> <span class="s2">&quot;_all&quot;</span> <span class="ow">or</span> <span class="n">graph</span> <span class="o">==</span> <span class="n">key</span><span class="p">:</span>
</span><span id="Analyzer.generate_graphs-1088"><a href="#Analyzer.generate_graphs-1088"><span class="linenos">1088</span></a>            <span class="c1"># get the value to plot</span>
</span><span id="Analyzer.generate_graphs-1089"><a href="#Analyzer.generate_graphs-1089"><span class="linenos">1089</span></a>            <span class="n">value</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;commute_cost&#39;</span><span class="p">]</span>
</span><span id="Analyzer.generate_graphs-1090"><a href="#Analyzer.generate_graphs-1090"><span class="linenos">1090</span></a>            <span class="c1"># baseline will be first office, assumed to be the current office, or &quot;as is use case&quot;</span>
</span><span id="Analyzer.generate_graphs-1091"><a href="#Analyzer.generate_graphs-1091"><span class="linenos">1091</span></a>            <span class="n">office</span> <span class="o">=</span> <span class="n">offices</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">to_frame</span><span class="p">()</span><span class="o">.</span><span class="n">T</span>
</span><span id="Analyzer.generate_graphs-1092"><a href="#Analyzer.generate_graphs-1092"><span class="linenos">1092</span></a>            <span class="c1"># employees to analyze are within the cutoff distance for this office</span>
</span><span id="Analyzer.generate_graphs-1093"><a href="#Analyzer.generate_graphs-1093"><span class="linenos">1093</span></a>            <span class="n">emp_within</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graphing</span><span class="o">.</span><span class="n">filter_drive_distance</span><span class="p">(</span><span class="n">emp</span><span class="p">,</span><span class="n">office</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">commute_range_cut_off</span><span class="p">,</span> <span class="n">commute_data</span><span class="o">=</span><span class="n">commute_data</span><span class="p">)</span>
</span><span id="Analyzer.generate_graphs-1094"><a href="#Analyzer.generate_graphs-1094"><span class="linenos">1094</span></a>            <span class="c1"># get commute cost values </span>
</span><span id="Analyzer.generate_graphs-1095"><a href="#Analyzer.generate_graphs-1095"><span class="linenos">1095</span></a>            <span class="n">cost_values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graphing</span><span class="o">.</span><span class="n">get_commute_values</span><span class="p">(</span><span class="n">emp_within</span><span class="p">,</span> <span class="n">office</span><span class="p">,</span> <span class="n">commute_data</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
</span><span id="Analyzer.generate_graphs-1096"><a href="#Analyzer.generate_graphs-1096"><span class="linenos">1096</span></a>            <span class="c1"># calculate the bin list based upon a the max value of the data</span>
</span><span id="Analyzer.generate_graphs-1097"><a href="#Analyzer.generate_graphs-1097"><span class="linenos">1097</span></a>            <span class="n">binmax</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">cost_values</span><span class="p">[</span><span class="s1">&#39;commute_cost&#39;</span><span class="p">])</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
</span><span id="Analyzer.generate_graphs-1098"><a href="#Analyzer.generate_graphs-1098"><span class="linenos">1098</span></a>            <span class="n">step</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="Analyzer.generate_graphs-1099"><a href="#Analyzer.generate_graphs-1099"><span class="linenos">1099</span></a>            <span class="c1"># round the binmax up to the nearest step</span>
</span><span id="Analyzer.generate_graphs-1100"><a href="#Analyzer.generate_graphs-1100"><span class="linenos">1100</span></a>            <span class="n">bins</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">binmax</span> <span class="o">+</span> <span class="n">step</span> <span class="o">-</span> <span class="p">(</span><span class="n">binmax</span> <span class="o">%</span> <span class="n">step</span><span class="p">)),</span> <span class="n">step</span><span class="p">)</span>
</span><span id="Analyzer.generate_graphs-1101"><a href="#Analyzer.generate_graphs-1101"><span class="linenos">1101</span></a>            <span class="n">plt</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graphing</span><span class="o">.</span><span class="n">get_histogram</span><span class="p">(</span><span class="n">emp_within</span><span class="p">,</span> <span class="n">office</span><span class="p">,</span> <span class="n">commute_data</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">suptitle</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span id="Analyzer.generate_graphs-1102"><a href="#Analyzer.generate_graphs-1102"><span class="linenos">1102</span></a>                                      <span class="n">x_label</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="s1">&#39;\$ (USD) based on \$&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">mileage_rate</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39; per mile.&#39;</span><span class="p">),</span> <span class="n">y_label</span><span class="o">=</span><span class="s1">&#39;# Employees&#39;</span><span class="p">,</span>
</span><span id="Analyzer.generate_graphs-1103"><a href="#Analyzer.generate_graphs-1103"><span class="linenos">1103</span></a>                                      <span class="n">bins</span><span class="o">=</span><span class="n">bins</span><span class="p">,</span> <span class="n">rows</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">cols</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">column_titles</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Baseline Commute Cost Analysis for &quot;</span><span class="o">+</span><span class="n">office</span><span class="p">[</span><span class="s2">&quot;address&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">],</span> <span class="n">cumulative_line</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">font_mod</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
</span><span id="Analyzer.generate_graphs-1104"><a href="#Analyzer.generate_graphs-1104"><span class="linenos">1104</span></a>            
</span><span id="Analyzer.generate_graphs-1105"><a href="#Analyzer.generate_graphs-1105"><span class="linenos">1105</span></a>            <span class="c1"># udpate the plot description</span>
</span><span id="Analyzer.generate_graphs-1106"><a href="#Analyzer.generate_graphs-1106"><span class="linenos">1106</span></a>            <span class="n">median_cost</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">cost_values</span><span class="p">[</span><span class="s1">&#39;commute_cost&#39;</span><span class="p">]),</span><span class="mi">2</span><span class="p">)</span>
</span><span id="Analyzer.generate_graphs-1107"><a href="#Analyzer.generate_graphs-1107"><span class="linenos">1107</span></a>            <span class="n">average_cost</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">cost_values</span><span class="p">[</span><span class="s1">&#39;commute_cost&#39;</span><span class="p">]),</span><span class="mi">2</span><span class="p">)</span>
</span><span id="Analyzer.generate_graphs-1108"><a href="#Analyzer.generate_graphs-1108"><span class="linenos">1108</span></a>            <span class="n">commutes</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">commute_days_per_week</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">commute_weeks_per_year</span>
</span><span id="Analyzer.generate_graphs-1109"><a href="#Analyzer.generate_graphs-1109"><span class="linenos">1109</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">graph_list</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;PLOT-DESCRIPTION&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;This graph displays the distribution of commute costs for employees within the &quot;</span> <span class="o">+</span> \
</span><span id="Analyzer.generate_graphs-1110"><a href="#Analyzer.generate_graphs-1110"><span class="linenos">1110</span></a>                                                    <span class="s2">&quot;cutoff distance of the office at &quot;</span><span class="o">+</span><span class="n">office</span><span class="p">[</span><span class="s2">&quot;address&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="s2">&quot;.  &quot;</span> <span class="o">+</span> \
</span><span id="Analyzer.generate_graphs-1111"><a href="#Analyzer.generate_graphs-1111"><span class="linenos">1111</span></a>                                                    <span class="s2">&quot;The median cost per commute is $&quot;</span><span class="o">+</span><span class="s2">&quot;</span><span class="si">{:.2f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">median_cost</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;, and the average cost per commute is $&quot;</span><span class="o">+</span><span class="s2">&quot;</span><span class="si">{:.2f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">average_cost</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;, one way. &quot;</span> <span class="o">+</span> \
</span><span id="Analyzer.generate_graphs-1112"><a href="#Analyzer.generate_graphs-1112"><span class="linenos">1112</span></a>                                                    <span class="s2">&quot;For 2 commutes per day, &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">commute_days_per_week</span><span class="p">)</span> <span class="o">+</span> \
</span><span id="Analyzer.generate_graphs-1113"><a href="#Analyzer.generate_graphs-1113"><span class="linenos">1113</span></a>                                                    <span class="s2">&quot; days per week, and &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">commute_weeks_per_year</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; weeks per year (&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">commutes</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; commutes/yr), the &quot;</span> <span class="o">+</span> \
</span><span id="Analyzer.generate_graphs-1114"><a href="#Analyzer.generate_graphs-1114"><span class="linenos">1114</span></a>                                                    <span class="s2">&quot;median and average annual cost per employee is $&quot;</span><span class="o">+</span><span class="s2">&quot;</span><span class="si">{:.2f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">median_cost</span><span class="o">*</span><span class="n">commutes</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span><span class="o">+</span><span class="s2">&quot; and $&quot;</span><span class="o">+</span><span class="s2">&quot;</span><span class="si">{:.2f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">average_cost</span><span class="o">*</span><span class="n">commutes</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span><span class="o">+</span><span class="s2">&quot; respectively not including tolls, etc. &quot;</span> <span class="o">+</span> \
</span><span id="Analyzer.generate_graphs-1115"><a href="#Analyzer.generate_graphs-1115"><span class="linenos">1115</span></a>                                                    <span class="s2">&quot;Minimum and maximum annual costs within the designated commute range are: $&quot;</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="si">{:.2f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">cost_values</span><span class="p">[</span><span class="s1">&#39;commute_cost&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">commutes</span><span class="p">),</span><span class="mi">2</span><span class="p">))</span> <span class="o">+</span> <span class="s2">&quot; and $&quot;</span> <span class="o">+</span> \
</span><span id="Analyzer.generate_graphs-1116"><a href="#Analyzer.generate_graphs-1116"><span class="linenos">1116</span></a>                                                    <span class="s2">&quot;</span><span class="si">{:.2f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">cost_values</span><span class="p">[</span><span class="s1">&#39;commute_cost&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">commutes</span><span class="p">),</span><span class="mi">2</span><span class="p">))</span> <span class="o">+</span> <span class="s2">&quot; respectively.  In total, the workforce within the cutoff distance &quot;</span> <span class="o">+</span> \
</span><span id="Analyzer.generate_graphs-1117"><a href="#Analyzer.generate_graphs-1117"><span class="linenos">1117</span></a>                                                    <span class="s2">&quot;has a total annual commute cost of $&quot;</span><span class="o">+</span><span class="s2">&quot;</span><span class="si">{:,.2f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">cost_values</span><span class="p">[</span><span class="s1">&#39;commute_cost&#39;</span><span class="p">])</span><span class="o">*</span><span class="n">commutes</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span><span class="o">+</span><span class="s2">&quot;. Values based on $&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">mileage_rate</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot; per mile.&quot;</span>
</span><span id="Analyzer.generate_graphs-1118"><a href="#Analyzer.generate_graphs-1118"><span class="linenos">1118</span></a>            
</span><span id="Analyzer.generate_graphs-1119"><a href="#Analyzer.generate_graphs-1119"><span class="linenos">1119</span></a>            <span class="c1"># add a text box with the stats, using two decimal places and adding commas at the thousands</span>
</span><span id="Analyzer.generate_graphs-1120"><a href="#Analyzer.generate_graphs-1120"><span class="linenos">1120</span></a>            <span class="n">t</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;me&#39;</span> <span class="p">:</span> <span class="s1">&#39;Median: |$</span><span class="si">{:,.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">median_cost</span><span class="o">*</span><span class="n">commutes</span><span class="p">),</span>
</span><span id="Analyzer.generate_graphs-1121"><a href="#Analyzer.generate_graphs-1121"><span class="linenos">1121</span></a>                <span class="s1">&#39;av&#39;</span> <span class="p">:</span> <span class="s1">&#39;Average: |$</span><span class="si">{:,.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">average_cost</span><span class="o">*</span><span class="n">commutes</span><span class="p">),</span>
</span><span id="Analyzer.generate_graphs-1122"><a href="#Analyzer.generate_graphs-1122"><span class="linenos">1122</span></a>                <span class="s1">&#39;mi&#39;</span> <span class="p">:</span> <span class="s1">&#39;Min: |$</span><span class="si">{:,.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">cost_values</span><span class="p">[</span><span class="s1">&#39;commute_cost&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">commutes</span><span class="p">),</span><span class="mi">2</span><span class="p">)),</span>
</span><span id="Analyzer.generate_graphs-1123"><a href="#Analyzer.generate_graphs-1123"><span class="linenos">1123</span></a>                <span class="s1">&#39;ma&#39;</span> <span class="p">:</span> <span class="s1">&#39;Max: |$</span><span class="si">{:,.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">cost_values</span><span class="p">[</span><span class="s1">&#39;commute_cost&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">commutes</span><span class="p">),</span><span class="mi">2</span><span class="p">)),</span>
</span><span id="Analyzer.generate_graphs-1124"><a href="#Analyzer.generate_graphs-1124"><span class="linenos">1124</span></a>                <span class="s1">&#39;to&#39;</span> <span class="p">:</span> <span class="s1">&#39;Total: |$</span><span class="si">{:,.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">cost_values</span><span class="p">[</span><span class="s1">&#39;commute_cost&#39;</span><span class="p">])</span><span class="o">*</span><span class="n">commutes</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
</span><span id="Analyzer.generate_graphs-1125"><a href="#Analyzer.generate_graphs-1125"><span class="linenos">1125</span></a>                <span class="p">}</span>
</span><span id="Analyzer.generate_graphs-1126"><a href="#Analyzer.generate_graphs-1126"><span class="linenos">1126</span></a>            <span class="c1"># get the longest string value</span>
</span><span id="Analyzer.generate_graphs-1127"><a href="#Analyzer.generate_graphs-1127"><span class="linenos">1127</span></a>            <span class="n">max_len</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="s1">&#39;me&#39;</span><span class="p">]),</span><span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="s1">&#39;av&#39;</span><span class="p">]),</span><span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="s1">&#39;to&#39;</span><span class="p">]),</span><span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="s1">&#39;mi&#39;</span><span class="p">]),</span><span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="s1">&#39;ma&#39;</span><span class="p">]))</span>
</span><span id="Analyzer.generate_graphs-1128"><a href="#Analyzer.generate_graphs-1128"><span class="linenos">1128</span></a>            <span class="c1"># calculate how many narrow numbers/letters exist in the string, we need to add additional space for each</span>
</span><span id="Analyzer.generate_graphs-1129"><a href="#Analyzer.generate_graphs-1129"><span class="linenos">1129</span></a>            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">t</span><span class="p">:</span>
</span><span id="Analyzer.generate_graphs-1130"><a href="#Analyzer.generate_graphs-1130"><span class="linenos">1130</span></a>                <span class="n">t</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">t</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">,</span><span class="s2">&quot; &quot;</span><span class="o">*</span><span class="p">(</span><span class="n">max_len</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="n">k</span><span class="p">])))</span>
</span><span id="Analyzer.generate_graphs-1131"><a href="#Analyzer.generate_graphs-1131"><span class="linenos">1131</span></a>
</span><span id="Analyzer.generate_graphs-1132"><a href="#Analyzer.generate_graphs-1132"><span class="linenos">1132</span></a>
</span><span id="Analyzer.generate_graphs-1133"><a href="#Analyzer.generate_graphs-1133"><span class="linenos">1133</span></a>            <span class="c1"># add spaces to make all the same length, replacing |</span>
</span><span id="Analyzer.generate_graphs-1134"><a href="#Analyzer.generate_graphs-1134"><span class="linenos">1134</span></a>            <span class="n">textstr</span> <span class="o">=</span> <span class="s2">&quot;Annualized Costs: &quot;</span>
</span><span id="Analyzer.generate_graphs-1135"><a href="#Analyzer.generate_graphs-1135"><span class="linenos">1135</span></a>            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">t</span><span class="p">:</span>
</span><span id="Analyzer.generate_graphs-1136"><a href="#Analyzer.generate_graphs-1136"><span class="linenos">1136</span></a>                <span class="n">textstr</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">t</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
</span><span id="Analyzer.generate_graphs-1137"><a href="#Analyzer.generate_graphs-1137"><span class="linenos">1137</span></a>            
</span><span id="Analyzer.generate_graphs-1138"><a href="#Analyzer.generate_graphs-1138"><span class="linenos">1138</span></a>            <span class="n">props</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">boxstyle</span><span class="o">=</span><span class="s1">&#39;round&#39;</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;wheat&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
</span><span id="Analyzer.generate_graphs-1139"><a href="#Analyzer.generate_graphs-1139"><span class="linenos">1139</span></a>                
</span><span id="Analyzer.generate_graphs-1140"><a href="#Analyzer.generate_graphs-1140"><span class="linenos">1140</span></a>            <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">.95</span><span class="p">,</span> <span class="mf">.5</span><span class="p">,</span> <span class="n">textstr</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span>
</span><span id="Analyzer.generate_graphs-1141"><a href="#Analyzer.generate_graphs-1141"><span class="linenos">1141</span></a>                        <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">bbox</span><span class="o">=</span><span class="n">props</span><span class="p">,</span> <span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;family&#39;</span><span class="p">:</span> <span class="s1">&#39;monospace&#39;</span><span class="p">},</span> <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">)</span>
</span><span id="Analyzer.generate_graphs-1142"><a href="#Analyzer.generate_graphs-1142"><span class="linenos">1142</span></a>
</span><span id="Analyzer.generate_graphs-1143"><a href="#Analyzer.generate_graphs-1143"><span class="linenos">1143</span></a>
</span><span id="Analyzer.generate_graphs-1144"><a href="#Analyzer.generate_graphs-1144"><span class="linenos">1144</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">(</span><span class="n">pad</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
</span><span id="Analyzer.generate_graphs-1145"><a href="#Analyzer.generate_graphs-1145"><span class="linenos">1145</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">plots_dir</span><span class="o">+</span><span class="s2">&quot;/&quot;</span><span class="o">+</span><span class="n">key</span><span class="o">+</span><span class="s2">&quot;.png&quot;</span><span class="p">)</span>
</span><span id="Analyzer.generate_graphs-1146"><a href="#Analyzer.generate_graphs-1146"><span class="linenos">1146</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="Analyzer.generate_graphs-1147"><a href="#Analyzer.generate_graphs-1147"><span class="linenos">1147</span></a>
</span><span id="Analyzer.generate_graphs-1148"><a href="#Analyzer.generate_graphs-1148"><span class="linenos">1148</span></a>            
</span><span id="Analyzer.generate_graphs-1149"><a href="#Analyzer.generate_graphs-1149"><span class="linenos">1149</span></a>
</span><span id="Analyzer.generate_graphs-1150"><a href="#Analyzer.generate_graphs-1150"><span class="linenos">1150</span></a>        <span class="c1">################################################################################ </span>
</span><span id="Analyzer.generate_graphs-1151"><a href="#Analyzer.generate_graphs-1151"><span class="linenos">1151</span></a>        <span class="c1"># GRAPH: </span>
</span><span id="Analyzer.generate_graphs-1152"><a href="#Analyzer.generate_graphs-1152"><span class="linenos">1152</span></a>        <span class="c1">## Commute Costs per Office</span>
</span><span id="Analyzer.generate_graphs-1153"><a href="#Analyzer.generate_graphs-1153"><span class="linenos">1153</span></a>        <span class="n">key</span> <span class="o">=</span> <span class="s1">&#39;ccpo&#39;</span>
</span><span id="Analyzer.generate_graphs-1154"><a href="#Analyzer.generate_graphs-1154"><span class="linenos">1154</span></a>        <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;Commute Costs per Office&quot;</span>
</span><span id="Analyzer.generate_graphs-1155"><a href="#Analyzer.generate_graphs-1155"><span class="linenos">1155</span></a>        <span class="n">short_title</span> <span class="o">=</span> <span class="n">title</span>
</span><span id="Analyzer.generate_graphs-1156"><a href="#Analyzer.generate_graphs-1156"><span class="linenos">1156</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">graph_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="p">{</span><span class="s2">&quot;GRAPH&quot;</span><span class="p">:</span> <span class="n">key</span><span class="p">,</span>
</span><span id="Analyzer.generate_graphs-1157"><a href="#Analyzer.generate_graphs-1157"><span class="linenos">1157</span></a>                                <span class="s2">&quot;TITLE&quot;</span><span class="p">:</span> <span class="n">short_title</span><span class="p">,</span>
</span><span id="Analyzer.generate_graphs-1158"><a href="#Analyzer.generate_graphs-1158"><span class="linenos">1158</span></a>                                <span class="s2">&quot;FILENAME&quot;</span><span class="p">:</span> <span class="n">key</span><span class="o">+</span><span class="s2">&quot;.png&quot;</span><span class="p">,</span>
</span><span id="Analyzer.generate_graphs-1159"><a href="#Analyzer.generate_graphs-1159"><span class="linenos">1159</span></a>                                <span class="s2">&quot;PLOT-DESCRIPTION&quot;</span><span class="p">:</span> <span class="s2">&quot;This graph displays the distribution of commute costs for employees within the &quot;</span> <span class="o">+</span> \
</span><span id="Analyzer.generate_graphs-1160"><a href="#Analyzer.generate_graphs-1160"><span class="linenos">1160</span></a>                                                    <span class="s2">&quot;cutoff distance of the office options. Overall commute costs are shown for each office &quot;</span> <span class="o">+</span> \
</span><span id="Analyzer.generate_graphs-1161"><a href="#Analyzer.generate_graphs-1161"><span class="linenos">1161</span></a>                                                    <span class="s2">&quot;option.  This analysis inlcudes only per mile costs, not including tolls, etc.  &quot;</span> <span class="o">+</span> \
</span><span id="Analyzer.generate_graphs-1162"><a href="#Analyzer.generate_graphs-1162"><span class="linenos">1162</span></a>                                                    <span class="s2">&quot;Costs due to cash equivalent for time not included.&quot;</span>
</span><span id="Analyzer.generate_graphs-1163"><a href="#Analyzer.generate_graphs-1163"><span class="linenos">1163</span></a>                                <span class="p">})</span>
</span><span id="Analyzer.generate_graphs-1164"><a href="#Analyzer.generate_graphs-1164"><span class="linenos">1164</span></a>        
</span><span id="Analyzer.generate_graphs-1165"><a href="#Analyzer.generate_graphs-1165"><span class="linenos">1165</span></a>        <span class="k">if</span> <span class="n">graph</span> <span class="o">==</span> <span class="s2">&quot;_all&quot;</span> <span class="ow">or</span> <span class="n">graph</span> <span class="o">==</span> <span class="n">key</span><span class="p">:</span>
</span><span id="Analyzer.generate_graphs-1166"><a href="#Analyzer.generate_graphs-1166"><span class="linenos">1166</span></a>            <span class="c1"># get the value to plot</span>
</span><span id="Analyzer.generate_graphs-1167"><a href="#Analyzer.generate_graphs-1167"><span class="linenos">1167</span></a>            <span class="n">value</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Analyzer.generate_graphs-1168"><a href="#Analyzer.generate_graphs-1168"><span class="linenos">1168</span></a>            <span class="c1"># employees to analyze are within the cutoff distance for this office</span>
</span><span id="Analyzer.generate_graphs-1169"><a href="#Analyzer.generate_graphs-1169"><span class="linenos">1169</span></a>            <span class="c1"># for this analysis, we need to iterate through options</span>
</span><span id="Analyzer.generate_graphs-1170"><a href="#Analyzer.generate_graphs-1170"><span class="linenos">1170</span></a>            <span class="n">emp_within</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Analyzer.generate_graphs-1171"><a href="#Analyzer.generate_graphs-1171"><span class="linenos">1171</span></a>            <span class="n">office_addrs</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Analyzer.generate_graphs-1172"><a href="#Analyzer.generate_graphs-1172"><span class="linenos">1172</span></a>            <span class="n">cost_values</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Analyzer.generate_graphs-1173"><a href="#Analyzer.generate_graphs-1173"><span class="linenos">1173</span></a>            <span class="n">median_costs</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Analyzer.generate_graphs-1174"><a href="#Analyzer.generate_graphs-1174"><span class="linenos">1174</span></a>            <span class="n">average_costs</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Analyzer.generate_graphs-1175"><a href="#Analyzer.generate_graphs-1175"><span class="linenos">1175</span></a>            <span class="n">total_costs</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Analyzer.generate_graphs-1176"><a href="#Analyzer.generate_graphs-1176"><span class="linenos">1176</span></a>            <span class="n">min_costs</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Analyzer.generate_graphs-1177"><a href="#Analyzer.generate_graphs-1177"><span class="linenos">1177</span></a>            <span class="n">max_costs</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Analyzer.generate_graphs-1178"><a href="#Analyzer.generate_graphs-1178"><span class="linenos">1178</span></a>            <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">offices</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
</span><span id="Analyzer.generate_graphs-1179"><a href="#Analyzer.generate_graphs-1179"><span class="linenos">1179</span></a>                <span class="n">office</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">to_frame</span><span class="p">()</span><span class="o">.</span><span class="n">T</span>
</span><span id="Analyzer.generate_graphs-1180"><a href="#Analyzer.generate_graphs-1180"><span class="linenos">1180</span></a>                <span class="n">emp_within</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">graphing</span><span class="o">.</span><span class="n">filter_drive_distance</span><span class="p">(</span><span class="n">emp</span><span class="p">,</span><span class="n">office</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">commute_range_cut_off</span><span class="p">,</span> <span class="n">commute_data</span><span class="o">=</span><span class="n">commute_data</span><span class="p">))</span>
</span><span id="Analyzer.generate_graphs-1181"><a href="#Analyzer.generate_graphs-1181"><span class="linenos">1181</span></a>                <span class="n">office_addrs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">office</span><span class="p">[</span><span class="s2">&quot;address&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="Analyzer.generate_graphs-1182"><a href="#Analyzer.generate_graphs-1182"><span class="linenos">1182</span></a>                <span class="n">value</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;commute_cost&#39;</span><span class="p">)</span>
</span><span id="Analyzer.generate_graphs-1183"><a href="#Analyzer.generate_graphs-1183"><span class="linenos">1183</span></a>                <span class="n">cost_values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">graphing</span><span class="o">.</span><span class="n">get_commute_values</span><span class="p">(</span><span class="n">emp_within</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">office</span><span class="p">,</span> <span class="n">commute_data</span><span class="p">,</span> <span class="n">value</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span>
</span><span id="Analyzer.generate_graphs-1184"><a href="#Analyzer.generate_graphs-1184"><span class="linenos">1184</span></a>                <span class="n">commutes</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">commute_days_per_week</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">commute_weeks_per_year</span>
</span><span id="Analyzer.generate_graphs-1185"><a href="#Analyzer.generate_graphs-1185"><span class="linenos">1185</span></a>                <span class="n">median_costs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">cost_values</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;commute_cost&#39;</span><span class="p">])</span><span class="o">*</span><span class="n">commutes</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
</span><span id="Analyzer.generate_graphs-1186"><a href="#Analyzer.generate_graphs-1186"><span class="linenos">1186</span></a>                <span class="n">average_costs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">cost_values</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;commute_cost&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">commutes</span><span class="p">),</span><span class="mi">2</span><span class="p">))</span>
</span><span id="Analyzer.generate_graphs-1187"><a href="#Analyzer.generate_graphs-1187"><span class="linenos">1187</span></a>                <span class="n">total_costs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">cost_values</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;commute_cost&#39;</span><span class="p">])</span><span class="o">*</span><span class="n">commutes</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
</span><span id="Analyzer.generate_graphs-1188"><a href="#Analyzer.generate_graphs-1188"><span class="linenos">1188</span></a>                <span class="n">min_costs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">cost_values</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;commute_cost&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">commutes</span><span class="p">),</span><span class="mi">2</span><span class="p">))</span>
</span><span id="Analyzer.generate_graphs-1189"><a href="#Analyzer.generate_graphs-1189"><span class="linenos">1189</span></a>                <span class="n">max_costs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">cost_values</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;commute_cost&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">commutes</span><span class="p">),</span><span class="mi">2</span><span class="p">))</span>
</span><span id="Analyzer.generate_graphs-1190"><a href="#Analyzer.generate_graphs-1190"><span class="linenos">1190</span></a>
</span><span id="Analyzer.generate_graphs-1191"><a href="#Analyzer.generate_graphs-1191"><span class="linenos">1191</span></a>
</span><span id="Analyzer.generate_graphs-1192"><a href="#Analyzer.generate_graphs-1192"><span class="linenos">1192</span></a>            <span class="c1"># calculate the bin list based upon a the max value of the data</span>
</span><span id="Analyzer.generate_graphs-1193"><a href="#Analyzer.generate_graphs-1193"><span class="linenos">1193</span></a>            <span class="c1">#binmax = int(max(cost_values[&#39;commute_cost&#39;])+1)</span>
</span><span id="Analyzer.generate_graphs-1194"><a href="#Analyzer.generate_graphs-1194"><span class="linenos">1194</span></a>            <span class="n">binmax</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Analyzer.generate_graphs-1195"><a href="#Analyzer.generate_graphs-1195"><span class="linenos">1195</span></a>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">cost_values</span><span class="p">)):</span>
</span><span id="Analyzer.generate_graphs-1196"><a href="#Analyzer.generate_graphs-1196"><span class="linenos">1196</span></a>                <span class="k">if</span> <span class="nb">max</span><span class="p">(</span><span class="n">cost_values</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;commute_cost&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="n">binmax</span><span class="p">:</span>
</span><span id="Analyzer.generate_graphs-1197"><a href="#Analyzer.generate_graphs-1197"><span class="linenos">1197</span></a>                    <span class="n">binmax</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">cost_values</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;commute_cost&#39;</span><span class="p">])</span>
</span><span id="Analyzer.generate_graphs-1198"><a href="#Analyzer.generate_graphs-1198"><span class="linenos">1198</span></a>            <span class="n">step</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="Analyzer.generate_graphs-1199"><a href="#Analyzer.generate_graphs-1199"><span class="linenos">1199</span></a>            <span class="c1"># round the binmax up to the nearest step</span>
</span><span id="Analyzer.generate_graphs-1200"><a href="#Analyzer.generate_graphs-1200"><span class="linenos">1200</span></a>            <span class="n">bins</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">binmax</span> <span class="o">+</span> <span class="n">step</span> <span class="o">-</span> <span class="p">(</span><span class="n">binmax</span> <span class="o">%</span> <span class="n">step</span><span class="p">)),</span> <span class="n">step</span><span class="p">)</span>
</span><span id="Analyzer.generate_graphs-1201"><a href="#Analyzer.generate_graphs-1201"><span class="linenos">1201</span></a>            <span class="n">plt</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graphing</span><span class="o">.</span><span class="n">get_histogram</span><span class="p">(</span><span class="n">emp</span><span class="p">,</span> <span class="n">offices</span><span class="p">,</span> <span class="n">commute_data</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">suptitle</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">cutoff_radius</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">commute_range_cut_off</span><span class="p">,</span>
</span><span id="Analyzer.generate_graphs-1202"><a href="#Analyzer.generate_graphs-1202"><span class="linenos">1202</span></a>                                      <span class="n">x_label</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="s1">&#39;\$ (USD), one-way, based on \$&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">mileage_rate</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39; per mile.&#39;</span><span class="p">),</span> <span class="n">y_label</span><span class="o">=</span><span class="s1">&#39;# Employees&#39;</span><span class="p">,</span>
</span><span id="Analyzer.generate_graphs-1203"><a href="#Analyzer.generate_graphs-1203"><span class="linenos">1203</span></a>                                      <span class="n">bins</span><span class="o">=</span><span class="n">bins</span><span class="p">,</span> <span class="n">rows</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">office_addrs</span><span class="p">),</span> <span class="n">cols</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">column_titles</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Commute Cost Analysis for Options&quot;</span><span class="p">],</span> 
</span><span id="Analyzer.generate_graphs-1204"><a href="#Analyzer.generate_graphs-1204"><span class="linenos">1204</span></a>                                      <span class="n">cumulative_line</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">font_mod</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">manual_plot</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="Analyzer.generate_graphs-1205"><a href="#Analyzer.generate_graphs-1205"><span class="linenos">1205</span></a>            
</span><span id="Analyzer.generate_graphs-1206"><a href="#Analyzer.generate_graphs-1206"><span class="linenos">1206</span></a>            <span class="c1"># manually add histograms for each office option</span>
</span><span id="Analyzer.generate_graphs-1207"><a href="#Analyzer.generate_graphs-1207"><span class="linenos">1207</span></a>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">emp_within</span><span class="p">)):</span>
</span><span id="Analyzer.generate_graphs-1208"><a href="#Analyzer.generate_graphs-1208"><span class="linenos">1208</span></a>                <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">cost_values</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;commute_cost&#39;</span><span class="p">],</span> <span class="n">bins</span><span class="o">=</span><span class="n">bins</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;#555555&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">align</span><span class="o">=</span><span class="s1">&#39;mid&#39;</span><span class="p">,</span> 
</span><span id="Analyzer.generate_graphs-1209"><a href="#Analyzer.generate_graphs-1209"><span class="linenos">1209</span></a>                           <span class="n">rwidth</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">office_addrs</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
</span><span id="Analyzer.generate_graphs-1210"><a href="#Analyzer.generate_graphs-1210"><span class="linenos">1210</span></a>                <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;major&#39;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
</span><span id="Analyzer.generate_graphs-1211"><a href="#Analyzer.generate_graphs-1211"><span class="linenos">1211</span></a>                
</span><span id="Analyzer.generate_graphs-1212"><a href="#Analyzer.generate_graphs-1212"><span class="linenos">1212</span></a>                <span class="c1"># add a legend to show the office options</span>
</span><span id="Analyzer.generate_graphs-1213"><a href="#Analyzer.generate_graphs-1213"><span class="linenos">1213</span></a>                <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper right&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
</span><span id="Analyzer.generate_graphs-1214"><a href="#Analyzer.generate_graphs-1214"><span class="linenos">1214</span></a>                
</span><span id="Analyzer.generate_graphs-1215"><a href="#Analyzer.generate_graphs-1215"><span class="linenos">1215</span></a>                <span class="c1"># add a text box with the stats, using two decimal places and adding commas at the thousands</span>
</span><span id="Analyzer.generate_graphs-1216"><a href="#Analyzer.generate_graphs-1216"><span class="linenos">1216</span></a>                <span class="n">t</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;me&#39;</span> <span class="p">:</span> <span class="s1">&#39;Median: |$</span><span class="si">{:,.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">median_costs</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span>
</span><span id="Analyzer.generate_graphs-1217"><a href="#Analyzer.generate_graphs-1217"><span class="linenos">1217</span></a>                    <span class="s1">&#39;av&#39;</span> <span class="p">:</span> <span class="s1">&#39;Average: |$</span><span class="si">{:,.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">average_costs</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span>
</span><span id="Analyzer.generate_graphs-1218"><a href="#Analyzer.generate_graphs-1218"><span class="linenos">1218</span></a>                    <span class="s1">&#39;mi&#39;</span> <span class="p">:</span> <span class="s1">&#39;Min: |$</span><span class="si">{:,.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">min_costs</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span>
</span><span id="Analyzer.generate_graphs-1219"><a href="#Analyzer.generate_graphs-1219"><span class="linenos">1219</span></a>                    <span class="s1">&#39;ma&#39;</span> <span class="p">:</span> <span class="s1">&#39;Max: |$</span><span class="si">{:,.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">max_costs</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span>
</span><span id="Analyzer.generate_graphs-1220"><a href="#Analyzer.generate_graphs-1220"><span class="linenos">1220</span></a>                    <span class="s1">&#39;to&#39;</span> <span class="p">:</span> <span class="s1">&#39;Total: |$</span><span class="si">{:,.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">total_costs</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</span><span id="Analyzer.generate_graphs-1221"><a href="#Analyzer.generate_graphs-1221"><span class="linenos">1221</span></a>                    <span class="p">}</span>             
</span><span id="Analyzer.generate_graphs-1222"><a href="#Analyzer.generate_graphs-1222"><span class="linenos">1222</span></a>                <span class="c1"># get the longest string value</span>
</span><span id="Analyzer.generate_graphs-1223"><a href="#Analyzer.generate_graphs-1223"><span class="linenos">1223</span></a>                <span class="n">max_len</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="s1">&#39;me&#39;</span><span class="p">]),</span><span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="s1">&#39;av&#39;</span><span class="p">]),</span><span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="s1">&#39;to&#39;</span><span class="p">]),</span><span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="s1">&#39;mi&#39;</span><span class="p">]),</span><span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="s1">&#39;ma&#39;</span><span class="p">]))</span>
</span><span id="Analyzer.generate_graphs-1224"><a href="#Analyzer.generate_graphs-1224"><span class="linenos">1224</span></a>                
</span><span id="Analyzer.generate_graphs-1225"><a href="#Analyzer.generate_graphs-1225"><span class="linenos">1225</span></a>                <span class="c1"># calculate how many narrow numbers/letters exist in the string, we need to add additional space for each</span>
</span><span id="Analyzer.generate_graphs-1226"><a href="#Analyzer.generate_graphs-1226"><span class="linenos">1226</span></a>                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">t</span><span class="p">:</span>
</span><span id="Analyzer.generate_graphs-1227"><a href="#Analyzer.generate_graphs-1227"><span class="linenos">1227</span></a>                    <span class="n">t</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">t</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">,</span><span class="s2">&quot; &quot;</span><span class="o">*</span><span class="p">(</span><span class="n">max_len</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="n">k</span><span class="p">])))</span>
</span><span id="Analyzer.generate_graphs-1228"><a href="#Analyzer.generate_graphs-1228"><span class="linenos">1228</span></a>
</span><span id="Analyzer.generate_graphs-1229"><a href="#Analyzer.generate_graphs-1229"><span class="linenos">1229</span></a>
</span><span id="Analyzer.generate_graphs-1230"><a href="#Analyzer.generate_graphs-1230"><span class="linenos">1230</span></a>                <span class="c1"># add spaces to make all the same length, replacing |</span>
</span><span id="Analyzer.generate_graphs-1231"><a href="#Analyzer.generate_graphs-1231"><span class="linenos">1231</span></a>                <span class="n">textstr</span> <span class="o">=</span> <span class="s2">&quot;Annualized Costs: &quot;</span>
</span><span id="Analyzer.generate_graphs-1232"><a href="#Analyzer.generate_graphs-1232"><span class="linenos">1232</span></a>                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">t</span><span class="p">:</span>
</span><span id="Analyzer.generate_graphs-1233"><a href="#Analyzer.generate_graphs-1233"><span class="linenos">1233</span></a>                    <span class="n">textstr</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">t</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
</span><span id="Analyzer.generate_graphs-1234"><a href="#Analyzer.generate_graphs-1234"><span class="linenos">1234</span></a>                <span class="c1"># these are matplotlib.patch.Patch properties</span>
</span><span id="Analyzer.generate_graphs-1235"><a href="#Analyzer.generate_graphs-1235"><span class="linenos">1235</span></a>                <span class="n">props</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">boxstyle</span><span class="o">=</span><span class="s1">&#39;round&#39;</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;wheat&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
</span><span id="Analyzer.generate_graphs-1236"><a href="#Analyzer.generate_graphs-1236"><span class="linenos">1236</span></a>                <span class="c1"># place a text box in upper right in axes coords, </span>
</span><span id="Analyzer.generate_graphs-1237"><a href="#Analyzer.generate_graphs-1237"><span class="linenos">1237</span></a>                <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">.95</span><span class="p">,</span> <span class="mf">.5</span><span class="p">,</span> <span class="n">textstr</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">,</span>
</span><span id="Analyzer.generate_graphs-1238"><a href="#Analyzer.generate_graphs-1238"><span class="linenos">1238</span></a>                            <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">bbox</span><span class="o">=</span><span class="n">props</span><span class="p">,</span> <span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;family&#39;</span><span class="p">:</span> <span class="s1">&#39;monospace&#39;</span><span class="p">},</span> <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">)</span>
</span><span id="Analyzer.generate_graphs-1239"><a href="#Analyzer.generate_graphs-1239"><span class="linenos">1239</span></a>                
</span><span id="Analyzer.generate_graphs-1240"><a href="#Analyzer.generate_graphs-1240"><span class="linenos">1240</span></a>            
</span><span id="Analyzer.generate_graphs-1241"><a href="#Analyzer.generate_graphs-1241"><span class="linenos">1241</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">(</span><span class="n">pad</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
</span><span id="Analyzer.generate_graphs-1242"><a href="#Analyzer.generate_graphs-1242"><span class="linenos">1242</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">plots_dir</span><span class="o">+</span><span class="s2">&quot;/&quot;</span><span class="o">+</span><span class="n">key</span><span class="o">+</span><span class="s2">&quot;.png&quot;</span><span class="p">)</span>
</span><span id="Analyzer.generate_graphs-1243"><a href="#Analyzer.generate_graphs-1243"><span class="linenos">1243</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="Analyzer.generate_graphs-1244"><a href="#Analyzer.generate_graphs-1244"><span class="linenos">1244</span></a>
</span><span id="Analyzer.generate_graphs-1245"><a href="#Analyzer.generate_graphs-1245"><span class="linenos">1245</span></a>            
</span><span id="Analyzer.generate_graphs-1246"><a href="#Analyzer.generate_graphs-1246"><span class="linenos">1246</span></a>            
</span><span id="Analyzer.generate_graphs-1247"><a href="#Analyzer.generate_graphs-1247"><span class="linenos">1247</span></a>        
</span><span id="Analyzer.generate_graphs-1248"><a href="#Analyzer.generate_graphs-1248"><span class="linenos">1248</span></a>        <span class="c1">################################################################################ </span>
</span><span id="Analyzer.generate_graphs-1249"><a href="#Analyzer.generate_graphs-1249"><span class="linenos">1249</span></a>        <span class="c1"># GRAPH: </span>
</span><span id="Analyzer.generate_graphs-1250"><a href="#Analyzer.generate_graphs-1250"><span class="linenos">1250</span></a>        <span class="c1">## Employee Commute Cost Differential Analysis</span>
</span><span id="Analyzer.generate_graphs-1251"><a href="#Analyzer.generate_graphs-1251"><span class="linenos">1251</span></a>        <span class="n">key</span> <span class="o">=</span> <span class="s1">&#39;eccda&#39;</span>
</span><span id="Analyzer.generate_graphs-1252"><a href="#Analyzer.generate_graphs-1252"><span class="linenos">1252</span></a>        <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;Employee Commute Cost Differential Analysis&quot;</span>
</span><span id="Analyzer.generate_graphs-1253"><a href="#Analyzer.generate_graphs-1253"><span class="linenos">1253</span></a>        <span class="n">short_title</span> <span class="o">=</span> <span class="n">title</span>
</span><span id="Analyzer.generate_graphs-1254"><a href="#Analyzer.generate_graphs-1254"><span class="linenos">1254</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">graph_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="p">{</span><span class="s2">&quot;GRAPH&quot;</span><span class="p">:</span> <span class="n">key</span><span class="p">,</span>
</span><span id="Analyzer.generate_graphs-1255"><a href="#Analyzer.generate_graphs-1255"><span class="linenos">1255</span></a>                                <span class="s2">&quot;TITLE&quot;</span><span class="p">:</span> <span class="n">short_title</span><span class="p">,</span>
</span><span id="Analyzer.generate_graphs-1256"><a href="#Analyzer.generate_graphs-1256"><span class="linenos">1256</span></a>                                <span class="s2">&quot;FILENAME&quot;</span><span class="p">:</span> <span class="n">key</span><span class="o">+</span><span class="s2">&quot;.png&quot;</span><span class="p">,</span>
</span><span id="Analyzer.generate_graphs-1257"><a href="#Analyzer.generate_graphs-1257"><span class="linenos">1257</span></a>                                <span class="s2">&quot;PLOT-DESCRIPTION&quot;</span><span class="p">:</span> <span class="s2">&quot;This graph displays the distribution of commute costs for employees within the &quot;</span> <span class="o">+</span> \
</span><span id="Analyzer.generate_graphs-1258"><a href="#Analyzer.generate_graphs-1258"><span class="linenos">1258</span></a>                                                    <span class="s2">&quot;cutoff distance of the office options. Changes in per-employee commute costs are shown for each office &quot;</span> <span class="o">+</span> \
</span><span id="Analyzer.generate_graphs-1259"><a href="#Analyzer.generate_graphs-1259"><span class="linenos">1259</span></a>                                                    <span class="s2">&quot;option relative to the existing office locaton.  This analysis inlcudes only per mile costs, not including tolls, etc.  &quot;</span> <span class="o">+</span> \
</span><span id="Analyzer.generate_graphs-1260"><a href="#Analyzer.generate_graphs-1260"><span class="linenos">1260</span></a>                                                    <span class="s2">&quot;Costs due to cash equivalent for time not included.&quot;</span>
</span><span id="Analyzer.generate_graphs-1261"><a href="#Analyzer.generate_graphs-1261"><span class="linenos">1261</span></a>                                <span class="p">})</span>
</span><span id="Analyzer.generate_graphs-1262"><a href="#Analyzer.generate_graphs-1262"><span class="linenos">1262</span></a>        
</span><span id="Analyzer.generate_graphs-1263"><a href="#Analyzer.generate_graphs-1263"><span class="linenos">1263</span></a>        <span class="k">if</span> <span class="n">graph</span> <span class="o">==</span> <span class="s2">&quot;_all&quot;</span> <span class="ow">or</span> <span class="n">graph</span> <span class="o">==</span> <span class="n">key</span><span class="p">:</span>
</span><span id="Analyzer.generate_graphs-1264"><a href="#Analyzer.generate_graphs-1264"><span class="linenos">1264</span></a>            <span class="c1"># get the value to plot</span>
</span><span id="Analyzer.generate_graphs-1265"><a href="#Analyzer.generate_graphs-1265"><span class="linenos">1265</span></a>            <span class="n">value</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Analyzer.generate_graphs-1266"><a href="#Analyzer.generate_graphs-1266"><span class="linenos">1266</span></a>            <span class="c1"># employees to analyze are within the cutoff distance for this office</span>
</span><span id="Analyzer.generate_graphs-1267"><a href="#Analyzer.generate_graphs-1267"><span class="linenos">1267</span></a>            <span class="c1"># for this analysis, we need to iterate through options</span>
</span><span id="Analyzer.generate_graphs-1268"><a href="#Analyzer.generate_graphs-1268"><span class="linenos">1268</span></a>            <span class="n">current_office</span> <span class="o">=</span> <span class="n">offices</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">to_frame</span><span class="p">()</span><span class="o">.</span><span class="n">T</span>
</span><span id="Analyzer.generate_graphs-1269"><a href="#Analyzer.generate_graphs-1269"><span class="linenos">1269</span></a>            <span class="n">other_offices</span> <span class="o">=</span> <span class="n">offices</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="Analyzer.generate_graphs-1270"><a href="#Analyzer.generate_graphs-1270"><span class="linenos">1270</span></a>            <span class="n">cost_values</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Analyzer.generate_graphs-1271"><a href="#Analyzer.generate_graphs-1271"><span class="linenos">1271</span></a>            <span class="n">withins</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Analyzer.generate_graphs-1272"><a href="#Analyzer.generate_graphs-1272"><span class="linenos">1272</span></a>            <span class="n">commutes</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">commute_days_per_week</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">commute_weeks_per_year</span>
</span><span id="Analyzer.generate_graphs-1273"><a href="#Analyzer.generate_graphs-1273"><span class="linenos">1273</span></a>            
</span><span id="Analyzer.generate_graphs-1274"><a href="#Analyzer.generate_graphs-1274"><span class="linenos">1274</span></a>            <span class="c1"># for each employee, calculate the commute cost to the current office, place a new dataframe with lat, long, office, and cost</span>
</span><span id="Analyzer.generate_graphs-1275"><a href="#Analyzer.generate_graphs-1275"><span class="linenos">1275</span></a>            <span class="c1"># if the employee is within the cutoff distance, if outside the cutoff distance, the cost is 0</span>
</span><span id="Analyzer.generate_graphs-1276"><a href="#Analyzer.generate_graphs-1276"><span class="linenos">1276</span></a>            <span class="c1"># start by looping through ALL employees and adding a row with the current office, and cost = 0</span>
</span><span id="Analyzer.generate_graphs-1277"><a href="#Analyzer.generate_graphs-1277"><span class="linenos">1277</span></a>                    
</span><span id="Analyzer.generate_graphs-1278"><a href="#Analyzer.generate_graphs-1278"><span class="linenos">1278</span></a>
</span><span id="Analyzer.generate_graphs-1279"><a href="#Analyzer.generate_graphs-1279"><span class="linenos">1279</span></a>            <span class="n">base_costs</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">get_base_cost_df</span><span class="p">(</span><span class="n">emp</span><span class="p">,</span> <span class="n">current_office</span><span class="p">[</span><span class="s1">&#39;address&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
</span><span id="Analyzer.generate_graphs-1280"><a href="#Analyzer.generate_graphs-1280"><span class="linenos">1280</span></a>            <span class="c1"># now get emp_within for the current office, and update the relevant rows of base_costs with actual costs for those employees </span>
</span><span id="Analyzer.generate_graphs-1281"><a href="#Analyzer.generate_graphs-1281"><span class="linenos">1281</span></a>            <span class="c1"># using the commute_cost column in the commute_data dataframe where the employee lat long matches the commute_data lat long and office address</span>
</span><span id="Analyzer.generate_graphs-1282"><a href="#Analyzer.generate_graphs-1282"><span class="linenos">1282</span></a>            
</span><span id="Analyzer.generate_graphs-1283"><a href="#Analyzer.generate_graphs-1283"><span class="linenos">1283</span></a>            <span class="n">base_emp_within</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graphing</span><span class="o">.</span><span class="n">filter_drive_distance</span><span class="p">(</span><span class="n">emp</span><span class="p">,</span><span class="n">current_office</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">commute_range_cut_off</span><span class="p">,</span> <span class="n">commute_data</span><span class="o">=</span><span class="n">commute_data</span><span class="p">)</span>
</span><span id="Analyzer.generate_graphs-1284"><a href="#Analyzer.generate_graphs-1284"><span class="linenos">1284</span></a>
</span><span id="Analyzer.generate_graphs-1285"><a href="#Analyzer.generate_graphs-1285"><span class="linenos">1285</span></a>            <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">base_emp_within</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
</span><span id="Analyzer.generate_graphs-1286"><a href="#Analyzer.generate_graphs-1286"><span class="linenos">1286</span></a>                <span class="c1"># get the cost from the commute_data</span>
</span><span id="Analyzer.generate_graphs-1287"><a href="#Analyzer.generate_graphs-1287"><span class="linenos">1287</span></a>                <span class="n">cost</span> <span class="o">=</span> <span class="n">commute_data</span><span class="p">[(</span><span class="n">commute_data</span><span class="p">[</span><span class="s1">&#39;origin_lat&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;latitude&#39;</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">commute_data</span><span class="p">[</span><span class="s1">&#39;origin_long&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;longitude&#39;</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">commute_data</span><span class="p">[</span><span class="s1">&#39;office_address&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">current_office</span><span class="p">[</span><span class="s1">&#39;address&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">])][</span><span class="s1">&#39;commute_cost&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="Analyzer.generate_graphs-1288"><a href="#Analyzer.generate_graphs-1288"><span class="linenos">1288</span></a>                <span class="n">base_costs</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">base_costs</span><span class="p">[</span><span class="s1">&#39;latitude&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;latitude&#39;</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">base_costs</span><span class="p">[</span><span class="s1">&#39;longitude&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;longitude&#39;</span><span class="p">]),</span><span class="s1">&#39;cost&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cost</span>
</span><span id="Analyzer.generate_graphs-1289"><a href="#Analyzer.generate_graphs-1289"><span class="linenos">1289</span></a>            <span class="c1"># now we have a dataframe with all employees, and the cost to the current office</span>
</span><span id="Analyzer.generate_graphs-1290"><a href="#Analyzer.generate_graphs-1290"><span class="linenos">1290</span></a>        
</span><span id="Analyzer.generate_graphs-1291"><a href="#Analyzer.generate_graphs-1291"><span class="linenos">1291</span></a>            <span class="c1"># now iterate through the other offices, get a base cost dataframe, and then update the relevant rows with actual costs, place in cost_values</span>
</span><span id="Analyzer.generate_graphs-1292"><a href="#Analyzer.generate_graphs-1292"><span class="linenos">1292</span></a>            <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">other_offices</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
</span><span id="Analyzer.generate_graphs-1293"><a href="#Analyzer.generate_graphs-1293"><span class="linenos">1293</span></a>                <span class="n">office</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">to_frame</span><span class="p">()</span><span class="o">.</span><span class="n">T</span>
</span><span id="Analyzer.generate_graphs-1294"><a href="#Analyzer.generate_graphs-1294"><span class="linenos">1294</span></a>                <span class="n">tmp_costs</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">get_base_cost_df</span><span class="p">(</span><span class="n">emp</span><span class="p">,</span> <span class="n">office</span><span class="p">[</span><span class="s1">&#39;address&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
</span><span id="Analyzer.generate_graphs-1295"><a href="#Analyzer.generate_graphs-1295"><span class="linenos">1295</span></a>                <span class="n">emp_within</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graphing</span><span class="o">.</span><span class="n">filter_drive_distance</span><span class="p">(</span><span class="n">emp</span><span class="p">,</span><span class="n">office</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">commute_range_cut_off</span><span class="p">,</span> <span class="n">commute_data</span><span class="o">=</span><span class="n">commute_data</span><span class="p">)</span>
</span><span id="Analyzer.generate_graphs-1296"><a href="#Analyzer.generate_graphs-1296"><span class="linenos">1296</span></a>                <span class="c1"># we will use this later to get the differential for each employee, without the employees that aren&#39;t overlapping</span>
</span><span id="Analyzer.generate_graphs-1297"><a href="#Analyzer.generate_graphs-1297"><span class="linenos">1297</span></a>                <span class="n">withins</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">emp_within</span><span class="p">)</span>
</span><span id="Analyzer.generate_graphs-1298"><a href="#Analyzer.generate_graphs-1298"><span class="linenos">1298</span></a>                <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">emp_within</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
</span><span id="Analyzer.generate_graphs-1299"><a href="#Analyzer.generate_graphs-1299"><span class="linenos">1299</span></a>                    <span class="c1"># get the cost from the commute_data</span>
</span><span id="Analyzer.generate_graphs-1300"><a href="#Analyzer.generate_graphs-1300"><span class="linenos">1300</span></a>                    <span class="n">cost</span> <span class="o">=</span> <span class="n">commute_data</span><span class="p">[(</span><span class="n">commute_data</span><span class="p">[</span><span class="s1">&#39;origin_lat&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;latitude&#39;</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">commute_data</span><span class="p">[</span><span class="s1">&#39;origin_long&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;longitude&#39;</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">commute_data</span><span class="p">[</span><span class="s1">&#39;office_address&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">office</span><span class="p">[</span><span class="s1">&#39;address&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">])][</span><span class="s1">&#39;commute_cost&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="Analyzer.generate_graphs-1301"><a href="#Analyzer.generate_graphs-1301"><span class="linenos">1301</span></a>                    <span class="n">tmp_costs</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">tmp_costs</span><span class="p">[</span><span class="s1">&#39;latitude&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;latitude&#39;</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">tmp_costs</span><span class="p">[</span><span class="s1">&#39;longitude&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;longitude&#39;</span><span class="p">]),</span><span class="s1">&#39;cost&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cost</span>
</span><span id="Analyzer.generate_graphs-1302"><a href="#Analyzer.generate_graphs-1302"><span class="linenos">1302</span></a>                <span class="n">cost_values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tmp_costs</span><span class="p">)</span>
</span><span id="Analyzer.generate_graphs-1303"><a href="#Analyzer.generate_graphs-1303"><span class="linenos">1303</span></a>            
</span><span id="Analyzer.generate_graphs-1304"><a href="#Analyzer.generate_graphs-1304"><span class="linenos">1304</span></a>            <span class="c1"># now we have a full list of costs for each employee to each office, we can get the differentials</span>
</span><span id="Analyzer.generate_graphs-1305"><a href="#Analyzer.generate_graphs-1305"><span class="linenos">1305</span></a>            <span class="c1"># create a list to hold the differential dataframes</span>
</span><span id="Analyzer.generate_graphs-1306"><a href="#Analyzer.generate_graphs-1306"><span class="linenos">1306</span></a>            <span class="n">diffs</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Analyzer.generate_graphs-1307"><a href="#Analyzer.generate_graphs-1307"><span class="linenos">1307</span></a>            <span class="c1"># for each cost dataframe, calculate the differential from the base_costs dataframe into a new dataframe</span>
</span><span id="Analyzer.generate_graphs-1308"><a href="#Analyzer.generate_graphs-1308"><span class="linenos">1308</span></a>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">cost_values</span><span class="p">)):</span>
</span><span id="Analyzer.generate_graphs-1309"><a href="#Analyzer.generate_graphs-1309"><span class="linenos">1309</span></a>                <span class="c1"># get the differential</span>
</span><span id="Analyzer.generate_graphs-1310"><a href="#Analyzer.generate_graphs-1310"><span class="linenos">1310</span></a>                <span class="n">diffs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cost_values</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;cost&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">base_costs</span><span class="p">[</span><span class="s1">&#39;cost&#39;</span><span class="p">])</span>
</span><span id="Analyzer.generate_graphs-1311"><a href="#Analyzer.generate_graphs-1311"><span class="linenos">1311</span></a>            <span class="c1"># now we have a list of dataframes with the differentials, we eliminate all rows with 0 cost differential to prevent skewing the histogram</span>
</span><span id="Analyzer.generate_graphs-1312"><a href="#Analyzer.generate_graphs-1312"><span class="linenos">1312</span></a>            <span class="c1"># calculate the bin list based upon a the min (negative) and max (positive) values of the data     </span>
</span><span id="Analyzer.generate_graphs-1313"><a href="#Analyzer.generate_graphs-1313"><span class="linenos">1313</span></a>            <span class="n">binmin</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Analyzer.generate_graphs-1314"><a href="#Analyzer.generate_graphs-1314"><span class="linenos">1314</span></a>            <span class="n">binmax</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Analyzer.generate_graphs-1315"><a href="#Analyzer.generate_graphs-1315"><span class="linenos">1315</span></a>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">diffs</span><span class="p">)):</span>
</span><span id="Analyzer.generate_graphs-1316"><a href="#Analyzer.generate_graphs-1316"><span class="linenos">1316</span></a>                <span class="k">if</span> <span class="nb">min</span><span class="p">(</span><span class="n">diffs</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">&lt;</span> <span class="n">binmin</span><span class="p">:</span>
</span><span id="Analyzer.generate_graphs-1317"><a href="#Analyzer.generate_graphs-1317"><span class="linenos">1317</span></a>                    <span class="n">binmin</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">diffs</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</span><span id="Analyzer.generate_graphs-1318"><a href="#Analyzer.generate_graphs-1318"><span class="linenos">1318</span></a>                <span class="k">if</span> <span class="nb">max</span><span class="p">(</span><span class="n">diffs</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">&gt;</span> <span class="n">binmax</span><span class="p">:</span>
</span><span id="Analyzer.generate_graphs-1319"><a href="#Analyzer.generate_graphs-1319"><span class="linenos">1319</span></a>                    <span class="n">binmax</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">diffs</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</span><span id="Analyzer.generate_graphs-1320"><a href="#Analyzer.generate_graphs-1320"><span class="linenos">1320</span></a>            <span class="n">step</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="Analyzer.generate_graphs-1321"><a href="#Analyzer.generate_graphs-1321"><span class="linenos">1321</span></a>            <span class="c1"># round the binmin down to the nearest step, max up to the nearest step</span>
</span><span id="Analyzer.generate_graphs-1322"><a href="#Analyzer.generate_graphs-1322"><span class="linenos">1322</span></a>            <span class="n">bins</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">binmin</span> <span class="o">-</span> <span class="p">(</span><span class="n">binmin</span> <span class="o">%</span> <span class="n">step</span><span class="p">)),</span> <span class="nb">int</span><span class="p">(</span><span class="n">binmax</span> <span class="o">+</span> <span class="n">step</span> <span class="o">-</span> <span class="p">(</span><span class="n">binmax</span> <span class="o">%</span> <span class="n">step</span><span class="p">)),</span> <span class="n">step</span><span class="p">)</span>
</span><span id="Analyzer.generate_graphs-1323"><a href="#Analyzer.generate_graphs-1323"><span class="linenos">1323</span></a>
</span><span id="Analyzer.generate_graphs-1324"><a href="#Analyzer.generate_graphs-1324"><span class="linenos">1324</span></a>            <span class="n">plt</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graphing</span><span class="o">.</span><span class="n">get_histogram</span><span class="p">(</span><span class="n">emp</span><span class="p">,</span> <span class="n">other_offices</span><span class="p">,</span> <span class="n">commute_data</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">suptitle</span><span class="o">=</span><span class="s2">&quot;Employee Commute Cost Differential Analysis&quot;</span><span class="p">,</span> <span class="n">cutoff_radius</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">commute_range_cut_off</span><span class="p">,</span>
</span><span id="Analyzer.generate_graphs-1325"><a href="#Analyzer.generate_graphs-1325"><span class="linenos">1325</span></a>                                      <span class="n">x_label</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="s1">&#39;\$ (USD) based on \$&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">mileage_rate</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39; per mile.&#39;</span><span class="p">),</span> <span class="n">y_label</span><span class="o">=</span><span class="s1">&#39;# Employees (log scale)&#39;</span><span class="p">,</span>
</span><span id="Analyzer.generate_graphs-1326"><a href="#Analyzer.generate_graphs-1326"><span class="linenos">1326</span></a>                                      <span class="n">bins</span><span class="o">=</span><span class="n">bins</span><span class="p">,</span> <span class="n">rows</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">other_offices</span><span class="p">),</span> <span class="n">cols</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">column_titles</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Employee Commute Cost Differential Analysis&quot;</span><span class="p">],</span> 
</span><span id="Analyzer.generate_graphs-1327"><a href="#Analyzer.generate_graphs-1327"><span class="linenos">1327</span></a>                                      <span class="n">cumulative_line</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">font_mod</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">manual_plot</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="Analyzer.generate_graphs-1328"><a href="#Analyzer.generate_graphs-1328"><span class="linenos">1328</span></a>            
</span><span id="Analyzer.generate_graphs-1329"><a href="#Analyzer.generate_graphs-1329"><span class="linenos">1329</span></a>            <span class="c1"># manually add histograms for each office option</span>
</span><span id="Analyzer.generate_graphs-1330"><a href="#Analyzer.generate_graphs-1330"><span class="linenos">1330</span></a>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">diffs</span><span class="p">)):</span>
</span><span id="Analyzer.generate_graphs-1331"><a href="#Analyzer.generate_graphs-1331"><span class="linenos">1331</span></a>                <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">diffs</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">bins</span><span class="o">=</span><span class="n">bins</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;#555555&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">align</span><span class="o">=</span><span class="s1">&#39;mid&#39;</span><span class="p">,</span> 
</span><span id="Analyzer.generate_graphs-1332"><a href="#Analyzer.generate_graphs-1332"><span class="linenos">1332</span></a>                           <span class="n">rwidth</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">other_offices</span><span class="p">[</span><span class="s1">&#39;address&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>
</span><span id="Analyzer.generate_graphs-1333"><a href="#Analyzer.generate_graphs-1333"><span class="linenos">1333</span></a>                <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;major&#39;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
</span><span id="Analyzer.generate_graphs-1334"><a href="#Analyzer.generate_graphs-1334"><span class="linenos">1334</span></a>                
</span><span id="Analyzer.generate_graphs-1335"><a href="#Analyzer.generate_graphs-1335"><span class="linenos">1335</span></a>                <span class="c1"># add a legend to show the office options</span>
</span><span id="Analyzer.generate_graphs-1336"><a href="#Analyzer.generate_graphs-1336"><span class="linenos">1336</span></a>                <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper right&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
</span><span id="Analyzer.generate_graphs-1337"><a href="#Analyzer.generate_graphs-1337"><span class="linenos">1337</span></a>                
</span><span id="Analyzer.generate_graphs-1338"><a href="#Analyzer.generate_graphs-1338"><span class="linenos">1338</span></a>                <span class="c1"># add a text box with the stats, using two decimal places and adding commas at the thousands</span>
</span><span id="Analyzer.generate_graphs-1339"><a href="#Analyzer.generate_graphs-1339"><span class="linenos">1339</span></a>                <span class="n">t</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;me&#39;</span> <span class="p">:</span> <span class="s1">&#39;Median: |$</span><span class="si">{:,.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">diffs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">commutes</span><span class="p">)),</span>
</span><span id="Analyzer.generate_graphs-1340"><a href="#Analyzer.generate_graphs-1340"><span class="linenos">1340</span></a>                    <span class="s1">&#39;av&#39;</span> <span class="p">:</span> <span class="s1">&#39;Average: |$</span><span class="si">{:,.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">diffs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">commutes</span><span class="p">)),</span>
</span><span id="Analyzer.generate_graphs-1341"><a href="#Analyzer.generate_graphs-1341"><span class="linenos">1341</span></a>                    <span class="s1">&#39;mi&#39;</span> <span class="p">:</span> <span class="s1">&#39;Min: |$</span><span class="si">{:,.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">diffs</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">*</span><span class="n">commutes</span><span class="p">),</span>
</span><span id="Analyzer.generate_graphs-1342"><a href="#Analyzer.generate_graphs-1342"><span class="linenos">1342</span></a>                    <span class="s1">&#39;ma&#39;</span> <span class="p">:</span> <span class="s1">&#39;Max: |$</span><span class="si">{:,.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">diffs</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">*</span><span class="n">commutes</span><span class="p">),</span>
</span><span id="Analyzer.generate_graphs-1343"><a href="#Analyzer.generate_graphs-1343"><span class="linenos">1343</span></a>                    <span class="s1">&#39;to&#39;</span> <span class="p">:</span> <span class="s1">&#39;Total: |$</span><span class="si">{:,.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">diffs</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">*</span><span class="n">commutes</span><span class="p">)</span>
</span><span id="Analyzer.generate_graphs-1344"><a href="#Analyzer.generate_graphs-1344"><span class="linenos">1344</span></a>                    <span class="p">}</span>             
</span><span id="Analyzer.generate_graphs-1345"><a href="#Analyzer.generate_graphs-1345"><span class="linenos">1345</span></a>                <span class="c1"># get the longest string value</span>
</span><span id="Analyzer.generate_graphs-1346"><a href="#Analyzer.generate_graphs-1346"><span class="linenos">1346</span></a>                <span class="n">max_len</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="s1">&#39;me&#39;</span><span class="p">]),</span><span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="s1">&#39;av&#39;</span><span class="p">]),</span><span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="s1">&#39;to&#39;</span><span class="p">]),</span><span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="s1">&#39;mi&#39;</span><span class="p">]),</span><span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="s1">&#39;ma&#39;</span><span class="p">]))</span>
</span><span id="Analyzer.generate_graphs-1347"><a href="#Analyzer.generate_graphs-1347"><span class="linenos">1347</span></a>                
</span><span id="Analyzer.generate_graphs-1348"><a href="#Analyzer.generate_graphs-1348"><span class="linenos">1348</span></a>                <span class="c1"># calculate additional space</span>
</span><span id="Analyzer.generate_graphs-1349"><a href="#Analyzer.generate_graphs-1349"><span class="linenos">1349</span></a>                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">t</span><span class="p">:</span>
</span><span id="Analyzer.generate_graphs-1350"><a href="#Analyzer.generate_graphs-1350"><span class="linenos">1350</span></a>                    <span class="n">t</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">t</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">,</span><span class="s2">&quot; &quot;</span><span class="o">*</span><span class="p">(</span><span class="n">max_len</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="n">k</span><span class="p">])))</span>
</span><span id="Analyzer.generate_graphs-1351"><a href="#Analyzer.generate_graphs-1351"><span class="linenos">1351</span></a>
</span><span id="Analyzer.generate_graphs-1352"><a href="#Analyzer.generate_graphs-1352"><span class="linenos">1352</span></a>
</span><span id="Analyzer.generate_graphs-1353"><a href="#Analyzer.generate_graphs-1353"><span class="linenos">1353</span></a>                <span class="c1"># add spaces to make all the same length, replacing |</span>
</span><span id="Analyzer.generate_graphs-1354"><a href="#Analyzer.generate_graphs-1354"><span class="linenos">1354</span></a>                <span class="n">textstr</span> <span class="o">=</span> <span class="s2">&quot;Annualized </span><span class="se">\n</span><span class="s2">Differentials: &quot;</span>
</span><span id="Analyzer.generate_graphs-1355"><a href="#Analyzer.generate_graphs-1355"><span class="linenos">1355</span></a>                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">t</span><span class="p">:</span>
</span><span id="Analyzer.generate_graphs-1356"><a href="#Analyzer.generate_graphs-1356"><span class="linenos">1356</span></a>                    <span class="n">textstr</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">t</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
</span><span id="Analyzer.generate_graphs-1357"><a href="#Analyzer.generate_graphs-1357"><span class="linenos">1357</span></a>                <span class="c1"># these are matplotlib.patch.Patch properties</span>
</span><span id="Analyzer.generate_graphs-1358"><a href="#Analyzer.generate_graphs-1358"><span class="linenos">1358</span></a>                <span class="n">props</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">boxstyle</span><span class="o">=</span><span class="s1">&#39;round&#39;</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;wheat&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
</span><span id="Analyzer.generate_graphs-1359"><a href="#Analyzer.generate_graphs-1359"><span class="linenos">1359</span></a>                <span class="c1"># place a text box in upper left in axes coords, </span>
</span><span id="Analyzer.generate_graphs-1360"><a href="#Analyzer.generate_graphs-1360"><span class="linenos">1360</span></a>                <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">.05</span><span class="p">,</span> <span class="mf">.75</span><span class="p">,</span> <span class="n">textstr</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">,</span>
</span><span id="Analyzer.generate_graphs-1361"><a href="#Analyzer.generate_graphs-1361"><span class="linenos">1361</span></a>                            <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">bbox</span><span class="o">=</span><span class="n">props</span><span class="p">,</span> <span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;family&#39;</span><span class="p">:</span> <span class="s1">&#39;monospace&#39;</span><span class="p">},</span> <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">)</span>
</span><span id="Analyzer.generate_graphs-1362"><a href="#Analyzer.generate_graphs-1362"><span class="linenos">1362</span></a>                
</span><span id="Analyzer.generate_graphs-1363"><a href="#Analyzer.generate_graphs-1363"><span class="linenos">1363</span></a>                <span class="c1"># now, take the base_cost and the cost_values[i] and get the differential for each employee omitting </span>
</span><span id="Analyzer.generate_graphs-1364"><a href="#Analyzer.generate_graphs-1364"><span class="linenos">1364</span></a>                <span class="c1"># any employees that are zero cost in one, and not zero cost in the other</span>
</span><span id="Analyzer.generate_graphs-1365"><a href="#Analyzer.generate_graphs-1365"><span class="linenos">1365</span></a>                <span class="c1"># this will omit those employees who rotated to/from remote work status as a result of the move.</span>
</span><span id="Analyzer.generate_graphs-1366"><a href="#Analyzer.generate_graphs-1366"><span class="linenos">1366</span></a>                <span class="n">mask</span> <span class="o">=</span> <span class="p">(</span><span class="n">cost_values</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;cost&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">base_costs</span><span class="p">[</span><span class="s1">&#39;cost&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="Analyzer.generate_graphs-1367"><a href="#Analyzer.generate_graphs-1367"><span class="linenos">1367</span></a>                <span class="n">differences</span> <span class="o">=</span> <span class="p">(</span><span class="n">cost_values</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;cost&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">base_costs</span><span class="p">[</span><span class="s1">&#39;cost&#39;</span><span class="p">])[</span><span class="n">mask</span><span class="p">]</span>
</span><span id="Analyzer.generate_graphs-1368"><a href="#Analyzer.generate_graphs-1368"><span class="linenos">1368</span></a>                
</span><span id="Analyzer.generate_graphs-1369"><a href="#Analyzer.generate_graphs-1369"><span class="linenos">1369</span></a>                <span class="c1"># Convert differences to a list and store in diffs</span>
</span><span id="Analyzer.generate_graphs-1370"><a href="#Analyzer.generate_graphs-1370"><span class="linenos">1370</span></a>                <span class="n">diffs2</span> <span class="o">=</span> <span class="n">differences</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
</span><span id="Analyzer.generate_graphs-1371"><a href="#Analyzer.generate_graphs-1371"><span class="linenos">1371</span></a>
</span><span id="Analyzer.generate_graphs-1372"><a href="#Analyzer.generate_graphs-1372"><span class="linenos">1372</span></a>                <span class="c1"># get the differential</span>
</span><span id="Analyzer.generate_graphs-1373"><a href="#Analyzer.generate_graphs-1373"><span class="linenos">1373</span></a>                <span class="c1"># get the stats</span>
</span><span id="Analyzer.generate_graphs-1374"><a href="#Analyzer.generate_graphs-1374"><span class="linenos">1374</span></a>                <span class="n">median</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">diffs2</span><span class="p">)</span><span class="o">*</span><span class="n">commutes</span>
</span><span id="Analyzer.generate_graphs-1375"><a href="#Analyzer.generate_graphs-1375"><span class="linenos">1375</span></a>                <span class="n">average</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">diffs2</span><span class="p">)</span><span class="o">*</span><span class="n">commutes</span>
</span><span id="Analyzer.generate_graphs-1376"><a href="#Analyzer.generate_graphs-1376"><span class="linenos">1376</span></a>                <span class="n">minimum</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">diffs2</span><span class="p">)</span><span class="o">*</span><span class="n">commutes</span>
</span><span id="Analyzer.generate_graphs-1377"><a href="#Analyzer.generate_graphs-1377"><span class="linenos">1377</span></a>                <span class="n">maximum</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">diffs2</span><span class="p">)</span><span class="o">*</span><span class="n">commutes</span>
</span><span id="Analyzer.generate_graphs-1378"><a href="#Analyzer.generate_graphs-1378"><span class="linenos">1378</span></a>                <span class="n">total</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">diffs2</span><span class="p">)</span><span class="o">*</span><span class="n">commutes</span>
</span><span id="Analyzer.generate_graphs-1379"><a href="#Analyzer.generate_graphs-1379"><span class="linenos">1379</span></a>               
</span><span id="Analyzer.generate_graphs-1380"><a href="#Analyzer.generate_graphs-1380"><span class="linenos">1380</span></a>                <span class="c1"># add a text box with the stats, using two decimal places and adding commas at the thousands</span>
</span><span id="Analyzer.generate_graphs-1381"><a href="#Analyzer.generate_graphs-1381"><span class="linenos">1381</span></a>                <span class="n">t</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;me&#39;</span> <span class="p">:</span> <span class="s1">&#39;Median: |$</span><span class="si">{:,.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">median</span><span class="p">),</span>
</span><span id="Analyzer.generate_graphs-1382"><a href="#Analyzer.generate_graphs-1382"><span class="linenos">1382</span></a>                    <span class="s1">&#39;av&#39;</span> <span class="p">:</span> <span class="s1">&#39;Average: |$</span><span class="si">{:,.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">average</span><span class="p">),</span>
</span><span id="Analyzer.generate_graphs-1383"><a href="#Analyzer.generate_graphs-1383"><span class="linenos">1383</span></a>                    <span class="s1">&#39;mi&#39;</span> <span class="p">:</span> <span class="s1">&#39;Min: |$</span><span class="si">{:,.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">minimum</span><span class="p">),</span>
</span><span id="Analyzer.generate_graphs-1384"><a href="#Analyzer.generate_graphs-1384"><span class="linenos">1384</span></a>                    <span class="s1">&#39;ma&#39;</span> <span class="p">:</span> <span class="s1">&#39;Max: |$</span><span class="si">{:,.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">maximum</span><span class="p">),</span>
</span><span id="Analyzer.generate_graphs-1385"><a href="#Analyzer.generate_graphs-1385"><span class="linenos">1385</span></a>                    <span class="s1">&#39;to&#39;</span> <span class="p">:</span> <span class="s1">&#39;Total: |$</span><span class="si">{:,.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">total</span><span class="p">)</span>
</span><span id="Analyzer.generate_graphs-1386"><a href="#Analyzer.generate_graphs-1386"><span class="linenos">1386</span></a>                    <span class="p">}</span>
</span><span id="Analyzer.generate_graphs-1387"><a href="#Analyzer.generate_graphs-1387"><span class="linenos">1387</span></a>                
</span><span id="Analyzer.generate_graphs-1388"><a href="#Analyzer.generate_graphs-1388"><span class="linenos">1388</span></a>                <span class="c1"># get the longest string value</span>
</span><span id="Analyzer.generate_graphs-1389"><a href="#Analyzer.generate_graphs-1389"><span class="linenos">1389</span></a>                <span class="n">max_len</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="s1">&#39;me&#39;</span><span class="p">]),</span><span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="s1">&#39;av&#39;</span><span class="p">]),</span><span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="s1">&#39;to&#39;</span><span class="p">]),</span><span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="s1">&#39;mi&#39;</span><span class="p">]),</span><span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="s1">&#39;ma&#39;</span><span class="p">]))</span>
</span><span id="Analyzer.generate_graphs-1390"><a href="#Analyzer.generate_graphs-1390"><span class="linenos">1390</span></a>                <span class="c1"># calculate how many narrow numbers/letters exist in the string, we need to add additional space for each</span>
</span><span id="Analyzer.generate_graphs-1391"><a href="#Analyzer.generate_graphs-1391"><span class="linenos">1391</span></a>                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">t</span><span class="p">:</span>
</span><span id="Analyzer.generate_graphs-1392"><a href="#Analyzer.generate_graphs-1392"><span class="linenos">1392</span></a>                    <span class="n">t</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">t</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">,</span><span class="s2">&quot; &quot;</span><span class="o">*</span><span class="p">(</span><span class="n">max_len</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="n">k</span><span class="p">])))</span>
</span><span id="Analyzer.generate_graphs-1393"><a href="#Analyzer.generate_graphs-1393"><span class="linenos">1393</span></a>                <span class="c1"># add spaces to make all the same length, replacing |</span>
</span><span id="Analyzer.generate_graphs-1394"><a href="#Analyzer.generate_graphs-1394"><span class="linenos">1394</span></a>                <span class="n">textstr</span> <span class="o">=</span> <span class="s2">&quot;Annualized Differentials omitting </span><span class="se">\n</span><span class="s2"> Employees Rotating to/from Remote Work: &quot;</span>
</span><span id="Analyzer.generate_graphs-1395"><a href="#Analyzer.generate_graphs-1395"><span class="linenos">1395</span></a>                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">t</span><span class="p">:</span>
</span><span id="Analyzer.generate_graphs-1396"><a href="#Analyzer.generate_graphs-1396"><span class="linenos">1396</span></a>                    <span class="n">textstr</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">t</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
</span><span id="Analyzer.generate_graphs-1397"><a href="#Analyzer.generate_graphs-1397"><span class="linenos">1397</span></a>                <span class="c1"># place a text box in upper right in axes coords, </span>
</span><span id="Analyzer.generate_graphs-1398"><a href="#Analyzer.generate_graphs-1398"><span class="linenos">1398</span></a>                <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">.95</span><span class="p">,</span> <span class="mf">.75</span><span class="p">,</span> <span class="n">textstr</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">,</span>
</span><span id="Analyzer.generate_graphs-1399"><a href="#Analyzer.generate_graphs-1399"><span class="linenos">1399</span></a>                            <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">bbox</span><span class="o">=</span><span class="n">props</span><span class="p">,</span> <span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;family&#39;</span><span class="p">:</span> <span class="s1">&#39;monospace&#39;</span><span class="p">},</span> <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">)</span>
</span><span id="Analyzer.generate_graphs-1400"><a href="#Analyzer.generate_graphs-1400"><span class="linenos">1400</span></a>                
</span><span id="Analyzer.generate_graphs-1401"><a href="#Analyzer.generate_graphs-1401"><span class="linenos">1401</span></a>
</span><span id="Analyzer.generate_graphs-1402"><a href="#Analyzer.generate_graphs-1402"><span class="linenos">1402</span></a>                <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
</span><span id="Analyzer.generate_graphs-1403"><a href="#Analyzer.generate_graphs-1403"><span class="linenos">1403</span></a>
</span><span id="Analyzer.generate_graphs-1404"><a href="#Analyzer.generate_graphs-1404"><span class="linenos">1404</span></a>
</span><span id="Analyzer.generate_graphs-1405"><a href="#Analyzer.generate_graphs-1405"><span class="linenos">1405</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">(</span><span class="n">pad</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
</span><span id="Analyzer.generate_graphs-1406"><a href="#Analyzer.generate_graphs-1406"><span class="linenos">1406</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">plots_dir</span><span class="o">+</span><span class="s2">&quot;/&quot;</span><span class="o">+</span><span class="n">key</span><span class="o">+</span><span class="s2">&quot;.png&quot;</span><span class="p">)</span>
</span><span id="Analyzer.generate_graphs-1407"><a href="#Analyzer.generate_graphs-1407"><span class="linenos">1407</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="Analyzer.generate_graphs-1408"><a href="#Analyzer.generate_graphs-1408"><span class="linenos">1408</span></a>            
</span><span id="Analyzer.generate_graphs-1409"><a href="#Analyzer.generate_graphs-1409"><span class="linenos">1409</span></a>        
</span><span id="Analyzer.generate_graphs-1410"><a href="#Analyzer.generate_graphs-1410"><span class="linenos">1410</span></a>
</span><span id="Analyzer.generate_graphs-1411"><a href="#Analyzer.generate_graphs-1411"><span class="linenos">1411</span></a>        <span class="c1">################################################################################</span>
</span><span id="Analyzer.generate_graphs-1412"><a href="#Analyzer.generate_graphs-1412"><span class="linenos">1412</span></a>        <span class="c1">### GRAPH SET: Local Analysis for Office X</span>
</span><span id="Analyzer.generate_graphs-1413"><a href="#Analyzer.generate_graphs-1413"><span class="linenos">1413</span></a>        <span class="c1"># iterate through offices, generate a graph for each office</span>
</span><span id="Analyzer.generate_graphs-1414"><a href="#Analyzer.generate_graphs-1414"><span class="linenos">1414</span></a>        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">offices</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>  
</span><span id="Analyzer.generate_graphs-1415"><a href="#Analyzer.generate_graphs-1415"><span class="linenos">1415</span></a>        <span class="c1">################################################################################ </span>
</span><span id="Analyzer.generate_graphs-1416"><a href="#Analyzer.generate_graphs-1416"><span class="linenos">1416</span></a>            <span class="c1"># GRAPH: </span>
</span><span id="Analyzer.generate_graphs-1417"><a href="#Analyzer.generate_graphs-1417"><span class="linenos">1417</span></a>            <span class="c1">## Weekly Commute Duration Analysis</span>
</span><span id="Analyzer.generate_graphs-1418"><a href="#Analyzer.generate_graphs-1418"><span class="linenos">1418</span></a>            <span class="n">key</span> <span class="o">=</span> <span class="s1">&#39;wcda&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
</span><span id="Analyzer.generate_graphs-1419"><a href="#Analyzer.generate_graphs-1419"><span class="linenos">1419</span></a>            <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;Weekly Commute Duration Analysis &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;address&quot;</span><span class="p">])</span>
</span><span id="Analyzer.generate_graphs-1420"><a href="#Analyzer.generate_graphs-1420"><span class="linenos">1420</span></a>            <span class="n">short_title</span> <span class="o">=</span> <span class="n">title</span>
</span><span id="Analyzer.generate_graphs-1421"><a href="#Analyzer.generate_graphs-1421"><span class="linenos">1421</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">graph_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="p">{</span><span class="s2">&quot;GRAPH&quot;</span><span class="p">:</span> <span class="n">key</span><span class="p">,</span>
</span><span id="Analyzer.generate_graphs-1422"><a href="#Analyzer.generate_graphs-1422"><span class="linenos">1422</span></a>                                    <span class="s2">&quot;TITLE&quot;</span><span class="p">:</span> <span class="n">short_title</span><span class="p">,</span>
</span><span id="Analyzer.generate_graphs-1423"><a href="#Analyzer.generate_graphs-1423"><span class="linenos">1423</span></a>                                    <span class="s2">&quot;FILENAME&quot;</span><span class="p">:</span> <span class="n">key</span><span class="o">+</span><span class="s2">&quot;.png&quot;</span><span class="p">,</span>
</span><span id="Analyzer.generate_graphs-1424"><a href="#Analyzer.generate_graphs-1424"><span class="linenos">1424</span></a>                                    <span class="s2">&quot;PLOT-DESCRIPTION&quot;</span><span class="p">:</span>  <span class="s2">&quot;This graph displays the the morning and evening commute durations for employees within the &quot;</span> <span class="o">+</span> \
</span><span id="Analyzer.generate_graphs-1425"><a href="#Analyzer.generate_graphs-1425"><span class="linenos">1425</span></a>                                                        <span class="s2">&quot;cutoff distance of the current office.  The analysis is broken down by day of the week, &quot;</span> <span class="o">+</span> \
</span><span id="Analyzer.generate_graphs-1426"><a href="#Analyzer.generate_graphs-1426"><span class="linenos">1426</span></a>                                                        <span class="s2">&quot;and the distribution of commute times is shown for each day.  The commute times are based on &quot;</span> <span class="o">+</span> \
</span><span id="Analyzer.generate_graphs-1427"><a href="#Analyzer.generate_graphs-1427"><span class="linenos">1427</span></a>                                                        <span class="s2">&quot;the commute data derived based on traffic conditions, and are in minutes. The analysis is specific &quot;</span> <span class="o">+</span> \
</span><span id="Analyzer.generate_graphs-1428"><a href="#Analyzer.generate_graphs-1428"><span class="linenos">1428</span></a>                                                        <span class="s2">&quot;to the office at &quot;</span><span class="o">+</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;address&quot;</span><span class="p">]</span><span class="o">+</span><span class="s2">&quot;.&quot;</span>
</span><span id="Analyzer.generate_graphs-1429"><a href="#Analyzer.generate_graphs-1429"><span class="linenos">1429</span></a>                                    <span class="p">})</span>
</span><span id="Analyzer.generate_graphs-1430"><a href="#Analyzer.generate_graphs-1430"><span class="linenos">1430</span></a>            
</span><span id="Analyzer.generate_graphs-1431"><a href="#Analyzer.generate_graphs-1431"><span class="linenos">1431</span></a>            <span class="k">if</span> <span class="n">graph</span> <span class="o">==</span> <span class="s2">&quot;_all&quot;</span> <span class="ow">or</span> <span class="n">graph</span> <span class="o">==</span> <span class="n">key</span><span class="p">:</span>
</span><span id="Analyzer.generate_graphs-1432"><a href="#Analyzer.generate_graphs-1432"><span class="linenos">1432</span></a>                <span class="c1"># only calculate for the first office, the current office</span>
</span><span id="Analyzer.generate_graphs-1433"><a href="#Analyzer.generate_graphs-1433"><span class="linenos">1433</span></a>                <span class="c1">#office = offices.iloc[0].to_frame().T</span>
</span><span id="Analyzer.generate_graphs-1434"><a href="#Analyzer.generate_graphs-1434"><span class="linenos">1434</span></a>                <span class="n">office</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">to_frame</span><span class="p">()</span><span class="o">.</span><span class="n">T</span>
</span><span id="Analyzer.generate_graphs-1435"><a href="#Analyzer.generate_graphs-1435"><span class="linenos">1435</span></a>                <span class="n">values</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;m_morning_duration_in_traffic&#39;</span><span class="p">,</span><span class="s1">&#39;m_evening_duration_in_traffic&#39;</span><span class="p">,</span>
</span><span id="Analyzer.generate_graphs-1436"><a href="#Analyzer.generate_graphs-1436"><span class="linenos">1436</span></a>                        <span class="s1">&#39;t_morning_duration_in_traffic&#39;</span><span class="p">,</span><span class="s1">&#39;t_evening_duration_in_traffic&#39;</span><span class="p">,</span>
</span><span id="Analyzer.generate_graphs-1437"><a href="#Analyzer.generate_graphs-1437"><span class="linenos">1437</span></a>                        <span class="s1">&#39;w_morning_duration_in_traffic&#39;</span><span class="p">,</span><span class="s1">&#39;w_evening_duration_in_traffic&#39;</span><span class="p">,</span>
</span><span id="Analyzer.generate_graphs-1438"><a href="#Analyzer.generate_graphs-1438"><span class="linenos">1438</span></a>                        <span class="s1">&#39;h_morning_duration_in_traffic&#39;</span><span class="p">,</span><span class="s1">&#39;h_evening_duration_in_traffic&#39;</span><span class="p">,</span>
</span><span id="Analyzer.generate_graphs-1439"><a href="#Analyzer.generate_graphs-1439"><span class="linenos">1439</span></a>                        <span class="s1">&#39;f_morning_duration_in_traffic&#39;</span><span class="p">,</span><span class="s1">&#39;f_evening_duration_in_traffic&#39;</span><span class="p">]</span>
</span><span id="Analyzer.generate_graphs-1440"><a href="#Analyzer.generate_graphs-1440"><span class="linenos">1440</span></a>                <span class="n">cumulative_markers</span> <span class="o">=</span> <span class="p">{</span><span class="mi">50</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;purple&#39;</span><span class="p">,</span> <span class="s1">&#39;marker&#39;</span><span class="p">:</span> <span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="s1">&#39;50%&#39;</span><span class="p">,</span> <span class="s1">&#39;linestyle&#39;</span><span class="p">:</span> <span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="s1">&#39;linewidth&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">},</span>
</span><span id="Analyzer.generate_graphs-1441"><a href="#Analyzer.generate_graphs-1441"><span class="linenos">1441</span></a>                                    <span class="mi">75</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="s1">&#39;marker&#39;</span><span class="p">:</span> <span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="s1">&#39;75%&#39;</span><span class="p">,</span> <span class="s1">&#39;linestyle&#39;</span><span class="p">:</span> <span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="s1">&#39;linewidth&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">},}</span>
</span><span id="Analyzer.generate_graphs-1442"><a href="#Analyzer.generate_graphs-1442"><span class="linenos">1442</span></a>                <span class="c1"># calculate teh bins based on the max value of the data</span>
</span><span id="Analyzer.generate_graphs-1443"><a href="#Analyzer.generate_graphs-1443"><span class="linenos">1443</span></a>                <span class="n">binmax</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Analyzer.generate_graphs-1444"><a href="#Analyzer.generate_graphs-1444"><span class="linenos">1444</span></a>                <span class="n">emp_within</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graphing</span><span class="o">.</span><span class="n">filter_drive_distance</span><span class="p">(</span><span class="n">emp</span><span class="p">,</span><span class="n">office</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">commute_range_cut_off</span><span class="p">,</span> <span class="n">commute_data</span><span class="o">=</span><span class="n">commute_data</span><span class="p">)</span>
</span><span id="Analyzer.generate_graphs-1445"><a href="#Analyzer.generate_graphs-1445"><span class="linenos">1445</span></a>                <span class="n">val_set</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graphing</span><span class="o">.</span><span class="n">get_commute_values</span><span class="p">(</span><span class="n">emp_within</span><span class="p">,</span> <span class="n">office</span><span class="p">,</span> <span class="n">commute_data</span><span class="p">,</span> <span class="n">values</span><span class="p">)</span>
</span><span id="Analyzer.generate_graphs-1446"><a href="#Analyzer.generate_graphs-1446"><span class="linenos">1446</span></a>                <span class="c1"># get max value of val_set</span>
</span><span id="Analyzer.generate_graphs-1447"><a href="#Analyzer.generate_graphs-1447"><span class="linenos">1447</span></a>                <span class="c1"># val_set is a DataFrame containing the extracted values for each employee location that matches the given office location. The DataFrame includes &#39;latitude&#39; and &#39;longitude&#39; of the employee locations and the specified `values`.</span>
</span><span id="Analyzer.generate_graphs-1448"><a href="#Analyzer.generate_graphs-1448"><span class="linenos">1448</span></a>                <span class="k">for</span> <span class="n">each</span> <span class="ow">in</span> <span class="n">values</span><span class="p">:</span>
</span><span id="Analyzer.generate_graphs-1449"><a href="#Analyzer.generate_graphs-1449"><span class="linenos">1449</span></a>                    <span class="k">if</span> <span class="nb">max</span><span class="p">(</span><span class="n">val_set</span><span class="p">[</span><span class="n">each</span><span class="p">])</span> <span class="o">&gt;</span> <span class="n">binmax</span><span class="p">:</span>
</span><span id="Analyzer.generate_graphs-1450"><a href="#Analyzer.generate_graphs-1450"><span class="linenos">1450</span></a>                        <span class="n">binmax</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">val_set</span><span class="p">[</span><span class="n">each</span><span class="p">])</span>            
</span><span id="Analyzer.generate_graphs-1451"><a href="#Analyzer.generate_graphs-1451"><span class="linenos">1451</span></a>                <span class="n">step</span> <span class="o">=</span> <span class="mi">5</span>
</span><span id="Analyzer.generate_graphs-1452"><a href="#Analyzer.generate_graphs-1452"><span class="linenos">1452</span></a>                <span class="c1"># round the binmax up to the nearest step</span>
</span><span id="Analyzer.generate_graphs-1453"><a href="#Analyzer.generate_graphs-1453"><span class="linenos">1453</span></a>                <span class="n">bins</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">binmax</span> <span class="o">+</span> <span class="n">step</span> <span class="o">-</span> <span class="p">(</span><span class="n">binmax</span> <span class="o">%</span> <span class="n">step</span><span class="p">)),</span> <span class="n">step</span><span class="p">)</span>
</span><span id="Analyzer.generate_graphs-1454"><a href="#Analyzer.generate_graphs-1454"><span class="linenos">1454</span></a>                <span class="n">plt</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graphing</span><span class="o">.</span><span class="n">get_histogram</span><span class="p">(</span><span class="n">emp</span><span class="p">,</span> <span class="n">office</span><span class="p">,</span> <span class="n">commute_data</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span> <span class="n">suptitle</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;address&#39;</span><span class="p">])</span><span class="o">+</span><span class="s2">&quot; Commute Analysis&quot;</span><span class="p">,</span> <span class="n">x_label</span><span class="o">=</span><span class="s1">&#39;Minutes in Traffic&#39;</span><span class="p">,</span> <span class="n">y_label</span><span class="o">=</span><span class="s1">&#39;# Employees&#39;</span><span class="p">,</span>  
</span><span id="Analyzer.generate_graphs-1455"><a href="#Analyzer.generate_graphs-1455"><span class="linenos">1455</span></a>                            <span class="n">commute_radius</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">commute_range_cut_off</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="n">bins</span><span class="p">,</span> <span class="n">rows</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">cols</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">column_titles</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Morning Commute&#39;</span><span class="p">,</span><span class="s1">&#39;Evening Commute&#39;</span><span class="p">],</span> <span class="n">cumulative_line</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="Analyzer.generate_graphs-1456"><a href="#Analyzer.generate_graphs-1456"><span class="linenos">1456</span></a>                            <span class="n">cumulative_color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">cumulative_linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">cumulative_linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">cumulative_markers</span><span class="o">=</span><span class="n">cumulative_markers</span><span class="p">,</span> <span class="n">font_mod</span><span class="o">=</span><span class="mf">1.5</span><span class="p">)</span>
</span><span id="Analyzer.generate_graphs-1457"><a href="#Analyzer.generate_graphs-1457"><span class="linenos">1457</span></a>                
</span><span id="Analyzer.generate_graphs-1458"><a href="#Analyzer.generate_graphs-1458"><span class="linenos">1458</span></a>                <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;center right&#39;</span><span class="p">)</span>
</span><span id="Analyzer.generate_graphs-1459"><a href="#Analyzer.generate_graphs-1459"><span class="linenos">1459</span></a>                <span class="k">for</span> <span class="n">each</span> <span class="ow">in</span> <span class="n">plt</span><span class="o">.</span><span class="n">gcf</span><span class="p">()</span><span class="o">.</span><span class="n">get_axes</span><span class="p">():</span>
</span><span id="Analyzer.generate_graphs-1460"><a href="#Analyzer.generate_graphs-1460"><span class="linenos">1460</span></a>                    <span class="c1"># Add monday through Friday labels on first column only</span>
</span><span id="Analyzer.generate_graphs-1461"><a href="#Analyzer.generate_graphs-1461"><span class="linenos">1461</span></a>                    <span class="k">if</span> <span class="n">each</span><span class="o">.</span><span class="n">get_subplotspec</span><span class="p">()</span><span class="o">.</span><span class="n">colspan</span><span class="o">.</span><span class="n">start</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Analyzer.generate_graphs-1462"><a href="#Analyzer.generate_graphs-1462"><span class="linenos">1462</span></a>                        <span class="c1"># first row is monday, second is tuesday, etc</span>
</span><span id="Analyzer.generate_graphs-1463"><a href="#Analyzer.generate_graphs-1463"><span class="linenos">1463</span></a>                        <span class="n">row</span> <span class="o">=</span> <span class="n">each</span><span class="o">.</span><span class="n">get_subplotspec</span><span class="p">()</span><span class="o">.</span><span class="n">rowspan</span><span class="o">.</span><span class="n">start</span>
</span><span id="Analyzer.generate_graphs-1464"><a href="#Analyzer.generate_graphs-1464"><span class="linenos">1464</span></a>                        <span class="k">if</span> <span class="n">row</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Analyzer.generate_graphs-1465"><a href="#Analyzer.generate_graphs-1465"><span class="linenos">1465</span></a>                            <span class="n">each</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.02</span><span class="p">,</span> <span class="mf">0.85</span><span class="p">,</span> <span class="s1">&#39;Monday&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">each</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;top&#39;</span><span class="p">)</span>
</span><span id="Analyzer.generate_graphs-1466"><a href="#Analyzer.generate_graphs-1466"><span class="linenos">1466</span></a>                        <span class="k">elif</span> <span class="n">row</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="Analyzer.generate_graphs-1467"><a href="#Analyzer.generate_graphs-1467"><span class="linenos">1467</span></a>                            <span class="n">each</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.02</span><span class="p">,</span> <span class="mf">0.85</span><span class="p">,</span> <span class="s1">&#39;Tuesday&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">each</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;top&#39;</span><span class="p">)</span>
</span><span id="Analyzer.generate_graphs-1468"><a href="#Analyzer.generate_graphs-1468"><span class="linenos">1468</span></a>                        <span class="k">elif</span> <span class="n">row</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
</span><span id="Analyzer.generate_graphs-1469"><a href="#Analyzer.generate_graphs-1469"><span class="linenos">1469</span></a>                            <span class="n">each</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.02</span><span class="p">,</span> <span class="mf">0.85</span><span class="p">,</span> <span class="s1">&#39;Wednesday&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">each</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;top&#39;</span><span class="p">)</span>
</span><span id="Analyzer.generate_graphs-1470"><a href="#Analyzer.generate_graphs-1470"><span class="linenos">1470</span></a>                        <span class="k">elif</span> <span class="n">row</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
</span><span id="Analyzer.generate_graphs-1471"><a href="#Analyzer.generate_graphs-1471"><span class="linenos">1471</span></a>                            <span class="n">each</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.02</span><span class="p">,</span> <span class="mf">0.85</span><span class="p">,</span> <span class="s1">&#39;Thursday&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">each</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;top&#39;</span><span class="p">)</span>
</span><span id="Analyzer.generate_graphs-1472"><a href="#Analyzer.generate_graphs-1472"><span class="linenos">1472</span></a>                        <span class="k">elif</span> <span class="n">row</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
</span><span id="Analyzer.generate_graphs-1473"><a href="#Analyzer.generate_graphs-1473"><span class="linenos">1473</span></a>                            <span class="n">each</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.02</span><span class="p">,</span> <span class="mf">0.85</span><span class="p">,</span> <span class="s1">&#39;Friday&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">each</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;top&#39;</span><span class="p">)</span>
</span><span id="Analyzer.generate_graphs-1474"><a href="#Analyzer.generate_graphs-1474"><span class="linenos">1474</span></a>                            
</span><span id="Analyzer.generate_graphs-1475"><a href="#Analyzer.generate_graphs-1475"><span class="linenos">1475</span></a>                <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">(</span><span class="n">pad</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
</span><span id="Analyzer.generate_graphs-1476"><a href="#Analyzer.generate_graphs-1476"><span class="linenos">1476</span></a>                <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">plots_dir</span><span class="o">+</span><span class="s2">&quot;/&quot;</span><span class="o">+</span><span class="n">key</span><span class="o">+</span><span class="s2">&quot;.png&quot;</span><span class="p">)</span>
</span><span id="Analyzer.generate_graphs-1477"><a href="#Analyzer.generate_graphs-1477"><span class="linenos">1477</span></a>                <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="Analyzer.generate_graphs-1478"><a href="#Analyzer.generate_graphs-1478"><span class="linenos">1478</span></a>
</span><span id="Analyzer.generate_graphs-1479"><a href="#Analyzer.generate_graphs-1479"><span class="linenos">1479</span></a>
</span><span id="Analyzer.generate_graphs-1480"><a href="#Analyzer.generate_graphs-1480"><span class="linenos">1480</span></a>        <span class="c1">################################################################################</span>
</span><span id="Analyzer.generate_graphs-1481"><a href="#Analyzer.generate_graphs-1481"><span class="linenos">1481</span></a>        <span class="c1">### GRAPH SET: Local Analysis for Office X</span>
</span><span id="Analyzer.generate_graphs-1482"><a href="#Analyzer.generate_graphs-1482"><span class="linenos">1482</span></a>        <span class="c1"># iterate through offices, generate a graph for each office</span>
</span><span id="Analyzer.generate_graphs-1483"><a href="#Analyzer.generate_graphs-1483"><span class="linenos">1483</span></a>        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">offices</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>            
</span><span id="Analyzer.generate_graphs-1484"><a href="#Analyzer.generate_graphs-1484"><span class="linenos">1484</span></a>            <span class="c1"># GRAPH: </span>
</span><span id="Analyzer.generate_graphs-1485"><a href="#Analyzer.generate_graphs-1485"><span class="linenos">1485</span></a>            <span class="c1">## Normalized Weekly Commute Duration Analysis</span>
</span><span id="Analyzer.generate_graphs-1486"><a href="#Analyzer.generate_graphs-1486"><span class="linenos">1486</span></a>            <span class="n">key</span> <span class="o">=</span> <span class="s1">&#39;nwcda&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
</span><span id="Analyzer.generate_graphs-1487"><a href="#Analyzer.generate_graphs-1487"><span class="linenos">1487</span></a>            <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;Normalized Weekly Commute Duration Analysis &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;address&quot;</span><span class="p">])</span>
</span><span id="Analyzer.generate_graphs-1488"><a href="#Analyzer.generate_graphs-1488"><span class="linenos">1488</span></a>            <span class="n">short_title</span> <span class="o">=</span> <span class="n">title</span>
</span><span id="Analyzer.generate_graphs-1489"><a href="#Analyzer.generate_graphs-1489"><span class="linenos">1489</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">graph_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="p">{</span><span class="s2">&quot;GRAPH&quot;</span><span class="p">:</span> <span class="n">key</span><span class="p">,</span>
</span><span id="Analyzer.generate_graphs-1490"><a href="#Analyzer.generate_graphs-1490"><span class="linenos">1490</span></a>                                    <span class="s2">&quot;TITLE&quot;</span><span class="p">:</span> <span class="n">short_title</span><span class="p">,</span>
</span><span id="Analyzer.generate_graphs-1491"><a href="#Analyzer.generate_graphs-1491"><span class="linenos">1491</span></a>                                    <span class="s2">&quot;FILENAME&quot;</span><span class="p">:</span> <span class="n">key</span><span class="o">+</span><span class="s2">&quot;.png&quot;</span><span class="p">,</span>
</span><span id="Analyzer.generate_graphs-1492"><a href="#Analyzer.generate_graphs-1492"><span class="linenos">1492</span></a>                                    <span class="s2">&quot;PLOT-DESCRIPTION&quot;</span><span class="p">:</span>  <span class="s2">&quot;This graph displays the the morning and evening commute durations for employees within the &quot;</span> <span class="o">+</span> \
</span><span id="Analyzer.generate_graphs-1493"><a href="#Analyzer.generate_graphs-1493"><span class="linenos">1493</span></a>                                                        <span class="s2">&quot;cutoff distance of the current office, normalized to reflect the duration in traffic as a percentage &quot;</span> <span class="o">+</span> \
</span><span id="Analyzer.generate_graphs-1494"><a href="#Analyzer.generate_graphs-1494"><span class="linenos">1494</span></a>                                                        <span class="s2">&quot; of the duration without traffic.  The analysis is broken down by day of the week, &quot;</span> <span class="o">+</span> \
</span><span id="Analyzer.generate_graphs-1495"><a href="#Analyzer.generate_graphs-1495"><span class="linenos">1495</span></a>                                                        <span class="s2">&quot;and the distribution of commute times is shown for each day.  The commute times are based on &quot;</span> <span class="o">+</span> \
</span><span id="Analyzer.generate_graphs-1496"><a href="#Analyzer.generate_graphs-1496"><span class="linenos">1496</span></a>                                                        <span class="s2">&quot;the commute data derived based on traffic conditions, and are in minutes. The analysis is specific &quot;</span> <span class="o">+</span> \
</span><span id="Analyzer.generate_graphs-1497"><a href="#Analyzer.generate_graphs-1497"><span class="linenos">1497</span></a>                                                        <span class="s2">&quot;to the office at &quot;</span><span class="o">+</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;address&quot;</span><span class="p">]</span><span class="o">+</span><span class="s2">&quot;.&quot;</span>
</span><span id="Analyzer.generate_graphs-1498"><a href="#Analyzer.generate_graphs-1498"><span class="linenos">1498</span></a>                                    <span class="p">})</span>
</span><span id="Analyzer.generate_graphs-1499"><a href="#Analyzer.generate_graphs-1499"><span class="linenos">1499</span></a>            
</span><span id="Analyzer.generate_graphs-1500"><a href="#Analyzer.generate_graphs-1500"><span class="linenos">1500</span></a>            <span class="k">if</span> <span class="n">graph</span> <span class="o">==</span> <span class="s2">&quot;_all&quot;</span> <span class="ow">or</span> <span class="n">graph</span> <span class="o">==</span> <span class="n">key</span><span class="p">:</span>
</span><span id="Analyzer.generate_graphs-1501"><a href="#Analyzer.generate_graphs-1501"><span class="linenos">1501</span></a>                <span class="c1"># only calculate for the first office, the current office</span>
</span><span id="Analyzer.generate_graphs-1502"><a href="#Analyzer.generate_graphs-1502"><span class="linenos">1502</span></a>                <span class="c1">#office = offices.iloc[0].to_frame().T</span>
</span><span id="Analyzer.generate_graphs-1503"><a href="#Analyzer.generate_graphs-1503"><span class="linenos">1503</span></a>                <span class="n">office</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">to_frame</span><span class="p">()</span><span class="o">.</span><span class="n">T</span>
</span><span id="Analyzer.generate_graphs-1504"><a href="#Analyzer.generate_graphs-1504"><span class="linenos">1504</span></a>                <span class="n">values</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;m_morning_duration_in_traffic&#39;</span><span class="p">,</span><span class="s1">&#39;m_evening_duration_in_traffic&#39;</span><span class="p">,</span>
</span><span id="Analyzer.generate_graphs-1505"><a href="#Analyzer.generate_graphs-1505"><span class="linenos">1505</span></a>                        <span class="s1">&#39;t_morning_duration_in_traffic&#39;</span><span class="p">,</span><span class="s1">&#39;t_evening_duration_in_traffic&#39;</span><span class="p">,</span>
</span><span id="Analyzer.generate_graphs-1506"><a href="#Analyzer.generate_graphs-1506"><span class="linenos">1506</span></a>                        <span class="s1">&#39;w_morning_duration_in_traffic&#39;</span><span class="p">,</span><span class="s1">&#39;w_evening_duration_in_traffic&#39;</span><span class="p">,</span>
</span><span id="Analyzer.generate_graphs-1507"><a href="#Analyzer.generate_graphs-1507"><span class="linenos">1507</span></a>                        <span class="s1">&#39;h_morning_duration_in_traffic&#39;</span><span class="p">,</span><span class="s1">&#39;h_evening_duration_in_traffic&#39;</span><span class="p">,</span>
</span><span id="Analyzer.generate_graphs-1508"><a href="#Analyzer.generate_graphs-1508"><span class="linenos">1508</span></a>                        <span class="s1">&#39;f_morning_duration_in_traffic&#39;</span><span class="p">,</span><span class="s1">&#39;f_evening_duration_in_traffic&#39;</span><span class="p">]</span>
</span><span id="Analyzer.generate_graphs-1509"><a href="#Analyzer.generate_graphs-1509"><span class="linenos">1509</span></a>                <span class="n">cumulative_markers</span> <span class="o">=</span> <span class="p">{</span><span class="mi">50</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;purple&#39;</span><span class="p">,</span> <span class="s1">&#39;marker&#39;</span><span class="p">:</span> <span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="s1">&#39;Median (min)&#39;</span><span class="p">,</span> <span class="s1">&#39;linestyle&#39;</span><span class="p">:</span> <span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="s1">&#39;linewidth&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">}}</span>
</span><span id="Analyzer.generate_graphs-1510"><a href="#Analyzer.generate_graphs-1510"><span class="linenos">1510</span></a>                
</span><span id="Analyzer.generate_graphs-1511"><a href="#Analyzer.generate_graphs-1511"><span class="linenos">1511</span></a>                <span class="n">emp_within</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graphing</span><span class="o">.</span><span class="n">filter_drive_distance</span><span class="p">(</span><span class="n">emp</span><span class="p">,</span><span class="n">office</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">commute_range_cut_off</span><span class="p">,</span> <span class="n">commute_data</span><span class="o">=</span><span class="n">commute_data</span><span class="p">)</span>
</span><span id="Analyzer.generate_graphs-1512"><a href="#Analyzer.generate_graphs-1512"><span class="linenos">1512</span></a>                <span class="n">val_set</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graphing</span><span class="o">.</span><span class="n">get_commute_values</span><span class="p">(</span><span class="n">emp_within</span><span class="p">,</span> <span class="n">office</span><span class="p">,</span> <span class="n">commute_data</span><span class="p">,</span> <span class="n">values</span><span class="p">)</span>
</span><span id="Analyzer.generate_graphs-1513"><a href="#Analyzer.generate_graphs-1513"><span class="linenos">1513</span></a>                <span class="n">val_set_free</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graphing</span><span class="o">.</span><span class="n">get_commute_values</span><span class="p">(</span><span class="n">emp_within</span><span class="p">,</span> <span class="n">office</span><span class="p">,</span> <span class="n">commute_data</span><span class="p">,</span> <span class="s2">&quot;duration&quot;</span><span class="p">)</span>
</span><span id="Analyzer.generate_graphs-1514"><a href="#Analyzer.generate_graphs-1514"><span class="linenos">1514</span></a>                <span class="c1"># Normalize the values in val_set by dividing by the corresponding values in val_set_free, and multiplying by 100</span>
</span><span id="Analyzer.generate_graphs-1515"><a href="#Analyzer.generate_graphs-1515"><span class="linenos">1515</span></a>                <span class="k">for</span> <span class="n">each</span> <span class="ow">in</span> <span class="n">values</span><span class="p">:</span>
</span><span id="Analyzer.generate_graphs-1516"><a href="#Analyzer.generate_graphs-1516"><span class="linenos">1516</span></a>                    <span class="n">val_set</span><span class="p">[</span><span class="n">each</span><span class="p">]</span> <span class="o">=</span> <span class="n">val_set</span><span class="p">[</span><span class="n">each</span><span class="p">]</span> <span class="o">/</span> <span class="n">val_set_free</span><span class="p">[</span><span class="s1">&#39;duration&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">100</span>
</span><span id="Analyzer.generate_graphs-1517"><a href="#Analyzer.generate_graphs-1517"><span class="linenos">1517</span></a>                
</span><span id="Analyzer.generate_graphs-1518"><a href="#Analyzer.generate_graphs-1518"><span class="linenos">1518</span></a>                <span class="c1"># calculate teh bins based on the max value of the data</span>
</span><span id="Analyzer.generate_graphs-1519"><a href="#Analyzer.generate_graphs-1519"><span class="linenos">1519</span></a>                <span class="n">binmax</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Analyzer.generate_graphs-1520"><a href="#Analyzer.generate_graphs-1520"><span class="linenos">1520</span></a>                <span class="n">binmin</span> <span class="o">=</span> <span class="mi">100</span>
</span><span id="Analyzer.generate_graphs-1521"><a href="#Analyzer.generate_graphs-1521"><span class="linenos">1521</span></a>                <span class="k">for</span> <span class="n">each</span> <span class="ow">in</span> <span class="n">values</span><span class="p">:</span>
</span><span id="Analyzer.generate_graphs-1522"><a href="#Analyzer.generate_graphs-1522"><span class="linenos">1522</span></a>                    <span class="k">if</span> <span class="nb">max</span><span class="p">(</span><span class="n">val_set</span><span class="p">[</span><span class="n">each</span><span class="p">])</span> <span class="o">&gt;</span> <span class="n">binmax</span><span class="p">:</span>
</span><span id="Analyzer.generate_graphs-1523"><a href="#Analyzer.generate_graphs-1523"><span class="linenos">1523</span></a>                        <span class="n">binmax</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">val_set</span><span class="p">[</span><span class="n">each</span><span class="p">])</span>
</span><span id="Analyzer.generate_graphs-1524"><a href="#Analyzer.generate_graphs-1524"><span class="linenos">1524</span></a>                    <span class="k">if</span> <span class="nb">min</span><span class="p">(</span><span class="n">val_set</span><span class="p">[</span><span class="n">each</span><span class="p">])</span> <span class="o">&lt;</span> <span class="n">binmin</span><span class="p">:</span>
</span><span id="Analyzer.generate_graphs-1525"><a href="#Analyzer.generate_graphs-1525"><span class="linenos">1525</span></a>                        <span class="n">binmin</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">val_set</span><span class="p">[</span><span class="n">each</span><span class="p">])</span>            
</span><span id="Analyzer.generate_graphs-1526"><a href="#Analyzer.generate_graphs-1526"><span class="linenos">1526</span></a>                <span class="n">step</span> <span class="o">=</span> <span class="mi">5</span>
</span><span id="Analyzer.generate_graphs-1527"><a href="#Analyzer.generate_graphs-1527"><span class="linenos">1527</span></a>                <span class="c1"># round the binmax up to the nearest step, and binmin down to the nearest step</span>
</span><span id="Analyzer.generate_graphs-1528"><a href="#Analyzer.generate_graphs-1528"><span class="linenos">1528</span></a>                <span class="n">bins</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">binmin</span> <span class="o">-</span> <span class="p">(</span><span class="n">binmin</span> <span class="o">%</span> <span class="n">step</span><span class="p">)),</span> <span class="nb">int</span><span class="p">(</span><span class="n">binmax</span> <span class="o">+</span> <span class="n">step</span> <span class="o">-</span> <span class="p">(</span><span class="n">binmax</span> <span class="o">%</span> <span class="n">step</span><span class="p">)),</span> <span class="n">step</span><span class="p">)</span>
</span><span id="Analyzer.generate_graphs-1529"><a href="#Analyzer.generate_graphs-1529"><span class="linenos">1529</span></a>                
</span><span id="Analyzer.generate_graphs-1530"><a href="#Analyzer.generate_graphs-1530"><span class="linenos">1530</span></a>                <span class="n">plt</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graphing</span><span class="o">.</span><span class="n">get_histogram</span><span class="p">(</span><span class="n">emp</span><span class="p">,</span> <span class="n">office</span><span class="p">,</span> <span class="n">commute_data</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span> <span class="n">suptitle</span><span class="o">=</span><span class="s2">&quot;Normalized &#39;In Traffic&#39; Commute Analysis, </span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;address&#39;</span><span class="p">]),</span> 
</span><span id="Analyzer.generate_graphs-1531"><a href="#Analyzer.generate_graphs-1531"><span class="linenos">1531</span></a>                                                      <span class="n">x_label</span><span class="o">=</span><span class="s1">&#39;Normalized (In-Traffic / Traffic-Free) </span><span class="se">\n</span><span class="s1"> Commute Duration (%)&#39;</span><span class="p">,</span> <span class="n">y_label</span><span class="o">=</span><span class="s1">&#39;# Employees&#39;</span><span class="p">,</span>  
</span><span id="Analyzer.generate_graphs-1532"><a href="#Analyzer.generate_graphs-1532"><span class="linenos">1532</span></a>                            <span class="n">commute_radius</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">commute_range_cut_off</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="n">bins</span><span class="p">,</span> <span class="n">rows</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">cols</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">column_titles</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Morning Commute&#39;</span><span class="p">,</span><span class="s1">&#39;Evening Commute&#39;</span><span class="p">],</span> <span class="n">cumulative_line</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="Analyzer.generate_graphs-1533"><a href="#Analyzer.generate_graphs-1533"><span class="linenos">1533</span></a>                            <span class="n">cumulative_color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">cumulative_linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">cumulative_linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">cumulative_markers</span><span class="o">=</span><span class="n">cumulative_markers</span><span class="p">,</span> 
</span><span id="Analyzer.generate_graphs-1534"><a href="#Analyzer.generate_graphs-1534"><span class="linenos">1534</span></a>                            <span class="n">override_values</span><span class="o">=</span><span class="n">val_set</span><span class="p">,</span> <span class="n">font_mod</span><span class="o">=</span><span class="mf">1.5</span><span class="p">)</span>
</span><span id="Analyzer.generate_graphs-1535"><a href="#Analyzer.generate_graphs-1535"><span class="linenos">1535</span></a>                
</span><span id="Analyzer.generate_graphs-1536"><a href="#Analyzer.generate_graphs-1536"><span class="linenos">1536</span></a>                
</span><span id="Analyzer.generate_graphs-1537"><a href="#Analyzer.generate_graphs-1537"><span class="linenos">1537</span></a>                <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;center right&#39;</span><span class="p">)</span>
</span><span id="Analyzer.generate_graphs-1538"><a href="#Analyzer.generate_graphs-1538"><span class="linenos">1538</span></a>                <span class="k">for</span> <span class="n">each</span> <span class="ow">in</span> <span class="n">plt</span><span class="o">.</span><span class="n">gcf</span><span class="p">()</span><span class="o">.</span><span class="n">get_axes</span><span class="p">():</span>
</span><span id="Analyzer.generate_graphs-1539"><a href="#Analyzer.generate_graphs-1539"><span class="linenos">1539</span></a>                    <span class="c1"># Add monday through Friday labels on first column only</span>
</span><span id="Analyzer.generate_graphs-1540"><a href="#Analyzer.generate_graphs-1540"><span class="linenos">1540</span></a>                    <span class="k">if</span> <span class="n">each</span><span class="o">.</span><span class="n">get_subplotspec</span><span class="p">()</span><span class="o">.</span><span class="n">colspan</span><span class="o">.</span><span class="n">start</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Analyzer.generate_graphs-1541"><a href="#Analyzer.generate_graphs-1541"><span class="linenos">1541</span></a>                        <span class="c1"># first row is monday, second is tuesday, etc</span>
</span><span id="Analyzer.generate_graphs-1542"><a href="#Analyzer.generate_graphs-1542"><span class="linenos">1542</span></a>                        <span class="n">row</span> <span class="o">=</span> <span class="n">each</span><span class="o">.</span><span class="n">get_subplotspec</span><span class="p">()</span><span class="o">.</span><span class="n">rowspan</span><span class="o">.</span><span class="n">start</span>
</span><span id="Analyzer.generate_graphs-1543"><a href="#Analyzer.generate_graphs-1543"><span class="linenos">1543</span></a>                        <span class="k">if</span> <span class="n">row</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Analyzer.generate_graphs-1544"><a href="#Analyzer.generate_graphs-1544"><span class="linenos">1544</span></a>                            <span class="n">each</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.02</span><span class="p">,</span> <span class="mf">0.85</span><span class="p">,</span> <span class="s1">&#39;Monday&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">each</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;top&#39;</span><span class="p">)</span>
</span><span id="Analyzer.generate_graphs-1545"><a href="#Analyzer.generate_graphs-1545"><span class="linenos">1545</span></a>                        <span class="k">elif</span> <span class="n">row</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="Analyzer.generate_graphs-1546"><a href="#Analyzer.generate_graphs-1546"><span class="linenos">1546</span></a>                            <span class="n">each</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.02</span><span class="p">,</span> <span class="mf">0.85</span><span class="p">,</span> <span class="s1">&#39;Tuesday&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">each</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;top&#39;</span><span class="p">)</span>
</span><span id="Analyzer.generate_graphs-1547"><a href="#Analyzer.generate_graphs-1547"><span class="linenos">1547</span></a>                        <span class="k">elif</span> <span class="n">row</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
</span><span id="Analyzer.generate_graphs-1548"><a href="#Analyzer.generate_graphs-1548"><span class="linenos">1548</span></a>                            <span class="n">each</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.02</span><span class="p">,</span> <span class="mf">0.85</span><span class="p">,</span> <span class="s1">&#39;Wednesday&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">each</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;top&#39;</span><span class="p">)</span>
</span><span id="Analyzer.generate_graphs-1549"><a href="#Analyzer.generate_graphs-1549"><span class="linenos">1549</span></a>                        <span class="k">elif</span> <span class="n">row</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
</span><span id="Analyzer.generate_graphs-1550"><a href="#Analyzer.generate_graphs-1550"><span class="linenos">1550</span></a>                            <span class="n">each</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.02</span><span class="p">,</span> <span class="mf">0.85</span><span class="p">,</span> <span class="s1">&#39;Thursday&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">each</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;top&#39;</span><span class="p">)</span>
</span><span id="Analyzer.generate_graphs-1551"><a href="#Analyzer.generate_graphs-1551"><span class="linenos">1551</span></a>                        <span class="k">elif</span> <span class="n">row</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
</span><span id="Analyzer.generate_graphs-1552"><a href="#Analyzer.generate_graphs-1552"><span class="linenos">1552</span></a>                            <span class="n">each</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.02</span><span class="p">,</span> <span class="mf">0.85</span><span class="p">,</span> <span class="s1">&#39;Friday&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">each</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;top&#39;</span><span class="p">)</span>
</span><span id="Analyzer.generate_graphs-1553"><a href="#Analyzer.generate_graphs-1553"><span class="linenos">1553</span></a>                            
</span><span id="Analyzer.generate_graphs-1554"><a href="#Analyzer.generate_graphs-1554"><span class="linenos">1554</span></a>                <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">(</span><span class="n">pad</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
</span><span id="Analyzer.generate_graphs-1555"><a href="#Analyzer.generate_graphs-1555"><span class="linenos">1555</span></a>                <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">plots_dir</span><span class="o">+</span><span class="s2">&quot;/&quot;</span><span class="o">+</span><span class="n">key</span><span class="o">+</span><span class="s2">&quot;.png&quot;</span><span class="p">)</span>
</span><span id="Analyzer.generate_graphs-1556"><a href="#Analyzer.generate_graphs-1556"><span class="linenos">1556</span></a>                <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="Analyzer.generate_graphs-1557"><a href="#Analyzer.generate_graphs-1557"><span class="linenos">1557</span></a>
</span><span id="Analyzer.generate_graphs-1558"><a href="#Analyzer.generate_graphs-1558"><span class="linenos">1558</span></a>
</span><span id="Analyzer.generate_graphs-1559"><a href="#Analyzer.generate_graphs-1559"><span class="linenos">1559</span></a>
</span><span id="Analyzer.generate_graphs-1560"><a href="#Analyzer.generate_graphs-1560"><span class="linenos">1560</span></a>        <span class="c1">############################################################################################################</span>
</span><span id="Analyzer.generate_graphs-1561"><a href="#Analyzer.generate_graphs-1561"><span class="linenos">1561</span></a>        <span class="c1"># GRAPH:</span>
</span><span id="Analyzer.generate_graphs-1562"><a href="#Analyzer.generate_graphs-1562"><span class="linenos">1562</span></a>        <span class="c1">## Normalized Commute Distribution Analysis</span>
</span><span id="Analyzer.generate_graphs-1563"><a href="#Analyzer.generate_graphs-1563"><span class="linenos">1563</span></a>        <span class="n">key</span> <span class="o">=</span> <span class="s1">&#39;ncda&#39;</span>
</span><span id="Analyzer.generate_graphs-1564"><a href="#Analyzer.generate_graphs-1564"><span class="linenos">1564</span></a>        <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;Normalized Commute Distribution Analysis&quot;</span>
</span><span id="Analyzer.generate_graphs-1565"><a href="#Analyzer.generate_graphs-1565"><span class="linenos">1565</span></a>        <span class="n">short_title</span> <span class="o">=</span> <span class="n">title</span>
</span><span id="Analyzer.generate_graphs-1566"><a href="#Analyzer.generate_graphs-1566"><span class="linenos">1566</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">graph_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="p">{</span><span class="s2">&quot;GRAPH&quot;</span><span class="p">:</span> <span class="n">key</span><span class="p">,</span>
</span><span id="Analyzer.generate_graphs-1567"><a href="#Analyzer.generate_graphs-1567"><span class="linenos">1567</span></a>                                <span class="s2">&quot;TITLE&quot;</span><span class="p">:</span> <span class="n">short_title</span><span class="p">,</span>
</span><span id="Analyzer.generate_graphs-1568"><a href="#Analyzer.generate_graphs-1568"><span class="linenos">1568</span></a>                                <span class="s2">&quot;FILENAME&quot;</span><span class="p">:</span> <span class="n">key</span><span class="o">+</span><span class="s2">&quot;.png&quot;</span><span class="p">,</span>
</span><span id="Analyzer.generate_graphs-1569"><a href="#Analyzer.generate_graphs-1569"><span class="linenos">1569</span></a>                                <span class="s2">&quot;PLOT-DESCRIPTION&quot;</span><span class="p">:</span>  <span class="s2">&quot;This graph plots the the normalized commute durations against the distance of the commute. &quot;</span> <span class="o">+</span> \
</span><span id="Analyzer.generate_graphs-1570"><a href="#Analyzer.generate_graphs-1570"><span class="linenos">1570</span></a>                                                    <span class="s2">&quot;The objective is to affirm that the tails of the distribution are driven by shorter distance commutes &quot;</span> <span class="o">+</span> \
</span><span id="Analyzer.generate_graphs-1571"><a href="#Analyzer.generate_graphs-1571"><span class="linenos">1571</span></a>                                                    <span class="s2">&quot;and therefore present minimal risk of skewing the analysis when an average across days/employees is taken.&quot;</span>
</span><span id="Analyzer.generate_graphs-1572"><a href="#Analyzer.generate_graphs-1572"><span class="linenos">1572</span></a>                                <span class="p">})</span>
</span><span id="Analyzer.generate_graphs-1573"><a href="#Analyzer.generate_graphs-1573"><span class="linenos">1573</span></a>        
</span><span id="Analyzer.generate_graphs-1574"><a href="#Analyzer.generate_graphs-1574"><span class="linenos">1574</span></a>        <span class="k">if</span> <span class="n">graph</span> <span class="o">==</span> <span class="s2">&quot;_all&quot;</span> <span class="ow">or</span> <span class="n">graph</span> <span class="o">==</span> <span class="n">key</span><span class="p">:</span>
</span><span id="Analyzer.generate_graphs-1575"><a href="#Analyzer.generate_graphs-1575"><span class="linenos">1575</span></a>            <span class="n">office</span> <span class="o">=</span> <span class="n">offices</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">to_frame</span><span class="p">()</span><span class="o">.</span><span class="n">T</span>
</span><span id="Analyzer.generate_graphs-1576"><a href="#Analyzer.generate_graphs-1576"><span class="linenos">1576</span></a>            <span class="n">values</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;m_morning_duration_in_traffic&#39;</span><span class="p">,</span><span class="s1">&#39;m_evening_duration_in_traffic&#39;</span><span class="p">,</span>
</span><span id="Analyzer.generate_graphs-1577"><a href="#Analyzer.generate_graphs-1577"><span class="linenos">1577</span></a>                    <span class="s1">&#39;t_morning_duration_in_traffic&#39;</span><span class="p">,</span><span class="s1">&#39;t_evening_duration_in_traffic&#39;</span><span class="p">,</span>
</span><span id="Analyzer.generate_graphs-1578"><a href="#Analyzer.generate_graphs-1578"><span class="linenos">1578</span></a>                    <span class="s1">&#39;w_morning_duration_in_traffic&#39;</span><span class="p">,</span><span class="s1">&#39;w_evening_duration_in_traffic&#39;</span><span class="p">,</span>
</span><span id="Analyzer.generate_graphs-1579"><a href="#Analyzer.generate_graphs-1579"><span class="linenos">1579</span></a>                    <span class="s1">&#39;h_morning_duration_in_traffic&#39;</span><span class="p">,</span><span class="s1">&#39;h_evening_duration_in_traffic&#39;</span><span class="p">,</span>
</span><span id="Analyzer.generate_graphs-1580"><a href="#Analyzer.generate_graphs-1580"><span class="linenos">1580</span></a>                    <span class="s1">&#39;f_morning_duration_in_traffic&#39;</span><span class="p">,</span><span class="s1">&#39;f_evening_duration_in_traffic&#39;</span><span class="p">]</span>
</span><span id="Analyzer.generate_graphs-1581"><a href="#Analyzer.generate_graphs-1581"><span class="linenos">1581</span></a>            <span class="n">data_labels</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Monday Morning&#39;</span><span class="p">,</span><span class="s1">&#39;Monday Evening&#39;</span><span class="p">,</span>
</span><span id="Analyzer.generate_graphs-1582"><a href="#Analyzer.generate_graphs-1582"><span class="linenos">1582</span></a>                    <span class="s1">&#39;Tuesday Morning&#39;</span><span class="p">,</span><span class="s1">&#39;Tuesday Evening&#39;</span><span class="p">,</span>
</span><span id="Analyzer.generate_graphs-1583"><a href="#Analyzer.generate_graphs-1583"><span class="linenos">1583</span></a>                    <span class="s1">&#39;Wednesday Morning&#39;</span><span class="p">,</span><span class="s1">&#39;Wednesday Evening&#39;</span><span class="p">,</span>
</span><span id="Analyzer.generate_graphs-1584"><a href="#Analyzer.generate_graphs-1584"><span class="linenos">1584</span></a>                    <span class="s1">&#39;Thursday Morning&#39;</span><span class="p">,</span><span class="s1">&#39;Thursday Evening&#39;</span><span class="p">,</span>
</span><span id="Analyzer.generate_graphs-1585"><a href="#Analyzer.generate_graphs-1585"><span class="linenos">1585</span></a>                    <span class="s1">&#39;Friday Morning&#39;</span><span class="p">,</span><span class="s1">&#39;Friday Evening&#39;</span><span class="p">]</span>
</span><span id="Analyzer.generate_graphs-1586"><a href="#Analyzer.generate_graphs-1586"><span class="linenos">1586</span></a>            <span class="n">emp_within</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graphing</span><span class="o">.</span><span class="n">filter_drive_distance</span><span class="p">(</span><span class="n">emp</span><span class="p">,</span><span class="n">office</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">commute_range_cut_off</span><span class="p">,</span> <span class="n">commute_data</span><span class="o">=</span><span class="n">commute_data</span><span class="p">)</span>
</span><span id="Analyzer.generate_graphs-1587"><a href="#Analyzer.generate_graphs-1587"><span class="linenos">1587</span></a>            <span class="n">val_set</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graphing</span><span class="o">.</span><span class="n">get_commute_values</span><span class="p">(</span><span class="n">emp_within</span><span class="p">,</span> <span class="n">office</span><span class="p">,</span> <span class="n">commute_data</span><span class="p">,</span> <span class="n">values</span><span class="p">)</span>
</span><span id="Analyzer.generate_graphs-1588"><a href="#Analyzer.generate_graphs-1588"><span class="linenos">1588</span></a>            <span class="n">val_set_free</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graphing</span><span class="o">.</span><span class="n">get_commute_values</span><span class="p">(</span><span class="n">emp_within</span><span class="p">,</span> <span class="n">office</span><span class="p">,</span> <span class="n">commute_data</span><span class="p">,</span> <span class="s2">&quot;duration&quot;</span><span class="p">)</span>
</span><span id="Analyzer.generate_graphs-1589"><a href="#Analyzer.generate_graphs-1589"><span class="linenos">1589</span></a>            <span class="n">val_set_miles</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graphing</span><span class="o">.</span><span class="n">get_commute_values</span><span class="p">(</span><span class="n">emp_within</span><span class="p">,</span> <span class="n">office</span><span class="p">,</span> <span class="n">commute_data</span><span class="p">,</span> <span class="s2">&quot;miles&quot;</span><span class="p">)</span>
</span><span id="Analyzer.generate_graphs-1590"><a href="#Analyzer.generate_graphs-1590"><span class="linenos">1590</span></a>            <span class="c1"># Normalize the values in val_set by dividing by the corresponding values in val_set_free, and multiplying by 100</span>
</span><span id="Analyzer.generate_graphs-1591"><a href="#Analyzer.generate_graphs-1591"><span class="linenos">1591</span></a>            <span class="k">for</span> <span class="n">each</span> <span class="ow">in</span> <span class="n">values</span><span class="p">:</span>
</span><span id="Analyzer.generate_graphs-1592"><a href="#Analyzer.generate_graphs-1592"><span class="linenos">1592</span></a>                <span class="n">val_set</span><span class="p">[</span><span class="n">each</span><span class="p">]</span> <span class="o">=</span> <span class="n">val_set</span><span class="p">[</span><span class="n">each</span><span class="p">]</span> <span class="o">/</span> <span class="n">val_set_free</span><span class="p">[</span><span class="s1">&#39;duration&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">100</span>
</span><span id="Analyzer.generate_graphs-1593"><a href="#Analyzer.generate_graphs-1593"><span class="linenos">1593</span></a>
</span><span id="Analyzer.generate_graphs-1594"><a href="#Analyzer.generate_graphs-1594"><span class="linenos">1594</span></a>            <span class="n">plt</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graphing</span><span class="o">.</span><span class="n">get_scatterplot</span><span class="p">(</span><span class="n">emp</span><span class="p">,</span> <span class="n">office</span><span class="p">,</span> <span class="n">commute_data</span><span class="p">,</span> <span class="s2">&quot;miles&quot;</span><span class="p">,</span> <span class="s2">&quot;duration&quot;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span> <span class="n">x_label</span><span class="o">=</span><span class="s1">&#39;Normalized (In-Traffic / Traffic-Free) </span><span class="se">\n</span><span class="s1"> Commute Duration (%)&#39;</span><span class="p">,</span> 
</span><span id="Analyzer.generate_graphs-1595"><a href="#Analyzer.generate_graphs-1595"><span class="linenos">1595</span></a>                                                    <span class="n">y_label</span><span class="o">=</span><span class="s1">&#39;Commute Distance miles&#39;</span><span class="p">,</span>
</span><span id="Analyzer.generate_graphs-1596"><a href="#Analyzer.generate_graphs-1596"><span class="linenos">1596</span></a>                                                    <span class="n">cutoff_radius</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">commute_range_cut_off</span><span class="p">,</span> <span class="n">commute_radius</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">commute_range_cut_off</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">15</span><span class="p">),</span> <span class="n">manual_plot</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">font_mod</span><span class="o">=</span><span class="mf">1.5</span><span class="p">)</span>
</span><span id="Analyzer.generate_graphs-1597"><a href="#Analyzer.generate_graphs-1597"><span class="linenos">1597</span></a>            <span class="c1"># manually add scatter plots for each day</span>
</span><span id="Analyzer.generate_graphs-1598"><a href="#Analyzer.generate_graphs-1598"><span class="linenos">1598</span></a>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">)):</span>
</span><span id="Analyzer.generate_graphs-1599"><a href="#Analyzer.generate_graphs-1599"><span class="linenos">1599</span></a>                <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">val_set</span><span class="p">[</span><span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">]],</span> <span class="n">val_set_miles</span><span class="p">[</span><span class="s1">&#39;miles&#39;</span><span class="p">],</span>  <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;#555555&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> 
</span><span id="Analyzer.generate_graphs-1600"><a href="#Analyzer.generate_graphs-1600"><span class="linenos">1600</span></a>                           <span class="n">label</span><span class="o">=</span><span class="n">data_labels</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
</span><span id="Analyzer.generate_graphs-1601"><a href="#Analyzer.generate_graphs-1601"><span class="linenos">1601</span></a>                
</span><span id="Analyzer.generate_graphs-1602"><a href="#Analyzer.generate_graphs-1602"><span class="linenos">1602</span></a>                <span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;major&#39;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
</span><span id="Analyzer.generate_graphs-1603"><a href="#Analyzer.generate_graphs-1603"><span class="linenos">1603</span></a>              
</span><span id="Analyzer.generate_graphs-1604"><a href="#Analyzer.generate_graphs-1604"><span class="linenos">1604</span></a>                <span class="c1"># add a legend to show the office options</span>
</span><span id="Analyzer.generate_graphs-1605"><a href="#Analyzer.generate_graphs-1605"><span class="linenos">1605</span></a>                <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper right&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
</span><span id="Analyzer.generate_graphs-1606"><a href="#Analyzer.generate_graphs-1606"><span class="linenos">1606</span></a>
</span><span id="Analyzer.generate_graphs-1607"><a href="#Analyzer.generate_graphs-1607"><span class="linenos">1607</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">(</span><span class="n">pad</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
</span><span id="Analyzer.generate_graphs-1608"><a href="#Analyzer.generate_graphs-1608"><span class="linenos">1608</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">plots_dir</span><span class="o">+</span><span class="s2">&quot;/&quot;</span><span class="o">+</span><span class="n">key</span><span class="o">+</span><span class="s2">&quot;.png&quot;</span><span class="p">)</span>
</span><span id="Analyzer.generate_graphs-1609"><a href="#Analyzer.generate_graphs-1609"><span class="linenos">1609</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="Analyzer.generate_graphs-1610"><a href="#Analyzer.generate_graphs-1610"><span class="linenos">1610</span></a>
</span><span id="Analyzer.generate_graphs-1611"><a href="#Analyzer.generate_graphs-1611"><span class="linenos">1611</span></a>
</span><span id="Analyzer.generate_graphs-1612"><a href="#Analyzer.generate_graphs-1612"><span class="linenos">1612</span></a>        <span class="c1">############################################################################################################</span>
</span><span id="Analyzer.generate_graphs-1613"><a href="#Analyzer.generate_graphs-1613"><span class="linenos">1613</span></a>        <span class="c1"># GRAPH:</span>
</span><span id="Analyzer.generate_graphs-1614"><a href="#Analyzer.generate_graphs-1614"><span class="linenos">1614</span></a>        <span class="c1">## Normalized Commute Distribution Analysis Heat Map</span>
</span><span id="Analyzer.generate_graphs-1615"><a href="#Analyzer.generate_graphs-1615"><span class="linenos">1615</span></a>        <span class="n">key</span> <span class="o">=</span> <span class="s1">&#39;ncdahm&#39;</span>
</span><span id="Analyzer.generate_graphs-1616"><a href="#Analyzer.generate_graphs-1616"><span class="linenos">1616</span></a>        <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;Normalized Commute Distribution Analysis Heat Map&quot;</span>
</span><span id="Analyzer.generate_graphs-1617"><a href="#Analyzer.generate_graphs-1617"><span class="linenos">1617</span></a>        <span class="n">short_title</span> <span class="o">=</span> <span class="n">title</span>
</span><span id="Analyzer.generate_graphs-1618"><a href="#Analyzer.generate_graphs-1618"><span class="linenos">1618</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">graph_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="p">{</span><span class="s2">&quot;GRAPH&quot;</span><span class="p">:</span> <span class="n">key</span><span class="p">,</span>
</span><span id="Analyzer.generate_graphs-1619"><a href="#Analyzer.generate_graphs-1619"><span class="linenos">1619</span></a>                                <span class="s2">&quot;TITLE&quot;</span><span class="p">:</span> <span class="n">short_title</span><span class="p">,</span>
</span><span id="Analyzer.generate_graphs-1620"><a href="#Analyzer.generate_graphs-1620"><span class="linenos">1620</span></a>                                <span class="s2">&quot;FILENAME&quot;</span><span class="p">:</span> <span class="n">key</span><span class="o">+</span><span class="s2">&quot;.png&quot;</span><span class="p">,</span>
</span><span id="Analyzer.generate_graphs-1621"><a href="#Analyzer.generate_graphs-1621"><span class="linenos">1621</span></a>                                <span class="s2">&quot;PLOT-DESCRIPTION&quot;</span><span class="p">:</span>  <span class="s2">&quot;This graph plots the the normalized commute durations against the distance of the commute in a heat map. &quot;</span> <span class="o">+</span> \
</span><span id="Analyzer.generate_graphs-1622"><a href="#Analyzer.generate_graphs-1622"><span class="linenos">1622</span></a>                                                    <span class="s2">&quot;The objective is to understand the geography driving any strong departures from average or standard deviation.&quot;</span>
</span><span id="Analyzer.generate_graphs-1623"><a href="#Analyzer.generate_graphs-1623"><span class="linenos">1623</span></a>                                <span class="p">})</span>
</span><span id="Analyzer.generate_graphs-1624"><a href="#Analyzer.generate_graphs-1624"><span class="linenos">1624</span></a>        
</span><span id="Analyzer.generate_graphs-1625"><a href="#Analyzer.generate_graphs-1625"><span class="linenos">1625</span></a>        <span class="k">if</span> <span class="n">graph</span> <span class="o">==</span> <span class="s2">&quot;_all&quot;</span> <span class="ow">or</span> <span class="n">graph</span> <span class="o">==</span> <span class="n">key</span><span class="p">:</span>
</span><span id="Analyzer.generate_graphs-1626"><a href="#Analyzer.generate_graphs-1626"><span class="linenos">1626</span></a>            <span class="n">office</span> <span class="o">=</span> <span class="n">offices</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">to_frame</span><span class="p">()</span><span class="o">.</span><span class="n">T</span>
</span><span id="Analyzer.generate_graphs-1627"><a href="#Analyzer.generate_graphs-1627"><span class="linenos">1627</span></a>            <span class="n">values</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;m_morning_duration_in_traffic&#39;</span><span class="p">,</span><span class="s1">&#39;m_evening_duration_in_traffic&#39;</span><span class="p">,</span>
</span><span id="Analyzer.generate_graphs-1628"><a href="#Analyzer.generate_graphs-1628"><span class="linenos">1628</span></a>                    <span class="s1">&#39;t_morning_duration_in_traffic&#39;</span><span class="p">,</span><span class="s1">&#39;t_evening_duration_in_traffic&#39;</span><span class="p">,</span>
</span><span id="Analyzer.generate_graphs-1629"><a href="#Analyzer.generate_graphs-1629"><span class="linenos">1629</span></a>                    <span class="s1">&#39;w_morning_duration_in_traffic&#39;</span><span class="p">,</span><span class="s1">&#39;w_evening_duration_in_traffic&#39;</span><span class="p">,</span>
</span><span id="Analyzer.generate_graphs-1630"><a href="#Analyzer.generate_graphs-1630"><span class="linenos">1630</span></a>                    <span class="s1">&#39;h_morning_duration_in_traffic&#39;</span><span class="p">,</span><span class="s1">&#39;h_evening_duration_in_traffic&#39;</span><span class="p">,</span>
</span><span id="Analyzer.generate_graphs-1631"><a href="#Analyzer.generate_graphs-1631"><span class="linenos">1631</span></a>                    <span class="s1">&#39;f_morning_duration_in_traffic&#39;</span><span class="p">,</span><span class="s1">&#39;f_evening_duration_in_traffic&#39;</span><span class="p">]</span>
</span><span id="Analyzer.generate_graphs-1632"><a href="#Analyzer.generate_graphs-1632"><span class="linenos">1632</span></a>            <span class="n">data_labels</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Monday Morning&#39;</span><span class="p">,</span><span class="s1">&#39;Monday Evening&#39;</span><span class="p">,</span>
</span><span id="Analyzer.generate_graphs-1633"><a href="#Analyzer.generate_graphs-1633"><span class="linenos">1633</span></a>                    <span class="s1">&#39;Tuesday Morning&#39;</span><span class="p">,</span><span class="s1">&#39;Tuesday Evening&#39;</span><span class="p">,</span>
</span><span id="Analyzer.generate_graphs-1634"><a href="#Analyzer.generate_graphs-1634"><span class="linenos">1634</span></a>                    <span class="s1">&#39;Wednesday Morning&#39;</span><span class="p">,</span><span class="s1">&#39;Wednesday Evening&#39;</span><span class="p">,</span>
</span><span id="Analyzer.generate_graphs-1635"><a href="#Analyzer.generate_graphs-1635"><span class="linenos">1635</span></a>                    <span class="s1">&#39;Thursday Morning&#39;</span><span class="p">,</span><span class="s1">&#39;Thursday Evening&#39;</span><span class="p">,</span>
</span><span id="Analyzer.generate_graphs-1636"><a href="#Analyzer.generate_graphs-1636"><span class="linenos">1636</span></a>                    <span class="s1">&#39;Friday Morning&#39;</span><span class="p">,</span><span class="s1">&#39;Friday Evening&#39;</span><span class="p">]</span>
</span><span id="Analyzer.generate_graphs-1637"><a href="#Analyzer.generate_graphs-1637"><span class="linenos">1637</span></a>            
</span><span id="Analyzer.generate_graphs-1638"><a href="#Analyzer.generate_graphs-1638"><span class="linenos">1638</span></a>            <span class="n">emp_within</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graphing</span><span class="o">.</span><span class="n">filter_drive_distance</span><span class="p">(</span><span class="n">emp</span><span class="p">,</span><span class="n">office</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">commute_range_cut_off</span><span class="p">,</span> <span class="n">commute_data</span><span class="o">=</span><span class="n">commute_data</span><span class="p">)</span>
</span><span id="Analyzer.generate_graphs-1639"><a href="#Analyzer.generate_graphs-1639"><span class="linenos">1639</span></a>            <span class="n">val_set</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graphing</span><span class="o">.</span><span class="n">get_commute_values</span><span class="p">(</span><span class="n">emp_within</span><span class="p">,</span> <span class="n">office</span><span class="p">,</span> <span class="n">commute_data</span><span class="p">,</span> <span class="n">commute_data</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">to_list</span><span class="p">())</span>
</span><span id="Analyzer.generate_graphs-1640"><a href="#Analyzer.generate_graphs-1640"><span class="linenos">1640</span></a>            <span class="c1"># restore origin_lat and origin_long to the val_set</span>
</span><span id="Analyzer.generate_graphs-1641"><a href="#Analyzer.generate_graphs-1641"><span class="linenos">1641</span></a>            <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;origin_lat&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;latitude&#39;</span><span class="p">]</span>
</span><span id="Analyzer.generate_graphs-1642"><a href="#Analyzer.generate_graphs-1642"><span class="linenos">1642</span></a>            <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;origin_long&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;longitude&#39;</span><span class="p">]</span>
</span><span id="Analyzer.generate_graphs-1643"><a href="#Analyzer.generate_graphs-1643"><span class="linenos">1643</span></a>            <span class="n">val_set_free</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graphing</span><span class="o">.</span><span class="n">get_commute_values</span><span class="p">(</span><span class="n">emp_within</span><span class="p">,</span> <span class="n">office</span><span class="p">,</span> <span class="n">commute_data</span><span class="p">,</span> <span class="s2">&quot;duration&quot;</span><span class="p">)</span>
</span><span id="Analyzer.generate_graphs-1644"><a href="#Analyzer.generate_graphs-1644"><span class="linenos">1644</span></a>            <span class="c1"># Normalize the values in val_set by dividing by the corresponding values in val_set_free, and multiplying by 100</span>
</span><span id="Analyzer.generate_graphs-1645"><a href="#Analyzer.generate_graphs-1645"><span class="linenos">1645</span></a>            <span class="k">for</span> <span class="n">each</span> <span class="ow">in</span> <span class="n">values</span><span class="p">:</span>
</span><span id="Analyzer.generate_graphs-1646"><a href="#Analyzer.generate_graphs-1646"><span class="linenos">1646</span></a>                <span class="n">val_set</span><span class="p">[</span><span class="n">each</span><span class="p">]</span> <span class="o">=</span> <span class="n">val_set</span><span class="p">[</span><span class="n">each</span><span class="p">]</span> <span class="o">/</span> <span class="n">val_set_free</span><span class="p">[</span><span class="s1">&#39;duration&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">100</span>
</span><span id="Analyzer.generate_graphs-1647"><a href="#Analyzer.generate_graphs-1647"><span class="linenos">1647</span></a>            
</span><span id="Analyzer.generate_graphs-1648"><a href="#Analyzer.generate_graphs-1648"><span class="linenos">1648</span></a>            <span class="n">plt</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graphing</span><span class="o">.</span><span class="n">get_heatmap</span><span class="p">(</span><span class="n">emp_within</span><span class="p">,</span> <span class="n">office</span><span class="p">,</span> <span class="n">val_set</span><span class="p">,</span> <span class="n">values</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span> 
</span><span id="Analyzer.generate_graphs-1649"><a href="#Analyzer.generate_graphs-1649"><span class="linenos">1649</span></a>                                                <span class="n">value_label</span><span class="o">=</span><span class="s2">&quot;Normalized Commute in Traffic (% vs. Free)&quot;</span><span class="p">,</span> <span class="n">cutoff_distance</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">commute_range_cut_off</span><span class="p">,</span> <span class="n">commute_radius</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">commute_range_cut_off</span><span class="p">,</span>
</span><span id="Analyzer.generate_graphs-1650"><a href="#Analyzer.generate_graphs-1650"><span class="linenos">1650</span></a>                                                <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;jet&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">levels</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">font_mod</span><span class="o">=</span><span class="mf">1.5</span><span class="p">)</span>
</span><span id="Analyzer.generate_graphs-1651"><a href="#Analyzer.generate_graphs-1651"><span class="linenos">1651</span></a>
</span><span id="Analyzer.generate_graphs-1652"><a href="#Analyzer.generate_graphs-1652"><span class="linenos">1652</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">(</span><span class="n">pad</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
</span><span id="Analyzer.generate_graphs-1653"><a href="#Analyzer.generate_graphs-1653"><span class="linenos">1653</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">plots_dir</span><span class="o">+</span><span class="s2">&quot;/&quot;</span><span class="o">+</span><span class="n">key</span><span class="o">+</span><span class="s2">&quot;.png&quot;</span><span class="p">)</span>
</span><span id="Analyzer.generate_graphs-1654"><a href="#Analyzer.generate_graphs-1654"><span class="linenos">1654</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="Analyzer.generate_graphs-1655"><a href="#Analyzer.generate_graphs-1655"><span class="linenos">1655</span></a>            
</span><span id="Analyzer.generate_graphs-1656"><a href="#Analyzer.generate_graphs-1656"><span class="linenos">1656</span></a>        <span class="c1">################################################################################</span>
</span><span id="Analyzer.generate_graphs-1657"><a href="#Analyzer.generate_graphs-1657"><span class="linenos">1657</span></a>        <span class="c1">### GRAPH SET: Local Analysis for Office X</span>
</span><span id="Analyzer.generate_graphs-1658"><a href="#Analyzer.generate_graphs-1658"><span class="linenos">1658</span></a>        <span class="c1"># iterate through offices, generate a graph for each office</span>
</span><span id="Analyzer.generate_graphs-1659"><a href="#Analyzer.generate_graphs-1659"><span class="linenos">1659</span></a>        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">offices</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>    
</span><span id="Analyzer.generate_graphs-1660"><a href="#Analyzer.generate_graphs-1660"><span class="linenos">1660</span></a>        <span class="c1">############################################################################################################</span>
</span><span id="Analyzer.generate_graphs-1661"><a href="#Analyzer.generate_graphs-1661"><span class="linenos">1661</span></a>            <span class="c1"># GRAPH:</span>
</span><span id="Analyzer.generate_graphs-1662"><a href="#Analyzer.generate_graphs-1662"><span class="linenos">1662</span></a>            <span class="c1">## Normalized Commute Standard Deviation Analysis</span>
</span><span id="Analyzer.generate_graphs-1663"><a href="#Analyzer.generate_graphs-1663"><span class="linenos">1663</span></a>            <span class="n">key</span> <span class="o">=</span> <span class="s1">&#39;ncsda&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
</span><span id="Analyzer.generate_graphs-1664"><a href="#Analyzer.generate_graphs-1664"><span class="linenos">1664</span></a>            <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;Normalized Commute Standard Deviation Analysis&quot;</span> <span class="o">+</span> <span class="s2">&quot; for </span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;address&quot;</span><span class="p">]</span>
</span><span id="Analyzer.generate_graphs-1665"><a href="#Analyzer.generate_graphs-1665"><span class="linenos">1665</span></a>            <span class="n">short_title</span> <span class="o">=</span> <span class="n">title</span>
</span><span id="Analyzer.generate_graphs-1666"><a href="#Analyzer.generate_graphs-1666"><span class="linenos">1666</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">graph_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="p">{</span><span class="s2">&quot;GRAPH&quot;</span><span class="p">:</span> <span class="n">key</span><span class="p">,</span>
</span><span id="Analyzer.generate_graphs-1667"><a href="#Analyzer.generate_graphs-1667"><span class="linenos">1667</span></a>                                    <span class="s2">&quot;TITLE&quot;</span><span class="p">:</span> <span class="n">short_title</span><span class="p">,</span>
</span><span id="Analyzer.generate_graphs-1668"><a href="#Analyzer.generate_graphs-1668"><span class="linenos">1668</span></a>                                    <span class="s2">&quot;FILENAME&quot;</span><span class="p">:</span> <span class="n">key</span><span class="o">+</span><span class="s2">&quot;.png&quot;</span><span class="p">,</span>
</span><span id="Analyzer.generate_graphs-1669"><a href="#Analyzer.generate_graphs-1669"><span class="linenos">1669</span></a>                                    <span class="s2">&quot;PLOT-DESCRIPTION&quot;</span><span class="p">:</span>  <span class="s2">&quot;This graph shows the per-employee distribution of standard deviation to assess the &quot;</span> <span class="o">+</span> \
</span><span id="Analyzer.generate_graphs-1670"><a href="#Analyzer.generate_graphs-1670"><span class="linenos">1670</span></a>                                    <span class="s2">&quot;validity of using the average commute time as a metric for comparison.  This analysis is specific to the &quot;</span> <span class="o">+</span> \
</span><span id="Analyzer.generate_graphs-1671"><a href="#Analyzer.generate_graphs-1671"><span class="linenos">1671</span></a>                                    <span class="s2">&quot;office location at &quot;</span> <span class="o">+</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;address&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;.&quot;</span>
</span><span id="Analyzer.generate_graphs-1672"><a href="#Analyzer.generate_graphs-1672"><span class="linenos">1672</span></a>                                    <span class="p">})</span>
</span><span id="Analyzer.generate_graphs-1673"><a href="#Analyzer.generate_graphs-1673"><span class="linenos">1673</span></a>            
</span><span id="Analyzer.generate_graphs-1674"><a href="#Analyzer.generate_graphs-1674"><span class="linenos">1674</span></a>            <span class="k">if</span> <span class="n">graph</span> <span class="o">==</span> <span class="s2">&quot;_all&quot;</span> <span class="ow">or</span> <span class="n">graph</span> <span class="o">==</span> <span class="n">key</span><span class="p">:</span>
</span><span id="Analyzer.generate_graphs-1675"><a href="#Analyzer.generate_graphs-1675"><span class="linenos">1675</span></a>                <span class="n">office</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">to_frame</span><span class="p">()</span><span class="o">.</span><span class="n">T</span>
</span><span id="Analyzer.generate_graphs-1676"><a href="#Analyzer.generate_graphs-1676"><span class="linenos">1676</span></a>                <span class="n">values</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;m_morning_duration_in_traffic&#39;</span><span class="p">,</span><span class="s1">&#39;m_evening_duration_in_traffic&#39;</span><span class="p">,</span>
</span><span id="Analyzer.generate_graphs-1677"><a href="#Analyzer.generate_graphs-1677"><span class="linenos">1677</span></a>                        <span class="s1">&#39;t_morning_duration_in_traffic&#39;</span><span class="p">,</span><span class="s1">&#39;t_evening_duration_in_traffic&#39;</span><span class="p">,</span>
</span><span id="Analyzer.generate_graphs-1678"><a href="#Analyzer.generate_graphs-1678"><span class="linenos">1678</span></a>                        <span class="s1">&#39;w_morning_duration_in_traffic&#39;</span><span class="p">,</span><span class="s1">&#39;w_evening_duration_in_traffic&#39;</span><span class="p">,</span>
</span><span id="Analyzer.generate_graphs-1679"><a href="#Analyzer.generate_graphs-1679"><span class="linenos">1679</span></a>                        <span class="s1">&#39;h_morning_duration_in_traffic&#39;</span><span class="p">,</span><span class="s1">&#39;h_evening_duration_in_traffic&#39;</span><span class="p">,</span>
</span><span id="Analyzer.generate_graphs-1680"><a href="#Analyzer.generate_graphs-1680"><span class="linenos">1680</span></a>                        <span class="s1">&#39;f_morning_duration_in_traffic&#39;</span><span class="p">,</span><span class="s1">&#39;f_evening_duration_in_traffic&#39;</span><span class="p">]</span>
</span><span id="Analyzer.generate_graphs-1681"><a href="#Analyzer.generate_graphs-1681"><span class="linenos">1681</span></a>
</span><span id="Analyzer.generate_graphs-1682"><a href="#Analyzer.generate_graphs-1682"><span class="linenos">1682</span></a>                <span class="n">emp_within</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graphing</span><span class="o">.</span><span class="n">filter_drive_distance</span><span class="p">(</span><span class="n">emp</span><span class="p">,</span><span class="n">office</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">commute_range_cut_off</span><span class="p">,</span> <span class="n">commute_data</span><span class="o">=</span><span class="n">commute_data</span><span class="p">)</span>
</span><span id="Analyzer.generate_graphs-1683"><a href="#Analyzer.generate_graphs-1683"><span class="linenos">1683</span></a>                <span class="n">val_set</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graphing</span><span class="o">.</span><span class="n">get_commute_values</span><span class="p">(</span><span class="n">emp_within</span><span class="p">,</span> <span class="n">office</span><span class="p">,</span> <span class="n">commute_data</span><span class="p">,</span> <span class="n">values</span><span class="p">)</span>
</span><span id="Analyzer.generate_graphs-1684"><a href="#Analyzer.generate_graphs-1684"><span class="linenos">1684</span></a>                <span class="n">val_set_free</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graphing</span><span class="o">.</span><span class="n">get_commute_values</span><span class="p">(</span><span class="n">emp_within</span><span class="p">,</span> <span class="n">office</span><span class="p">,</span> <span class="n">commute_data</span><span class="p">,</span> <span class="s2">&quot;duration&quot;</span><span class="p">)</span>
</span><span id="Analyzer.generate_graphs-1685"><a href="#Analyzer.generate_graphs-1685"><span class="linenos">1685</span></a>                <span class="n">val_set_miles</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graphing</span><span class="o">.</span><span class="n">get_commute_values</span><span class="p">(</span><span class="n">emp_within</span><span class="p">,</span> <span class="n">office</span><span class="p">,</span> <span class="n">commute_data</span><span class="p">,</span> <span class="s2">&quot;miles&quot;</span><span class="p">)</span>
</span><span id="Analyzer.generate_graphs-1686"><a href="#Analyzer.generate_graphs-1686"><span class="linenos">1686</span></a>                
</span><span id="Analyzer.generate_graphs-1687"><a href="#Analyzer.generate_graphs-1687"><span class="linenos">1687</span></a>                <span class="n">mean</span> <span class="o">=</span> <span class="n">val_set</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="n">values</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="Analyzer.generate_graphs-1688"><a href="#Analyzer.generate_graphs-1688"><span class="linenos">1688</span></a>                <span class="n">std</span> <span class="o">=</span> <span class="n">val_set</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="n">values</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="Analyzer.generate_graphs-1689"><a href="#Analyzer.generate_graphs-1689"><span class="linenos">1689</span></a>                <span class="n">max_val</span> <span class="o">=</span> <span class="n">val_set</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="n">values</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="Analyzer.generate_graphs-1690"><a href="#Analyzer.generate_graphs-1690"><span class="linenos">1690</span></a>                <span class="n">min_val</span> <span class="o">=</span> <span class="n">val_set</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="n">values</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="Analyzer.generate_graphs-1691"><a href="#Analyzer.generate_graphs-1691"><span class="linenos">1691</span></a>                <span class="n">data_labels</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Mean&#39;</span><span class="p">,</span><span class="s1">&#39;Standard Deviation&#39;</span><span class="p">,</span><span class="s1">&#39;Max&#39;</span><span class="p">,</span><span class="s1">&#39;Min&#39;</span><span class="p">]</span>
</span><span id="Analyzer.generate_graphs-1692"><a href="#Analyzer.generate_graphs-1692"><span class="linenos">1692</span></a>                <span class="n">x</span> <span class="o">=</span> <span class="p">[</span><span class="n">mean</span><span class="p">,</span> <span class="n">std</span><span class="p">,</span> <span class="n">max_val</span><span class="p">,</span> <span class="n">min_val</span><span class="p">]</span>
</span><span id="Analyzer.generate_graphs-1693"><a href="#Analyzer.generate_graphs-1693"><span class="linenos">1693</span></a>                <span class="c1"># Normalize the values in val_set by dividing by the corresponding values in val_set_free, and multiplying by 100</span>
</span><span id="Analyzer.generate_graphs-1694"><a href="#Analyzer.generate_graphs-1694"><span class="linenos">1694</span></a>                <span class="c1">#for each in values:</span>
</span><span id="Analyzer.generate_graphs-1695"><a href="#Analyzer.generate_graphs-1695"><span class="linenos">1695</span></a>                <span class="c1">#   val_set[each] = val_set[each] / val_set_free[&#39;duration&#39;] * 100</span>
</span><span id="Analyzer.generate_graphs-1696"><a href="#Analyzer.generate_graphs-1696"><span class="linenos">1696</span></a>
</span><span id="Analyzer.generate_graphs-1697"><a href="#Analyzer.generate_graphs-1697"><span class="linenos">1697</span></a>                <span class="n">plt</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graphing</span><span class="o">.</span><span class="n">get_scatterplot</span><span class="p">(</span><span class="n">emp</span><span class="p">,</span> <span class="n">office</span><span class="p">,</span> <span class="n">commute_data</span><span class="p">,</span> <span class="s2">&quot;miles&quot;</span><span class="p">,</span> <span class="s2">&quot;duration&quot;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span> <span class="n">x_label</span><span class="o">=</span><span class="s1">&#39;Duration (min)&#39;</span><span class="p">,</span> 
</span><span id="Analyzer.generate_graphs-1698"><a href="#Analyzer.generate_graphs-1698"><span class="linenos">1698</span></a>                                                        <span class="n">y_label</span><span class="o">=</span><span class="s1">&#39;Commute Distance (miles)&#39;</span><span class="p">,</span>
</span><span id="Analyzer.generate_graphs-1699"><a href="#Analyzer.generate_graphs-1699"><span class="linenos">1699</span></a>                                                        <span class="n">cutoff_radius</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">commute_range_cut_off</span><span class="p">,</span> <span class="n">commute_radius</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">commute_range_cut_off</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">15</span><span class="p">),</span> <span class="n">manual_plot</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">font_mod</span><span class="o">=</span><span class="mf">1.5</span><span class="p">)</span>
</span><span id="Analyzer.generate_graphs-1700"><a href="#Analyzer.generate_graphs-1700"><span class="linenos">1700</span></a>                
</span><span id="Analyzer.generate_graphs-1701"><a href="#Analyzer.generate_graphs-1701"><span class="linenos">1701</span></a>                <span class="c1"># manually add scatter plots for each day</span>
</span><span id="Analyzer.generate_graphs-1702"><a href="#Analyzer.generate_graphs-1702"><span class="linenos">1702</span></a>                <span class="c1">#for i in range(len(data_labels)):</span>
</span><span id="Analyzer.generate_graphs-1703"><a href="#Analyzer.generate_graphs-1703"><span class="linenos">1703</span></a>                <span class="n">i</span><span class="o">=</span><span class="mi">1</span>
</span><span id="Analyzer.generate_graphs-1704"><a href="#Analyzer.generate_graphs-1704"><span class="linenos">1704</span></a>                <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">val_set_miles</span><span class="p">[</span><span class="s1">&#39;miles&#39;</span><span class="p">],</span>  <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;#555555&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
</span><span id="Analyzer.generate_graphs-1705"><a href="#Analyzer.generate_graphs-1705"><span class="linenos">1705</span></a>                            <span class="n">label</span><span class="o">=</span><span class="n">data_labels</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</span><span id="Analyzer.generate_graphs-1706"><a href="#Analyzer.generate_graphs-1706"><span class="linenos">1706</span></a>                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">val_set</span><span class="p">)):</span>
</span><span id="Analyzer.generate_graphs-1707"><a href="#Analyzer.generate_graphs-1707"><span class="linenos">1707</span></a>                    <span class="c1"># add end bars to the lines</span>
</span><span id="Analyzer.generate_graphs-1708"><a href="#Analyzer.generate_graphs-1708"><span class="linenos">1708</span></a>                    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">min_val</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">max_val</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span><span class="p">]],</span> <span class="p">[</span><span class="n">val_set_miles</span><span class="p">[</span><span class="s1">&#39;miles&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">val_set_miles</span><span class="p">[</span><span class="s1">&#39;miles&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span><span class="p">]],</span> <span class="s1">&#39;k-&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;|&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>   
</span><span id="Analyzer.generate_graphs-1709"><a href="#Analyzer.generate_graphs-1709"><span class="linenos">1709</span></a>
</span><span id="Analyzer.generate_graphs-1710"><a href="#Analyzer.generate_graphs-1710"><span class="linenos">1710</span></a>                <span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;major&#39;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
</span><span id="Analyzer.generate_graphs-1711"><a href="#Analyzer.generate_graphs-1711"><span class="linenos">1711</span></a>                
</span><span id="Analyzer.generate_graphs-1712"><a href="#Analyzer.generate_graphs-1712"><span class="linenos">1712</span></a>                <span class="c1"># add a legend to show the office options</span>
</span><span id="Analyzer.generate_graphs-1713"><a href="#Analyzer.generate_graphs-1713"><span class="linenos">1713</span></a>                <span class="c1"># add a legend entry for the label=&#39;Min/Max Spread&#39;</span>
</span><span id="Analyzer.generate_graphs-1714"><a href="#Analyzer.generate_graphs-1714"><span class="linenos">1714</span></a>                <span class="n">handles</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_legend_handles_labels</span><span class="p">()</span>
</span><span id="Analyzer.generate_graphs-1715"><a href="#Analyzer.generate_graphs-1715"><span class="linenos">1715</span></a>                <span class="n">new_handle</span> <span class="o">=</span> <span class="n">Line2D</span><span class="p">([],</span> <span class="p">[],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Min/Max Spread&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;|&#39;</span><span class="p">)</span>
</span><span id="Analyzer.generate_graphs-1716"><a href="#Analyzer.generate_graphs-1716"><span class="linenos">1716</span></a>                <span class="n">new_label</span> <span class="o">=</span> <span class="s1">&#39;In-Traffic Min/Max Spread for Week (miles)&#39;</span>
</span><span id="Analyzer.generate_graphs-1717"><a href="#Analyzer.generate_graphs-1717"><span class="linenos">1717</span></a>                <span class="n">handles</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_handle</span><span class="p">)</span>
</span><span id="Analyzer.generate_graphs-1718"><a href="#Analyzer.generate_graphs-1718"><span class="linenos">1718</span></a>                <span class="n">labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_label</span><span class="p">)</span>
</span><span id="Analyzer.generate_graphs-1719"><a href="#Analyzer.generate_graphs-1719"><span class="linenos">1719</span></a>            
</span><span id="Analyzer.generate_graphs-1720"><a href="#Analyzer.generate_graphs-1720"><span class="linenos">1720</span></a>                <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">handles</span><span class="o">=</span><span class="n">handles</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="n">labels</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;lower right&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
</span><span id="Analyzer.generate_graphs-1721"><a href="#Analyzer.generate_graphs-1721"><span class="linenos">1721</span></a>                
</span><span id="Analyzer.generate_graphs-1722"><a href="#Analyzer.generate_graphs-1722"><span class="linenos">1722</span></a>                <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">(</span><span class="n">pad</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
</span><span id="Analyzer.generate_graphs-1723"><a href="#Analyzer.generate_graphs-1723"><span class="linenos">1723</span></a>                <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">plots_dir</span><span class="o">+</span><span class="s2">&quot;/&quot;</span><span class="o">+</span><span class="n">key</span><span class="o">+</span><span class="s2">&quot;.png&quot;</span><span class="p">)</span>
</span><span id="Analyzer.generate_graphs-1724"><a href="#Analyzer.generate_graphs-1724"><span class="linenos">1724</span></a>                <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="Analyzer.generate_graphs-1725"><a href="#Analyzer.generate_graphs-1725"><span class="linenos">1725</span></a>            
</span><span id="Analyzer.generate_graphs-1726"><a href="#Analyzer.generate_graphs-1726"><span class="linenos">1726</span></a>
</span><span id="Analyzer.generate_graphs-1727"><a href="#Analyzer.generate_graphs-1727"><span class="linenos">1727</span></a>        <span class="c1">################################################################################</span>
</span><span id="Analyzer.generate_graphs-1728"><a href="#Analyzer.generate_graphs-1728"><span class="linenos">1728</span></a>        <span class="c1">### GRAPH SET: Local Analysis for Office X</span>
</span><span id="Analyzer.generate_graphs-1729"><a href="#Analyzer.generate_graphs-1729"><span class="linenos">1729</span></a>        <span class="c1"># iterate through offices, generate a graph for each office</span>
</span><span id="Analyzer.generate_graphs-1730"><a href="#Analyzer.generate_graphs-1730"><span class="linenos">1730</span></a>        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">offices</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>    
</span><span id="Analyzer.generate_graphs-1731"><a href="#Analyzer.generate_graphs-1731"><span class="linenos">1731</span></a>        <span class="c1">############################################################################################################</span>
</span><span id="Analyzer.generate_graphs-1732"><a href="#Analyzer.generate_graphs-1732"><span class="linenos">1732</span></a>            <span class="c1"># GRAPH:</span>
</span><span id="Analyzer.generate_graphs-1733"><a href="#Analyzer.generate_graphs-1733"><span class="linenos">1733</span></a>            <span class="c1">## Time-Based Commute Cost Analysis</span>
</span><span id="Analyzer.generate_graphs-1734"><a href="#Analyzer.generate_graphs-1734"><span class="linenos">1734</span></a>            <span class="n">key</span> <span class="o">=</span> <span class="s1">&#39;tbcca&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
</span><span id="Analyzer.generate_graphs-1735"><a href="#Analyzer.generate_graphs-1735"><span class="linenos">1735</span></a>            <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;Time-Based Commute Cost Analysis&quot;</span> <span class="o">+</span> <span class="s2">&quot; for </span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;address&quot;</span><span class="p">]</span>
</span><span id="Analyzer.generate_graphs-1736"><a href="#Analyzer.generate_graphs-1736"><span class="linenos">1736</span></a>            <span class="n">short_title</span> <span class="o">=</span> <span class="n">title</span>
</span><span id="Analyzer.generate_graphs-1737"><a href="#Analyzer.generate_graphs-1737"><span class="linenos">1737</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">graph_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="p">{</span><span class="s2">&quot;GRAPH&quot;</span><span class="p">:</span> <span class="n">key</span><span class="p">,</span>
</span><span id="Analyzer.generate_graphs-1738"><a href="#Analyzer.generate_graphs-1738"><span class="linenos">1738</span></a>                                    <span class="s2">&quot;TITLE&quot;</span><span class="p">:</span> <span class="n">short_title</span><span class="p">,</span>
</span><span id="Analyzer.generate_graphs-1739"><a href="#Analyzer.generate_graphs-1739"><span class="linenos">1739</span></a>                                    <span class="s2">&quot;FILENAME&quot;</span><span class="p">:</span> <span class="n">key</span><span class="o">+</span><span class="s2">&quot;.png&quot;</span><span class="p">,</span>
</span><span id="Analyzer.generate_graphs-1740"><a href="#Analyzer.generate_graphs-1740"><span class="linenos">1740</span></a>                                    <span class="s2">&quot;PLOT-DESCRIPTION&quot;</span><span class="p">:</span>  <span class="s2">&quot;This graph shows the average and high/conservative cost of employees commuting to &quot;</span> <span class="o">+</span> \
</span><span id="Analyzer.generate_graphs-1741"><a href="#Analyzer.generate_graphs-1741"><span class="linenos">1741</span></a>                                    <span class="s2">&quot;the office location at &quot;</span> <span class="o">+</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;address&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;. The average cost is based upon the morning average and evening &quot;</span> <span class="o">+</span> \
</span><span id="Analyzer.generate_graphs-1742"><a href="#Analyzer.generate_graphs-1742"><span class="linenos">1742</span></a>                                    <span class="s2">&quot;average commute times, while the high/conservative cost is based upon the highest morning maximum and evening values for &quot;</span> <span class="o">+</span> \
</span><span id="Analyzer.generate_graphs-1743"><a href="#Analyzer.generate_graphs-1743"><span class="linenos">1743</span></a>                                    <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">commute_days_per_week</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; days per week.&quot;</span>
</span><span id="Analyzer.generate_graphs-1744"><a href="#Analyzer.generate_graphs-1744"><span class="linenos">1744</span></a>                                    <span class="p">})</span>
</span><span id="Analyzer.generate_graphs-1745"><a href="#Analyzer.generate_graphs-1745"><span class="linenos">1745</span></a>            
</span><span id="Analyzer.generate_graphs-1746"><a href="#Analyzer.generate_graphs-1746"><span class="linenos">1746</span></a>            <span class="k">if</span> <span class="n">graph</span> <span class="o">==</span> <span class="s2">&quot;_all&quot;</span> <span class="ow">or</span> <span class="n">graph</span> <span class="o">==</span> <span class="n">key</span><span class="p">:</span>
</span><span id="Analyzer.generate_graphs-1747"><a href="#Analyzer.generate_graphs-1747"><span class="linenos">1747</span></a>                <span class="n">office</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">to_frame</span><span class="p">()</span><span class="o">.</span><span class="n">T</span>
</span><span id="Analyzer.generate_graphs-1748"><a href="#Analyzer.generate_graphs-1748"><span class="linenos">1748</span></a>
</span><span id="Analyzer.generate_graphs-1749"><a href="#Analyzer.generate_graphs-1749"><span class="linenos">1749</span></a>                <span class="c1"># get the needed commute values</span>
</span><span id="Analyzer.generate_graphs-1750"><a href="#Analyzer.generate_graphs-1750"><span class="linenos">1750</span></a>                <span class="n">values</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;m_morning_duration_in_traffic&#39;</span><span class="p">,</span><span class="s1">&#39;m_evening_duration_in_traffic&#39;</span><span class="p">,</span>
</span><span id="Analyzer.generate_graphs-1751"><a href="#Analyzer.generate_graphs-1751"><span class="linenos">1751</span></a>                        <span class="s1">&#39;t_morning_duration_in_traffic&#39;</span><span class="p">,</span><span class="s1">&#39;t_evening_duration_in_traffic&#39;</span><span class="p">,</span>
</span><span id="Analyzer.generate_graphs-1752"><a href="#Analyzer.generate_graphs-1752"><span class="linenos">1752</span></a>                        <span class="s1">&#39;w_morning_duration_in_traffic&#39;</span><span class="p">,</span><span class="s1">&#39;w_evening_duration_in_traffic&#39;</span><span class="p">,</span>
</span><span id="Analyzer.generate_graphs-1753"><a href="#Analyzer.generate_graphs-1753"><span class="linenos">1753</span></a>                        <span class="s1">&#39;h_morning_duration_in_traffic&#39;</span><span class="p">,</span><span class="s1">&#39;h_evening_duration_in_traffic&#39;</span><span class="p">,</span>
</span><span id="Analyzer.generate_graphs-1754"><a href="#Analyzer.generate_graphs-1754"><span class="linenos">1754</span></a>                        <span class="s1">&#39;f_morning_duration_in_traffic&#39;</span><span class="p">,</span><span class="s1">&#39;f_evening_duration_in_traffic&#39;</span><span class="p">]</span>
</span><span id="Analyzer.generate_graphs-1755"><a href="#Analyzer.generate_graphs-1755"><span class="linenos">1755</span></a>                
</span><span id="Analyzer.generate_graphs-1756"><a href="#Analyzer.generate_graphs-1756"><span class="linenos">1756</span></a>                <span class="n">mornings</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;m_morning_duration_in_traffic&#39;</span><span class="p">,</span><span class="s1">&#39;t_morning_duration_in_traffic&#39;</span><span class="p">,</span><span class="s1">&#39;w_morning_duration_in_traffic&#39;</span><span class="p">,</span><span class="s1">&#39;h_morning_duration_in_traffic&#39;</span><span class="p">,</span><span class="s1">&#39;f_morning_duration_in_traffic&#39;</span><span class="p">]</span>
</span><span id="Analyzer.generate_graphs-1757"><a href="#Analyzer.generate_graphs-1757"><span class="linenos">1757</span></a>                <span class="n">evenings</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;m_evening_duration_in_traffic&#39;</span><span class="p">,</span><span class="s1">&#39;t_evening_duration_in_traffic&#39;</span><span class="p">,</span><span class="s1">&#39;w_evening_duration_in_traffic&#39;</span><span class="p">,</span><span class="s1">&#39;h_evening_duration_in_traffic&#39;</span><span class="p">,</span><span class="s1">&#39;f_evening_duration_in_traffic&#39;</span><span class="p">]</span>
</span><span id="Analyzer.generate_graphs-1758"><a href="#Analyzer.generate_graphs-1758"><span class="linenos">1758</span></a>                <span class="n">cdpw</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">commute_days_per_week</span>
</span><span id="Analyzer.generate_graphs-1759"><a href="#Analyzer.generate_graphs-1759"><span class="linenos">1759</span></a>
</span><span id="Analyzer.generate_graphs-1760"><a href="#Analyzer.generate_graphs-1760"><span class="linenos">1760</span></a>                <span class="n">emp_within</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graphing</span><span class="o">.</span><span class="n">filter_drive_distance</span><span class="p">(</span><span class="n">emp</span><span class="p">,</span><span class="n">office</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">commute_range_cut_off</span><span class="p">,</span> <span class="n">commute_data</span><span class="o">=</span><span class="n">commute_data</span><span class="p">)</span>
</span><span id="Analyzer.generate_graphs-1761"><a href="#Analyzer.generate_graphs-1761"><span class="linenos">1761</span></a>                <span class="n">val_set</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graphing</span><span class="o">.</span><span class="n">get_commute_values</span><span class="p">(</span><span class="n">emp_within</span><span class="p">,</span> <span class="n">office</span><span class="p">,</span> <span class="n">commute_data</span><span class="p">,</span> <span class="n">values</span><span class="p">)</span>
</span><span id="Analyzer.generate_graphs-1762"><a href="#Analyzer.generate_graphs-1762"><span class="linenos">1762</span></a>                
</span><span id="Analyzer.generate_graphs-1763"><a href="#Analyzer.generate_graphs-1763"><span class="linenos">1763</span></a>                
</span><span id="Analyzer.generate_graphs-1764"><a href="#Analyzer.generate_graphs-1764"><span class="linenos">1764</span></a>
</span><span id="Analyzer.generate_graphs-1765"><a href="#Analyzer.generate_graphs-1765"><span class="linenos">1765</span></a>                <span class="c1"># Calculate and insert the average morning and evening commute times directly into val_set</span>
</span><span id="Analyzer.generate_graphs-1766"><a href="#Analyzer.generate_graphs-1766"><span class="linenos">1766</span></a>                <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;Morning Average&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">val_set</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">mornings</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="Analyzer.generate_graphs-1767"><a href="#Analyzer.generate_graphs-1767"><span class="linenos">1767</span></a>                <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;Evening Average&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">val_set</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">evenings</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="Analyzer.generate_graphs-1768"><a href="#Analyzer.generate_graphs-1768"><span class="linenos">1768</span></a>
</span><span id="Analyzer.generate_graphs-1769"><a href="#Analyzer.generate_graphs-1769"><span class="linenos">1769</span></a>                <span class="c1"># Calculate and insert the top &#39;cdpw&#39; maximum morning and evening commute times</span>
</span><span id="Analyzer.generate_graphs-1770"><a href="#Analyzer.generate_graphs-1770"><span class="linenos">1770</span></a>                <span class="c1"># Note: Adjust the code below to calculate the averages of the top &#39;cdpw&#39; as new columns directly</span>
</span><span id="Analyzer.generate_graphs-1771"><a href="#Analyzer.generate_graphs-1771"><span class="linenos">1771</span></a>                <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;Average Top CDPW Morning&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">val_set</span><span class="p">[</span><span class="n">mornings</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="n">row</span><span class="o">.</span><span class="n">nlargest</span><span class="p">(</span><span class="n">cdpw</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="Analyzer.generate_graphs-1772"><a href="#Analyzer.generate_graphs-1772"><span class="linenos">1772</span></a>                <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;Average Top CDPW Evening&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">val_set</span><span class="p">[</span><span class="n">evenings</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="n">row</span><span class="o">.</span><span class="n">nlargest</span><span class="p">(</span><span class="n">cdpw</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="Analyzer.generate_graphs-1773"><a href="#Analyzer.generate_graphs-1773"><span class="linenos">1773</span></a>
</span><span id="Analyzer.generate_graphs-1774"><a href="#Analyzer.generate_graphs-1774"><span class="linenos">1774</span></a>                <span class="c1"># Calculate a per-minute cost based on &quot;median_salary&quot; and &quot;hours_per_year&quot;</span>
</span><span id="Analyzer.generate_graphs-1775"><a href="#Analyzer.generate_graphs-1775"><span class="linenos">1775</span></a>                <span class="n">per_minute_cost</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">median_salary</span> <span class="o">/</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">hours_per_year</span> <span class="o">*</span> <span class="mi">60</span><span class="p">)</span>
</span><span id="Analyzer.generate_graphs-1776"><a href="#Analyzer.generate_graphs-1776"><span class="linenos">1776</span></a>
</span><span id="Analyzer.generate_graphs-1777"><a href="#Analyzer.generate_graphs-1777"><span class="linenos">1777</span></a>                <span class="c1"># Calculate and insert the average cost for the week directly into val_set</span>
</span><span id="Analyzer.generate_graphs-1778"><a href="#Analyzer.generate_graphs-1778"><span class="linenos">1778</span></a>                <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;Morning Average Cost&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;Morning Average&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">per_minute_cost</span>
</span><span id="Analyzer.generate_graphs-1779"><a href="#Analyzer.generate_graphs-1779"><span class="linenos">1779</span></a>                <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;Evening Average Cost&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;Evening Average&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">per_minute_cost</span>
</span><span id="Analyzer.generate_graphs-1780"><a href="#Analyzer.generate_graphs-1780"><span class="linenos">1780</span></a>
</span><span id="Analyzer.generate_graphs-1781"><a href="#Analyzer.generate_graphs-1781"><span class="linenos">1781</span></a>                <span class="c1"># Calculate and insert the high/conservative cost for the week directly into val_set</span>
</span><span id="Analyzer.generate_graphs-1782"><a href="#Analyzer.generate_graphs-1782"><span class="linenos">1782</span></a>                <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;Morning High Cost&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;Average Top CDPW Morning&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">per_minute_cost</span>
</span><span id="Analyzer.generate_graphs-1783"><a href="#Analyzer.generate_graphs-1783"><span class="linenos">1783</span></a>                <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;Evening High Cost&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;Average Top CDPW Evening&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">per_minute_cost</span>
</span><span id="Analyzer.generate_graphs-1784"><a href="#Analyzer.generate_graphs-1784"><span class="linenos">1784</span></a>
</span><span id="Analyzer.generate_graphs-1785"><a href="#Analyzer.generate_graphs-1785"><span class="linenos">1785</span></a>                <span class="c1"># create bins based on the max value of the data</span>
</span><span id="Analyzer.generate_graphs-1786"><a href="#Analyzer.generate_graphs-1786"><span class="linenos">1786</span></a>                <span class="n">binmax</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Analyzer.generate_graphs-1787"><a href="#Analyzer.generate_graphs-1787"><span class="linenos">1787</span></a>                <span class="k">for</span> <span class="n">each</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;Morning Average Cost&#39;</span><span class="p">,</span><span class="s1">&#39;Evening Average Cost&#39;</span><span class="p">,</span><span class="s1">&#39;Morning High Cost&#39;</span><span class="p">,</span><span class="s1">&#39;Evening High Cost&#39;</span><span class="p">]:</span>
</span><span id="Analyzer.generate_graphs-1788"><a href="#Analyzer.generate_graphs-1788"><span class="linenos">1788</span></a>                    <span class="k">if</span> <span class="nb">max</span><span class="p">(</span><span class="n">val_set</span><span class="p">[</span><span class="n">each</span><span class="p">])</span> <span class="o">&gt;</span> <span class="n">binmax</span><span class="p">:</span>
</span><span id="Analyzer.generate_graphs-1789"><a href="#Analyzer.generate_graphs-1789"><span class="linenos">1789</span></a>                        <span class="n">binmax</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">val_set</span><span class="p">[</span><span class="n">each</span><span class="p">])</span>
</span><span id="Analyzer.generate_graphs-1790"><a href="#Analyzer.generate_graphs-1790"><span class="linenos">1790</span></a>                <span class="n">step</span> <span class="o">=</span> <span class="mi">5</span>
</span><span id="Analyzer.generate_graphs-1791"><a href="#Analyzer.generate_graphs-1791"><span class="linenos">1791</span></a>                <span class="c1"># round the binmax up to the nearest step</span>
</span><span id="Analyzer.generate_graphs-1792"><a href="#Analyzer.generate_graphs-1792"><span class="linenos">1792</span></a>                <span class="n">bins</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">binmax</span> <span class="o">+</span> <span class="n">step</span> <span class="o">-</span> <span class="p">(</span><span class="n">binmax</span> <span class="o">%</span> <span class="n">step</span><span class="p">)),</span> <span class="n">step</span><span class="p">)</span>
</span><span id="Analyzer.generate_graphs-1793"><a href="#Analyzer.generate_graphs-1793"><span class="linenos">1793</span></a>                
</span><span id="Analyzer.generate_graphs-1794"><a href="#Analyzer.generate_graphs-1794"><span class="linenos">1794</span></a>                <span class="n">font_mod</span> <span class="o">=</span> <span class="mf">1.5</span>
</span><span id="Analyzer.generate_graphs-1795"><a href="#Analyzer.generate_graphs-1795"><span class="linenos">1795</span></a>                <span class="c1"># create histograms for the morning and evening average costs</span>
</span><span id="Analyzer.generate_graphs-1796"><a href="#Analyzer.generate_graphs-1796"><span class="linenos">1796</span></a>                <span class="n">plt</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graphing</span><span class="o">.</span><span class="n">get_histogram</span><span class="p">(</span><span class="n">emp</span><span class="p">,</span> <span class="n">office</span><span class="p">,</span> <span class="n">commute_data</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;m_morning_duration_in_traffic&#39;</span><span class="p">,</span><span class="s1">&#39;m_evening_duration_in_traffic&#39;</span><span class="p">],</span> 
</span><span id="Analyzer.generate_graphs-1797"><a href="#Analyzer.generate_graphs-1797"><span class="linenos">1797</span></a>                                                      <span class="n">suptitle</span><span class="o">=</span><span class="s2">&quot;Average and Maximum Time-in-Traffic Costs for </span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;address&#39;</span><span class="p">]),</span> 
</span><span id="Analyzer.generate_graphs-1798"><a href="#Analyzer.generate_graphs-1798"><span class="linenos">1798</span></a>                                                      <span class="n">cutoff_radius</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">commute_range_cut_off</span><span class="p">,</span>
</span><span id="Analyzer.generate_graphs-1799"><a href="#Analyzer.generate_graphs-1799"><span class="linenos">1799</span></a>                                      <span class="n">x_label</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="s1">&#39;\$ (USD) based on median salary (converted to per minute)&#39;</span><span class="p">),</span> <span class="n">y_label</span><span class="o">=</span><span class="s1">&#39;# Employees&#39;</span><span class="p">,</span>
</span><span id="Analyzer.generate_graphs-1800"><a href="#Analyzer.generate_graphs-1800"><span class="linenos">1800</span></a>                                      <span class="n">bins</span><span class="o">=</span><span class="n">bins</span><span class="p">,</span> <span class="n">rows</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">cols</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">column_titles</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Average&quot;</span><span class="p">,</span><span class="s2">&quot;High/Conservative&quot;</span><span class="p">],</span> 
</span><span id="Analyzer.generate_graphs-1801"><a href="#Analyzer.generate_graphs-1801"><span class="linenos">1801</span></a>                                      <span class="n">cumulative_line</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">font_mod</span><span class="o">=</span><span class="n">font_mod</span><span class="p">,</span> <span class="n">manual_plot</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">sharey</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="Analyzer.generate_graphs-1802"><a href="#Analyzer.generate_graphs-1802"><span class="linenos">1802</span></a>                <span class="n">plot_vals</span> <span class="o">=</span> <span class="p">[[</span><span class="s1">&#39;Morning Average Cost&#39;</span><span class="p">,</span><span class="s2">&quot;Morning High Cost&quot;</span><span class="p">],[</span><span class="s2">&quot;Evening Average Cost&quot;</span><span class="p">,</span><span class="s2">&quot;Evening High Cost&quot;</span><span class="p">]]</span>
</span><span id="Analyzer.generate_graphs-1803"><a href="#Analyzer.generate_graphs-1803"><span class="linenos">1803</span></a>                <span class="c1"># manually add histograms for each office option</span>
</span><span id="Analyzer.generate_graphs-1804"><a href="#Analyzer.generate_graphs-1804"><span class="linenos">1804</span></a>                <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
</span><span id="Analyzer.generate_graphs-1805"><a href="#Analyzer.generate_graphs-1805"><span class="linenos">1805</span></a>                    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
</span><span id="Analyzer.generate_graphs-1806"><a href="#Analyzer.generate_graphs-1806"><span class="linenos">1806</span></a>                        <span class="n">ax</span><span class="p">[</span><span class="n">r</span><span class="p">,</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">val_set</span><span class="p">[</span><span class="n">plot_vals</span><span class="p">[</span><span class="n">r</span><span class="p">][</span><span class="n">c</span><span class="p">]],</span> <span class="n">bins</span><span class="o">=</span><span class="n">bins</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;#555555&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">align</span><span class="o">=</span><span class="s1">&#39;mid&#39;</span><span class="p">,</span> 
</span><span id="Analyzer.generate_graphs-1807"><a href="#Analyzer.generate_graphs-1807"><span class="linenos">1807</span></a>                                <span class="n">rwidth</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">plot_vals</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">(</span><span class="n">r</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>
</span><span id="Analyzer.generate_graphs-1808"><a href="#Analyzer.generate_graphs-1808"><span class="linenos">1808</span></a>                        <span class="n">ax</span><span class="p">[</span><span class="n">r</span><span class="p">,</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;major&#39;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
</span><span id="Analyzer.generate_graphs-1809"><a href="#Analyzer.generate_graphs-1809"><span class="linenos">1809</span></a>
</span><span id="Analyzer.generate_graphs-1810"><a href="#Analyzer.generate_graphs-1810"><span class="linenos">1810</span></a>                        <span class="c1"># add a text box in the upper right corner with the stats</span>
</span><span id="Analyzer.generate_graphs-1811"><a href="#Analyzer.generate_graphs-1811"><span class="linenos">1811</span></a>                        <span class="n">t</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;me&#39;</span> <span class="p">:</span> <span class="s1">&#39;Median: |$</span><span class="si">{:,.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">val_set</span><span class="p">[</span><span class="n">plot_vals</span><span class="p">[</span><span class="n">r</span><span class="p">][</span><span class="n">c</span><span class="p">]])),</span>
</span><span id="Analyzer.generate_graphs-1812"><a href="#Analyzer.generate_graphs-1812"><span class="linenos">1812</span></a>                            <span class="s1">&#39;av&#39;</span> <span class="p">:</span> <span class="s1">&#39;Average: |$</span><span class="si">{:,.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">val_set</span><span class="p">[</span><span class="n">plot_vals</span><span class="p">[</span><span class="n">r</span><span class="p">][</span><span class="n">c</span><span class="p">]])),</span>
</span><span id="Analyzer.generate_graphs-1813"><a href="#Analyzer.generate_graphs-1813"><span class="linenos">1813</span></a>                            <span class="s1">&#39;mi&#39;</span> <span class="p">:</span> <span class="s1">&#39;Min: |$</span><span class="si">{:,.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">val_set</span><span class="p">[</span><span class="n">plot_vals</span><span class="p">[</span><span class="n">r</span><span class="p">][</span><span class="n">c</span><span class="p">]])),</span>
</span><span id="Analyzer.generate_graphs-1814"><a href="#Analyzer.generate_graphs-1814"><span class="linenos">1814</span></a>                            <span class="s1">&#39;ma&#39;</span> <span class="p">:</span> <span class="s1">&#39;Max: |$</span><span class="si">{:,.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">val_set</span><span class="p">[</span><span class="n">plot_vals</span><span class="p">[</span><span class="n">r</span><span class="p">][</span><span class="n">c</span><span class="p">]])),</span>
</span><span id="Analyzer.generate_graphs-1815"><a href="#Analyzer.generate_graphs-1815"><span class="linenos">1815</span></a>                            <span class="s1">&#39;to&#39;</span> <span class="p">:</span> <span class="s1">&#39;Total: |$</span><span class="si">{:,.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">val_set</span><span class="p">[</span><span class="n">plot_vals</span><span class="p">[</span><span class="n">r</span><span class="p">][</span><span class="n">c</span><span class="p">]]))</span>
</span><span id="Analyzer.generate_graphs-1816"><a href="#Analyzer.generate_graphs-1816"><span class="linenos">1816</span></a>                            <span class="p">}</span>
</span><span id="Analyzer.generate_graphs-1817"><a href="#Analyzer.generate_graphs-1817"><span class="linenos">1817</span></a>                        <span class="c1"># get the longest string value</span>
</span><span id="Analyzer.generate_graphs-1818"><a href="#Analyzer.generate_graphs-1818"><span class="linenos">1818</span></a>                        <span class="n">max_len</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="s1">&#39;me&#39;</span><span class="p">]),</span><span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="s1">&#39;av&#39;</span><span class="p">]),</span><span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="s1">&#39;to&#39;</span><span class="p">]),</span><span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="s1">&#39;mi&#39;</span><span class="p">]),</span><span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="s1">&#39;ma&#39;</span><span class="p">]))</span>
</span><span id="Analyzer.generate_graphs-1819"><a href="#Analyzer.generate_graphs-1819"><span class="linenos">1819</span></a>                        <span class="c1"># calculate additional space</span>
</span><span id="Analyzer.generate_graphs-1820"><a href="#Analyzer.generate_graphs-1820"><span class="linenos">1820</span></a>                        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">t</span><span class="p">:</span>
</span><span id="Analyzer.generate_graphs-1821"><a href="#Analyzer.generate_graphs-1821"><span class="linenos">1821</span></a>                            <span class="n">t</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">t</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">,</span><span class="s2">&quot; &quot;</span><span class="o">*</span><span class="p">(</span><span class="n">max_len</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="n">k</span><span class="p">])))</span>
</span><span id="Analyzer.generate_graphs-1822"><a href="#Analyzer.generate_graphs-1822"><span class="linenos">1822</span></a>                        <span class="c1"># add spaces to make all the same length, replacing |</span>
</span><span id="Analyzer.generate_graphs-1823"><a href="#Analyzer.generate_graphs-1823"><span class="linenos">1823</span></a>                        <span class="n">textstr</span> <span class="o">=</span> <span class="s2">&quot;Commute Time Cost: &quot;</span>
</span><span id="Analyzer.generate_graphs-1824"><a href="#Analyzer.generate_graphs-1824"><span class="linenos">1824</span></a>                        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">t</span><span class="p">:</span>
</span><span id="Analyzer.generate_graphs-1825"><a href="#Analyzer.generate_graphs-1825"><span class="linenos">1825</span></a>                            <span class="n">textstr</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">t</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
</span><span id="Analyzer.generate_graphs-1826"><a href="#Analyzer.generate_graphs-1826"><span class="linenos">1826</span></a>                        <span class="c1"># these are matplotlib.patch.Patch properties</span>
</span><span id="Analyzer.generate_graphs-1827"><a href="#Analyzer.generate_graphs-1827"><span class="linenos">1827</span></a>                        <span class="n">props</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">boxstyle</span><span class="o">=</span><span class="s1">&#39;round&#39;</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;wheat&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
</span><span id="Analyzer.generate_graphs-1828"><a href="#Analyzer.generate_graphs-1828"><span class="linenos">1828</span></a>                        <span class="c1"># place a text box in upper right in axes coords,</span>
</span><span id="Analyzer.generate_graphs-1829"><a href="#Analyzer.generate_graphs-1829"><span class="linenos">1829</span></a>                        <span class="n">ax</span><span class="p">[</span><span class="n">r</span><span class="p">,</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">.95</span><span class="p">,</span> <span class="mf">.75</span><span class="p">,</span> <span class="n">textstr</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="n">r</span><span class="p">,</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">,</span>
</span><span id="Analyzer.generate_graphs-1830"><a href="#Analyzer.generate_graphs-1830"><span class="linenos">1830</span></a>                                    <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">bbox</span><span class="o">=</span><span class="n">props</span><span class="p">,</span> <span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;family&#39;</span><span class="p">:</span> <span class="s1">&#39;monospace&#39;</span><span class="p">},</span> <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">)</span>
</span><span id="Analyzer.generate_graphs-1831"><a href="#Analyzer.generate_graphs-1831"><span class="linenos">1831</span></a>                        
</span><span id="Analyzer.generate_graphs-1832"><a href="#Analyzer.generate_graphs-1832"><span class="linenos">1832</span></a>
</span><span id="Analyzer.generate_graphs-1833"><a href="#Analyzer.generate_graphs-1833"><span class="linenos">1833</span></a>                        <span class="c1"># for the first column, add morning/evening text box the top left of the plot</span>
</span><span id="Analyzer.generate_graphs-1834"><a href="#Analyzer.generate_graphs-1834"><span class="linenos">1834</span></a>                        <span class="k">if</span> <span class="n">r</span><span class="o">==</span><span class="mi">0</span> <span class="ow">and</span> <span class="n">c</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Analyzer.generate_graphs-1835"><a href="#Analyzer.generate_graphs-1835"><span class="linenos">1835</span></a>                            <span class="n">ax</span><span class="p">[</span><span class="n">r</span><span class="p">,</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.85</span><span class="p">,</span> <span class="s1">&#39;Morning&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="o">*</span><span class="n">font_mod</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="n">r</span><span class="p">,</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;top&#39;</span><span class="p">)</span>
</span><span id="Analyzer.generate_graphs-1836"><a href="#Analyzer.generate_graphs-1836"><span class="linenos">1836</span></a>                        <span class="k">if</span> <span class="n">r</span><span class="o">==</span><span class="mi">1</span> <span class="ow">and</span> <span class="n">c</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Analyzer.generate_graphs-1837"><a href="#Analyzer.generate_graphs-1837"><span class="linenos">1837</span></a>                            <span class="n">ax</span><span class="p">[</span><span class="n">r</span><span class="p">,</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.85</span><span class="p">,</span> <span class="s1">&#39;Evening&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="o">*</span><span class="n">font_mod</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="n">r</span><span class="p">,</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;top&#39;</span><span class="p">)</span>
</span><span id="Analyzer.generate_graphs-1838"><a href="#Analyzer.generate_graphs-1838"><span class="linenos">1838</span></a>                            <span class="c1"># set a y axis label for the first column</span>
</span><span id="Analyzer.generate_graphs-1839"><a href="#Analyzer.generate_graphs-1839"><span class="linenos">1839</span></a>                            <span class="n">ax</span><span class="p">[</span><span class="n">r</span><span class="p">,</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;# Employees&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="o">*</span><span class="n">font_mod</span><span class="p">)</span>
</span><span id="Analyzer.generate_graphs-1840"><a href="#Analyzer.generate_graphs-1840"><span class="linenos">1840</span></a>                        <span class="k">if</span> <span class="n">r</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
</span><span id="Analyzer.generate_graphs-1841"><a href="#Analyzer.generate_graphs-1841"><span class="linenos">1841</span></a>                            <span class="n">ax</span><span class="p">[</span><span class="n">r</span><span class="p">,</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Employee Time Cost ($ USD)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="o">*</span><span class="n">font_mod</span><span class="p">)</span>
</span><span id="Analyzer.generate_graphs-1842"><a href="#Analyzer.generate_graphs-1842"><span class="linenos">1842</span></a>
</span><span id="Analyzer.generate_graphs-1843"><a href="#Analyzer.generate_graphs-1843"><span class="linenos">1843</span></a>                <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">(</span><span class="n">pad</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
</span><span id="Analyzer.generate_graphs-1844"><a href="#Analyzer.generate_graphs-1844"><span class="linenos">1844</span></a>                <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">plots_dir</span><span class="o">+</span><span class="s2">&quot;/&quot;</span><span class="o">+</span><span class="n">key</span><span class="o">+</span><span class="s2">&quot;.png&quot;</span><span class="p">)</span>
</span><span id="Analyzer.generate_graphs-1845"><a href="#Analyzer.generate_graphs-1845"><span class="linenos">1845</span></a>                <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>  
</span><span id="Analyzer.generate_graphs-1846"><a href="#Analyzer.generate_graphs-1846"><span class="linenos">1846</span></a>
</span><span id="Analyzer.generate_graphs-1847"><a href="#Analyzer.generate_graphs-1847"><span class="linenos">1847</span></a>
</span><span id="Analyzer.generate_graphs-1848"><a href="#Analyzer.generate_graphs-1848"><span class="linenos">1848</span></a>        <span class="c1">############################################################################################################</span>
</span><span id="Analyzer.generate_graphs-1849"><a href="#Analyzer.generate_graphs-1849"><span class="linenos">1849</span></a>        <span class="c1"># GRAPH:</span>
</span><span id="Analyzer.generate_graphs-1850"><a href="#Analyzer.generate_graphs-1850"><span class="linenos">1850</span></a>        <span class="c1">## Total Commute Cost Analysis</span>
</span><span id="Analyzer.generate_graphs-1851"><a href="#Analyzer.generate_graphs-1851"><span class="linenos">1851</span></a>        <span class="n">key</span> <span class="o">=</span> <span class="s1">&#39;tcca&#39;</span>
</span><span id="Analyzer.generate_graphs-1852"><a href="#Analyzer.generate_graphs-1852"><span class="linenos">1852</span></a>        <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;Total Commute Cost Analysis&quot;</span>
</span><span id="Analyzer.generate_graphs-1853"><a href="#Analyzer.generate_graphs-1853"><span class="linenos">1853</span></a>        <span class="n">short_title</span> <span class="o">=</span> <span class="n">title</span>
</span><span id="Analyzer.generate_graphs-1854"><a href="#Analyzer.generate_graphs-1854"><span class="linenos">1854</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">graph_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="p">{</span><span class="s2">&quot;GRAPH&quot;</span><span class="p">:</span> <span class="n">key</span><span class="p">,</span>
</span><span id="Analyzer.generate_graphs-1855"><a href="#Analyzer.generate_graphs-1855"><span class="linenos">1855</span></a>                                <span class="s2">&quot;TITLE&quot;</span><span class="p">:</span> <span class="n">short_title</span><span class="p">,</span>
</span><span id="Analyzer.generate_graphs-1856"><a href="#Analyzer.generate_graphs-1856"><span class="linenos">1856</span></a>                                <span class="s2">&quot;FILENAME&quot;</span><span class="p">:</span> <span class="n">key</span><span class="o">+</span><span class="s2">&quot;.png&quot;</span><span class="p">,</span>
</span><span id="Analyzer.generate_graphs-1857"><a href="#Analyzer.generate_graphs-1857"><span class="linenos">1857</span></a>                                <span class="s2">&quot;PLOT-DESCRIPTION&quot;</span><span class="p">:</span>  <span class="s2">&quot;This graph shows the total commute cost incurred by employees based upon mileage &quot;</span> <span class="o">+</span> \
</span><span id="Analyzer.generate_graphs-1858"><a href="#Analyzer.generate_graphs-1858"><span class="linenos">1858</span></a>                                <span class="s2">&quot; and the average and high/conservative cost of employee time commuting to each office.&quot;</span> <span class="o">+</span> \
</span><span id="Analyzer.generate_graphs-1859"><a href="#Analyzer.generate_graphs-1859"><span class="linenos">1859</span></a>                                <span class="s2">&quot;The average cost is based upon the morning average and evening &quot;</span> <span class="o">+</span> \
</span><span id="Analyzer.generate_graphs-1860"><a href="#Analyzer.generate_graphs-1860"><span class="linenos">1860</span></a>                                <span class="s2">&quot;average commute times, while the high/conservative cost is based upon the highest morning maximum and evening values for &quot;</span> <span class="o">+</span> \
</span><span id="Analyzer.generate_graphs-1861"><a href="#Analyzer.generate_graphs-1861"><span class="linenos">1861</span></a>                                <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">commute_days_per_week</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; days per week.&quot;</span>
</span><span id="Analyzer.generate_graphs-1862"><a href="#Analyzer.generate_graphs-1862"><span class="linenos">1862</span></a>                                <span class="p">})</span>
</span><span id="Analyzer.generate_graphs-1863"><a href="#Analyzer.generate_graphs-1863"><span class="linenos">1863</span></a>        <span class="k">if</span> <span class="n">graph</span> <span class="o">==</span> <span class="s2">&quot;_all&quot;</span> <span class="ow">or</span> <span class="n">graph</span> <span class="o">==</span> <span class="n">key</span><span class="p">:</span>
</span><span id="Analyzer.generate_graphs-1864"><a href="#Analyzer.generate_graphs-1864"><span class="linenos">1864</span></a>            <span class="n">employee_costs_to_office</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="Analyzer.generate_graphs-1865"><a href="#Analyzer.generate_graphs-1865"><span class="linenos">1865</span></a>
</span><span id="Analyzer.generate_graphs-1866"><a href="#Analyzer.generate_graphs-1866"><span class="linenos">1866</span></a>            <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">offices</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>    
</span><span id="Analyzer.generate_graphs-1867"><a href="#Analyzer.generate_graphs-1867"><span class="linenos">1867</span></a>                <span class="n">office</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">to_frame</span><span class="p">()</span><span class="o">.</span><span class="n">T</span>
</span><span id="Analyzer.generate_graphs-1868"><a href="#Analyzer.generate_graphs-1868"><span class="linenos">1868</span></a>            
</span><span id="Analyzer.generate_graphs-1869"><a href="#Analyzer.generate_graphs-1869"><span class="linenos">1869</span></a>                <span class="c1"># get the needed commute values</span>
</span><span id="Analyzer.generate_graphs-1870"><a href="#Analyzer.generate_graphs-1870"><span class="linenos">1870</span></a>                <span class="n">values</span> <span class="o">=</span> <span class="n">commute_data</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span>
</span><span id="Analyzer.generate_graphs-1871"><a href="#Analyzer.generate_graphs-1871"><span class="linenos">1871</span></a>                
</span><span id="Analyzer.generate_graphs-1872"><a href="#Analyzer.generate_graphs-1872"><span class="linenos">1872</span></a>                <span class="n">mornings</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;m_morning_duration_in_traffic&#39;</span><span class="p">,</span><span class="s1">&#39;t_morning_duration_in_traffic&#39;</span><span class="p">,</span><span class="s1">&#39;w_morning_duration_in_traffic&#39;</span><span class="p">,</span><span class="s1">&#39;h_morning_duration_in_traffic&#39;</span><span class="p">,</span><span class="s1">&#39;f_morning_duration_in_traffic&#39;</span><span class="p">]</span>
</span><span id="Analyzer.generate_graphs-1873"><a href="#Analyzer.generate_graphs-1873"><span class="linenos">1873</span></a>                <span class="n">evenings</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;m_evening_duration_in_traffic&#39;</span><span class="p">,</span><span class="s1">&#39;t_evening_duration_in_traffic&#39;</span><span class="p">,</span><span class="s1">&#39;w_evening_duration_in_traffic&#39;</span><span class="p">,</span><span class="s1">&#39;h_evening_duration_in_traffic&#39;</span><span class="p">,</span><span class="s1">&#39;f_evening_duration_in_traffic&#39;</span><span class="p">]</span>
</span><span id="Analyzer.generate_graphs-1874"><a href="#Analyzer.generate_graphs-1874"><span class="linenos">1874</span></a>                
</span><span id="Analyzer.generate_graphs-1875"><a href="#Analyzer.generate_graphs-1875"><span class="linenos">1875</span></a>                <span class="n">cdpw</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">commute_days_per_week</span>
</span><span id="Analyzer.generate_graphs-1876"><a href="#Analyzer.generate_graphs-1876"><span class="linenos">1876</span></a>
</span><span id="Analyzer.generate_graphs-1877"><a href="#Analyzer.generate_graphs-1877"><span class="linenos">1877</span></a>                <span class="n">emp_within</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graphing</span><span class="o">.</span><span class="n">filter_drive_distance</span><span class="p">(</span><span class="n">emp</span><span class="p">,</span><span class="n">office</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">commute_range_cut_off</span><span class="p">,</span> <span class="n">commute_data</span><span class="o">=</span><span class="n">commute_data</span><span class="p">)</span>
</span><span id="Analyzer.generate_graphs-1878"><a href="#Analyzer.generate_graphs-1878"><span class="linenos">1878</span></a>                <span class="n">val_set</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graphing</span><span class="o">.</span><span class="n">get_commute_values</span><span class="p">(</span><span class="n">emp_within</span><span class="p">,</span> <span class="n">office</span><span class="p">,</span> <span class="n">commute_data</span><span class="p">,</span> <span class="n">values</span><span class="p">)</span>
</span><span id="Analyzer.generate_graphs-1879"><a href="#Analyzer.generate_graphs-1879"><span class="linenos">1879</span></a>                
</span><span id="Analyzer.generate_graphs-1880"><a href="#Analyzer.generate_graphs-1880"><span class="linenos">1880</span></a>                
</span><span id="Analyzer.generate_graphs-1881"><a href="#Analyzer.generate_graphs-1881"><span class="linenos">1881</span></a>
</span><span id="Analyzer.generate_graphs-1882"><a href="#Analyzer.generate_graphs-1882"><span class="linenos">1882</span></a>                <span class="c1"># Calculate and insert the average morning and evening commute times directly into val_set</span>
</span><span id="Analyzer.generate_graphs-1883"><a href="#Analyzer.generate_graphs-1883"><span class="linenos">1883</span></a>                <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;Morning Average&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">val_set</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">mornings</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="Analyzer.generate_graphs-1884"><a href="#Analyzer.generate_graphs-1884"><span class="linenos">1884</span></a>                <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;Evening Average&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">val_set</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">evenings</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="Analyzer.generate_graphs-1885"><a href="#Analyzer.generate_graphs-1885"><span class="linenos">1885</span></a>
</span><span id="Analyzer.generate_graphs-1886"><a href="#Analyzer.generate_graphs-1886"><span class="linenos">1886</span></a>                <span class="c1"># Calculate and insert the top &#39;cdpw&#39; maximum morning and evening commute times</span>
</span><span id="Analyzer.generate_graphs-1887"><a href="#Analyzer.generate_graphs-1887"><span class="linenos">1887</span></a>                <span class="c1"># Note: Adjust the code below to calculate the averages of the top &#39;cdpw&#39; as new columns directly</span>
</span><span id="Analyzer.generate_graphs-1888"><a href="#Analyzer.generate_graphs-1888"><span class="linenos">1888</span></a>                <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;Average Top CDPW Morning&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">val_set</span><span class="p">[</span><span class="n">mornings</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="n">row</span><span class="o">.</span><span class="n">nlargest</span><span class="p">(</span><span class="n">cdpw</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="Analyzer.generate_graphs-1889"><a href="#Analyzer.generate_graphs-1889"><span class="linenos">1889</span></a>                <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;Average Top CDPW Evening&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">val_set</span><span class="p">[</span><span class="n">evenings</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="n">row</span><span class="o">.</span><span class="n">nlargest</span><span class="p">(</span><span class="n">cdpw</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="Analyzer.generate_graphs-1890"><a href="#Analyzer.generate_graphs-1890"><span class="linenos">1890</span></a>
</span><span id="Analyzer.generate_graphs-1891"><a href="#Analyzer.generate_graphs-1891"><span class="linenos">1891</span></a>                <span class="c1"># Calculate a per-minute cost based on &quot;median_salary&quot; and &quot;hours_per_year&quot;</span>
</span><span id="Analyzer.generate_graphs-1892"><a href="#Analyzer.generate_graphs-1892"><span class="linenos">1892</span></a>                <span class="n">per_minute_cost</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">median_salary</span> <span class="o">/</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">hours_per_year</span> <span class="o">*</span> <span class="mi">60</span><span class="p">)</span>
</span><span id="Analyzer.generate_graphs-1893"><a href="#Analyzer.generate_graphs-1893"><span class="linenos">1893</span></a>
</span><span id="Analyzer.generate_graphs-1894"><a href="#Analyzer.generate_graphs-1894"><span class="linenos">1894</span></a>                <span class="c1"># Calculate and insert the average cost for the week directly into val_set</span>
</span><span id="Analyzer.generate_graphs-1895"><a href="#Analyzer.generate_graphs-1895"><span class="linenos">1895</span></a>                <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;Morning Average Cost&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;Morning Average&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">per_minute_cost</span>
</span><span id="Analyzer.generate_graphs-1896"><a href="#Analyzer.generate_graphs-1896"><span class="linenos">1896</span></a>                <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;Evening Average Cost&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;Evening Average&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">per_minute_cost</span>
</span><span id="Analyzer.generate_graphs-1897"><a href="#Analyzer.generate_graphs-1897"><span class="linenos">1897</span></a>
</span><span id="Analyzer.generate_graphs-1898"><a href="#Analyzer.generate_graphs-1898"><span class="linenos">1898</span></a>                <span class="c1"># Calculate and insert the high/conservative cost for the week directly into val_set</span>
</span><span id="Analyzer.generate_graphs-1899"><a href="#Analyzer.generate_graphs-1899"><span class="linenos">1899</span></a>                <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;Morning High Cost&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;Average Top CDPW Morning&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">per_minute_cost</span>
</span><span id="Analyzer.generate_graphs-1900"><a href="#Analyzer.generate_graphs-1900"><span class="linenos">1900</span></a>                <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;Evening High Cost&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;Average Top CDPW Evening&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">per_minute_cost</span>
</span><span id="Analyzer.generate_graphs-1901"><a href="#Analyzer.generate_graphs-1901"><span class="linenos">1901</span></a>
</span><span id="Analyzer.generate_graphs-1902"><a href="#Analyzer.generate_graphs-1902"><span class="linenos">1902</span></a>                <span class="c1"># Calculate a Total Average Time and Total High Time cost</span>
</span><span id="Analyzer.generate_graphs-1903"><a href="#Analyzer.generate_graphs-1903"><span class="linenos">1903</span></a>                <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;Total Average Time Cost&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;Morning Average Cost&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;Evening Average Cost&#39;</span><span class="p">]</span>
</span><span id="Analyzer.generate_graphs-1904"><a href="#Analyzer.generate_graphs-1904"><span class="linenos">1904</span></a>                <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;Total High Time Cost&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;Morning High Cost&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;Evening High Cost&#39;</span><span class="p">]</span>
</span><span id="Analyzer.generate_graphs-1905"><a href="#Analyzer.generate_graphs-1905"><span class="linenos">1905</span></a>
</span><span id="Analyzer.generate_graphs-1906"><a href="#Analyzer.generate_graphs-1906"><span class="linenos">1906</span></a>                <span class="c1"># Calculate a Total Average Cost and Total High Cost</span>
</span><span id="Analyzer.generate_graphs-1907"><a href="#Analyzer.generate_graphs-1907"><span class="linenos">1907</span></a>                <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;Total Average Cost&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;Total Average Time Cost&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;commute_cost&#39;</span><span class="p">]</span>
</span><span id="Analyzer.generate_graphs-1908"><a href="#Analyzer.generate_graphs-1908"><span class="linenos">1908</span></a>                <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;Total High Cost&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;Total High Time Cost&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;commute_cost&#39;</span><span class="p">]</span>
</span><span id="Analyzer.generate_graphs-1909"><a href="#Analyzer.generate_graphs-1909"><span class="linenos">1909</span></a>                
</span><span id="Analyzer.generate_graphs-1910"><a href="#Analyzer.generate_graphs-1910"><span class="linenos">1910</span></a>                <span class="c1"># add the current val_set to the employee_costs_to_office dictionary</span>
</span><span id="Analyzer.generate_graphs-1911"><a href="#Analyzer.generate_graphs-1911"><span class="linenos">1911</span></a>                <span class="n">employee_costs_to_office</span><span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;address&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">val_set</span>
</span><span id="Analyzer.generate_graphs-1912"><a href="#Analyzer.generate_graphs-1912"><span class="linenos">1912</span></a>
</span><span id="Analyzer.generate_graphs-1913"><a href="#Analyzer.generate_graphs-1913"><span class="linenos">1913</span></a>            <span class="n">dvalues</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Total Average Cost&#39;</span><span class="p">,</span><span class="s1">&#39;Total High Cost&#39;</span><span class="p">]</span>
</span><span id="Analyzer.generate_graphs-1914"><a href="#Analyzer.generate_graphs-1914"><span class="linenos">1914</span></a>            <span class="n">bins</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Analyzer.generate_graphs-1915"><a href="#Analyzer.generate_graphs-1915"><span class="linenos">1915</span></a>
</span><span id="Analyzer.generate_graphs-1916"><a href="#Analyzer.generate_graphs-1916"><span class="linenos">1916</span></a>            <span class="c1"># now iterate through again to get bins</span>
</span><span id="Analyzer.generate_graphs-1917"><a href="#Analyzer.generate_graphs-1917"><span class="linenos">1917</span></a>            <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">offices</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
</span><span id="Analyzer.generate_graphs-1918"><a href="#Analyzer.generate_graphs-1918"><span class="linenos">1918</span></a>                <span class="c1"># create bins based on the max value of the Total Average Cost and Total High Cost data for each office, get the max value for bins</span>
</span><span id="Analyzer.generate_graphs-1919"><a href="#Analyzer.generate_graphs-1919"><span class="linenos">1919</span></a>                <span class="n">binmax</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Analyzer.generate_graphs-1920"><a href="#Analyzer.generate_graphs-1920"><span class="linenos">1920</span></a>                <span class="k">for</span> <span class="n">each</span> <span class="ow">in</span> <span class="n">dvalues</span><span class="p">:</span>
</span><span id="Analyzer.generate_graphs-1921"><a href="#Analyzer.generate_graphs-1921"><span class="linenos">1921</span></a>                    <span class="k">if</span> <span class="nb">max</span><span class="p">(</span><span class="n">employee_costs_to_office</span><span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;address&#39;</span><span class="p">]][</span><span class="n">each</span><span class="p">])</span> <span class="o">&gt;</span> <span class="n">binmax</span><span class="p">:</span>
</span><span id="Analyzer.generate_graphs-1922"><a href="#Analyzer.generate_graphs-1922"><span class="linenos">1922</span></a>                        <span class="n">binmax</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">employee_costs_to_office</span><span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;address&#39;</span><span class="p">]][</span><span class="n">each</span><span class="p">])</span>
</span><span id="Analyzer.generate_graphs-1923"><a href="#Analyzer.generate_graphs-1923"><span class="linenos">1923</span></a>                <span class="n">step</span> <span class="o">=</span> <span class="mi">5</span>
</span><span id="Analyzer.generate_graphs-1924"><a href="#Analyzer.generate_graphs-1924"><span class="linenos">1924</span></a>
</span><span id="Analyzer.generate_graphs-1925"><a href="#Analyzer.generate_graphs-1925"><span class="linenos">1925</span></a>            <span class="c1"># round the binmax up to the nearest step</span>
</span><span id="Analyzer.generate_graphs-1926"><a href="#Analyzer.generate_graphs-1926"><span class="linenos">1926</span></a>            <span class="n">bins</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">binmax</span> <span class="o">+</span> <span class="n">step</span> <span class="o">-</span> <span class="p">(</span><span class="n">binmax</span> <span class="o">%</span> <span class="n">step</span><span class="p">)),</span> <span class="n">step</span><span class="p">)</span>
</span><span id="Analyzer.generate_graphs-1927"><a href="#Analyzer.generate_graphs-1927"><span class="linenos">1927</span></a>            
</span><span id="Analyzer.generate_graphs-1928"><a href="#Analyzer.generate_graphs-1928"><span class="linenos">1928</span></a>            <span class="n">font_mod</span> <span class="o">=</span> <span class="mf">1.5</span>
</span><span id="Analyzer.generate_graphs-1929"><a href="#Analyzer.generate_graphs-1929"><span class="linenos">1929</span></a>            
</span><span id="Analyzer.generate_graphs-1930"><a href="#Analyzer.generate_graphs-1930"><span class="linenos">1930</span></a>            <span class="c1"># create histograms for the morning and evening average costs</span>
</span><span id="Analyzer.generate_graphs-1931"><a href="#Analyzer.generate_graphs-1931"><span class="linenos">1931</span></a>            <span class="n">plt</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graphing</span><span class="o">.</span><span class="n">get_histogram</span><span class="p">(</span><span class="n">emp</span><span class="p">,</span> <span class="n">office</span><span class="p">,</span> <span class="n">commute_data</span><span class="p">,</span> <span class="n">dvalues</span><span class="p">,</span> 
</span><span id="Analyzer.generate_graphs-1932"><a href="#Analyzer.generate_graphs-1932"><span class="linenos">1932</span></a>                                                    <span class="n">suptitle</span><span class="o">=</span><span class="s2">&quot;Total Employee Commute Costs per Day&quot;</span><span class="p">,</span><span class="n">cutoff_radius</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">commute_range_cut_off</span><span class="p">,</span>
</span><span id="Analyzer.generate_graphs-1933"><a href="#Analyzer.generate_graphs-1933"><span class="linenos">1933</span></a>                                    <span class="n">x_label</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="s1">&#39;\$ (USD)&#39;</span><span class="p">),</span> <span class="n">y_label</span><span class="o">=</span><span class="s1">&#39;# Employees&#39;</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="n">bins</span><span class="p">,</span> <span class="n">rows</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">employee_costs_to_office</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span> <span class="n">cols</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> 
</span><span id="Analyzer.generate_graphs-1934"><a href="#Analyzer.generate_graphs-1934"><span class="linenos">1934</span></a>                                    <span class="n">column_titles</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Average&quot;</span><span class="p">,</span><span class="s2">&quot;High/Conservative&quot;</span><span class="p">],</span> <span class="n">cumulative_line</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">font_mod</span><span class="o">=</span><span class="n">font_mod</span><span class="p">,</span> <span class="n">manual_plot</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> 
</span><span id="Analyzer.generate_graphs-1935"><a href="#Analyzer.generate_graphs-1935"><span class="linenos">1935</span></a>                                    <span class="n">sharey</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">override_values</span><span class="o">=</span><span class="n">employee_costs_to_office</span><span class="p">)</span>
</span><span id="Analyzer.generate_graphs-1936"><a href="#Analyzer.generate_graphs-1936"><span class="linenos">1936</span></a>            
</span><span id="Analyzer.generate_graphs-1937"><a href="#Analyzer.generate_graphs-1937"><span class="linenos">1937</span></a>            <span class="c1"># manually add histograms for each office option</span>
</span><span id="Analyzer.generate_graphs-1938"><a href="#Analyzer.generate_graphs-1938"><span class="linenos">1938</span></a>            <span class="n">keys</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">employee_costs_to_office</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
</span><span id="Analyzer.generate_graphs-1939"><a href="#Analyzer.generate_graphs-1939"><span class="linenos">1939</span></a>            <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">keys</span><span class="p">)):</span>
</span><span id="Analyzer.generate_graphs-1940"><a href="#Analyzer.generate_graphs-1940"><span class="linenos">1940</span></a>                <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dvalues</span><span class="p">)):</span>
</span><span id="Analyzer.generate_graphs-1941"><a href="#Analyzer.generate_graphs-1941"><span class="linenos">1941</span></a>                    <span class="n">ax</span><span class="p">[</span><span class="n">r</span><span class="p">,</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">employee_costs_to_office</span><span class="p">[</span><span class="n">keys</span><span class="p">[</span><span class="n">r</span><span class="p">]][</span><span class="n">dvalues</span><span class="p">[</span><span class="n">c</span><span class="p">]],</span> <span class="n">bins</span><span class="o">=</span><span class="n">bins</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;#555555&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> 
</span><span id="Analyzer.generate_graphs-1942"><a href="#Analyzer.generate_graphs-1942"><span class="linenos">1942</span></a>                                 <span class="n">zorder</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">align</span><span class="o">=</span><span class="s1">&#39;mid&#39;</span><span class="p">,</span> <span class="n">rwidth</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">dvalues</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">(</span><span class="n">r</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>
</span><span id="Analyzer.generate_graphs-1943"><a href="#Analyzer.generate_graphs-1943"><span class="linenos">1943</span></a>                    <span class="n">ax</span><span class="p">[</span><span class="n">r</span><span class="p">,</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;major&#39;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
</span><span id="Analyzer.generate_graphs-1944"><a href="#Analyzer.generate_graphs-1944"><span class="linenos">1944</span></a>
</span><span id="Analyzer.generate_graphs-1945"><a href="#Analyzer.generate_graphs-1945"><span class="linenos">1945</span></a>                    <span class="c1"># add a text box in the upper right corner with the stats</span>
</span><span id="Analyzer.generate_graphs-1946"><a href="#Analyzer.generate_graphs-1946"><span class="linenos">1946</span></a>                    <span class="n">t</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;me&#39;</span> <span class="p">:</span> <span class="s1">&#39;Median: |$</span><span class="si">{:,.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">employee_costs_to_office</span><span class="p">[</span><span class="n">keys</span><span class="p">[</span><span class="n">r</span><span class="p">]][</span><span class="n">dvalues</span><span class="p">[</span><span class="n">c</span><span class="p">]])),</span>
</span><span id="Analyzer.generate_graphs-1947"><a href="#Analyzer.generate_graphs-1947"><span class="linenos">1947</span></a>                        <span class="s1">&#39;av&#39;</span> <span class="p">:</span> <span class="s1">&#39;Average: |$</span><span class="si">{:,.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">employee_costs_to_office</span><span class="p">[</span><span class="n">keys</span><span class="p">[</span><span class="n">r</span><span class="p">]][</span><span class="n">dvalues</span><span class="p">[</span><span class="n">c</span><span class="p">]])),</span>
</span><span id="Analyzer.generate_graphs-1948"><a href="#Analyzer.generate_graphs-1948"><span class="linenos">1948</span></a>                        <span class="s1">&#39;mi&#39;</span> <span class="p">:</span> <span class="s1">&#39;Min: |$</span><span class="si">{:,.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">employee_costs_to_office</span><span class="p">[</span><span class="n">keys</span><span class="p">[</span><span class="n">r</span><span class="p">]][</span><span class="n">dvalues</span><span class="p">[</span><span class="n">c</span><span class="p">]])),</span>
</span><span id="Analyzer.generate_graphs-1949"><a href="#Analyzer.generate_graphs-1949"><span class="linenos">1949</span></a>                        <span class="s1">&#39;ma&#39;</span> <span class="p">:</span> <span class="s1">&#39;Max: |$</span><span class="si">{:,.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">employee_costs_to_office</span><span class="p">[</span><span class="n">keys</span><span class="p">[</span><span class="n">r</span><span class="p">]][</span><span class="n">dvalues</span><span class="p">[</span><span class="n">c</span><span class="p">]])),</span>
</span><span id="Analyzer.generate_graphs-1950"><a href="#Analyzer.generate_graphs-1950"><span class="linenos">1950</span></a>                        <span class="s1">&#39;to&#39;</span> <span class="p">:</span> <span class="s1">&#39;Total: |$</span><span class="si">{:,.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">employee_costs_to_office</span><span class="p">[</span><span class="n">keys</span><span class="p">[</span><span class="n">r</span><span class="p">]][</span><span class="n">dvalues</span><span class="p">[</span><span class="n">c</span><span class="p">]])),</span>
</span><span id="Analyzer.generate_graphs-1951"><a href="#Analyzer.generate_graphs-1951"><span class="linenos">1951</span></a>                        <span class="s1">&#39;co&#39;</span> <span class="p">:</span> <span class="s1">&#39;Count: |</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">employee_costs_to_office</span><span class="p">[</span><span class="n">keys</span><span class="p">[</span><span class="n">r</span><span class="p">]][</span><span class="n">dvalues</span><span class="p">[</span><span class="n">c</span><span class="p">]]))</span>
</span><span id="Analyzer.generate_graphs-1952"><a href="#Analyzer.generate_graphs-1952"><span class="linenos">1952</span></a>                        <span class="p">}</span>
</span><span id="Analyzer.generate_graphs-1953"><a href="#Analyzer.generate_graphs-1953"><span class="linenos">1953</span></a>                    <span class="c1"># get the longest string value</span>
</span><span id="Analyzer.generate_graphs-1954"><a href="#Analyzer.generate_graphs-1954"><span class="linenos">1954</span></a>                    <span class="n">max_len</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="s1">&#39;me&#39;</span><span class="p">]),</span><span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="s1">&#39;av&#39;</span><span class="p">]),</span><span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="s1">&#39;to&#39;</span><span class="p">]),</span><span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="s1">&#39;mi&#39;</span><span class="p">]),</span><span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="s1">&#39;ma&#39;</span><span class="p">]),</span><span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="s1">&#39;co&#39;</span><span class="p">]))</span>
</span><span id="Analyzer.generate_graphs-1955"><a href="#Analyzer.generate_graphs-1955"><span class="linenos">1955</span></a>                    <span class="c1"># calculate additional space</span>
</span><span id="Analyzer.generate_graphs-1956"><a href="#Analyzer.generate_graphs-1956"><span class="linenos">1956</span></a>                    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">t</span><span class="p">:</span>
</span><span id="Analyzer.generate_graphs-1957"><a href="#Analyzer.generate_graphs-1957"><span class="linenos">1957</span></a>                        <span class="n">t</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">t</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">,</span><span class="s2">&quot; &quot;</span><span class="o">*</span><span class="p">(</span><span class="n">max_len</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="n">k</span><span class="p">])))</span>
</span><span id="Analyzer.generate_graphs-1958"><a href="#Analyzer.generate_graphs-1958"><span class="linenos">1958</span></a>                    <span class="c1"># add spaces to make all the same length, replacing |</span>
</span><span id="Analyzer.generate_graphs-1959"><a href="#Analyzer.generate_graphs-1959"><span class="linenos">1959</span></a>                    <span class="n">textstr</span> <span class="o">=</span> <span class="s2">&quot;Employee Commute </span><span class="se">\n</span><span class="s2"> Cost per Day: &quot;</span>
</span><span id="Analyzer.generate_graphs-1960"><a href="#Analyzer.generate_graphs-1960"><span class="linenos">1960</span></a>                    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">t</span><span class="p">:</span>
</span><span id="Analyzer.generate_graphs-1961"><a href="#Analyzer.generate_graphs-1961"><span class="linenos">1961</span></a>                        <span class="n">textstr</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">t</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
</span><span id="Analyzer.generate_graphs-1962"><a href="#Analyzer.generate_graphs-1962"><span class="linenos">1962</span></a>                    <span class="c1"># these are matplotlib.patch.Patch properties</span>
</span><span id="Analyzer.generate_graphs-1963"><a href="#Analyzer.generate_graphs-1963"><span class="linenos">1963</span></a>                    <span class="n">props</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">boxstyle</span><span class="o">=</span><span class="s1">&#39;round&#39;</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;wheat&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
</span><span id="Analyzer.generate_graphs-1964"><a href="#Analyzer.generate_graphs-1964"><span class="linenos">1964</span></a>                    <span class="c1"># place a text box in upper right in axes coords,</span>
</span><span id="Analyzer.generate_graphs-1965"><a href="#Analyzer.generate_graphs-1965"><span class="linenos">1965</span></a>                    <span class="n">ax</span><span class="p">[</span><span class="n">r</span><span class="p">,</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">.95</span><span class="p">,</span> <span class="mf">.7</span><span class="p">,</span> <span class="n">textstr</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="n">r</span><span class="p">,</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">,</span>
</span><span id="Analyzer.generate_graphs-1966"><a href="#Analyzer.generate_graphs-1966"><span class="linenos">1966</span></a>                                <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">bbox</span><span class="o">=</span><span class="n">props</span><span class="p">,</span> <span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;family&#39;</span><span class="p">:</span> <span class="s1">&#39;monospace&#39;</span><span class="p">},</span> <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">)</span>
</span><span id="Analyzer.generate_graphs-1967"><a href="#Analyzer.generate_graphs-1967"><span class="linenos">1967</span></a>                    
</span><span id="Analyzer.generate_graphs-1968"><a href="#Analyzer.generate_graphs-1968"><span class="linenos">1968</span></a>                    <span class="c1"># add the address to the top left of the plot</span>
</span><span id="Analyzer.generate_graphs-1969"><a href="#Analyzer.generate_graphs-1969"><span class="linenos">1969</span></a>                    <span class="k">if</span> <span class="n">c</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
</span><span id="Analyzer.generate_graphs-1970"><a href="#Analyzer.generate_graphs-1970"><span class="linenos">1970</span></a>                        <span class="n">ax</span><span class="p">[</span><span class="n">r</span><span class="p">,</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.02</span><span class="p">,</span> <span class="mf">0.98</span><span class="p">,</span> <span class="n">keys</span><span class="p">[</span><span class="n">r</span><span class="p">],</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="o">*</span><span class="n">font_mod</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="n">r</span><span class="p">,</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;top&#39;</span><span class="p">)</span>
</span><span id="Analyzer.generate_graphs-1971"><a href="#Analyzer.generate_graphs-1971"><span class="linenos">1971</span></a>
</span><span id="Analyzer.generate_graphs-1972"><a href="#Analyzer.generate_graphs-1972"><span class="linenos">1972</span></a>                    <span class="c1"># for the first column, add morning/evening text box the top left of the plot</span>
</span><span id="Analyzer.generate_graphs-1973"><a href="#Analyzer.generate_graphs-1973"><span class="linenos">1973</span></a>                    <span class="k">if</span> <span class="n">r</span><span class="o">==</span><span class="nb">len</span><span class="p">(</span><span class="n">employee_costs_to_office</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span>
</span><span id="Analyzer.generate_graphs-1974"><a href="#Analyzer.generate_graphs-1974"><span class="linenos">1974</span></a>                        <span class="n">ax</span><span class="p">[</span><span class="n">r</span><span class="p">,</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Employee Total Cost ($ USD / Day)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="o">*</span><span class="n">font_mod</span><span class="p">)</span>                        
</span><span id="Analyzer.generate_graphs-1975"><a href="#Analyzer.generate_graphs-1975"><span class="linenos">1975</span></a>             
</span><span id="Analyzer.generate_graphs-1976"><a href="#Analyzer.generate_graphs-1976"><span class="linenos">1976</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">(</span><span class="n">pad</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
</span><span id="Analyzer.generate_graphs-1977"><a href="#Analyzer.generate_graphs-1977"><span class="linenos">1977</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">plots_dir</span><span class="o">+</span><span class="s2">&quot;/&quot;</span><span class="o">+</span><span class="n">key</span><span class="o">+</span><span class="s2">&quot;.png&quot;</span><span class="p">)</span>
</span><span id="Analyzer.generate_graphs-1978"><a href="#Analyzer.generate_graphs-1978"><span class="linenos">1978</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span> 
</span><span id="Analyzer.generate_graphs-1979"><a href="#Analyzer.generate_graphs-1979"><span class="linenos">1979</span></a>
</span><span id="Analyzer.generate_graphs-1980"><a href="#Analyzer.generate_graphs-1980"><span class="linenos">1980</span></a>        <span class="c1">################################################################################ </span>
</span><span id="Analyzer.generate_graphs-1981"><a href="#Analyzer.generate_graphs-1981"><span class="linenos">1981</span></a>        <span class="c1"># GRAPH: </span>
</span><span id="Analyzer.generate_graphs-1982"><a href="#Analyzer.generate_graphs-1982"><span class="linenos">1982</span></a>        <span class="c1">## Total Employee Commute Cost Differential Analysis</span>
</span><span id="Analyzer.generate_graphs-1983"><a href="#Analyzer.generate_graphs-1983"><span class="linenos">1983</span></a>        <span class="n">key</span> <span class="o">=</span> <span class="s1">&#39;teccda&#39;</span>
</span><span id="Analyzer.generate_graphs-1984"><a href="#Analyzer.generate_graphs-1984"><span class="linenos">1984</span></a>        <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;Total Employee Commute Cost Differential Analysis&quot;</span>
</span><span id="Analyzer.generate_graphs-1985"><a href="#Analyzer.generate_graphs-1985"><span class="linenos">1985</span></a>        <span class="n">short_title</span> <span class="o">=</span> <span class="n">title</span>
</span><span id="Analyzer.generate_graphs-1986"><a href="#Analyzer.generate_graphs-1986"><span class="linenos">1986</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">graph_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="p">{</span><span class="s2">&quot;GRAPH&quot;</span><span class="p">:</span> <span class="n">key</span><span class="p">,</span>
</span><span id="Analyzer.generate_graphs-1987"><a href="#Analyzer.generate_graphs-1987"><span class="linenos">1987</span></a>                                <span class="s2">&quot;TITLE&quot;</span><span class="p">:</span> <span class="n">short_title</span><span class="p">,</span>
</span><span id="Analyzer.generate_graphs-1988"><a href="#Analyzer.generate_graphs-1988"><span class="linenos">1988</span></a>                                <span class="s2">&quot;FILENAME&quot;</span><span class="p">:</span> <span class="n">key</span><span class="o">+</span><span class="s2">&quot;.png&quot;</span><span class="p">,</span>
</span><span id="Analyzer.generate_graphs-1989"><a href="#Analyzer.generate_graphs-1989"><span class="linenos">1989</span></a>                                <span class="s2">&quot;PLOT-DESCRIPTION&quot;</span><span class="p">:</span> <span class="s2">&quot;This graph displays the distribution of commute costs for employees within the &quot;</span> <span class="o">+</span> \
</span><span id="Analyzer.generate_graphs-1990"><a href="#Analyzer.generate_graphs-1990"><span class="linenos">1990</span></a>                                                    <span class="s2">&quot;cutoff distance of the office options. Changes in per-employee commute costs are shown for each office &quot;</span> <span class="o">+</span> \
</span><span id="Analyzer.generate_graphs-1991"><a href="#Analyzer.generate_graphs-1991"><span class="linenos">1991</span></a>                                                    <span class="s2">&quot;option relative to the existing office locaton.  This analysis inlcudes per mile costs (not including tolls, etc.) as well as  &quot;</span> <span class="o">+</span> \
</span><span id="Analyzer.generate_graphs-1992"><a href="#Analyzer.generate_graphs-1992"><span class="linenos">1992</span></a>                                                    <span class="s2">&quot;average and conservative costs due to cash equivalent for time.&quot;</span>
</span><span id="Analyzer.generate_graphs-1993"><a href="#Analyzer.generate_graphs-1993"><span class="linenos">1993</span></a>                                <span class="p">})</span>
</span><span id="Analyzer.generate_graphs-1994"><a href="#Analyzer.generate_graphs-1994"><span class="linenos">1994</span></a>        
</span><span id="Analyzer.generate_graphs-1995"><a href="#Analyzer.generate_graphs-1995"><span class="linenos">1995</span></a>        <span class="k">if</span> <span class="n">graph</span> <span class="o">==</span> <span class="s2">&quot;_all&quot;</span> <span class="ow">or</span> <span class="n">graph</span> <span class="o">==</span> <span class="n">key</span><span class="p">:</span>
</span><span id="Analyzer.generate_graphs-1996"><a href="#Analyzer.generate_graphs-1996"><span class="linenos">1996</span></a>            <span class="c1"># gather the data for the analysis</span>
</span><span id="Analyzer.generate_graphs-1997"><a href="#Analyzer.generate_graphs-1997"><span class="linenos">1997</span></a>            <span class="n">base_costs</span><span class="p">,</span> <span class="n">cost_values</span><span class="p">,</span> <span class="n">average_diffs</span><span class="p">,</span> <span class="n">conservative_diffs</span><span class="p">,</span> <span class="n">withins</span><span class="p">,</span> <span class="n">employee_costs_to_office</span><span class="p">,</span> <span class="n">current_office</span><span class="p">,</span> <span class="n">other_offices</span> <span class="o">=</span> \
</span><span id="Analyzer.generate_graphs-1998"><a href="#Analyzer.generate_graphs-1998"><span class="linenos">1998</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">get_attrition_analysis</span><span class="p">(</span><span class="n">emp</span><span class="p">,</span> <span class="n">offices</span><span class="p">,</span> <span class="n">commute_data</span><span class="p">)</span>
</span><span id="Analyzer.generate_graphs-1999"><a href="#Analyzer.generate_graphs-1999"><span class="linenos">1999</span></a>
</span><span id="Analyzer.generate_graphs-2000"><a href="#Analyzer.generate_graphs-2000"><span class="linenos">2000</span></a>
</span><span id="Analyzer.generate_graphs-2001"><a href="#Analyzer.generate_graphs-2001"><span class="linenos">2001</span></a>            <span class="c1"># now we have a list of dataframes with the differentials, we eliminate all rows with 0 cost differential to prevent skewing the histogram</span>
</span><span id="Analyzer.generate_graphs-2002"><a href="#Analyzer.generate_graphs-2002"><span class="linenos">2002</span></a>            <span class="c1"># calculate the bin list based upon a the min (negative) and max (positive) values of the data     </span>
</span><span id="Analyzer.generate_graphs-2003"><a href="#Analyzer.generate_graphs-2003"><span class="linenos">2003</span></a>            <span class="n">binmin</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Analyzer.generate_graphs-2004"><a href="#Analyzer.generate_graphs-2004"><span class="linenos">2004</span></a>            <span class="n">binmax</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Analyzer.generate_graphs-2005"><a href="#Analyzer.generate_graphs-2005"><span class="linenos">2005</span></a>            <span class="n">diffs</span> <span class="o">=</span> <span class="p">[</span><span class="n">average_diffs</span><span class="p">,</span> <span class="n">conservative_diffs</span><span class="p">]</span>
</span><span id="Analyzer.generate_graphs-2006"><a href="#Analyzer.generate_graphs-2006"><span class="linenos">2006</span></a>            <span class="k">for</span> <span class="n">diff</span> <span class="ow">in</span> <span class="n">diffs</span><span class="p">:</span>
</span><span id="Analyzer.generate_graphs-2007"><a href="#Analyzer.generate_graphs-2007"><span class="linenos">2007</span></a>                <span class="k">for</span> <span class="n">each</span> <span class="ow">in</span> <span class="n">diff</span><span class="p">:</span>
</span><span id="Analyzer.generate_graphs-2008"><a href="#Analyzer.generate_graphs-2008"><span class="linenos">2008</span></a>                    <span class="k">if</span> <span class="nb">min</span><span class="p">(</span><span class="n">each</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">binmin</span><span class="p">:</span>
</span><span id="Analyzer.generate_graphs-2009"><a href="#Analyzer.generate_graphs-2009"><span class="linenos">2009</span></a>                        <span class="n">binmin</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">each</span><span class="p">)</span>
</span><span id="Analyzer.generate_graphs-2010"><a href="#Analyzer.generate_graphs-2010"><span class="linenos">2010</span></a>                    <span class="k">if</span> <span class="nb">max</span><span class="p">(</span><span class="n">each</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">binmax</span><span class="p">:</span>
</span><span id="Analyzer.generate_graphs-2011"><a href="#Analyzer.generate_graphs-2011"><span class="linenos">2011</span></a>                        <span class="n">binmax</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">each</span><span class="p">)</span>
</span><span id="Analyzer.generate_graphs-2012"><a href="#Analyzer.generate_graphs-2012"><span class="linenos">2012</span></a>            <span class="n">step</span> <span class="o">=</span> <span class="mi">10</span> 
</span><span id="Analyzer.generate_graphs-2013"><a href="#Analyzer.generate_graphs-2013"><span class="linenos">2013</span></a>            <span class="c1"># round the binmin down to the nearest step, max up to the nearest step</span>
</span><span id="Analyzer.generate_graphs-2014"><a href="#Analyzer.generate_graphs-2014"><span class="linenos">2014</span></a>            <span class="n">bins</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">binmin</span> <span class="o">-</span> <span class="p">(</span><span class="n">binmin</span> <span class="o">%</span> <span class="n">step</span><span class="p">)),</span> <span class="nb">int</span><span class="p">(</span><span class="n">binmax</span> <span class="o">+</span> <span class="n">step</span> <span class="o">-</span> <span class="p">(</span><span class="n">binmax</span> <span class="o">%</span> <span class="n">step</span><span class="p">)),</span> <span class="n">step</span><span class="p">)</span>
</span><span id="Analyzer.generate_graphs-2015"><a href="#Analyzer.generate_graphs-2015"><span class="linenos">2015</span></a>            <span class="n">dvalues</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Total Average Cost&#39;</span><span class="p">,</span><span class="s1">&#39;Total High Cost&#39;</span><span class="p">]</span>
</span><span id="Analyzer.generate_graphs-2016"><a href="#Analyzer.generate_graphs-2016"><span class="linenos">2016</span></a>            
</span><span id="Analyzer.generate_graphs-2017"><a href="#Analyzer.generate_graphs-2017"><span class="linenos">2017</span></a>            <span class="n">plt</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graphing</span><span class="o">.</span><span class="n">get_histogram</span><span class="p">(</span><span class="n">emp</span><span class="p">,</span> <span class="n">other_offices</span><span class="p">,</span> <span class="n">cost_values</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="n">dvalues</span><span class="p">,</span> <span class="n">suptitle</span><span class="o">=</span><span class="s2">&quot;Total Employee Commute Cost Differential Analysis&quot;</span><span class="p">,</span> <span class="n">cutoff_radius</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">commute_range_cut_off</span><span class="p">,</span>
</span><span id="Analyzer.generate_graphs-2018"><a href="#Analyzer.generate_graphs-2018"><span class="linenos">2018</span></a>                                      <span class="n">x_label</span><span class="o">=</span><span class="s1">&#39;\$ (USD) based on time and mileage&#39;</span><span class="p">,</span> <span class="n">y_label</span><span class="o">=</span><span class="s1">&#39;# Employees (log scale)&#39;</span><span class="p">,</span>
</span><span id="Analyzer.generate_graphs-2019"><a href="#Analyzer.generate_graphs-2019"><span class="linenos">2019</span></a>                                      <span class="n">bins</span><span class="o">=</span><span class="n">bins</span><span class="p">,</span> <span class="n">rows</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">other_offices</span><span class="p">),</span> <span class="n">cols</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">column_titles</span><span class="o">=</span><span class="n">dvalues</span><span class="p">,</span> 
</span><span id="Analyzer.generate_graphs-2020"><a href="#Analyzer.generate_graphs-2020"><span class="linenos">2020</span></a>                                      <span class="n">cumulative_line</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">font_mod</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">manual_plot</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">override_values</span><span class="o">=</span><span class="n">cost_values</span><span class="p">)</span>
</span><span id="Analyzer.generate_graphs-2021"><a href="#Analyzer.generate_graphs-2021"><span class="linenos">2021</span></a>            
</span><span id="Analyzer.generate_graphs-2022"><a href="#Analyzer.generate_graphs-2022"><span class="linenos">2022</span></a>            <span class="c1"># calculate the $ value for turnover due to cost</span>
</span><span id="Analyzer.generate_graphs-2023"><a href="#Analyzer.generate_graphs-2023"><span class="linenos">2023</span></a>            <span class="n">median_salary</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">median_salary</span>
</span><span id="Analyzer.generate_graphs-2024"><a href="#Analyzer.generate_graphs-2024"><span class="linenos">2024</span></a>            <span class="n">threshold</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">turnover_threshold_due_to_cost</span><span class="o">*</span><span class="n">median_salary</span>
</span><span id="Analyzer.generate_graphs-2025"><a href="#Analyzer.generate_graphs-2025"><span class="linenos">2025</span></a>            <span class="n">daily_threshold</span> <span class="o">=</span> <span class="n">threshold</span><span class="o">/</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">commute_days_per_week</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">commute_weeks_per_year</span><span class="p">)</span>
</span><span id="Analyzer.generate_graphs-2026"><a href="#Analyzer.generate_graphs-2026"><span class="linenos">2026</span></a>                   
</span><span id="Analyzer.generate_graphs-2027"><a href="#Analyzer.generate_graphs-2027"><span class="linenos">2027</span></a>            <span class="c1"># manually add histograms for each office option</span>
</span><span id="Analyzer.generate_graphs-2028"><a href="#Analyzer.generate_graphs-2028"><span class="linenos">2028</span></a>            <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">other_offices</span><span class="p">)):</span>
</span><span id="Analyzer.generate_graphs-2029"><a href="#Analyzer.generate_graphs-2029"><span class="linenos">2029</span></a>                <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
</span><span id="Analyzer.generate_graphs-2030"><a href="#Analyzer.generate_graphs-2030"><span class="linenos">2030</span></a>                    <span class="n">ax</span><span class="p">[</span><span class="n">r</span><span class="p">,</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">average_diffs</span><span class="p">[</span><span class="n">r</span><span class="p">],</span> <span class="n">bins</span><span class="o">=</span><span class="n">bins</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;#555555&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">align</span><span class="o">=</span><span class="s1">&#39;mid&#39;</span><span class="p">,</span> 
</span><span id="Analyzer.generate_graphs-2031"><a href="#Analyzer.generate_graphs-2031"><span class="linenos">2031</span></a>                            <span class="n">rwidth</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">other_offices</span><span class="p">[</span><span class="s1">&#39;address&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="n">r</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">(</span><span class="n">r</span><span class="o">+</span><span class="mi">2</span><span class="p">),</span> <span class="n">log</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="Analyzer.generate_graphs-2032"><a href="#Analyzer.generate_graphs-2032"><span class="linenos">2032</span></a>                    <span class="n">ax</span><span class="p">[</span><span class="n">r</span><span class="p">,</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;major&#39;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
</span><span id="Analyzer.generate_graphs-2033"><a href="#Analyzer.generate_graphs-2033"><span class="linenos">2033</span></a>                    <span class="k">if</span> <span class="n">c</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Analyzer.generate_graphs-2034"><a href="#Analyzer.generate_graphs-2034"><span class="linenos">2034</span></a>                        <span class="n">ax</span><span class="p">[</span><span class="n">r</span><span class="p">,</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;# Employees (log scale)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
</span><span id="Analyzer.generate_graphs-2035"><a href="#Analyzer.generate_graphs-2035"><span class="linenos">2035</span></a>                        <span class="c1"># put office address top left of the plot</span>
</span><span id="Analyzer.generate_graphs-2036"><a href="#Analyzer.generate_graphs-2036"><span class="linenos">2036</span></a>                        <span class="n">ax</span><span class="p">[</span><span class="n">r</span><span class="p">,</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.03</span><span class="p">,</span> <span class="mf">0.99</span><span class="p">,</span> <span class="n">other_offices</span><span class="p">[</span><span class="s1">&#39;address&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="n">r</span><span class="p">],</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="n">r</span><span class="p">,</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;top&#39;</span><span class="p">)</span>
</span><span id="Analyzer.generate_graphs-2037"><a href="#Analyzer.generate_graphs-2037"><span class="linenos">2037</span></a>                    
</span><span id="Analyzer.generate_graphs-2038"><a href="#Analyzer.generate_graphs-2038"><span class="linenos">2038</span></a>                    <span class="k">if</span> <span class="n">r</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">other_offices</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span>
</span><span id="Analyzer.generate_graphs-2039"><a href="#Analyzer.generate_graphs-2039"><span class="linenos">2039</span></a>                        <span class="n">ax</span><span class="p">[</span><span class="n">r</span><span class="p">,</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Employee Total Cost Differential ($ USD)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
</span><span id="Analyzer.generate_graphs-2040"><a href="#Analyzer.generate_graphs-2040"><span class="linenos">2040</span></a>                    <span class="n">ax</span><span class="p">[</span><span class="n">r</span><span class="p">,</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;major&#39;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
</span><span id="Analyzer.generate_graphs-2041"><a href="#Analyzer.generate_graphs-2041"><span class="linenos">2041</span></a>                    <span class="c1"># draw a red box with alpha 0.1 over the plot from x=daily_threshold to x=binmax, and y=0 to y max</span>
</span><span id="Analyzer.generate_graphs-2042"><a href="#Analyzer.generate_graphs-2042"><span class="linenos">2042</span></a>                    <span class="n">ax</span><span class="p">[</span><span class="n">r</span><span class="p">,</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">fill_between</span><span class="p">([</span><span class="n">daily_threshold</span><span class="p">,</span><span class="n">binmax</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="o">**</span><span class="mi">3</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
</span><span id="Analyzer.generate_graphs-2043"><a href="#Analyzer.generate_graphs-2043"><span class="linenos">2043</span></a>                    <span class="n">ax</span><span class="p">[</span><span class="n">r</span><span class="p">,</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">fill_between</span><span class="p">([</span><span class="n">daily_threshold</span><span class="p">,</span><span class="n">binmax</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="o">**</span><span class="mi">3</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
</span><span id="Analyzer.generate_graphs-2044"><a href="#Analyzer.generate_graphs-2044"><span class="linenos">2044</span></a>                    
</span><span id="Analyzer.generate_graphs-2045"><a href="#Analyzer.generate_graphs-2045"><span class="linenos">2045</span></a>                    <span class="n">above_threshold</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Analyzer.generate_graphs-2046"><a href="#Analyzer.generate_graphs-2046"><span class="linenos">2046</span></a>                    <span class="n">cost_impact</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Analyzer.generate_graphs-2047"><a href="#Analyzer.generate_graphs-2047"><span class="linenos">2047</span></a>                    <span class="c1"># cycle through the average diffs and get a count of costs above the threshold</span>
</span><span id="Analyzer.generate_graphs-2048"><a href="#Analyzer.generate_graphs-2048"><span class="linenos">2048</span></a>                    <span class="k">if</span> <span class="n">c</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Analyzer.generate_graphs-2049"><a href="#Analyzer.generate_graphs-2049"><span class="linenos">2049</span></a>                        <span class="k">for</span> <span class="n">each</span> <span class="ow">in</span> <span class="n">average_diffs</span><span class="p">[</span><span class="n">r</span><span class="p">]:</span>
</span><span id="Analyzer.generate_graphs-2050"><a href="#Analyzer.generate_graphs-2050"><span class="linenos">2050</span></a>                            <span class="k">if</span> <span class="n">each</span> <span class="o">&gt;</span> <span class="n">daily_threshold</span><span class="p">:</span>
</span><span id="Analyzer.generate_graphs-2051"><a href="#Analyzer.generate_graphs-2051"><span class="linenos">2051</span></a>                                <span class="n">above_threshold</span> <span class="o">+=</span> <span class="mi">1</span>                        
</span><span id="Analyzer.generate_graphs-2052"><a href="#Analyzer.generate_graphs-2052"><span class="linenos">2052</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="Analyzer.generate_graphs-2053"><a href="#Analyzer.generate_graphs-2053"><span class="linenos">2053</span></a>                        <span class="k">for</span> <span class="n">each</span> <span class="ow">in</span> <span class="n">conservative_diffs</span><span class="p">[</span><span class="n">r</span><span class="p">]:</span>
</span><span id="Analyzer.generate_graphs-2054"><a href="#Analyzer.generate_graphs-2054"><span class="linenos">2054</span></a>                            <span class="k">if</span> <span class="n">each</span> <span class="o">&gt;</span> <span class="n">daily_threshold</span><span class="p">:</span>
</span><span id="Analyzer.generate_graphs-2055"><a href="#Analyzer.generate_graphs-2055"><span class="linenos">2055</span></a>                                <span class="n">above_threshold</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="Analyzer.generate_graphs-2056"><a href="#Analyzer.generate_graphs-2056"><span class="linenos">2056</span></a>
</span><span id="Analyzer.generate_graphs-2057"><a href="#Analyzer.generate_graphs-2057"><span class="linenos">2057</span></a>                    <span class="c1"># cost impact is the # above threshold * employee replacement cost * probability of turnover</span>
</span><span id="Analyzer.generate_graphs-2058"><a href="#Analyzer.generate_graphs-2058"><span class="linenos">2058</span></a>                    <span class="n">cost_impact</span> <span class="o">=</span> <span class="n">above_threshold</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">turnover_probability_time_cost</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">employee_replacement_cost</span>
</span><span id="Analyzer.generate_graphs-2059"><a href="#Analyzer.generate_graphs-2059"><span class="linenos">2059</span></a>                    <span class="c1"># add a text box with the count</span>
</span><span id="Analyzer.generate_graphs-2060"><a href="#Analyzer.generate_graphs-2060"><span class="linenos">2060</span></a>                    <span class="n">t</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;dt&#39;</span> <span class="p">:</span> <span class="s1">&#39;Cost Threshold (\$/day): |$</span><span class="si">{:,.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">daily_threshold</span><span class="p">),</span>
</span><span id="Analyzer.generate_graphs-2061"><a href="#Analyzer.generate_graphs-2061"><span class="linenos">2061</span></a>                         <span class="s1">&#39;co&#39;</span> <span class="p">:</span> <span class="s1">&#39;# &gt; Threshold (#): |</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">above_threshold</span><span class="p">),</span>
</span><span id="Analyzer.generate_graphs-2062"><a href="#Analyzer.generate_graphs-2062"><span class="linenos">2062</span></a>                         <span class="s1">&#39;ci&#39;</span> <span class="p">:</span> <span class="s1">&#39;Expected Cost (\$): |$</span><span class="si">{:,.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cost_impact</span><span class="p">)</span>                         
</span><span id="Analyzer.generate_graphs-2063"><a href="#Analyzer.generate_graphs-2063"><span class="linenos">2063</span></a>                        <span class="p">}</span>
</span><span id="Analyzer.generate_graphs-2064"><a href="#Analyzer.generate_graphs-2064"><span class="linenos">2064</span></a>                    <span class="c1"># get the longest string value</span>
</span><span id="Analyzer.generate_graphs-2065"><a href="#Analyzer.generate_graphs-2065"><span class="linenos">2065</span></a>                    <span class="n">max_len</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="s1">&#39;co&#39;</span><span class="p">]),</span><span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="s1">&#39;ci&#39;</span><span class="p">]),</span><span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="s1">&#39;dt&#39;</span><span class="p">]))</span>
</span><span id="Analyzer.generate_graphs-2066"><a href="#Analyzer.generate_graphs-2066"><span class="linenos">2066</span></a>                    <span class="c1"># calculate additional space</span>
</span><span id="Analyzer.generate_graphs-2067"><a href="#Analyzer.generate_graphs-2067"><span class="linenos">2067</span></a>                    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">t</span><span class="p">:</span>
</span><span id="Analyzer.generate_graphs-2068"><a href="#Analyzer.generate_graphs-2068"><span class="linenos">2068</span></a>                        <span class="n">t</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">t</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">,</span><span class="s2">&quot; &quot;</span><span class="o">*</span><span class="p">(</span><span class="n">max_len</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="n">k</span><span class="p">])))</span>
</span><span id="Analyzer.generate_graphs-2069"><a href="#Analyzer.generate_graphs-2069"><span class="linenos">2069</span></a>                        <span class="n">t</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">t</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;# &gt; Threshold (#): &quot;</span><span class="p">,</span><span class="s2">&quot;# &gt; Threshold (#):&quot;</span><span class="o">*</span><span class="p">(</span><span class="n">max_len</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="n">k</span><span class="p">])))</span>
</span><span id="Analyzer.generate_graphs-2070"><a href="#Analyzer.generate_graphs-2070"><span class="linenos">2070</span></a>                    <span class="c1"># add spaces to make all the same length, replacing |</span>
</span><span id="Analyzer.generate_graphs-2071"><a href="#Analyzer.generate_graphs-2071"><span class="linenos">2071</span></a>                    <span class="n">textstr</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="c1">#Employees above \n Threshold: &quot;</span>
</span><span id="Analyzer.generate_graphs-2072"><a href="#Analyzer.generate_graphs-2072"><span class="linenos">2072</span></a>                    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">t</span><span class="p">:</span>
</span><span id="Analyzer.generate_graphs-2073"><a href="#Analyzer.generate_graphs-2073"><span class="linenos">2073</span></a>                        <span class="n">textstr</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">t</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
</span><span id="Analyzer.generate_graphs-2074"><a href="#Analyzer.generate_graphs-2074"><span class="linenos">2074</span></a>                    <span class="c1"># these are matplotlib.patch.Patch properties</span>
</span><span id="Analyzer.generate_graphs-2075"><a href="#Analyzer.generate_graphs-2075"><span class="linenos">2075</span></a>                    <span class="n">props</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">boxstyle</span><span class="o">=</span><span class="s1">&#39;round&#39;</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;wheat&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
</span><span id="Analyzer.generate_graphs-2076"><a href="#Analyzer.generate_graphs-2076"><span class="linenos">2076</span></a>                    <span class="c1"># place a text box in upper right in axes coords,</span>
</span><span id="Analyzer.generate_graphs-2077"><a href="#Analyzer.generate_graphs-2077"><span class="linenos">2077</span></a>                    <span class="n">ax</span><span class="p">[</span><span class="n">r</span><span class="p">,</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">.03</span><span class="p">,</span> <span class="mf">.85</span><span class="p">,</span> <span class="n">textstr</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="n">r</span><span class="p">,</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">,</span>
</span><span id="Analyzer.generate_graphs-2078"><a href="#Analyzer.generate_graphs-2078"><span class="linenos">2078</span></a>                                <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">bbox</span><span class="o">=</span><span class="n">props</span><span class="p">,</span> <span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;family&#39;</span><span class="p">:</span> <span class="s1">&#39;monospace&#39;</span><span class="p">},</span> <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">)</span>
</span><span id="Analyzer.generate_graphs-2079"><a href="#Analyzer.generate_graphs-2079"><span class="linenos">2079</span></a>            
</span><span id="Analyzer.generate_graphs-2080"><a href="#Analyzer.generate_graphs-2080"><span class="linenos">2080</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">(</span><span class="n">pad</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
</span><span id="Analyzer.generate_graphs-2081"><a href="#Analyzer.generate_graphs-2081"><span class="linenos">2081</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">plots_dir</span><span class="o">+</span><span class="s2">&quot;/&quot;</span><span class="o">+</span><span class="n">key</span><span class="o">+</span><span class="s2">&quot;.png&quot;</span><span class="p">)</span>
</span><span id="Analyzer.generate_graphs-2082"><a href="#Analyzer.generate_graphs-2082"><span class="linenos">2082</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="Analyzer.generate_graphs-2083"><a href="#Analyzer.generate_graphs-2083"><span class="linenos">2083</span></a>
</span><span id="Analyzer.generate_graphs-2084"><a href="#Analyzer.generate_graphs-2084"><span class="linenos">2084</span></a>
</span><span id="Analyzer.generate_graphs-2085"><a href="#Analyzer.generate_graphs-2085"><span class="linenos">2085</span></a>        <span class="c1">################################################################################</span>
</span><span id="Analyzer.generate_graphs-2086"><a href="#Analyzer.generate_graphs-2086"><span class="linenos">2086</span></a>        <span class="c1">### GRAPH SET: Local Analysis for Office X</span>
</span><span id="Analyzer.generate_graphs-2087"><a href="#Analyzer.generate_graphs-2087"><span class="linenos">2087</span></a>        <span class="c1"># iterate through offices, generate a graph for each office</span>
</span><span id="Analyzer.generate_graphs-2088"><a href="#Analyzer.generate_graphs-2088"><span class="linenos">2088</span></a>        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">offices</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>    
</span><span id="Analyzer.generate_graphs-2089"><a href="#Analyzer.generate_graphs-2089"><span class="linenos">2089</span></a>            <span class="c1">################################################################################ </span>
</span><span id="Analyzer.generate_graphs-2090"><a href="#Analyzer.generate_graphs-2090"><span class="linenos">2090</span></a>            <span class="c1"># GRAPH: </span>
</span><span id="Analyzer.generate_graphs-2091"><a href="#Analyzer.generate_graphs-2091"><span class="linenos">2091</span></a>            <span class="c1">## Traffic Regime Analysis</span>
</span><span id="Analyzer.generate_graphs-2092"><a href="#Analyzer.generate_graphs-2092"><span class="linenos">2092</span></a>            <span class="n">key</span> <span class="o">=</span> <span class="s1">&#39;tra&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
</span><span id="Analyzer.generate_graphs-2093"><a href="#Analyzer.generate_graphs-2093"><span class="linenos">2093</span></a>            <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;Traffic Regime Analysis for &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;address&#39;</span><span class="p">])</span>
</span><span id="Analyzer.generate_graphs-2094"><a href="#Analyzer.generate_graphs-2094"><span class="linenos">2094</span></a>            <span class="n">short_title</span> <span class="o">=</span> <span class="n">title</span>
</span><span id="Analyzer.generate_graphs-2095"><a href="#Analyzer.generate_graphs-2095"><span class="linenos">2095</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">graph_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="p">{</span><span class="s2">&quot;GRAPH&quot;</span><span class="p">:</span> <span class="n">key</span><span class="p">,</span>
</span><span id="Analyzer.generate_graphs-2096"><a href="#Analyzer.generate_graphs-2096"><span class="linenos">2096</span></a>                                    <span class="s2">&quot;TITLE&quot;</span><span class="p">:</span> <span class="n">short_title</span><span class="p">,</span>
</span><span id="Analyzer.generate_graphs-2097"><a href="#Analyzer.generate_graphs-2097"><span class="linenos">2097</span></a>                                    <span class="s2">&quot;FILENAME&quot;</span><span class="p">:</span> <span class="n">key</span><span class="o">+</span><span class="s2">&quot;.png&quot;</span><span class="p">,</span>
</span><span id="Analyzer.generate_graphs-2098"><a href="#Analyzer.generate_graphs-2098"><span class="linenos">2098</span></a>                                    <span class="s2">&quot;PLOT-DESCRIPTION&quot;</span><span class="p">:</span> <span class="s2">&quot;This pie chart outlines the percentage of employees that are in each traffic regime for commute to &quot;</span> <span class="o">+</span> \
</span><span id="Analyzer.generate_graphs-2099"><a href="#Analyzer.generate_graphs-2099"><span class="linenos">2099</span></a>                                    <span class="nb">str</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;address&#39;</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot; for each day of the week.&quot;</span>
</span><span id="Analyzer.generate_graphs-2100"><a href="#Analyzer.generate_graphs-2100"><span class="linenos">2100</span></a>                                    <span class="p">})</span>
</span><span id="Analyzer.generate_graphs-2101"><a href="#Analyzer.generate_graphs-2101"><span class="linenos">2101</span></a>            
</span><span id="Analyzer.generate_graphs-2102"><a href="#Analyzer.generate_graphs-2102"><span class="linenos">2102</span></a>            <span class="k">if</span> <span class="n">graph</span> <span class="o">==</span> <span class="s2">&quot;_all&quot;</span> <span class="ow">or</span> <span class="n">graph</span> <span class="o">==</span> <span class="n">key</span><span class="p">:</span>
</span><span id="Analyzer.generate_graphs-2103"><a href="#Analyzer.generate_graphs-2103"><span class="linenos">2103</span></a>                
</span><span id="Analyzer.generate_graphs-2104"><a href="#Analyzer.generate_graphs-2104"><span class="linenos">2104</span></a>                <span class="n">office</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">to_frame</span><span class="p">()</span><span class="o">.</span><span class="n">T</span>
</span><span id="Analyzer.generate_graphs-2105"><a href="#Analyzer.generate_graphs-2105"><span class="linenos">2105</span></a>                
</span><span id="Analyzer.generate_graphs-2106"><a href="#Analyzer.generate_graphs-2106"><span class="linenos">2106</span></a>                <span class="c1"># get the needed commute values</span>
</span><span id="Analyzer.generate_graphs-2107"><a href="#Analyzer.generate_graphs-2107"><span class="linenos">2107</span></a>                <span class="n">values</span> <span class="o">=</span> <span class="n">commute_data</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span>
</span><span id="Analyzer.generate_graphs-2108"><a href="#Analyzer.generate_graphs-2108"><span class="linenos">2108</span></a>                <span class="c1"># filter teh employees to only those within the cutoff distance</span>
</span><span id="Analyzer.generate_graphs-2109"><a href="#Analyzer.generate_graphs-2109"><span class="linenos">2109</span></a>                <span class="n">emp_within</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graphing</span><span class="o">.</span><span class="n">filter_drive_distance</span><span class="p">(</span><span class="n">emp</span><span class="p">,</span><span class="n">office</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">commute_range_cut_off</span><span class="p">,</span> <span class="n">commute_data</span><span class="o">=</span><span class="n">commute_data</span><span class="p">)</span>
</span><span id="Analyzer.generate_graphs-2110"><a href="#Analyzer.generate_graphs-2110"><span class="linenos">2110</span></a>                <span class="n">val_set</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graphing</span><span class="o">.</span><span class="n">get_commute_values</span><span class="p">(</span><span class="n">emp_within</span><span class="p">,</span> <span class="n">office</span><span class="p">,</span> <span class="n">commute_data</span><span class="p">,</span> <span class="n">values</span><span class="p">)</span>
</span><span id="Analyzer.generate_graphs-2111"><a href="#Analyzer.generate_graphs-2111"><span class="linenos">2111</span></a>                <span class="c1"># restore val_set columns latitutde and longitude to origin_lat and origin_long</span>
</span><span id="Analyzer.generate_graphs-2112"><a href="#Analyzer.generate_graphs-2112"><span class="linenos">2112</span></a>                <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;origin_lat&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;latitude&#39;</span><span class="p">]</span>
</span><span id="Analyzer.generate_graphs-2113"><a href="#Analyzer.generate_graphs-2113"><span class="linenos">2113</span></a>                <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;origin_long&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;longitude&#39;</span><span class="p">]</span>
</span><span id="Analyzer.generate_graphs-2114"><a href="#Analyzer.generate_graphs-2114"><span class="linenos">2114</span></a>
</span><span id="Analyzer.generate_graphs-2115"><a href="#Analyzer.generate_graphs-2115"><span class="linenos">2115</span></a>                <span class="c1"># for each employee, for each day&#39;s morning and evening commute, get the traffic regime</span>
</span><span id="Analyzer.generate_graphs-2116"><a href="#Analyzer.generate_graphs-2116"><span class="linenos">2116</span></a>                <span class="c1"># add the traffic regime to the val_set dataframe</span>
</span><span id="Analyzer.generate_graphs-2117"><a href="#Analyzer.generate_graphs-2117"><span class="linenos">2117</span></a>                
</span><span id="Analyzer.generate_graphs-2118"><a href="#Analyzer.generate_graphs-2118"><span class="linenos">2118</span></a>                <span class="c1"># lambda to call get_traffic_regime(distance, duration_in_traffic) using distance and duration_in_traffic columns</span>
</span><span id="Analyzer.generate_graphs-2119"><a href="#Analyzer.generate_graphs-2119"><span class="linenos">2119</span></a>                <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;m_morning_traffic_regime&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">val_set</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_traffic_regime</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;miles&#39;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;m_morning_duration_in_traffic&#39;</span><span class="p">]),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="Analyzer.generate_graphs-2120"><a href="#Analyzer.generate_graphs-2120"><span class="linenos">2120</span></a>                <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;m_evening_traffic_regime&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">val_set</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_traffic_regime</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;miles&#39;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;m_evening_duration_in_traffic&#39;</span><span class="p">]),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="Analyzer.generate_graphs-2121"><a href="#Analyzer.generate_graphs-2121"><span class="linenos">2121</span></a>                <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;t_morning_traffic_regime&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">val_set</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_traffic_regime</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;miles&#39;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;t_morning_duration_in_traffic&#39;</span><span class="p">]),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="Analyzer.generate_graphs-2122"><a href="#Analyzer.generate_graphs-2122"><span class="linenos">2122</span></a>                <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;t_evening_traffic_regime&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">val_set</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_traffic_regime</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;miles&#39;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;t_evening_duration_in_traffic&#39;</span><span class="p">]),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="Analyzer.generate_graphs-2123"><a href="#Analyzer.generate_graphs-2123"><span class="linenos">2123</span></a>                <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;w_morning_traffic_regime&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">val_set</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_traffic_regime</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;miles&#39;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;w_morning_duration_in_traffic&#39;</span><span class="p">]),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="Analyzer.generate_graphs-2124"><a href="#Analyzer.generate_graphs-2124"><span class="linenos">2124</span></a>                <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;w_evening_traffic_regime&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">val_set</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_traffic_regime</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;miles&#39;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;w_evening_duration_in_traffic&#39;</span><span class="p">]),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="Analyzer.generate_graphs-2125"><a href="#Analyzer.generate_graphs-2125"><span class="linenos">2125</span></a>                <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;h_morning_traffic_regime&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">val_set</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_traffic_regime</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;miles&#39;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;h_morning_duration_in_traffic&#39;</span><span class="p">]),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="Analyzer.generate_graphs-2126"><a href="#Analyzer.generate_graphs-2126"><span class="linenos">2126</span></a>                <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;h_evening_traffic_regime&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">val_set</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_traffic_regime</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;miles&#39;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;h_evening_duration_in_traffic&#39;</span><span class="p">]),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="Analyzer.generate_graphs-2127"><a href="#Analyzer.generate_graphs-2127"><span class="linenos">2127</span></a>                <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;f_morning_traffic_regime&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">val_set</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_traffic_regime</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;miles&#39;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;f_morning_duration_in_traffic&#39;</span><span class="p">]),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="Analyzer.generate_graphs-2128"><a href="#Analyzer.generate_graphs-2128"><span class="linenos">2128</span></a>                <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;f_evening_traffic_regime&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">val_set</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_traffic_regime</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;miles&#39;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;f_evening_duration_in_traffic&#39;</span><span class="p">]),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="Analyzer.generate_graphs-2129"><a href="#Analyzer.generate_graphs-2129"><span class="linenos">2129</span></a>
</span><span id="Analyzer.generate_graphs-2130"><a href="#Analyzer.generate_graphs-2130"><span class="linenos">2130</span></a>                <span class="c1"># save val_set to file for debugging</span>
</span><span id="Analyzer.generate_graphs-2131"><a href="#Analyzer.generate_graphs-2131"><span class="linenos">2131</span></a>            
</span><span id="Analyzer.generate_graphs-2132"><a href="#Analyzer.generate_graphs-2132"><span class="linenos">2132</span></a>                <span class="c1"># get the counts of each traffic regime for each office</span>
</span><span id="Analyzer.generate_graphs-2133"><a href="#Analyzer.generate_graphs-2133"><span class="linenos">2133</span></a>                <span class="n">traffic_graph_keys</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;m_morning_traffic_regime&#39;</span><span class="p">,</span>
</span><span id="Analyzer.generate_graphs-2134"><a href="#Analyzer.generate_graphs-2134"><span class="linenos">2134</span></a>                                        <span class="s1">&#39;t_morning_traffic_regime&#39;</span><span class="p">,</span>
</span><span id="Analyzer.generate_graphs-2135"><a href="#Analyzer.generate_graphs-2135"><span class="linenos">2135</span></a>                                        <span class="s1">&#39;w_morning_traffic_regime&#39;</span><span class="p">,</span>
</span><span id="Analyzer.generate_graphs-2136"><a href="#Analyzer.generate_graphs-2136"><span class="linenos">2136</span></a>                                        <span class="s1">&#39;h_morning_traffic_regime&#39;</span><span class="p">,</span>
</span><span id="Analyzer.generate_graphs-2137"><a href="#Analyzer.generate_graphs-2137"><span class="linenos">2137</span></a>                                        <span class="s1">&#39;f_morning_traffic_regime&#39;</span><span class="p">,</span>
</span><span id="Analyzer.generate_graphs-2138"><a href="#Analyzer.generate_graphs-2138"><span class="linenos">2138</span></a>                                        <span class="s1">&#39;m_evening_traffic_regime&#39;</span><span class="p">,</span>
</span><span id="Analyzer.generate_graphs-2139"><a href="#Analyzer.generate_graphs-2139"><span class="linenos">2139</span></a>                                        <span class="s1">&#39;t_evening_traffic_regime&#39;</span><span class="p">,</span>
</span><span id="Analyzer.generate_graphs-2140"><a href="#Analyzer.generate_graphs-2140"><span class="linenos">2140</span></a>                                        <span class="s1">&#39;w_evening_traffic_regime&#39;</span><span class="p">,</span>
</span><span id="Analyzer.generate_graphs-2141"><a href="#Analyzer.generate_graphs-2141"><span class="linenos">2141</span></a>                                        <span class="s1">&#39;h_evening_traffic_regime&#39;</span><span class="p">,</span>
</span><span id="Analyzer.generate_graphs-2142"><a href="#Analyzer.generate_graphs-2142"><span class="linenos">2142</span></a>                                        <span class="s1">&#39;f_evening_traffic_regime&#39;</span><span class="p">]</span>
</span><span id="Analyzer.generate_graphs-2143"><a href="#Analyzer.generate_graphs-2143"><span class="linenos">2143</span></a>                
</span><span id="Analyzer.generate_graphs-2144"><a href="#Analyzer.generate_graphs-2144"><span class="linenos">2144</span></a>                <span class="n">traffic_graphs_nice_names</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;m_morning_traffic_regime&quot;</span><span class="p">:</span><span class="s2">&quot;Monday Morning&quot;</span><span class="p">,</span>
</span><span id="Analyzer.generate_graphs-2145"><a href="#Analyzer.generate_graphs-2145"><span class="linenos">2145</span></a>                                             <span class="s2">&quot;t_morning_traffic_regime&quot;</span><span class="p">:</span><span class="s2">&quot;Tuesday Morning&quot;</span><span class="p">,</span>
</span><span id="Analyzer.generate_graphs-2146"><a href="#Analyzer.generate_graphs-2146"><span class="linenos">2146</span></a>                                             <span class="s2">&quot;w_morning_traffic_regime&quot;</span><span class="p">:</span><span class="s2">&quot;Wednesday Morning&quot;</span><span class="p">,</span>
</span><span id="Analyzer.generate_graphs-2147"><a href="#Analyzer.generate_graphs-2147"><span class="linenos">2147</span></a>                                             <span class="s2">&quot;h_morning_traffic_regime&quot;</span><span class="p">:</span><span class="s2">&quot;Thursday Morning&quot;</span><span class="p">,</span>
</span><span id="Analyzer.generate_graphs-2148"><a href="#Analyzer.generate_graphs-2148"><span class="linenos">2148</span></a>                                             <span class="s2">&quot;f_morning_traffic_regime&quot;</span><span class="p">:</span><span class="s2">&quot;Friday Morning&quot;</span><span class="p">,</span>
</span><span id="Analyzer.generate_graphs-2149"><a href="#Analyzer.generate_graphs-2149"><span class="linenos">2149</span></a>                                             <span class="s2">&quot;m_evening_traffic_regime&quot;</span><span class="p">:</span><span class="s2">&quot;Monday Evening&quot;</span><span class="p">,</span>
</span><span id="Analyzer.generate_graphs-2150"><a href="#Analyzer.generate_graphs-2150"><span class="linenos">2150</span></a>                                             <span class="s2">&quot;t_evening_traffic_regime&quot;</span><span class="p">:</span><span class="s2">&quot;Tuesday Evening&quot;</span><span class="p">,</span>
</span><span id="Analyzer.generate_graphs-2151"><a href="#Analyzer.generate_graphs-2151"><span class="linenos">2151</span></a>                                             <span class="s2">&quot;w_evening_traffic_regime&quot;</span><span class="p">:</span><span class="s2">&quot;Wednesday Evening&quot;</span><span class="p">,</span>
</span><span id="Analyzer.generate_graphs-2152"><a href="#Analyzer.generate_graphs-2152"><span class="linenos">2152</span></a>                                             <span class="s2">&quot;h_evening_traffic_regime&quot;</span><span class="p">:</span><span class="s2">&quot;Thursday Evening&quot;</span><span class="p">,</span>
</span><span id="Analyzer.generate_graphs-2153"><a href="#Analyzer.generate_graphs-2153"><span class="linenos">2153</span></a>                                             <span class="s2">&quot;f_evening_traffic_regime&quot;</span><span class="p">:</span><span class="s2">&quot;Friday Evening&quot;</span><span class="p">}</span>
</span><span id="Analyzer.generate_graphs-2154"><a href="#Analyzer.generate_graphs-2154"><span class="linenos">2154</span></a>                
</span><span id="Analyzer.generate_graphs-2155"><a href="#Analyzer.generate_graphs-2155"><span class="linenos">2155</span></a>                <span class="n">traffic_regimes</span> <span class="o">=</span> <span class="p">{</span><span class="mi">1</span><span class="p">:</span><span class="s2">&quot;Congested&quot;</span><span class="p">,</span><span class="mi">2</span><span class="p">:</span><span class="s2">&quot;Bounded&quot;</span><span class="p">,</span><span class="mi">3</span><span class="p">:</span><span class="s2">&quot;Free Flow&quot;</span><span class="p">}</span>
</span><span id="Analyzer.generate_graphs-2156"><a href="#Analyzer.generate_graphs-2156"><span class="linenos">2156</span></a>
</span><span id="Analyzer.generate_graphs-2157"><a href="#Analyzer.generate_graphs-2157"><span class="linenos">2157</span></a>                <span class="c1"># create a dictionary to hold the traffic regime counts for each day and morning/evening</span>
</span><span id="Analyzer.generate_graphs-2158"><a href="#Analyzer.generate_graphs-2158"><span class="linenos">2158</span></a>                <span class="n">traffic_regime_counts</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="Analyzer.generate_graphs-2159"><a href="#Analyzer.generate_graphs-2159"><span class="linenos">2159</span></a>                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">traffic_graph_keys</span><span class="p">:</span>
</span><span id="Analyzer.generate_graphs-2160"><a href="#Analyzer.generate_graphs-2160"><span class="linenos">2160</span></a>                    <span class="n">traffic_regime_counts</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">val_set</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>
</span><span id="Analyzer.generate_graphs-2161"><a href="#Analyzer.generate_graphs-2161"><span class="linenos">2161</span></a>                    <span class="c1"># sort the dictionary by key</span>
</span><span id="Analyzer.generate_graphs-2162"><a href="#Analyzer.generate_graphs-2162"><span class="linenos">2162</span></a>                    <span class="n">traffic_regime_counts</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">traffic_regime_counts</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">()))</span>
</span><span id="Analyzer.generate_graphs-2163"><a href="#Analyzer.generate_graphs-2163"><span class="linenos">2163</span></a>
</span><span id="Analyzer.generate_graphs-2164"><a href="#Analyzer.generate_graphs-2164"><span class="linenos">2164</span></a>                <span class="c1"># traffic_regime_counts now holds: </span>
</span><span id="Analyzer.generate_graphs-2165"><a href="#Analyzer.generate_graphs-2165"><span class="linenos">2165</span></a>                <span class="c1"># {&#39;m_morning_traffic_regime&#39;: {1: 1539, 2: 424}, &#39;t_morning_traffic_regime&#39;: {1: 1863, 2: 100}, &#39;w_morning_traffic_regime&#39;: {1: 1874, 2: 89}, &#39;h_morning_traffic_regime&#39;: {1: 1824, 2: 139}, &#39;f_morning_traffic_regime&#39;: {1: 1348, 2: 615}, &#39;m_evening_traffic_regime&#39;: {1: 1711, 2: 252}, &#39;t_evening_traffic_regime&#39;: {1: 1826, 2: 137}, &#39;w_evening_traffic_regime&#39;: {1: 1888, 2: 75}, &#39;h_evening_traffic_regime&#39;: {1: 1878, 2: 85}, &#39;f_evening_traffic_regime&#39;: {1: 1704, 2: 259}}</span>
</span><span id="Analyzer.generate_graphs-2166"><a href="#Analyzer.generate_graphs-2166"><span class="linenos">2166</span></a>                
</span><span id="Analyzer.generate_graphs-2167"><a href="#Analyzer.generate_graphs-2167"><span class="linenos">2167</span></a>                <span class="c1"># create a values variable holding a list of the traffic regime counts for each day and morning/evening</span>
</span><span id="Analyzer.generate_graphs-2168"><a href="#Analyzer.generate_graphs-2168"><span class="linenos">2168</span></a>                <span class="n">values</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Analyzer.generate_graphs-2169"><a href="#Analyzer.generate_graphs-2169"><span class="linenos">2169</span></a>                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">traffic_graph_keys</span><span class="p">:</span>
</span><span id="Analyzer.generate_graphs-2170"><a href="#Analyzer.generate_graphs-2170"><span class="linenos">2170</span></a>                    <span class="n">values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">traffic_regime_counts</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span>
</span><span id="Analyzer.generate_graphs-2171"><a href="#Analyzer.generate_graphs-2171"><span class="linenos">2171</span></a>
</span><span id="Analyzer.generate_graphs-2172"><a href="#Analyzer.generate_graphs-2172"><span class="linenos">2172</span></a>                <span class="c1"># iterate through traffic regime counts and create a list of labels for each day and morning/evening for regimes where counts are present</span>
</span><span id="Analyzer.generate_graphs-2173"><a href="#Analyzer.generate_graphs-2173"><span class="linenos">2173</span></a>                <span class="n">labels</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Analyzer.generate_graphs-2174"><a href="#Analyzer.generate_graphs-2174"><span class="linenos">2174</span></a>                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">traffic_graph_keys</span><span class="p">:</span>
</span><span id="Analyzer.generate_graphs-2175"><a href="#Analyzer.generate_graphs-2175"><span class="linenos">2175</span></a>                    <span class="n">label</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Analyzer.generate_graphs-2176"><a href="#Analyzer.generate_graphs-2176"><span class="linenos">2176</span></a>                    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">traffic_regime_counts</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
</span><span id="Analyzer.generate_graphs-2177"><a href="#Analyzer.generate_graphs-2177"><span class="linenos">2177</span></a>                        <span class="n">label</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">traffic_regimes</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
</span><span id="Analyzer.generate_graphs-2178"><a href="#Analyzer.generate_graphs-2178"><span class="linenos">2178</span></a>                    <span class="n">labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>
</span><span id="Analyzer.generate_graphs-2179"><a href="#Analyzer.generate_graphs-2179"><span class="linenos">2179</span></a>                
</span><span id="Analyzer.generate_graphs-2180"><a href="#Analyzer.generate_graphs-2180"><span class="linenos">2180</span></a>                <span class="c1"># iterate through the labels and get the colors for each traffic regime colors(i+1) will return a color for each regime</span>
</span><span id="Analyzer.generate_graphs-2181"><a href="#Analyzer.generate_graphs-2181"><span class="linenos">2181</span></a>                <span class="n">colors_list</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Analyzer.generate_graphs-2182"><a href="#Analyzer.generate_graphs-2182"><span class="linenos">2182</span></a>                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">labels</span><span class="p">)):</span>
</span><span id="Analyzer.generate_graphs-2183"><a href="#Analyzer.generate_graphs-2183"><span class="linenos">2183</span></a>                    <span class="n">color_list</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Analyzer.generate_graphs-2184"><a href="#Analyzer.generate_graphs-2184"><span class="linenos">2184</span></a>                    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">labels</span><span class="p">[</span><span class="n">i</span><span class="p">])):</span>
</span><span id="Analyzer.generate_graphs-2185"><a href="#Analyzer.generate_graphs-2185"><span class="linenos">2185</span></a>                        <span class="n">color_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">colors</span><span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="mi">7</span><span class="p">))</span>
</span><span id="Analyzer.generate_graphs-2186"><a href="#Analyzer.generate_graphs-2186"><span class="linenos">2186</span></a>                    <span class="n">colors_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">color_list</span><span class="p">)</span>
</span><span id="Analyzer.generate_graphs-2187"><a href="#Analyzer.generate_graphs-2187"><span class="linenos">2187</span></a>                
</span><span id="Analyzer.generate_graphs-2188"><a href="#Analyzer.generate_graphs-2188"><span class="linenos">2188</span></a>                <span class="c1"># create a titles variable holding a list of the traffic graph nice names</span>
</span><span id="Analyzer.generate_graphs-2189"><a href="#Analyzer.generate_graphs-2189"><span class="linenos">2189</span></a>                <span class="n">titles</span> <span class="o">=</span> <span class="p">[</span><span class="n">traffic_graphs_nice_names</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">traffic_graph_keys</span><span class="p">]</span>
</span><span id="Analyzer.generate_graphs-2190"><a href="#Analyzer.generate_graphs-2190"><span class="linenos">2190</span></a>                <span class="n">rows</span> <span class="o">=</span> <span class="mi">2</span>
</span><span id="Analyzer.generate_graphs-2191"><a href="#Analyzer.generate_graphs-2191"><span class="linenos">2191</span></a>                <span class="n">cols</span> <span class="o">=</span> <span class="mi">5</span>
</span><span id="Analyzer.generate_graphs-2192"><a href="#Analyzer.generate_graphs-2192"><span class="linenos">2192</span></a>                <span class="c1"># create a composite pie chart, five wide, with rows for morning and evening.  Each pie chart will display three values, Congested, Bounded, Free Flow</span>
</span><span id="Analyzer.generate_graphs-2193"><a href="#Analyzer.generate_graphs-2193"><span class="linenos">2193</span></a>                <span class="n">plt</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graphing</span><span class="o">.</span><span class="n">get_piechart</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="n">titles</span><span class="o">=</span><span class="n">titles</span><span class="p">,</span> <span class="n">suptitle</span><span class="o">=</span><span class="n">title</span><span class="p">,</span> <span class="n">value_labels</span><span class="o">=</span><span class="n">labels</span><span class="p">,</span> 
</span><span id="Analyzer.generate_graphs-2194"><a href="#Analyzer.generate_graphs-2194"><span class="linenos">2194</span></a>                                                    <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">21</span><span class="p">,</span><span class="mi">7</span><span class="p">),</span> <span class="n">manual_plot</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">font_mod</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">rows</span><span class="o">=</span><span class="n">rows</span><span class="p">,</span> <span class="n">cols</span><span class="o">=</span><span class="n">cols</span><span class="p">,</span> <span class="n">startangle</span><span class="o">=</span><span class="mi">70</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="n">colors_list</span><span class="p">)</span>
</span><span id="Analyzer.generate_graphs-2195"><a href="#Analyzer.generate_graphs-2195"><span class="linenos">2195</span></a>                <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">(</span><span class="n">pad</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">w_pad</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">h_pad</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="Analyzer.generate_graphs-2196"><a href="#Analyzer.generate_graphs-2196"><span class="linenos">2196</span></a>                <span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">top</span><span class="o">=</span><span class="mf">0.85</span><span class="p">)</span>
</span><span id="Analyzer.generate_graphs-2197"><a href="#Analyzer.generate_graphs-2197"><span class="linenos">2197</span></a>                <span class="c1"># mauanlly adjust the font size of suptitle and plot titles</span>
</span><span id="Analyzer.generate_graphs-2198"><a href="#Analyzer.generate_graphs-2198"><span class="linenos">2198</span></a>                <span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">25</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">)</span>
</span><span id="Analyzer.generate_graphs-2199"><a href="#Analyzer.generate_graphs-2199"><span class="linenos">2199</span></a>                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">rows</span><span class="p">):</span>
</span><span id="Analyzer.generate_graphs-2200"><a href="#Analyzer.generate_graphs-2200"><span class="linenos">2200</span></a>                    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">cols</span><span class="p">):</span>
</span><span id="Analyzer.generate_graphs-2201"><a href="#Analyzer.generate_graphs-2201"><span class="linenos">2201</span></a>                        <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">title</span><span class="o">.</span><span class="n">set_fontsize</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>
</span><span id="Analyzer.generate_graphs-2202"><a href="#Analyzer.generate_graphs-2202"><span class="linenos">2202</span></a>                        <span class="c1"># set bold</span>
</span><span id="Analyzer.generate_graphs-2203"><a href="#Analyzer.generate_graphs-2203"><span class="linenos">2203</span></a>                        <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">title</span><span class="o">.</span><span class="n">set_fontweight</span><span class="p">(</span><span class="s1">&#39;bold&#39;</span><span class="p">)</span>
</span><span id="Analyzer.generate_graphs-2204"><a href="#Analyzer.generate_graphs-2204"><span class="linenos">2204</span></a>                
</span><span id="Analyzer.generate_graphs-2205"><a href="#Analyzer.generate_graphs-2205"><span class="linenos">2205</span></a>                <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">plots_dir</span><span class="o">+</span><span class="s2">&quot;/&quot;</span><span class="o">+</span><span class="n">key</span><span class="o">+</span><span class="s2">&quot;.png&quot;</span><span class="p">)</span>
</span><span id="Analyzer.generate_graphs-2206"><a href="#Analyzer.generate_graphs-2206"><span class="linenos">2206</span></a>                <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="Analyzer.generate_graphs-2207"><a href="#Analyzer.generate_graphs-2207"><span class="linenos">2207</span></a>                
</span><span id="Analyzer.generate_graphs-2208"><a href="#Analyzer.generate_graphs-2208"><span class="linenos">2208</span></a>
</span><span id="Analyzer.generate_graphs-2209"><a href="#Analyzer.generate_graphs-2209"><span class="linenos">2209</span></a>        <span class="c1">################################################################################</span>
</span><span id="Analyzer.generate_graphs-2210"><a href="#Analyzer.generate_graphs-2210"><span class="linenos">2210</span></a>        <span class="c1">### GRAPH SET: Local Analysis for Office X</span>
</span><span id="Analyzer.generate_graphs-2211"><a href="#Analyzer.generate_graphs-2211"><span class="linenos">2211</span></a>        <span class="c1"># iterate through offices, generate a graph for each office</span>
</span><span id="Analyzer.generate_graphs-2212"><a href="#Analyzer.generate_graphs-2212"><span class="linenos">2212</span></a>        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">offices</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>    
</span><span id="Analyzer.generate_graphs-2213"><a href="#Analyzer.generate_graphs-2213"><span class="linenos">2213</span></a>            <span class="c1">################################################################################ </span>
</span><span id="Analyzer.generate_graphs-2214"><a href="#Analyzer.generate_graphs-2214"><span class="linenos">2214</span></a>            <span class="c1"># GRAPH: </span>
</span><span id="Analyzer.generate_graphs-2215"><a href="#Analyzer.generate_graphs-2215"><span class="linenos">2215</span></a>            <span class="c1">## Worst Case Emissions Rate Heat Map Analysis</span>
</span><span id="Analyzer.generate_graphs-2216"><a href="#Analyzer.generate_graphs-2216"><span class="linenos">2216</span></a>            <span class="n">key</span> <span class="o">=</span> <span class="s1">&#39;wcerhma&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
</span><span id="Analyzer.generate_graphs-2217"><a href="#Analyzer.generate_graphs-2217"><span class="linenos">2217</span></a>            <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;Worst Case Emissions Rate Heat Map Analysis for &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;address&#39;</span><span class="p">])</span>
</span><span id="Analyzer.generate_graphs-2218"><a href="#Analyzer.generate_graphs-2218"><span class="linenos">2218</span></a>            <span class="n">short_title</span> <span class="o">=</span> <span class="n">title</span>
</span><span id="Analyzer.generate_graphs-2219"><a href="#Analyzer.generate_graphs-2219"><span class="linenos">2219</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">graph_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="p">{</span><span class="s2">&quot;GRAPH&quot;</span><span class="p">:</span> <span class="n">key</span><span class="p">,</span>
</span><span id="Analyzer.generate_graphs-2220"><a href="#Analyzer.generate_graphs-2220"><span class="linenos">2220</span></a>                                    <span class="s2">&quot;TITLE&quot;</span><span class="p">:</span> <span class="n">short_title</span><span class="p">,</span>
</span><span id="Analyzer.generate_graphs-2221"><a href="#Analyzer.generate_graphs-2221"><span class="linenos">2221</span></a>                                    <span class="s2">&quot;FILENAME&quot;</span><span class="p">:</span> <span class="n">key</span><span class="o">+</span><span class="s2">&quot;.png&quot;</span><span class="p">,</span>
</span><span id="Analyzer.generate_graphs-2222"><a href="#Analyzer.generate_graphs-2222"><span class="linenos">2222</span></a>                                    <span class="s2">&quot;PLOT-DESCRIPTION&quot;</span><span class="p">:</span> <span class="s2">&quot;This heat map displays the representative worst case emissions rates for each office option. &quot;</span>
</span><span id="Analyzer.generate_graphs-2223"><a href="#Analyzer.generate_graphs-2223"><span class="linenos">2223</span></a>                                    <span class="p">})</span>
</span><span id="Analyzer.generate_graphs-2224"><a href="#Analyzer.generate_graphs-2224"><span class="linenos">2224</span></a>            
</span><span id="Analyzer.generate_graphs-2225"><a href="#Analyzer.generate_graphs-2225"><span class="linenos">2225</span></a>            <span class="k">if</span> <span class="n">graph</span> <span class="o">==</span> <span class="s2">&quot;_all&quot;</span> <span class="ow">or</span> <span class="n">graph</span> <span class="o">==</span> <span class="n">key</span><span class="p">:</span>
</span><span id="Analyzer.generate_graphs-2226"><a href="#Analyzer.generate_graphs-2226"><span class="linenos">2226</span></a>                <span class="n">office</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">to_frame</span><span class="p">()</span><span class="o">.</span><span class="n">T</span>
</span><span id="Analyzer.generate_graphs-2227"><a href="#Analyzer.generate_graphs-2227"><span class="linenos">2227</span></a>                <span class="c1"># get the needed commute values</span>
</span><span id="Analyzer.generate_graphs-2228"><a href="#Analyzer.generate_graphs-2228"><span class="linenos">2228</span></a>                <span class="n">values</span> <span class="o">=</span> <span class="n">commute_data</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span>
</span><span id="Analyzer.generate_graphs-2229"><a href="#Analyzer.generate_graphs-2229"><span class="linenos">2229</span></a>                <span class="c1"># filter teh employees to only those within the cutoff distance</span>
</span><span id="Analyzer.generate_graphs-2230"><a href="#Analyzer.generate_graphs-2230"><span class="linenos">2230</span></a>                <span class="n">emp_within</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graphing</span><span class="o">.</span><span class="n">filter_drive_distance</span><span class="p">(</span><span class="n">emp</span><span class="p">,</span><span class="n">office</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">commute_range_cut_off</span><span class="p">,</span> <span class="n">commute_data</span><span class="o">=</span><span class="n">commute_data</span><span class="p">)</span>
</span><span id="Analyzer.generate_graphs-2231"><a href="#Analyzer.generate_graphs-2231"><span class="linenos">2231</span></a>                <span class="n">val_set</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graphing</span><span class="o">.</span><span class="n">get_commute_values</span><span class="p">(</span><span class="n">emp_within</span><span class="p">,</span> <span class="n">office</span><span class="p">,</span> <span class="n">commute_data</span><span class="p">,</span> <span class="n">values</span><span class="p">)</span>
</span><span id="Analyzer.generate_graphs-2232"><a href="#Analyzer.generate_graphs-2232"><span class="linenos">2232</span></a>                <span class="c1"># restore val_set columns latitutde and longitude to origin_lat and origin_long</span>
</span><span id="Analyzer.generate_graphs-2233"><a href="#Analyzer.generate_graphs-2233"><span class="linenos">2233</span></a>                <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;origin_lat&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;latitude&#39;</span><span class="p">]</span>
</span><span id="Analyzer.generate_graphs-2234"><a href="#Analyzer.generate_graphs-2234"><span class="linenos">2234</span></a>                <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;origin_long&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;longitude&#39;</span><span class="p">]</span>
</span><span id="Analyzer.generate_graphs-2235"><a href="#Analyzer.generate_graphs-2235"><span class="linenos">2235</span></a>
</span><span id="Analyzer.generate_graphs-2236"><a href="#Analyzer.generate_graphs-2236"><span class="linenos">2236</span></a>                <span class="n">traffic_graph_keys</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;m_morning_emissions&#39;</span><span class="p">,</span>
</span><span id="Analyzer.generate_graphs-2237"><a href="#Analyzer.generate_graphs-2237"><span class="linenos">2237</span></a>                                        <span class="s1">&#39;t_morning_emissions&#39;</span><span class="p">,</span>
</span><span id="Analyzer.generate_graphs-2238"><a href="#Analyzer.generate_graphs-2238"><span class="linenos">2238</span></a>                                        <span class="s1">&#39;w_morning_emissions&#39;</span><span class="p">,</span>
</span><span id="Analyzer.generate_graphs-2239"><a href="#Analyzer.generate_graphs-2239"><span class="linenos">2239</span></a>                                        <span class="s1">&#39;h_morning_emissions&#39;</span><span class="p">,</span>
</span><span id="Analyzer.generate_graphs-2240"><a href="#Analyzer.generate_graphs-2240"><span class="linenos">2240</span></a>                                        <span class="s1">&#39;f_morning_emissions&#39;</span><span class="p">,</span>
</span><span id="Analyzer.generate_graphs-2241"><a href="#Analyzer.generate_graphs-2241"><span class="linenos">2241</span></a>                                        <span class="s1">&#39;m_evening_emissions&#39;</span><span class="p">,</span>
</span><span id="Analyzer.generate_graphs-2242"><a href="#Analyzer.generate_graphs-2242"><span class="linenos">2242</span></a>                                        <span class="s1">&#39;t_evening_emissions&#39;</span><span class="p">,</span>
</span><span id="Analyzer.generate_graphs-2243"><a href="#Analyzer.generate_graphs-2243"><span class="linenos">2243</span></a>                                        <span class="s1">&#39;w_evening_emissions&#39;</span><span class="p">,</span>
</span><span id="Analyzer.generate_graphs-2244"><a href="#Analyzer.generate_graphs-2244"><span class="linenos">2244</span></a>                                        <span class="s1">&#39;h_evening_emissions&#39;</span><span class="p">,</span>
</span><span id="Analyzer.generate_graphs-2245"><a href="#Analyzer.generate_graphs-2245"><span class="linenos">2245</span></a>                                        <span class="s1">&#39;f_evening_emissions&#39;</span><span class="p">]</span>
</span><span id="Analyzer.generate_graphs-2246"><a href="#Analyzer.generate_graphs-2246"><span class="linenos">2246</span></a>                
</span><span id="Analyzer.generate_graphs-2247"><a href="#Analyzer.generate_graphs-2247"><span class="linenos">2247</span></a>                <span class="n">traffic_graphs_nice_names</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;m_morning_emissions&quot;</span><span class="p">:</span><span class="s2">&quot;Monday Morning&quot;</span><span class="p">,</span>
</span><span id="Analyzer.generate_graphs-2248"><a href="#Analyzer.generate_graphs-2248"><span class="linenos">2248</span></a>                                             <span class="s2">&quot;t_morning_emissions&quot;</span><span class="p">:</span><span class="s2">&quot;Tuesday Morning&quot;</span><span class="p">,</span>
</span><span id="Analyzer.generate_graphs-2249"><a href="#Analyzer.generate_graphs-2249"><span class="linenos">2249</span></a>                                             <span class="s2">&quot;w_morning_emissions&quot;</span><span class="p">:</span><span class="s2">&quot;Wednesday Morning&quot;</span><span class="p">,</span>
</span><span id="Analyzer.generate_graphs-2250"><a href="#Analyzer.generate_graphs-2250"><span class="linenos">2250</span></a>                                             <span class="s2">&quot;h_morning_emissions&quot;</span><span class="p">:</span><span class="s2">&quot;Thursday Morning&quot;</span><span class="p">,</span>
</span><span id="Analyzer.generate_graphs-2251"><a href="#Analyzer.generate_graphs-2251"><span class="linenos">2251</span></a>                                             <span class="s2">&quot;f_morning_emissions&quot;</span><span class="p">:</span><span class="s2">&quot;Friday Morning&quot;</span><span class="p">,</span>
</span><span id="Analyzer.generate_graphs-2252"><a href="#Analyzer.generate_graphs-2252"><span class="linenos">2252</span></a>                                             <span class="s2">&quot;m_evening_emissions&quot;</span><span class="p">:</span><span class="s2">&quot;Monday Evening&quot;</span><span class="p">,</span>
</span><span id="Analyzer.generate_graphs-2253"><a href="#Analyzer.generate_graphs-2253"><span class="linenos">2253</span></a>                                             <span class="s2">&quot;t_evening_emissions&quot;</span><span class="p">:</span><span class="s2">&quot;Tuesday Evening&quot;</span><span class="p">,</span>
</span><span id="Analyzer.generate_graphs-2254"><a href="#Analyzer.generate_graphs-2254"><span class="linenos">2254</span></a>                                             <span class="s2">&quot;w_evening_emissions&quot;</span><span class="p">:</span><span class="s2">&quot;Wednesday Evening&quot;</span><span class="p">,</span>
</span><span id="Analyzer.generate_graphs-2255"><a href="#Analyzer.generate_graphs-2255"><span class="linenos">2255</span></a>                                             <span class="s2">&quot;h_evening_emissions&quot;</span><span class="p">:</span><span class="s2">&quot;Thursday Evening&quot;</span><span class="p">,</span>
</span><span id="Analyzer.generate_graphs-2256"><a href="#Analyzer.generate_graphs-2256"><span class="linenos">2256</span></a>                                             <span class="s2">&quot;f_evening_emissions&quot;</span><span class="p">:</span><span class="s2">&quot;Friday Evening&quot;</span><span class="p">}</span>
</span><span id="Analyzer.generate_graphs-2257"><a href="#Analyzer.generate_graphs-2257"><span class="linenos">2257</span></a>                
</span><span id="Analyzer.generate_graphs-2258"><a href="#Analyzer.generate_graphs-2258"><span class="linenos">2258</span></a>                <span class="c1"># get the sum total emissions for each day and morning/evening</span>
</span><span id="Analyzer.generate_graphs-2259"><a href="#Analyzer.generate_graphs-2259"><span class="linenos">2259</span></a>                <span class="n">emissions</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Analyzer.generate_graphs-2260"><a href="#Analyzer.generate_graphs-2260"><span class="linenos">2260</span></a>                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">traffic_graph_keys</span><span class="p">:</span>
</span><span id="Analyzer.generate_graphs-2261"><a href="#Analyzer.generate_graphs-2261"><span class="linenos">2261</span></a>                    <span class="n">emissions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">val_set</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span>
</span><span id="Analyzer.generate_graphs-2262"><a href="#Analyzer.generate_graphs-2262"><span class="linenos">2262</span></a>
</span><span id="Analyzer.generate_graphs-2263"><a href="#Analyzer.generate_graphs-2263"><span class="linenos">2263</span></a>                <span class="c1"># create a dictionary to hold the emissions for each day and morning/evening</span>
</span><span id="Analyzer.generate_graphs-2264"><a href="#Analyzer.generate_graphs-2264"><span class="linenos">2264</span></a>                <span class="n">emissions_dict</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="Analyzer.generate_graphs-2265"><a href="#Analyzer.generate_graphs-2265"><span class="linenos">2265</span></a>                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">traffic_graph_keys</span><span class="p">)):</span>
</span><span id="Analyzer.generate_graphs-2266"><a href="#Analyzer.generate_graphs-2266"><span class="linenos">2266</span></a>                    <span class="n">emissions_dict</span><span class="p">[</span><span class="n">traffic_graph_keys</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">=</span> <span class="n">emissions</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</span><span id="Analyzer.generate_graphs-2267"><a href="#Analyzer.generate_graphs-2267"><span class="linenos">2267</span></a>                
</span><span id="Analyzer.generate_graphs-2268"><a href="#Analyzer.generate_graphs-2268"><span class="linenos">2268</span></a>
</span><span id="Analyzer.generate_graphs-2269"><a href="#Analyzer.generate_graphs-2269"><span class="linenos">2269</span></a>                <span class="n">plt</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graphing</span><span class="o">.</span><span class="n">get_heatmap</span><span class="p">(</span><span class="n">emp_within</span><span class="p">,</span> <span class="n">office</span><span class="p">,</span> <span class="n">val_set</span><span class="p">,</span> <span class="s2">&quot;w_evening_emissions&quot;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Worst Case Emissions Rate (Wed. Evening)) </span><span class="se">\n</span><span class="s2">for &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;address&#39;</span><span class="p">]),</span> 
</span><span id="Analyzer.generate_graphs-2270"><a href="#Analyzer.generate_graphs-2270"><span class="linenos">2270</span></a>                                                <span class="n">value_label</span><span class="o">=</span><span class="s2">&quot;CO2 Emissions in Traffic (kg/commute)&quot;</span><span class="p">,</span> <span class="n">cutoff_distance</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">commute_range_cut_off</span><span class="p">,</span> 
</span><span id="Analyzer.generate_graphs-2271"><a href="#Analyzer.generate_graphs-2271"><span class="linenos">2271</span></a>                                                <span class="n">commute_radius</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">commute_range_cut_off</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.4</span><span class="p">,</span> <span class="n">levels</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">font_mod</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span> 
</span><span id="Analyzer.generate_graphs-2272"><a href="#Analyzer.generate_graphs-2272"><span class="linenos">2272</span></a>                                                <span class="n">convex_hull</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">plot_points</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">imagery</span><span class="o">=</span><span class="s2">&quot;Google&quot;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gist_heat_r&#39;</span><span class="p">)</span>
</span><span id="Analyzer.generate_graphs-2273"><a href="#Analyzer.generate_graphs-2273"><span class="linenos">2273</span></a>                <span class="c1"># add a text label to the bottom right of the plot with the total emissions for the plotted value</span>
</span><span id="Analyzer.generate_graphs-2274"><a href="#Analyzer.generate_graphs-2274"><span class="linenos">2274</span></a>                <span class="n">t</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;em&#39;</span> <span class="p">:</span> <span class="s1">&#39;Total Emissions / Commute: </span><span class="si">{:.2f}</span><span class="s1"> kg&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">emissions_dict</span><span class="p">[</span><span class="s1">&#39;w_evening_emissions&#39;</span><span class="p">])}</span>    
</span><span id="Analyzer.generate_graphs-2275"><a href="#Analyzer.generate_graphs-2275"><span class="linenos">2275</span></a>                <span class="c1"># add to plot</span>
</span><span id="Analyzer.generate_graphs-2276"><a href="#Analyzer.generate_graphs-2276"><span class="linenos">2276</span></a>                <span class="n">textstr</span> <span class="o">=</span> <span class="n">t</span><span class="p">[</span><span class="s1">&#39;em&#39;</span><span class="p">]</span>                              
</span><span id="Analyzer.generate_graphs-2277"><a href="#Analyzer.generate_graphs-2277"><span class="linenos">2277</span></a>                <span class="c1"># these are matplotlib.patch.Patch properties</span>
</span><span id="Analyzer.generate_graphs-2278"><a href="#Analyzer.generate_graphs-2278"><span class="linenos">2278</span></a>                <span class="n">props</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">boxstyle</span><span class="o">=</span><span class="s1">&#39;round&#39;</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="Analyzer.generate_graphs-2279"><a href="#Analyzer.generate_graphs-2279"><span class="linenos">2279</span></a>                <span class="c1"># place a text box in lower right in axes coords,</span>
</span><span id="Analyzer.generate_graphs-2280"><a href="#Analyzer.generate_graphs-2280"><span class="linenos">2280</span></a>                <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">.985</span><span class="p">,</span> <span class="mf">.015</span><span class="p">,</span> <span class="n">textstr</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">,</span>
</span><span id="Analyzer.generate_graphs-2281"><a href="#Analyzer.generate_graphs-2281"><span class="linenos">2281</span></a>                            <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;bottom&#39;</span><span class="p">,</span> <span class="n">bbox</span><span class="o">=</span><span class="n">props</span><span class="p">,</span> <span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;family&#39;</span><span class="p">:</span> <span class="s1">&#39;monospace&#39;</span><span class="p">},</span> <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">)</span>
</span><span id="Analyzer.generate_graphs-2282"><a href="#Analyzer.generate_graphs-2282"><span class="linenos">2282</span></a>                <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">plots_dir</span><span class="o">+</span><span class="s2">&quot;/&quot;</span><span class="o">+</span><span class="n">key</span><span class="o">+</span><span class="s2">&quot;.png&quot;</span><span class="p">)</span>
</span><span id="Analyzer.generate_graphs-2283"><a href="#Analyzer.generate_graphs-2283"><span class="linenos">2283</span></a>                <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="Analyzer.generate_graphs-2284"><a href="#Analyzer.generate_graphs-2284"><span class="linenos">2284</span></a>                
</span><span id="Analyzer.generate_graphs-2285"><a href="#Analyzer.generate_graphs-2285"><span class="linenos">2285</span></a>        <span class="c1">#TODO : GRAPH THE EMISSIONS FOR EACH OFFICE</span>
</span><span id="Analyzer.generate_graphs-2286"><a href="#Analyzer.generate_graphs-2286"><span class="linenos">2286</span></a>
</span><span id="Analyzer.generate_graphs-2287"><a href="#Analyzer.generate_graphs-2287"><span class="linenos">2287</span></a>
</span><span id="Analyzer.generate_graphs-2288"><a href="#Analyzer.generate_graphs-2288"><span class="linenos">2288</span></a>        <span class="c1">################################################################################ </span>
</span><span id="Analyzer.generate_graphs-2289"><a href="#Analyzer.generate_graphs-2289"><span class="linenos">2289</span></a>        <span class="c1"># GRAPH: </span>
</span><span id="Analyzer.generate_graphs-2290"><a href="#Analyzer.generate_graphs-2290"><span class="linenos">2290</span></a>        <span class="c1">## Total Emissions Cost Differential Analysis</span>
</span><span id="Analyzer.generate_graphs-2291"><a href="#Analyzer.generate_graphs-2291"><span class="linenos">2291</span></a>        <span class="n">key</span> <span class="o">=</span> <span class="s1">&#39;tecdca&#39;</span>
</span><span id="Analyzer.generate_graphs-2292"><a href="#Analyzer.generate_graphs-2292"><span class="linenos">2292</span></a>        <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;Total Emissions Cost Differential Analysis&quot;</span>
</span><span id="Analyzer.generate_graphs-2293"><a href="#Analyzer.generate_graphs-2293"><span class="linenos">2293</span></a>        <span class="n">short_title</span> <span class="o">=</span> <span class="n">title</span>
</span><span id="Analyzer.generate_graphs-2294"><a href="#Analyzer.generate_graphs-2294"><span class="linenos">2294</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">graph_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="p">{</span><span class="s2">&quot;GRAPH&quot;</span><span class="p">:</span> <span class="n">key</span><span class="p">,</span>
</span><span id="Analyzer.generate_graphs-2295"><a href="#Analyzer.generate_graphs-2295"><span class="linenos">2295</span></a>                                <span class="s2">&quot;TITLE&quot;</span><span class="p">:</span> <span class="n">short_title</span><span class="p">,</span>
</span><span id="Analyzer.generate_graphs-2296"><a href="#Analyzer.generate_graphs-2296"><span class="linenos">2296</span></a>                                <span class="s2">&quot;FILENAME&quot;</span><span class="p">:</span> <span class="n">key</span><span class="o">+</span><span class="s2">&quot;.png&quot;</span><span class="p">,</span>
</span><span id="Analyzer.generate_graphs-2297"><a href="#Analyzer.generate_graphs-2297"><span class="linenos">2297</span></a>                                <span class="s2">&quot;PLOT-DESCRIPTION&quot;</span><span class="p">:</span> <span class="s2">&quot;This graph displays the differential cost associated with emissions based on the office options.&quot;</span>
</span><span id="Analyzer.generate_graphs-2298"><a href="#Analyzer.generate_graphs-2298"><span class="linenos">2298</span></a>                                <span class="p">})</span>
</span><span id="Analyzer.generate_graphs-2299"><a href="#Analyzer.generate_graphs-2299"><span class="linenos">2299</span></a>        
</span><span id="Analyzer.generate_graphs-2300"><a href="#Analyzer.generate_graphs-2300"><span class="linenos">2300</span></a>        <span class="k">if</span> <span class="n">graph</span> <span class="o">==</span> <span class="s2">&quot;_all&quot;</span> <span class="ow">or</span> <span class="n">graph</span> <span class="o">==</span> <span class="n">key</span><span class="p">:</span>
</span><span id="Analyzer.generate_graphs-2301"><a href="#Analyzer.generate_graphs-2301"><span class="linenos">2301</span></a>            <span class="c1"># gather the data for the analysis</span>
</span><span id="Analyzer.generate_graphs-2302"><a href="#Analyzer.generate_graphs-2302"><span class="linenos">2302</span></a>            <span class="n">base_costs</span><span class="p">,</span> <span class="n">cost_values</span><span class="p">,</span> <span class="n">average_diffs</span><span class="p">,</span> <span class="n">conservative_diffs</span><span class="p">,</span> <span class="n">withins</span><span class="p">,</span> <span class="n">employee_costs_to_office</span><span class="p">,</span> <span class="n">current_office</span><span class="p">,</span> <span class="n">other_offices</span> <span class="o">=</span> \
</span><span id="Analyzer.generate_graphs-2303"><a href="#Analyzer.generate_graphs-2303"><span class="linenos">2303</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">get_emissions_analysis</span><span class="p">(</span><span class="n">emp</span><span class="p">,</span> <span class="n">offices</span><span class="p">,</span> <span class="n">commute_data</span><span class="p">)</span>
</span><span id="Analyzer.generate_graphs-2304"><a href="#Analyzer.generate_graphs-2304"><span class="linenos">2304</span></a>
</span><span id="Analyzer.generate_graphs-2305"><a href="#Analyzer.generate_graphs-2305"><span class="linenos">2305</span></a>        
</span><span id="Analyzer.generate_graphs-2306"><a href="#Analyzer.generate_graphs-2306"><span class="linenos">2306</span></a>            <span class="c1"># now we have a list of dataframes with the differentials, we eliminate all rows with 0 cost differential to prevent skewing the histogram</span>
</span><span id="Analyzer.generate_graphs-2307"><a href="#Analyzer.generate_graphs-2307"><span class="linenos">2307</span></a>            <span class="c1"># calculate the bin list based upon a the min (negative) and max (positive) values of the data     </span>
</span><span id="Analyzer.generate_graphs-2308"><a href="#Analyzer.generate_graphs-2308"><span class="linenos">2308</span></a>            <span class="n">binmin</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Analyzer.generate_graphs-2309"><a href="#Analyzer.generate_graphs-2309"><span class="linenos">2309</span></a>            <span class="n">binmax</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Analyzer.generate_graphs-2310"><a href="#Analyzer.generate_graphs-2310"><span class="linenos">2310</span></a>            <span class="n">diffs</span> <span class="o">=</span> <span class="p">[</span><span class="n">average_diffs</span><span class="p">,</span> <span class="n">conservative_diffs</span><span class="p">]</span>
</span><span id="Analyzer.generate_graphs-2311"><a href="#Analyzer.generate_graphs-2311"><span class="linenos">2311</span></a>            <span class="k">for</span> <span class="n">diff</span> <span class="ow">in</span> <span class="n">diffs</span><span class="p">:</span>
</span><span id="Analyzer.generate_graphs-2312"><a href="#Analyzer.generate_graphs-2312"><span class="linenos">2312</span></a>                <span class="k">for</span> <span class="n">each</span> <span class="ow">in</span> <span class="n">diff</span><span class="p">:</span>
</span><span id="Analyzer.generate_graphs-2313"><a href="#Analyzer.generate_graphs-2313"><span class="linenos">2313</span></a>                    <span class="k">if</span> <span class="nb">min</span><span class="p">(</span><span class="n">each</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">binmin</span><span class="p">:</span>
</span><span id="Analyzer.generate_graphs-2314"><a href="#Analyzer.generate_graphs-2314"><span class="linenos">2314</span></a>                        <span class="n">binmin</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">each</span><span class="p">)</span>
</span><span id="Analyzer.generate_graphs-2315"><a href="#Analyzer.generate_graphs-2315"><span class="linenos">2315</span></a>                    <span class="k">if</span> <span class="nb">max</span><span class="p">(</span><span class="n">each</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">binmax</span><span class="p">:</span>
</span><span id="Analyzer.generate_graphs-2316"><a href="#Analyzer.generate_graphs-2316"><span class="linenos">2316</span></a>                        <span class="n">binmax</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">each</span><span class="p">)</span>
</span><span id="Analyzer.generate_graphs-2317"><a href="#Analyzer.generate_graphs-2317"><span class="linenos">2317</span></a>            <span class="n">step</span> <span class="o">=</span> <span class="mf">0.001</span>
</span><span id="Analyzer.generate_graphs-2318"><a href="#Analyzer.generate_graphs-2318"><span class="linenos">2318</span></a>            <span class="c1"># round the binmin down to the nearest step, max up to the nearest step</span>
</span><span id="Analyzer.generate_graphs-2319"><a href="#Analyzer.generate_graphs-2319"><span class="linenos">2319</span></a>            <span class="n">bins</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">binmin</span> <span class="o">-</span> <span class="p">(</span><span class="n">binmin</span> <span class="o">%</span> <span class="n">step</span><span class="p">),</span> <span class="n">binmax</span> <span class="o">+</span> <span class="n">step</span> <span class="o">-</span> <span class="p">(</span><span class="n">binmax</span> <span class="o">%</span> <span class="n">step</span><span class="p">),</span> <span class="n">step</span><span class="p">)</span>
</span><span id="Analyzer.generate_graphs-2320"><a href="#Analyzer.generate_graphs-2320"><span class="linenos">2320</span></a>
</span><span id="Analyzer.generate_graphs-2321"><a href="#Analyzer.generate_graphs-2321"><span class="linenos">2321</span></a>            <span class="n">dvalues</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Total Average Cost&#39;</span><span class="p">,</span><span class="s1">&#39;Total High Cost&#39;</span><span class="p">]</span>
</span><span id="Analyzer.generate_graphs-2322"><a href="#Analyzer.generate_graphs-2322"><span class="linenos">2322</span></a>            
</span><span id="Analyzer.generate_graphs-2323"><a href="#Analyzer.generate_graphs-2323"><span class="linenos">2323</span></a>            <span class="n">plt</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graphing</span><span class="o">.</span><span class="n">get_histogram</span><span class="p">(</span><span class="n">emp</span><span class="p">,</span> <span class="n">other_offices</span><span class="p">,</span> <span class="n">cost_values</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="n">dvalues</span><span class="p">,</span> <span class="n">suptitle</span><span class="o">=</span><span class="n">title</span><span class="p">,</span> <span class="n">cutoff_radius</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">commute_range_cut_off</span><span class="p">,</span>
</span><span id="Analyzer.generate_graphs-2324"><a href="#Analyzer.generate_graphs-2324"><span class="linenos">2324</span></a>                                      <span class="n">x_label</span><span class="o">=</span><span class="s1">&#39;\$ (USD) per commute&#39;</span><span class="p">,</span> <span class="n">y_label</span><span class="o">=</span><span class="s1">&#39;# Employees (log scale)&#39;</span><span class="p">,</span>
</span><span id="Analyzer.generate_graphs-2325"><a href="#Analyzer.generate_graphs-2325"><span class="linenos">2325</span></a>                                      <span class="n">bins</span><span class="o">=</span><span class="n">bins</span><span class="p">,</span> <span class="n">rows</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">other_offices</span><span class="p">),</span> <span class="n">cols</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">column_titles</span><span class="o">=</span><span class="n">dvalues</span><span class="p">,</span> 
</span><span id="Analyzer.generate_graphs-2326"><a href="#Analyzer.generate_graphs-2326"><span class="linenos">2326</span></a>                                      <span class="n">cumulative_line</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">font_mod</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">manual_plot</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">override_values</span><span class="o">=</span><span class="n">cost_values</span><span class="p">)</span>
</span><span id="Analyzer.generate_graphs-2327"><a href="#Analyzer.generate_graphs-2327"><span class="linenos">2327</span></a>            
</span><span id="Analyzer.generate_graphs-2328"><a href="#Analyzer.generate_graphs-2328"><span class="linenos">2328</span></a>                  
</span><span id="Analyzer.generate_graphs-2329"><a href="#Analyzer.generate_graphs-2329"><span class="linenos">2329</span></a>            <span class="c1"># manually add histograms for each office option</span>
</span><span id="Analyzer.generate_graphs-2330"><a href="#Analyzer.generate_graphs-2330"><span class="linenos">2330</span></a>            <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">other_offices</span><span class="p">)):</span>
</span><span id="Analyzer.generate_graphs-2331"><a href="#Analyzer.generate_graphs-2331"><span class="linenos">2331</span></a>                <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
</span><span id="Analyzer.generate_graphs-2332"><a href="#Analyzer.generate_graphs-2332"><span class="linenos">2332</span></a>                    <span class="n">ax</span><span class="p">[</span><span class="n">r</span><span class="p">,</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">average_diffs</span><span class="p">[</span><span class="n">r</span><span class="p">],</span> <span class="n">bins</span><span class="o">=</span><span class="n">bins</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;#555555&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">align</span><span class="o">=</span><span class="s1">&#39;mid&#39;</span><span class="p">,</span> 
</span><span id="Analyzer.generate_graphs-2333"><a href="#Analyzer.generate_graphs-2333"><span class="linenos">2333</span></a>                            <span class="n">rwidth</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">other_offices</span><span class="p">[</span><span class="s1">&#39;address&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="n">r</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">(</span><span class="n">r</span><span class="o">+</span><span class="mi">2</span><span class="p">),</span> <span class="n">log</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="Analyzer.generate_graphs-2334"><a href="#Analyzer.generate_graphs-2334"><span class="linenos">2334</span></a>                    <span class="n">ax</span><span class="p">[</span><span class="n">r</span><span class="p">,</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;major&#39;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
</span><span id="Analyzer.generate_graphs-2335"><a href="#Analyzer.generate_graphs-2335"><span class="linenos">2335</span></a>                    <span class="k">if</span> <span class="n">c</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Analyzer.generate_graphs-2336"><a href="#Analyzer.generate_graphs-2336"><span class="linenos">2336</span></a>                        <span class="n">ax</span><span class="p">[</span><span class="n">r</span><span class="p">,</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;# Employees (log scale)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
</span><span id="Analyzer.generate_graphs-2337"><a href="#Analyzer.generate_graphs-2337"><span class="linenos">2337</span></a>                        <span class="c1"># put office address top left of the plot</span>
</span><span id="Analyzer.generate_graphs-2338"><a href="#Analyzer.generate_graphs-2338"><span class="linenos">2338</span></a>                        <span class="n">ax</span><span class="p">[</span><span class="n">r</span><span class="p">,</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.03</span><span class="p">,</span> <span class="mf">0.99</span><span class="p">,</span> <span class="n">other_offices</span><span class="p">[</span><span class="s1">&#39;address&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="n">r</span><span class="p">],</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="n">r</span><span class="p">,</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;top&#39;</span><span class="p">)</span>
</span><span id="Analyzer.generate_graphs-2339"><a href="#Analyzer.generate_graphs-2339"><span class="linenos">2339</span></a>                    
</span><span id="Analyzer.generate_graphs-2340"><a href="#Analyzer.generate_graphs-2340"><span class="linenos">2340</span></a>                    <span class="k">if</span> <span class="n">r</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">other_offices</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span>
</span><span id="Analyzer.generate_graphs-2341"><a href="#Analyzer.generate_graphs-2341"><span class="linenos">2341</span></a>                        <span class="n">ax</span><span class="p">[</span><span class="n">r</span><span class="p">,</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Cost of C02 Emissions (\$USD/commuting day)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
</span><span id="Analyzer.generate_graphs-2342"><a href="#Analyzer.generate_graphs-2342"><span class="linenos">2342</span></a>                    <span class="n">ax</span><span class="p">[</span><span class="n">r</span><span class="p">,</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;major&#39;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
</span><span id="Analyzer.generate_graphs-2343"><a href="#Analyzer.generate_graphs-2343"><span class="linenos">2343</span></a>                    
</span><span id="Analyzer.generate_graphs-2344"><a href="#Analyzer.generate_graphs-2344"><span class="linenos">2344</span></a>                    <span class="c1"># cost impact is the summation of the cost of emissions for all employees</span>
</span><span id="Analyzer.generate_graphs-2345"><a href="#Analyzer.generate_graphs-2345"><span class="linenos">2345</span></a>                    <span class="n">cost_impact_avg</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">average_diffs</span><span class="p">[</span><span class="n">r</span><span class="p">])</span>
</span><span id="Analyzer.generate_graphs-2346"><a href="#Analyzer.generate_graphs-2346"><span class="linenos">2346</span></a>                    <span class="n">cost_impact_con</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">conservative_diffs</span><span class="p">[</span><span class="n">r</span><span class="p">])</span>
</span><span id="Analyzer.generate_graphs-2347"><a href="#Analyzer.generate_graphs-2347"><span class="linenos">2347</span></a>                    
</span><span id="Analyzer.generate_graphs-2348"><a href="#Analyzer.generate_graphs-2348"><span class="linenos">2348</span></a>                    <span class="c1"># add a text box with the count</span>
</span><span id="Analyzer.generate_graphs-2349"><a href="#Analyzer.generate_graphs-2349"><span class="linenos">2349</span></a>                    <span class="n">t</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;co&#39;</span> <span class="p">:</span> <span class="s1">&#39;Total Avg Emissions Cost Difference</span><span class="se">\n</span><span class="s1"> (\$/commuting day): $</span><span class="si">{:,.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cost_impact_avg</span><span class="p">),</span>
</span><span id="Analyzer.generate_graphs-2350"><a href="#Analyzer.generate_graphs-2350"><span class="linenos">2350</span></a>                            <span class="s1">&#39;ci&#39;</span> <span class="p">:</span> <span class="s1">&#39;Total Conservative Cost Difference</span><span class="se">\n</span><span class="s1"> (\$/commuting day): $</span><span class="si">{:,.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cost_impact_con</span><span class="p">)</span>                         
</span><span id="Analyzer.generate_graphs-2351"><a href="#Analyzer.generate_graphs-2351"><span class="linenos">2351</span></a>                            <span class="p">}</span>
</span><span id="Analyzer.generate_graphs-2352"><a href="#Analyzer.generate_graphs-2352"><span class="linenos">2352</span></a>                    
</span><span id="Analyzer.generate_graphs-2353"><a href="#Analyzer.generate_graphs-2353"><span class="linenos">2353</span></a>                    <span class="n">textstr</span> <span class="o">=</span> <span class="n">t</span><span class="p">[</span><span class="s1">&#39;co&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="n">c</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">t</span><span class="p">[</span><span class="s1">&#39;ci&#39;</span><span class="p">]</span>
</span><span id="Analyzer.generate_graphs-2354"><a href="#Analyzer.generate_graphs-2354"><span class="linenos">2354</span></a>                    <span class="c1"># these are matplotlib.patch.Patch properties</span>
</span><span id="Analyzer.generate_graphs-2355"><a href="#Analyzer.generate_graphs-2355"><span class="linenos">2355</span></a>                    <span class="n">props</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">boxstyle</span><span class="o">=</span><span class="s1">&#39;round&#39;</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;wheat&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
</span><span id="Analyzer.generate_graphs-2356"><a href="#Analyzer.generate_graphs-2356"><span class="linenos">2356</span></a>                    <span class="c1"># place a text box in upper right in axes coords,</span>
</span><span id="Analyzer.generate_graphs-2357"><a href="#Analyzer.generate_graphs-2357"><span class="linenos">2357</span></a>                    <span class="n">ax</span><span class="p">[</span><span class="n">r</span><span class="p">,</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">.03</span><span class="p">,</span> <span class="mf">.85</span><span class="p">,</span> <span class="n">textstr</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="n">r</span><span class="p">,</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">,</span>
</span><span id="Analyzer.generate_graphs-2358"><a href="#Analyzer.generate_graphs-2358"><span class="linenos">2358</span></a>                                <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">bbox</span><span class="o">=</span><span class="n">props</span><span class="p">,</span> <span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;family&#39;</span><span class="p">:</span> <span class="s1">&#39;monospace&#39;</span><span class="p">},</span> <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">)</span>
</span><span id="Analyzer.generate_graphs-2359"><a href="#Analyzer.generate_graphs-2359"><span class="linenos">2359</span></a>                    
</span><span id="Analyzer.generate_graphs-2360"><a href="#Analyzer.generate_graphs-2360"><span class="linenos">2360</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">(</span><span class="n">pad</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
</span><span id="Analyzer.generate_graphs-2361"><a href="#Analyzer.generate_graphs-2361"><span class="linenos">2361</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">plots_dir</span><span class="o">+</span><span class="s2">&quot;/&quot;</span><span class="o">+</span><span class="n">key</span><span class="o">+</span><span class="s2">&quot;.png&quot;</span><span class="p">)</span>
</span><span id="Analyzer.generate_graphs-2362"><a href="#Analyzer.generate_graphs-2362"><span class="linenos">2362</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="Analyzer.generate_graphs-2363"><a href="#Analyzer.generate_graphs-2363"><span class="linenos">2363</span></a>
</span><span id="Analyzer.generate_graphs-2364"><a href="#Analyzer.generate_graphs-2364"><span class="linenos">2364</span></a>
</span><span id="Analyzer.generate_graphs-2365"><a href="#Analyzer.generate_graphs-2365"><span class="linenos">2365</span></a>
</span><span id="Analyzer.generate_graphs-2366"><a href="#Analyzer.generate_graphs-2366"><span class="linenos">2366</span></a>
</span><span id="Analyzer.generate_graphs-2367"><a href="#Analyzer.generate_graphs-2367"><span class="linenos">2367</span></a>        <span class="c1"># write the graphs to graphs.json in the project plots directory</span>
</span><span id="Analyzer.generate_graphs-2368"><a href="#Analyzer.generate_graphs-2368"><span class="linenos">2368</span></a>        <span class="c1"># convert self.graphs_list to json</span>
</span><span id="Analyzer.generate_graphs-2369"><a href="#Analyzer.generate_graphs-2369"><span class="linenos">2369</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">plots_dir</span><span class="p">,</span> <span class="s2">&quot;graphs.json&quot;</span><span class="p">),</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="Analyzer.generate_graphs-2370"><a href="#Analyzer.generate_graphs-2370"><span class="linenos">2370</span></a>            <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">graph_list</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
</span><span id="Analyzer.generate_graphs-2371"><a href="#Analyzer.generate_graphs-2371"><span class="linenos">2371</span></a>
</span><span id="Analyzer.generate_graphs-2372"><a href="#Analyzer.generate_graphs-2372"><span class="linenos">2372</span></a>        <span class="c1"># update the analysis phase</span>
</span><span id="Analyzer.generate_graphs-2373"><a href="#Analyzer.generate_graphs-2373"><span class="linenos">2373</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">update_analysis_phase</span><span class="p">()</span>
</span><span id="Analyzer.generate_graphs-2374"><a href="#Analyzer.generate_graphs-2374"><span class="linenos">2374</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph_list</span>
</span></pre></div>


            <div class="docstring"><p>Generates and saves graphical representations of analyzed commute data.</p>

<p>Based on the available commute data, this method generates graphs such as the geographical distribution 
of analyzed locations and the local analysis of commute geography. It supports generating all graphs or 
a specific one based on the <code>graph</code> parameter.</p>

<p>Args:
    graph (str, optional): Specifies which graph to generate. Use "_all" to generate all graphs, or specify a 
    particular graph's key. Defaults to "_all".</p>

<p>Returns:
    list: A list of dictionaries, each containing details about the generated graphs, including file paths and titles.</p>
</div>


                            </div>
                            <div id="Analyzer.generate_tables" class="classattr">
                                        <input id="Analyzer.generate_tables-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">generate_tables</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">table</span><span class="o">=</span><span class="s1">&#39;_all&#39;</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Analyzer.generate_tables-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Analyzer.generate_tables"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Analyzer.generate_tables-2380"><a href="#Analyzer.generate_tables-2380"><span class="linenos">2380</span></a>    <span class="k">def</span> <span class="nf">generate_tables</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">table</span><span class="o">=</span><span class="s2">&quot;_all&quot;</span><span class="p">):</span>
</span><span id="Analyzer.generate_tables-2381"><a href="#Analyzer.generate_tables-2381"><span class="linenos">2381</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Analyzer.generate_tables-2382"><a href="#Analyzer.generate_tables-2382"><span class="linenos">2382</span></a><span class="sd">        Generates and saves tabular representations of analyzed commute data.</span>
</span><span id="Analyzer.generate_tables-2383"><a href="#Analyzer.generate_tables-2383"><span class="linenos">2383</span></a>
</span><span id="Analyzer.generate_tables-2384"><a href="#Analyzer.generate_tables-2384"><span class="linenos">2384</span></a><span class="sd">        Based on the available commute data, this method generates tables such as the overall cost comparison analytics.</span>
</span><span id="Analyzer.generate_tables-2385"><a href="#Analyzer.generate_tables-2385"><span class="linenos">2385</span></a>
</span><span id="Analyzer.generate_tables-2386"><a href="#Analyzer.generate_tables-2386"><span class="linenos">2386</span></a><span class="sd">        Args:</span>
</span><span id="Analyzer.generate_tables-2387"><a href="#Analyzer.generate_tables-2387"><span class="linenos">2387</span></a><span class="sd">            graph (str, optional): Specifies which table to generate. Use &quot;_all&quot; to generate all tables, or specify a </span>
</span><span id="Analyzer.generate_tables-2388"><a href="#Analyzer.generate_tables-2388"><span class="linenos">2388</span></a><span class="sd">            particular table&#39;s key. Defaults to &quot;_all&quot;.</span>
</span><span id="Analyzer.generate_tables-2389"><a href="#Analyzer.generate_tables-2389"><span class="linenos">2389</span></a>
</span><span id="Analyzer.generate_tables-2390"><a href="#Analyzer.generate_tables-2390"><span class="linenos">2390</span></a><span class="sd">        Returns:</span>
</span><span id="Analyzer.generate_tables-2391"><a href="#Analyzer.generate_tables-2391"><span class="linenos">2391</span></a><span class="sd">            list: A list of dictionaries, each containing details about the generated tables, including file paths and titles.</span>
</span><span id="Analyzer.generate_tables-2392"><a href="#Analyzer.generate_tables-2392"><span class="linenos">2392</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Analyzer.generate_tables-2393"><a href="#Analyzer.generate_tables-2393"><span class="linenos">2393</span></a>
</span><span id="Analyzer.generate_tables-2394"><a href="#Analyzer.generate_tables-2394"><span class="linenos">2394</span></a>        <span class="c1"># generate the tables for the project</span>
</span><span id="Analyzer.generate_tables-2395"><a href="#Analyzer.generate_tables-2395"><span class="linenos">2395</span></a>        <span class="c1"># if the commute data isn&#39;t already in the project, load it</span>
</span><span id="Analyzer.generate_tables-2396"><a href="#Analyzer.generate_tables-2396"><span class="linenos">2396</span></a>        <span class="k">if</span> <span class="s2">&quot;commute_data.csv&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">list_data_files</span><span class="p">():</span>
</span><span id="Analyzer.generate_tables-2397"><a href="#Analyzer.generate_tables-2397"><span class="linenos">2397</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;commute_data.csv&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Analyzer.generate_tables-2398"><a href="#Analyzer.generate_tables-2398"><span class="linenos">2398</span></a>                <span class="c1"># attempt to load the commute data</span>
</span><span id="Analyzer.generate_tables-2399"><a href="#Analyzer.generate_tables-2399"><span class="linenos">2399</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">load_data_file</span><span class="p">(</span><span class="s2">&quot;commute_data.csv&quot;</span><span class="p">):</span>
</span><span id="Analyzer.generate_tables-2400"><a href="#Analyzer.generate_tables-2400"><span class="linenos">2400</span></a>                    <span class="k">pass</span>
</span><span id="Analyzer.generate_tables-2401"><a href="#Analyzer.generate_tables-2401"><span class="linenos">2401</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="Analyzer.generate_tables-2402"><a href="#Analyzer.generate_tables-2402"><span class="linenos">2402</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Errors loading commute data from project.&quot;</span><span class="p">)</span>
</span><span id="Analyzer.generate_tables-2403"><a href="#Analyzer.generate_tables-2403"><span class="linenos">2403</span></a>                    <span class="k">return</span> <span class="kc">False</span>
</span><span id="Analyzer.generate_tables-2404"><a href="#Analyzer.generate_tables-2404"><span class="linenos">2404</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Analyzer.generate_tables-2405"><a href="#Analyzer.generate_tables-2405"><span class="linenos">2405</span></a>                <span class="k">pass</span>
</span><span id="Analyzer.generate_tables-2406"><a href="#Analyzer.generate_tables-2406"><span class="linenos">2406</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Analyzer.generate_tables-2407"><a href="#Analyzer.generate_tables-2407"><span class="linenos">2407</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Commute data missing from project.&quot;</span><span class="p">)</span>
</span><span id="Analyzer.generate_tables-2408"><a href="#Analyzer.generate_tables-2408"><span class="linenos">2408</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="Analyzer.generate_tables-2409"><a href="#Analyzer.generate_tables-2409"><span class="linenos">2409</span></a>        
</span><span id="Analyzer.generate_tables-2410"><a href="#Analyzer.generate_tables-2410"><span class="linenos">2410</span></a>        <span class="c1"># create a list of dicts to map the tables to return to UI, they will be plotted in the order they are listed</span>
</span><span id="Analyzer.generate_tables-2411"><a href="#Analyzer.generate_tables-2411"><span class="linenos">2411</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">table_list</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Analyzer.generate_tables-2412"><a href="#Analyzer.generate_tables-2412"><span class="linenos">2412</span></a> 
</span><span id="Analyzer.generate_tables-2413"><a href="#Analyzer.generate_tables-2413"><span class="linenos">2413</span></a>        <span class="c1">### generate the tables  ###</span>
</span><span id="Analyzer.generate_tables-2414"><a href="#Analyzer.generate_tables-2414"><span class="linenos">2414</span></a>        <span class="n">tables_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project_directory</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">project_name</span><span class="p">,</span> <span class="s2">&quot;tables&quot;</span><span class="p">)</span>
</span><span id="Analyzer.generate_tables-2415"><a href="#Analyzer.generate_tables-2415"><span class="linenos">2415</span></a>        <span class="c1"># if it doesn&#39;t exist, create it</span>
</span><span id="Analyzer.generate_tables-2416"><a href="#Analyzer.generate_tables-2416"><span class="linenos">2416</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">tables_dir</span><span class="p">):</span>
</span><span id="Analyzer.generate_tables-2417"><a href="#Analyzer.generate_tables-2417"><span class="linenos">2417</span></a>            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">tables_dir</span><span class="p">)</span>
</span><span id="Analyzer.generate_tables-2418"><a href="#Analyzer.generate_tables-2418"><span class="linenos">2418</span></a>
</span><span id="Analyzer.generate_tables-2419"><a href="#Analyzer.generate_tables-2419"><span class="linenos">2419</span></a>        <span class="c1"># get the baseline data</span>
</span><span id="Analyzer.generate_tables-2420"><a href="#Analyzer.generate_tables-2420"><span class="linenos">2420</span></a>        <span class="n">emp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">get_emp_gps</span><span class="p">()</span>
</span><span id="Analyzer.generate_tables-2421"><a href="#Analyzer.generate_tables-2421"><span class="linenos">2421</span></a>        <span class="n">offices</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">get_office_gps</span><span class="p">()</span>
</span><span id="Analyzer.generate_tables-2422"><a href="#Analyzer.generate_tables-2422"><span class="linenos">2422</span></a>        <span class="n">commute_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">get_commute_data</span><span class="p">()</span>
</span><span id="Analyzer.generate_tables-2423"><a href="#Analyzer.generate_tables-2423"><span class="linenos">2423</span></a>        
</span><span id="Analyzer.generate_tables-2424"><a href="#Analyzer.generate_tables-2424"><span class="linenos">2424</span></a>        <span class="c1"># helper function to save the table</span>
</span><span id="Analyzer.generate_tables-2425"><a href="#Analyzer.generate_tables-2425"><span class="linenos">2425</span></a>        <span class="k">def</span> <span class="nf">save_table</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">tables_dir</span><span class="o">=</span><span class="n">tables_dir</span><span class="p">):</span>
</span><span id="Analyzer.generate_tables-2426"><a href="#Analyzer.generate_tables-2426"><span class="linenos">2426</span></a>            <span class="c1"># write the table to a file</span>
</span><span id="Analyzer.generate_tables-2427"><a href="#Analyzer.generate_tables-2427"><span class="linenos">2427</span></a>            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tables_dir</span><span class="p">,</span> <span class="n">key</span><span class="o">+</span><span class="s2">&quot;.html&quot;</span><span class="p">),</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="Analyzer.generate_tables-2428"><a href="#Analyzer.generate_tables-2428"><span class="linenos">2428</span></a>                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
</span><span id="Analyzer.generate_tables-2429"><a href="#Analyzer.generate_tables-2429"><span class="linenos">2429</span></a>
</span><span id="Analyzer.generate_tables-2430"><a href="#Analyzer.generate_tables-2430"><span class="linenos">2430</span></a>        <span class="c1">################################################################################</span>
</span><span id="Analyzer.generate_tables-2431"><a href="#Analyzer.generate_tables-2431"><span class="linenos">2431</span></a>        <span class="c1">### TABLE SET: Office Addresses and Lat/Longs</span>
</span><span id="Analyzer.generate_tables-2432"><a href="#Analyzer.generate_tables-2432"><span class="linenos">2432</span></a>        <span class="c1"># iterate through offices and generate a table for each office</span>
</span><span id="Analyzer.generate_tables-2433"><a href="#Analyzer.generate_tables-2433"><span class="linenos">2433</span></a>        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">offices</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>    
</span><span id="Analyzer.generate_tables-2434"><a href="#Analyzer.generate_tables-2434"><span class="linenos">2434</span></a>            <span class="c1">################################################################################ </span>
</span><span id="Analyzer.generate_tables-2435"><a href="#Analyzer.generate_tables-2435"><span class="linenos">2435</span></a>            <span class="c1"># TABLE: </span>
</span><span id="Analyzer.generate_tables-2436"><a href="#Analyzer.generate_tables-2436"><span class="linenos">2436</span></a>            <span class="c1">## Location Information</span>
</span><span id="Analyzer.generate_tables-2437"><a href="#Analyzer.generate_tables-2437"><span class="linenos">2437</span></a>            <span class="n">key</span> <span class="o">=</span> <span class="s1">&#39;li&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
</span><span id="Analyzer.generate_tables-2438"><a href="#Analyzer.generate_tables-2438"><span class="linenos">2438</span></a>            <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;Location Information &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;address&#39;</span><span class="p">])</span>
</span><span id="Analyzer.generate_tables-2439"><a href="#Analyzer.generate_tables-2439"><span class="linenos">2439</span></a>            <span class="n">short_title</span> <span class="o">=</span> <span class="n">title</span>
</span><span id="Analyzer.generate_tables-2440"><a href="#Analyzer.generate_tables-2440"><span class="linenos">2440</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">table_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="p">{</span><span class="s2">&quot;TABLE&quot;</span><span class="p">:</span> <span class="n">key</span><span class="p">,</span>
</span><span id="Analyzer.generate_tables-2441"><a href="#Analyzer.generate_tables-2441"><span class="linenos">2441</span></a>                                    <span class="s2">&quot;TITLE&quot;</span><span class="p">:</span> <span class="n">short_title</span><span class="p">,</span>
</span><span id="Analyzer.generate_tables-2442"><a href="#Analyzer.generate_tables-2442"><span class="linenos">2442</span></a>                                    <span class="s2">&quot;FILENAME&quot;</span><span class="p">:</span> <span class="n">key</span><span class="o">+</span><span class="s2">&quot;.html&quot;</span><span class="p">,</span>
</span><span id="Analyzer.generate_tables-2443"><a href="#Analyzer.generate_tables-2443"><span class="linenos">2443</span></a>                                    <span class="s2">&quot;TABLE-DESCRIPTION&quot;</span><span class="p">:</span> <span class="s2">&quot;This table displays the location information for office option &quot;</span> <span class="o">+</span> \
</span><span id="Analyzer.generate_tables-2444"><a href="#Analyzer.generate_tables-2444"><span class="linenos">2444</span></a>                                    <span class="nb">str</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;address&#39;</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot;.&quot;</span>
</span><span id="Analyzer.generate_tables-2445"><a href="#Analyzer.generate_tables-2445"><span class="linenos">2445</span></a>                                    <span class="p">})</span>
</span><span id="Analyzer.generate_tables-2446"><a href="#Analyzer.generate_tables-2446"><span class="linenos">2446</span></a>            
</span><span id="Analyzer.generate_tables-2447"><a href="#Analyzer.generate_tables-2447"><span class="linenos">2447</span></a>            <span class="k">if</span> <span class="n">table</span> <span class="o">==</span> <span class="s2">&quot;_all&quot;</span> <span class="ow">or</span> <span class="n">table</span> <span class="o">==</span> <span class="n">key</span><span class="p">:</span>
</span><span id="Analyzer.generate_tables-2448"><a href="#Analyzer.generate_tables-2448"><span class="linenos">2448</span></a>                <span class="n">office</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">to_frame</span><span class="p">()</span><span class="o">.</span><span class="n">T</span>
</span><span id="Analyzer.generate_tables-2449"><a href="#Analyzer.generate_tables-2449"><span class="linenos">2449</span></a>                <span class="c1"># get the needed commute values</span>
</span><span id="Analyzer.generate_tables-2450"><a href="#Analyzer.generate_tables-2450"><span class="linenos">2450</span></a>
</span><span id="Analyzer.generate_tables-2451"><a href="#Analyzer.generate_tables-2451"><span class="linenos">2451</span></a>                <span class="c1"># create a dataframe with the office address and lat/long</span>
</span><span id="Analyzer.generate_tables-2452"><a href="#Analyzer.generate_tables-2452"><span class="linenos">2452</span></a>                <span class="n">location_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
</span><span id="Analyzer.generate_tables-2453"><a href="#Analyzer.generate_tables-2453"><span class="linenos">2453</span></a>                <span class="n">location_data</span><span class="p">[</span><span class="s1">&#39;Office Address&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;address&#39;</span><span class="p">]]</span>
</span><span id="Analyzer.generate_tables-2454"><a href="#Analyzer.generate_tables-2454"><span class="linenos">2454</span></a>                <span class="n">location_data</span><span class="p">[</span><span class="s1">&#39;Latitude&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;latitude&#39;</span><span class="p">]]</span>
</span><span id="Analyzer.generate_tables-2455"><a href="#Analyzer.generate_tables-2455"><span class="linenos">2455</span></a>                <span class="n">location_data</span><span class="p">[</span><span class="s1">&#39;Longitude&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;longitude&#39;</span><span class="p">]]</span>
</span><span id="Analyzer.generate_tables-2456"><a href="#Analyzer.generate_tables-2456"><span class="linenos">2456</span></a>                <span class="c1"># create a table</span>
</span><span id="Analyzer.generate_tables-2457"><a href="#Analyzer.generate_tables-2457"><span class="linenos">2457</span></a>                <span class="n">t</span> <span class="o">=</span> <span class="n">location_data</span><span class="o">.</span><span class="n">to_html</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="Analyzer.generate_tables-2458"><a href="#Analyzer.generate_tables-2458"><span class="linenos">2458</span></a>                <span class="c1"># write the table to a file</span>
</span><span id="Analyzer.generate_tables-2459"><a href="#Analyzer.generate_tables-2459"><span class="linenos">2459</span></a>                <span class="n">save_table</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>
</span><span id="Analyzer.generate_tables-2460"><a href="#Analyzer.generate_tables-2460"><span class="linenos">2460</span></a>
</span><span id="Analyzer.generate_tables-2461"><a href="#Analyzer.generate_tables-2461"><span class="linenos">2461</span></a>
</span><span id="Analyzer.generate_tables-2462"><a href="#Analyzer.generate_tables-2462"><span class="linenos">2462</span></a>        <span class="c1">################################################################################ </span>
</span><span id="Analyzer.generate_tables-2463"><a href="#Analyzer.generate_tables-2463"><span class="linenos">2463</span></a>        <span class="c1"># TABLE: </span>
</span><span id="Analyzer.generate_tables-2464"><a href="#Analyzer.generate_tables-2464"><span class="linenos">2464</span></a>        <span class="c1">## Overal Cost Comparison Table</span>
</span><span id="Analyzer.generate_tables-2465"><a href="#Analyzer.generate_tables-2465"><span class="linenos">2465</span></a>        <span class="n">key</span> <span class="o">=</span> <span class="s1">&#39;occt&#39;</span>
</span><span id="Analyzer.generate_tables-2466"><a href="#Analyzer.generate_tables-2466"><span class="linenos">2466</span></a>        <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;Overall Cost Comparison Table&quot;</span>
</span><span id="Analyzer.generate_tables-2467"><a href="#Analyzer.generate_tables-2467"><span class="linenos">2467</span></a>        <span class="n">short_title</span> <span class="o">=</span> <span class="n">title</span>
</span><span id="Analyzer.generate_tables-2468"><a href="#Analyzer.generate_tables-2468"><span class="linenos">2468</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">table_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="p">{</span><span class="s2">&quot;TABLE&quot;</span><span class="p">:</span> <span class="n">key</span><span class="p">,</span>
</span><span id="Analyzer.generate_tables-2469"><a href="#Analyzer.generate_tables-2469"><span class="linenos">2469</span></a>                                <span class="s2">&quot;TITLE&quot;</span><span class="p">:</span> <span class="n">short_title</span><span class="p">,</span>
</span><span id="Analyzer.generate_tables-2470"><a href="#Analyzer.generate_tables-2470"><span class="linenos">2470</span></a>                                <span class="s2">&quot;FILENAME&quot;</span><span class="p">:</span> <span class="n">key</span><span class="o">+</span><span class="s2">&quot;.html&quot;</span><span class="p">,</span>
</span><span id="Analyzer.generate_tables-2471"><a href="#Analyzer.generate_tables-2471"><span class="linenos">2471</span></a>                                <span class="s2">&quot;TABLE-DESCRIPTION&quot;</span><span class="p">:</span> <span class="s2">&quot;This table displays the overall cost comparison for each office option.&quot;</span>
</span><span id="Analyzer.generate_tables-2472"><a href="#Analyzer.generate_tables-2472"><span class="linenos">2472</span></a>                                <span class="p">})</span>
</span><span id="Analyzer.generate_tables-2473"><a href="#Analyzer.generate_tables-2473"><span class="linenos">2473</span></a>        
</span><span id="Analyzer.generate_tables-2474"><a href="#Analyzer.generate_tables-2474"><span class="linenos">2474</span></a>        <span class="k">if</span> <span class="n">table</span> <span class="o">==</span> <span class="s2">&quot;_all&quot;</span> <span class="ow">or</span> <span class="n">table</span> <span class="o">==</span> <span class="n">key</span><span class="p">:</span>
</span><span id="Analyzer.generate_tables-2475"><a href="#Analyzer.generate_tables-2475"><span class="linenos">2475</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Generating table for: &quot;</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">table</span><span class="p">)</span>
</span><span id="Analyzer.generate_tables-2476"><a href="#Analyzer.generate_tables-2476"><span class="linenos">2476</span></a>            <span class="n">office</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">to_frame</span><span class="p">()</span><span class="o">.</span><span class="n">T</span>
</span><span id="Analyzer.generate_tables-2477"><a href="#Analyzer.generate_tables-2477"><span class="linenos">2477</span></a>            <span class="c1"># gather the data for the analysis</span>
</span><span id="Analyzer.generate_tables-2478"><a href="#Analyzer.generate_tables-2478"><span class="linenos">2478</span></a>            <span class="n">val_set</span><span class="p">,</span> <span class="n">base_costs</span><span class="p">,</span> <span class="n">cost_values</span><span class="p">,</span> <span class="n">average_diffs</span><span class="p">,</span> <span class="n">conservative_diffs</span><span class="p">,</span> <span class="n">withins</span><span class="p">,</span> <span class="n">employee_costs_to_office</span><span class="p">,</span> <span class="n">current_office</span><span class="p">,</span> <span class="n">other_offices</span> <span class="o">=</span> \
</span><span id="Analyzer.generate_tables-2479"><a href="#Analyzer.generate_tables-2479"><span class="linenos">2479</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">get_attrition_analysis</span><span class="p">(</span><span class="n">emp</span><span class="p">,</span> <span class="n">offices</span><span class="p">,</span> <span class="n">commute_data</span><span class="p">)</span>
</span><span id="Analyzer.generate_tables-2480"><a href="#Analyzer.generate_tables-2480"><span class="linenos">2480</span></a>
</span><span id="Analyzer.generate_tables-2481"><a href="#Analyzer.generate_tables-2481"><span class="linenos">2481</span></a>            <span class="c1"># commute related costs</span>
</span><span id="Analyzer.generate_tables-2482"><a href="#Analyzer.generate_tables-2482"><span class="linenos">2482</span></a>                <span class="c1"># pass</span>
</span><span id="Analyzer.generate_tables-2483"><a href="#Analyzer.generate_tables-2483"><span class="linenos">2483</span></a>            
</span><span id="Analyzer.generate_tables-2484"><a href="#Analyzer.generate_tables-2484"><span class="linenos">2484</span></a>            <span class="c1"># ####### employee attrition related costs</span>
</span><span id="Analyzer.generate_tables-2485"><a href="#Analyzer.generate_tables-2485"><span class="linenos">2485</span></a>            <span class="c1"># turnover threshold due to cost</span>
</span><span id="Analyzer.generate_tables-2486"><a href="#Analyzer.generate_tables-2486"><span class="linenos">2486</span></a>            <span class="n">median_salary</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">median_salary</span>
</span><span id="Analyzer.generate_tables-2487"><a href="#Analyzer.generate_tables-2487"><span class="linenos">2487</span></a>            <span class="n">threshold</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">turnover_threshold_due_to_cost</span><span class="o">*</span><span class="n">median_salary</span>
</span><span id="Analyzer.generate_tables-2488"><a href="#Analyzer.generate_tables-2488"><span class="linenos">2488</span></a>            <span class="n">daily_threshold</span> <span class="o">=</span> <span class="n">threshold</span><span class="o">/</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">commute_days_per_week</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">commute_weeks_per_year</span><span class="p">)</span>
</span><span id="Analyzer.generate_tables-2489"><a href="#Analyzer.generate_tables-2489"><span class="linenos">2489</span></a>            <span class="c1"># turnover probability due to time cost</span>
</span><span id="Analyzer.generate_tables-2490"><a href="#Analyzer.generate_tables-2490"><span class="linenos">2490</span></a>            <span class="n">turnover_probability_time_cost</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">turnover_probability_time_cost</span>
</span><span id="Analyzer.generate_tables-2491"><a href="#Analyzer.generate_tables-2491"><span class="linenos">2491</span></a>            <span class="c1"># employee replacement cost</span>
</span><span id="Analyzer.generate_tables-2492"><a href="#Analyzer.generate_tables-2492"><span class="linenos">2492</span></a>            <span class="n">employee_replacement_cost</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">employee_replacement_cost</span>
</span><span id="Analyzer.generate_tables-2493"><a href="#Analyzer.generate_tables-2493"><span class="linenos">2493</span></a>
</span><span id="Analyzer.generate_tables-2494"><a href="#Analyzer.generate_tables-2494"><span class="linenos">2494</span></a>
</span><span id="Analyzer.generate_tables-2495"><a href="#Analyzer.generate_tables-2495"><span class="linenos">2495</span></a>
</span><span id="Analyzer.generate_tables-2496"><a href="#Analyzer.generate_tables-2496"><span class="linenos">2496</span></a>
</span><span id="Analyzer.generate_tables-2497"><a href="#Analyzer.generate_tables-2497"><span class="linenos">2497</span></a>            <span class="c1"># ######## emissions related costs</span>
</span><span id="Analyzer.generate_tables-2498"><a href="#Analyzer.generate_tables-2498"><span class="linenos">2498</span></a>
</span><span id="Analyzer.generate_tables-2499"><a href="#Analyzer.generate_tables-2499"><span class="linenos">2499</span></a>            <span class="c1"># discount rate</span>
</span><span id="Analyzer.generate_tables-2500"><a href="#Analyzer.generate_tables-2500"><span class="linenos">2500</span></a>
</span><span id="Analyzer.generate_tables-2501"><a href="#Analyzer.generate_tables-2501"><span class="linenos">2501</span></a>
</span><span id="Analyzer.generate_tables-2502"><a href="#Analyzer.generate_tables-2502"><span class="linenos">2502</span></a>
</span><span id="Analyzer.generate_tables-2503"><a href="#Analyzer.generate_tables-2503"><span class="linenos">2503</span></a>
</span><span id="Analyzer.generate_tables-2504"><a href="#Analyzer.generate_tables-2504"><span class="linenos">2504</span></a>            <span class="c1"># create a dataframe with the office address and lat/long</span>
</span><span id="Analyzer.generate_tables-2505"><a href="#Analyzer.generate_tables-2505"><span class="linenos">2505</span></a>            <span class="n">location_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
</span><span id="Analyzer.generate_tables-2506"><a href="#Analyzer.generate_tables-2506"><span class="linenos">2506</span></a>            <span class="n">location_data</span><span class="p">[</span><span class="s1">&#39;Office Address&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;address&#39;</span><span class="p">]]</span>
</span><span id="Analyzer.generate_tables-2507"><a href="#Analyzer.generate_tables-2507"><span class="linenos">2507</span></a>            <span class="n">location_data</span><span class="p">[</span><span class="s1">&#39;Latitude&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;latitude&#39;</span><span class="p">]]</span>
</span><span id="Analyzer.generate_tables-2508"><a href="#Analyzer.generate_tables-2508"><span class="linenos">2508</span></a>            <span class="n">location_data</span><span class="p">[</span><span class="s1">&#39;Longitude&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;longitude&#39;</span><span class="p">]]</span>
</span><span id="Analyzer.generate_tables-2509"><a href="#Analyzer.generate_tables-2509"><span class="linenos">2509</span></a>            <span class="c1"># create a table</span>
</span><span id="Analyzer.generate_tables-2510"><a href="#Analyzer.generate_tables-2510"><span class="linenos">2510</span></a>            <span class="n">t</span> <span class="o">=</span> <span class="n">location_data</span><span class="o">.</span><span class="n">to_html</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="Analyzer.generate_tables-2511"><a href="#Analyzer.generate_tables-2511"><span class="linenos">2511</span></a>            <span class="c1"># write the table to a file</span>
</span><span id="Analyzer.generate_tables-2512"><a href="#Analyzer.generate_tables-2512"><span class="linenos">2512</span></a>            <span class="n">save_table</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>
</span><span id="Analyzer.generate_tables-2513"><a href="#Analyzer.generate_tables-2513"><span class="linenos">2513</span></a>
</span><span id="Analyzer.generate_tables-2514"><a href="#Analyzer.generate_tables-2514"><span class="linenos">2514</span></a>
</span><span id="Analyzer.generate_tables-2515"><a href="#Analyzer.generate_tables-2515"><span class="linenos">2515</span></a>
</span><span id="Analyzer.generate_tables-2516"><a href="#Analyzer.generate_tables-2516"><span class="linenos">2516</span></a>
</span><span id="Analyzer.generate_tables-2517"><a href="#Analyzer.generate_tables-2517"><span class="linenos">2517</span></a>
</span><span id="Analyzer.generate_tables-2518"><a href="#Analyzer.generate_tables-2518"><span class="linenos">2518</span></a>
</span><span id="Analyzer.generate_tables-2519"><a href="#Analyzer.generate_tables-2519"><span class="linenos">2519</span></a>
</span><span id="Analyzer.generate_tables-2520"><a href="#Analyzer.generate_tables-2520"><span class="linenos">2520</span></a>
</span><span id="Analyzer.generate_tables-2521"><a href="#Analyzer.generate_tables-2521"><span class="linenos">2521</span></a>
</span><span id="Analyzer.generate_tables-2522"><a href="#Analyzer.generate_tables-2522"><span class="linenos">2522</span></a>
</span><span id="Analyzer.generate_tables-2523"><a href="#Analyzer.generate_tables-2523"><span class="linenos">2523</span></a>
</span><span id="Analyzer.generate_tables-2524"><a href="#Analyzer.generate_tables-2524"><span class="linenos">2524</span></a>        <span class="c1"># write the graphs to tables.json in the project tables directory</span>
</span><span id="Analyzer.generate_tables-2525"><a href="#Analyzer.generate_tables-2525"><span class="linenos">2525</span></a>        <span class="c1"># convert self.tables_list to json</span>
</span><span id="Analyzer.generate_tables-2526"><a href="#Analyzer.generate_tables-2526"><span class="linenos">2526</span></a>        <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">table_list</span><span class="p">)</span>
</span><span id="Analyzer.generate_tables-2527"><a href="#Analyzer.generate_tables-2527"><span class="linenos">2527</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tables_dir</span><span class="p">,</span> <span class="s2">&quot;tables.json&quot;</span><span class="p">),</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="Analyzer.generate_tables-2528"><a href="#Analyzer.generate_tables-2528"><span class="linenos">2528</span></a>            <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">table_list</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
</span><span id="Analyzer.generate_tables-2529"><a href="#Analyzer.generate_tables-2529"><span class="linenos">2529</span></a>        
</span><span id="Analyzer.generate_tables-2530"><a href="#Analyzer.generate_tables-2530"><span class="linenos">2530</span></a>        <span class="c1"># update the analysis phase</span>
</span><span id="Analyzer.generate_tables-2531"><a href="#Analyzer.generate_tables-2531"><span class="linenos">2531</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">update_analysis_phase</span><span class="p">()</span>
</span><span id="Analyzer.generate_tables-2532"><a href="#Analyzer.generate_tables-2532"><span class="linenos">2532</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">table_list</span>
</span><span id="Analyzer.generate_tables-2533"><a href="#Analyzer.generate_tables-2533"><span class="linenos">2533</span></a>        <span class="c1">################################################################################</span>
</span></pre></div>


            <div class="docstring"><p>Generates and saves tabular representations of analyzed commute data.</p>

<p>Based on the available commute data, this method generates tables such as the overall cost comparison analytics.</p>

<p>Args:
    graph (str, optional): Specifies which table to generate. Use "_all" to generate all tables, or specify a 
    particular table's key. Defaults to "_all".</p>

<p>Returns:
    list: A list of dictionaries, each containing details about the generated tables, including file paths and titles.</p>
</div>


                            </div>
                            <div id="Analyzer.get_attrition_analysis" class="classattr">
                                        <input id="Analyzer.get_attrition_analysis-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_attrition_analysis</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">emp</span>, </span><span class="param"><span class="n">offices</span>, </span><span class="param"><span class="n">commute_data</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Analyzer.get_attrition_analysis-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Analyzer.get_attrition_analysis"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Analyzer.get_attrition_analysis-2558"><a href="#Analyzer.get_attrition_analysis-2558"><span class="linenos">2558</span></a>    <span class="k">def</span> <span class="nf">get_attrition_analysis</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">emp</span><span class="p">,</span> <span class="n">offices</span><span class="p">,</span> <span class="n">commute_data</span><span class="p">):</span>
</span><span id="Analyzer.get_attrition_analysis-2559"><a href="#Analyzer.get_attrition_analysis-2559"><span class="linenos">2559</span></a>        <span class="c1"># helper function to get a base cost dataframe</span>
</span><span id="Analyzer.get_attrition_analysis-2560"><a href="#Analyzer.get_attrition_analysis-2560"><span class="linenos">2560</span></a>        <span class="k">def</span> <span class="nf">get_base_cost_df</span><span class="p">(</span><span class="n">emp</span><span class="p">,</span> <span class="n">officeaddr</span><span class="p">):</span>
</span><span id="Analyzer.get_attrition_analysis-2561"><a href="#Analyzer.get_attrition_analysis-2561"><span class="linenos">2561</span></a>            <span class="n">rows</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Analyzer.get_attrition_analysis-2562"><a href="#Analyzer.get_attrition_analysis-2562"><span class="linenos">2562</span></a>            <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">emp</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
</span><span id="Analyzer.get_attrition_analysis-2563"><a href="#Analyzer.get_attrition_analysis-2563"><span class="linenos">2563</span></a>                <span class="n">cost</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="Analyzer.get_attrition_analysis-2564"><a href="#Analyzer.get_attrition_analysis-2564"><span class="linenos">2564</span></a>                <span class="n">rows</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s1">&#39;latitude&#39;</span><span class="p">:</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;latitude&#39;</span><span class="p">],</span><span class="s1">&#39;longitude&#39;</span><span class="p">:</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;longitude&#39;</span><span class="p">],</span><span class="s1">&#39;office&#39;</span><span class="p">:</span><span class="n">officeaddr</span><span class="p">,</span><span class="s1">&#39;cost&#39;</span><span class="p">:</span><span class="n">cost</span><span class="p">})</span>
</span><span id="Analyzer.get_attrition_analysis-2565"><a href="#Analyzer.get_attrition_analysis-2565"><span class="linenos">2565</span></a>            <span class="c1">#cost_df = pd.DataFrame(rows)</span>
</span><span id="Analyzer.get_attrition_analysis-2566"><a href="#Analyzer.get_attrition_analysis-2566"><span class="linenos">2566</span></a>            <span class="k">return</span> <span class="n">rows</span>
</span><span id="Analyzer.get_attrition_analysis-2567"><a href="#Analyzer.get_attrition_analysis-2567"><span class="linenos">2567</span></a>        
</span><span id="Analyzer.get_attrition_analysis-2568"><a href="#Analyzer.get_attrition_analysis-2568"><span class="linenos">2568</span></a>        <span class="n">employee_costs_to_office</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="Analyzer.get_attrition_analysis-2569"><a href="#Analyzer.get_attrition_analysis-2569"><span class="linenos">2569</span></a>        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">offices</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>    
</span><span id="Analyzer.get_attrition_analysis-2570"><a href="#Analyzer.get_attrition_analysis-2570"><span class="linenos">2570</span></a>            <span class="n">office</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">to_frame</span><span class="p">()</span><span class="o">.</span><span class="n">T</span>
</span><span id="Analyzer.get_attrition_analysis-2571"><a href="#Analyzer.get_attrition_analysis-2571"><span class="linenos">2571</span></a>            
</span><span id="Analyzer.get_attrition_analysis-2572"><a href="#Analyzer.get_attrition_analysis-2572"><span class="linenos">2572</span></a>            <span class="c1"># get the needed commute values</span>
</span><span id="Analyzer.get_attrition_analysis-2573"><a href="#Analyzer.get_attrition_analysis-2573"><span class="linenos">2573</span></a>            <span class="n">values</span> <span class="o">=</span> <span class="n">commute_data</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span>
</span><span id="Analyzer.get_attrition_analysis-2574"><a href="#Analyzer.get_attrition_analysis-2574"><span class="linenos">2574</span></a>            
</span><span id="Analyzer.get_attrition_analysis-2575"><a href="#Analyzer.get_attrition_analysis-2575"><span class="linenos">2575</span></a>            <span class="n">mornings</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;m_morning_duration_in_traffic&#39;</span><span class="p">,</span><span class="s1">&#39;t_morning_duration_in_traffic&#39;</span><span class="p">,</span><span class="s1">&#39;w_morning_duration_in_traffic&#39;</span><span class="p">,</span><span class="s1">&#39;h_morning_duration_in_traffic&#39;</span><span class="p">,</span><span class="s1">&#39;f_morning_duration_in_traffic&#39;</span><span class="p">]</span>
</span><span id="Analyzer.get_attrition_analysis-2576"><a href="#Analyzer.get_attrition_analysis-2576"><span class="linenos">2576</span></a>            <span class="n">evenings</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;m_evening_duration_in_traffic&#39;</span><span class="p">,</span><span class="s1">&#39;t_evening_duration_in_traffic&#39;</span><span class="p">,</span><span class="s1">&#39;w_evening_duration_in_traffic&#39;</span><span class="p">,</span><span class="s1">&#39;h_evening_duration_in_traffic&#39;</span><span class="p">,</span><span class="s1">&#39;f_evening_duration_in_traffic&#39;</span><span class="p">]</span>
</span><span id="Analyzer.get_attrition_analysis-2577"><a href="#Analyzer.get_attrition_analysis-2577"><span class="linenos">2577</span></a>            
</span><span id="Analyzer.get_attrition_analysis-2578"><a href="#Analyzer.get_attrition_analysis-2578"><span class="linenos">2578</span></a>            <span class="n">cdpw</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">commute_days_per_week</span>
</span><span id="Analyzer.get_attrition_analysis-2579"><a href="#Analyzer.get_attrition_analysis-2579"><span class="linenos">2579</span></a>
</span><span id="Analyzer.get_attrition_analysis-2580"><a href="#Analyzer.get_attrition_analysis-2580"><span class="linenos">2580</span></a>            <span class="n">emp_within</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graphing</span><span class="o">.</span><span class="n">filter_drive_distance</span><span class="p">(</span><span class="n">emp</span><span class="p">,</span><span class="n">office</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">commute_range_cut_off</span><span class="p">,</span> <span class="n">commute_data</span><span class="o">=</span><span class="n">commute_data</span><span class="p">)</span>
</span><span id="Analyzer.get_attrition_analysis-2581"><a href="#Analyzer.get_attrition_analysis-2581"><span class="linenos">2581</span></a>            <span class="n">val_set</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graphing</span><span class="o">.</span><span class="n">get_commute_values</span><span class="p">(</span><span class="n">emp_within</span><span class="p">,</span> <span class="n">office</span><span class="p">,</span> <span class="n">commute_data</span><span class="p">,</span> <span class="n">values</span><span class="p">)</span>
</span><span id="Analyzer.get_attrition_analysis-2582"><a href="#Analyzer.get_attrition_analysis-2582"><span class="linenos">2582</span></a>            
</span><span id="Analyzer.get_attrition_analysis-2583"><a href="#Analyzer.get_attrition_analysis-2583"><span class="linenos">2583</span></a>            <span class="c1"># restore val_set columns latitutde and longitude to origin_lat and origin_long</span>
</span><span id="Analyzer.get_attrition_analysis-2584"><a href="#Analyzer.get_attrition_analysis-2584"><span class="linenos">2584</span></a>            <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;origin_lat&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;latitude&#39;</span><span class="p">]</span>
</span><span id="Analyzer.get_attrition_analysis-2585"><a href="#Analyzer.get_attrition_analysis-2585"><span class="linenos">2585</span></a>            <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;origin_long&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;longitude&#39;</span><span class="p">]</span>
</span><span id="Analyzer.get_attrition_analysis-2586"><a href="#Analyzer.get_attrition_analysis-2586"><span class="linenos">2586</span></a>
</span><span id="Analyzer.get_attrition_analysis-2587"><a href="#Analyzer.get_attrition_analysis-2587"><span class="linenos">2587</span></a>            
</span><span id="Analyzer.get_attrition_analysis-2588"><a href="#Analyzer.get_attrition_analysis-2588"><span class="linenos">2588</span></a>
</span><span id="Analyzer.get_attrition_analysis-2589"><a href="#Analyzer.get_attrition_analysis-2589"><span class="linenos">2589</span></a>            <span class="c1"># Calculate and insert the average morning and evening commute times directly into val_set</span>
</span><span id="Analyzer.get_attrition_analysis-2590"><a href="#Analyzer.get_attrition_analysis-2590"><span class="linenos">2590</span></a>            <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;Morning Average&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">val_set</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">mornings</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="Analyzer.get_attrition_analysis-2591"><a href="#Analyzer.get_attrition_analysis-2591"><span class="linenos">2591</span></a>            <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;Evening Average&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">val_set</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">evenings</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="Analyzer.get_attrition_analysis-2592"><a href="#Analyzer.get_attrition_analysis-2592"><span class="linenos">2592</span></a>
</span><span id="Analyzer.get_attrition_analysis-2593"><a href="#Analyzer.get_attrition_analysis-2593"><span class="linenos">2593</span></a>            <span class="c1"># Calculate and insert the top &#39;cdpw&#39; maximum morning and evening commute times</span>
</span><span id="Analyzer.get_attrition_analysis-2594"><a href="#Analyzer.get_attrition_analysis-2594"><span class="linenos">2594</span></a>            <span class="c1"># Note: Adjust the code below to calculate the averages of the top &#39;cdpw&#39; as new columns directly</span>
</span><span id="Analyzer.get_attrition_analysis-2595"><a href="#Analyzer.get_attrition_analysis-2595"><span class="linenos">2595</span></a>            <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;Average Top CDPW Morning&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">val_set</span><span class="p">[</span><span class="n">mornings</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="n">row</span><span class="o">.</span><span class="n">nlargest</span><span class="p">(</span><span class="n">cdpw</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="Analyzer.get_attrition_analysis-2596"><a href="#Analyzer.get_attrition_analysis-2596"><span class="linenos">2596</span></a>            <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;Average Top CDPW Evening&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">val_set</span><span class="p">[</span><span class="n">evenings</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="n">row</span><span class="o">.</span><span class="n">nlargest</span><span class="p">(</span><span class="n">cdpw</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="Analyzer.get_attrition_analysis-2597"><a href="#Analyzer.get_attrition_analysis-2597"><span class="linenos">2597</span></a>
</span><span id="Analyzer.get_attrition_analysis-2598"><a href="#Analyzer.get_attrition_analysis-2598"><span class="linenos">2598</span></a>            <span class="c1"># Calculate a per-minute cost based on &quot;median_salary&quot; and &quot;hours_per_year&quot;</span>
</span><span id="Analyzer.get_attrition_analysis-2599"><a href="#Analyzer.get_attrition_analysis-2599"><span class="linenos">2599</span></a>            <span class="n">per_minute_cost</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">median_salary</span> <span class="o">/</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">hours_per_year</span> <span class="o">*</span> <span class="mi">60</span><span class="p">)</span>
</span><span id="Analyzer.get_attrition_analysis-2600"><a href="#Analyzer.get_attrition_analysis-2600"><span class="linenos">2600</span></a>
</span><span id="Analyzer.get_attrition_analysis-2601"><a href="#Analyzer.get_attrition_analysis-2601"><span class="linenos">2601</span></a>            <span class="c1"># Calculate and insert the average cost for the week directly into val_set</span>
</span><span id="Analyzer.get_attrition_analysis-2602"><a href="#Analyzer.get_attrition_analysis-2602"><span class="linenos">2602</span></a>            <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;Morning Average Cost&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;Morning Average&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">per_minute_cost</span>
</span><span id="Analyzer.get_attrition_analysis-2603"><a href="#Analyzer.get_attrition_analysis-2603"><span class="linenos">2603</span></a>            <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;Evening Average Cost&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;Evening Average&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">per_minute_cost</span>
</span><span id="Analyzer.get_attrition_analysis-2604"><a href="#Analyzer.get_attrition_analysis-2604"><span class="linenos">2604</span></a>
</span><span id="Analyzer.get_attrition_analysis-2605"><a href="#Analyzer.get_attrition_analysis-2605"><span class="linenos">2605</span></a>            <span class="c1"># Calculate and insert the high/conservative cost for the week directly into val_set</span>
</span><span id="Analyzer.get_attrition_analysis-2606"><a href="#Analyzer.get_attrition_analysis-2606"><span class="linenos">2606</span></a>            <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;Morning High Cost&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;Average Top CDPW Morning&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">per_minute_cost</span>
</span><span id="Analyzer.get_attrition_analysis-2607"><a href="#Analyzer.get_attrition_analysis-2607"><span class="linenos">2607</span></a>            <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;Evening High Cost&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;Average Top CDPW Evening&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">per_minute_cost</span>
</span><span id="Analyzer.get_attrition_analysis-2608"><a href="#Analyzer.get_attrition_analysis-2608"><span class="linenos">2608</span></a>
</span><span id="Analyzer.get_attrition_analysis-2609"><a href="#Analyzer.get_attrition_analysis-2609"><span class="linenos">2609</span></a>            <span class="c1"># Calculate a Total Average Time and Total High Time cost</span>
</span><span id="Analyzer.get_attrition_analysis-2610"><a href="#Analyzer.get_attrition_analysis-2610"><span class="linenos">2610</span></a>            <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;Total Average Time Cost&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;Morning Average Cost&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;Evening Average Cost&#39;</span><span class="p">]</span>
</span><span id="Analyzer.get_attrition_analysis-2611"><a href="#Analyzer.get_attrition_analysis-2611"><span class="linenos">2611</span></a>            <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;Total High Time Cost&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;Morning High Cost&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;Evening High Cost&#39;</span><span class="p">]</span>
</span><span id="Analyzer.get_attrition_analysis-2612"><a href="#Analyzer.get_attrition_analysis-2612"><span class="linenos">2612</span></a>
</span><span id="Analyzer.get_attrition_analysis-2613"><a href="#Analyzer.get_attrition_analysis-2613"><span class="linenos">2613</span></a>            <span class="c1"># Calculate a Total Average Cost and Total High Cost</span>
</span><span id="Analyzer.get_attrition_analysis-2614"><a href="#Analyzer.get_attrition_analysis-2614"><span class="linenos">2614</span></a>            <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;Total Average Cost&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;Total Average Time Cost&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;commute_cost&#39;</span><span class="p">]</span>
</span><span id="Analyzer.get_attrition_analysis-2615"><a href="#Analyzer.get_attrition_analysis-2615"><span class="linenos">2615</span></a>            <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;Total High Cost&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;Total High Time Cost&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;commute_cost&#39;</span><span class="p">]</span>
</span><span id="Analyzer.get_attrition_analysis-2616"><a href="#Analyzer.get_attrition_analysis-2616"><span class="linenos">2616</span></a>            
</span><span id="Analyzer.get_attrition_analysis-2617"><a href="#Analyzer.get_attrition_analysis-2617"><span class="linenos">2617</span></a>            <span class="c1"># add the current val_set to the employee_costs_to_office dictionary</span>
</span><span id="Analyzer.get_attrition_analysis-2618"><a href="#Analyzer.get_attrition_analysis-2618"><span class="linenos">2618</span></a>            <span class="n">employee_costs_to_office</span><span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;address&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">val_set</span>
</span><span id="Analyzer.get_attrition_analysis-2619"><a href="#Analyzer.get_attrition_analysis-2619"><span class="linenos">2619</span></a>        
</span><span id="Analyzer.get_attrition_analysis-2620"><a href="#Analyzer.get_attrition_analysis-2620"><span class="linenos">2620</span></a>        <span class="c1"># employees to analyze are within the cutoff distance for this office</span>
</span><span id="Analyzer.get_attrition_analysis-2621"><a href="#Analyzer.get_attrition_analysis-2621"><span class="linenos">2621</span></a>        <span class="c1"># for this analysis, we need to iterate through options</span>
</span><span id="Analyzer.get_attrition_analysis-2622"><a href="#Analyzer.get_attrition_analysis-2622"><span class="linenos">2622</span></a>        <span class="n">current_office</span> <span class="o">=</span> <span class="n">offices</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">to_frame</span><span class="p">()</span><span class="o">.</span><span class="n">T</span>
</span><span id="Analyzer.get_attrition_analysis-2623"><a href="#Analyzer.get_attrition_analysis-2623"><span class="linenos">2623</span></a>        <span class="n">other_offices</span> <span class="o">=</span> <span class="n">offices</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="Analyzer.get_attrition_analysis-2624"><a href="#Analyzer.get_attrition_analysis-2624"><span class="linenos">2624</span></a>        <span class="n">cost_values</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Analyzer.get_attrition_analysis-2625"><a href="#Analyzer.get_attrition_analysis-2625"><span class="linenos">2625</span></a>        <span class="n">withins</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Analyzer.get_attrition_analysis-2626"><a href="#Analyzer.get_attrition_analysis-2626"><span class="linenos">2626</span></a>        <span class="n">commutes</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">commute_days_per_week</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">commute_weeks_per_year</span>
</span><span id="Analyzer.get_attrition_analysis-2627"><a href="#Analyzer.get_attrition_analysis-2627"><span class="linenos">2627</span></a>        
</span><span id="Analyzer.get_attrition_analysis-2628"><a href="#Analyzer.get_attrition_analysis-2628"><span class="linenos">2628</span></a>        <span class="c1"># for each employee, calculate the commute cost to the current office, place a new dataframe with lat, long, office, and cost</span>
</span><span id="Analyzer.get_attrition_analysis-2629"><a href="#Analyzer.get_attrition_analysis-2629"><span class="linenos">2629</span></a>        <span class="c1"># if the employee is within the cutoff distance, if outside the cutoff distance, the cost is 0</span>
</span><span id="Analyzer.get_attrition_analysis-2630"><a href="#Analyzer.get_attrition_analysis-2630"><span class="linenos">2630</span></a>        <span class="c1"># start by looping through ALL employees and adding a row with the current office, and cost = 0</span>
</span><span id="Analyzer.get_attrition_analysis-2631"><a href="#Analyzer.get_attrition_analysis-2631"><span class="linenos">2631</span></a>                
</span><span id="Analyzer.get_attrition_analysis-2632"><a href="#Analyzer.get_attrition_analysis-2632"><span class="linenos">2632</span></a>
</span><span id="Analyzer.get_attrition_analysis-2633"><a href="#Analyzer.get_attrition_analysis-2633"><span class="linenos">2633</span></a>        <span class="n">base_costs</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">get_base_cost_df</span><span class="p">(</span><span class="n">emp</span><span class="p">,</span> <span class="n">current_office</span><span class="p">[</span><span class="s1">&#39;address&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
</span><span id="Analyzer.get_attrition_analysis-2634"><a href="#Analyzer.get_attrition_analysis-2634"><span class="linenos">2634</span></a>        <span class="c1"># add columns for total average cost and total high cost</span>
</span><span id="Analyzer.get_attrition_analysis-2635"><a href="#Analyzer.get_attrition_analysis-2635"><span class="linenos">2635</span></a>        <span class="n">base_costs</span><span class="p">[</span><span class="s1">&#39;Total Average Cost&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="Analyzer.get_attrition_analysis-2636"><a href="#Analyzer.get_attrition_analysis-2636"><span class="linenos">2636</span></a>        <span class="n">base_costs</span><span class="p">[</span><span class="s1">&#39;Total High Cost&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="Analyzer.get_attrition_analysis-2637"><a href="#Analyzer.get_attrition_analysis-2637"><span class="linenos">2637</span></a>        <span class="c1"># now get emp_within for the current office, and update the relevant rows of base_costs with actual costs for those employees </span>
</span><span id="Analyzer.get_attrition_analysis-2638"><a href="#Analyzer.get_attrition_analysis-2638"><span class="linenos">2638</span></a>        <span class="c1"># using the commute_cost column in the commute_data dataframe where the employee lat long matches the commute_data lat long and office address</span>
</span><span id="Analyzer.get_attrition_analysis-2639"><a href="#Analyzer.get_attrition_analysis-2639"><span class="linenos">2639</span></a>        
</span><span id="Analyzer.get_attrition_analysis-2640"><a href="#Analyzer.get_attrition_analysis-2640"><span class="linenos">2640</span></a>        <span class="n">base_emp_within</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graphing</span><span class="o">.</span><span class="n">filter_drive_distance</span><span class="p">(</span><span class="n">emp</span><span class="p">,</span><span class="n">current_office</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">commute_range_cut_off</span><span class="p">,</span> <span class="n">commute_data</span><span class="o">=</span><span class="n">commute_data</span><span class="p">)</span>
</span><span id="Analyzer.get_attrition_analysis-2641"><a href="#Analyzer.get_attrition_analysis-2641"><span class="linenos">2641</span></a>
</span><span id="Analyzer.get_attrition_analysis-2642"><a href="#Analyzer.get_attrition_analysis-2642"><span class="linenos">2642</span></a>        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">base_emp_within</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
</span><span id="Analyzer.get_attrition_analysis-2643"><a href="#Analyzer.get_attrition_analysis-2643"><span class="linenos">2643</span></a>            <span class="c1"># set val_set from the employee_costs_to_office = {} dictionary</span>
</span><span id="Analyzer.get_attrition_analysis-2644"><a href="#Analyzer.get_attrition_analysis-2644"><span class="linenos">2644</span></a>            <span class="n">val_set</span> <span class="o">=</span> <span class="n">employee_costs_to_office</span><span class="p">[</span><span class="n">current_office</span><span class="p">[</span><span class="s1">&#39;address&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
</span><span id="Analyzer.get_attrition_analysis-2645"><a href="#Analyzer.get_attrition_analysis-2645"><span class="linenos">2645</span></a>            <span class="c1"># get the cost from the commute_data</span>
</span><span id="Analyzer.get_attrition_analysis-2646"><a href="#Analyzer.get_attrition_analysis-2646"><span class="linenos">2646</span></a>            <span class="n">avg_cost</span> <span class="o">=</span> <span class="n">val_set</span><span class="p">[(</span><span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;origin_lat&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;latitude&#39;</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;origin_long&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;longitude&#39;</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;office_address&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">current_office</span><span class="p">[</span><span class="s1">&#39;address&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">])][</span><span class="s1">&#39;Total Average Cost&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="Analyzer.get_attrition_analysis-2647"><a href="#Analyzer.get_attrition_analysis-2647"><span class="linenos">2647</span></a>            <span class="n">conservative_cost</span> <span class="o">=</span> <span class="n">val_set</span><span class="p">[(</span><span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;origin_lat&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;latitude&#39;</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;origin_long&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;longitude&#39;</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;office_address&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">current_office</span><span class="p">[</span><span class="s1">&#39;address&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">])][</span><span class="s1">&#39;Total High Cost&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="Analyzer.get_attrition_analysis-2648"><a href="#Analyzer.get_attrition_analysis-2648"><span class="linenos">2648</span></a>            <span class="n">base_costs</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">base_costs</span><span class="p">[</span><span class="s1">&#39;latitude&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;latitude&#39;</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">base_costs</span><span class="p">[</span><span class="s1">&#39;longitude&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;longitude&#39;</span><span class="p">]),</span><span class="s1">&#39;Total Average Cost&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">avg_cost</span>
</span><span id="Analyzer.get_attrition_analysis-2649"><a href="#Analyzer.get_attrition_analysis-2649"><span class="linenos">2649</span></a>            <span class="n">base_costs</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">base_costs</span><span class="p">[</span><span class="s1">&#39;latitude&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;latitude&#39;</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">base_costs</span><span class="p">[</span><span class="s1">&#39;longitude&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;longitude&#39;</span><span class="p">]),</span><span class="s1">&#39;Total High Cost&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">conservative_cost</span>
</span><span id="Analyzer.get_attrition_analysis-2650"><a href="#Analyzer.get_attrition_analysis-2650"><span class="linenos">2650</span></a>
</span><span id="Analyzer.get_attrition_analysis-2651"><a href="#Analyzer.get_attrition_analysis-2651"><span class="linenos">2651</span></a>        <span class="c1"># now we have a dataframe with all employees, and the cost to the current office</span>
</span><span id="Analyzer.get_attrition_analysis-2652"><a href="#Analyzer.get_attrition_analysis-2652"><span class="linenos">2652</span></a>    
</span><span id="Analyzer.get_attrition_analysis-2653"><a href="#Analyzer.get_attrition_analysis-2653"><span class="linenos">2653</span></a>        <span class="c1"># now iterate through the other offices, get a base cost dataframe, and then update the relevant rows with actual costs, place in cost_values</span>
</span><span id="Analyzer.get_attrition_analysis-2654"><a href="#Analyzer.get_attrition_analysis-2654"><span class="linenos">2654</span></a>        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">other_offices</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
</span><span id="Analyzer.get_attrition_analysis-2655"><a href="#Analyzer.get_attrition_analysis-2655"><span class="linenos">2655</span></a>            <span class="n">office</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">to_frame</span><span class="p">()</span><span class="o">.</span><span class="n">T</span>
</span><span id="Analyzer.get_attrition_analysis-2656"><a href="#Analyzer.get_attrition_analysis-2656"><span class="linenos">2656</span></a>            <span class="n">tmp_costs</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">get_base_cost_df</span><span class="p">(</span><span class="n">emp</span><span class="p">,</span> <span class="n">office</span><span class="p">[</span><span class="s1">&#39;address&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
</span><span id="Analyzer.get_attrition_analysis-2657"><a href="#Analyzer.get_attrition_analysis-2657"><span class="linenos">2657</span></a>            <span class="c1"># add columns for total average cost and total high cost</span>
</span><span id="Analyzer.get_attrition_analysis-2658"><a href="#Analyzer.get_attrition_analysis-2658"><span class="linenos">2658</span></a>            <span class="n">tmp_costs</span><span class="p">[</span><span class="s1">&#39;Total Average Cost&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="Analyzer.get_attrition_analysis-2659"><a href="#Analyzer.get_attrition_analysis-2659"><span class="linenos">2659</span></a>            <span class="n">tmp_costs</span><span class="p">[</span><span class="s1">&#39;Total High Cost&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="Analyzer.get_attrition_analysis-2660"><a href="#Analyzer.get_attrition_analysis-2660"><span class="linenos">2660</span></a>            <span class="n">emp_within</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graphing</span><span class="o">.</span><span class="n">filter_drive_distance</span><span class="p">(</span><span class="n">emp</span><span class="p">,</span><span class="n">office</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">commute_range_cut_off</span><span class="p">,</span> <span class="n">commute_data</span><span class="o">=</span><span class="n">commute_data</span><span class="p">)</span>
</span><span id="Analyzer.get_attrition_analysis-2661"><a href="#Analyzer.get_attrition_analysis-2661"><span class="linenos">2661</span></a>            <span class="c1"># we will use this later to get the differential for each employee, without the employees that aren&#39;t overlapping</span>
</span><span id="Analyzer.get_attrition_analysis-2662"><a href="#Analyzer.get_attrition_analysis-2662"><span class="linenos">2662</span></a>            <span class="n">withins</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">emp_within</span><span class="p">)</span>
</span><span id="Analyzer.get_attrition_analysis-2663"><a href="#Analyzer.get_attrition_analysis-2663"><span class="linenos">2663</span></a>
</span><span id="Analyzer.get_attrition_analysis-2664"><a href="#Analyzer.get_attrition_analysis-2664"><span class="linenos">2664</span></a>            <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">emp_within</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
</span><span id="Analyzer.get_attrition_analysis-2665"><a href="#Analyzer.get_attrition_analysis-2665"><span class="linenos">2665</span></a>                <span class="c1"># set val_set from the employee_costs_to_office = {} dictionary</span>
</span><span id="Analyzer.get_attrition_analysis-2666"><a href="#Analyzer.get_attrition_analysis-2666"><span class="linenos">2666</span></a>                <span class="n">val_set</span> <span class="o">=</span> <span class="n">employee_costs_to_office</span><span class="p">[</span><span class="n">office</span><span class="p">[</span><span class="s1">&#39;address&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
</span><span id="Analyzer.get_attrition_analysis-2667"><a href="#Analyzer.get_attrition_analysis-2667"><span class="linenos">2667</span></a>                <span class="c1"># get the cost from the commute_data</span>
</span><span id="Analyzer.get_attrition_analysis-2668"><a href="#Analyzer.get_attrition_analysis-2668"><span class="linenos">2668</span></a>                <span class="n">avg_cost</span> <span class="o">=</span> <span class="n">val_set</span><span class="p">[(</span><span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;origin_lat&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;latitude&#39;</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;origin_long&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;longitude&#39;</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;office_address&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">office</span><span class="p">[</span><span class="s1">&#39;address&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">])][</span><span class="s1">&#39;Total Average Cost&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="Analyzer.get_attrition_analysis-2669"><a href="#Analyzer.get_attrition_analysis-2669"><span class="linenos">2669</span></a>                <span class="n">conservative_cost</span> <span class="o">=</span> <span class="n">val_set</span><span class="p">[(</span><span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;origin_lat&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;latitude&#39;</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;origin_long&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;longitude&#39;</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;office_address&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">office</span><span class="p">[</span><span class="s1">&#39;address&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">])][</span><span class="s1">&#39;Total High Cost&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="Analyzer.get_attrition_analysis-2670"><a href="#Analyzer.get_attrition_analysis-2670"><span class="linenos">2670</span></a>                <span class="n">tmp_costs</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">tmp_costs</span><span class="p">[</span><span class="s1">&#39;latitude&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;latitude&#39;</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">tmp_costs</span><span class="p">[</span><span class="s1">&#39;longitude&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;longitude&#39;</span><span class="p">]),</span><span class="s1">&#39;Total Average Cost&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">avg_cost</span>
</span><span id="Analyzer.get_attrition_analysis-2671"><a href="#Analyzer.get_attrition_analysis-2671"><span class="linenos">2671</span></a>                <span class="n">tmp_costs</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">tmp_costs</span><span class="p">[</span><span class="s1">&#39;latitude&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;latitude&#39;</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">tmp_costs</span><span class="p">[</span><span class="s1">&#39;longitude&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;longitude&#39;</span><span class="p">]),</span><span class="s1">&#39;Total High Cost&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">conservative_cost</span>
</span><span id="Analyzer.get_attrition_analysis-2672"><a href="#Analyzer.get_attrition_analysis-2672"><span class="linenos">2672</span></a>            
</span><span id="Analyzer.get_attrition_analysis-2673"><a href="#Analyzer.get_attrition_analysis-2673"><span class="linenos">2673</span></a>            <span class="n">cost_values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tmp_costs</span><span class="p">)</span>
</span><span id="Analyzer.get_attrition_analysis-2674"><a href="#Analyzer.get_attrition_analysis-2674"><span class="linenos">2674</span></a>            
</span><span id="Analyzer.get_attrition_analysis-2675"><a href="#Analyzer.get_attrition_analysis-2675"><span class="linenos">2675</span></a>        <span class="c1"># now we have a full list of costs for each employee to each office, we can get the differentials</span>
</span><span id="Analyzer.get_attrition_analysis-2676"><a href="#Analyzer.get_attrition_analysis-2676"><span class="linenos">2676</span></a>        <span class="c1"># create a list to hold the differential dataframes</span>
</span><span id="Analyzer.get_attrition_analysis-2677"><a href="#Analyzer.get_attrition_analysis-2677"><span class="linenos">2677</span></a>        <span class="n">average_diffs</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Analyzer.get_attrition_analysis-2678"><a href="#Analyzer.get_attrition_analysis-2678"><span class="linenos">2678</span></a>        <span class="n">conservative_diffs</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Analyzer.get_attrition_analysis-2679"><a href="#Analyzer.get_attrition_analysis-2679"><span class="linenos">2679</span></a>        <span class="c1"># for each cost dataframe, calculate the differential from the base_costs dataframe into a new dataframe</span>
</span><span id="Analyzer.get_attrition_analysis-2680"><a href="#Analyzer.get_attrition_analysis-2680"><span class="linenos">2680</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">cost_values</span><span class="p">)):</span>
</span><span id="Analyzer.get_attrition_analysis-2681"><a href="#Analyzer.get_attrition_analysis-2681"><span class="linenos">2681</span></a>            <span class="c1"># get the differential</span>
</span><span id="Analyzer.get_attrition_analysis-2682"><a href="#Analyzer.get_attrition_analysis-2682"><span class="linenos">2682</span></a>            <span class="n">average_diffs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cost_values</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;Total Average Cost&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">base_costs</span><span class="p">[</span><span class="s1">&#39;Total Average Cost&#39;</span><span class="p">])</span>
</span><span id="Analyzer.get_attrition_analysis-2683"><a href="#Analyzer.get_attrition_analysis-2683"><span class="linenos">2683</span></a>            <span class="n">conservative_diffs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cost_values</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;Total High Cost&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">base_costs</span><span class="p">[</span><span class="s1">&#39;Total High Cost&#39;</span><span class="p">])</span>
</span><span id="Analyzer.get_attrition_analysis-2684"><a href="#Analyzer.get_attrition_analysis-2684"><span class="linenos">2684</span></a>
</span><span id="Analyzer.get_attrition_analysis-2685"><a href="#Analyzer.get_attrition_analysis-2685"><span class="linenos">2685</span></a>        <span class="k">return</span> <span class="n">base_costs</span><span class="p">,</span> <span class="n">cost_values</span><span class="p">,</span> <span class="n">average_diffs</span><span class="p">,</span> <span class="n">conservative_diffs</span><span class="p">,</span> <span class="n">withins</span><span class="p">,</span> <span class="n">employee_costs_to_office</span><span class="p">,</span> <span class="n">current_office</span><span class="p">,</span> <span class="n">other_offices</span>
</span></pre></div>


    

                            </div>
                            <div id="Analyzer.get_emissions_analysis" class="classattr">
                                        <input id="Analyzer.get_emissions_analysis-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_emissions_analysis</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">emp</span>, </span><span class="param"><span class="n">offices</span>, </span><span class="param"><span class="n">commute_data</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Analyzer.get_emissions_analysis-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Analyzer.get_emissions_analysis"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Analyzer.get_emissions_analysis-2691"><a href="#Analyzer.get_emissions_analysis-2691"><span class="linenos">2691</span></a>    <span class="k">def</span> <span class="nf">get_emissions_analysis</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">emp</span><span class="p">,</span> <span class="n">offices</span><span class="p">,</span> <span class="n">commute_data</span><span class="p">):</span>
</span><span id="Analyzer.get_emissions_analysis-2692"><a href="#Analyzer.get_emissions_analysis-2692"><span class="linenos">2692</span></a>        <span class="c1"># helper function to get a base cost dataframe</span>
</span><span id="Analyzer.get_emissions_analysis-2693"><a href="#Analyzer.get_emissions_analysis-2693"><span class="linenos">2693</span></a>        <span class="k">def</span> <span class="nf">get_base_cost_df</span><span class="p">(</span><span class="n">emp</span><span class="p">,</span> <span class="n">officeaddr</span><span class="p">):</span>
</span><span id="Analyzer.get_emissions_analysis-2694"><a href="#Analyzer.get_emissions_analysis-2694"><span class="linenos">2694</span></a>            <span class="n">rows</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Analyzer.get_emissions_analysis-2695"><a href="#Analyzer.get_emissions_analysis-2695"><span class="linenos">2695</span></a>            <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">emp</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
</span><span id="Analyzer.get_emissions_analysis-2696"><a href="#Analyzer.get_emissions_analysis-2696"><span class="linenos">2696</span></a>                <span class="n">cost</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="Analyzer.get_emissions_analysis-2697"><a href="#Analyzer.get_emissions_analysis-2697"><span class="linenos">2697</span></a>                <span class="n">rows</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s1">&#39;latitude&#39;</span><span class="p">:</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;latitude&#39;</span><span class="p">],</span><span class="s1">&#39;longitude&#39;</span><span class="p">:</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;longitude&#39;</span><span class="p">],</span><span class="s1">&#39;office&#39;</span><span class="p">:</span><span class="n">officeaddr</span><span class="p">,</span><span class="s1">&#39;cost&#39;</span><span class="p">:</span><span class="n">cost</span><span class="p">})</span>
</span><span id="Analyzer.get_emissions_analysis-2698"><a href="#Analyzer.get_emissions_analysis-2698"><span class="linenos">2698</span></a>            <span class="c1">#cost_df = pd.DataFrame(rows)</span>
</span><span id="Analyzer.get_emissions_analysis-2699"><a href="#Analyzer.get_emissions_analysis-2699"><span class="linenos">2699</span></a>            <span class="k">return</span> <span class="n">rows</span>
</span><span id="Analyzer.get_emissions_analysis-2700"><a href="#Analyzer.get_emissions_analysis-2700"><span class="linenos">2700</span></a>        
</span><span id="Analyzer.get_emissions_analysis-2701"><a href="#Analyzer.get_emissions_analysis-2701"><span class="linenos">2701</span></a>        <span class="n">employee_costs_to_office</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="Analyzer.get_emissions_analysis-2702"><a href="#Analyzer.get_emissions_analysis-2702"><span class="linenos">2702</span></a>        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">offices</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>    
</span><span id="Analyzer.get_emissions_analysis-2703"><a href="#Analyzer.get_emissions_analysis-2703"><span class="linenos">2703</span></a>            <span class="n">office</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">to_frame</span><span class="p">()</span><span class="o">.</span><span class="n">T</span>
</span><span id="Analyzer.get_emissions_analysis-2704"><a href="#Analyzer.get_emissions_analysis-2704"><span class="linenos">2704</span></a>            
</span><span id="Analyzer.get_emissions_analysis-2705"><a href="#Analyzer.get_emissions_analysis-2705"><span class="linenos">2705</span></a>            <span class="c1"># get the needed commute values</span>
</span><span id="Analyzer.get_emissions_analysis-2706"><a href="#Analyzer.get_emissions_analysis-2706"><span class="linenos">2706</span></a>            <span class="n">values</span> <span class="o">=</span> <span class="n">commute_data</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span>
</span><span id="Analyzer.get_emissions_analysis-2707"><a href="#Analyzer.get_emissions_analysis-2707"><span class="linenos">2707</span></a>            
</span><span id="Analyzer.get_emissions_analysis-2708"><a href="#Analyzer.get_emissions_analysis-2708"><span class="linenos">2708</span></a>            <span class="n">mornings</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;m_morning_emissions&#39;</span><span class="p">,</span><span class="s1">&#39;t_morning_emissions&#39;</span><span class="p">,</span><span class="s1">&#39;w_morning_emissions&#39;</span><span class="p">,</span><span class="s1">&#39;h_morning_emissions&#39;</span><span class="p">,</span><span class="s1">&#39;f_morning_emissions&#39;</span><span class="p">]</span>
</span><span id="Analyzer.get_emissions_analysis-2709"><a href="#Analyzer.get_emissions_analysis-2709"><span class="linenos">2709</span></a>            <span class="n">evenings</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;m_evening_emissions&#39;</span><span class="p">,</span><span class="s1">&#39;t_evening_emissions&#39;</span><span class="p">,</span><span class="s1">&#39;w_evening_emissions&#39;</span><span class="p">,</span><span class="s1">&#39;h_evening_emissions&#39;</span><span class="p">,</span><span class="s1">&#39;f_evening_emissions&#39;</span><span class="p">]</span>
</span><span id="Analyzer.get_emissions_analysis-2710"><a href="#Analyzer.get_emissions_analysis-2710"><span class="linenos">2710</span></a>            
</span><span id="Analyzer.get_emissions_analysis-2711"><a href="#Analyzer.get_emissions_analysis-2711"><span class="linenos">2711</span></a>            <span class="n">cdpw</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">commute_days_per_week</span>
</span><span id="Analyzer.get_emissions_analysis-2712"><a href="#Analyzer.get_emissions_analysis-2712"><span class="linenos">2712</span></a>
</span><span id="Analyzer.get_emissions_analysis-2713"><a href="#Analyzer.get_emissions_analysis-2713"><span class="linenos">2713</span></a>            <span class="n">emp_within</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graphing</span><span class="o">.</span><span class="n">filter_drive_distance</span><span class="p">(</span><span class="n">emp</span><span class="p">,</span><span class="n">office</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">commute_range_cut_off</span><span class="p">,</span> <span class="n">commute_data</span><span class="o">=</span><span class="n">commute_data</span><span class="p">)</span>
</span><span id="Analyzer.get_emissions_analysis-2714"><a href="#Analyzer.get_emissions_analysis-2714"><span class="linenos">2714</span></a>            <span class="n">val_set</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graphing</span><span class="o">.</span><span class="n">get_commute_values</span><span class="p">(</span><span class="n">emp_within</span><span class="p">,</span> <span class="n">office</span><span class="p">,</span> <span class="n">commute_data</span><span class="p">,</span> <span class="n">values</span><span class="p">)</span>
</span><span id="Analyzer.get_emissions_analysis-2715"><a href="#Analyzer.get_emissions_analysis-2715"><span class="linenos">2715</span></a>            
</span><span id="Analyzer.get_emissions_analysis-2716"><a href="#Analyzer.get_emissions_analysis-2716"><span class="linenos">2716</span></a>            <span class="c1"># restore val_set columns latitutde and longitude to origin_lat and origin_long</span>
</span><span id="Analyzer.get_emissions_analysis-2717"><a href="#Analyzer.get_emissions_analysis-2717"><span class="linenos">2717</span></a>            <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;origin_lat&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;latitude&#39;</span><span class="p">]</span>
</span><span id="Analyzer.get_emissions_analysis-2718"><a href="#Analyzer.get_emissions_analysis-2718"><span class="linenos">2718</span></a>            <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;origin_long&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;longitude&#39;</span><span class="p">]</span>
</span><span id="Analyzer.get_emissions_analysis-2719"><a href="#Analyzer.get_emissions_analysis-2719"><span class="linenos">2719</span></a>
</span><span id="Analyzer.get_emissions_analysis-2720"><a href="#Analyzer.get_emissions_analysis-2720"><span class="linenos">2720</span></a>            <span class="c1"># Calculate and insert the average morning and evening commute times directly into val_set</span>
</span><span id="Analyzer.get_emissions_analysis-2721"><a href="#Analyzer.get_emissions_analysis-2721"><span class="linenos">2721</span></a>            <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;Morning Average&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">val_set</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">mornings</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="Analyzer.get_emissions_analysis-2722"><a href="#Analyzer.get_emissions_analysis-2722"><span class="linenos">2722</span></a>            <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;Evening Average&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">val_set</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">evenings</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="Analyzer.get_emissions_analysis-2723"><a href="#Analyzer.get_emissions_analysis-2723"><span class="linenos">2723</span></a>            
</span><span id="Analyzer.get_emissions_analysis-2724"><a href="#Analyzer.get_emissions_analysis-2724"><span class="linenos">2724</span></a>            <span class="c1"># Calculate and insert the top &#39;cdpw&#39; maximum morning and evening commute times</span>
</span><span id="Analyzer.get_emissions_analysis-2725"><a href="#Analyzer.get_emissions_analysis-2725"><span class="linenos">2725</span></a>            <span class="c1"># Note: Adjust the code below to calculate the averages of the top &#39;cdpw&#39; as new columns directly</span>
</span><span id="Analyzer.get_emissions_analysis-2726"><a href="#Analyzer.get_emissions_analysis-2726"><span class="linenos">2726</span></a>            <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;Average Top CDPW Morning&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">val_set</span><span class="p">[</span><span class="n">mornings</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="n">row</span><span class="o">.</span><span class="n">nlargest</span><span class="p">(</span><span class="n">cdpw</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="Analyzer.get_emissions_analysis-2727"><a href="#Analyzer.get_emissions_analysis-2727"><span class="linenos">2727</span></a>            <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;Average Top CDPW Evening&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">val_set</span><span class="p">[</span><span class="n">evenings</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="n">row</span><span class="o">.</span><span class="n">nlargest</span><span class="p">(</span><span class="n">cdpw</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="Analyzer.get_emissions_analysis-2728"><a href="#Analyzer.get_emissions_analysis-2728"><span class="linenos">2728</span></a>            
</span><span id="Analyzer.get_emissions_analysis-2729"><a href="#Analyzer.get_emissions_analysis-2729"><span class="linenos">2729</span></a>            <span class="c1"># emissions figure are in kg/commute. To get cost we need the CO2_credit_cost, which is $/metric ton</span>
</span><span id="Analyzer.get_emissions_analysis-2730"><a href="#Analyzer.get_emissions_analysis-2730"><span class="linenos">2730</span></a>            <span class="n">per_kg_CO2_cost</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">CO2_credit_cost</span> <span class="o">/</span> <span class="mi">1000</span>
</span><span id="Analyzer.get_emissions_analysis-2731"><a href="#Analyzer.get_emissions_analysis-2731"><span class="linenos">2731</span></a>
</span><span id="Analyzer.get_emissions_analysis-2732"><a href="#Analyzer.get_emissions_analysis-2732"><span class="linenos">2732</span></a>            <span class="c1"># Calculate and insert the average cost for the week directly into val_set</span>
</span><span id="Analyzer.get_emissions_analysis-2733"><a href="#Analyzer.get_emissions_analysis-2733"><span class="linenos">2733</span></a>            <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;Morning Average Cost&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;Morning Average&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">per_kg_CO2_cost</span>
</span><span id="Analyzer.get_emissions_analysis-2734"><a href="#Analyzer.get_emissions_analysis-2734"><span class="linenos">2734</span></a>            <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;Evening Average Cost&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;Evening Average&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">per_kg_CO2_cost</span>
</span><span id="Analyzer.get_emissions_analysis-2735"><a href="#Analyzer.get_emissions_analysis-2735"><span class="linenos">2735</span></a>            
</span><span id="Analyzer.get_emissions_analysis-2736"><a href="#Analyzer.get_emissions_analysis-2736"><span class="linenos">2736</span></a>            <span class="c1"># Calculate and insert the high/conservative cost for the week directly into val_set</span>
</span><span id="Analyzer.get_emissions_analysis-2737"><a href="#Analyzer.get_emissions_analysis-2737"><span class="linenos">2737</span></a>            <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;Morning High Cost&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;Average Top CDPW Morning&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">per_kg_CO2_cost</span>
</span><span id="Analyzer.get_emissions_analysis-2738"><a href="#Analyzer.get_emissions_analysis-2738"><span class="linenos">2738</span></a>            <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;Evening High Cost&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;Average Top CDPW Evening&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">per_kg_CO2_cost</span>
</span><span id="Analyzer.get_emissions_analysis-2739"><a href="#Analyzer.get_emissions_analysis-2739"><span class="linenos">2739</span></a>
</span><span id="Analyzer.get_emissions_analysis-2740"><a href="#Analyzer.get_emissions_analysis-2740"><span class="linenos">2740</span></a>            <span class="c1"># Calculate a Total Average Time and Total High Time cost</span>
</span><span id="Analyzer.get_emissions_analysis-2741"><a href="#Analyzer.get_emissions_analysis-2741"><span class="linenos">2741</span></a>            <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;Total Average Cost&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;Morning Average Cost&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;Evening Average Cost&#39;</span><span class="p">]</span>
</span><span id="Analyzer.get_emissions_analysis-2742"><a href="#Analyzer.get_emissions_analysis-2742"><span class="linenos">2742</span></a>            <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;Total High Cost&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;Morning High Cost&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;Evening High Cost&#39;</span><span class="p">]</span>
</span><span id="Analyzer.get_emissions_analysis-2743"><a href="#Analyzer.get_emissions_analysis-2743"><span class="linenos">2743</span></a>            
</span><span id="Analyzer.get_emissions_analysis-2744"><a href="#Analyzer.get_emissions_analysis-2744"><span class="linenos">2744</span></a>            <span class="c1"># add the current val_set to the employee_costs_to_office dictionary</span>
</span><span id="Analyzer.get_emissions_analysis-2745"><a href="#Analyzer.get_emissions_analysis-2745"><span class="linenos">2745</span></a>            <span class="n">employee_costs_to_office</span><span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;address&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">val_set</span>
</span><span id="Analyzer.get_emissions_analysis-2746"><a href="#Analyzer.get_emissions_analysis-2746"><span class="linenos">2746</span></a>        
</span><span id="Analyzer.get_emissions_analysis-2747"><a href="#Analyzer.get_emissions_analysis-2747"><span class="linenos">2747</span></a>        <span class="c1"># employees to analyze are within the cutoff distance for this office</span>
</span><span id="Analyzer.get_emissions_analysis-2748"><a href="#Analyzer.get_emissions_analysis-2748"><span class="linenos">2748</span></a>        <span class="c1"># for this analysis, we need to iterate through options</span>
</span><span id="Analyzer.get_emissions_analysis-2749"><a href="#Analyzer.get_emissions_analysis-2749"><span class="linenos">2749</span></a>        <span class="n">current_office</span> <span class="o">=</span> <span class="n">offices</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">to_frame</span><span class="p">()</span><span class="o">.</span><span class="n">T</span>
</span><span id="Analyzer.get_emissions_analysis-2750"><a href="#Analyzer.get_emissions_analysis-2750"><span class="linenos">2750</span></a>        <span class="n">other_offices</span> <span class="o">=</span> <span class="n">offices</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="Analyzer.get_emissions_analysis-2751"><a href="#Analyzer.get_emissions_analysis-2751"><span class="linenos">2751</span></a>        <span class="n">cost_values</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Analyzer.get_emissions_analysis-2752"><a href="#Analyzer.get_emissions_analysis-2752"><span class="linenos">2752</span></a>        <span class="n">withins</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Analyzer.get_emissions_analysis-2753"><a href="#Analyzer.get_emissions_analysis-2753"><span class="linenos">2753</span></a>        <span class="n">commutes</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">commute_days_per_week</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">commute_weeks_per_year</span>
</span><span id="Analyzer.get_emissions_analysis-2754"><a href="#Analyzer.get_emissions_analysis-2754"><span class="linenos">2754</span></a>        
</span><span id="Analyzer.get_emissions_analysis-2755"><a href="#Analyzer.get_emissions_analysis-2755"><span class="linenos">2755</span></a>        <span class="c1"># for each employee, calculate the commute cost to the current office, place a new dataframe with lat, long, office, and cost</span>
</span><span id="Analyzer.get_emissions_analysis-2756"><a href="#Analyzer.get_emissions_analysis-2756"><span class="linenos">2756</span></a>        <span class="c1"># if the employee is within the cutoff distance, if outside the cutoff distance, the cost is 0</span>
</span><span id="Analyzer.get_emissions_analysis-2757"><a href="#Analyzer.get_emissions_analysis-2757"><span class="linenos">2757</span></a>        <span class="c1"># start by looping through ALL employees and adding a row with the current office, and cost = 0</span>
</span><span id="Analyzer.get_emissions_analysis-2758"><a href="#Analyzer.get_emissions_analysis-2758"><span class="linenos">2758</span></a>                
</span><span id="Analyzer.get_emissions_analysis-2759"><a href="#Analyzer.get_emissions_analysis-2759"><span class="linenos">2759</span></a>
</span><span id="Analyzer.get_emissions_analysis-2760"><a href="#Analyzer.get_emissions_analysis-2760"><span class="linenos">2760</span></a>        <span class="n">base_costs</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">get_base_cost_df</span><span class="p">(</span><span class="n">emp</span><span class="p">,</span> <span class="n">current_office</span><span class="p">[</span><span class="s1">&#39;address&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
</span><span id="Analyzer.get_emissions_analysis-2761"><a href="#Analyzer.get_emissions_analysis-2761"><span class="linenos">2761</span></a>        <span class="c1"># add columns for total average cost and total high cost</span>
</span><span id="Analyzer.get_emissions_analysis-2762"><a href="#Analyzer.get_emissions_analysis-2762"><span class="linenos">2762</span></a>        <span class="n">base_costs</span><span class="p">[</span><span class="s1">&#39;Total Average Cost&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="Analyzer.get_emissions_analysis-2763"><a href="#Analyzer.get_emissions_analysis-2763"><span class="linenos">2763</span></a>        <span class="n">base_costs</span><span class="p">[</span><span class="s1">&#39;Total High Cost&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="Analyzer.get_emissions_analysis-2764"><a href="#Analyzer.get_emissions_analysis-2764"><span class="linenos">2764</span></a>        <span class="c1"># now get emp_within for the current office, and update the relevant rows of base_costs with actual costs for those employees </span>
</span><span id="Analyzer.get_emissions_analysis-2765"><a href="#Analyzer.get_emissions_analysis-2765"><span class="linenos">2765</span></a>        <span class="c1"># using the commute_cost column in the commute_data dataframe where the employee lat long matches the commute_data lat long and office address</span>
</span><span id="Analyzer.get_emissions_analysis-2766"><a href="#Analyzer.get_emissions_analysis-2766"><span class="linenos">2766</span></a>        
</span><span id="Analyzer.get_emissions_analysis-2767"><a href="#Analyzer.get_emissions_analysis-2767"><span class="linenos">2767</span></a>        <span class="n">base_emp_within</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graphing</span><span class="o">.</span><span class="n">filter_drive_distance</span><span class="p">(</span><span class="n">emp</span><span class="p">,</span><span class="n">current_office</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">commute_range_cut_off</span><span class="p">,</span> <span class="n">commute_data</span><span class="o">=</span><span class="n">commute_data</span><span class="p">)</span>
</span><span id="Analyzer.get_emissions_analysis-2768"><a href="#Analyzer.get_emissions_analysis-2768"><span class="linenos">2768</span></a>
</span><span id="Analyzer.get_emissions_analysis-2769"><a href="#Analyzer.get_emissions_analysis-2769"><span class="linenos">2769</span></a>        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">base_emp_within</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
</span><span id="Analyzer.get_emissions_analysis-2770"><a href="#Analyzer.get_emissions_analysis-2770"><span class="linenos">2770</span></a>            <span class="c1"># set val_set from the employee_costs_to_office = {} dictionary</span>
</span><span id="Analyzer.get_emissions_analysis-2771"><a href="#Analyzer.get_emissions_analysis-2771"><span class="linenos">2771</span></a>            <span class="n">val_set</span> <span class="o">=</span> <span class="n">employee_costs_to_office</span><span class="p">[</span><span class="n">current_office</span><span class="p">[</span><span class="s1">&#39;address&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
</span><span id="Analyzer.get_emissions_analysis-2772"><a href="#Analyzer.get_emissions_analysis-2772"><span class="linenos">2772</span></a>            <span class="c1"># get the cost from the commute_data</span>
</span><span id="Analyzer.get_emissions_analysis-2773"><a href="#Analyzer.get_emissions_analysis-2773"><span class="linenos">2773</span></a>            <span class="n">avg_cost</span> <span class="o">=</span> <span class="n">val_set</span><span class="p">[(</span><span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;origin_lat&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;latitude&#39;</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;origin_long&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;longitude&#39;</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;office_address&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">current_office</span><span class="p">[</span><span class="s1">&#39;address&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">])][</span><span class="s1">&#39;Total Average Cost&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="Analyzer.get_emissions_analysis-2774"><a href="#Analyzer.get_emissions_analysis-2774"><span class="linenos">2774</span></a>            <span class="n">conservative_cost</span> <span class="o">=</span> <span class="n">val_set</span><span class="p">[(</span><span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;origin_lat&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;latitude&#39;</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;origin_long&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;longitude&#39;</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;office_address&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">current_office</span><span class="p">[</span><span class="s1">&#39;address&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">])][</span><span class="s1">&#39;Total High Cost&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="Analyzer.get_emissions_analysis-2775"><a href="#Analyzer.get_emissions_analysis-2775"><span class="linenos">2775</span></a>            <span class="n">base_costs</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">base_costs</span><span class="p">[</span><span class="s1">&#39;latitude&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;latitude&#39;</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">base_costs</span><span class="p">[</span><span class="s1">&#39;longitude&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;longitude&#39;</span><span class="p">]),</span><span class="s1">&#39;Total Average Cost&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">avg_cost</span>
</span><span id="Analyzer.get_emissions_analysis-2776"><a href="#Analyzer.get_emissions_analysis-2776"><span class="linenos">2776</span></a>            <span class="n">base_costs</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">base_costs</span><span class="p">[</span><span class="s1">&#39;latitude&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;latitude&#39;</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">base_costs</span><span class="p">[</span><span class="s1">&#39;longitude&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;longitude&#39;</span><span class="p">]),</span><span class="s1">&#39;Total High Cost&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">conservative_cost</span>
</span><span id="Analyzer.get_emissions_analysis-2777"><a href="#Analyzer.get_emissions_analysis-2777"><span class="linenos">2777</span></a>
</span><span id="Analyzer.get_emissions_analysis-2778"><a href="#Analyzer.get_emissions_analysis-2778"><span class="linenos">2778</span></a>        <span class="c1"># now we have a dataframe with all employees, and the cost to the current office</span>
</span><span id="Analyzer.get_emissions_analysis-2779"><a href="#Analyzer.get_emissions_analysis-2779"><span class="linenos">2779</span></a>    
</span><span id="Analyzer.get_emissions_analysis-2780"><a href="#Analyzer.get_emissions_analysis-2780"><span class="linenos">2780</span></a>        <span class="c1"># now iterate through the other offices, get a base cost dataframe, and then update the relevant rows with actual costs, place in cost_values</span>
</span><span id="Analyzer.get_emissions_analysis-2781"><a href="#Analyzer.get_emissions_analysis-2781"><span class="linenos">2781</span></a>        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">other_offices</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
</span><span id="Analyzer.get_emissions_analysis-2782"><a href="#Analyzer.get_emissions_analysis-2782"><span class="linenos">2782</span></a>            <span class="n">office</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">to_frame</span><span class="p">()</span><span class="o">.</span><span class="n">T</span>
</span><span id="Analyzer.get_emissions_analysis-2783"><a href="#Analyzer.get_emissions_analysis-2783"><span class="linenos">2783</span></a>            <span class="n">tmp_costs</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">get_base_cost_df</span><span class="p">(</span><span class="n">emp</span><span class="p">,</span> <span class="n">office</span><span class="p">[</span><span class="s1">&#39;address&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
</span><span id="Analyzer.get_emissions_analysis-2784"><a href="#Analyzer.get_emissions_analysis-2784"><span class="linenos">2784</span></a>            <span class="c1"># add columns for total average cost and total high cost</span>
</span><span id="Analyzer.get_emissions_analysis-2785"><a href="#Analyzer.get_emissions_analysis-2785"><span class="linenos">2785</span></a>            <span class="n">tmp_costs</span><span class="p">[</span><span class="s1">&#39;Total Average Cost&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="Analyzer.get_emissions_analysis-2786"><a href="#Analyzer.get_emissions_analysis-2786"><span class="linenos">2786</span></a>            <span class="n">tmp_costs</span><span class="p">[</span><span class="s1">&#39;Total High Cost&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="Analyzer.get_emissions_analysis-2787"><a href="#Analyzer.get_emissions_analysis-2787"><span class="linenos">2787</span></a>            <span class="n">emp_within</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graphing</span><span class="o">.</span><span class="n">filter_drive_distance</span><span class="p">(</span><span class="n">emp</span><span class="p">,</span><span class="n">office</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">commute_range_cut_off</span><span class="p">,</span> <span class="n">commute_data</span><span class="o">=</span><span class="n">commute_data</span><span class="p">)</span>
</span><span id="Analyzer.get_emissions_analysis-2788"><a href="#Analyzer.get_emissions_analysis-2788"><span class="linenos">2788</span></a>            <span class="c1"># we will use this later to get the differential for each employee, without the employees that aren&#39;t overlapping</span>
</span><span id="Analyzer.get_emissions_analysis-2789"><a href="#Analyzer.get_emissions_analysis-2789"><span class="linenos">2789</span></a>            <span class="n">withins</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">emp_within</span><span class="p">)</span>
</span><span id="Analyzer.get_emissions_analysis-2790"><a href="#Analyzer.get_emissions_analysis-2790"><span class="linenos">2790</span></a>
</span><span id="Analyzer.get_emissions_analysis-2791"><a href="#Analyzer.get_emissions_analysis-2791"><span class="linenos">2791</span></a>            <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">emp_within</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
</span><span id="Analyzer.get_emissions_analysis-2792"><a href="#Analyzer.get_emissions_analysis-2792"><span class="linenos">2792</span></a>                <span class="c1"># set val_set from the employee_costs_to_office = {} dictionary</span>
</span><span id="Analyzer.get_emissions_analysis-2793"><a href="#Analyzer.get_emissions_analysis-2793"><span class="linenos">2793</span></a>                <span class="n">val_set</span> <span class="o">=</span> <span class="n">employee_costs_to_office</span><span class="p">[</span><span class="n">office</span><span class="p">[</span><span class="s1">&#39;address&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
</span><span id="Analyzer.get_emissions_analysis-2794"><a href="#Analyzer.get_emissions_analysis-2794"><span class="linenos">2794</span></a>                <span class="c1"># get the cost from the commute_data</span>
</span><span id="Analyzer.get_emissions_analysis-2795"><a href="#Analyzer.get_emissions_analysis-2795"><span class="linenos">2795</span></a>                <span class="n">avg_cost</span> <span class="o">=</span> <span class="n">val_set</span><span class="p">[(</span><span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;origin_lat&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;latitude&#39;</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;origin_long&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;longitude&#39;</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;office_address&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">office</span><span class="p">[</span><span class="s1">&#39;address&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">])][</span><span class="s1">&#39;Total Average Cost&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="Analyzer.get_emissions_analysis-2796"><a href="#Analyzer.get_emissions_analysis-2796"><span class="linenos">2796</span></a>                <span class="n">conservative_cost</span> <span class="o">=</span> <span class="n">val_set</span><span class="p">[(</span><span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;origin_lat&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;latitude&#39;</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;origin_long&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;longitude&#39;</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">val_set</span><span class="p">[</span><span class="s1">&#39;office_address&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">office</span><span class="p">[</span><span class="s1">&#39;address&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">])][</span><span class="s1">&#39;Total High Cost&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="Analyzer.get_emissions_analysis-2797"><a href="#Analyzer.get_emissions_analysis-2797"><span class="linenos">2797</span></a>                <span class="n">tmp_costs</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">tmp_costs</span><span class="p">[</span><span class="s1">&#39;latitude&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;latitude&#39;</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">tmp_costs</span><span class="p">[</span><span class="s1">&#39;longitude&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;longitude&#39;</span><span class="p">]),</span><span class="s1">&#39;Total Average Cost&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">avg_cost</span>
</span><span id="Analyzer.get_emissions_analysis-2798"><a href="#Analyzer.get_emissions_analysis-2798"><span class="linenos">2798</span></a>                <span class="n">tmp_costs</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">tmp_costs</span><span class="p">[</span><span class="s1">&#39;latitude&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;latitude&#39;</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">tmp_costs</span><span class="p">[</span><span class="s1">&#39;longitude&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;longitude&#39;</span><span class="p">]),</span><span class="s1">&#39;Total High Cost&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">conservative_cost</span>
</span><span id="Analyzer.get_emissions_analysis-2799"><a href="#Analyzer.get_emissions_analysis-2799"><span class="linenos">2799</span></a>            
</span><span id="Analyzer.get_emissions_analysis-2800"><a href="#Analyzer.get_emissions_analysis-2800"><span class="linenos">2800</span></a>            <span class="n">cost_values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tmp_costs</span><span class="p">)</span>
</span><span id="Analyzer.get_emissions_analysis-2801"><a href="#Analyzer.get_emissions_analysis-2801"><span class="linenos">2801</span></a>            
</span><span id="Analyzer.get_emissions_analysis-2802"><a href="#Analyzer.get_emissions_analysis-2802"><span class="linenos">2802</span></a>        <span class="c1"># now we have a full list of costs for each employee to each office, we can get the differentials</span>
</span><span id="Analyzer.get_emissions_analysis-2803"><a href="#Analyzer.get_emissions_analysis-2803"><span class="linenos">2803</span></a>        <span class="c1"># create a list to hold the differential dataframes</span>
</span><span id="Analyzer.get_emissions_analysis-2804"><a href="#Analyzer.get_emissions_analysis-2804"><span class="linenos">2804</span></a>        <span class="n">average_diffs</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Analyzer.get_emissions_analysis-2805"><a href="#Analyzer.get_emissions_analysis-2805"><span class="linenos">2805</span></a>        <span class="n">conservative_diffs</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Analyzer.get_emissions_analysis-2806"><a href="#Analyzer.get_emissions_analysis-2806"><span class="linenos">2806</span></a>        <span class="c1"># for each cost dataframe, calculate the differential from the base_costs dataframe into a new dataframe</span>
</span><span id="Analyzer.get_emissions_analysis-2807"><a href="#Analyzer.get_emissions_analysis-2807"><span class="linenos">2807</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">cost_values</span><span class="p">)):</span>
</span><span id="Analyzer.get_emissions_analysis-2808"><a href="#Analyzer.get_emissions_analysis-2808"><span class="linenos">2808</span></a>            <span class="c1"># get the differential</span>
</span><span id="Analyzer.get_emissions_analysis-2809"><a href="#Analyzer.get_emissions_analysis-2809"><span class="linenos">2809</span></a>            <span class="n">average_diffs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cost_values</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;Total Average Cost&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">base_costs</span><span class="p">[</span><span class="s1">&#39;Total Average Cost&#39;</span><span class="p">])</span>
</span><span id="Analyzer.get_emissions_analysis-2810"><a href="#Analyzer.get_emissions_analysis-2810"><span class="linenos">2810</span></a>            <span class="n">conservative_diffs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cost_values</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;Total High Cost&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">base_costs</span><span class="p">[</span><span class="s1">&#39;Total High Cost&#39;</span><span class="p">])</span>
</span><span id="Analyzer.get_emissions_analysis-2811"><a href="#Analyzer.get_emissions_analysis-2811"><span class="linenos">2811</span></a>
</span><span id="Analyzer.get_emissions_analysis-2812"><a href="#Analyzer.get_emissions_analysis-2812"><span class="linenos">2812</span></a>        <span class="k">return</span> <span class="n">base_costs</span><span class="p">,</span> <span class="n">cost_values</span><span class="p">,</span> <span class="n">average_diffs</span><span class="p">,</span> <span class="n">conservative_diffs</span><span class="p">,</span> <span class="n">withins</span><span class="p">,</span> <span class="n">employee_costs_to_office</span><span class="p">,</span> <span class="n">current_office</span><span class="p">,</span> <span class="n">other_offices</span>
</span></pre></div>


    

                            </div>
                </section>
    </main>
<script>
    function escapeHTML(html) {
        return document.createElement('div').appendChild(document.createTextNode(html)).parentNode.innerHTML;
    }

    const originalContent = document.querySelector("main.pdoc");
    let currentContent = originalContent;

    function setContent(innerHTML) {
        let elem;
        if (innerHTML) {
            elem = document.createElement("main");
            elem.classList.add("pdoc");
            elem.innerHTML = innerHTML;
        } else {
            elem = originalContent;
        }
        if (currentContent !== elem) {
            currentContent.replaceWith(elem);
            currentContent = elem;
        }
    }

    function getSearchTerm() {
        return (new URL(window.location)).searchParams.get("search");
    }

    const searchBox = document.querySelector(".pdoc input[type=search]");
    searchBox.addEventListener("input", function () {
        let url = new URL(window.location);
        if (searchBox.value.trim()) {
            url.hash = "";
            url.searchParams.set("search", searchBox.value);
        } else {
            url.searchParams.delete("search");
        }
        history.replaceState("", "", url.toString());
        onInput();
    });
    window.addEventListener("popstate", onInput);


    let search, searchErr;

    async function initialize() {
        try {
            search = await new Promise((resolve, reject) => {
                const script = document.createElement("script");
                script.type = "text/javascript";
                script.async = true;
                script.onload = () => resolve(window.pdocSearch);
                script.onerror = (e) => reject(e);
                script.src = "../search.js";
                document.getElementsByTagName("head")[0].appendChild(script);
            });
        } catch (e) {
            console.error("Cannot fetch pdoc search index");
            searchErr = "Cannot fetch search index.";
        }
        onInput();

        document.querySelector("nav.pdoc").addEventListener("click", e => {
            if (e.target.hash) {
                searchBox.value = "";
                searchBox.dispatchEvent(new Event("input"));
            }
        });
    }

    function onInput() {
        setContent((() => {
            const term = getSearchTerm();
            if (!term) {
                return null
            }
            if (searchErr) {
                return `<h3>Error: ${searchErr}</h3>`
            }
            if (!search) {
                return "<h3>Searching...</h3>"
            }

            window.scrollTo({top: 0, left: 0, behavior: 'auto'});

            const results = search(term);

            let html;
            if (results.length === 0) {
                html = `No search results for '${escapeHTML(term)}'.`
            } else {
                html = `<h4>${results.length} search result${results.length > 1 ? "s" : ""} for '${escapeHTML(term)}'.</h4>`;
            }
            for (let result of results.slice(0, 10)) {
                let doc = result.doc;
                let url = `../${doc.modulename.replaceAll(".", "/")}.html`;
                if (doc.qualname) {
                    url += `#${doc.qualname}`;
                }

                let heading;
                switch (result.doc.kind) {
                    case "function":
                        if (doc.fullname.endsWith(".__init__")) {
                            heading = `<span class="name">${doc.fullname.replace(/\.__init__$/, "")}</span>${doc.signature}`;
                        } else {
                            heading = `<span class="def">${doc.funcdef}</span> <span class="name">${doc.fullname}</span>${doc.signature}`;
                        }
                        break;
                    case "class":
                        heading = `<span class="def">class</span> <span class="name">${doc.fullname}</span>`;
                        if (doc.bases)
                            heading += `<wbr>(<span class="base">${doc.bases}</span>)`;
                        heading += `:`;
                        break;
                    case "variable":
                        heading = `<span class="name">${doc.fullname}</span>`;
                        if (doc.annotation)
                            heading += `<span class="annotation">${doc.annotation}</span>`;
                        if (doc.default_value)
                            heading += `<span class="default_value"> = ${doc.default_value}</span>`;
                        break;
                    default:
                        heading = `<span class="name">${doc.fullname}</span>`;
                        break;
                }
                html += `
                        <section class="search-result">
                        <a href="${url}" class="attr ${doc.kind}">${heading}</a>
                        <div class="docstring">${doc.doc}</div>
                        </section>
                    `;

            }
            return html;
        })());
    }

    if (getSearchTerm()) {
        initialize();
        searchBox.value = getSearchTerm();
        onInput();
    } else {
        searchBox.addEventListener("focus", initialize, {once: true});
    }

    searchBox.addEventListener("keydown", e => {
        if (["ArrowDown", "ArrowUp", "Enter"].includes(e.key)) {
            let focused = currentContent.querySelector(".search-result.focused");
            if (!focused) {
                currentContent.querySelector(".search-result").classList.add("focused");
            } else if (
                e.key === "ArrowDown"
                && focused.nextElementSibling
                && focused.nextElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.nextElementSibling.classList.add("focused");
                focused.nextElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "ArrowUp"
                && focused.previousElementSibling
                && focused.previousElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.previousElementSibling.classList.add("focused");
                focused.previousElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "Enter"
            ) {
                focused.querySelector("a").click();
            }
        }
    });
</script></body>
</html>